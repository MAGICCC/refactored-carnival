{"config":{"separator":"[\\s\\-_,:!=\\[\\]()\\\\\"`/]+|\\.(?!\\d)"},"items":[{"location":"","level":1,"title":"mailcow: dockerized - + =","text":"","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"#mailcow-dockerized-","level":1,"title":"mailcow: dockerized -  +  =","text":"<p>The mailserver suite with the 'moo'</p>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"#what-is-mailcow-dockerized","level":2,"title":"What is mailcow: dockerized?","text":"<p>Question</p> <p>Mailcow, MailCow or mailcow? What is the exact name of the project?</p> <p>Correct: mailcow, because mailcow is a registered word mark with a small m </p> <p>mailcow: dockerized is an open source groupware/email suite based on docker.</p> <p>mailcow relies on many well known and long used components, which in combination result in an all around carefree email server.</p> <p>Each container represents a single application, connected in a bridged network:</p> <ul> <li> ACME Automatic generation of Let's Encrypt certificates</li> <li> ClamAV Antivirus scanner (optional)</li> <li> Dovecot IMAP/POP server for retrieving e-mails with integrated Full-Text Search Engine \"Flatcurve\"</li> <li> MariaDB Database for storing user information etc.</li> <li> Memcached Cache for the webmailer SOGo</li> <li> Netfilter Fail2ban-like integration of @mkuron</li> <li> Nginx Web server for components of the stack</li> <li> Olefy Analysis of Office documents for viruses, macros, etc.</li> <li> PHP Programming language of most web-based mailcow applications</li> <li> Postfix MTA (Mail Transfer Agent) for e-mail traffic on the Internet</li> <li> Redis Storage for spam information, DKIM key, etc.</li> <li> Rspamd Spam filter with automatic learning of spam mails</li> <li> SOGo Integrated webmailer and Cal-/Carddav interface</li> <li> Unbound Integrated DNS server for verifying DNSSEC etc.</li> <li> Watchdog For basic monitoring of the container status within mailcow</li> </ul> <p>But the heart of mailcow is the graphical web interface, the mailcow UI.</p> <p>It offers a place for almost all settings and allows the comfortable creation of new domains and email addresses with just a few clicks.</p> <p>But also other or more tricky tasks can be done in it with ease:</p> <ul> <li>DKIM and ARC support/generation.</li> <li>Black and white lists per domain and per user.</li> <li>Spam score management per user (reject spam, flag spam, greylist).</li> <li>Allow mailbox users to create temporary spam aliases</li> <li>Prepend email tags to subject or move emails to subfolders (per user)</li> <li>Allow mailbox users to toggle TLS enforcement for inbound and outbound messages</li> <li>Users can reset caches on SOGo ActiveSync devices</li> <li>imapsync to periodically migrate or retrieve remote mailboxes</li> <li>TFA: Yubikey OTP and WebAuthn USB (Google Chrome and derivatives only), TOTP</li> <li>Add whitelist hosts to forward mail to mailcow</li> <li>Fail2ban-like integration</li> <li>Quarantine system</li> <li>Anti-virus scanning including macro scanning in Office documents</li> <li>Integrated basic monitoring</li> <li>And much more...</li> </ul> <p>The mailcow data (such as emails, user data, etc.) is stored in Docker volumes - take good care of these volumes:</p> <ul> <li>clamd-db-vol-1</li> <li>crypt-vol-1</li> <li>mysql-socket-vol-1</li> <li>mysql-vol-1</li> <li>postfix-vol-1</li> <li>redis-vol-1</li> <li>rspamd-vol-1</li> <li>sogo-userdata-backup-vol-1</li> <li>sogo-web-vol-1</li> <li>vmail-index-vol-1</li> <li>vmail-vol-1</li> </ul> <p>Warning</p> <p>The mails are compressed and encrypted. The key pair can be found in crypt-vol-1. Please don't forget to backup this and other volumes. #nobackupnopity</p>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"#support-the-mailcow-project","level":2,"title":"Support the mailcow project","text":"<p>Please consider a support contract for a small monthly fee at Servercow<sup>1</sup> to support further development. We support you while you support us. :)</p> <p>If you are super awesome and would like to support without a contract, you can get a SAL (Stay-Awesome License) that confirms your awesomeness (a flexible one-time payment) at Servercow.</p>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"#need-help","level":2,"title":"Need help?","text":"<p>There are two ways to achieve support for your mailcow installation.</p>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"#commercial-support","level":3,"title":"Commercial support","text":"<p>For professional and prioritized commercial support you can sign a basic support subscription at Servercow. For custom inquiries or questions please contact us at info@servercow.de instead.</p> <p>Furthermore we do also provide a fully featured and managed mailcow here. This way we take care about the technical magic underneath and you can enjoy your whole mail experience in a hassle-free way.</p>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"#community-support-and-chat","level":3,"title":"Community support and chat","text":"<p>The other alternative is our free community-support on our various channels below. Please notice, that this support is driven by our awesome community around mailcow. This kind of support is best-effort, voluntary and there is no guarantee for anything.</p> <ul> <li> <p> mailcow Community @ community.mailcow.email</p> </li> <li> <p> Telegram (Support) @ t.me/mailcow</p> </li> <li> <p> Telegram (Off-Topic) @ t.me/mailcowOfftopic</p> </li> </ul> <p>Telegram desktop clients are available for multiple platforms. You can search the groups history for keywords.</p> <p>For bug tracking, feature requests and code contributions only:</p> <ul> <li> mailcow/mailcow-dockerized @ GitHub</li> </ul>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"#news-and-release-informations","level":3,"title":"News and release informations","text":"<p>For announcements and release informations you can find us on:</p> <ul> <li> <p> mailcow @ X/Twitter</p> </li> <li> <p> @doncow @ mailcow.social</p> </li> </ul> <p>Or alternatively on our blog:</p> <ul> <li> mailcow.email</li> </ul>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"#interested-try-it-out-right-away","level":2,"title":"Interested? Try it out right away!","text":"<p>Have we got your interest? Get a first overview of the functionalities of mailcow and your mailcow UI in our official mailcow demos!</p> <p>We´re providing two seperate Demo instances: </p> <ul> <li>demo.mailcow.email is the classic Demo based on the stable releases.</li> <li>nightly-demo.mailcow.email is the new nightly demo based on unreleased testing features. (So especially interesting for those who have no possibility to create a test instance themselves.)</li> </ul> <p>Use these credentials for the demos</p> <ul> <li>Administrator: admin / moohoo</li> <li>Domain-Administrator: department / moohoo</li> <li>Mailbox: demo@440044.xyz / moohoo</li> </ul> <p>The login credentials work for both variants.</p> <p>Always up to date</p> <p>The demo instances get the latest updates directly after releases from GitHub. Fully automatic, without any downtime!</p> <ol> <li> <p>Servercow is a hosting/support division of The Infrastructure Company GmbH (mailcow maintainer). ↩</p> </li> </ol>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"backup_restore/b_n_r-accidental_deletion.de/","level":1,"title":"B n r accidental deletion.de","text":"<p>Sie haben also ein Postfach gelöscht und haben keine Sicherungskopien?</p> <p>Wenn Sie Ihren Fehler innerhalb von ein paar Stunden bemerken, können Sie die Daten des Benutzers wahrscheinlich wiederherstellen.</p>","path":["B n r accidental deletion.de"],"tags":[]},{"location":"backup_restore/b_n_r-accidental_deletion.de/#sogo","level":3,"title":"SOGo","text":"<p>Wir erstellen automatisch tägliche Backups (24 Stunden Intervall ab dem ausführen von up -d) in <code>/var/lib/docker/volumes/mailcowdockerized_sogo-userdata-backup-vol-1/_data/</code>.</p> <p>Stellen Sie sicher, dass der Benutzer, den Sie wiederherstellen wollen, in Ihrem mailcow-Backend existiert. Legen Sie diesen neu an, falls nicht mehr existent.</p> <p>Kopieren Sie die Datei mit dem Namen des Benutzers, den Sie wiederherstellen wollen, nach <code>__MAILCOW_DIRECTORY__/data/conf/sogo</code>.</p> <ol> <li> <p>Kopieren Sie die Sicherung: <code>cp /var/lib/docker/volumes/mailcowdockerized_sogo-userdata-backup-vol-1/_data/restoreme@example.org __MAILCOW_DIRECTORY__/data/conf/sogo</code></p> </li> <li> <p>Führen Sie folgenden Befehl aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec -u sogo sogo-mailcow sogo-tool restore -F ALL /etc/sogo restoreme@example.org\n</code></pre> <pre><code>docker-compose exec -u sogo sogo-mailcow sogo-tool restore -F ALL /etc/sogo restoreme@example.org\n</code></pre> <p>Führen Sie <code>sogo-tool</code> ohne Parameter aus, um nach möglichen Wiederherstellungsoptionen zu suchen.</p> </li> <li> <p>Löschen Sie die kopierte Sicherung, indem Sie <code>rm __MAILCOW_DIRECTORY__/data/conf/sogo</code> ausführen</p> </li> <li> <p>Starten Sie SOGo und Memcached neu: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart sogo-mailcow memcached-mailcow\n</code></pre> <pre><code>docker-compose restart sogo-mailcow memcached-mailcow\n</code></pre> </li> </ol>","path":["B n r accidental deletion.de"],"tags":[]},{"location":"backup_restore/b_n_r-accidental_deletion.de/#mail","level":3,"title":"Mail","text":"<p>Im Falle einer versehentlichen Löschung einer Mailbox, können Sie diese (standardmäßig) 5 Tage lang wiederherstellen. Dies hängt von dem <code>MAILDIR_GC_TIME</code> Parameter in <code>mailcow.conf</code> ab.</p> <p>Eine gelöschte Mailbox wird in ihrer verschlüsselten Form nach <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/_garbage</code> kopiert.</p> <p>Der Ordner innerhalb von <code>_garbage</code> folgt der Struktur <code>[timestamp]_[domain_sanitized][user_sanitized]</code>, zum Beispiel <code>1629109708_exampleorgtest</code> im Falle von test@example.org, das am 1629109708 gelöscht wurde.</p> <p>Um die Mailbox wiederherzustellen, stellen Sie sicher, dass Sie tatsächlich auf die gleiche mailcow wiederherstellen, von der sie gelöscht wurde, oder Sie die gleichen Verschlüsselungsschlüssel in <code>crypt-vol-1</code> verwenden.</p> <p>Stellen Sie sicher, dass der Benutzer, den Sie wiederherstellen wollen, in Ihrer mailcow existiert. Legen Sie diesen neu an, wenn der Benutzer fehlt.</p> <p>Kopieren Sie die Ordner von <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/_garbage/[timestamp]_[domain_sanitized][user_sanitized]</code> zurück nach <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/[domain]/[user]</code> und synchronisieren Sie die Ordner neu und berechnen Sie die Quota (Speicherplatz) neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm force-resync -u restoreme@example.net '*'\ndocker compose exec dovecot-mailcow doveadm quota recalc -u restoreme@example.net\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm force-resync -u restoreme@example.net '*'\ndocker-compose exec dovecot-mailcow doveadm quota recalc -u restoreme@example.net\n</code></pre>","path":["B n r accidental deletion.de"],"tags":[]},{"location":"backup_restore/b_n_r-accidental_deletion.en/","level":1,"title":"B n r accidental deletion.en","text":"<p>So you deleted a mailbox and have no backups, he?</p> <p>If you noticed your mistake within a few hours, you can probably recover the users data.</p>","path":["B n r accidental deletion.en"],"tags":[]},{"location":"backup_restore/b_n_r-accidental_deletion.en/#sogo","level":3,"title":"SOGo","text":"<p>We automatically create daily backups (24h interval starting from running up -d) in <code>/var/lib/docker/volumes/mailcowdockerized_sogo-userdata-backup-vol-1/_data/</code>.</p> <p>Make sure the user you want to restore exists in your mailcow. Re-create them if they are missing.</p> <p>Copy the file named after the user you want to restore to <code>__MAILCOW_DIRECTORY__/data/conf/sogo</code>.</p> <ol> <li> <p>Copy the backup: <code>cp /var/lib/docker/volumes/mailcowdockerized_sogo-userdata-backup-vol-1/_data/restoreme@example.org __MAILCOW_DIRECTORY__/data/conf/sogo</code></p> </li> <li> <p>Run the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec -u sogo sogo-mailcow sogo-tool restore -F ALL /etc/sogo restoreme@example.org\n</code></pre> <pre><code>docker-compose exec -u sogo sogo-mailcow sogo-tool restore -F ALL /etc/sogo restoreme@example.org\n</code></pre> <p>Run <code>sogo-tool</code> without parameters to check for possible restore options.</p> </li> <li> <p>Delete the copied backup by running <code>rm __MAILCOW_DIRECTORY__/data/conf/sogo</code></p> </li> <li> <p>Restart SOGo and Memcached: </p> </li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart sogo-mailcow memcached-mailcow\n</code></pre> <pre><code>docker-compose restart sogo-mailcow memcached-mailcow\n</code></pre>","path":["B n r accidental deletion.en"],"tags":[]},{"location":"backup_restore/b_n_r-accidental_deletion.en/#mail","level":3,"title":"Mail","text":"<p>In case of an accidental deletion of a mailbox, you will be able to recover for (by default) 5 days. This depends on the <code>MAILDIR_GC_TIME</code> parameter in <code>mailcow.conf</code>.</p> <p>A deleted mailbox is copied in its encrypted form to <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/_garbage</code>.</p> <p>The folder inside <code>_garbage</code> follows the structure <code>[timestamp]_[domain_sanitized][user_sanitized]</code>, for example <code>1629109708_exampleorgtest</code> in case of test@example.org deleted on 1629109708.</p> <p>To restore make sure you are actually restoring to the same mailcow it was deleted from or you use the same encryption keys in <code>crypt-vol-1</code>.</p> <p>Make sure the user you want to restore exists in your mailcow. Re-create them if they are missing.</p> <p>Copy the folders from <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/_garbage/[timestamp]_[domain_sanitized][user_sanitized]</code> back to <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/[domain]/[user]</code> and resync the folder and recalc the quota:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm force-resync -u restoreme@example.net '*'\ndocker compose exec dovecot-mailcow doveadm quota recalc -u restoreme@example.net\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm force-resync -u restoreme@example.net '*'\ndocker-compose exec dovecot-mailcow doveadm quota recalc -u restoreme@example.net\n</code></pre>","path":["B n r accidental deletion.en"],"tags":[]},{"location":"backup_restore/b_n_r-backup.de/","level":1,"title":"Backup-Strategie mit rsync und mailcow Backup-Skript","text":"","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"backup_restore/b_n_r-backup.de/#sicherung","level":3,"title":"Sicherung","text":"","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"backup_restore/b_n_r-backup.de/#anleitung","level":4,"title":"Anleitung","text":"<p>Sie können das mitgelieferte Skript <code>helper-scripts/backup_and_restore.sh</code> verwenden, um mailcow automatisch zu sichern.</p> <p>Achtung</p> <p>Bitte kopieren Sie dieses Skript nicht an einen anderen Ort.</p> <p>Um ein Backup zu starten, geben Sie \"backup\" als ersten Parameter an und entweder eine oder mehrere zu sichernde Komponenten als folgende Parameter. Sie können auch \"all\" als zweiten Parameter verwenden, um alle Komponenten zu sichern. Fügen Sie <code>--delete-days n</code> an, um Sicherungen zu löschen, die älter als n Tage sind.</p> <pre><code># Syntax:\n# ./helper-scripts/backup_and_restore.sh backup (vmail|crypt|redis|rspamd|postfix|mysql|all|--delete-days)\n\n# Alles sichern, Sicherungen älter als 3 Tage löschen\n./helper-scripts/backup_and_restore.sh backup all --delete-days 3\n\n# vmail-, crypt- und mysql-Daten sichern, Sicherungen löschen, die älter als 30 Tage sind\n./helper-scripts/backup_and_restore.sh backup vmail crypt mysql --delete-days 30\n\n# vmail sichern\n./helper-scripts/backup_and_restore.sh backup vmail\n</code></pre>","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"backup_restore/b_n_r-backup.de/#variablen-fur-backuprestore-skript","level":4,"title":"Variablen für Backup/Restore Skript","text":"","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"backup_restore/b_n_r-backup.de/#multithreading","level":5,"title":"Multithreading","text":"<p>Seit dem 2022-10 Update ist es möglich das Skript mit Multithreading Support laufen zu lassen. Dies lässt sich sowohl für Backups aber auch für Restores nutzen.</p> <p>Um das Backup/den Restore mit Multithreading zu starten muss <code>THREADS</code> als Umgebungsvariable vor dem Befehl zum starten hinzugefügt werden.</p> <p><pre><code>THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n</code></pre> Die Anzahl hinter dem <code>=</code> Zeichen gibt dabei dann die Thread Anzahl an. Nehmen Sie bitte immer ihre Kernanzahl -2 um mailcow selber noch genug CPU Leistung zu lassen.</p>","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"backup_restore/b_n_r-backup.de/#backup-pfad","level":5,"title":"Backup Pfad","text":"<p>Das Skript wird Sie nach einem Speicherort für die Sicherung fragen. Innerhalb dieses Speicherortes wird es Ordner im Format \"mailcow_DATE\" erstellen. Sie sollten diese Ordner nicht umbenennen, um den Wiederherstellungsprozess nicht zu stören.</p> <p>Um ein Backup unbeaufsichtigt durchzuführen, definieren Sie MAILCOW_BACKUP_LOCATION als Umgebungsvariable, bevor Sie das Skript starten:</p> <pre><code>MAILCOW_BACKUP_LOCATION=/opt/backup /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n</code></pre> <p>Tipp</p> <pre><code>Beide oben genannten Variablen können auch kombiniert werden! Bsp:\n```\nMAILCOW_BACKUP_LOCATION=/opt/backup THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n```\n</code></pre>","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"backup_restore/b_n_r-backup.de/#cronjob","level":4,"title":"Cronjob","text":"<p>Sie können das Backup-Skript regelmäßig über einen Cronjob laufen lassen. Stellen Sie sicher, dass <code>BACKUP_LOCATION</code> existiert:</p> <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n5 4 * * * cd /opt/mailcow-dockerized/; MAILCOW_BACKUP_LOCATION=/mnt/mailcow_backups /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup mysql crypt redis --delete-days 3\n</code></pre> <p>Standardmäßig sendet Cron das komplette Ergebnis jeder Backup-Operation per E-Mail. Wenn Sie möchten, dass cron nur im Fehlerfall (Exit-Code ungleich Null) eine E-Mail sendet, können Sie den folgenden Ausschnitt verwenden. Die Pfade müssen entsprechend Ihrer Einrichtung angepasst werden (dieses Skript ist ein Beitrag eines Benutzers).</p> <p>Das folgende Skript kann in <code>/etc/cron.daily/mailcow-backup</code> platziert werden - vergessen Sie nicht, es mit <code>chmod +x</code> als ausführbar zu markieren:</p> <pre><code>#!/bin/sh\n\n# Backup mailcow data\n# https://docs.mailcow.email/b_n_r_backup/\n\nset -e\n\nOUT=\"$(mktemp)\"\nexport MAILCOW_BACKUP_LOCATION=\"/opt/backup\"\nSCRIPT=\"/opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh\"\nPARAMETERS=\"backup all\"\nOPTIONS=\"--delete-days 30\"\n\n# run command\nset +e\n\"${SCRIPT}\" ${PARAMETERS} ${OPTIONS} 2&gt;&amp;1 &gt; \"$OUT\"\nRESULT=$?\n\nif [ $RESULT -ne 0 ]\n    then\n            echo \"${SCRIPT} ${PARAMETERS} ${OPTIONS} encounters an error:\"\n            echo \"RESULT=$RESULT\"\n            echo \"STDOUT / STDERR:\"\n            cat \"$OUT\"\nfi\n</code></pre>","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"backup_restore/b_n_r-backup.de/#backup-strategie-mit-rsync-und-mailcow-backup-skript","level":1,"title":"Backup-Strategie mit rsync und mailcow Backup-Skript","text":"<p>Erstellen Sie das Zielverzeichnis für mailcows Hilfsskript: <pre><code>mkdir -p /external_share/backups/backup_script\n</code></pre></p> <p>Cronjobs erstellen: <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n25 1 * * * rsync -aH --delete /opt/mailcow-dockerized /external_share/backups/mailcow-dockerized\n40 2 * * * rsync -aH --delete /var/lib/docker/volumes /external_share/backups/var_lib_docker_volumes\n5 4 * * * cd /opt/mailcow-dockerized/; BACKUP_LOCATION=/external_share/backups/backup_script /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup mysql crypt redis --delete-days 3\n# Wenn Sie wollen, benutzen Sie das Werkzeug acl, um die Berechtigungen einiger/aller Ordner/Dateien zu sichern: getfacl -Rn /path\n</code></pre></p> <p>Am Zielort (in diesem Fall <code>/external_share/backups</code>) möchten Sie vielleicht Snapshot-Möglichkeiten haben (ZFS, Btrfs usw.). Machen Sie täglich einen Snapshot und bewahren Sie ihn für n Tage auf, um ein konsistentes Backup zu erhalten. Führen Sie kein rsync auf eine Samba-Freigabe durch, Sie müssen die richtigen Berechtigungen behalten!</p> <p>Zum Wiederherstellen müssen Sie rsync einfach in umgekehrter Richtung ausführen und Docker neu starten, um die Volumes erneut zu lesen. Führen Sie folgende Befehle aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose pull\ndocker compose up -d\n</code></pre> <pre><code>docker-compose pull\ndocker-compose up -d\n</code></pre> <p>Wenn Sie Glück haben, können Redis und MariaDB die inkonsistenten Datenbanken automatisch reparieren (wenn sie inkonsistent sind). Im Falle einer beschädigten Datenbank müssen Sie das Hilfsskript verwenden, um die inkonsistenten Elemente wiederherzustellen. Wenn die Wiederherstellung fehlschlägt, versuchen Sie, die Sicherungen zu extrahieren und die Dateien manuell zurück zu kopieren. Behalten Sie die Dateiberechtigungen bei!</p>","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"backup_restore/b_n_r-backup.en/","level":1,"title":"Backup strategy with rsync and mailcow backup script","text":"","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"backup_restore/b_n_r-backup.en/#backup","level":3,"title":"Backup","text":"","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"backup_restore/b_n_r-backup.en/#manual","level":4,"title":"Manual","text":"<p>You can use the provided script <code>helper-scripts/backup_and_restore.sh</code> to backup mailcow automatically.</p> <p>Danger</p> <p>Please do not copy this script to another location.</p> <p>To run a backup, write \"backup\" as first parameter and either one or more components to backup as following parameters. You can also use \"all\" as second parameter to backup all components. Append <code>--delete-days n</code> to delete backups older than n days.</p> <pre><code># Syntax:\n# ./helper-scripts/backup_and_restore.sh backup (vmail|crypt|redis|rspamd|postfix|mysql|all|--delete-days)\n\n# Backup all, delete backups older than 3 days\n./helper-scripts/backup_and_restore.sh backup all --delete-days 3\n\n# Backup vmail, crypt and mysql data, delete backups older than 30 days\n./helper-scripts/backup_and_restore.sh backup vmail crypt mysql --delete-days 30\n\n# Backup vmail\n./helper-scripts/backup_and_restore.sh backup vmail\n</code></pre>","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"backup_restore/b_n_r-backup.en/#variables-for-backuprestore-script","level":4,"title":"Variables for backup/restore script","text":"","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"backup_restore/b_n_r-backup.en/#multithreading","level":5,"title":"Multithreading","text":"<p>With the 2022-10 update it is possible to run the script with multithreading support. This can be used for backups as well as for restores.</p> <p>To start the backup/restore with multithreading you have to add <code>THREADS</code> as an environment variable in front of the command to execute the script.</p> <p><pre><code>THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n</code></pre> The number after the <code>=</code> character indicates the number of threads. Please keep your core count -2 to leave enough CPU power for mailcow itself.</p>","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"backup_restore/b_n_r-backup.en/#backup-path","level":5,"title":"Backup path","text":"<p>The script will ask you for a backup location. Inside of this location it will create folders in the format \"mailcow_DATE\". You should not rename those folders to not break the restore process.</p> <p>To run a backup unattended, define MAILCOW_BACKUP_LOCATION as environment variable before starting the script:</p> <pre><code>MAILCOW_BACKUP_LOCATION=/opt/backup /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n</code></pre> <p>Tip</p> <pre><code>Both variables mentioned above can also be combined! Ex:\n```\nMAILCOW_BACKUP_LOCATION=/opt/backup THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n```\n</code></pre>","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"backup_restore/b_n_r-backup.en/#cronjob","level":4,"title":"Cronjob","text":"<p>You can run the backup script regularly via cronjob. Make sure <code>BACKUP_LOCATION</code> exists:</p> <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n5 4 * * * cd /opt/mailcow-dockerized/; MAILCOW_BACKUP_LOCATION=/mnt/mailcow_backups /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup mysql crypt redis --delete-days 3\n</code></pre> <p>Per default cron sends the full result of each backup operation by email. If you want cron to only mail on error (non-zero exit code) you may want to use the following snippet. Pathes need to be modified according to your setup (this script is a user contribution).</p> <p>This following script may be placed in <code>/etc/cron.daily/mailcow-backup</code> - do not forget to mark it as executable via <code>chmod +x</code>:</p> <pre><code>#!/bin/sh\n\n# Backup mailcow data\n# https://docs.mailcow.email/backup_restore/b_n_r-backup/\n\nset -e\n\nOUT=\"$(mktemp)\"\nexport MAILCOW_BACKUP_LOCATION=\"/opt/backup\"\nSCRIPT=\"/opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh\"\nPARAMETERS=\"backup all\"\nOPTIONS=\"--delete-days 30\"\n\n# run command\nset +e\n\"${SCRIPT}\" ${PARAMETERS} ${OPTIONS} 2&gt;&amp;1 &gt; \"$OUT\"\nRESULT=$?\n\nif [ $RESULT -ne 0 ]\n    then\n            echo \"${SCRIPT} ${PARAMETERS} ${OPTIONS} encounters an error:\"\n            echo \"RESULT=$RESULT\"\n            echo \"STDOUT / STDERR:\"\n            cat \"$OUT\"\nfi\n</code></pre>","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"backup_restore/b_n_r-backup.en/#backup-strategy-with-rsync-and-mailcow-backup-script","level":1,"title":"Backup strategy with rsync and mailcow backup script","text":"<p>Create the destination directory for mailcows helper script: <pre><code>mkdir -p /external_share/backups/backup_script\n</code></pre></p> <p>Create cronjobs: <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n25 1 * * * rsync -aH --delete /opt/mailcow-dockerized /external_share/backups/mailcow-dockerized\n40 2 * * * rsync -aH --delete /var/lib/docker/volumes /external_share/backups/var_lib_docker_volumes\n5 4 * * * cd /opt/mailcow-dockerized/; BACKUP_LOCATION=/external_share/backups/backup_script /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup mysql crypt redis --delete-days 3\n# If you want to, use the acl util to backup permissions of some/all folders/files: getfacl -Rn /path\n</code></pre></p> <p>On the destination (in this case <code>/external_share/backups</code>) you may want to have snapshot capabilities (ZFS, Btrfs etc.). Snapshot daily and keep for n days for a consistent backup. Do not rsync to a Samba share, you need to keep the correct permissions!</p> <p>To restore you'd simply need to run rsync the other way round and restart Docker to re-read the volumes. Run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose pull\ndocker compose up -d\n</code></pre> <pre><code>docker-compose pull\ndocker-compose up -d\n</code></pre> <p>If you are lucky Redis and MariaDB can automatically fix the inconsistent databases (if they are inconsistent). In case of a corrupted database you'd need to use the helper script to restore the inconsistent elements. If a restore fails, try to extract the backups and copy the files back manually. Keep the file permissions!</p>","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"backup_restore/b_n_r-backup_restore-maildir.de/","level":1,"title":"B n r backup restore maildir.de","text":"","path":["B n r backup restore maildir.de"],"tags":[]},{"location":"backup_restore/b_n_r-backup_restore-maildir.de/#sicherung","level":3,"title":"Sicherung","text":"<p>Diese Zeile sichert das vmail-Verzeichnis in eine Datei backup_vmail.tar.gz im mailcow-Root-Verzeichnis:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /pfad/zu/mailcow-dockerized\ndocker run --rm -i -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar cvfz /backup/backup_vmail.tar.gz /vmail\n</code></pre> <pre><code>cd /pfad/zu/mailcow-dockerized\ndocker run --rm -i -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker-compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar cvfz /backup/backup_vmail.tar.gz /vmail\n</code></pre> <p>Sie können den Pfad ändern, indem Sie ${PWD} (das dem aktuellen Verzeichnis entspricht) zu einem beliebigen Pfad ändern, auf den Sie Schreibzugriff haben. Setzen Sie den Dateinamen <code>backup_vmail.tar.gz</code> auf einen beliebigen Namen, aber lassen Sie den Pfad so wie er ist. Beispiel: <code>[...] tar cvfz /backup/mein_eigener_dateiname_.tar.gz</code></p>","path":["B n r backup restore maildir.de"],"tags":[]},{"location":"backup_restore/b_n_r-backup_restore-maildir.de/#wiederherstellen","level":3,"title":"Wiederherstellen","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /pfad/zu/mailcow-dockerized\ndocker run --rm -it -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar xvfz /backup/backup_vmail.tar.gz\n</code></pre> <pre><code>cd /pfad/zu/mailcow-dockerized\ndocker run --rm -it -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker-compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar xvfz /backup/backup_vmail.tar.gz\n</code></pre>","path":["B n r backup restore maildir.de"],"tags":[]},{"location":"backup_restore/b_n_r-backup_restore-maildir.en/","level":1,"title":"B n r backup restore maildir.en","text":"","path":["B n r backup restore maildir.en"],"tags":[]},{"location":"backup_restore/b_n_r-backup_restore-maildir.en/#backup","level":3,"title":"Backup","text":"<p>This line backups the vmail directory to a file backup_vmail.tar.gz in the mailcow root directory:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /path/to/mailcow-dockerized\ndocker run --rm -i -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar cvfz /backup/backup_vmail.tar.gz /vmail\n</code></pre> <pre><code>cd /path/to/mailcow-dockerized\ndocker run --rm -i -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker-compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar cvfz /backup/backup_vmail.tar.gz /vmail\n</code></pre> <p>You can change the path by adjusting ${PWD} (which equals to the current directory) to any path you have write-access to. Set the filename <code>backup_vmail.tar.gz</code> to any custom name, but leave the path as it is. Example: <code>[...] tar cvfz /backup/my_own_filename_.tar.gz</code></p>","path":["B n r backup restore maildir.en"],"tags":[]},{"location":"backup_restore/b_n_r-backup_restore-maildir.en/#restore","level":3,"title":"Restore","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /path/to/mailcow-dockerized\ndocker run --rm -it -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar xvfz /backup/backup_vmail.tar.gz\n</code></pre> <pre><code>cd /path/to/mailcow-dockerized\ndocker run --rm -it -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker-compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar xvfz /backup/backup_vmail.tar.gz\n</code></pre>","path":["B n r backup restore maildir.en"],"tags":[]},{"location":"backup_restore/b_n_r-backup_restore-mysql.de/","level":1,"title":"B n r backup restore mysql.de","text":"","path":["B n r backup restore mysql.de"],"tags":[]},{"location":"backup_restore/b_n_r-backup_restore-mysql.de/#sicherung","level":2,"title":"Sicherung","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /pfad/zu/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date +\"%Y%m%d_%H%M%S\")\ndocker compose exec -T mysql-mailcow mysqldump --default-character-set=utf8mb4 -u${DBUSER} -p${DBPASS} ${DBNAME} &gt; backup_${DBNAME}_${DATE}.sql\n</code></pre> <pre><code>cd /pfad/zu/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date +\"%Y%m%d_%H%M%S\")\ndocker-compose exec -T mysql-mailcow mysqldump --default-character-set=utf8mb4 -u${DBUSER} -p${DBPASS} ${DBNAME} &gt; backup_${DBNAME}_${DATE}.sql\n</code></pre>","path":["B n r backup restore mysql.de"],"tags":[]},{"location":"backup_restore/b_n_r-backup_restore-mysql.de/#wiederherstellen","level":2,"title":"Wiederherstellen","text":"<p>Warnung</p> docker compose (Plugin)docker-compose (Standalone) <p>Sie sollten den SQL-Dump ohne <code>docker compose</code> umleiten, um Parsing-Fehler zu vermeiden.</p> <p>Sie sollten den SQL-Dump ohne <code>docker-compose</code> umleiten, um Parsing-Fehler zu vermeiden.</p> <pre><code>cd /pfad/zu/mailcow-dockerized\nsource mailcow.conf\ndocker exec -i $(docker compose ps -q mysql-mailcow) mysql -u${DBUSER} -p${DBPASS} ${DBNAME} &lt; backup_file.sql\n</code></pre>","path":["B n r backup restore mysql.de"],"tags":[]},{"location":"backup_restore/b_n_r-backup_restore-mysql.en/","level":1,"title":"B n r backup restore mysql.en","text":"","path":["B n r backup restore mysql.en"],"tags":[]},{"location":"backup_restore/b_n_r-backup_restore-mysql.en/#backup","level":2,"title":"Backup","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /path/to/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date +\"%Y%m%d_%H%M%S\")\ndocker compose exec -T mysql-mailcow mysqldump --default-character-set=utf8mb4 -u${DBUSER} -p${DBPASS} ${DBNAME} &gt; backup_${DBNAME}_${DATE}.sql\n</code></pre> <pre><code>cd /path/to/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date +\"%Y%m%d_%H%M%S\")\ndocker-compose exec -T mysql-mailcow mysqldump --default-character-set=utf8mb4 -u${DBUSER} -p${DBPASS} ${DBNAME} &gt; backup_${DBNAME}_${DATE}.sql\n</code></pre>","path":["B n r backup restore mysql.en"],"tags":[]},{"location":"backup_restore/b_n_r-backup_restore-mysql.en/#restore","level":2,"title":"Restore","text":"<p>Warning</p> docker compose (Plugin)docker-compose (Standalone) <p>You should redirect the SQL dump without <code>docker compose</code> to prevent parsing errors.</p> <p>You should redirect the SQL dump without <code>docker-compose</code> to prevent parsing errors.</p> <pre><code>cd /path/to/mailcow-dockerized\nsource mailcow.conf\ndocker exec -i $(docker compose ps -q mysql-mailcow) mysql -u${DBUSER} -p${DBPASS} ${DBNAME} &lt; backup_file.sql\n</code></pre>","path":["B n r backup restore mysql.en"],"tags":[]},{"location":"backup_restore/b_n_r-coldstandby.de/","level":1,"title":"Cold-standby-Backup","text":"<p>mailcow bietet eine einfache Möglichkeit, eine konsistente Kopie von sich selbst zu erstellen, die per rsync an einen entfernten Ort ohne Ausfallzeit übertragen werden kann.</p> <p>Dies kann auch verwendet werden, um Ihre mailcow auf einen neuen Server zu übertragen.</p>","path":["Cold-standby-Backup"],"tags":[]},{"location":"backup_restore/b_n_r-coldstandby.de/#das-sollten-sie-wissen","level":2,"title":"Das sollten Sie wissen","text":"<p>Das bereitgestellte Skript funktioniert auf Standardinstallationen.</p> <p>Es kann versagen, wenn Sie nicht unterstützte Volume Overrides verwenden. Wir unterstützen das nicht und wir werden keine Hacks einbauen, die das unterstützen. Bitte erstellen und pflegen Sie einen Fork, wenn Sie Ihre Änderungen beibehalten wollen.</p> <p>Das Skript wird die gleichen Pfade wie Ihre Standard-mailcow-Installation verwenden. Das ist das mailcow-Basisverzeichnis - für die meisten Nutzer <code>/opt/mailcow-dockerized</code> - sowie die Mountpoints.</p> <p>Um die Pfade Ihrer Quellvolumes zu finden, verwenden wir <code>docker inspect</code> und lesen das Zielverzeichnis jedes Volumes, das mit Ihrem mailcow compose Projekt verbunden ist. Das bedeutet, dass wir auch Volumes übertragen, die Sie in einer Override-Datei hinzugefügt haben. Lokale Bind-Mounts können funktionieren, müssen aber nicht.</p> <p>Das Skript verwendet rsync mit dem <code>--delete</code> Flag. Das Ziel wird eine exakte Kopie der Quelle sein.</p> <p><code>mariabackup</code> wird verwendet, um eine konsistente Kopie des SQL-Datenverzeichnisses zu erstellen.</p> <p>Nach dem Rsync der Daten führen wir folgenden Befehl aus (anhand der gesetzten docker compose Version in der mailcow.conf) und entfernen alte Image-Tags aus dem Ziel:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose pull\n</code></pre> <pre><code>docker-compose pull\n</code></pre> <p>Ihre Quelle wird zu keinem Zeitpunkt verändert.</p> <p>Sie sollten sicherstellen, dass Sie die gleiche <code>/etc/docker/daemon.json</code> auf dem entfernten Ziel verwenden.</p> <p>Sie sollten keine Festplatten-Snapshots (z. B. über ZFS, LVM usw.) auf dem Ziel ausführen, während dieses Skript ausgeführt wird.</p> <p>Die Versionierung ist nicht Teil dieses Skripts, wir verlassen uns auf das Ziel (Snapshots oder Backups). Sie können dafür auch jedes andere Tool verwenden.</p>","path":["Cold-standby-Backup"],"tags":[]},{"location":"backup_restore/b_n_r-coldstandby.de/#vorbereiten","level":2,"title":"Vorbereiten","text":"<p>Sie benötigen ein SSH-fähiges Ziel und eine Schlüsseldatei, um sich mit diesem Ziel zu verbinden. Der Schlüssel sollte nicht durch ein Passwort geschützt sein, damit das Skript unbeaufsichtigt arbeiten kann.</p> <p>In Ihrem mailcow-Basisverzeichnis, z.B. <code>/opt/mailcow-dockerized</code>, finden Sie eine Datei <code>create_cold_standby.sh</code>.</p> <p>Bearbeiten Sie diese Datei und ändern Sie die exportierten Variablen:</p> <pre><code>export REMOTE_SSH_KEY=/pfad/zum/keyfile\nexport REMOTE_SSH_PORT=22\nexport REMOTE_SSH_HOST=mailcow-backup.host.name\n</code></pre> <p>Der Schlüssel muss im Besitz von root sein und darf nur von diesem gelesen werden können.</p> <p>Sowohl die Quelle als auch das Ziel benötigen <code>rsync</code> &gt;= v3.1.0. Das Ziel muss über Docker und docker compose v2 verfügen.</p> <p>Das Skript wird Fehler automatisch erkennen und sich beenden.</p> <p>Sie können die Verbindung testen, indem Sie <code>ssh mailcow-backup.host.name -p22 -i /path/to/keyfile</code> ausführen.</p> Wichtig für den Wechsel auf eine andere Architektur <p>Wenn Sie planen mit dem Cold Standby Skript eine Migration von x86 auf ARM64 bzw. umgekehrt zu machen, lassen Sie das Skript einfach normal laufen. Das Skript wird automatisch erkennen, ob es unterschiede zwischen der Quelle und dem Ziel im Bezug auf die Architektur gibt und sich dementsprechend verhalten und betroffene Volumes im Sync auslassen.</p> <p>Dies hat den Hintergrund, dass Rspamd Regexp Einträge von unseren Konfigurationen auf die entsprechende Plattform kompiliert und bei einem Plattform Wechsel diese Cache Dateien nicht gelesen werden können. Rspamd würde daraufhin abstürzen und eine sinnvolle Nutzung mailcow's damit nicht ermöglichen. Deswegen wird das <code>rspamd-vol-1</code> (Rspamd Volume) im Cold Standby ausgelassen.</p> <p>Keine Sorge! Rspamd wird trotzdem nach der Migration korrekt funktionieren, da diese Cache Dateien selbstständig für die neue Plattform generiert werden.</p>","path":["Cold-standby-Backup"],"tags":[]},{"location":"backup_restore/b_n_r-coldstandby.de/#backup-und-aktualisierung-des-cold-standby","level":2,"title":"Backup und Aktualisierung des Cold-Standby","text":"<p>Starten Sie das erste Backup, dies kann je nach Verbindung eine Weile dauern:</p> <pre><code>bash /opt/mailcow-dockerized/create_cold_standby.sh\n</code></pre> <p>Das war einfach, nicht wahr?</p> <p>Das Aktualisieren des Cold-Standby ist genauso einfach:</p> <pre><code>bash /opt/mailcow-dockerized/create_cold_standby.sh\n</code></pre> <p>Es ist derselbe Befehl.</p>","path":["Cold-standby-Backup"],"tags":[]},{"location":"backup_restore/b_n_r-coldstandby.de/#automatisierte-backups-mit-cron","level":2,"title":"Automatisierte Backups mit cron","text":"<p>Stellen Sie zunächst sicher, dass der <code>cron</code> Dienst aktiviert ist und läuft:</p> <pre><code>systemctl enable cron.service &amp;&amp; systemctl start cron.service\n</code></pre> <p>Um die Backups auf dem Cold-Standby-Server zu automatisieren, können Sie einen Cron-Job verwenden. Um die Cron-Jobs für den Root-Benutzer zu bearbeiten, führen Sie aus:</p> <pre><code>crontab -e\n</code></pre> <p>Fügen Sie die folgenden Zeilen hinzu, um den Cold-Standby-Server täglich um 03:00 Uhr zu synchronisieren. In diesem Beispiel werden Fehler der letzten Ausführung in einer Datei protokolliert.</p> <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n\n0 3 * * * bash /opt/mailcow-dockerized/create_cold_standby.sh 2&gt; /var/log/mailcow-coldstandby-sync.log\n</code></pre> <p>Wenn korrekt gespeichert, sollte der Cron-Job durch folgende Eingabe angezeigt werden:</p> <pre><code>crontab -l\n</code></pre>","path":["Cold-standby-Backup"],"tags":[]},{"location":"backup_restore/b_n_r-coldstandby.en/","level":1,"title":"Cold-standby backup","text":"<p>mailcow offers an easy way to create a consistent copy of itself to be rsync'ed to a remote location without downtime.</p> <p>This may also be used to transfer your mailcow to a new server.</p>","path":["Cold-standby backup"],"tags":[]},{"location":"backup_restore/b_n_r-coldstandby.en/#you-should-know","level":2,"title":"You should know","text":"<p>The provided script will work on default installations.</p> <p>It may break when you use unsupported volume overrides. We don't support that and we will not include hacks to support that. Please run and maintain a fork if you plan to keep your changes.</p> <p>The script will use the same paths as your default mailcow installation. That is the mailcow base directory - for most users <code>/opt/mailcow-dockerized</code> - as well as the mountpoints.</p> <p>To find the paths of your source volumes we use <code>docker inspect</code> and read the destination directory of every volume related to your mailcow compose project. This means we will also transfer volumes you may have added in an override file. Local bind mounts may or may not work.</p> <p>The script uses rsync with the <code>--delete</code> flag. The destination will be an exact copy of the source.</p> <p><code>mariabackup</code> is used to create a consistent copy of the SQL data directory.</p> <p>After rsync'ing the data we will run the command below (depending on your set  docker compose type in mailcow.conf) and remove old image tags from the destination:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose pull\n</code></pre> <pre><code>docker-compose pull\n</code></pre> <p>Your source will not be changed at any time.</p> <p>You may want to make sure to use the same <code>/etc/docker/daemon.json</code> on the remote target.</p> <p>You should not run disk snapshots (e.g. via ZFS, LVM etc.) on the target at the very same time as this script is run.</p> <p>Versioning is not part of this script, we rely on the destination (snapshots or backups). You may also want to use any other tool for that.</p>","path":["Cold-standby backup"],"tags":[]},{"location":"backup_restore/b_n_r-coldstandby.en/#prepare","level":2,"title":"Prepare","text":"<p>You will need an SSH-enabled destination and a keyfile to connect to said destination. The key should not be protected by a password for the script to work unattended.</p> <p>In your mailcow base directory, e.g. <code>/opt/mailcow-dockerized</code> you will find a file <code>create_cold_standby.sh</code>.</p> <p>Edit this file and change the exported variables:</p> <pre><code>export REMOTE_SSH_KEY=/path/to/keyfile\nexport REMOTE_SSH_PORT=22\nexport REMOTE_SSH_HOST=mailcow-backup.host.name\n</code></pre> <p>The key must be owned and readable by root only.</p> <p>Both the source and destination require <code>rsync</code> &gt;= v3.1.0. The destination must have Docker and docker compose v2 available.</p> <p>The script will detect errors automatically and exit.</p> <p>You may want to test the connection by running <code>ssh mailcow-backup.host.name -p22 -i /path/to/keyfile</code>.</p> Important for switching to a different architecture <p>If you plan to use the Cold Standby script to migrate from x86 to ARM64 or vice versa, simply let the script run normally. The script will automatically recognize whether there are differences between the source and the target in terms of architecture and will behave accordingly and omit affected volumes from the sync.</p> <p>The reason for this is that Rspamd compiles regexp entries from our configurations to the corresponding platform and these cache files cannot be read when changing platforms. Rspamd would then crash and make it impossible to use mailcow in a meaningful way. Therefore the <code>rspamd-vol-1</code> (Rspamd volume) will be ommited during the usage of the Cold-standby script.</p> <p>Don't worry! Rspamd will still work correctly after the migration as it generates these cache files automatically for the new platform.</p>","path":["Cold-standby backup"],"tags":[]},{"location":"backup_restore/b_n_r-coldstandby.en/#backup-and-refresh-the-cold-standby","level":2,"title":"Backup and refresh the cold-standby","text":"<p>Run the first backup, this may take a while depending on the connection:</p> <pre><code>bash /opt/mailcow-dockerized/create_cold_standby.sh\n</code></pre> <p>That was easy, wasn't it?</p> <p>Updating your cold-standby is just as easy:</p> <pre><code>bash /opt/mailcow-dockerized/create_cold_standby.sh\n</code></pre> <p>It's the same command.</p>","path":["Cold-standby backup"],"tags":[]},{"location":"backup_restore/b_n_r-coldstandby.en/#automated-backups-with-cron","level":2,"title":"Automated backups with cron","text":"<p>First make sure that the <code>cron</code> service is enabled and running:</p> <pre><code>systemctl enable cron.service &amp;&amp; systemctl start cron.service\n</code></pre> <p>To automate the backups to the cold-standby server you can use a cron job. To edit the cron jobs for the root user run:</p> <pre><code>crontab -e\n</code></pre> <p>Add the following lines to synchronize the cold standby server daily at 03:00. In this example errors of the last execution are logged into a file.</p> <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n\n0 3 * * * bash /opt/mailcow-dockerized/create_cold_standby.sh 2&gt; /var/log/mailcow-coldstandby-sync.log\n</code></pre> <p>If saved correctly, the cron job should be shown by typing:</p> <pre><code>crontab -l\n</code></pre>","path":["Cold-standby backup"],"tags":[]},{"location":"backup_restore/b_n_r-restore.de/","level":1,"title":"B n r restore.de","text":"","path":["B n r restore.de"],"tags":[]},{"location":"backup_restore/b_n_r-restore.de/#wiederherstellung","level":3,"title":"Wiederherstellung","text":"","path":["B n r restore.de"],"tags":[]},{"location":"backup_restore/b_n_r-restore.de/#variablen-fur-backuprestore-skript","level":4,"title":"Variablen für Backup/Restore Skript","text":"","path":["B n r restore.de"],"tags":[]},{"location":"backup_restore/b_n_r-restore.de/#multithreading","level":5,"title":"Multithreading","text":"<p>Seit dem 2022-10 Update ist es möglich das Skript mit Multithreading Support laufen zu lassen. Dies lässt sich sowohl für Backups aber auch für Restores nutzen.</p> <p>Um das Backup/den Restore mit Multithreading zu starten muss <code>THREADS</code> als Umgebungsvariable vor dem Befehl zum starten hinzugefügt werden.</p> <p><pre><code>THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh restore\n</code></pre> Die Anzahl hinter dem <code>=</code> Zeichen gibt dabei dann die Thread Anzahl an. Nehmen Sie bitte immer ihre Kernanzahl -2 um mailcow selber noch genug CPU Leistung zu lassen.</p>","path":["B n r restore.de"],"tags":[]},{"location":"backup_restore/b_n_r-restore.de/#backup-pfad","level":5,"title":"Backup Pfad","text":"<p>Das Skript wird Sie nach einem Speicherort für die Sicherung fragen. Innerhalb dieses Speicherortes wird es Ordner im Format \"mailcow_DATE\" erstellen. Sie sollten diese Ordner nicht umbenennen, um den Wiederherstellungsprozess nicht zu stören.</p> <p>Um ein Backup unbeaufsichtigt durchzuführen, definieren Sie MAILCOW_BACKUP_LOCATION als Umgebungsvariable, bevor Sie das Skript starten:</p> <pre><code>MAILCOW_BACKUP_LOCATION=/opt/backup /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n</code></pre> <p>Tipp</p> <p>Beide oben genannten Variablen können auch kombiniert werden! Bsp: <pre><code>MAILCOW_BACKUP_LOCATION=/opt/backup THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh restore\n</code></pre></p>","path":["B n r restore.de"],"tags":[]},{"location":"backup_restore/b_n_r-restore.de/#wiederherstellung-der-daten","level":4,"title":"Wiederherstellung der Daten","text":"<p>Achtung</p> <p>Bitte kopieren Sie dieses Skript nicht an einen anderen Ort.</p> <p>Wichtig</p> <p>Um ein Backup auf ein neues System wiederherzustellen muss mailcow initialisiert sein und gestartet sein! Installieren Sie also mailcow nach der Anleitung neu und warten Sie mit der Wiederherstellung so lange, bis mailcow in einem leeren Zustand läuft.</p> <p>Achtung für ältere Installationen</p> <p>Bitte schauen Sie VOR der Wiederherstellung Ihres mailcow Systemes auf einen neuen Server und einem sauberen mailcow-dockerized Ordner, ob in Ihrer mailcow.conf der Wert <code>MAILDIR_SUB</code> gesetzt ist. Falls dieser nicht gesetzt ist, so setzen Sie diesen auch bitte in Ihrer neuen mailcow nicht, bzw. entfernen diesen, da sonst KEINE E-Mails angezeigt werden. Dovecot lädt E-Mails aus dem besagtem Unterordner des Maildir Volumes unter <code>$DOCKER_VOLUME_PFAD/mailcowdockerized_vmail-vol-1</code> und bei Änderung im Vergleich zum Ursprungszustand sind dort keine Mails vorhanden.</p> <p>Um eine Wiederherstellung durchzuführen, starten Sie mailcow, verwenden Sie das Skript mit \"restore\" als ersten Parameter.</p> <pre><code># Syntax:\n# ./helper-scripts/backup_and_restore.sh restore\n</code></pre> <p>Das Skript wird Sie nach einem Speicherort für die Sicherung der mailcow_DATE-Ordner fragen:</p> <pre><code>Backup location (absolute path, starting with /): /opt/backup\n</code></pre> <p>Anschließend werden alle verfügbaren Backups in dem angegebenen Ordner (in unserem Beispiel <code>/opt/backup</code>) angezeigt:</p> <pre><code>Found project name mailcowdockerized\n[ 1 ] - /opt/backup/mailcow-2023-12-11-13-27-14/\n[ 2 ] - /opt/backup/mailcow-2023-12-11-14-02-06/\n</code></pre> <p>Nun können Sie die Nummer Ihres Backups angeben, welches Sie Wiederherstellen wollen, in diesem Beispiel die 2:</p> <pre><code>Select a restore point: 2\n</code></pre> <p>Das Skript wird nun alle gesicherten Komponenten Anzeigen, die Sie wiederherstellen können, in unserem Fall haben wir beim Backup Prozess <code>all</code> also Alles gewählt, dementsprechend taucht das hier nun auf:</p> <pre><code>[ 0 ] - all\n[ 1 ] - Crypt data\n[ 2 ] - Rspamd data\n[ 3 ] - Mail directory (/var/vmail)\n[ 4 ] - Redis DB\n[ 5 ] - Postfix data\n[ 6 ] - SQL DB\n</code></pre> <p>Auch hier wählen wir nun wieder die Komponente aus, die wir wiederherstellen wollen. Option 0 stellt ALLES wieder her.</p> Wenn Sie auf eine andere Architektur wiederherstellen wollen... <p>Sollten Sie das Backup auf einer anderen Architektur bspw. x86 gemacht haben und wollen dieses Backup nun auf ARM64 wiederherstellen, so wird das Backup von Rspamd als inkompatibel angezeigt und ist nicht einzeln anwählbar. Bei der Wiederherstellung mit Aufruf der Taste 0 wird die Wiederherstellung von Rspamd ebenfalls übersprungen.</p> <p>Beispiel für inkompatibles Rspamd Backup im Auswahl Menü:</p> <pre><code>[...]\n[ NaN ] - Rspamd data (incompatible Arch, cannot restore it)\n[...]\n</code></pre> <p>Nun wird mailcow die von Ihnen ausgewählten Sicherungen wiederherstellen. Bitte beachten Sie, dass je nach Größe der Sicherungen die Wiederherstellung eine gewisse Zeit in Anspruch nehmen kann.</p>","path":["B n r restore.de"],"tags":[]},{"location":"backup_restore/b_n_r-restore.en/","level":1,"title":"B n r restore.en","text":"","path":["B n r restore.en"],"tags":[]},{"location":"backup_restore/b_n_r-restore.en/#restore","level":3,"title":"Restore","text":"","path":["B n r restore.en"],"tags":[]},{"location":"backup_restore/b_n_r-restore.en/#variables-for-backuprestore-script","level":4,"title":"Variables for backup/restore script","text":"","path":["B n r restore.en"],"tags":[]},{"location":"backup_restore/b_n_r-restore.en/#multithreading","level":5,"title":"Multithreading","text":"<p>With the 2022-10 update it is possible to run the script with multithreading support. This can be used for backups as well as for restores.</p> <p>To start the backup/restore with multithreading you have to add <code>THREADS</code> as an environment variable in front of the command to execute the script.</p> <p><pre><code>THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh restore\n</code></pre> The number after the <code>=</code> character indicates the number of threads. Please keep your core count -2 to leave enough CPU power for mailcow itself.</p>","path":["B n r restore.en"],"tags":[]},{"location":"backup_restore/b_n_r-restore.en/#backup-path","level":5,"title":"Backup path","text":"<p>The script will ask you for a backup location. Inside of this location it will create folders in the format \"mailcow_DATE\". You should not rename those folders to not break the restore process.</p> <p>To run a backup unattended, define MAILCOW_BACKUP_LOCATION as environment variable before starting the script:</p> <pre><code>MAILCOW_BACKUP_LOCATION=/opt/backup /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh restore\n</code></pre> <p>Tip</p> <p>Both variables mentioned above can also be combined! Ex: <pre><code>MAILCOW_BACKUP_LOCATION=/opt/backup THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh restore\n</code></pre></p>","path":["B n r restore.en"],"tags":[]},{"location":"backup_restore/b_n_r-restore.en/#restoring-data","level":4,"title":"Restoring Data","text":"<p>Danger</p> <p>Please do not copy this script to another location.</p> <p>Warning</p> <p>To restore a backup on a new system, mailcow must be initialized and running! Therefore, reinstall mailcow according to the instructions and wait to proceed with the restoration until mailcow is up and running in an empty state.</p> <p>Danger for older installations</p> <p>Before restoring your mailcow system on a new server and a clean mailcow-dockerized folder, please check if the value <code>MAILDIR_SUB</code> is set in your mailcow.conf. If this value is not set, do not set it in your new mailcow or remove it, otherwise NO emails will be displayed. Dovecot loads emails from the mentioned subfolder of the Maildir volume under <code>$DOCKER_VOLUME_PATH/mailcowdockerized_vmail-vol-1</code> and if there is any change compared to the original state, no emails will be available there.</p> <p>To run a restore, start mailcow, use the script with \"restore\" as first parameter.</p> <pre><code># Syntax:\n# ./helper-scripts/backup_and_restore.sh restore\n</code></pre> <p>The script will ask you for a backup location containing the mailcow_DATE folders:</p> <pre><code>Backup location (absolute path, starting with /): /opt/backup\n</code></pre> <p>All available backups in the specified folder (in our example <code>/opt/backup</code>) are then displayed:</p> <pre><code>Found project name mailcowdockerized\n[ 1 ] - /opt/backup/mailcow-2023-12-11-13-27-14/\n[ 2 ] - /opt/backup/mailcow-2023-12-11-14-02-06/\n</code></pre> <p>Now you can enter the number of your backup that you want to restore, in this example the 2nd backup:</p> <pre><code>Select a restore point: 2\n</code></pre> <p>The script will now display all the backed up components that you can restore, in our case we have selected <code>all</code> for the backup process, so this will now appear here:</p> <pre><code>[ 0 ] - all\n[ 1 ] - Crypt data\n[ 2 ] - Rspamd data\n[ 3 ] - Mail directory (/var/vmail)\n[ 4 ] - Redis DB\n[ 5 ] - Postfix data\n[ 6 ] - SQL DB\n</code></pre> <p>Again, we select the component that we want to restore. Option 0 restores EVERYTHING.</p> If you want to restore to a different architecture... <p>If you have made the backup on a different architecture, e.g. x86, and now want to restore this backup to ARM64, the backup of Rspamd is displayed as incompatible and cannot be selected individually. When restoring with the 0 key, the restoration of Rspamd is also skipped.</p> <p>Example of incompatible Rspamd backup in the selection menu:</p> <pre><code>[...]\n[ NaN ] - Rspamd data (incompatible Arch, cannot restore it)\n[...]\n</code></pre> <p>Now mailcow will restore the backups you have selected. Please note that the restoration may take some time, depending on the size of the backups.</p>","path":["B n r restore.en"],"tags":[]},{"location":"client/client-android.de/","level":1,"title":"Client android.de","text":"<ol> <li>Öffnen Sie die App Email.</li> <li>Wenn dies Ihr erstes E-Mail-Konto ist, tippen Sie auf Konto hinzufügen; wenn nicht, tippen Sie auf Mehr und Einstellungen und dann Konto hinzufügen.</li> <li>Wählen Sie Microsoft Exchange ActiveSync.</li> <li>Geben Sie Ihre E-Mail Adresse () und Ihr Passwort ein.</li> <li>Tippen Sie auf Anmelden.</li> </ol>","path":["Client android.de"],"tags":[]},{"location":"client/client-android.en/","level":1,"title":"Client android.en","text":"<ol> <li>Open the Email app.</li> <li>If this is your first email account, tap Add Account; if not, tap More and Settings and then Add account.</li> <li>Select Microsoft Exchange ActiveSync.</li> <li>Enter your email address () and password.</li> <li>Tap Sign in.</li> </ol>","path":["Client android.en"],"tags":[]},{"location":"client/client-apple.de/","level":1,"title":"Client apple.de","text":"","path":["Client apple.de"],"tags":[]},{"location":"client/client-apple.de/#methode-1-konfigurationsprofil","level":2,"title":"Methode 1: Konfigurationsprofil","text":"<p>E-Mail, Kontakte und Kalender können auf Apple-Geräten automatisch konfiguriert werden, indem ein Konfigurationsprofil installiert wird. Um ein solches Profil herunterzuladen, müssen Sie sich mit dem gewünschten E-Mail-Konto in der mailcow UI anmelden.</p>","path":["Client apple.de"],"tags":[]},{"location":"client/client-apple.de/#methode-11-imap-und-smtp","level":2,"title":"Methode 1.1: IMAP und SMTP","text":"<p>Diese Methode konfiguriert IMAP und SMTP für den Zugriff auf ein E-Mail-Konto.</p> <ol> <li>Öffnen Sie https://${MAILCOW_HOSTNAME}/mobileconfig.php?only_emailmailcow.mobileconfig um ein individuelles Konfigurationsprofil herunterzuladen.</li> <li>Öffnen Sie das Profil auf Ihrem Mac, iPhone oder iPad und folgen Sie der Anleitung von Apple für Ihre Betriebssystemversion, um das Profil zu installieren:<ul> <li>Anleitung für macOS</li> <li>Anleitung für iOS</li> </ul> </li> <li>Da das Profil nicht digital signiert ist, müssen Sie den entsprechenden Hinweis bei der Installation bestätigen. Wenn Sie dazu aufgefordert werden, geben Sie das Passwort Ihres E-Mail-Kontos ein.</li> </ol>","path":["Client apple.de"],"tags":[]},{"location":"client/client-apple.de/#methode-12-imap-smtp-und-calcarddav","level":2,"title":"Methode 1.2: IMAP, SMTP und Cal/CardDAV","text":"<p>Diese Methode konfiguriert neben dem E-Mail-Konto zusätzlich CardDAV (Adressbuch) und CalDAV (Kalender).</p> <ol> <li>Öffnen Sie https://${MAILCOW_HOSTNAME}/mobileconfig.phpmailcow.mobileconfig um ein individuelles Konfigurationsprofil herunterzuladen.</li> <li>Öffnen Sie das Profil auf Ihrem Mac, iPhone oder iPad und folgen Sie der Anleitung von Apple für Ihre Betriebssystemversion, um das Profil zu installieren:<ul> <li>Anleitung für macOS</li> <li>Anleitung für iOS</li> </ul> </li> <li>Da das Profil nicht digital signiert ist, müssen Sie den entsprechenden Hinweis bei der Installation bestätigen. Wenn Sie dazu aufgefordert werden, geben Sie das Passwort Ihres E-Mail-Kontos ein.</li> </ol>","path":["Client apple.de"],"tags":[]},{"location":"client/client-apple.de/#methode-13-imap-und-smtp-mit-app-passwort","level":2,"title":"Methode 1.3: IMAP und SMTP mit App-Passwort","text":"<p>Diese Methode konfiguriert IMAP und SMTP für den Zugriff auf ein E-Mail-Konto. Es wird ein neues App-Passwort erzeugt und in das Profil eingefügt, damit bei der Einrichtung kein Passwort eingegeben werden muss. Geben Sie das Profil nicht weiter, da es einen vollständigen Zugriff auf Ihr Postfach ermöglicht.</p> <ol> <li>Öffnen Sie https://${MAILCOW_HOSTNAME}/mobileconfig.php?only_email&amp;app_passwordmailcow.mobileconfig um ein individuelles Konfigurationsprofil herunterzuladen.</li> <li>Öffnen Sie das Profil auf Ihrem Mac, iPhone oder iPad und folgen Sie der Anleitung von Apple für Ihre Betriebssystemversion, um das Profil zu installieren:<ul> <li>Anleitung für macOS</li> <li>Anleitung für iOS</li> </ul> </li> <li>Da das Profil nicht digital signiert ist, müssen Sie den entsprechenden Hinweis bei der Installation bestätigen.</li> </ol>","path":["Client apple.de"],"tags":[]},{"location":"client/client-apple.de/#methode-14-imap-smtp-und-calcarddav-mit-app-passwort","level":2,"title":"Methode 1.4: IMAP, SMTP und Cal/CardDAV mit App-Passwort","text":"<p>Diese Methode konfiguriert neben dem E-Mail-Konto zusätzlich CardDAV (Adressbuch) und CalDAV (Kalender). Es wird ein neues App-Passwort erzeugt und in das Profil eingefügt, damit bei der Einrichtung kein Passwort eingegeben werden muss. Geben Sie das Profil nicht weiter, da es einen vollständigen Zugriff auf Ihr Postfach ermöglicht.</p> <ol> <li>Öffnen Sie https://${MAILCOW_HOSTNAME}/mobileconfig.php?app_passwordmailcow.mobileconfig um ein individuelles Konfigurationsprofil herunterzuladen.</li> <li>Öffnen Sie das Profil auf Ihrem Mac, iPhone oder iPad und folgen Sie der Anleitung von Apple für Ihre Betriebssystemversion, um das Profil zu installieren:<ul> <li>Anleitung für macOS</li> <li>Anleitung für iOS</li> </ul> </li> <li>Da das Profil nicht digital signiert ist, müssen Sie den entsprechenden Hinweis bei der Installation bestätigen.</li> </ol>","path":["Client apple.de"],"tags":[]},{"location":"client/client-apple.de/#methode-2-exchange-activesync-emulation","level":2,"title":"Methode 2: Exchange ActiveSync-Emulation","text":"<p>Unter iOS/iPadOS wird auch Exchange ActiveSync als Alternative zum obigen Verfahren unterstützt. Es hat den Vorteil, dass es Push-E-Mail unterstützt (d. h. Sie werden sofort über eingehende Nachrichten benachrichtigt), hat aber einige Einschränkungen, z. B. unterstützt es nicht mehr als drei E-Mail-Adressen pro Kontakt in Ihrem Adressbuch. Befolgen Sie die folgenden Schritte, wenn Sie stattdessen Exchange verwenden möchten.</p> <ol> <li>Folgen Sie der Anleitung von Apple für Ihre Version von iOS/iPadOS und wählen Sie Microsoft Exchange als E-Mail-Dienst.</li> <li>Geben Sie Ihre E-Mail Adresse () ein und tippen Sie auf Weiter.</li> <li>Wählen Sie Manuell konfigurieren bei der Frage, ob die E-Mail-Adresse an Microsoft gesendet werden soll.</li> <li>Geben Sie Ihr Passwort ein und tippen Sie erneut auf Weiter. Wenn die 2-Faktor-Authentifizierung aktiviert ist, müssen Sie ein App-Password anstelle Ihres normalen Passwortes benutzen.</li> <li>Tippen Sie abschließend auf Speichern.</li> </ol>","path":["Client apple.de"],"tags":[]},{"location":"client/client-apple.en/","level":1,"title":"Client apple.en","text":"","path":["Client apple.en"],"tags":[]},{"location":"client/client-apple.en/#method-1-configuration-profile","level":2,"title":"Method 1: Configuration Profile","text":"<p>Email, contacts and calendars can be configured automatically on Apple devices by installing a configuration profile. To download such a profile you must login to the mailcow UI with the desired email account first.</p>","path":["Client apple.en"],"tags":[]},{"location":"client/client-apple.en/#method-11-imap-and-smtp","level":2,"title":"Method 1.1: IMAP and SMTP","text":"<p>This method configures IMAP and SMTP to access an email account.</p> <ol> <li>Open  https://${MAILCOW_HOSTNAME}/mobileconfig.php?only_emailmailcow.mobileconfig to download a customized configuration profile.</li> <li>Open the profile on your Mac, iPhone or iPad and follow Apple's instructions for your operating system version to install the profile:<ul> <li>Steps for macOS</li> <li>Steps for iOS</li> </ul> </li> <li>Since the profile is not digitally signed, you must confirm the respective notification during installation. Enter the password for your email account when asked.</li> </ol>","path":["Client apple.en"],"tags":[]},{"location":"client/client-apple.en/#method-12-imap-smtp-and-calcarddav","level":2,"title":"Method 1.2: IMAP, SMTP and Cal/CardDAV","text":"<p>This method configures CardDAV (address book) and CalDAV (calendar) in addition to the email account.</p> <ol> <li>Open  https://${MAILCOW_HOSTNAME}/mobileconfig.phpmailcow.mobileconfig to download a customized configuration profile.</li> <li>Open the profile on your Mac, iPhone or iPad and follow Apple's instructions for your operating system version to install the profile:<ul> <li>Steps for macOS</li> <li>Steps for iOS</li> </ul> </li> <li>Since the profile is not digitally signed, you must confirm the respective notification during installation. Enter the password for your email account when asked.</li> </ol>","path":["Client apple.en"],"tags":[]},{"location":"client/client-apple.en/#method-13-imap-and-smtp-with-app-password","level":2,"title":"Method 1.3: IMAP and SMTP with App Password","text":"<p>This method configures IMAP and SMTP to access an email account. A new app password is generated and added to the profile so that no password needs to be entered when setting up your device. Please do not share the file as it grants full access to your mailbox.</p> <ol> <li>Open  https://${MAILCOW_HOSTNAME}/mobileconfig.php?only_email&amp;app_passwordmailcow.mobileconfig to download a customized configuration profile.</li> <li>Open the profile on your Mac, iPhone or iPad and follow Apple's instructions for your operating system version to install the profile:<ul> <li>Steps for macOS</li> <li>Steps for iOS</li> </ul> </li> <li>Since the profile is not digitally signed, you must confirm the respective notification during installation. Enter the password for your email account when asked.</li> </ol>","path":["Client apple.en"],"tags":[]},{"location":"client/client-apple.en/#method-14-imap-smtp-and-calcarddav-with-app-password","level":2,"title":"Method 1.4: IMAP, SMTP and Cal/CardDAV with App Password","text":"<p>This method configures CardDAV (address book) and CalDAV (calendar) in addition to the email account. A new app password is generated and added to the profile so that no password needs to be entered when setting up your device. Please do not share the file as it grants full access to your mailbox.</p> <ol> <li>Open  https://${MAILCOW_HOSTNAME}/mobileconfig.php?app_passwordmailcow.mobileconfig to download a customized configuration profile.</li> <li>Open the profile on your Mac, iPhone or iPad and follow Apple's instructions for your operating system version to install the profile:<ul> <li>Steps for macOS</li> <li>Steps for iOS</li> </ul> </li> <li>Since the profile is not digitally signed, you must confirm the respective notification during installation. Enter the password for your email account when asked.</li> </ol>","path":["Client apple.en"],"tags":[]},{"location":"client/client-apple.en/#method-2-exchange-activesync-emulation","level":2,"title":"Method 2: Exchange ActiveSync emulation","text":"<p>On iOS/iPadOS, Exchange ActiveSync is also supported as an alternative to the procedure above. It has the advantage of supporting push email (i.e. you are immediately notified of incoming messages), but has some limitations, e.g. it does not support more than three email addresses per contact in your address book. Follow the steps below if you decide to use Exchange instead.</p> <ol> <li>Follow Apple's instructions for your version of iOS/iPadOS and select Microsoft Exchange as email service.</li> <li>Enter your email address () and tap Next.</li> <li>Select Manual Configuration when asked if your mail address should be sent to Microsoft.</li> <li>Enter your password, tap Next again. With Two-factor authentication enabled, you have to use an app password instead of your regular password.</li> <li>Finally, tap Save.</li> </ol>","path":["Client apple.en"],"tags":[]},{"location":"client/client-emclient.de/","level":1,"title":"Client emclient.de","text":"<ol> <li>Starten Sie eM Client.</li> <li>Wenn Sie eM Client zum ersten Mal starten, werden Sie aufgefordert, Ihr Konto einzurichten. Fahren Sie mit Schritt 4 fort.</li> <li>Gehen Sie oben auf Menü, wählen Sie Tools und Konten.</li> <li>Geben Sie Ihre E-Mail Adresse ein () und klicken Sie auf Jetzt starten.</li> <li>Geben Sie Ihr Passwort ein und klicken Sie auf Weiter.</li> <li>Geben Sie Ihren Namen ein () und klicken Sie auf Weiter.</li> <li>Klicken Sie auf Fertigstellen.</li> </ol>","path":["Client emclient.de"],"tags":[]},{"location":"client/client-emclient.en/","level":1,"title":"Client emclient.en","text":"<ol> <li>Launch eM Client.</li> <li>If this is the first time you launched eM Client, it asks you to set up your account. Proceed to step 4.</li> <li>Go to Menu at the top, select Tools and Accounts.</li> <li>Enter your email address () and click Start Now.</li> <li>Enter your password and click Continue.</li> <li>Enter your name () and click Next.</li> <li>Click Finish.</li> </ol>","path":["Client emclient.en"],"tags":[]},{"location":"client/client-kontact.de/","level":1,"title":"Client kontact.de","text":"<ol> <li>Starten Sie Kontact.</li> <li>Wenn Sie Kontact oder KMail zum ersten Mal gestartet haben, werden Sie aufgefordert, Ihr Konto einzurichten. Fahren Sie mit Schritt 4 fort.</li> <li>Gehen Sie zu Mail in der Seitenleiste. Gehen Sie zum Menü Tools und wählen Sie Account Wizard.</li> <li>Geben Sie Ihren Namen  (), E-Mail Adresse () und Ihr Passwort ein. Klicken Sie auf Weiter.</li> <li>Klicken Sie auf Konto erstellen. Wenn Sie dazu aufgefordert werden, geben Sie Ihr Passwort erneut ein und klicken Sie auf OK.</li> <li>Schließen Sie das Fenster, indem Sie auf Beenden klicken.</li> <li>Gehen Sie zu Kalender in der Seitenleiste.</li> <li>Gehen Sie zum Menü Einstellungen und wählen Sie Konfigurieren Sie KOrganizer.</li> <li>Gehen Sie zur Registerkarte Kalender und klicken Sie auf die Schaltfläche Hinzufügen.</li> <li>Wählen Sie DAV-Groupware-Ressource und klicken Sie auf OK.</li> <li>Geben Sie Ihre E-Mail Adresse () und Ihr Passwort ein. Klicken Sie auf Weiter.</li> <li>Wählen Sie ScalableOGo aus dem Dropdown-Menü und klicken Sie auf Weiter.</li> <li>Geben Sie den  mailcow Hostname in das Feld Host ein und klicken Sie auf Weiter.</li> <li>Klicken Sie auf Verbindung testen und dann auf Fertigstellen. Klicken Sie abschließend zweimal auf OK.</li> </ol> <p>Sobald Sie Kontact eingerichtet haben, können Sie KMail, KOrganizer und KAddressBook auch einzeln verwenden.</p>","path":["Client kontact.de"],"tags":[]},{"location":"client/client-kontact.en/","level":1,"title":"Client kontact.en","text":"<ol> <li>Launch Kontact.</li> <li>If this is the first time you launched Kontact or KMail, it asks you to set up your account. Proceed to step 4.</li> <li>Go to Mail in the sidebar. Go to the Tools menu and select Account Wizard.</li> <li>Enter your name (), email address () and your password. Click Next.</li> <li>Click Create Account. If prompted, re-enter your password and click OK.</li> <li>Close the window by clicking Finish.</li> <li>Go to Calendar in the sidebar.</li> <li>Go to the Settings menu and select Configure KOrganizer.</li> <li>Go to the Calendars tab and click the Add button.</li> <li>Choose DAV groupware resource and click OK.</li> <li>Enter your email address () and your password. Click Next.</li> <li>Select ScalableOGo from the dropdown menu and click Next.</li> <li>Enter  your mailcow hostname into the Host field and click Next.</li> <li>Click Test Connection and then Finish. Finally, click OK twice.</li> </ol> <p>Once you have set up Kontact, you can also use KMail, KOrganizer and KAddressBook individually.</p>","path":["Client kontact.en"],"tags":[]},{"location":"client/client-manual.de/","level":1,"title":"Client manual.de","text":"<p>Diese Anweisungen gelten nur für unveränderte Portbindungen!</p>","path":["Client manual.de"],"tags":[]},{"location":"client/client-manual.de/#e-mail","level":2,"title":"E-Mail","text":"Dienst Verschlüsselung Host Port IMAP STARTTLS mailcow hostname 143 IMAPS SSL mailcow hostname 993 POP3 STARTTLS mailcow hostname 110 POP3S SSL mailcow hostname 995 SMTP STARTTLS mailcow hostname 587 SMTPS SSL mailcow hostname 465 <p>Bitte verwenden Sie \"plain\" als Authentifizierungsmechanismus. Entgegen der Annahme werden keine Passwörter im Klartext übertragen, da ohne TLS keine Authentifizierung stattfinden darf.</p>","path":["Client manual.de"],"tags":[]},{"location":"client/client-manual.de/#kontakte-und-kalender","level":2,"title":"Kontakte und Kalender","text":"<p>SOGos Standard-URLs für Kalender (CalDAV) und Kontakte (CardDAV):</p> <ol> <li> <p>CalDAV https://mail.example.com/SOGo/dav/user@example.com/Calendar/personal/https:///SOGo/dav//Calendar/personal/</p> </li> <li> <p>CardDAV https://mail.example.com/SOGo/dav/user@example.com/Contacts/personal/https:///SOGo/dav//Contacts/personal/</p> </li> </ol> <p>Einige Anwendungen verlangen möglicherweise die Verwendung von https://mail.example.com/SOGo/dav/https:///SOGo/dav/ oder den vollständigen Pfad zu Ihrem Kalender, der in SOGo gefunden und kopiert werden kann.</p>","path":["Client manual.de"],"tags":[]},{"location":"client/client-manual.en/","level":1,"title":"Client manual.en","text":"<p>These instructions are valid for unchanged port bindings only!</p>","path":["Client manual.en"],"tags":[]},{"location":"client/client-manual.en/#email","level":2,"title":"Email","text":"Service Encryption Host Port IMAP STARTTLS mailcow hostname 143 IMAPS SSL mailcow hostname 993 POP3 STARTTLS mailcow hostname 110 POP3S SSL mailcow hostname 995 SMTP STARTTLS mailcow hostname 587 SMTPS SSL mailcow hostname 465 <p>Please use the \"plain\" password setting as the authentication mechanism. Contrary to what the name implies, the password will not be transferred to the server in plain text as no authentication is allowed to take place without TLS.</p>","path":["Client manual.en"],"tags":[]},{"location":"client/client-manual.en/#contacts-and-calendars","level":2,"title":"Contacts and calendars","text":"<p>SOGos default calendar (CalDAV) and contacts (CardDAV) URLs:</p> <ol> <li> <p>CalDAV https://mail.example.com/SOGo/dav/user@example.com/Calendar/personal/https:///SOGo/dav//Calendar/personal/</p> </li> <li> <p>CardDAV https://mail.example.com/SOGo/dav/user@example.com/Contacts/personal/https:///SOGo/dav//Contacts/personal/</p> </li> </ol> <p>Some applications may require you to use https://mail.example.com/SOGo/dav/https:///SOGo/dav/ or the full path to your calendar, which can be found and copied from within SOGo.</p>","path":["Client manual.en"],"tags":[]},{"location":"client/client-outlook.de/","level":1,"title":"Client outlook.de","text":"<ol> <li>Downloaden und installieren Sie Outlook CalDav Synchronizer.</li> <li>Starten Sie Outlook.</li> <li>Wenn Sie Outlook zum ersten Mal gestartet haben, werden Sie aufgefordert, Ihr Konto einzurichten. Fahren Sie mit Schritt 5 fort.</li> <li>Gehen Sie zum Menü Datei und klicken Sie auf Konto hinzufügen.</li> <li>Geben Sie Ihren Namen (), Ihre E-Mail Adresse () und Ihr Passwort ein. Klicken Sie auf Weiter.</li> <li>Klicken Sie auf Finish.</li> <li>Gehen Sie zur Multifunktionsleiste CalDav Synchronizer und klicken Sie auf Synchronisationsprofile.</li> <li>Klicken Sie auf die zweite Schaltfläche oben (Mehrere Profile hinzufügen), wählen Sie Sogo und klicken Sie auf Ok.</li> <li>Klicken Sie auf die Schaltfläche IMAP/POP3-Kontoeinstellungen abrufen.</li> <li>Klicken Sie auf Ressourcen erkennen und Outlook-Ordnern zuweisen.</li> <li>Wählen Sie im Fenster Ressource auswählen Ihren Hauptkalender (in der Regel Persönlicher Kalender), klicken Sie auf die Schaltfläche ..., weisen Sie ihn dem Ordner Kalender zu, und klicken Sie auf OK. Gehen Sie zu den Registerkarten Adressbücher und Aufgaben und wiederholen Sie den Vorgang entsprechend. Weisen Sie nicht mehreren Kalendern, Adressbüchern oder Aufgabenlisten zu!</li> <li>Schließen Sie alle Fenster mit den Tasten OK.</li> </ol>","path":["Client outlook.de"],"tags":[]},{"location":"client/client-outlook.de/#outlook-2016-oder-hoher-von-office-365-unter-windows","level":2,"title":"Outlook 2016 oder höher von Office 365 unter Windows","text":"<p>Dies gilt nur, wenn Ihr Serveradministrator EAS für Outlook nicht deaktiviert hat. Wenn es deaktiviert ist, folgen Sie bitte stattdessen der Anleitung für Outlook 2007.</p> <p>Outlook 2016 hat ein Problem mit der automatischen Erkennung. Nur Outlook von Office 365 ist betroffen. Wenn Sie Outlook aus einer anderen Quelle installiert haben, folgen Sie bitte der Anleitung für Outlook 2013 oder höher. </p> <p>Für EAS müssen Sie den alten Assistenten verwenden, indem Sie <code>C:\\Program Files (x86)\\Microsoft Office\\root\\Office16\\OLCFG.EXE</code> starten. Wenn diese Anwendung geöffnet wird, können Sie mit Schritt 4 der Anleitung für Outlook 2013 unten fortfahren.</p> <p>Wenn die Anwendung nicht geöffnet wird, können Sie den Assistenten zum Erstellen eines neuen Kontos vollständig deaktivieren und die nachstehende Anleitung für Outlook 2013 befolgen.</p>","path":["Client outlook.de"],"tags":[]},{"location":"client/client-outlook.de/#outlook-2007-oder-hoher-auf-windows-kalenderkontakte-via-caldav-synchronizer","level":2,"title":"Outlook 2007 oder höher auf Windows (Kalender/Kontakte via CalDav Synchronizer)","text":"","path":["Client outlook.de"],"tags":[]},{"location":"client/client-outlook.de/#outlook-2013-oder-hoher-unter-windows-active-sync-nicht-empfohlen","level":2,"title":"Outlook 2013 oder höher unter Windows (Active Sync - nicht empfohlen)","text":"<p>Dies gilt nur, wenn Ihr Serveradministrator EAS für Outlook nicht deaktiviert hat. Wenn es deaktiviert ist, folgen Sie bitte stattdessen der Anleitung für Outlook 2007.</p> <ol> <li>Starten Sie Outlook.</li> <li>Wenn Sie Outlook zum ersten Mal gestartet haben, werden Sie aufgefordert, Ihr Konto einzurichten. Fahren Sie mit Schritt 4 fort.</li> <li>Öffnen Sie das Menü Datei und klicken Sie auf Konto hinzufügen.</li> <li>Geben Sie Ihren Namen (), Ihre E-Mail Adresse () und Ihr Passwort ein. Klicken Sie auf Weiter.</li> <li>Wenn Sie dazu aufgefordert werden, geben Sie Ihr Passwort erneut ein, markieren Sie Meine Anmeldedaten speichern und klicken Sie auf OK.</li> <li>Klicken Sie auf die Schaltfläche Zulassen.</li> <li>Klicken Sie auf Fertigstellen.</li> </ol>","path":["Client outlook.de"],"tags":[]},{"location":"client/client-outlook.de/#outlook-2011-oder-hoher-unter-macos","level":2,"title":"Outlook 2011 oder höher unter macOS","text":"<p>Die Mac-Version von Outlook synchronisiert keine Kalender und Kontakte und wird daher nicht unterstützt.</p>","path":["Client outlook.de"],"tags":[]},{"location":"client/client-outlook.en/","level":1,"title":"Client outlook.en","text":"<ol> <li>Download and install Outlook CalDav Synchronizer.</li> <li>Launch Outlook.</li> <li>If this is the first time you launched Outlook, it asks you to set up your account. Proceed to step 5.</li> <li>Go to the File menu and click Add Account.</li> <li>Enter your name (), email address () and your password. Click Next.</li> <li>Click Finish.</li> <li>Go to the CalDav Synchronizer ribbon and click Synchronization Profiles.</li> <li>Click the second button at top (Add multiple profiles), select Sogo, click Ok.</li> <li>Click the Get IMAP/POP3 account settings button.</li> <li>Click Discover resources and assign to Outlook folders.</li> <li>In the Select Resource window that pops up, select your main calendar (usually Personal Calendar), click the ... button, assign it to Calendar, and click OK. Go to the Address Books and Tasks tabs and repeat repeat the process accordingly. Do not assign multiple calendars, address books or task lists!</li> <li>Close all windows with the OK buttons.</li> </ol>","path":["Client outlook.en"],"tags":[]},{"location":"client/client-outlook.en/#outlook-2016-or-higher-from-office-365-on-windows","level":2,"title":"Outlook 2016 or higher from Office 365 on Windows","text":"<p>This is only applicable if your server administrator has not disabled EAS for Outlook. If it is disabled, please follow the guide for Outlook 2007 instead.</p> <p>Outlook 2016 has an issue with autodiscover. Only Outlook from Office 365 is affected. If you installed Outlook from another source, please follow the guide for Outlook 2013 or higher. </p> <p>For EAS you must use the old assistant by launching <code>C:\\Program Files (x86)\\Microsoft Office\\root\\Office16\\OLCFG.EXE</code>. If this application opens, you can go to step 4 of the guide for Outlook 2013 below.</p> <p>If it does not open, you can completely disable the new account creation wizard and follow the guide for Outlook 2013 below.</p>","path":["Client outlook.en"],"tags":[]},{"location":"client/client-outlook.en/#outlook-2007-or-2010-on-windows","level":2,"title":"Outlook 2007 or 2010 on Windows","text":"","path":["Client outlook.en"],"tags":[]},{"location":"client/client-outlook.en/#outlook-2007-or-higher-on-windows-calendercontacts-via-caldav-synchronizer","level":2,"title":"Outlook 2007 or higher on Windows (Calender/Contacts via CalDav Synchronizer)","text":"","path":["Client outlook.en"],"tags":[]},{"location":"client/client-outlook.en/#outlook-2013-or-higher-on-windows-active-sync-not-recommended","level":2,"title":"Outlook 2013 or higher on Windows (Active Sync - not recommended)","text":"<p>This is only applicable if your server administrator has not disabled EAS for Outlook. If it is disabled, please follow the guide for Outlook 2007 instead.</p> <ol> <li>Launch Outlook.</li> <li>If this is the first time you launched Outlook, it asks you to set up your account. Proceed to step 4.</li> <li>Go to the File menu and click Add Account.</li> <li>Enter your name (), email address () and your password. Click Next.</li> <li>When prompted, enter your password again, check Remember my credentials and click OK.</li> <li>Click the Allow button.</li> <li>Click Finish.</li> </ol>","path":["Client outlook.en"],"tags":[]},{"location":"client/client-outlook.en/#outlook-2011-or-higher-on-macos","level":2,"title":"Outlook 2011 or higher on macOS","text":"<p>The Mac version of Outlook does not synchronize calendars and contacts and therefore is not supported.</p>","path":["Client outlook.en"],"tags":[]},{"location":"client/client-thunderbird.de/","level":1,"title":"Client thunderbird.de","text":"<ol> <li>   Öffnen Sie Thunderbird. </li> <li>   Wenn Sie Thunderbird zum ersten Mal öffnen, werden Sie gefragt, ob Sie eine neue E-Mail-Adresse einrichten möchten. Klicken Sie auf Überspringen und eine bereits vorhandene E-Mail-Adresse verwenden und gehen Sie zum Schritt 4. </li> <li>   Klicken Sie auf das Menü Datei und wählen Sie Neu, Bestehendes Mail-Konto.... </li> <li>   Geben Sie Ihren Namen (), Ihre E-Mail-Adresse () und Ihr Passwort ein. Stellen Sie sicher, dass die Option Passwort merken aktiviert ist und klicken Sie auf Weiter. </li> <li>   Sobald die Konfiguration automatisch erkannt wurde, stellen Sie sicher, dass IMAP ausgewählt ist und klicken Sie auf Fertig. </li> <li>   Um Ihre Kontakte vom Server zu verwenden, klicken Sie auf den Pfeil neben \"Adressbücher\" und auf die Schaltfläche Verbinden für jedes Adressbuch, das Sie verwenden möchten. </li> <li>   Um Ihre Kalender vom Server zu verwenden, klicken Sie auf den Pfeil neben \"Kalender\" und dann auf die Schaltfläche Verbinden für jeden Kalender, den Sie verwenden möchten. </li> <li>   (Optional) Wenn Sie alle Unterordner synchronisieren möchten, gehen Sie zum Menü Kontoeinstellungen und wählen Sie Server-Einstellungen. Klicken Sie im Tab Server-Einstellungen auf die Schaltfläche Erweitert. In dem Fenster Erweiterte Kontoeinstellungen deaktivieren Sie das Kontrollkästchen \"Nur abonnierte Ordner anzeigen\". Klicken Sie auf OK, um die Änderungen zu speichern. </li> <li>   Klicken Sie auf Beenden, um das Fenster \"Konto-Einrichtung\" zu schließen. </li> </ol>","path":["Client thunderbird.de"],"tags":[]},{"location":"client/client-thunderbird.en/","level":1,"title":"Client thunderbird.en","text":"<ol> <li>   Launch Thunderbird. </li> <li>   If this is the first time you launched Thunderbird, it asks you whether you would like a new email address. Click Skip this and use my existing email and proceed to step 4. </li> <li>   Go to the File menu and select New, Existing Mail Account.... </li> <li>   Enter your name (), email address () and your password. Make sure the Remember password checkbox is selected and click Continue. </li> <li>   Once the configuration has been automatically detected, make sure IMAP is selected and click Done. </li> <li>   To use your contacts from the server, click on the arrow next to \"Address Books\" and click the Connect button on each address book you would like to use. </li> <li>   To use your calendars from the server, click on the arrow next to \"Calendars\" and click the Connect button on each calendar you would like to use. </li> <li>   (Optional) If you want Thunderbird to sync all subfolders, go to the Account Settings menu and select Server Settings. In the Server Settings tab, click on the Advanced button. In the Advanced Account Settings window, uncheck the \"Show only subscribed folders\" checkbox. Click OK to save the changes. </li> <li>   Click Finish to close the Account Setup window. </li> </ol>","path":["Client thunderbird.en"],"tags":[]},{"location":"client/client-windows.de/","level":1,"title":"Client windows.de","text":"<p>Windows 8 und höher unterstützen E-Mail, Kontakte und Kalender über Exchange ActiveSync.</p> <ol> <li>Öffnen Sie die App Mail.</li> <li>Wenn Sie Mail noch nicht verwendet haben, können Sie im Hauptfenster auf Konto hinzufügen klicken. Fahren Sie mit Schritt 4 fort.</li> <li>Klicken Sie auf Konten in der Seitenleiste links und dann auf Konto hinzufügen ganz rechts.</li> <li>Wählen Sie Exchange.</li> <li>Geben Sie Ihre E-Mail Adresse () ein und klicken Sie auf Weiter..</li> <li>Geben Sie Ihr Passwort ein und klicken Sie auf Anmelden.</li> </ol> <p>Sobald Sie die Mail-App eingerichtet haben, können Sie auch die Apps \"Kontakte\" und \"Kalender\" verwenden.</p>","path":["Client windows.de"],"tags":[]},{"location":"client/client-windows.en/","level":1,"title":"Client windows.en","text":"<p>Windows 8 and higher support email, contacts and calendar via Exchange ActiveSync.</p> <ol> <li>Open the Mail app.</li> <li>If you have not previously used Mail, you can click Add Account in the main window. Proceed to step 4.</li> <li>Click Accounts in the sidebar on the left, then click Add Account on the far right.</li> <li>Select Exchange.</li> <li>Enter your email address () and click Next.</li> <li>Enter your password and click Log in.</li> </ol> <p>Once you have set up the Mail app, you can also use the People and Calendar apps.</p>","path":["Client windows.en"],"tags":[]},{"location":"client/client.de/","level":1,"title":"Client.de","text":"<p>mailcow unterstützt eine Vielzahl von E-Mail-Clients, sowohl auf Desktop-Computern als auch auf Smartphones. Im Folgenden finden Sie eine Reihe von Konfigurationsanleitungen, die erklären, wie Sie Ihr mailcow-Konto konfigurieren können.</p> <p>Tipp</p> Wenn Sie auf diese Seite zugreifen, indem Sie sich bei Ihrem mailcow-Server anmelden und auf den Link \"Konfigurationsanleitungen für E-Mail-Clients und Smartphones anzeigen\" klicken, werden alle Anleitungen mit Ihrer E-Mail-Adresse und Ihrem Servernamen personalisiert.  <p>Erfolgreich</p> Da Sie diese Seite aufgerufen haben, nachdem Sie sich in Ihren mailcow-Server eingeloggt haben, wurden alle Anleitungen mit Ihrer E-Mail-Adresse und Ihrem Servernamen personalisiert.  <ul> <li>Android</li> <li>Apple iOS / macOS</li> <li>eM Client</li> <li>KDE Kontact / KMail</li> <li>Microsoft Outlook</li> <li>Mozilla Thunderbird</li> <li>Windows Mail</li> <li>Manual configuration</li> </ul>","path":["Client.de"],"tags":[]},{"location":"client/client.en/","level":1,"title":"Client.en","text":"<p>mailcow supports a variety of email clients, both on desktop computers and on smartphones. Below, you can find a number of configuration guides that explain how to configure your mailcow account.</p> <p>Tip</p> If you access this page by logging into your mailcow server and clicking the \"Show configuration guides for email clients and smartphones\" link, all of the guides will be personalized with your email address and server name.  <p>Success</p> Since you accessed this page after logging into your mailcow server, all of the guides have been personalized with your email address and server name.  <ul> <li>Android</li> <li>Apple iOS / macOS</li> <li>eM Client</li> <li>KDE Kontact / KMail</li> <li>Microsoft Outlook</li> <li>Mozilla Thunderbird</li> <li>Windows Mail</li> <li>Manual configuration</li> </ul>","path":["Client.en"],"tags":[]},{"location":"de/","level":1,"title":"mailcow: dockerized - + =","text":"","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"de/#mailcow-dockerized-","level":1,"title":"mailcow: dockerized -  +  =","text":"<p>Die Mailserver-Suite mit dem 'moo'</p>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"de/#was-ist-mailcow-dockerized","level":2,"title":"Was ist mailcow: dockerized?","text":"<p>Frage</p> <p>Mailcow, MailCow oder doch mailcow? Wie heißt das Projekt nun genau?</p> <p>Richtig: mailcow, denn mailcow ist eine eingetragene Wortmarke mit kleinem m </p> <p>mailcow: dockerized ist eine Open-Source Groupware/E-Mail Suite auf Docker Basis.</p> <p>Dabei setzt mailcow auf viele bekannte und lang bewertete Komponenten, welche im Zusammenspiel einen Rund um Sorglosen E-Mail Server ergeben.</p> <p>Jeder Container repräsentiert eine einzelne Anwendung, die in einem überbrückten (Bridged) Netzwerk verbunden sind:</p> <ul> <li> ACME Automatische Generation von Let's Encrypt Zertifikaten</li> <li> ClamAV Antiviren Scanner (optional)</li> <li> Dovecot IMAP/POP Server zum Abrufen der E-Mails mit integrierter Full-Text Search Engine \"Flatcurve\"</li> <li> MariaDB Datenbank zum Speichern der Nutzer Informationen u.w.</li> <li> Memcached Cache für den Webmailer SOGo</li> <li> Netfilter Fail2ban-ähnliche Integration von @mkuron</li> <li> Nginx Webserver für Komponenten des Stacks</li> <li> Olefy Analyse von Office Dokumenten nach Viren, Makros etc.</li> <li> PHP Programmiersprache der meisten Webbasierten mailcow Applikationen</li> <li> Postfix MTA (Mail Transfer Agent) für den E-Mail-Verkehr im Internet</li> <li> Redis Speicher für Spaminformationen, DKIM Schlüssel u.w.</li> <li> Rspamd Spamfilter mit automatischem Lernen von Spammails</li> <li> SOGo Integrierter Webmailer und Cal-/Carddav Schnittstelle</li> <li> Unbound Integrierter DNS-Server zum Verifizieren von DNSSEC u.w</li> <li> Watchdog Für die grundlegende Überwachung der Containerstatus innerhalb von mailcow</li> </ul> <p>Doch das Herzstück bzw. das, was mailcow besonders macht, ist die grafische Weboberfläche, die mailcow UI.</p> <p>Diese bietet für so gut wie alle Einstellungen einen Platz und erlaubt das bequeme Anlegen von neuen Domains und E-Mail-Adressen mit wenigen Klicks.</p> <p>Aber auch andere bzw. kniffligere Themen können in ihr problemlos erledigt werden:</p> <ul> <li>DKIM und ARC Unterstützung bzw. Generation.</li> <li>Black- und Whitelists pro Domain und pro Benutzer</li> <li>Spam-Score-Verwaltung pro Benutzer (Spam ablehnen, Spam markieren, Greylist)</li> <li>Erlauben Sie Mailbox-Benutzern, temporäre Spam-Aliase zu erstellen</li> <li>Voranstellen von E-Mail-Tags an den Betreff oder Verschieben von E-Mails in Unterordner (pro Benutzer)</li> <li>Mailbox-Benutzer können die TLS-Durchsetzung für eingehende und ausgehende Nachrichten umschalten</li> <li>Benutzer können die Caches von SOGo ActiveSync-Geräten zurücksetzen</li> <li>imapsync, um entfernte Postfächer regelmäßig zu migrieren oder abzurufen</li> <li>TFA: Yubikey OTP und WebAuthn USB (nur Google Chrome und Derivate), TOTP</li> <li>Hinzufügen von Whitelist-Hosts zur Weiterleitung von Mails an mailcow</li> <li>Fail2ban-ähnliche Integration</li> <li>Quarantäne-System</li> <li>Antivirus-Scanning inkl. Makro-Scanning in Office-Dokumenten</li> <li>Integrierte Basisüberwachung</li> <li>Und weitere...</li> </ul> <p>Die mailcow Daten (wie bspw. E-Mails, Userdaten etc.) werden in Docker-Volumes aufbewahrt - geben Sie gut auf diese Volumes acht:</p> <ul> <li>clamd-db-vol-1</li> <li>crypt-vol-1</li> <li>mysql-socket-vol-1</li> <li>mysql-vol-1</li> <li>postfix-vol-1</li> <li>redis-vol-1</li> <li>rspamd-vol-1</li> <li>sogo-userdata-backup-vol-1</li> <li>sogo-web-vol-1</li> <li>vmail-index-vol-1</li> <li>vmail-vol-1</li> </ul> <p>Achtung</p> <p>Die Mails werden komprimiert und verschlüsselt gespeichert. Das Schlüsselpaar ist in crypt-vol-1 zu finden. Bitte vergessen Sie nicht, dieses und andere Volumes zu sichern. #KeinBackupkeinMitleid</p>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"de/#unterstutzen-sie-das-mailcow-projekt","level":2,"title":"Unterstützen Sie das mailcow Projekt","text":"<p>Bitte erwägen Sie einen Supportvertrag gegen eine geringe monatliche Gebühr unter Servercow<sup>1</sup>, um die weitere Entwicklung zu unterstützen. Wir unterstützen Sie, während Sie uns unterstützen. :)</p> <p>Wenn Sie super toll sind und uns ohne Vertrag unterstützen möchten, können Sie eine SAL (Stay-Awesome License) erhalten, die Ihre Unterstützung bestätigt (kaufbar als flexible Einmalzahlung) bei Servercow.</p>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"de/#hilfe-gefallig","level":2,"title":"Hilfe gefällig?","text":"<p>Es gibt zwei Möglichkeiten, Support für Ihre mailcow-Installation zu erhalten.</p>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"de/#kommerzieller-support","level":3,"title":"Kommerzieller Support","text":"<p>Für professionellen und priorisierten kommerziellen Support können Sie ein Basis-Support-Abonnement unter Servercow abschließen. Für kundenspezifische Anfragen oder Fragen kontaktieren Sie uns stattdessen bitte unter info@servercow.de.</p> <p>Darüber hinaus bieten wir auch eine voll ausgestattete und verwaltete managed mailcow an. Auf diese Weise kümmern wir uns um alles technische und Sie können Ihr ganzes Mail-Erlebnis auf eine problemlose Weise genießen.</p>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"de/#community-support-und-chat","level":3,"title":"Community Support und Chat","text":"<p>Die Alternative ist unser kostenloser Community-Support auf unseren verschiedenen Kanälen unten. Bitte beachten Sie, dass dieser Support von unserer großartigen Community rund um mailcow betrieben wird. Diese Art von Support ist best-effort, freiwillig und es gibt keine Garantie für irgendetwas.</p> <ul> <li> <p> mailcow Community @ community.mailcow.email</p> </li> <li> <p> Telegram (Support) @ t.me/mailcow</p> </li> <li> <p> Telegram (Off-Topic) @ t.me/mailcowOfftopic</p> </li> </ul> <p>Telegram Desktop-Clients sind für mehrere Plattformen verfügbar. Sie können den Gruppenverlauf nach Stichworten durchsuchen.</p> <p>Nur für Bug Tracking, Feature Requests und Codebeiträge:</p> <ul> <li> mailcow/mailcow-dockerized @ GitHub</li> </ul>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"de/#neuigkeiten-und-release-informationen","level":3,"title":"Neuigkeiten und Release Informationen:","text":"<p>Für Ankündigungen oder Release Informationen sind wir auf folgenden Plattformen vertreten:</p> <ul> <li> <p> mailcow @ X/Twitter</p> </li> <li> <p> @doncow @ mailcow.social</p> </li> </ul> <p>Oder alternativ auf unserem Blog:</p> <ul> <li> mailcow.email</li> </ul>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"de/#neugierig-gleich-ausprobieren","level":2,"title":"Neugierig? Gleich ausprobieren!","text":"<p>Haben wir Ihr Interesse geweckt? Verschaffen Sie sich in unseren offiziellen mailcow Demos einen ersten Überblick über die Funktionalitäten von mailcow und Ihrer mailcow UI!</p> <p>Wir stellen zwei verschiedene Demos bereit: </p> <ul> <li>demo.mailcow.email ist die altbekannte Demo, welche sich am Stabilen Stand der mailcow orrientiert (master Branch auf GitHub). </li> <li>nightly-demo.mailcow.email ist die neue Nightly Demo, welche Testfunktionen beherbergt. (Also insbesondere für alle interessant, die keine Möglichkeit haben sich eine Testinstanz selbst zu erstellen.) (nightly Branch auf GitHub)</li> </ul> <p>Nutzen Sie diese Anmeldedaten für die Demos</p> <ul> <li>Administrator: admin / moohoo</li> <li>Domänen-Administrator: department / moohoo</li> <li>Mailbox: demo@440044.xyz / moohoo</li> </ul> <p>Die Anmeldedaten für die Logins funktionieren bei beiden Varianten</p> <p>Immer auf dem neusten Stand</p> <p>Die Demo Instanzen erhalten die neusten Updates direkt nach Release von GitHub. Vollautomatisch, ohne Downtime!</p> <ol> <li> <p>Servercow ist eine Hosting/Support Sparte der The Infrastructure Company GmbH (mailcow Maintainer) ↩</p> </li> </ol>","path":["mailcow: dockerized - + ="],"tags":[]},{"location":"de/backup_restore/b_n_r-accidental_deletion.de/","level":1,"title":"B n r accidental deletion.de","text":"<p>Sie haben also ein Postfach gelöscht und haben keine Sicherungskopien?</p> <p>Wenn Sie Ihren Fehler innerhalb von ein paar Stunden bemerken, können Sie die Daten des Benutzers wahrscheinlich wiederherstellen.</p>","path":["B n r accidental deletion.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-accidental_deletion.de/#sogo","level":3,"title":"SOGo","text":"<p>Wir erstellen automatisch tägliche Backups (24 Stunden Intervall ab dem ausführen von up -d) in <code>/var/lib/docker/volumes/mailcowdockerized_sogo-userdata-backup-vol-1/_data/</code>.</p> <p>Stellen Sie sicher, dass der Benutzer, den Sie wiederherstellen wollen, in Ihrem mailcow-Backend existiert. Legen Sie diesen neu an, falls nicht mehr existent.</p> <p>Kopieren Sie die Datei mit dem Namen des Benutzers, den Sie wiederherstellen wollen, nach <code>__MAILCOW_DIRECTORY__/data/conf/sogo</code>.</p> <ol> <li> <p>Kopieren Sie die Sicherung: <code>cp /var/lib/docker/volumes/mailcowdockerized_sogo-userdata-backup-vol-1/_data/restoreme@example.org __MAILCOW_DIRECTORY__/data/conf/sogo</code></p> </li> <li> <p>Führen Sie folgenden Befehl aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec -u sogo sogo-mailcow sogo-tool restore -F ALL /etc/sogo restoreme@example.org\n</code></pre> <pre><code>docker-compose exec -u sogo sogo-mailcow sogo-tool restore -F ALL /etc/sogo restoreme@example.org\n</code></pre> <p>Führen Sie <code>sogo-tool</code> ohne Parameter aus, um nach möglichen Wiederherstellungsoptionen zu suchen.</p> </li> <li> <p>Löschen Sie die kopierte Sicherung, indem Sie <code>rm __MAILCOW_DIRECTORY__/data/conf/sogo</code> ausführen</p> </li> <li> <p>Starten Sie SOGo und Memcached neu: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart sogo-mailcow memcached-mailcow\n</code></pre> <pre><code>docker-compose restart sogo-mailcow memcached-mailcow\n</code></pre> </li> </ol>","path":["B n r accidental deletion.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-accidental_deletion.de/#mail","level":3,"title":"Mail","text":"<p>Im Falle einer versehentlichen Löschung einer Mailbox, können Sie diese (standardmäßig) 5 Tage lang wiederherstellen. Dies hängt von dem <code>MAILDIR_GC_TIME</code> Parameter in <code>mailcow.conf</code> ab.</p> <p>Eine gelöschte Mailbox wird in ihrer verschlüsselten Form nach <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/_garbage</code> kopiert.</p> <p>Der Ordner innerhalb von <code>_garbage</code> folgt der Struktur <code>[timestamp]_[domain_sanitized][user_sanitized]</code>, zum Beispiel <code>1629109708_exampleorgtest</code> im Falle von test@example.org, das am 1629109708 gelöscht wurde.</p> <p>Um die Mailbox wiederherzustellen, stellen Sie sicher, dass Sie tatsächlich auf die gleiche mailcow wiederherstellen, von der sie gelöscht wurde, oder Sie die gleichen Verschlüsselungsschlüssel in <code>crypt-vol-1</code> verwenden.</p> <p>Stellen Sie sicher, dass der Benutzer, den Sie wiederherstellen wollen, in Ihrer mailcow existiert. Legen Sie diesen neu an, wenn der Benutzer fehlt.</p> <p>Kopieren Sie die Ordner von <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/_garbage/[timestamp]_[domain_sanitized][user_sanitized]</code> zurück nach <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/[domain]/[user]</code> und synchronisieren Sie die Ordner neu und berechnen Sie die Quota (Speicherplatz) neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm force-resync -u restoreme@example.net '*'\ndocker compose exec dovecot-mailcow doveadm quota recalc -u restoreme@example.net\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm force-resync -u restoreme@example.net '*'\ndocker-compose exec dovecot-mailcow doveadm quota recalc -u restoreme@example.net\n</code></pre>","path":["B n r accidental deletion.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-accidental_deletion.en/","level":1,"title":"B n r accidental deletion.en","text":"<p>So you deleted a mailbox and have no backups, he?</p> <p>If you noticed your mistake within a few hours, you can probably recover the users data.</p>","path":["B n r accidental deletion.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-accidental_deletion.en/#sogo","level":3,"title":"SOGo","text":"<p>We automatically create daily backups (24h interval starting from running up -d) in <code>/var/lib/docker/volumes/mailcowdockerized_sogo-userdata-backup-vol-1/_data/</code>.</p> <p>Make sure the user you want to restore exists in your mailcow. Re-create them if they are missing.</p> <p>Copy the file named after the user you want to restore to <code>__MAILCOW_DIRECTORY__/data/conf/sogo</code>.</p> <ol> <li> <p>Copy the backup: <code>cp /var/lib/docker/volumes/mailcowdockerized_sogo-userdata-backup-vol-1/_data/restoreme@example.org __MAILCOW_DIRECTORY__/data/conf/sogo</code></p> </li> <li> <p>Run the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec -u sogo sogo-mailcow sogo-tool restore -F ALL /etc/sogo restoreme@example.org\n</code></pre> <pre><code>docker-compose exec -u sogo sogo-mailcow sogo-tool restore -F ALL /etc/sogo restoreme@example.org\n</code></pre> <p>Run <code>sogo-tool</code> without parameters to check for possible restore options.</p> </li> <li> <p>Delete the copied backup by running <code>rm __MAILCOW_DIRECTORY__/data/conf/sogo</code></p> </li> <li> <p>Restart SOGo and Memcached: </p> </li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart sogo-mailcow memcached-mailcow\n</code></pre> <pre><code>docker-compose restart sogo-mailcow memcached-mailcow\n</code></pre>","path":["B n r accidental deletion.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-accidental_deletion.en/#mail","level":3,"title":"Mail","text":"<p>In case of an accidental deletion of a mailbox, you will be able to recover for (by default) 5 days. This depends on the <code>MAILDIR_GC_TIME</code> parameter in <code>mailcow.conf</code>.</p> <p>A deleted mailbox is copied in its encrypted form to <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/_garbage</code>.</p> <p>The folder inside <code>_garbage</code> follows the structure <code>[timestamp]_[domain_sanitized][user_sanitized]</code>, for example <code>1629109708_exampleorgtest</code> in case of test@example.org deleted on 1629109708.</p> <p>To restore make sure you are actually restoring to the same mailcow it was deleted from or you use the same encryption keys in <code>crypt-vol-1</code>.</p> <p>Make sure the user you want to restore exists in your mailcow. Re-create them if they are missing.</p> <p>Copy the folders from <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/_garbage/[timestamp]_[domain_sanitized][user_sanitized]</code> back to <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/[domain]/[user]</code> and resync the folder and recalc the quota:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm force-resync -u restoreme@example.net '*'\ndocker compose exec dovecot-mailcow doveadm quota recalc -u restoreme@example.net\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm force-resync -u restoreme@example.net '*'\ndocker-compose exec dovecot-mailcow doveadm quota recalc -u restoreme@example.net\n</code></pre>","path":["B n r accidental deletion.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.de/","level":1,"title":"Backup-Strategie mit rsync und mailcow Backup-Skript","text":"","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.de/#sicherung","level":3,"title":"Sicherung","text":"","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.de/#anleitung","level":4,"title":"Anleitung","text":"<p>Sie können das mitgelieferte Skript <code>helper-scripts/backup_and_restore.sh</code> verwenden, um mailcow automatisch zu sichern.</p> <p>Achtung</p> <p>Bitte kopieren Sie dieses Skript nicht an einen anderen Ort.</p> <p>Um ein Backup zu starten, geben Sie \"backup\" als ersten Parameter an und entweder eine oder mehrere zu sichernde Komponenten als folgende Parameter. Sie können auch \"all\" als zweiten Parameter verwenden, um alle Komponenten zu sichern. Fügen Sie <code>--delete-days n</code> an, um Sicherungen zu löschen, die älter als n Tage sind.</p> <pre><code># Syntax:\n# ./helper-scripts/backup_and_restore.sh backup (vmail|crypt|redis|rspamd|postfix|mysql|all|--delete-days)\n\n# Alles sichern, Sicherungen älter als 3 Tage löschen\n./helper-scripts/backup_and_restore.sh backup all --delete-days 3\n\n# vmail-, crypt- und mysql-Daten sichern, Sicherungen löschen, die älter als 30 Tage sind\n./helper-scripts/backup_and_restore.sh backup vmail crypt mysql --delete-days 30\n\n# vmail sichern\n./helper-scripts/backup_and_restore.sh backup vmail\n</code></pre>","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.de/#variablen-fur-backuprestore-skript","level":4,"title":"Variablen für Backup/Restore Skript","text":"","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.de/#multithreading","level":5,"title":"Multithreading","text":"<p>Seit dem 2022-10 Update ist es möglich das Skript mit Multithreading Support laufen zu lassen. Dies lässt sich sowohl für Backups aber auch für Restores nutzen.</p> <p>Um das Backup/den Restore mit Multithreading zu starten muss <code>THREADS</code> als Umgebungsvariable vor dem Befehl zum starten hinzugefügt werden.</p> <p><pre><code>THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n</code></pre> Die Anzahl hinter dem <code>=</code> Zeichen gibt dabei dann die Thread Anzahl an. Nehmen Sie bitte immer ihre Kernanzahl -2 um mailcow selber noch genug CPU Leistung zu lassen.</p>","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.de/#backup-pfad","level":5,"title":"Backup Pfad","text":"<p>Das Skript wird Sie nach einem Speicherort für die Sicherung fragen. Innerhalb dieses Speicherortes wird es Ordner im Format \"mailcow_DATE\" erstellen. Sie sollten diese Ordner nicht umbenennen, um den Wiederherstellungsprozess nicht zu stören.</p> <p>Um ein Backup unbeaufsichtigt durchzuführen, definieren Sie MAILCOW_BACKUP_LOCATION als Umgebungsvariable, bevor Sie das Skript starten:</p> <pre><code>MAILCOW_BACKUP_LOCATION=/opt/backup /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n</code></pre> <p>Tipp</p> <pre><code>Beide oben genannten Variablen können auch kombiniert werden! Bsp:\n```\nMAILCOW_BACKUP_LOCATION=/opt/backup THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n```\n</code></pre>","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.de/#cronjob","level":4,"title":"Cronjob","text":"<p>Sie können das Backup-Skript regelmäßig über einen Cronjob laufen lassen. Stellen Sie sicher, dass <code>BACKUP_LOCATION</code> existiert:</p> <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n5 4 * * * cd /opt/mailcow-dockerized/; MAILCOW_BACKUP_LOCATION=/mnt/mailcow_backups /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup mysql crypt redis --delete-days 3\n</code></pre> <p>Standardmäßig sendet Cron das komplette Ergebnis jeder Backup-Operation per E-Mail. Wenn Sie möchten, dass cron nur im Fehlerfall (Exit-Code ungleich Null) eine E-Mail sendet, können Sie den folgenden Ausschnitt verwenden. Die Pfade müssen entsprechend Ihrer Einrichtung angepasst werden (dieses Skript ist ein Beitrag eines Benutzers).</p> <p>Das folgende Skript kann in <code>/etc/cron.daily/mailcow-backup</code> platziert werden - vergessen Sie nicht, es mit <code>chmod +x</code> als ausführbar zu markieren:</p> <pre><code>#!/bin/sh\n\n# Backup mailcow data\n# https://docs.mailcow.email/b_n_r_backup/\n\nset -e\n\nOUT=\"$(mktemp)\"\nexport MAILCOW_BACKUP_LOCATION=\"/opt/backup\"\nSCRIPT=\"/opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh\"\nPARAMETERS=\"backup all\"\nOPTIONS=\"--delete-days 30\"\n\n# run command\nset +e\n\"${SCRIPT}\" ${PARAMETERS} ${OPTIONS} 2&gt;&amp;1 &gt; \"$OUT\"\nRESULT=$?\n\nif [ $RESULT -ne 0 ]\n    then\n            echo \"${SCRIPT} ${PARAMETERS} ${OPTIONS} encounters an error:\"\n            echo \"RESULT=$RESULT\"\n            echo \"STDOUT / STDERR:\"\n            cat \"$OUT\"\nfi\n</code></pre>","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.de/#backup-strategie-mit-rsync-und-mailcow-backup-skript","level":1,"title":"Backup-Strategie mit rsync und mailcow Backup-Skript","text":"<p>Erstellen Sie das Zielverzeichnis für mailcows Hilfsskript: <pre><code>mkdir -p /external_share/backups/backup_script\n</code></pre></p> <p>Cronjobs erstellen: <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n25 1 * * * rsync -aH --delete /opt/mailcow-dockerized /external_share/backups/mailcow-dockerized\n40 2 * * * rsync -aH --delete /var/lib/docker/volumes /external_share/backups/var_lib_docker_volumes\n5 4 * * * cd /opt/mailcow-dockerized/; BACKUP_LOCATION=/external_share/backups/backup_script /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup mysql crypt redis --delete-days 3\n# Wenn Sie wollen, benutzen Sie das Werkzeug acl, um die Berechtigungen einiger/aller Ordner/Dateien zu sichern: getfacl -Rn /path\n</code></pre></p> <p>Am Zielort (in diesem Fall <code>/external_share/backups</code>) möchten Sie vielleicht Snapshot-Möglichkeiten haben (ZFS, Btrfs usw.). Machen Sie täglich einen Snapshot und bewahren Sie ihn für n Tage auf, um ein konsistentes Backup zu erhalten. Führen Sie kein rsync auf eine Samba-Freigabe durch, Sie müssen die richtigen Berechtigungen behalten!</p> <p>Zum Wiederherstellen müssen Sie rsync einfach in umgekehrter Richtung ausführen und Docker neu starten, um die Volumes erneut zu lesen. Führen Sie folgende Befehle aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose pull\ndocker compose up -d\n</code></pre> <pre><code>docker-compose pull\ndocker-compose up -d\n</code></pre> <p>Wenn Sie Glück haben, können Redis und MariaDB die inkonsistenten Datenbanken automatisch reparieren (wenn sie inkonsistent sind). Im Falle einer beschädigten Datenbank müssen Sie das Hilfsskript verwenden, um die inkonsistenten Elemente wiederherzustellen. Wenn die Wiederherstellung fehlschlägt, versuchen Sie, die Sicherungen zu extrahieren und die Dateien manuell zurück zu kopieren. Behalten Sie die Dateiberechtigungen bei!</p>","path":["Backup-Strategie mit rsync und mailcow Backup-Skript"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.en/","level":1,"title":"Backup strategy with rsync and mailcow backup script","text":"","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.en/#backup","level":3,"title":"Backup","text":"","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.en/#manual","level":4,"title":"Manual","text":"<p>You can use the provided script <code>helper-scripts/backup_and_restore.sh</code> to backup mailcow automatically.</p> <p>Danger</p> <p>Please do not copy this script to another location.</p> <p>To run a backup, write \"backup\" as first parameter and either one or more components to backup as following parameters. You can also use \"all\" as second parameter to backup all components. Append <code>--delete-days n</code> to delete backups older than n days.</p> <pre><code># Syntax:\n# ./helper-scripts/backup_and_restore.sh backup (vmail|crypt|redis|rspamd|postfix|mysql|all|--delete-days)\n\n# Backup all, delete backups older than 3 days\n./helper-scripts/backup_and_restore.sh backup all --delete-days 3\n\n# Backup vmail, crypt and mysql data, delete backups older than 30 days\n./helper-scripts/backup_and_restore.sh backup vmail crypt mysql --delete-days 30\n\n# Backup vmail\n./helper-scripts/backup_and_restore.sh backup vmail\n</code></pre>","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.en/#variables-for-backuprestore-script","level":4,"title":"Variables for backup/restore script","text":"","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.en/#multithreading","level":5,"title":"Multithreading","text":"<p>With the 2022-10 update it is possible to run the script with multithreading support. This can be used for backups as well as for restores.</p> <p>To start the backup/restore with multithreading you have to add <code>THREADS</code> as an environment variable in front of the command to execute the script.</p> <p><pre><code>THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n</code></pre> The number after the <code>=</code> character indicates the number of threads. Please keep your core count -2 to leave enough CPU power for mailcow itself.</p>","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.en/#backup-path","level":5,"title":"Backup path","text":"<p>The script will ask you for a backup location. Inside of this location it will create folders in the format \"mailcow_DATE\". You should not rename those folders to not break the restore process.</p> <p>To run a backup unattended, define MAILCOW_BACKUP_LOCATION as environment variable before starting the script:</p> <pre><code>MAILCOW_BACKUP_LOCATION=/opt/backup /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n</code></pre> <p>Tip</p> <pre><code>Both variables mentioned above can also be combined! Ex:\n```\nMAILCOW_BACKUP_LOCATION=/opt/backup THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n```\n</code></pre>","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.en/#cronjob","level":4,"title":"Cronjob","text":"<p>You can run the backup script regularly via cronjob. Make sure <code>BACKUP_LOCATION</code> exists:</p> <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n5 4 * * * cd /opt/mailcow-dockerized/; MAILCOW_BACKUP_LOCATION=/mnt/mailcow_backups /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup mysql crypt redis --delete-days 3\n</code></pre> <p>Per default cron sends the full result of each backup operation by email. If you want cron to only mail on error (non-zero exit code) you may want to use the following snippet. Pathes need to be modified according to your setup (this script is a user contribution).</p> <p>This following script may be placed in <code>/etc/cron.daily/mailcow-backup</code> - do not forget to mark it as executable via <code>chmod +x</code>:</p> <pre><code>#!/bin/sh\n\n# Backup mailcow data\n# https://docs.mailcow.email/backup_restore/b_n_r-backup/\n\nset -e\n\nOUT=\"$(mktemp)\"\nexport MAILCOW_BACKUP_LOCATION=\"/opt/backup\"\nSCRIPT=\"/opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh\"\nPARAMETERS=\"backup all\"\nOPTIONS=\"--delete-days 30\"\n\n# run command\nset +e\n\"${SCRIPT}\" ${PARAMETERS} ${OPTIONS} 2&gt;&amp;1 &gt; \"$OUT\"\nRESULT=$?\n\nif [ $RESULT -ne 0 ]\n    then\n            echo \"${SCRIPT} ${PARAMETERS} ${OPTIONS} encounters an error:\"\n            echo \"RESULT=$RESULT\"\n            echo \"STDOUT / STDERR:\"\n            cat \"$OUT\"\nfi\n</code></pre>","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup.en/#backup-strategy-with-rsync-and-mailcow-backup-script","level":1,"title":"Backup strategy with rsync and mailcow backup script","text":"<p>Create the destination directory for mailcows helper script: <pre><code>mkdir -p /external_share/backups/backup_script\n</code></pre></p> <p>Create cronjobs: <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n25 1 * * * rsync -aH --delete /opt/mailcow-dockerized /external_share/backups/mailcow-dockerized\n40 2 * * * rsync -aH --delete /var/lib/docker/volumes /external_share/backups/var_lib_docker_volumes\n5 4 * * * cd /opt/mailcow-dockerized/; BACKUP_LOCATION=/external_share/backups/backup_script /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup mysql crypt redis --delete-days 3\n# If you want to, use the acl util to backup permissions of some/all folders/files: getfacl -Rn /path\n</code></pre></p> <p>On the destination (in this case <code>/external_share/backups</code>) you may want to have snapshot capabilities (ZFS, Btrfs etc.). Snapshot daily and keep for n days for a consistent backup. Do not rsync to a Samba share, you need to keep the correct permissions!</p> <p>To restore you'd simply need to run rsync the other way round and restart Docker to re-read the volumes. Run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose pull\ndocker compose up -d\n</code></pre> <pre><code>docker-compose pull\ndocker-compose up -d\n</code></pre> <p>If you are lucky Redis and MariaDB can automatically fix the inconsistent databases (if they are inconsistent). In case of a corrupted database you'd need to use the helper script to restore the inconsistent elements. If a restore fails, try to extract the backups and copy the files back manually. Keep the file permissions!</p>","path":["Backup strategy with rsync and mailcow backup script"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup_restore-maildir.de/","level":1,"title":"B n r backup restore maildir.de","text":"","path":["B n r backup restore maildir.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup_restore-maildir.de/#sicherung","level":3,"title":"Sicherung","text":"<p>Diese Zeile sichert das vmail-Verzeichnis in eine Datei backup_vmail.tar.gz im mailcow-Root-Verzeichnis:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /pfad/zu/mailcow-dockerized\ndocker run --rm -i -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar cvfz /backup/backup_vmail.tar.gz /vmail\n</code></pre> <pre><code>cd /pfad/zu/mailcow-dockerized\ndocker run --rm -i -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker-compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar cvfz /backup/backup_vmail.tar.gz /vmail\n</code></pre> <p>Sie können den Pfad ändern, indem Sie ${PWD} (das dem aktuellen Verzeichnis entspricht) zu einem beliebigen Pfad ändern, auf den Sie Schreibzugriff haben. Setzen Sie den Dateinamen <code>backup_vmail.tar.gz</code> auf einen beliebigen Namen, aber lassen Sie den Pfad so wie er ist. Beispiel: <code>[...] tar cvfz /backup/mein_eigener_dateiname_.tar.gz</code></p>","path":["B n r backup restore maildir.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup_restore-maildir.de/#wiederherstellen","level":3,"title":"Wiederherstellen","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /pfad/zu/mailcow-dockerized\ndocker run --rm -it -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar xvfz /backup/backup_vmail.tar.gz\n</code></pre> <pre><code>cd /pfad/zu/mailcow-dockerized\ndocker run --rm -it -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker-compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar xvfz /backup/backup_vmail.tar.gz\n</code></pre>","path":["B n r backup restore maildir.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup_restore-maildir.en/","level":1,"title":"B n r backup restore maildir.en","text":"","path":["B n r backup restore maildir.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup_restore-maildir.en/#backup","level":3,"title":"Backup","text":"<p>This line backups the vmail directory to a file backup_vmail.tar.gz in the mailcow root directory:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /path/to/mailcow-dockerized\ndocker run --rm -i -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar cvfz /backup/backup_vmail.tar.gz /vmail\n</code></pre> <pre><code>cd /path/to/mailcow-dockerized\ndocker run --rm -i -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker-compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar cvfz /backup/backup_vmail.tar.gz /vmail\n</code></pre> <p>You can change the path by adjusting ${PWD} (which equals to the current directory) to any path you have write-access to. Set the filename <code>backup_vmail.tar.gz</code> to any custom name, but leave the path as it is. Example: <code>[...] tar cvfz /backup/my_own_filename_.tar.gz</code></p>","path":["B n r backup restore maildir.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup_restore-maildir.en/#restore","level":3,"title":"Restore","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /path/to/mailcow-dockerized\ndocker run --rm -it -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar xvfz /backup/backup_vmail.tar.gz\n</code></pre> <pre><code>cd /path/to/mailcow-dockerized\ndocker run --rm -it -v $(docker inspect --format '{{ range .Mounts }}{{ if eq .Destination \"/var/vmail\" }}{{ .Name }}{{ end }}{{ end }}' $(docker-compose ps -q dovecot-mailcow)):/vmail -v ${PWD}:/backup debian:bullseye-slim tar xvfz /backup/backup_vmail.tar.gz\n</code></pre>","path":["B n r backup restore maildir.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup_restore-mysql.de/","level":1,"title":"B n r backup restore mysql.de","text":"","path":["B n r backup restore mysql.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup_restore-mysql.de/#sicherung","level":2,"title":"Sicherung","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /pfad/zu/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date +\"%Y%m%d_%H%M%S\")\ndocker compose exec -T mysql-mailcow mysqldump --default-character-set=utf8mb4 -u${DBUSER} -p${DBPASS} ${DBNAME} &gt; backup_${DBNAME}_${DATE}.sql\n</code></pre> <pre><code>cd /pfad/zu/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date +\"%Y%m%d_%H%M%S\")\ndocker-compose exec -T mysql-mailcow mysqldump --default-character-set=utf8mb4 -u${DBUSER} -p${DBPASS} ${DBNAME} &gt; backup_${DBNAME}_${DATE}.sql\n</code></pre>","path":["B n r backup restore mysql.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup_restore-mysql.de/#wiederherstellen","level":2,"title":"Wiederherstellen","text":"<p>Warnung</p> docker compose (Plugin)docker-compose (Standalone) <p>Sie sollten den SQL-Dump ohne <code>docker compose</code> umleiten, um Parsing-Fehler zu vermeiden.</p> <p>Sie sollten den SQL-Dump ohne <code>docker-compose</code> umleiten, um Parsing-Fehler zu vermeiden.</p> <pre><code>cd /pfad/zu/mailcow-dockerized\nsource mailcow.conf\ndocker exec -i $(docker compose ps -q mysql-mailcow) mysql -u${DBUSER} -p${DBPASS} ${DBNAME} &lt; backup_file.sql\n</code></pre>","path":["B n r backup restore mysql.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup_restore-mysql.en/","level":1,"title":"B n r backup restore mysql.en","text":"","path":["B n r backup restore mysql.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup_restore-mysql.en/#backup","level":2,"title":"Backup","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /path/to/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date +\"%Y%m%d_%H%M%S\")\ndocker compose exec -T mysql-mailcow mysqldump --default-character-set=utf8mb4 -u${DBUSER} -p${DBPASS} ${DBNAME} &gt; backup_${DBNAME}_${DATE}.sql\n</code></pre> <pre><code>cd /path/to/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date +\"%Y%m%d_%H%M%S\")\ndocker-compose exec -T mysql-mailcow mysqldump --default-character-set=utf8mb4 -u${DBUSER} -p${DBPASS} ${DBNAME} &gt; backup_${DBNAME}_${DATE}.sql\n</code></pre>","path":["B n r backup restore mysql.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-backup_restore-mysql.en/#restore","level":2,"title":"Restore","text":"<p>Warning</p> docker compose (Plugin)docker-compose (Standalone) <p>You should redirect the SQL dump without <code>docker compose</code> to prevent parsing errors.</p> <p>You should redirect the SQL dump without <code>docker-compose</code> to prevent parsing errors.</p> <pre><code>cd /path/to/mailcow-dockerized\nsource mailcow.conf\ndocker exec -i $(docker compose ps -q mysql-mailcow) mysql -u${DBUSER} -p${DBPASS} ${DBNAME} &lt; backup_file.sql\n</code></pre>","path":["B n r backup restore mysql.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-coldstandby.de/","level":1,"title":"Cold-standby-Backup","text":"<p>mailcow bietet eine einfache Möglichkeit, eine konsistente Kopie von sich selbst zu erstellen, die per rsync an einen entfernten Ort ohne Ausfallzeit übertragen werden kann.</p> <p>Dies kann auch verwendet werden, um Ihre mailcow auf einen neuen Server zu übertragen.</p>","path":["Cold-standby-Backup"],"tags":[]},{"location":"de/backup_restore/b_n_r-coldstandby.de/#das-sollten-sie-wissen","level":2,"title":"Das sollten Sie wissen","text":"<p>Das bereitgestellte Skript funktioniert auf Standardinstallationen.</p> <p>Es kann versagen, wenn Sie nicht unterstützte Volume Overrides verwenden. Wir unterstützen das nicht und wir werden keine Hacks einbauen, die das unterstützen. Bitte erstellen und pflegen Sie einen Fork, wenn Sie Ihre Änderungen beibehalten wollen.</p> <p>Das Skript wird die gleichen Pfade wie Ihre Standard-mailcow-Installation verwenden. Das ist das mailcow-Basisverzeichnis - für die meisten Nutzer <code>/opt/mailcow-dockerized</code> - sowie die Mountpoints.</p> <p>Um die Pfade Ihrer Quellvolumes zu finden, verwenden wir <code>docker inspect</code> und lesen das Zielverzeichnis jedes Volumes, das mit Ihrem mailcow compose Projekt verbunden ist. Das bedeutet, dass wir auch Volumes übertragen, die Sie in einer Override-Datei hinzugefügt haben. Lokale Bind-Mounts können funktionieren, müssen aber nicht.</p> <p>Das Skript verwendet rsync mit dem <code>--delete</code> Flag. Das Ziel wird eine exakte Kopie der Quelle sein.</p> <p><code>mariabackup</code> wird verwendet, um eine konsistente Kopie des SQL-Datenverzeichnisses zu erstellen.</p> <p>Nach dem Rsync der Daten führen wir folgenden Befehl aus (anhand der gesetzten docker compose Version in der mailcow.conf) und entfernen alte Image-Tags aus dem Ziel:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose pull\n</code></pre> <pre><code>docker-compose pull\n</code></pre> <p>Ihre Quelle wird zu keinem Zeitpunkt verändert.</p> <p>Sie sollten sicherstellen, dass Sie die gleiche <code>/etc/docker/daemon.json</code> auf dem entfernten Ziel verwenden.</p> <p>Sie sollten keine Festplatten-Snapshots (z. B. über ZFS, LVM usw.) auf dem Ziel ausführen, während dieses Skript ausgeführt wird.</p> <p>Die Versionierung ist nicht Teil dieses Skripts, wir verlassen uns auf das Ziel (Snapshots oder Backups). Sie können dafür auch jedes andere Tool verwenden.</p>","path":["Cold-standby-Backup"],"tags":[]},{"location":"de/backup_restore/b_n_r-coldstandby.de/#vorbereiten","level":2,"title":"Vorbereiten","text":"<p>Sie benötigen ein SSH-fähiges Ziel und eine Schlüsseldatei, um sich mit diesem Ziel zu verbinden. Der Schlüssel sollte nicht durch ein Passwort geschützt sein, damit das Skript unbeaufsichtigt arbeiten kann.</p> <p>In Ihrem mailcow-Basisverzeichnis, z.B. <code>/opt/mailcow-dockerized</code>, finden Sie eine Datei <code>create_cold_standby.sh</code>.</p> <p>Bearbeiten Sie diese Datei und ändern Sie die exportierten Variablen:</p> <pre><code>export REMOTE_SSH_KEY=/pfad/zum/keyfile\nexport REMOTE_SSH_PORT=22\nexport REMOTE_SSH_HOST=mailcow-backup.host.name\n</code></pre> <p>Der Schlüssel muss im Besitz von root sein und darf nur von diesem gelesen werden können.</p> <p>Sowohl die Quelle als auch das Ziel benötigen <code>rsync</code> &gt;= v3.1.0. Das Ziel muss über Docker und docker compose v2 verfügen.</p> <p>Das Skript wird Fehler automatisch erkennen und sich beenden.</p> <p>Sie können die Verbindung testen, indem Sie <code>ssh mailcow-backup.host.name -p22 -i /path/to/keyfile</code> ausführen.</p> Wichtig für den Wechsel auf eine andere Architektur <p>Wenn Sie planen mit dem Cold Standby Skript eine Migration von x86 auf ARM64 bzw. umgekehrt zu machen, lassen Sie das Skript einfach normal laufen. Das Skript wird automatisch erkennen, ob es unterschiede zwischen der Quelle und dem Ziel im Bezug auf die Architektur gibt und sich dementsprechend verhalten und betroffene Volumes im Sync auslassen.</p> <p>Dies hat den Hintergrund, dass Rspamd Regexp Einträge von unseren Konfigurationen auf die entsprechende Plattform kompiliert und bei einem Plattform Wechsel diese Cache Dateien nicht gelesen werden können. Rspamd würde daraufhin abstürzen und eine sinnvolle Nutzung mailcow's damit nicht ermöglichen. Deswegen wird das <code>rspamd-vol-1</code> (Rspamd Volume) im Cold Standby ausgelassen.</p> <p>Keine Sorge! Rspamd wird trotzdem nach der Migration korrekt funktionieren, da diese Cache Dateien selbstständig für die neue Plattform generiert werden.</p>","path":["Cold-standby-Backup"],"tags":[]},{"location":"de/backup_restore/b_n_r-coldstandby.de/#backup-und-aktualisierung-des-cold-standby","level":2,"title":"Backup und Aktualisierung des Cold-Standby","text":"<p>Starten Sie das erste Backup, dies kann je nach Verbindung eine Weile dauern:</p> <pre><code>bash /opt/mailcow-dockerized/create_cold_standby.sh\n</code></pre> <p>Das war einfach, nicht wahr?</p> <p>Das Aktualisieren des Cold-Standby ist genauso einfach:</p> <pre><code>bash /opt/mailcow-dockerized/create_cold_standby.sh\n</code></pre> <p>Es ist derselbe Befehl.</p>","path":["Cold-standby-Backup"],"tags":[]},{"location":"de/backup_restore/b_n_r-coldstandby.de/#automatisierte-backups-mit-cron","level":2,"title":"Automatisierte Backups mit cron","text":"<p>Stellen Sie zunächst sicher, dass der <code>cron</code> Dienst aktiviert ist und läuft:</p> <pre><code>systemctl enable cron.service &amp;&amp; systemctl start cron.service\n</code></pre> <p>Um die Backups auf dem Cold-Standby-Server zu automatisieren, können Sie einen Cron-Job verwenden. Um die Cron-Jobs für den Root-Benutzer zu bearbeiten, führen Sie aus:</p> <pre><code>crontab -e\n</code></pre> <p>Fügen Sie die folgenden Zeilen hinzu, um den Cold-Standby-Server täglich um 03:00 Uhr zu synchronisieren. In diesem Beispiel werden Fehler der letzten Ausführung in einer Datei protokolliert.</p> <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n\n0 3 * * * bash /opt/mailcow-dockerized/create_cold_standby.sh 2&gt; /var/log/mailcow-coldstandby-sync.log\n</code></pre> <p>Wenn korrekt gespeichert, sollte der Cron-Job durch folgende Eingabe angezeigt werden:</p> <pre><code>crontab -l\n</code></pre>","path":["Cold-standby-Backup"],"tags":[]},{"location":"de/backup_restore/b_n_r-coldstandby.en/","level":1,"title":"Cold-standby backup","text":"<p>mailcow offers an easy way to create a consistent copy of itself to be rsync'ed to a remote location without downtime.</p> <p>This may also be used to transfer your mailcow to a new server.</p>","path":["Cold-standby backup"],"tags":[]},{"location":"de/backup_restore/b_n_r-coldstandby.en/#you-should-know","level":2,"title":"You should know","text":"<p>The provided script will work on default installations.</p> <p>It may break when you use unsupported volume overrides. We don't support that and we will not include hacks to support that. Please run and maintain a fork if you plan to keep your changes.</p> <p>The script will use the same paths as your default mailcow installation. That is the mailcow base directory - for most users <code>/opt/mailcow-dockerized</code> - as well as the mountpoints.</p> <p>To find the paths of your source volumes we use <code>docker inspect</code> and read the destination directory of every volume related to your mailcow compose project. This means we will also transfer volumes you may have added in an override file. Local bind mounts may or may not work.</p> <p>The script uses rsync with the <code>--delete</code> flag. The destination will be an exact copy of the source.</p> <p><code>mariabackup</code> is used to create a consistent copy of the SQL data directory.</p> <p>After rsync'ing the data we will run the command below (depending on your set  docker compose type in mailcow.conf) and remove old image tags from the destination:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose pull\n</code></pre> <pre><code>docker-compose pull\n</code></pre> <p>Your source will not be changed at any time.</p> <p>You may want to make sure to use the same <code>/etc/docker/daemon.json</code> on the remote target.</p> <p>You should not run disk snapshots (e.g. via ZFS, LVM etc.) on the target at the very same time as this script is run.</p> <p>Versioning is not part of this script, we rely on the destination (snapshots or backups). You may also want to use any other tool for that.</p>","path":["Cold-standby backup"],"tags":[]},{"location":"de/backup_restore/b_n_r-coldstandby.en/#prepare","level":2,"title":"Prepare","text":"<p>You will need an SSH-enabled destination and a keyfile to connect to said destination. The key should not be protected by a password for the script to work unattended.</p> <p>In your mailcow base directory, e.g. <code>/opt/mailcow-dockerized</code> you will find a file <code>create_cold_standby.sh</code>.</p> <p>Edit this file and change the exported variables:</p> <pre><code>export REMOTE_SSH_KEY=/path/to/keyfile\nexport REMOTE_SSH_PORT=22\nexport REMOTE_SSH_HOST=mailcow-backup.host.name\n</code></pre> <p>The key must be owned and readable by root only.</p> <p>Both the source and destination require <code>rsync</code> &gt;= v3.1.0. The destination must have Docker and docker compose v2 available.</p> <p>The script will detect errors automatically and exit.</p> <p>You may want to test the connection by running <code>ssh mailcow-backup.host.name -p22 -i /path/to/keyfile</code>.</p> Important for switching to a different architecture <p>If you plan to use the Cold Standby script to migrate from x86 to ARM64 or vice versa, simply let the script run normally. The script will automatically recognize whether there are differences between the source and the target in terms of architecture and will behave accordingly and omit affected volumes from the sync.</p> <p>The reason for this is that Rspamd compiles regexp entries from our configurations to the corresponding platform and these cache files cannot be read when changing platforms. Rspamd would then crash and make it impossible to use mailcow in a meaningful way. Therefore the <code>rspamd-vol-1</code> (Rspamd volume) will be ommited during the usage of the Cold-standby script.</p> <p>Don't worry! Rspamd will still work correctly after the migration as it generates these cache files automatically for the new platform.</p>","path":["Cold-standby backup"],"tags":[]},{"location":"de/backup_restore/b_n_r-coldstandby.en/#backup-and-refresh-the-cold-standby","level":2,"title":"Backup and refresh the cold-standby","text":"<p>Run the first backup, this may take a while depending on the connection:</p> <pre><code>bash /opt/mailcow-dockerized/create_cold_standby.sh\n</code></pre> <p>That was easy, wasn't it?</p> <p>Updating your cold-standby is just as easy:</p> <pre><code>bash /opt/mailcow-dockerized/create_cold_standby.sh\n</code></pre> <p>It's the same command.</p>","path":["Cold-standby backup"],"tags":[]},{"location":"de/backup_restore/b_n_r-coldstandby.en/#automated-backups-with-cron","level":2,"title":"Automated backups with cron","text":"<p>First make sure that the <code>cron</code> service is enabled and running:</p> <pre><code>systemctl enable cron.service &amp;&amp; systemctl start cron.service\n</code></pre> <p>To automate the backups to the cold-standby server you can use a cron job. To edit the cron jobs for the root user run:</p> <pre><code>crontab -e\n</code></pre> <p>Add the following lines to synchronize the cold standby server daily at 03:00. In this example errors of the last execution are logged into a file.</p> <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n\n0 3 * * * bash /opt/mailcow-dockerized/create_cold_standby.sh 2&gt; /var/log/mailcow-coldstandby-sync.log\n</code></pre> <p>If saved correctly, the cron job should be shown by typing:</p> <pre><code>crontab -l\n</code></pre>","path":["Cold-standby backup"],"tags":[]},{"location":"de/backup_restore/b_n_r-restore.de/","level":1,"title":"B n r restore.de","text":"","path":["B n r restore.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-restore.de/#wiederherstellung","level":3,"title":"Wiederherstellung","text":"","path":["B n r restore.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-restore.de/#variablen-fur-backuprestore-skript","level":4,"title":"Variablen für Backup/Restore Skript","text":"","path":["B n r restore.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-restore.de/#multithreading","level":5,"title":"Multithreading","text":"<p>Seit dem 2022-10 Update ist es möglich das Skript mit Multithreading Support laufen zu lassen. Dies lässt sich sowohl für Backups aber auch für Restores nutzen.</p> <p>Um das Backup/den Restore mit Multithreading zu starten muss <code>THREADS</code> als Umgebungsvariable vor dem Befehl zum starten hinzugefügt werden.</p> <p><pre><code>THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh restore\n</code></pre> Die Anzahl hinter dem <code>=</code> Zeichen gibt dabei dann die Thread Anzahl an. Nehmen Sie bitte immer ihre Kernanzahl -2 um mailcow selber noch genug CPU Leistung zu lassen.</p>","path":["B n r restore.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-restore.de/#backup-pfad","level":5,"title":"Backup Pfad","text":"<p>Das Skript wird Sie nach einem Speicherort für die Sicherung fragen. Innerhalb dieses Speicherortes wird es Ordner im Format \"mailcow_DATE\" erstellen. Sie sollten diese Ordner nicht umbenennen, um den Wiederherstellungsprozess nicht zu stören.</p> <p>Um ein Backup unbeaufsichtigt durchzuführen, definieren Sie MAILCOW_BACKUP_LOCATION als Umgebungsvariable, bevor Sie das Skript starten:</p> <pre><code>MAILCOW_BACKUP_LOCATION=/opt/backup /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh backup all\n</code></pre> <p>Tipp</p> <p>Beide oben genannten Variablen können auch kombiniert werden! Bsp: <pre><code>MAILCOW_BACKUP_LOCATION=/opt/backup THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh restore\n</code></pre></p>","path":["B n r restore.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-restore.de/#wiederherstellung-der-daten","level":4,"title":"Wiederherstellung der Daten","text":"<p>Achtung</p> <p>Bitte kopieren Sie dieses Skript nicht an einen anderen Ort.</p> <p>Wichtig</p> <p>Um ein Backup auf ein neues System wiederherzustellen muss mailcow initialisiert sein und gestartet sein! Installieren Sie also mailcow nach der Anleitung neu und warten Sie mit der Wiederherstellung so lange, bis mailcow in einem leeren Zustand läuft.</p> <p>Achtung für ältere Installationen</p> <p>Bitte schauen Sie VOR der Wiederherstellung Ihres mailcow Systemes auf einen neuen Server und einem sauberen mailcow-dockerized Ordner, ob in Ihrer mailcow.conf der Wert <code>MAILDIR_SUB</code> gesetzt ist. Falls dieser nicht gesetzt ist, so setzen Sie diesen auch bitte in Ihrer neuen mailcow nicht, bzw. entfernen diesen, da sonst KEINE E-Mails angezeigt werden. Dovecot lädt E-Mails aus dem besagtem Unterordner des Maildir Volumes unter <code>$DOCKER_VOLUME_PFAD/mailcowdockerized_vmail-vol-1</code> und bei Änderung im Vergleich zum Ursprungszustand sind dort keine Mails vorhanden.</p> <p>Um eine Wiederherstellung durchzuführen, starten Sie mailcow, verwenden Sie das Skript mit \"restore\" als ersten Parameter.</p> <pre><code># Syntax:\n# ./helper-scripts/backup_and_restore.sh restore\n</code></pre> <p>Das Skript wird Sie nach einem Speicherort für die Sicherung der mailcow_DATE-Ordner fragen:</p> <pre><code>Backup location (absolute path, starting with /): /opt/backup\n</code></pre> <p>Anschließend werden alle verfügbaren Backups in dem angegebenen Ordner (in unserem Beispiel <code>/opt/backup</code>) angezeigt:</p> <pre><code>Found project name mailcowdockerized\n[ 1 ] - /opt/backup/mailcow-2023-12-11-13-27-14/\n[ 2 ] - /opt/backup/mailcow-2023-12-11-14-02-06/\n</code></pre> <p>Nun können Sie die Nummer Ihres Backups angeben, welches Sie Wiederherstellen wollen, in diesem Beispiel die 2:</p> <pre><code>Select a restore point: 2\n</code></pre> <p>Das Skript wird nun alle gesicherten Komponenten Anzeigen, die Sie wiederherstellen können, in unserem Fall haben wir beim Backup Prozess <code>all</code> also Alles gewählt, dementsprechend taucht das hier nun auf:</p> <pre><code>[ 0 ] - all\n[ 1 ] - Crypt data\n[ 2 ] - Rspamd data\n[ 3 ] - Mail directory (/var/vmail)\n[ 4 ] - Redis DB\n[ 5 ] - Postfix data\n[ 6 ] - SQL DB\n</code></pre> <p>Auch hier wählen wir nun wieder die Komponente aus, die wir wiederherstellen wollen. Option 0 stellt ALLES wieder her.</p> Wenn Sie auf eine andere Architektur wiederherstellen wollen... <p>Sollten Sie das Backup auf einer anderen Architektur bspw. x86 gemacht haben und wollen dieses Backup nun auf ARM64 wiederherstellen, so wird das Backup von Rspamd als inkompatibel angezeigt und ist nicht einzeln anwählbar. Bei der Wiederherstellung mit Aufruf der Taste 0 wird die Wiederherstellung von Rspamd ebenfalls übersprungen.</p> <p>Beispiel für inkompatibles Rspamd Backup im Auswahl Menü:</p> <pre><code>[...]\n[ NaN ] - Rspamd data (incompatible Arch, cannot restore it)\n[...]\n</code></pre> <p>Nun wird mailcow die von Ihnen ausgewählten Sicherungen wiederherstellen. Bitte beachten Sie, dass je nach Größe der Sicherungen die Wiederherstellung eine gewisse Zeit in Anspruch nehmen kann.</p>","path":["B n r restore.de"],"tags":[]},{"location":"de/backup_restore/b_n_r-restore.en/","level":1,"title":"B n r restore.en","text":"","path":["B n r restore.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-restore.en/#restore","level":3,"title":"Restore","text":"","path":["B n r restore.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-restore.en/#variables-for-backuprestore-script","level":4,"title":"Variables for backup/restore script","text":"","path":["B n r restore.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-restore.en/#multithreading","level":5,"title":"Multithreading","text":"<p>With the 2022-10 update it is possible to run the script with multithreading support. This can be used for backups as well as for restores.</p> <p>To start the backup/restore with multithreading you have to add <code>THREADS</code> as an environment variable in front of the command to execute the script.</p> <p><pre><code>THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh restore\n</code></pre> The number after the <code>=</code> character indicates the number of threads. Please keep your core count -2 to leave enough CPU power for mailcow itself.</p>","path":["B n r restore.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-restore.en/#backup-path","level":5,"title":"Backup path","text":"<p>The script will ask you for a backup location. Inside of this location it will create folders in the format \"mailcow_DATE\". You should not rename those folders to not break the restore process.</p> <p>To run a backup unattended, define MAILCOW_BACKUP_LOCATION as environment variable before starting the script:</p> <pre><code>MAILCOW_BACKUP_LOCATION=/opt/backup /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh restore\n</code></pre> <p>Tip</p> <p>Both variables mentioned above can also be combined! Ex: <pre><code>MAILCOW_BACKUP_LOCATION=/opt/backup THREADS=14 /opt/mailcow-dockerized/helper-scripts/backup_and_restore.sh restore\n</code></pre></p>","path":["B n r restore.en"],"tags":[]},{"location":"de/backup_restore/b_n_r-restore.en/#restoring-data","level":4,"title":"Restoring Data","text":"<p>Danger</p> <p>Please do not copy this script to another location.</p> <p>Warning</p> <p>To restore a backup on a new system, mailcow must be initialized and running! Therefore, reinstall mailcow according to the instructions and wait to proceed with the restoration until mailcow is up and running in an empty state.</p> <p>Danger for older installations</p> <p>Before restoring your mailcow system on a new server and a clean mailcow-dockerized folder, please check if the value <code>MAILDIR_SUB</code> is set in your mailcow.conf. If this value is not set, do not set it in your new mailcow or remove it, otherwise NO emails will be displayed. Dovecot loads emails from the mentioned subfolder of the Maildir volume under <code>$DOCKER_VOLUME_PATH/mailcowdockerized_vmail-vol-1</code> and if there is any change compared to the original state, no emails will be available there.</p> <p>To run a restore, start mailcow, use the script with \"restore\" as first parameter.</p> <pre><code># Syntax:\n# ./helper-scripts/backup_and_restore.sh restore\n</code></pre> <p>The script will ask you for a backup location containing the mailcow_DATE folders:</p> <pre><code>Backup location (absolute path, starting with /): /opt/backup\n</code></pre> <p>All available backups in the specified folder (in our example <code>/opt/backup</code>) are then displayed:</p> <pre><code>Found project name mailcowdockerized\n[ 1 ] - /opt/backup/mailcow-2023-12-11-13-27-14/\n[ 2 ] - /opt/backup/mailcow-2023-12-11-14-02-06/\n</code></pre> <p>Now you can enter the number of your backup that you want to restore, in this example the 2nd backup:</p> <pre><code>Select a restore point: 2\n</code></pre> <p>The script will now display all the backed up components that you can restore, in our case we have selected <code>all</code> for the backup process, so this will now appear here:</p> <pre><code>[ 0 ] - all\n[ 1 ] - Crypt data\n[ 2 ] - Rspamd data\n[ 3 ] - Mail directory (/var/vmail)\n[ 4 ] - Redis DB\n[ 5 ] - Postfix data\n[ 6 ] - SQL DB\n</code></pre> <p>Again, we select the component that we want to restore. Option 0 restores EVERYTHING.</p> If you want to restore to a different architecture... <p>If you have made the backup on a different architecture, e.g. x86, and now want to restore this backup to ARM64, the backup of Rspamd is displayed as incompatible and cannot be selected individually. When restoring with the 0 key, the restoration of Rspamd is also skipped.</p> <p>Example of incompatible Rspamd backup in the selection menu:</p> <pre><code>[...]\n[ NaN ] - Rspamd data (incompatible Arch, cannot restore it)\n[...]\n</code></pre> <p>Now mailcow will restore the backups you have selected. Please note that the restoration may take some time, depending on the size of the backups.</p>","path":["B n r restore.en"],"tags":[]},{"location":"de/client/client-android.de/","level":1,"title":"Client android.de","text":"<ol> <li>Öffnen Sie die App Email.</li> <li>Wenn dies Ihr erstes E-Mail-Konto ist, tippen Sie auf Konto hinzufügen; wenn nicht, tippen Sie auf Mehr und Einstellungen und dann Konto hinzufügen.</li> <li>Wählen Sie Microsoft Exchange ActiveSync.</li> <li>Geben Sie Ihre E-Mail Adresse () und Ihr Passwort ein.</li> <li>Tippen Sie auf Anmelden.</li> </ol>","path":["Client android.de"],"tags":[]},{"location":"de/client/client-android.en/","level":1,"title":"Client android.en","text":"<ol> <li>Open the Email app.</li> <li>If this is your first email account, tap Add Account; if not, tap More and Settings and then Add account.</li> <li>Select Microsoft Exchange ActiveSync.</li> <li>Enter your email address () and password.</li> <li>Tap Sign in.</li> </ol>","path":["Client android.en"],"tags":[]},{"location":"de/client/client-apple.de/","level":1,"title":"Client apple.de","text":"","path":["Client apple.de"],"tags":[]},{"location":"de/client/client-apple.de/#methode-1-konfigurationsprofil","level":2,"title":"Methode 1: Konfigurationsprofil","text":"<p>E-Mail, Kontakte und Kalender können auf Apple-Geräten automatisch konfiguriert werden, indem ein Konfigurationsprofil installiert wird. Um ein solches Profil herunterzuladen, müssen Sie sich mit dem gewünschten E-Mail-Konto in der mailcow UI anmelden.</p>","path":["Client apple.de"],"tags":[]},{"location":"de/client/client-apple.de/#methode-11-imap-und-smtp","level":2,"title":"Methode 1.1: IMAP und SMTP","text":"<p>Diese Methode konfiguriert IMAP und SMTP für den Zugriff auf ein E-Mail-Konto.</p> <ol> <li>Öffnen Sie https://${MAILCOW_HOSTNAME}/mobileconfig.php?only_emailmailcow.mobileconfig um ein individuelles Konfigurationsprofil herunterzuladen.</li> <li>Öffnen Sie das Profil auf Ihrem Mac, iPhone oder iPad und folgen Sie der Anleitung von Apple für Ihre Betriebssystemversion, um das Profil zu installieren:<ul> <li>Anleitung für macOS</li> <li>Anleitung für iOS</li> </ul> </li> <li>Da das Profil nicht digital signiert ist, müssen Sie den entsprechenden Hinweis bei der Installation bestätigen. Wenn Sie dazu aufgefordert werden, geben Sie das Passwort Ihres E-Mail-Kontos ein.</li> </ol>","path":["Client apple.de"],"tags":[]},{"location":"de/client/client-apple.de/#methode-12-imap-smtp-und-calcarddav","level":2,"title":"Methode 1.2: IMAP, SMTP und Cal/CardDAV","text":"<p>Diese Methode konfiguriert neben dem E-Mail-Konto zusätzlich CardDAV (Adressbuch) und CalDAV (Kalender).</p> <ol> <li>Öffnen Sie https://${MAILCOW_HOSTNAME}/mobileconfig.phpmailcow.mobileconfig um ein individuelles Konfigurationsprofil herunterzuladen.</li> <li>Öffnen Sie das Profil auf Ihrem Mac, iPhone oder iPad und folgen Sie der Anleitung von Apple für Ihre Betriebssystemversion, um das Profil zu installieren:<ul> <li>Anleitung für macOS</li> <li>Anleitung für iOS</li> </ul> </li> <li>Da das Profil nicht digital signiert ist, müssen Sie den entsprechenden Hinweis bei der Installation bestätigen. Wenn Sie dazu aufgefordert werden, geben Sie das Passwort Ihres E-Mail-Kontos ein.</li> </ol>","path":["Client apple.de"],"tags":[]},{"location":"de/client/client-apple.de/#methode-13-imap-und-smtp-mit-app-passwort","level":2,"title":"Methode 1.3: IMAP und SMTP mit App-Passwort","text":"<p>Diese Methode konfiguriert IMAP und SMTP für den Zugriff auf ein E-Mail-Konto. Es wird ein neues App-Passwort erzeugt und in das Profil eingefügt, damit bei der Einrichtung kein Passwort eingegeben werden muss. Geben Sie das Profil nicht weiter, da es einen vollständigen Zugriff auf Ihr Postfach ermöglicht.</p> <ol> <li>Öffnen Sie https://${MAILCOW_HOSTNAME}/mobileconfig.php?only_email&amp;app_passwordmailcow.mobileconfig um ein individuelles Konfigurationsprofil herunterzuladen.</li> <li>Öffnen Sie das Profil auf Ihrem Mac, iPhone oder iPad und folgen Sie der Anleitung von Apple für Ihre Betriebssystemversion, um das Profil zu installieren:<ul> <li>Anleitung für macOS</li> <li>Anleitung für iOS</li> </ul> </li> <li>Da das Profil nicht digital signiert ist, müssen Sie den entsprechenden Hinweis bei der Installation bestätigen.</li> </ol>","path":["Client apple.de"],"tags":[]},{"location":"de/client/client-apple.de/#methode-14-imap-smtp-und-calcarddav-mit-app-passwort","level":2,"title":"Methode 1.4: IMAP, SMTP und Cal/CardDAV mit App-Passwort","text":"<p>Diese Methode konfiguriert neben dem E-Mail-Konto zusätzlich CardDAV (Adressbuch) und CalDAV (Kalender). Es wird ein neues App-Passwort erzeugt und in das Profil eingefügt, damit bei der Einrichtung kein Passwort eingegeben werden muss. Geben Sie das Profil nicht weiter, da es einen vollständigen Zugriff auf Ihr Postfach ermöglicht.</p> <ol> <li>Öffnen Sie https://${MAILCOW_HOSTNAME}/mobileconfig.php?app_passwordmailcow.mobileconfig um ein individuelles Konfigurationsprofil herunterzuladen.</li> <li>Öffnen Sie das Profil auf Ihrem Mac, iPhone oder iPad und folgen Sie der Anleitung von Apple für Ihre Betriebssystemversion, um das Profil zu installieren:<ul> <li>Anleitung für macOS</li> <li>Anleitung für iOS</li> </ul> </li> <li>Da das Profil nicht digital signiert ist, müssen Sie den entsprechenden Hinweis bei der Installation bestätigen.</li> </ol>","path":["Client apple.de"],"tags":[]},{"location":"de/client/client-apple.de/#methode-2-exchange-activesync-emulation","level":2,"title":"Methode 2: Exchange ActiveSync-Emulation","text":"<p>Unter iOS/iPadOS wird auch Exchange ActiveSync als Alternative zum obigen Verfahren unterstützt. Es hat den Vorteil, dass es Push-E-Mail unterstützt (d. h. Sie werden sofort über eingehende Nachrichten benachrichtigt), hat aber einige Einschränkungen, z. B. unterstützt es nicht mehr als drei E-Mail-Adressen pro Kontakt in Ihrem Adressbuch. Befolgen Sie die folgenden Schritte, wenn Sie stattdessen Exchange verwenden möchten.</p> <ol> <li>Folgen Sie der Anleitung von Apple für Ihre Version von iOS/iPadOS und wählen Sie Microsoft Exchange als E-Mail-Dienst.</li> <li>Geben Sie Ihre E-Mail Adresse () ein und tippen Sie auf Weiter.</li> <li>Wählen Sie Manuell konfigurieren bei der Frage, ob die E-Mail-Adresse an Microsoft gesendet werden soll.</li> <li>Geben Sie Ihr Passwort ein und tippen Sie erneut auf Weiter. Wenn die 2-Faktor-Authentifizierung aktiviert ist, müssen Sie ein App-Password anstelle Ihres normalen Passwortes benutzen.</li> <li>Tippen Sie abschließend auf Speichern.</li> </ol>","path":["Client apple.de"],"tags":[]},{"location":"de/client/client-apple.en/","level":1,"title":"Client apple.en","text":"","path":["Client apple.en"],"tags":[]},{"location":"de/client/client-apple.en/#method-1-configuration-profile","level":2,"title":"Method 1: Configuration Profile","text":"<p>Email, contacts and calendars can be configured automatically on Apple devices by installing a configuration profile. To download such a profile you must login to the mailcow UI with the desired email account first.</p>","path":["Client apple.en"],"tags":[]},{"location":"de/client/client-apple.en/#method-11-imap-and-smtp","level":2,"title":"Method 1.1: IMAP and SMTP","text":"<p>This method configures IMAP and SMTP to access an email account.</p> <ol> <li>Open  https://${MAILCOW_HOSTNAME}/mobileconfig.php?only_emailmailcow.mobileconfig to download a customized configuration profile.</li> <li>Open the profile on your Mac, iPhone or iPad and follow Apple's instructions for your operating system version to install the profile:<ul> <li>Steps for macOS</li> <li>Steps for iOS</li> </ul> </li> <li>Since the profile is not digitally signed, you must confirm the respective notification during installation. Enter the password for your email account when asked.</li> </ol>","path":["Client apple.en"],"tags":[]},{"location":"de/client/client-apple.en/#method-12-imap-smtp-and-calcarddav","level":2,"title":"Method 1.2: IMAP, SMTP and Cal/CardDAV","text":"<p>This method configures CardDAV (address book) and CalDAV (calendar) in addition to the email account.</p> <ol> <li>Open  https://${MAILCOW_HOSTNAME}/mobileconfig.phpmailcow.mobileconfig to download a customized configuration profile.</li> <li>Open the profile on your Mac, iPhone or iPad and follow Apple's instructions for your operating system version to install the profile:<ul> <li>Steps for macOS</li> <li>Steps for iOS</li> </ul> </li> <li>Since the profile is not digitally signed, you must confirm the respective notification during installation. Enter the password for your email account when asked.</li> </ol>","path":["Client apple.en"],"tags":[]},{"location":"de/client/client-apple.en/#method-13-imap-and-smtp-with-app-password","level":2,"title":"Method 1.3: IMAP and SMTP with App Password","text":"<p>This method configures IMAP and SMTP to access an email account. A new app password is generated and added to the profile so that no password needs to be entered when setting up your device. Please do not share the file as it grants full access to your mailbox.</p> <ol> <li>Open  https://${MAILCOW_HOSTNAME}/mobileconfig.php?only_email&amp;app_passwordmailcow.mobileconfig to download a customized configuration profile.</li> <li>Open the profile on your Mac, iPhone or iPad and follow Apple's instructions for your operating system version to install the profile:<ul> <li>Steps for macOS</li> <li>Steps for iOS</li> </ul> </li> <li>Since the profile is not digitally signed, you must confirm the respective notification during installation. Enter the password for your email account when asked.</li> </ol>","path":["Client apple.en"],"tags":[]},{"location":"de/client/client-apple.en/#method-14-imap-smtp-and-calcarddav-with-app-password","level":2,"title":"Method 1.4: IMAP, SMTP and Cal/CardDAV with App Password","text":"<p>This method configures CardDAV (address book) and CalDAV (calendar) in addition to the email account. A new app password is generated and added to the profile so that no password needs to be entered when setting up your device. Please do not share the file as it grants full access to your mailbox.</p> <ol> <li>Open  https://${MAILCOW_HOSTNAME}/mobileconfig.php?app_passwordmailcow.mobileconfig to download a customized configuration profile.</li> <li>Open the profile on your Mac, iPhone or iPad and follow Apple's instructions for your operating system version to install the profile:<ul> <li>Steps for macOS</li> <li>Steps for iOS</li> </ul> </li> <li>Since the profile is not digitally signed, you must confirm the respective notification during installation. Enter the password for your email account when asked.</li> </ol>","path":["Client apple.en"],"tags":[]},{"location":"de/client/client-apple.en/#method-2-exchange-activesync-emulation","level":2,"title":"Method 2: Exchange ActiveSync emulation","text":"<p>On iOS/iPadOS, Exchange ActiveSync is also supported as an alternative to the procedure above. It has the advantage of supporting push email (i.e. you are immediately notified of incoming messages), but has some limitations, e.g. it does not support more than three email addresses per contact in your address book. Follow the steps below if you decide to use Exchange instead.</p> <ol> <li>Follow Apple's instructions for your version of iOS/iPadOS and select Microsoft Exchange as email service.</li> <li>Enter your email address () and tap Next.</li> <li>Select Manual Configuration when asked if your mail address should be sent to Microsoft.</li> <li>Enter your password, tap Next again. With Two-factor authentication enabled, you have to use an app password instead of your regular password.</li> <li>Finally, tap Save.</li> </ol>","path":["Client apple.en"],"tags":[]},{"location":"de/client/client-emclient.de/","level":1,"title":"Client emclient.de","text":"<ol> <li>Starten Sie eM Client.</li> <li>Wenn Sie eM Client zum ersten Mal starten, werden Sie aufgefordert, Ihr Konto einzurichten. Fahren Sie mit Schritt 4 fort.</li> <li>Gehen Sie oben auf Menü, wählen Sie Tools und Konten.</li> <li>Geben Sie Ihre E-Mail Adresse ein () und klicken Sie auf Jetzt starten.</li> <li>Geben Sie Ihr Passwort ein und klicken Sie auf Weiter.</li> <li>Geben Sie Ihren Namen ein () und klicken Sie auf Weiter.</li> <li>Klicken Sie auf Fertigstellen.</li> </ol>","path":["Client emclient.de"],"tags":[]},{"location":"de/client/client-emclient.en/","level":1,"title":"Client emclient.en","text":"<ol> <li>Launch eM Client.</li> <li>If this is the first time you launched eM Client, it asks you to set up your account. Proceed to step 4.</li> <li>Go to Menu at the top, select Tools and Accounts.</li> <li>Enter your email address () and click Start Now.</li> <li>Enter your password and click Continue.</li> <li>Enter your name () and click Next.</li> <li>Click Finish.</li> </ol>","path":["Client emclient.en"],"tags":[]},{"location":"de/client/client-kontact.de/","level":1,"title":"Client kontact.de","text":"<ol> <li>Starten Sie Kontact.</li> <li>Wenn Sie Kontact oder KMail zum ersten Mal gestartet haben, werden Sie aufgefordert, Ihr Konto einzurichten. Fahren Sie mit Schritt 4 fort.</li> <li>Gehen Sie zu Mail in der Seitenleiste. Gehen Sie zum Menü Tools und wählen Sie Account Wizard.</li> <li>Geben Sie Ihren Namen  (), E-Mail Adresse () und Ihr Passwort ein. Klicken Sie auf Weiter.</li> <li>Klicken Sie auf Konto erstellen. Wenn Sie dazu aufgefordert werden, geben Sie Ihr Passwort erneut ein und klicken Sie auf OK.</li> <li>Schließen Sie das Fenster, indem Sie auf Beenden klicken.</li> <li>Gehen Sie zu Kalender in der Seitenleiste.</li> <li>Gehen Sie zum Menü Einstellungen und wählen Sie Konfigurieren Sie KOrganizer.</li> <li>Gehen Sie zur Registerkarte Kalender und klicken Sie auf die Schaltfläche Hinzufügen.</li> <li>Wählen Sie DAV-Groupware-Ressource und klicken Sie auf OK.</li> <li>Geben Sie Ihre E-Mail Adresse () und Ihr Passwort ein. Klicken Sie auf Weiter.</li> <li>Wählen Sie ScalableOGo aus dem Dropdown-Menü und klicken Sie auf Weiter.</li> <li>Geben Sie den  mailcow Hostname in das Feld Host ein und klicken Sie auf Weiter.</li> <li>Klicken Sie auf Verbindung testen und dann auf Fertigstellen. Klicken Sie abschließend zweimal auf OK.</li> </ol> <p>Sobald Sie Kontact eingerichtet haben, können Sie KMail, KOrganizer und KAddressBook auch einzeln verwenden.</p>","path":["Client kontact.de"],"tags":[]},{"location":"de/client/client-kontact.en/","level":1,"title":"Client kontact.en","text":"<ol> <li>Launch Kontact.</li> <li>If this is the first time you launched Kontact or KMail, it asks you to set up your account. Proceed to step 4.</li> <li>Go to Mail in the sidebar. Go to the Tools menu and select Account Wizard.</li> <li>Enter your name (), email address () and your password. Click Next.</li> <li>Click Create Account. If prompted, re-enter your password and click OK.</li> <li>Close the window by clicking Finish.</li> <li>Go to Calendar in the sidebar.</li> <li>Go to the Settings menu and select Configure KOrganizer.</li> <li>Go to the Calendars tab and click the Add button.</li> <li>Choose DAV groupware resource and click OK.</li> <li>Enter your email address () and your password. Click Next.</li> <li>Select ScalableOGo from the dropdown menu and click Next.</li> <li>Enter  your mailcow hostname into the Host field and click Next.</li> <li>Click Test Connection and then Finish. Finally, click OK twice.</li> </ol> <p>Once you have set up Kontact, you can also use KMail, KOrganizer and KAddressBook individually.</p>","path":["Client kontact.en"],"tags":[]},{"location":"de/client/client-manual.de/","level":1,"title":"Client manual.de","text":"<p>Diese Anweisungen gelten nur für unveränderte Portbindungen!</p>","path":["Client manual.de"],"tags":[]},{"location":"de/client/client-manual.de/#e-mail","level":2,"title":"E-Mail","text":"Dienst Verschlüsselung Host Port IMAP STARTTLS mailcow hostname 143 IMAPS SSL mailcow hostname 993 POP3 STARTTLS mailcow hostname 110 POP3S SSL mailcow hostname 995 SMTP STARTTLS mailcow hostname 587 SMTPS SSL mailcow hostname 465 <p>Bitte verwenden Sie \"plain\" als Authentifizierungsmechanismus. Entgegen der Annahme werden keine Passwörter im Klartext übertragen, da ohne TLS keine Authentifizierung stattfinden darf.</p>","path":["Client manual.de"],"tags":[]},{"location":"de/client/client-manual.de/#kontakte-und-kalender","level":2,"title":"Kontakte und Kalender","text":"<p>SOGos Standard-URLs für Kalender (CalDAV) und Kontakte (CardDAV):</p> <ol> <li> <p>CalDAV https://mail.example.com/SOGo/dav/user@example.com/Calendar/personal/https:///SOGo/dav//Calendar/personal/</p> </li> <li> <p>CardDAV https://mail.example.com/SOGo/dav/user@example.com/Contacts/personal/https:///SOGo/dav//Contacts/personal/</p> </li> </ol> <p>Einige Anwendungen verlangen möglicherweise die Verwendung von https://mail.example.com/SOGo/dav/https:///SOGo/dav/ oder den vollständigen Pfad zu Ihrem Kalender, der in SOGo gefunden und kopiert werden kann.</p>","path":["Client manual.de"],"tags":[]},{"location":"de/client/client-manual.en/","level":1,"title":"Client manual.en","text":"<p>These instructions are valid for unchanged port bindings only!</p>","path":["Client manual.en"],"tags":[]},{"location":"de/client/client-manual.en/#email","level":2,"title":"Email","text":"Service Encryption Host Port IMAP STARTTLS mailcow hostname 143 IMAPS SSL mailcow hostname 993 POP3 STARTTLS mailcow hostname 110 POP3S SSL mailcow hostname 995 SMTP STARTTLS mailcow hostname 587 SMTPS SSL mailcow hostname 465 <p>Please use the \"plain\" password setting as the authentication mechanism. Contrary to what the name implies, the password will not be transferred to the server in plain text as no authentication is allowed to take place without TLS.</p>","path":["Client manual.en"],"tags":[]},{"location":"de/client/client-manual.en/#contacts-and-calendars","level":2,"title":"Contacts and calendars","text":"<p>SOGos default calendar (CalDAV) and contacts (CardDAV) URLs:</p> <ol> <li> <p>CalDAV https://mail.example.com/SOGo/dav/user@example.com/Calendar/personal/https:///SOGo/dav//Calendar/personal/</p> </li> <li> <p>CardDAV https://mail.example.com/SOGo/dav/user@example.com/Contacts/personal/https:///SOGo/dav//Contacts/personal/</p> </li> </ol> <p>Some applications may require you to use https://mail.example.com/SOGo/dav/https:///SOGo/dav/ or the full path to your calendar, which can be found and copied from within SOGo.</p>","path":["Client manual.en"],"tags":[]},{"location":"de/client/client-outlook.de/","level":1,"title":"Client outlook.de","text":"<ol> <li>Downloaden und installieren Sie Outlook CalDav Synchronizer.</li> <li>Starten Sie Outlook.</li> <li>Wenn Sie Outlook zum ersten Mal gestartet haben, werden Sie aufgefordert, Ihr Konto einzurichten. Fahren Sie mit Schritt 5 fort.</li> <li>Gehen Sie zum Menü Datei und klicken Sie auf Konto hinzufügen.</li> <li>Geben Sie Ihren Namen (), Ihre E-Mail Adresse () und Ihr Passwort ein. Klicken Sie auf Weiter.</li> <li>Klicken Sie auf Finish.</li> <li>Gehen Sie zur Multifunktionsleiste CalDav Synchronizer und klicken Sie auf Synchronisationsprofile.</li> <li>Klicken Sie auf die zweite Schaltfläche oben (Mehrere Profile hinzufügen), wählen Sie Sogo und klicken Sie auf Ok.</li> <li>Klicken Sie auf die Schaltfläche IMAP/POP3-Kontoeinstellungen abrufen.</li> <li>Klicken Sie auf Ressourcen erkennen und Outlook-Ordnern zuweisen.</li> <li>Wählen Sie im Fenster Ressource auswählen Ihren Hauptkalender (in der Regel Persönlicher Kalender), klicken Sie auf die Schaltfläche ..., weisen Sie ihn dem Ordner Kalender zu, und klicken Sie auf OK. Gehen Sie zu den Registerkarten Adressbücher und Aufgaben und wiederholen Sie den Vorgang entsprechend. Weisen Sie nicht mehreren Kalendern, Adressbüchern oder Aufgabenlisten zu!</li> <li>Schließen Sie alle Fenster mit den Tasten OK.</li> </ol>","path":["Client outlook.de"],"tags":[]},{"location":"de/client/client-outlook.de/#outlook-2016-oder-hoher-von-office-365-unter-windows","level":2,"title":"Outlook 2016 oder höher von Office 365 unter Windows","text":"<p>Dies gilt nur, wenn Ihr Serveradministrator EAS für Outlook nicht deaktiviert hat. Wenn es deaktiviert ist, folgen Sie bitte stattdessen der Anleitung für Outlook 2007.</p> <p>Outlook 2016 hat ein Problem mit der automatischen Erkennung. Nur Outlook von Office 365 ist betroffen. Wenn Sie Outlook aus einer anderen Quelle installiert haben, folgen Sie bitte der Anleitung für Outlook 2013 oder höher. </p> <p>Für EAS müssen Sie den alten Assistenten verwenden, indem Sie <code>C:\\Program Files (x86)\\Microsoft Office\\root\\Office16\\OLCFG.EXE</code> starten. Wenn diese Anwendung geöffnet wird, können Sie mit Schritt 4 der Anleitung für Outlook 2013 unten fortfahren.</p> <p>Wenn die Anwendung nicht geöffnet wird, können Sie den Assistenten zum Erstellen eines neuen Kontos vollständig deaktivieren und die nachstehende Anleitung für Outlook 2013 befolgen.</p>","path":["Client outlook.de"],"tags":[]},{"location":"de/client/client-outlook.de/#outlook-2007-oder-hoher-auf-windows-kalenderkontakte-via-caldav-synchronizer","level":2,"title":"Outlook 2007 oder höher auf Windows (Kalender/Kontakte via CalDav Synchronizer)","text":"","path":["Client outlook.de"],"tags":[]},{"location":"de/client/client-outlook.de/#outlook-2013-oder-hoher-unter-windows-active-sync-nicht-empfohlen","level":2,"title":"Outlook 2013 oder höher unter Windows (Active Sync - nicht empfohlen)","text":"<p>Dies gilt nur, wenn Ihr Serveradministrator EAS für Outlook nicht deaktiviert hat. Wenn es deaktiviert ist, folgen Sie bitte stattdessen der Anleitung für Outlook 2007.</p> <ol> <li>Starten Sie Outlook.</li> <li>Wenn Sie Outlook zum ersten Mal gestartet haben, werden Sie aufgefordert, Ihr Konto einzurichten. Fahren Sie mit Schritt 4 fort.</li> <li>Öffnen Sie das Menü Datei und klicken Sie auf Konto hinzufügen.</li> <li>Geben Sie Ihren Namen (), Ihre E-Mail Adresse () und Ihr Passwort ein. Klicken Sie auf Weiter.</li> <li>Wenn Sie dazu aufgefordert werden, geben Sie Ihr Passwort erneut ein, markieren Sie Meine Anmeldedaten speichern und klicken Sie auf OK.</li> <li>Klicken Sie auf die Schaltfläche Zulassen.</li> <li>Klicken Sie auf Fertigstellen.</li> </ol>","path":["Client outlook.de"],"tags":[]},{"location":"de/client/client-outlook.de/#outlook-2011-oder-hoher-unter-macos","level":2,"title":"Outlook 2011 oder höher unter macOS","text":"<p>Die Mac-Version von Outlook synchronisiert keine Kalender und Kontakte und wird daher nicht unterstützt.</p>","path":["Client outlook.de"],"tags":[]},{"location":"de/client/client-outlook.en/","level":1,"title":"Client outlook.en","text":"<ol> <li>Download and install Outlook CalDav Synchronizer.</li> <li>Launch Outlook.</li> <li>If this is the first time you launched Outlook, it asks you to set up your account. Proceed to step 5.</li> <li>Go to the File menu and click Add Account.</li> <li>Enter your name (), email address () and your password. Click Next.</li> <li>Click Finish.</li> <li>Go to the CalDav Synchronizer ribbon and click Synchronization Profiles.</li> <li>Click the second button at top (Add multiple profiles), select Sogo, click Ok.</li> <li>Click the Get IMAP/POP3 account settings button.</li> <li>Click Discover resources and assign to Outlook folders.</li> <li>In the Select Resource window that pops up, select your main calendar (usually Personal Calendar), click the ... button, assign it to Calendar, and click OK. Go to the Address Books and Tasks tabs and repeat repeat the process accordingly. Do not assign multiple calendars, address books or task lists!</li> <li>Close all windows with the OK buttons.</li> </ol>","path":["Client outlook.en"],"tags":[]},{"location":"de/client/client-outlook.en/#outlook-2016-or-higher-from-office-365-on-windows","level":2,"title":"Outlook 2016 or higher from Office 365 on Windows","text":"<p>This is only applicable if your server administrator has not disabled EAS for Outlook. If it is disabled, please follow the guide for Outlook 2007 instead.</p> <p>Outlook 2016 has an issue with autodiscover. Only Outlook from Office 365 is affected. If you installed Outlook from another source, please follow the guide for Outlook 2013 or higher. </p> <p>For EAS you must use the old assistant by launching <code>C:\\Program Files (x86)\\Microsoft Office\\root\\Office16\\OLCFG.EXE</code>. If this application opens, you can go to step 4 of the guide for Outlook 2013 below.</p> <p>If it does not open, you can completely disable the new account creation wizard and follow the guide for Outlook 2013 below.</p>","path":["Client outlook.en"],"tags":[]},{"location":"de/client/client-outlook.en/#outlook-2007-or-2010-on-windows","level":2,"title":"Outlook 2007 or 2010 on Windows","text":"","path":["Client outlook.en"],"tags":[]},{"location":"de/client/client-outlook.en/#outlook-2007-or-higher-on-windows-calendercontacts-via-caldav-synchronizer","level":2,"title":"Outlook 2007 or higher on Windows (Calender/Contacts via CalDav Synchronizer)","text":"","path":["Client outlook.en"],"tags":[]},{"location":"de/client/client-outlook.en/#outlook-2013-or-higher-on-windows-active-sync-not-recommended","level":2,"title":"Outlook 2013 or higher on Windows (Active Sync - not recommended)","text":"<p>This is only applicable if your server administrator has not disabled EAS for Outlook. If it is disabled, please follow the guide for Outlook 2007 instead.</p> <ol> <li>Launch Outlook.</li> <li>If this is the first time you launched Outlook, it asks you to set up your account. Proceed to step 4.</li> <li>Go to the File menu and click Add Account.</li> <li>Enter your name (), email address () and your password. Click Next.</li> <li>When prompted, enter your password again, check Remember my credentials and click OK.</li> <li>Click the Allow button.</li> <li>Click Finish.</li> </ol>","path":["Client outlook.en"],"tags":[]},{"location":"de/client/client-outlook.en/#outlook-2011-or-higher-on-macos","level":2,"title":"Outlook 2011 or higher on macOS","text":"<p>The Mac version of Outlook does not synchronize calendars and contacts and therefore is not supported.</p>","path":["Client outlook.en"],"tags":[]},{"location":"de/client/client-thunderbird.de/","level":1,"title":"Client thunderbird.de","text":"<ol> <li>   Öffnen Sie Thunderbird. </li> <li>   Wenn Sie Thunderbird zum ersten Mal öffnen, werden Sie gefragt, ob Sie eine neue E-Mail-Adresse einrichten möchten. Klicken Sie auf Überspringen und eine bereits vorhandene E-Mail-Adresse verwenden und gehen Sie zum Schritt 4. </li> <li>   Klicken Sie auf das Menü Datei und wählen Sie Neu, Bestehendes Mail-Konto.... </li> <li>   Geben Sie Ihren Namen (), Ihre E-Mail-Adresse () und Ihr Passwort ein. Stellen Sie sicher, dass die Option Passwort merken aktiviert ist und klicken Sie auf Weiter. </li> <li>   Sobald die Konfiguration automatisch erkannt wurde, stellen Sie sicher, dass IMAP ausgewählt ist und klicken Sie auf Fertig. </li> <li>   Um Ihre Kontakte vom Server zu verwenden, klicken Sie auf den Pfeil neben \"Adressbücher\" und auf die Schaltfläche Verbinden für jedes Adressbuch, das Sie verwenden möchten. </li> <li>   Um Ihre Kalender vom Server zu verwenden, klicken Sie auf den Pfeil neben \"Kalender\" und dann auf die Schaltfläche Verbinden für jeden Kalender, den Sie verwenden möchten. </li> <li>   (Optional) Wenn Sie alle Unterordner synchronisieren möchten, gehen Sie zum Menü Kontoeinstellungen und wählen Sie Server-Einstellungen. Klicken Sie im Tab Server-Einstellungen auf die Schaltfläche Erweitert. In dem Fenster Erweiterte Kontoeinstellungen deaktivieren Sie das Kontrollkästchen \"Nur abonnierte Ordner anzeigen\". Klicken Sie auf OK, um die Änderungen zu speichern. </li> <li>   Klicken Sie auf Beenden, um das Fenster \"Konto-Einrichtung\" zu schließen. </li> </ol>","path":["Client thunderbird.de"],"tags":[]},{"location":"de/client/client-thunderbird.en/","level":1,"title":"Client thunderbird.en","text":"<ol> <li>   Launch Thunderbird. </li> <li>   If this is the first time you launched Thunderbird, it asks you whether you would like a new email address. Click Skip this and use my existing email and proceed to step 4. </li> <li>   Go to the File menu and select New, Existing Mail Account.... </li> <li>   Enter your name (), email address () and your password. Make sure the Remember password checkbox is selected and click Continue. </li> <li>   Once the configuration has been automatically detected, make sure IMAP is selected and click Done. </li> <li>   To use your contacts from the server, click on the arrow next to \"Address Books\" and click the Connect button on each address book you would like to use. </li> <li>   To use your calendars from the server, click on the arrow next to \"Calendars\" and click the Connect button on each calendar you would like to use. </li> <li>   (Optional) If you want Thunderbird to sync all subfolders, go to the Account Settings menu and select Server Settings. In the Server Settings tab, click on the Advanced button. In the Advanced Account Settings window, uncheck the \"Show only subscribed folders\" checkbox. Click OK to save the changes. </li> <li>   Click Finish to close the Account Setup window. </li> </ol>","path":["Client thunderbird.en"],"tags":[]},{"location":"de/client/client-windows.de/","level":1,"title":"Client windows.de","text":"<p>Windows 8 und höher unterstützen E-Mail, Kontakte und Kalender über Exchange ActiveSync.</p> <ol> <li>Öffnen Sie die App Mail.</li> <li>Wenn Sie Mail noch nicht verwendet haben, können Sie im Hauptfenster auf Konto hinzufügen klicken. Fahren Sie mit Schritt 4 fort.</li> <li>Klicken Sie auf Konten in der Seitenleiste links und dann auf Konto hinzufügen ganz rechts.</li> <li>Wählen Sie Exchange.</li> <li>Geben Sie Ihre E-Mail Adresse () ein und klicken Sie auf Weiter..</li> <li>Geben Sie Ihr Passwort ein und klicken Sie auf Anmelden.</li> </ol> <p>Sobald Sie die Mail-App eingerichtet haben, können Sie auch die Apps \"Kontakte\" und \"Kalender\" verwenden.</p>","path":["Client windows.de"],"tags":[]},{"location":"de/client/client-windows.en/","level":1,"title":"Client windows.en","text":"<p>Windows 8 and higher support email, contacts and calendar via Exchange ActiveSync.</p> <ol> <li>Open the Mail app.</li> <li>If you have not previously used Mail, you can click Add Account in the main window. Proceed to step 4.</li> <li>Click Accounts in the sidebar on the left, then click Add Account on the far right.</li> <li>Select Exchange.</li> <li>Enter your email address () and click Next.</li> <li>Enter your password and click Log in.</li> </ol> <p>Once you have set up the Mail app, you can also use the People and Calendar apps.</p>","path":["Client windows.en"],"tags":[]},{"location":"de/client/client.de/","level":1,"title":"Client.de","text":"<p>mailcow unterstützt eine Vielzahl von E-Mail-Clients, sowohl auf Desktop-Computern als auch auf Smartphones. Im Folgenden finden Sie eine Reihe von Konfigurationsanleitungen, die erklären, wie Sie Ihr mailcow-Konto konfigurieren können.</p> <p>Tipp</p> Wenn Sie auf diese Seite zugreifen, indem Sie sich bei Ihrem mailcow-Server anmelden und auf den Link \"Konfigurationsanleitungen für E-Mail-Clients und Smartphones anzeigen\" klicken, werden alle Anleitungen mit Ihrer E-Mail-Adresse und Ihrem Servernamen personalisiert.  <p>Erfolgreich</p> Da Sie diese Seite aufgerufen haben, nachdem Sie sich in Ihren mailcow-Server eingeloggt haben, wurden alle Anleitungen mit Ihrer E-Mail-Adresse und Ihrem Servernamen personalisiert.  <ul> <li>Android</li> <li>Apple iOS / macOS</li> <li>eM Client</li> <li>KDE Kontact / KMail</li> <li>Microsoft Outlook</li> <li>Mozilla Thunderbird</li> <li>Windows Mail</li> <li>Manual configuration</li> </ul>","path":["Client.de"],"tags":[]},{"location":"de/client/client.en/","level":1,"title":"Client.en","text":"<p>mailcow supports a variety of email clients, both on desktop computers and on smartphones. Below, you can find a number of configuration guides that explain how to configure your mailcow account.</p> <p>Tip</p> If you access this page by logging into your mailcow server and clicking the \"Show configuration guides for email clients and smartphones\" link, all of the guides will be personalized with your email address and server name.  <p>Success</p> Since you accessed this page after logging into your mailcow server, all of the guides have been personalized with your email address and server name.  <ul> <li>Android</li> <li>Apple iOS / macOS</li> <li>eM Client</li> <li>KDE Kontact / KMail</li> <li>Microsoft Outlook</li> <li>Mozilla Thunderbird</li> <li>Windows Mail</li> <li>Manual configuration</li> </ul>","path":["Client.en"],"tags":[]},{"location":"de/getstarted/install.de/","level":1,"title":"Install.de","text":"<p>Überall gleich</p> <p>Die Installation ist auf x86 und ARM64 exakt identisch!</p>","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.de/#docker-und-docker-compose-installation","level":2,"title":"Docker und Docker Compose Installation","text":"<p>Sie benötigen Docker (eine Version &gt;= <code>24.0.0</code> ist erforderlich) und Docker Compose (eine Version <code>&gt;= 2.0</code> ist erforderlich).</p> <p>Erfahren Sie, wie Sie Docker und Docker Compose installieren.</p> <p>Schnelle Installation für die meisten Betriebssysteme:</p>","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.de/#docker","level":3,"title":"Docker","text":"<p><pre><code>curl -sSL https://get.docker.com/ | CHANNEL=stable sh\n# Nachdem der Installationsprozess abgeschlossen ist, müssen Sie eventuell den Dienst aktivieren und sicherstellen, dass er gestartet ist (z. B. CentOS 7)\nsystemctl enable --now docker\n</code></pre> Bitte verwenden Sie die neueste verfügbare Docker-Engine und nicht die Engine, die mit Ihrem Distros-Repository ausgeliefert wird.</p>","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.de/#docker-compose","level":3,"title":"docker compose","text":"<p>Achtung</p> <p>mailcow benötigt eine Version von Docker Compose &gt;= v2. Sollte die Installation von Docker über das obenstehende Skript erfolgt sein wird das Docker Compose Plugin bereits automatisch in einer Version &gt;=2.0 installiert.  Ist die mailcow Installation älter oder Docker wurde auf einem anderen Weg installiert, muss das Compose Plugin bzw. die Standalone Version von Docker manuell installiert werden.</p>","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.de/#installation-via-paketmanager-plugin","level":4,"title":"Installation via Paketmanager (Plugin)","text":"<p>Hinweis</p> <p>Diese Vorgehensweise mit den Paketquellen ist nur dann möglich, wenn das Docker Repository eingebunden wurde. Dies kann entweder durch die Anleitung oben (siehe Docker) oder durch eine manuelle Einbindung passieren.</p> <p>Auf Debian/Ubuntu Systemen: <pre><code>apt update\napt install docker-compose-plugin\n</code></pre></p> <p>Auf Centos 7 Systemen: <pre><code>yum update\nyum install docker-compose-plugin\n</code></pre></p> <p>Achtung</p> <p>Die Syntax der Docker Compose Befehle lautet <code>docker compose</code> bei der Plugin Variante von Docker Compose!!</p>","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.de/#installation-via-script-standalone","level":4,"title":"Installation via Script (Standalone)","text":"<p>Hinweis</p> <p>Diese Installation ist die alt bekannte Weise. Sie installiert Docker Compose als Standalone Programm und ist nicht auf die Art und weise der Docker Installation angewiesen.</p> <pre><code>LATEST=$(curl -Ls -w %{url_effective} -o /dev/null https://github.com/docker/compose/releases/latest) &amp;&amp; LATEST=${LATEST##*/} &amp;&amp; curl -L https://github.com/docker/compose/releases/download/$LATEST/docker-compose-$(uname -s)-$(uname -m) &gt; /usr/local/bin/docker-compose\nchmod +x /usr/local/bin/docker-compose\n</code></pre> <p>Achtung</p> <p>Die Syntax der Docker Compose Befehle lautet <code>docker-compose</code> bei der Standalone Variante von Docker Compose!!</p>","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.de/#selinux-besonderheiten-prufen","level":2,"title":"SELinux Besonderheiten prüfen","text":"<p>Auf SELinux-aktivierten Systemen, z.B. CentOS 7:</p> <ul> <li>Prüfen Sie, ob das Paket \"container-selinux\" auf Ihrem System vorhanden ist:</li> </ul> <pre><code>rpm -qa | grep container-selinux\n</code></pre> <p>Wenn der obige Befehl eine leere oder keine Ausgabe liefert, sollten Sie es über Ihren Paketmanager installieren.</p> <ul> <li>Prüfen Sie, ob Docker SELinux-Unterstützung aktiviert hat:</li> </ul> <pre><code>docker info | grep selinux\n</code></pre> <p>Wenn der obige Befehl eine leere oder keine Ausgabe liefert, erstellen oder bearbeiten Sie <code>/etc/docker/daemon.json</code> und fügen Sie <code>\"selinux-enabled\": true</code> hinzu. Beispielhafter Inhalt der Datei:</p> <pre><code>{\n  \"selinux-enabled\": true\n}\n</code></pre> <p>Starten Sie den Docker-Daemon neu und überprüfen Sie, ob SELinux nun aktiviert ist.</p> <p>Dieser Schritt ist erforderlich, um sicherzustellen, dass die mailcows-Volumes richtig gekennzeichnet sind, wie in der Compose-Datei angegeben. Wenn Sie daran interessiert sind, wie das funktioniert, können Sie sich die Readme-Datei von https://github.com/containers/container-selinux ansehen, die auf viele nützliche Informationen zu diesem Thema verweist.</p>","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.de/#mailcow-installieren","level":2,"title":"mailcow Installieren","text":"<p>Klonen Sie den Master-Zweig des Repositorys und stellen Sie sicher, dass Ihre umask gleich 0022 ist. Bitte klonen Sie das Repository als root-Benutzer und kontrollieren Sie auch den Stack als root. Wir werden die Attribute - wenn nötig - ändern, während wir die Container automatisch bereitstellen und sicherstellen, dass alles gesichert ist. Das update.sh-Skript muss daher ebenfalls als root ausgeführt werden. Es kann notwendig sein, den Besitzer und andere Attribute von Dateien zu ändern, auf die Sie sonst keinen Zugriff haben. Wir geben die Berechtigungen für jede exponierte Anwendung auf und führen einen exponierten Dienst nicht als root aus! Wenn Sie den Docker-Daemon als Nicht-Root-Benutzer steuern, erhalten Sie keine zusätzliche Sicherheit. Der unprivilegierte Benutzer wird die Container ebenfalls als root spawnen. Das Verhalten des Stacks ist identisch.</p> <pre><code>$ su\n# umask\n0022 # &lt;- Überprüfen, dass es 0022 ist\n# cd /opt\n# git clone https://github.com/mailcow/mailcow-dockerized\n# cd mailcow-dockerized\n</code></pre>","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.de/#mailcow-initialisieren","level":2,"title":"mailcow Initialisieren","text":"<p>Erzeugen Sie eine Konfigurationsdatei. Verwenden Sie einen FQDN (<code>host.domain.tld</code>) als Hostname, wenn Sie gefragt werden. <pre><code>./generate_config.sh\n</code></pre></p> <p>Ändern Sie die Konfiguration, wenn Sie wollen oder müssen. <pre><code>nano mailcow.conf\n</code></pre> Wenn Sie planen, einen Reverse Proxy zu verwenden, können Sie zum Beispiel HTTPS an 127.0.0.1 auf Port 8443 und HTTP an 127.0.0.1 auf Port 8080 binden.</p> <p>Möglicherweise müssen Sie einen vorinstallierten MTA stoppen, der Port 25/tcp blockiert. Siehe dieses Kapitel, um zu erfahren, wie man Postfix rekonfiguriert, um nach einer erfolgreichen Installation neben mailcow laufen zu lassen.</p> <p>Einige Updates modifizieren mailcow.conf und fügen neue Parameter hinzu. Es ist schwer, in der Dokumentation den Überblick zu behalten. Bitte überprüfen Sie deren Beschreibung und fragen Sie, wenn Sie unsicher sind, in den bekannten Kanälen nach Rat.</p>","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.de/#problembehandlungen","level":2,"title":"Problembehandlungen","text":"","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.de/#benutzer-mit-einer-mtu-ungleich-1500-zb-openstack","level":3,"title":"Benutzer mit einer MTU ungleich 1500 (z.B. OpenStack)","text":"<p>Wenn Sie auf Probleme und seltsame Phänomene stoßen, überprüfen Sie bitte Ihre MTU.</p> <p>Bearbeiten Sie <code>docker-compose.yml</code> und ändern Sie die Netzwerkeinstellungen entsprechend Ihrer MTU. Fügen Sie den neuen Parameter driver_opts wie folgt hinzu: <pre><code>networks:\n  mailcow-network:\n    ...\n    driver_opts:\n      com.docker.network.driver.mtu: 1450\n    ...\n</code></pre></p>","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.de/#benutzer-ohne-ein-ipv6-aktiviertes-netzwerk-auf-ihrem-hostsystem","level":3,"title":"Benutzer ohne ein IPv6-aktiviertes Netzwerk auf ihrem Hostsystem","text":"<p>Schalten Sie IPv6 bitte nicht ab, auch wenn es Ihnen nicht gefällt. IPv6 ist die Zukunft und sollte nicht ignoriert werden.</p> <p>Sollten Sie jedoch kein IPv6-fähiges Netzwerk auf Ihrem Host haben und Sie sich nicht um ein besseres Internet kümmern wollen (hehe), ist es empfehlenswert, IPv6 für das mailcow-Netzwerk zu deaktivieren, um unvorhergesehene Probleme zu vermeiden.</p>","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.de/#mailcow-starten","level":2,"title":"mailcow starten","text":"<p>Laden Sie die Images herunter und führen Sie die Compose-Datei aus. Der Parameter <code>-d</code> wird ihre mailcow dann im Hintergrund starten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose pull\ndocker compose up -d\n</code></pre> <pre><code>docker-compose pull\ndocker-compose up -d\n</code></pre> <p>Geschafft!</p> <p>Sie können nun auf https://${MAILCOW_HOSTNAME} mit den Standard-Zugangsdaten <code>admin</code> + Passwort <code>moohoo</code> zugreifen.</p> <p>Info</p> <p>Wenn Sie mailcow nicht hinter einem Reverse Proxy verwenden, sollten Sie alle HTTP-Anfragen auf HTTPS umleiten.</p> <p>Die Datenbank wird sofort initialisiert, nachdem eine Verbindung zu MySQL hergestellt werden kann.</p> <p>Ihre Daten bleiben in mehreren Docker-Volumes erhalten, die nicht gelöscht werden, wenn Sie Container neu erstellen oder löschen. Führen Sie <code>docker volume ls</code> aus, um eine Liste aller Volumes zu sehen. Sie können <code>docker compose down</code> sicher ausführen, ohne persistente Daten zu entfernen.</p>","path":["Install.de"],"tags":[]},{"location":"de/getstarted/install.en/","level":1,"title":"Install.en","text":"<p>It's the same</p> <p>The installation is exactly the same on x86 and ARM64 platforms!</p>","path":["Install.en"],"tags":[]},{"location":"de/getstarted/install.en/#docker-and-docker-compose-installation","level":2,"title":"Docker and Docker Compose Installation","text":"<p>You need Docker (a version &gt;= <code>24.0.0</code> is required) and Docker Compose (a version <code>&gt;= 2.0</code> is required).</p> <p>Learn how to install Docker and Docker Compose.</p> <p>Quick installation for most operation systems:</p>","path":["Install.en"],"tags":[]},{"location":"de/getstarted/install.en/#docker","level":3,"title":"Docker","text":"<pre><code>curl -sSL https://get.docker.com/ | CHANNEL=stable sh\n# After the installation process is finished, you may need to enable the service and make sure it is started (e.g. CentOS 7)\nsystemctl enable --now docker\n</code></pre>","path":["Install.en"],"tags":[]},{"location":"de/getstarted/install.en/#docker-compose","level":3,"title":"docker compose","text":"<p>Danger</p> <p>mailcow requires the latest version of docker compose v2. If Docker was installed using the script above, the Docker Compose plugin is already automatically installed in a version &gt;=2.0. Is your mailcow installation older or Docker was installed in a different way, the Compose plugin or the standalone version of Docker must be installed manually.</p>","path":["Install.en"],"tags":[]},{"location":"de/getstarted/install.en/#installation-via-paketmanager-plugin","level":4,"title":"Installation via Paketmanager (plugin)","text":"<p>Info</p> <p>This approach with the package sources is only possible if the Docker repository has been included. This can happen either through the instructions above (see Docker) or through a manually integration.</p> <p>On Debian/Ubuntu systems: <pre><code>apt update\napt install docker-compose-plugin\n</code></pre></p> <p>On Centos 7 systems: <pre><code>yum update\nyum install docker-compose-plugin\n</code></pre></p> <p>Danger</p> <p>The Docker Compose command syntax is <code>docker compose</code> for the plugin variant of Docker Compose!!!</p>","path":["Install.en"],"tags":[]},{"location":"de/getstarted/install.en/#installation-via-script-standalone","level":4,"title":"Installation via Script (standalone)","text":"<p>Info</p> <p>This installation is the old familiar way. It installs Docker Compose as a standalone program and does not rely on the Docker installation way.</p> <pre><code>LATEST=$(curl -Ls -w %{url_effective} -o /dev/null https://github.com/docker/compose/releases/latest) &amp;&amp; LATEST=${LATEST##*/} &amp;&amp; curl -L https://github.com/docker/compose/releases/download/$LATEST/docker-compose-$(uname -s)-$(uname -m) &gt; /usr/local/bin/docker-compose\nchmod +x /usr/local/bin/docker-compose\n</code></pre> <p>Danger</p> <p>The Docker Compose command syntax is <code>docker-compose</code> for the standalone variant of Docker Compose!!!   </p> <p>Please use the latest Docker engine available and do not use the engine that ships with your distros repository.</p>","path":["Install.en"],"tags":[]},{"location":"de/getstarted/install.en/#check-selinux-specifics","level":2,"title":"Check SELinux specifics","text":"<p>On SELinux enabled systems, e.g. CentOS 7:</p> <ul> <li>Check if \"container-selinux\" package is present on your system:</li> </ul> <pre><code>rpm -qa | grep container-selinux\n</code></pre> <p>If the above command returns an empty or no output, you should install it via your package manager.</p> <ul> <li>Check if docker has SELinux support enabled:</li> </ul> <pre><code>docker info | grep selinux\n</code></pre> <p>If the above command returns an empty or no output, create or edit <code>/etc/docker/daemon.json</code> and add <code>\"selinux-enabled\": true</code>. Example file content:</p> <pre><code>{\n  \"selinux-enabled\": true\n}\n</code></pre> <p>Restart the docker daemon and verify SELinux is now enabled.</p> <p>This step is required to make sure mailcows volumes are properly labeled as declared in the compose file. If you are interested in how this works, you can check out the readme of https://github.com/containers/container-selinux which links to a lot of useful information on that topic.</p>","path":["Install.en"],"tags":[]},{"location":"de/getstarted/install.en/#install-mailcow","level":2,"title":"Install mailcow","text":"<p>Clone the master branch of the repository, make sure your umask equals 0022. Please clone the repository as root user and also control the stack as root. We will modify attributes - if necessary - while bootstrapping the containers automatically and make sure everything is secured. The update.sh script must therefore also be run as root. It might be necessary to change ownership and other attributes of files you will otherwise not have access to. We drop permissions for every exposed application and will not run an exposed service as root! Controlling the Docker daemon as non-root user does not give you additional security. The unprivileged user will spawn the containers as root likewise. The behaviour of the stack is identical.</p> <pre><code>$ su\n# umask\n0022 # &lt;- Verify it is 0022\n# cd /opt\n# git clone https://github.com/mailcow/mailcow-dockerized\n# cd mailcow-dockerized\n</code></pre>","path":["Install.en"],"tags":[]},{"location":"de/getstarted/install.en/#initialize-mailcow","level":2,"title":"Initialize mailcow","text":"<p>Generate a configuration file. Use a FQDN (<code>host.domain.tld</code>) as hostname when asked. <pre><code>./generate_config.sh\n</code></pre></p> <p>Change configuration if you want or need to. <pre><code>nano mailcow.conf\n</code></pre> If you plan to use a reverse proxy, you can, for example, bind HTTPS to 127.0.0.1 on port 8443 and HTTP to 127.0.0.1 on port 8080.</p> <p>You may need to stop an existing pre-installed MTA which blocks port 25/tcp. See this chapter to learn how to reconfigure Postfix to run besides mailcow after a successful installation.</p> <p>Some updates modify mailcow.conf and add new parameters. It is hard to keep track of them in the documentation. Please check their description and, if unsure, ask at the known channels for advise.</p>","path":["Install.en"],"tags":[]},{"location":"de/getstarted/install.en/#troubleshooting","level":2,"title":"Troubleshooting","text":"","path":["Install.en"],"tags":[]},{"location":"de/getstarted/install.en/#users-with-a-mtu-not-equal-to-1500-eg-openstack","level":3,"title":"Users with a MTU not equal to 1500 (e.g. OpenStack)","text":"<p>Whenever you run into trouble and strange phenomena, please check your MTU.</p> <p>Edit <code>docker-compose.yml</code> and change the network settings according to your MTU. Add the new driver_opts parameter like this: <pre><code>networks:\n  mailcow-network:\n    ...\n    driver_opts:\n      com.docker.network.driver.mtu: 1450\n    ...\n</code></pre></p>","path":["Install.en"],"tags":[]},{"location":"de/getstarted/install.en/#users-without-an-ipv6-enabled-network-on-their-host-system","level":3,"title":"Users without an IPv6 enabled network on their host system","text":"<p>Please don't turn off IPv6, even if you don't like it. IPv6 is the future and should not be ignored.</p> <p>If you do not have an IPv6 enabled network on your host and you don't care for a better internet (thehe), it is recommended to disable IPv6 for the mailcow network to prevent unforeseen issues.</p>","path":["Install.en"],"tags":[]},{"location":"de/getstarted/install.en/#start-mailcow","level":2,"title":"Start mailcow","text":"<p>Pull the images and run the compose file. The parameter <code>-d</code> will start mailcow: dockerized detached:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose pull\ndocker compose up -d\n</code></pre> <pre><code>docker-compose pull\ndocker-compose up -d\n</code></pre> <p>Done!</p> <p>You can now access https://${MAILCOW_HOSTNAME} with the default credentials <code>admin</code> + password <code>moohoo</code>.</p> <p>Info</p> <p>If you are not using mailcow behind a reverse proxy, you should redirect all HTTP requests to HTTPS.</p> <p>The database will be initialized right after a connection to MySQL can be established.</p> <p>Your data will persist in multiple Docker volumes, that are not deleted when you recreate or delete containers. Run <code>docker volume ls</code> to see a list of all volumes. You can safely run <code>docker compose down</code> without removing persistent data.</p>","path":["Install.en"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.de/","level":1,"title":"Prerequisite dns.de","text":"<p>Nachstehend finden Sie eine Liste von empfohlenen DNS-Einträgen. Einige sind für einen Mailserver obligatorisch (A, MX), andere werden empfohlen, um eine gute Reputation aufzubauen (TXT/SPF) oder für die automatische Konfiguration von Mailclients verwendet (SRV).</p>","path":["Prerequisite dns.de"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.de/#referenzen","level":2,"title":"Referenzen","text":"<ul> <li>Ein guter Artikel, der alle relevanten Themen abdeckt:   \"3 DNS Records Every Email Marketer Must Know\"</li> <li>Ein weiterer guter Artikel, aber mit Zimbra als Beispielplattform:   \"Best Practices on Email Protection: SPF, DKIM and DMARC\"</li> <li>Eine ausführliche Diskussion über SPF, DKIM und DMARC:   \"Wie Sie Spam beseitigen und Ihren Namen mit DMARC schützen\"</li> <li>Ein ausführlicher Leitfaden zum Verständnis von DMARC: \"Entmystifizierung von DMARC: Ein Leitfaden zur Verhinderung von E-Mail-Spoofing\"</li> </ul>","path":["Prerequisite dns.de"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.de/#reverse-dns-ihrer-ip-adresse","level":2,"title":"Reverse DNS Ihrer IP-Adresse","text":"<p>Stellen Sie sicher, dass der PTR-Eintrag Ihrer IP-Adresse mit dem FQDN Ihres mailcow-Hosts übereinstimmt: <code>${MAILCOW_HOSTNAME}</code> <sup>1</sup>. Dieser Eintrag wird normalerweise bei dem Provider gesetzt, von dem Sie die IP-Adresse (Server) gemietet haben. Bitte beachten Sie, dies sowohl für Ihre IPv4 als auch Ihre IPv6 Adressen (falls verwendet) sicherzustellen!</p>","path":["Prerequisite dns.de"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.de/#die-minimale-dns-konfiguration","level":2,"title":"Die minimale DNS-Konfiguration","text":"<p>Dieses Beispiel zeigt Ihnen eine Reihe von Einträgen für eine von mailcow verwaltete Domain. Jede Domain, die zu mailcow hinzugefügt wird, benötigt mindestens diesen Satz an Einträgen, um korrekt zu funktionieren.</p> <pre><code># Name Typ Wert\nmail IN A 1.2.3.4\nautodiscover IN CNAME mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\nautoconfig IN CNAME mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n@ IN MX 10 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n</code></pre> <p>Hinweis: Der <code>mail</code> DNS-Eintrag, der die Subdomain an die angegebene IP-Adresse bindet, muss nur für die Domain gesetzt werden, auf der mailcow läuft und die für den Zugriff auf das Webinterface verwendet wird. Für jede andere von mailcow verwaltete Domain leitet der <code>MX</code>-Eintrag den Datenverkehr entsprechend weiter.</p>","path":["Prerequisite dns.de"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.de/#dkim-spf-und-dmarc","level":2,"title":"DKIM, SPF und DMARC","text":"<p>Im folgenden Beispiel für eine DNS-Zonendatei wird ein einfacher SPF TXT-Eintrag verwendet, um nur DIESEM Server (dem MX) zu erlauben, E-Mails für Ihre Domäne zu senden. Jeder andere Server ist nicht zugelassen, kann es aber tun (\"<code>~all</code>\"). Weitere Informationen finden Sie im SPF-Projekt.</p> <pre><code># Name Typ Wert\n@ IN TXT \"v=spf1 mx a -all\"\n</code></pre> <p>Es wird dringend empfohlen, einen DKIM TXT-Eintrag in Ihrer mailcow UI zu erstellen und den entsprechenden TXT-Eintrag in Ihren DNS-Einträgen zu setzen. Bitte lesen Sie OpenDKIM für weitere Informationen.</p> <pre><code># Name Typ Wert\ndkim._domainkey IN TXT \"v=DKIM1; k=rsa; t=s; s=email; p=...\"\n</code></pre> <p>Der letzte Schritt, um sich selbst und andere zu schützen, ist die Implementierung eines DMARC TXT-Datensatzes, zum Beispiel mit Hilfe des DMARC-Assistenten (check).</p> <pre><code># Name Typ Wert\n_dmarc IN TXT \"v=DMARC1; p=reject; rua=mailto:mailauth-reports@example.org\"\n</code></pre>","path":["Prerequisite dns.de"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.de/#die-erweiterte-dns-konfiguration","level":2,"title":"Die erweiterte DNS-Konfiguration","text":"<p>SRV-Einträge geben den/die Server für ein bestimmtes Protokoll in Ihrer Domäne an. Wenn Sie einen Dienst explizit als nicht bereitgestellt ankündigen wollen, geben Sie \".\" als Zieladresse an (statt \"mail.example.org.\"). Bitte beachten Sie RFC 2782.</p> <pre><code># Name Typ Priorität Gewicht Port Wert\n_autodiscover._tcp IN SRV 0 1 443 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_caldavs._tcp IN SRV 0 1 443 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_caldavs._tcp IN TXT \"path=/SOGo/dav/\"\n_carddavs._tcp IN SRV 0 1 443 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_carddavs._tcp IN TXT \"path=/SOGo/dav/\"\n_imap._tcp IN SRV 0 1 143 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_imaps._tcp IN SRV 0 1 993 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_pop3._tcp IN SRV 0 1 110 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_pop3s._tcp IN SRV 0 1 995 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_sieve._tcp IN SRV 0 1 4190 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_smtps._tcp IN SRV 0 1 465 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_submission._tcp IN SRV 0 1 587 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_submissions._tcp IN SRV 0 1 465 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n</code></pre>","path":["Prerequisite dns.de"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.de/#testen","level":2,"title":"Testen","text":"<p>Hier finden Sie einige Tools, mit denen Sie Ihre DNS-Konfiguration überprüfen können:</p> <ul> <li>MX Toolbox (DNS, SMTP, RBL)</li> <li>port25.com (DKIM, SPF)</li> <li>Mail-Tester (DKIM, DMARC, SPF)</li> <li>DMARC-Analysator (DMARC, SPF)</li> <li>MultiRBL.valli.org (DNSBL, RBL, FCrDNS)</li> </ul>","path":["Prerequisite dns.de"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.de/#verschiedenes","level":2,"title":"Verschiedenes","text":"","path":["Prerequisite dns.de"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.de/#optionale-dmarc-statistiken","level":3,"title":"Optionale DMARC-Statistiken","text":"<p>Wenn Sie an Statistiken interessiert sind, können Sie sich zusätzlich bei einem der vielen unten aufgeführten DMARC-Statistikdienste anmelden - oder Ihre eigene Statistik selbst hosten.</p> <p>Tipp</p> <p>Es ist zu bedenken, dass wenn Sie DMARC-Statistik-Berichte an Ihren mailcow-Server anfordern und Ihr mailcow-Server nicht korrekt für den Empfang dieser Berichte konfiguriert ist, Sie möglicherweise keine genauen und vollständigen Ergebnisse erhalten. Bitte erwägen Sie die Verwendung einer alternativen E-Mail-Domain für den Empfang von DMARC-Berichten.</p> <p>Es ist erwähnenswert, dass die folgenden Vorschläge keine umfassende Liste aller verfügbaren Dienste und Tools sind, sondern nur eine kleine Auswahl der vielen Möglichkeiten.</p> <ul> <li>Postmaster Tool</li> <li>parsedmarc (selbst gehostet)</li> <li>Fraudmarc</li> <li>Postmark</li> <li>Dmarcian</li> </ul> <p>Tipp</p> <p>Diese Dienste stellen Ihnen möglicherweise einen TXT-Eintrag zur Verfügung, den Sie in Ihre DNS-Einträge einfügen müssen, so wie es der Anbieter vorschreibt. Bitte stellen Sie sicher, dass Sie die Dokumentation des Anbieters des von Ihnen gewählten Dienstes lesen, da dieser Prozess variieren kann.</p>","path":["Prerequisite dns.de"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.de/#e-mail-test-fur-spf-dkim-und-dmarc","level":3,"title":"E-Mail-Test für SPF, DKIM und DMARC:","text":"<p>Um eine rudimentäre E-Mail-Authentifizierungsprüfung durchzuführen, senden Sie eine E-Mail an <code>check-auth at verifier.port25.com</code> und warten Sie auf eine Antwort. Sie werden einen Bericht ähnlich dem folgenden finden:</p> <pre><code>==========================================================\nZusammenfassung der Ergebnisse\n==========================================================\nSPF-Prüfung: bestanden\n\"iprev\"-Prüfung: bestanden\nDKIM-Prüfung: bestanden\nDKIM-Prüfung: bestanden\nSpamAssassin-Prüfung: ham\n\n==========================================================\nEinzelheiten:\n==========================================================\n....\n</code></pre> <p>Der vollständige Bericht enthält weitere technische Details.</p>","path":["Prerequisite dns.de"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.de/#fully-qualified-domain-name-fqdn","level":3,"title":"Fully Qualified Domain Name (FQDN)","text":"<ol> <li> <p>Ein Fully Qualified Domain Name (FQDN) ist der vollständige (absolute) Domänenname für einen bestimmten Computer oder Host im Internet. Der FQDN besteht aus mindestens drei Teilen, die durch einen Punkt getrennt sind: dem Hostnamen, dem Domänennamen und der Top Level Domain (kurz TLD). Im Beispiel <code>mx.mailcow.email</code> wäre der Hostname <code>mx</code>, der Domainname <code>mailcow</code> und die TLD <code>email</code>. ↩</p> </li> </ol>","path":["Prerequisite dns.de"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.en/","level":1,"title":"Prerequisite dns.en","text":"<p>Below you can find a list of recommended DNS records. While some are mandatory for a mail server (A, MX), others are recommended to build a good reputation score (TXT/SPF) or used for auto-configuration of mail clients (SRV).</p>","path":["Prerequisite dns.en"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.en/#references","level":2,"title":"References","text":"<ul> <li>A good article covering all relevant topics:   \"3 DNS Records Every Email Marketer Must Know\"</li> <li>Another great one, but Zimbra as an example platform:   \"Best Practices on Email Protection: SPF, DKIM and DMARC\"</li> <li>An in-depth discussion of SPF, DKIM and DMARC:   \"How to eliminate spam and protect your name with DMARC\"</li> <li>A thorough guide on understanding DMARC: \"Demystifying DMARC: A guide to preventing email spoofing\"</li> </ul>","path":["Prerequisite dns.en"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.en/#reverse-dns-of-your-ip-address","level":2,"title":"Reverse DNS of your IP address","text":"<p>Make sure that the PTR record of your IP address matches the FQDN of your mailcow host: <code>${MAILCOW_HOSTNAME}</code> <sup>1</sup>. This record is usually set at the provider you leased the IP address (server) from. Please make sure that you create the record for IPv4 and IPv6 address (if you are using IPv6)!</p>","path":["Prerequisite dns.en"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.en/#the-minimal-dns-configuration","level":2,"title":"The minimal DNS configuration","text":"<p>This example shows you a set of records for one domain managed by mailcow. Each domain that is added to mailcow needs at least this set of records to function correctly.</p> <pre><code># Name              Type       Value\nmail                IN A       1.2.3.4\nautodiscover        IN CNAME   mail.example.org. (your ${MAILCOW_HOSTNAME})\nautoconfig          IN CNAME   mail.example.org. (your ${MAILCOW_HOSTNAME})\n@                   IN MX 10   mail.example.org. (your ${MAILCOW_HOSTNAME})\n</code></pre> <p>Note: The <code>mail</code> DNS record which binds the subdomain to the given ip address must only be set for the domain on which mailcow is running and that is used to access the web interface. For every other mailcow managed domain, the <code>MX</code> record will route the traffic.</p>","path":["Prerequisite dns.en"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.en/#dkim-spf-and-dmarc","level":2,"title":"DKIM, SPF and DMARC","text":"<p>In the example DNS zone file snippet below, a simple SPF TXT record is used to only allow THIS server (the MX) to send mail for your domain. Every other server is disallowed but able to (\"<code>~all</code>\"). Please refer to SPF Project for further reading.</p> <pre><code># Name              Type       Value\n@                   IN TXT     \"v=spf1 mx a -all\"\n</code></pre> <p>It is highly recommended to create a DKIM TXT record in your mailcow UI and set the corresponding TXT record in your DNS records. Please refer to OpenDKIM for further reading.</p> <pre><code># Name              Type       Value\ndkim._domainkey     IN TXT     \"v=DKIM1; k=rsa; t=s; s=email; p=...\"\n</code></pre> <p>The last step in protecting yourself and others is the implementation of a DMARC TXT record, for example by using the DMARC Assistant (check).</p> <pre><code># Name              Type       Value\n_dmarc              IN TXT     \"v=DMARC1; p=reject; rua=mailto:mailauth-reports@example.org\"\n</code></pre>","path":["Prerequisite dns.en"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.en/#the-advanced-dns-configuration","level":2,"title":"The advanced DNS configuration","text":"<p>SRV records specify the server(s) for a specific protocol on your domain. If you want to explicitly announce a service as not provided, give \".\" as the target address (instead of \"mail.example.org.\"). Please refer to RFC 2782.</p> <pre><code># Name              Type       Priority Weight Port    Value\n_autodiscover._tcp  IN SRV     0        1      443      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_caldavs._tcp       IN SRV     0        1      443      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_caldavs._tcp       IN TXT                              \"path=/SOGo/dav/\"\n_carddavs._tcp      IN SRV     0        1      443      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_carddavs._tcp      IN TXT                              \"path=/SOGo/dav/\"\n_imap._tcp          IN SRV     0        1      143      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_imaps._tcp         IN SRV     0        1      993      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_pop3._tcp          IN SRV     0        1      110      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_pop3s._tcp         IN SRV     0        1      995      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_sieve._tcp         IN SRV     0        1      4190     mail.example.org. (your ${MAILCOW_HOSTNAME})\n_smtps._tcp         IN SRV     0        1      465      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_submission._tcp    IN SRV     0        1      587      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_submissions._tcp   IN SRV     0        1      465      mail.example.org. (your ${MAILCOW_HOSTNAME})\n</code></pre>","path":["Prerequisite dns.en"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.en/#testing","level":2,"title":"Testing","text":"<p>Here are some tools you can use to verify your DNS configuration:</p> <ul> <li>MX Toolbox (DNS, SMTP, RBL)</li> <li>port25.com (DKIM, SPF)</li> <li>Mail-tester (DKIM, DMARC, SPF)</li> <li>DMARC Analyzer (DMARC, SPF)</li> <li>MultiRBL.valli.org (DNSBL, RBL, FCrDNS)</li> </ul>","path":["Prerequisite dns.en"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.en/#misc","level":2,"title":"Misc","text":"","path":["Prerequisite dns.en"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.en/#optional-dmarc-statistics","level":3,"title":"Optional DMARC Statistics","text":"<p>If you are interested in statistics, you can additionally register with some of the many below DMARC statistic services - or self-host your own.</p> <p>Tip</p> <p>It is worth considering that if you request DMARC statistic reports to your mailcow server and your mailcow server is not configured correctly to receive these reports, you may not get accurate and complete results. Please consider using an alternative email domain for receiving DMARC reports.</p> <p>It is worth mentioning, that the following suggestions are not a comprehensive list of all services and tools available, but only a small few of the many choices.</p> <ul> <li>Postmaster Tool</li> <li>parsedmarc (self-hosted)</li> <li>Fraudmarc</li> <li>Postmark</li> <li>Dmarcian</li> </ul> <p>Tip</p> <p>These services may provide you with a TXT record you need to insert into your DNS records as the provider specifies. Please ensure you read the provider's documentation from the service you choose as this process may vary.</p>","path":["Prerequisite dns.en"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.en/#email-test-for-spf-dkim-and-dmarc","level":3,"title":"Email test for SPF, DKIM and DMARC:","text":"<p>To run a rudimentary email authentication check, send a mail to <code>check-auth at verifier.port25.com</code> and wait for a reply. You will find a report similar to the following:</p> <pre><code>==========================================================\nSummary of Results\n==========================================================\nSPF check:          pass\n\"iprev\" check:      pass\nDKIM check:         pass\nDKIM check:         pass\nSpamAssassin check: ham\n\n==========================================================\nDetails:\n==========================================================\n....\n</code></pre> <p>The full report will contain more technical details.</p>","path":["Prerequisite dns.en"],"tags":[]},{"location":"de/getstarted/prerequisite-dns.en/#fully-qualified-domain-name-fqdn","level":3,"title":"Fully Qualified Domain Name (FQDN)","text":"<ol> <li> <p>A Fully Qualified Domain Name (FQDN) is the complete (absolute) domain name for a specific computer or host, on the Internet. The FQDN consists of at least three parts divided by a dot: the hostname, the domain name, and the Top Level Domain (TLD for short). In the example of <code>mx.mailcow.email</code> the hostname would be <code>mx</code>, the domain name <code>mailcow</code> and the TLD <code>email</code>. ↩</p> </li> </ol>","path":["Prerequisite dns.en"],"tags":[]},{"location":"de/getstarted/prerequisite-system.de/","level":1,"title":"Prerequisite system.de","text":"<p>Bevor Sie mailcow: dockerized ausführen, sollten Sie einige Voraussetzungen überprüfen:</p> <p>Achtung</p> <p>Versuchen Sie nicht, mailcow auf einem Synology/QNAP-Gerät (jedes NAS), OpenVZ, LXC oder anderen Container-Plattformen zu installieren. KVM, ESX, Hyper-V und andere vollständige Virtualisierungsplattformen werden unterstützt.</p> <p>Info</p> <ul> <li>mailcow: dockerized erfordert, dass einige Ports für eingehende Verbindungen offen sind, also stellen Sie sicher, dass Ihre Firewall diese nicht blockiert.</li> <li>Stellen Sie sicher, dass keine andere Anwendung die Konfiguration von mailcow stört, wie z.B. ein anderer Maildienst</li> <li>Ein korrektes DNS-Setup ist entscheidend für jedes gute Mailserver-Setup, also stellen Sie bitte sicher, dass Sie zumindest die basics abgedeckt haben, bevor Sie beginnen!</li> <li>Stellen Sie sicher, dass Ihr System ein korrektes Datum und eine korrekte Zeiteinstellung hat. Dies ist entscheidend für verschiedene Komponenten wie die Zwei-Faktor-TOTP-Authentifizierung.</li> </ul>","path":["Prerequisite system.de"],"tags":[]},{"location":"de/getstarted/prerequisite-system.de/#minimale-systemressourcen","level":2,"title":"Minimale Systemressourcen","text":"<p>Bitte stellen Sie sicher, dass Ihr System mindestens über die folgenden Ressourcen verfügt, um problemlos zu laufen:</p> Ressource Minimale Anforderung CPU 1 GHz RAM Minimum 6 GiB + 1 GiB Swap (Standardkonfiguration) Festplatte 20 GiB (ohne Emails) Architektur x86_64, ARM64 <p>Nicht unterstützte Plattformen</p> <p>OpenVZ, Virtuozzo und LXC</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"de/getstarted/prerequisite-system.de/#arbeitsspeicher","level":3,"title":"Arbeitsspeicher","text":"<p>ClamAV und die FTS-Engine (Flatcurve) können viel RAM nutzen, lassen sich aber über die Parameter <code>SKIP_CLAMD=y</code> und <code>SKIP_FTS=y</code> in der mailcow.conf deaktivieren.</p> <p>mailcow ist eine umfassende Groupware mit zahlreichen Features wie Webserver, Webmailer, ActiveSync, Antivirus, Antispam, Indexierung, Dokumentenscanner, Datenbank und Cache, weshalb es mehr Ressourcen benötigt als ein einfacher MTA.</p> <p>Ein einzelner SOGo-Worker kann ~350 MiB RAM belegen, bevor er geleert wird. Je mehr ActiveSync-Verbindungen Sie verwenden möchten, desto mehr RAM wird benötigt. In der Standardkonfiguration werden 20 SOGo-Worker erzeugt.</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"de/getstarted/prerequisite-system.de/#beispiele-fur-die-ram-planung","level":4,"title":"Beispiele für die RAM Planung","text":"<p>Ein Unternehmen mit 15 Smartphones (EAS aktiviert) und etwa 50 gleichzeitigen IMAP-Verbindungen sollte 16 GiB RAM einplanen.</p> <p>6 GiB RAM + 1 GiB Swap sind für die meisten privaten Installationen ausreichend, während 8 GiB RAM für ~5 bis 10 Benutzer empfohlen werden.</p> <p>Im Rahmen unseres Supports können wir Ihnen bei der korrekten Planung Ihres Setups helfen.</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"de/getstarted/prerequisite-system.de/#unterstutzte-betriebssysteme","level":3,"title":"Unterstützte Betriebssysteme","text":"<p>Wichtig</p> <p>mailcow nutzt Docker als Grundlage. Aufgrund verschiedener technischer Unterschiede zwischen den einzelnen Systemen werden nicht alle Plattformen unterstützt, auf denen Docker theoretisch lauffähig ist.</p> <p>Die folgende Tabelle enthält alle von uns offiziell unterstützten und getesteten Betriebssysteme (Stand Dezember 2024):</p> Betriebssystem Kompatibilität Alpine 3.16 und älter ⚠️ Debian 11, 12 ✅ Ubuntu 20.04 - 24.04 ✅ Alma Linux 8, 9 ✅ Rocky Linux 9 ✅ <p>Legende</p> <p>✅ = Funktioniert out of the box anhand der Anleitung. ⚠️ = Erfordert einige manuelle Anpassungen, sonst aber nutzbar. ❌ = Generell NICHT Kompatibel. ❔ = Ausstehend.</p> <p>Achtung</p> <p>Andere (nicht genannte Betriebssysteme) können auch funktionieren, sind jedoch nicht offiziell getestet worden und erhalten KEINEN Support, weder Community noch Bezahlt!</p> <p>BENUTZUNG AUF EIGENE GEFAHR!!</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"de/getstarted/prerequisite-system.de/#firewall-ports","level":2,"title":"Firewall &amp; Ports","text":"<p>Bitte überprüfen Sie, ob alle Standard-Ports von mailcow offen sind und nicht von anderen Anwendungen genutzt werden:</p> <pre><code>ss -tlpn | grep -E -w '25|80|110|143|443|465|587|993|995|4190'\n# oder:\nnetstat -tulpn | grep -E -w '25|80|110|143|443|465|587|993|995|4190'\n</code></pre> <p>Vorsicht</p> <p>Es gibt einige Probleme mit dem Betrieb von mailcow auf einem Firewalld/ufw aktivierten System.  Sie sollten es deaktivieren (wenn möglich) und stattdessen Ihren Regelsatz in die DOCKER-USER-Kette verschieben, die nicht durch einen Neustart des Docker-Dienstes gelöscht wird.  Siehe diese (blog.donnex.net) oder diese (unrouted.io) Anleitung für Informationen darüber, wie man iptables-persistent mit der DOCKER-USER Kette benutzt.  Da mailcow im Docker-Modus läuft, haben INPUT-Regeln keinen Effekt auf die Beschränkung des Zugriffs auf mailcow.  Verwenden Sie stattdessen die FORWARD-Kette.</p> <p>Wenn dieser Befehl irgendwelche Ergebnisse liefert, entfernen oder stoppen Sie bitte die Anwendung, die auf diesem Port läuft. Sie können mailcows Ports auch über die Konfigurationsdatei <code>mailcow.conf</code> anpassen.</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"de/getstarted/prerequisite-system.de/#eingehende-ports","level":3,"title":"Eingehende Ports","text":"<p>Wenn Sie eine Firewall vor mailcow haben, stellen Sie bitte sicher, dass diese Ports für eingehende Verbindungen offen sind:</p> Dienst Protokoll Port Container Variable Postfix SMTP TCP 25 postfix-mailcow <code>${SMTP_PORT}</code> Postfix SMTPS TCP 465 postfix-mailcow <code>${SMTPS_PORT}</code> Postfix Submission TCP 587 postfix-mailcow <code>${SUBMISSION_PORT}</code> Dovecot IMAP TCP 143 dovecot-mailcow <code>${IMAP_PORT}</code> Dovecot IMAPS TCP 993 dovecot-mailcow <code>${IMAPS_PORT}</code> Dovecot POP3 TCP 110 dovecot-mailcow <code>${POP_PORT}</code> Dovecot POP3S TCP 995 dovecot-mailcow <code>${POPS_PORT}</code> Dovecot ManageSieve TCP 4190 dovecot-mailcow <code>${SIEVE_PORT}</code> HTTP(S) TCP 80/443 nginx-mailcow <code>${HTTP_PORT}</code> / <code>${HTTPS_PORT}</code> <p>Um einen Dienst an eine IP-Adresse zu binden, können Sie die IP-Adresse wie folgt voranstellen: <code>SMTP_PORT=1.2.3.4:25</code></p> <p>Wichtig: Sie können keine IP:PORT-Bindungen in HTTP_PORT und HTTPS_PORT verwenden. Bitte verwenden Sie stattdessen <code>HTTP_PORT=1234</code> und <code>HTTP_BIND=1.2.3.4</code>.</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"de/getstarted/prerequisite-system.de/#ausgehende-portshosts","level":3,"title":"Ausgehende Ports/Hosts","text":"<p>Für die Nutzung von mailcow werden einige ausgehende Verbindungen benötigt. Stellen Sie sicher, dass mailcow mit folgenden Hosts oder auf folgenden Ports nach außen kommunizieren kann:</p> Dienst Protokoll Port Ziel Grund Clamd TCP 873 rsync.sanesecurity.net Download ClamAV Signaturen (Prebundled in mailcow) Dovecot TCP 443 spamassassin.heinlein-support.de Herunterladen von Spamassasin Regeln, die Rspamd verarbeitet, Download erfolgt über Dovecot mailcow Prozesse TCP 80/443 github.com Download von mailcow Updates (Code Basiert) mailcow Prozesse TCP 443 hub.docker.com Download von Docker Images (direkt von Docker Hub) mailcow Prozesse TCP 443 asn-check.mailcow.email API Abfrage auf Prüfung BAD ASN (für Spamhaus Free Blocklists) mailcow Prozesse TCP 80 ip4.mailcow.email &amp; ip6.mailcow.email Ermittelung der eigenen öffentlichen IP Adresse zur Anzeige in UI (optional) Postfix TCP 25, 465 Beliebig / Any Ausgehende Verbindung MTA Rspamd TCP 80 fuzzy.mailcow.email Download von Bad Subject Regex Maps (Trainiert von Servercow) Rspamd TCP 443 bazaar.abuse.ch Download von Mailware MD5 Prüfsummen zur Erkennung von Rspamd Rspamd TCP 443 urlhaus.abuse.ch Download von Malware Downloads Links zur Erkennung in Rspamd Rspamd UDP 11445 fuzzy.mailcow.email Anbindung an Globalen mailcow Fuzzy (Trainiert von Servercow + Community) Rspamd UDP 11335 fuzzy1.rspamd.com &amp; fuzzy2.rspamd.com Anbindung an Globalen Rspamd Fuzzy (Trainiert vom Rspamd Team) Unbound TCP &amp; UDP 53 Beliebig / Any DNS Auflösung für mailcow Stack (Zur Validierung von DNSSEC und Abruf von Spamlistinformationen) Unbound ICMP (Ping) 1.1.1.1, 8.8.8.8, 9.9.9.9 Simpler Internet Konnektivitätscheck","path":["Prerequisite system.de"],"tags":[]},{"location":"de/getstarted/prerequisite-system.de/#wichtig-fur-hetzner-firewalls","level":3,"title":"Wichtig für Hetzner Firewalls","text":"<p>Ich zitiere https://github.com/chermsen über https://github.com/mailcow/mailcow-dockerized/issues/497#issuecomment-469847380 (DANKE!):</p> <p>Für alle, die mit der Hetzner-Firewall zu kämpfen haben:</p> <p>Port 53 ist in diesem Fall für die Firewall-Konfiguration unwichtig. Laut Dokumentation verwendet unbound den Portbereich 1024-65535 für ausgehende Anfragen. Da es sich bei der Hetzner Robot Firewall um eine statische Firewall handelt (jedes eingehende Paket wird isoliert geprüft) - müssen die folgenden Regeln angewendet werden:</p> <p>Für TCP <pre><code>SRC-IP: ---\nDST-IP: ---\nSRC-Port: ---\nDST-Port: 1024-65535\nProtokoll: tcp\nTCP-Flags: ack\nAktion:      Akzeptieren\n</code></pre></p> <p>Für UDP <pre><code>SRC-IP: ---\nDST-IP: ---\nSRC-Port: ---\nDST-Port: 1024-65535\nProtokoll: udp\nAktion:      Akzeptieren\n</code></pre></p> <p>Wenn man einen restriktiveren Portbereich anwenden will, muss man zuerst die Konfiguration von unbound ändern (nach der Installation):</p> <p>{mailcow-dockerized}/data/conf/unbound/unbound.conf: <pre><code>outgoing-port-avoid: 0-32767\n</code></pre></p> <p>Nun können die Firewall-Regeln wie folgt angepasst werden:</p> <pre><code>[...]\nDST Port: 32768-65535\n[...]\n</code></pre>","path":["Prerequisite system.de"],"tags":[]},{"location":"de/getstarted/prerequisite-system.de/#datum-und-uhrzeit","level":2,"title":"Datum und Uhrzeit","text":"<p>Um sicherzustellen, dass Sie das richtige Datum und die richtige Zeit auf Ihrem System eingestellt haben, überprüfen Sie bitte die Ausgabe von <code>timedatectl status</code>:</p> <pre><code>$ timedatectl status\n      Lokale Zeit: Sat 2017-05-06 02:12:33 CEST\n  Weltzeit: Sa 2017-05-06 00:12:33 UTC\n        RTC-Zeit: Sa 2017-05-06 00:12:32\n       Zeitzone: Europa/Berlin (MESZ, +0200)\n     NTP aktiviert: ja\nNTP synchronisiert: ja\n RTC in lokaler TZ: nein\n      Sommerzeit aktiv: ja\n Letzte DST-Änderung: Sommerzeit begann am\n                  Sonne 2017-03-26 01:59:59 MEZ\n                  So 2017-03-26 03:00:00 MESZ\n Nächste Sommerzeitänderung: Die Sommerzeit endet (die Uhr springt eine Stunde rückwärts) am\n                  Sun 2017-10-29 02:59:59 MESZ\n                  Sun 2017-10-29 02:00:00 MEZ\n</code></pre> <p>Die Zeilen <code>NTP aktiviert: ja</code> und <code>NTP synchronisiert: ja</code> zeigen an, ob Sie NTP aktiviert haben und ob es synchronisiert ist.</p> <p>Um NTP zu aktivieren, müssen Sie den Befehl <code>timedatectl set-ntp true</code> ausführen. Sie müssen auch Ihre <code>/etc/systemd/timesyncd.conf</code> bearbeiten:</p> <pre><code># vim /etc/systemd/timesyncd.conf\n[Zeit]\nNTP=0.pool.ntp.org 1.pool.ntp.org 2.pool.ntp.org 3.pool.ntp.org\n</code></pre>","path":["Prerequisite system.de"],"tags":[]},{"location":"de/getstarted/prerequisite-system.de/#hetzner-cloud-und-wahrscheinlich-andere","level":2,"title":"Hetzner Cloud (und wahrscheinlich andere)","text":"<p>Prüfen Sie <code>/etc/network/interfaces.d/50-cloud-init.cfg</code> und ändern Sie die IPv6-Schnittstelle von eth0:0 auf eth0:</p> <pre><code># Falsch:\nauto eth0:0\niface eth0:0 inet6 static\n# Richtig:\nauto eth0\niface eth0 inet6 static\n</code></pre> <p>Starten Sie die Schnittstelle neu, um die Einstellungen zu übernehmen. Sie können außerdem die cloud-init Netzwerkänderungen deaktivieren.</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"de/getstarted/prerequisite-system.de/#mtu","level":2,"title":"MTU","text":"<p>Besonders relevant für OpenStack-Benutzer: Überprüfen Sie Ihre MTU und setzen Sie sie entsprechend in docker-compose.yml. Siehe Problebehandlungen in unseren Installationsanleitungen.</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"de/getstarted/prerequisite-system.en/","level":1,"title":"Prerequisite system.en","text":"<p>Before you run mailcow: dockerized, there are a few requirements that you should check:</p> <p>Warning</p> <p>Do not try to install mailcow on a Synology/QNAP device (any NAS), OpenVZ, LXC or other container platforms. KVM, ESX, Hyper-V and other full virtualization platforms are supported.</p> <p>Info</p> <ul> <li>mailcow: dockerized requires some ports to be open for incoming connections, so make sure that your firewall is not blocking these.</li> <li>Make sure that no other application is interfering with mailcow's configuration, such as another mail service</li> <li>A correct DNS setup is crucial to every good mailserver setup, so please make sure you got at least the basics covered before you begin!</li> <li>Make sure that your system has a correct date and time setup. This is crucial for various components like two factor TOTP authentication.</li> </ul>","path":["Prerequisite system.en"],"tags":[]},{"location":"de/getstarted/prerequisite-system.en/#minimum-system-resources","level":2,"title":"Minimum System Resources","text":"<p>Please make sure that your system has at least the following resources:</p> Resource Minimal Requirement CPU 1 GHz RAM Minimum 6 GiB + 1 GiB swap (default config) Disk 20 GiB (without emails) Architecture x86_64, ARM64 <p>Not supported</p> <p>OpenVZ, Virtuozzo and LXC</p> <p>ClamAV and Solr can be greedy with RAM. You may disable them in <code>mailcow.conf</code> by settings <code>SKIP_CLAMD=y</code> and <code>SKIP_SOLR=y</code>.</p> <p>Info</p> <p>We are aware that a pure MTA can run on 128 MiB RAM. mailcow is a full-grown and ready-to-use groupware with many extras making life easier. mailcow comes with a webserver, webmailer, ActiveSync (MS), antivirus, antispam, indexing (Solr), document scanner (Oletools), SQL (MariaDB), Cache (Redis), MDA, MTA, various web services etc.</p> <p>A single SOGo worker can acquire ~350 MiB RAM before it gets purged. The more ActiveSync connections you plan to use, the more RAM you will need. A default configuration spawns 20 workers.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"de/getstarted/prerequisite-system.en/#ram-usage-examples","level":4,"title":"RAM usage examples","text":"<p>A company with 15 phones (EAS enabled) and about 50 concurrent IMAP connections should plan 16 GiB RAM.</p> <p>6 GiB RAM + 1 GiB swap are fine for most private installations while 8 GiB RAM are recommended for ~5 to 10 users.</p> <p>We can help to correctly plan your setup as part of our support.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"de/getstarted/prerequisite-system.en/#supported-os","level":3,"title":"Supported OS","text":"<p>Important</p> <p>mailcow is using Docker as a base component, due to some technical differences across multiple platforms we do not support all, even if they can run Docker.</p> <p>The following table contains all operating systems officially supported and tested by us (as of December 2024):</p> OS Compatibility Alpine since 3.17 ⚠️ Debian 11, 12 ✅ Ubuntu 20.04 - 24.04 ✅ Alma Linux 8, 9 ✅ Rocky Linux 9 ✅ <p>Legend</p> <p>✅ = Works out of the box using the instructions. ⚠️ = Requires some manual adjustments otherwise usable. ❌ = In general NOT Compatible. ❔ = Pending.</p> <p>Warning</p> <p>Note: All other operating systems (not mentioned) may also work, but have not been officially tested.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"de/getstarted/prerequisite-system.en/#firewall-ports","level":2,"title":"Firewall &amp; Ports","text":"<p>Please check if any of mailcow's standard ports are open and not in use by other applications:</p> <pre><code>ss -tlpn | grep -E -w '25|80|110|143|443|465|587|993|995|4190'\n# or:\nnetstat -tulpn | grep -E -w '25|80|110|143|443|465|587|993|995|4190'\n</code></pre> <p>Danger</p> <p>There are several problems with running mailcow on a firewalld/ufw enabled system.  You should disable it (if possible) and move your ruleset to the DOCKER-USER chain, which is not cleared by a Docker service restart, instead.  See this (blog.donnex.net) or this (unrouted.io) guide for information about how to use iptables-persistent with the DOCKER-USER chain. As mailcow runs dockerized, INPUT rules have no effect on restricting access to mailcow.  Use the FORWARD chain instead.</p> <p>If this command returns any results please remove or stop the application running on that port. You may also adjust mailcows ports via the <code>mailcow.conf</code> configuration file.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"de/getstarted/prerequisite-system.en/#incoming-ports","level":3,"title":"Incoming Ports","text":"<p>If you have a firewall in front of mailcow, please ensure that these ports are open for incoming connections:</p> Service Protocol Port Container Variable Postfix SMTP TCP 25 postfix-mailcow <code>${SMTP_PORT}</code> Postfix SMTPS TCP 465 postfix-mailcow <code>${SMTPS_PORT}</code> Postfix Submission TCP 587 postfix-mailcow <code>${SUBMISSION_PORT}</code> Dovecot IMAP TCP 143 dovecot-mailcow <code>${IMAP_PORT}</code> Dovecot IMAPS TCP 993 dovecot-mailcow <code>${IMAPS_PORT}</code> Dovecot POP3 TCP 110 dovecot-mailcow <code>${POP_PORT}</code> Dovecot POP3S TCP 995 dovecot-mailcow <code>${POPS_PORT}</code> Dovecot ManageSieve TCP 4190 dovecot-mailcow <code>${SIEVE_PORT}</code> HTTP(S) TCP 80/443 nginx-mailcow <code>${HTTP_PORT}</code> / <code>${HTTPS_PORT}</code> <p>To bind a service to an IP address, you can prefix the IP address as follows: <code>SMTP_PORT=1.2.3.4:25</code></p> <p>Important: You cannot use IP:PORT bindings for <code>HTTP_PORT</code> and <code>HTTPS_PORT</code>. Please use <code>HTTP_PORT=1234</code> and <code>HTTP_BIND=1.2.3.4</code> instead.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"de/getstarted/prerequisite-system.en/#outgoing-portshosts","level":3,"title":"Outgoing Ports/Hosts","text":"<p>Some outgoing connections are required to use mailcow. Ensure that mailcow can communicate with the following hosts or ports:</p> Service Protocol Port Target Reason Clamd TCP 873 rsync.sanesecurity.net Download ClamAV signatures (prebundled in mailcow) Dovecot TCP 443 spamassassin.heinlein-support.de Download Spamassassin rules processed by Rspamd, downloaded via Dovecot mailcow Processes TCP 80/443 github.com Download mailcow updates (code-based) mailcow Processes TCP 443 hub.docker.com Download Docker images (directly from Docker Hub) mailcow Processes TCP 443 asn-check.mailcow.email API request for BAD ASN checks (for Spamhaus Free Blocklists) mailcow Processes TCP 80 ip4.mailcow.email &amp; ip6.mailcow.email Retrieve public IP address for display in UI (optional) Postfix TCP 25, 465 Any Outgoing connection for MTA Rspamd TCP 80 fuzzy.mailcow.email Download bad subject regex maps (trained by Servercow) Rspamd TCP 443 bazaar.abuse.ch Download malware MD5 checksums for detection by Rspamd Rspamd TCP 443 urlhaus.abuse.ch Download malware download links for detection in Rspamd Rspamd UDP 11445 fuzzy.mailcow.email Connection to global mailcow fuzzy (trained by Servercow + community) Rspamd UDP 11335 fuzzy1.rspamd.com &amp; fuzzy2.rspamd.com Connection to global Rspamd fuzzy (trained by the Rspamd team) Unbound TCP &amp; UDP 53 Any DNS resolution for the mailcow stack (for DNSSEC validation and retrieval of spam list info) Unbound ICMP (Ping) 1.1.1.1, 8.8.8.8, 9.9.9.9 Basic internet connectivity check","path":["Prerequisite system.en"],"tags":[]},{"location":"de/getstarted/prerequisite-system.en/#important-for-hetzner-firewalls","level":3,"title":"Important for Hetzner firewalls","text":"<p>Quoting https://github.com/chermsen via https://github.com/mailcow/mailcow-dockerized/issues/497#issuecomment-469847380 (THANK YOU!):</p> <p>For all who are struggling with the Hetzner firewall:</p> <p>Port 53 unimportant for the firewall configuration in this case. According to the documentation unbound uses the port range 1024-65535 for outgoing requests. Since the Hetzner Robot Firewall is a static firewall (each incoming packet is checked isolated) - the following rules must be applied:</p> <p>For TCP <pre><code>SRC-IP:       ---\nDST IP:       ---\nSRC Port:    ---\nDST Port:    1024-65535\nProtocol:    tcp\nTCP flags:   ack\nAction:      Accept\n</code></pre></p> <p>For UDP <pre><code>SRC-IP:       ---\nDST IP:       ---\nSRC Port:    ---\nDST Port:    1024-65535\nProtocol:    udp\nAction:      Accept\n</code></pre></p> <p>If you want to apply a more restrictive port range you have to change the config of unbound first (after installation):</p> <p>{mailcow-dockerized}/data/conf/unbound/unbound.conf: <pre><code>outgoing-port-avoid: 0-32767\n</code></pre></p> <p>Now the firewall rules can be adjusted as follows:</p> <pre><code>[...]\nDST Port:  32768-65535\n[...]\n</code></pre>","path":["Prerequisite system.en"],"tags":[]},{"location":"de/getstarted/prerequisite-system.en/#date-and-time","level":2,"title":"Date and Time","text":"<p>To ensure that you have the correct date and time setup on your system, please check the output of <code>timedatectl status</code>:</p> <pre><code>$ timedatectl status\n      Local time: Sat 2017-05-06 02:12:33 CEST\n  Universal time: Sat 2017-05-06 00:12:33 UTC\n        RTC time: Sat 2017-05-06 00:12:32\n       Time zone: Europe/Berlin (CEST, +0200)\n     NTP enabled: yes\nNTP synchronized: yes\n RTC in local TZ: no\n      DST active: yes\n Last DST change: DST began at\n                  Sun 2017-03-26 01:59:59 CET\n                  Sun 2017-03-26 03:00:00 CEST\n Next DST change: DST ends (the clock jumps one hour backwards) at\n                  Sun 2017-10-29 02:59:59 CEST\n                  Sun 2017-10-29 02:00:00 CET\n</code></pre> <p>The lines <code>NTP enabled: yes</code> and <code>NTP synchronized: yes</code> indicate whether you have NTP enabled and if it's synchronized.</p> <p>To enable NTP you need to run the command <code>timedatectl set-ntp true</code>. You also need to edit your <code>/etc/systemd/timesyncd.conf</code>:</p> <pre><code># vim /etc/systemd/timesyncd.conf\n[Time]\nNTP=0.pool.ntp.org 1.pool.ntp.org 2.pool.ntp.org 3.pool.ntp.org\n</code></pre>","path":["Prerequisite system.en"],"tags":[]},{"location":"de/getstarted/prerequisite-system.en/#hetzner-cloud-and-probably-others","level":2,"title":"Hetzner Cloud (and probably others)","text":"<p>Check <code>/etc/network/interfaces.d/50-cloud-init.cfg</code> and change the IPv6 interface from eth0:0 to eth0:</p> <pre><code># Wrong:\nauto eth0:0\niface eth0:0 inet6 static\n# Right:\nauto eth0\niface eth0 inet6 static\n</code></pre> <p>Reboot or restart the interface. You may want to disable cloud-init network changes.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"de/getstarted/prerequisite-system.en/#mtu","level":2,"title":"MTU","text":"<p>Especially relevant for OpenStack users: Check your MTU and set it accordingly in docker-compose.yml. See Troubleshooting in our Installation guide.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"de/maintenance/deinstall.de/","level":1,"title":"Deinstall.de","text":"<p>Um mailcow: dockerized mit all seinen Volumes, Images und Containern zu entfernen, tun Sie dies:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down -v --rmi all --remove-orphans\n</code></pre> <pre><code>docker-compose down -v --rmi all --remove-orphans\n</code></pre> <p>Info</p> <ul> <li>-v Entfernt benannte Volumes, die im Abschnitt <code>volumes</code> der Compose-Datei deklariert sind, und anonyme Volumes, die an Container angehängt sind.</li> <li>--rmi  Images entfernen. Der Typ muss einer der folgenden sein: <code>all</code>: Entfernt alle Images, die von einem beliebigen Dienst verwendet werden. <code>local</code>: Entfernt nur Bilder, die kein benutzerdefiniertes Tag haben, das durch das Feld \"image\" gesetzt wurde. <li>--remove-orphans Entfernt Container für Dienste, die nicht in der Compose-Datei definiert sind.</li> <li>Standardmäßig entfernt <code>docker compose down</code> nur derzeit aktive Container und Netzwerke, die in der Datei <code>docker-compose.yml</code> definiert sind.</li>","path":["Deinstall.de"],"tags":[]},{"location":"de/maintenance/deinstall.en/","level":1,"title":"Deinstall.en","text":"<p>To remove mailcow: dockerized with all it's volumes, images and containers do:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down -v --rmi all --remove-orphans\n</code></pre> <pre><code>docker-compose down -v --rmi all --remove-orphans\n</code></pre> <p>Info</p> <ul> <li>-v Remove named volumes declared in the <code>volumes</code> section of the Compose file and anonymous volumes attached to containers.</li> <li>--rmi  Remove images. Type must be one of: <code>all</code>: Remove all images used by any service. <code>local</code>: Remove only images that don't have a custom tag set by the <code>image</code> field. <li>--remove-orphans Remove containers for services not defined in the compose file.</li> <li>By default <code>docker compose down</code> only removes currently active containers and networks defined in the <code>docker-compose.yml</code>.</li>","path":["Deinstall.en"],"tags":[]},{"location":"de/maintenance/migration.de/","level":1,"title":"Migration.de","text":"<p>Warnung</p> <p>Diese Anleitung geht davon aus, dass Sie beabsichtigen, einen bestehenden mailcow-Server (Quelle) auf einen brandneuen, leeren Server (Ziel) zu migrieren. Sie kümmert sich nicht um die Erhaltung bestehender Daten auf dem Zielserver und löscht alles innerhalb von <code>/var/lib/docker/volumes</code> und somit alle Docker-Volumes, die Sie bereits eingerichtet haben.</p> <p>Tip</p> <p>Alternativ können Sie das Skript <code>./helper-scripts/backup_and_restore.sh</code> verwenden, um ein vollständiges Backup auf der Quellmaschine zu erstellen, dann installieren Sie mailcow auf der Zielmaschine wie gewohnt, kopieren Sie Ihre <code>mailcow.conf</code> und verwenden Sie das gleiche Skript, um Ihr Backup auf der Zielmaschine wiederherzustellen.</p> <p>1. Befolgen Sie die Installationsanleitung von Docker und Compose.</p> <p>2. Stoppen Sie Docker und stellen Sie sicher, dass Docker gestoppt wurde: <pre><code>systemctl stop docker.service\nsystemctl status docker.service\n</code></pre></p> <p>3. Führen Sie die folgenden Befehle auf dem Quellcomputer aus (achten Sie darauf, die abschließenden Schrägstriche im ersten Pfadparameter wie unten gezeigt hinzuzufügen!) - WARNUNG: Dieser Befehl löscht alles, was bereits unter <code>/var/lib/docker/volumes</code> auf dem Zielrechner existiert:</p> Innerhalb der selben ArchitekturAuf andere Architektur <pre><code>rsync -aHhP --numeric-ids --delete /opt/mailcow-dockerized/ root@target-machine.example.com:/opt/mailcow-dockerized\nrsync -aHhP --numeric-ids --delete /var/lib/docker/volumes/ root@target-machine.example.com:/var/lib/docker/volumes\n</code></pre> <pre><code>rsync -aHhP --numeric-ids --delete /opt/mailcow-dockerized/ root@target-machine.example.com:/opt/mailcow-dockerized\nrsync -aHhP --numeric-ids --delete --exclude '*rspamd-vol-1' /var/lib/docker/volumes/ root@target-machine.example.com:/var/lib/docker/volumes\n</code></pre> <p>Achtung</p> <p>Bitte befolgen Sie die Anweisungen für den jeweiligen Anwendungsfall, da bei einer Migration auf eine andere Architektur das Volume <code>rspamd-vol-1</code> ausgelassen werden muss, da es inkompatible Hyperscan-Cache-Dateien enthält, die bei einem Plattformwechsel zu Abstürzen mit anschließendem Nichtstart von Rspamd führen.</p> <p>Die Hyperscan-Cache-Dateien werden bei einem Neustart von Rspamd automatisch regeneriert, wenn diese nicht existieren.</p> <p>4. Schalten Sie mailcow ab und stoppen Sie Docker auf dem Quellrechner.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ndocker compose down\nsystemctl stop docker.service\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ndocker-compose down\nsystemctl stop docker.service\n</code></pre> <p>5. Wiederholen Sie Schritt 3 mit denselben Befehlen. Dies wird viel schneller gehen als beim ersten Mal, da nun nur noch die Differenzen übertragen werden.</p> <p>6. Wechseln Sie auf den Zielrechner und starten Sie Docker. <pre><code>systemctl start docker.service\n</code></pre></p> <p>7. Ziehen Sie nun die mailcow Docker-Images auf den Zielrechner.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ndocker compose pull\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ndocker-compose pull\n</code></pre> <p>8. Starten Sie den gesamten mailcow-Stack und alles sollte fertig sein!</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>9. Zum Schluss ändern Sie Ihre DNS-Einstellungen so, dass sie auf den Zielserver zeigen. Prüfen und ändern Sie gegebenenfalls die <code>SNAT_TO_SOURCE</code> Variable in der <code>mailcow.conf</code> im mailcow-dockerized Ordner, da andernfalls SOGo nicht richtig funktioniert, wenn die ausgehende IP eine andere ist.</p>","path":["Migration.de"],"tags":[]},{"location":"de/maintenance/migration.en/","level":1,"title":"Migration.en","text":"<p>Warning</p> <p>This guide assumes you intend to migrate an existing mailcow server (source) over to a brand new, empty server (target). It takes no care about preserving any existing data on your target server and will erase anything within <code>/var/lib/docker/volumes</code> and thus any Docker volumes you may have already set up.</p> <p>Tip</p> <p>Alternatively, you can use the <code>./helper-scripts/backup_and_restore.sh</code> script to create a full backup on the source machine, then install mailcow on the target machine as usual, copy over your <code>mailcow.conf</code> and use the same script to restore your backup to the target machine.</p> <p>1. Follow the installation guide to install Docker and Compose.</p> <p>2. Stop Docker and assure Docker has stopped: <pre><code>systemctl stop docker.service\nsystemctl status docker.service\n</code></pre></p> <p>3. Run the following commands on the source machine (take care of adding the trailing slashes in the first path parameter as shown below!) - WARNING: This command will erase anything that may already exist under <code>/var/lib/docker/volumes</code> on the target machine:</p> Within the same architectureTo other architecture <pre><code>rsync -aHhP --numeric-ids --delete /opt/mailcow-dockerized/ root@target-machine.example.com:/opt/mailcow-dockerized\nrsync -aHhP --numeric-ids --delete /var/lib/docker/volumes/ root@target-machine.example.com:/var/lib/docker/volumes\n</code></pre> <pre><code>rsync -aHhP --numeric-ids --delete /opt/mailcow-dockerized/ root@target-machine.example.com:/opt/mailcow-dockerized\nrsync -aHhP --numeric-ids --delete --exclude '*rspamd-vol-1' /var/lib/docker/volumes/ root@target-machine.example.com:/var/lib/docker/volumes\n</code></pre> <p>Danger</p> <p>Please follow the instructions for the respective use case, as the volume <code>rspamd-vol-1</code> must be omitted when migrating to a different architecture, as it contains incompatible hyperscan cache files that lead to crashes and subsequent failure to start Rspamd when switching platforms.</p> <p>The hyperscan cache files are automatically regenerated when Rspamd is restarted if they do not exist.</p> <p>4. Shut down mailcow and stop Docker on the source machine.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ndocker compose down\nsystemctl stop docker.service\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ndocker-compose down\nsystemctl stop docker.service\n</code></pre> <p>5. Repeat step 3 with the same commands. This will be much quicker than the first time as it now only syncs the diffs.</p> <p>6. Switch over to the target machine and start Docker. <pre><code>systemctl start docker.service\n</code></pre></p> <p>7. Now pull the mailcow Docker images on the target machine.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ndocker compose pull\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ndocker-compose pull\n</code></pre> <p>8. Start the whole mailcow stack and everything should be done!</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>9. Finally, change your DNS settings to point to the target server. Also check the <code>SNAT_TO_SOURCE</code> variable in your <code>mailcow.conf</code> file if you have changed your public IP address, otherwise SOGo may not work.</p>","path":["Migration.en"],"tags":[]},{"location":"de/maintenance/update.de/","level":1,"title":"Update.de","text":"","path":["Update.de"],"tags":[]},{"location":"de/maintenance/update.de/#mailcow-automatisch-updaten","level":2,"title":"mailcow automatisch Updaten","text":"<p>Ein Update-Skript in Ihrem mailcow-dockerized Verzeichnis kümmert sich um Updates.</p> <p>Führen sie das Update-Skript aus: <pre><code>./update.sh\n</code></pre></p> <p>Wenn es nötig ist, wird es Sie fragen, wie Sie fortfahren möchten. Merge-Fehler werden gemeldet. Einige kleinere Konflikte werden automatisch korrigiert (zugunsten des mailcow-dockerized repository code).</p>","path":["Update.de"],"tags":[]},{"location":"de/maintenance/update.de/#optionen","level":3,"title":"Optionen","text":"<pre><code># Optionen können kombiniert werden\n\n# - Prüft auf Updates und zeigt Änderungen an\n./update.sh --check\n\n# - Starten Sie mailcow nicht, nachdem Sie ein Update durchgeführt haben\n./update.sh --skip-start\n\n# - Überspringt den ICMP Check auf die öffentlichen DNS Resolver (Bitte nur nutzen, wenn keinerlei ICMP Verbindungen von und zur mailcow erlaubt sind)\n./update.sh --skip-ping-check\n\n# - Wechselt die Update Quellen der mailcow auf nightly (unstabile) Inhalte.\nNUR ZUM TESTEN VERWENDEN!! KEIN PRODUKTIV BETRIEB!!!\n./update.sh --nightly\n\n# - Wechselt die Update Quellen der mailcow auf stable (stabile) Inhalte (standard).\n./update.sh --stable\n\n# - Erzwinge Update (unbeaufsichtigt, aber nicht unterstützt, Benutzung auf eigenes Risiko)\n./update.sh --force\n\n# - Garbage Collector ausführen, um alte Image-Tags zu bereinigen und beenden\n./update.sh --gc\n\n# - Update mit der Merge-Strategie-Option \"ours\" statt \"theirs\"\n# Dies wird **Konflikte** beim Zusammenführen zugunsten Ihrer lokalen Änderungen lösen und sollte vermieden werden. Lokale Änderungen werden immer beibehalten, es sei denn, wir haben auch die Datei XY geändert.\n./update.sh --ours\n\n# - Nicht aktualisieren, nur holen von Docker Images\n./update.sh --prefetch\n</code></pre>","path":["Update.de"],"tags":[]},{"location":"de/maintenance/update.de/#ich-habe-vergessen-was-ich-vor-dem-ausfuhren-von-updatesh-geandert-habe","level":3,"title":"Ich habe vergessen, was ich vor dem Ausführen von update.sh geändert habe.","text":"<p>Siehe <code>git log --pretty=oneline | grep -i \"before update\"</code>, Sie werden eine Ausgabe ähnlich dieser haben:</p> <pre><code>22cd00b5e28893ef9ddef3c2b5436453cc5223ab Before update on 2020-09-28_19_25_45\ndacd4fb9b51e9e1c8a37d84485b92ffaf6c59353 Before update on 2020-08-07_13_31_31\n</code></pre> <p>Führen Sie <code>git diff 22cd00b5e28893ef9ddef3c2b5436453cc5223ab</code> aus, um zu sehen, was sich geändert hat.</p>","path":["Update.de"],"tags":[]},{"location":"de/maintenance/update.de/#kann-ich-ein-rollback-durchfuhren","level":3,"title":"Kann ich ein Rollback durchführen?","text":"<p>Ja.</p> <p>Siehe das obige Thema, anstelle eines Diffs führen Sie checkout aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\n# Ersetzen Sie die Commit-ID 22cd00b5e28893ef9ddef3c2b5436453cc5223ab durch Ihre ID\ngit checkout 22cd00b5e28893ef9ddef3c2b5436453cc5223ab\ndocker compose pull\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\n# Ersetzen Sie die Commit-ID 22cd00b5e28893ef9ddef3c2b5436453cc5223ab durch Ihre ID\ngit checkout 22cd00b5e28893ef9ddef3c2b5436453cc5223ab\ndocker-compose pull\ndocker-compose up -d\n</code></pre>","path":["Update.de"],"tags":[]},{"location":"de/maintenance/update.de/#hooks","level":3,"title":"Hooks","text":"<p>Sie können sich in den Update-Mechanismus einklinken, indem Sie Skripte namens <code>pre_commit_hook.sh</code> und <code>post_commit_hook.sh</code> zu Ihrem mailcows-Root-Verzeichnis hinzufügen. Siehe hier für weitere Details.</p>","path":["Update.de"],"tags":[]},{"location":"de/maintenance/update.de/#update-zyklus","level":2,"title":"Update-Zyklus","text":"<ul> <li>Wir planen in jedem Monat ein neues Hauptupdate zu veröffentlichen.</li> <li>Die Updates sind wie folgt nummeriert: <code>JJJJ-MM</code> (Beispiel: <code>2022-05</code>).</li> <li>Fehlerkorrekturen eines Hauptupdates werden bei uns als \"Revisionen\" wie a,b,c (Beispiele: <code>2022-05a</code>, <code>2022-05b</code> usw.) erscheinen.</li> </ul>","path":["Update.de"],"tags":[]},{"location":"de/maintenance/update.de/#update-varianten","level":2,"title":"Update-Varianten","text":"<p>stable (stabile Updates): Diese Updates sind für den Produktivbetrieb geeignet. Sie erscheinen in einem Zyklus von mindest 1x im Monat.</p> <p>nightly (instabile Updates): Diese Updates sind NICHT für den Produktivbetrieb geeignet und dienen lediglich dem Testen. Die nightly Updates sind den stabilen Updates vorraus, da in diesen neue und auch umfangreichere Funktionen getestet werden bevor diese für alle User Live gehen.</p>","path":["Update.de"],"tags":[]},{"location":"de/maintenance/update.de/#nightly-updates-beziehen","level":2,"title":"Nightly Updates beziehen","text":"","path":["Update.de"],"tags":[]},{"location":"de/maintenance/update.de/#infos-zu-den-nightly-updates","level":3,"title":"Infos zu den Nightly Updates","text":"<p>Seit dem 2022-08 Update gibt es die Möglichkeit die Update quellen zu ändern. Bisher diente der master Branch auf GitHub als einzige (offizieller) Update Quelle. Mit dem August 2022 Update gibt es aber nun noch den Nightly Branch welcher instabile und größere Änderungen zum testen und Feedback geben enthält.</p> <p>Dabei bekommt der Nightly Branch immer dann neue Updates, wenn irgendetwas am mailcow Projekt fertig gemacht wurde was in die neue Hauptversion reinkommt.</p> <p>Neben den offensichtlichen neuerungen welche sowieso im nächsten Major Update enthalten sein werden enthält er ebenfalls erstmal exklusive Features welche eine längere Testzeit brauchen (bspw. das UI Update auf Bootstrap 5).</p>","path":["Update.de"],"tags":[]},{"location":"de/maintenance/update.de/#wie-bekomme-ich-nightly-updates","level":3,"title":"Wie bekomme ich Nightly Updates?","text":"<p>Der Vorgang ist relativ simpel. Mit dem 2022-08 Update (ein Update auf die Version voraussgesetzt) ist es möglich die <code>update.sh</code> mit dem Parameter <code>--nightly</code> zu starten.</p> <p>Achtung</p> <p>Bitte machen Sie vorher ein Backup oder folgen Sie dem Abschnitt Best Practice Nightly Update bevor Sie auf die Nightly Builds von mailcow wechseln. Wir sind für keinerlei Datenverluste/korruptionen verantwortlich, also arbeiten Sie mit bedacht!</p> <p>Das Skript wird nun den Branch wechseln mit <code>git checkout nightly</code> d.h. es wird auch wieder nach den IPv6 Einstellungen fragen. Das ist aber normal.</p> <p>Sollte alles problemlos geklappt haben (wofür wir ja auch vorsichtshalber ein Backup vorher gemacht haben) sollte nun in der mailcow UI unten rechts die aktuelle Versionsnummer samt Datumsstempel abgebildet sein:  </p>","path":["Update.de"],"tags":[]},{"location":"de/maintenance/update.de/#best-practice-nightly-update","level":3,"title":"Best Practice Nightly Update","text":"<p>Info</p> <p>Wir empfehlen die Benutzung des Nightly Updates nur dann, wenn Ihr eine weitere Maschine oder VM besitzt und diese NICHT Produktiv nutzt.</p> <ol> <li>Das Cold-Standby Skript nutzen um die Maschine vor dem Schwenk auf die Nightly Builds auf ein anderes System zu kopieren.</li> <li>Das <code>update.sh</code> Skript auf der neuen Maschine mit dem Parameter <code>--nightly</code> ausführen und bestätigen.</li> <li>Die Nightly Updates auf der sekundären Maschine erleben/testen.</li> </ol>","path":["Update.de"],"tags":[]},{"location":"de/maintenance/update.en/","level":1,"title":"Update.en","text":"","path":["Update.en"],"tags":[]},{"location":"de/maintenance/update.en/#automatic-update","level":2,"title":"Automatic update","text":"<p>An update script in your mailcow-dockerized directory will take care of updates.</p> <p>Run the update script: <pre><code>./update.sh\n</code></pre></p> <p>If it needs to, it will ask you how you wish to proceed. Merge errors will be reported. Some minor conflicts will be auto-corrected (in favour for the mailcow-dockerized repository code).</p>","path":["Update.en"],"tags":[]},{"location":"de/maintenance/update.en/#options","level":3,"title":"Options","text":"<pre><code># Options can be combined\n\n# - Check for updates and show changes\n./update.sh --check\n\n# - Do not start mailcow after applying an update\n./update.sh --skip-start\n\n# - Skip ICMP Check to public DNS resolvers (Use it only if you´ve blocked any ICMP Connections to your mailcow machine)\n./update.sh --skip-ping-check\n\n# - Switch your mailcow updates to the unstable (nightly) branch.\nFOR TESTING PURPOSES ONLY!!!! NOT READY FOR PRODUCTION!!!\n./update.sh --nightly\n\n# - Switch your mailcow updates to the stable (master) branch. Default unless you changed it with --nightly.\n./update.sh --stable\n\n# - Force update (unattended, but unsupported, use at own risk)\n./update.sh --force\n\n# - Run garbage collector to cleanup old image tags and exit\n./update.sh --gc\n\n# - Update with merge strategy option \"ours\" instead of \"theirs\"\n#   This will **solve conflicts** when merging in favor for your local changes and should be avoided. Local changes will always be kept, unless we changed file XY, too.\n./update.sh --ours\n\n# - Don't update, but prefetch images and exit\n./update.sh --prefetch\n</code></pre>","path":["Update.en"],"tags":[]},{"location":"de/maintenance/update.en/#i-forgot-what-i-changed-before-running-updatesh","level":3,"title":"I forgot what I changed before running update.sh","text":"<p>See <code>git log --pretty=oneline | grep -i \"before update\"</code>, you will have an output similar to this:</p> <pre><code>22cd00b5e28893ef9ddef3c2b5436453cc5223ab Before update on 2020-09-28_19_25_45\ndacd4fb9b51e9e1c8a37d84485b92ffaf6c59353 Before update on 2020-08-07_13_31_31\n</code></pre> <p>Run <code>git diff 22cd00b5e28893ef9ddef3c2b5436453cc5223ab</code> to see what changed.</p>","path":["Update.en"],"tags":[]},{"location":"de/maintenance/update.en/#can-i-roll-back","level":3,"title":"Can I roll back?","text":"<p>Yes.</p> <p>See the topic above, instead of a diff, you run checkout:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\n# Ersetzen Sie die Commit-ID 22cd00b5e28893ef9ddef3c2b5436453cc5223ab durch Ihre ID\ngit checkout 22cd00b5e28893ef9ddef3c2b5436453cc5223ab\ndocker compose pull\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\n# Ersetzen Sie die Commit-ID 22cd00b5e28893ef9ddef3c2b5436453cc5223ab durch Ihre ID\ngit checkout 22cd00b5e28893ef9ddef3c2b5436453cc5223ab\ndocker-compose pull\ndocker-compose up -d\n</code></pre>","path":["Update.en"],"tags":[]},{"location":"de/maintenance/update.en/#hooks","level":3,"title":"Hooks","text":"<p>You can hook into the update mechanism by adding scripts called <code>pre_commit_hook.sh</code> and <code>post_commit_hook.sh</code> to your mailcows root directory. See this for more details.</p>","path":["Update.en"],"tags":[]},{"location":"de/maintenance/update.en/#update-cycle","level":2,"title":"Update Cycle","text":"<ul> <li>We schedule a monthly release cycle for a major update.</li> <li>The releases are numbered like this: <code>YYYY-MM</code> (e.g. <code>2022-05</code>)</li> <li>Fixes for a main Update will be stated as \"Revisions\" like a,b,c (e.g. <code>2022-05a</code>, <code>2022-05b</code> etc.)</li> </ul>","path":["Update.en"],"tags":[]},{"location":"de/maintenance/update.en/#update-variants","level":2,"title":"Update variants","text":"<p>stable (stable updates): These updates are suitable for productive usage. They appear in a cycle of at least 1x per month.</p> <p>nightly (unstable updates): These updates are NOT suitable for production use and are for testing only. The nightly updates are ahead of the stable updates, since in these updates we test newer and more extensive features before they go live for all users.</p>","path":["Update.en"],"tags":[]},{"location":"de/maintenance/update.en/#get-nightly-updates","level":2,"title":"Get Nightly Updates","text":"","path":["Update.en"],"tags":[]},{"location":"de/maintenance/update.en/#info-about-the-nightly-updates","level":3,"title":"Info about the Nightly Updates","text":"<p>Since the 2022-08 update there is the possibility to change the update sources. Until now, the master branch on GitHub served as the only (official) update source. With the August 2022 update, however, there is now the Nightly Branch which contains unstable and major changes for testing and feedback.</p> <p>The Nightly Branch always gets new updates when something is finished on the mailcow project that will be included in the new main version.</p> <p>Besides the obvious changes that will be included in the next major update anyway, it also contains exclusive features that need a longer testing time (e.g. the UI update to Bootstrap 5).</p>","path":["Update.en"],"tags":[]},{"location":"de/maintenance/update.en/#how-do-i-get-nightly-updates","level":3,"title":"How do I get Nightly Updates?","text":"<p>The process is relatively simple. With the 2022-08 update (assuming an update to the version) it is possible to run <code>update.sh</code> with the parameter <code>--nightly</code>.</p> <p>Danger</p> <p>Please make a backup before or follow the Best Practice Nightly Update section before switching to mailcow nightly builds. We are not responsible for any data loss/corruption, so work with caution!</p> <p>The script will now change the branch with <code>git checkout nightly</code>, which means it will ask for the IPv6 settings again. But this is normal.</p> <p>If everything worked fine (for which we made a backup before) the mailcow UI should now show the current version number and date stamp in the lower right corner: </p>","path":["Update.en"],"tags":[]},{"location":"de/maintenance/update.en/#best-practice-nightly-update","level":3,"title":"Best Practice Nightly Update","text":"<p>Info</p> <p>We recommend using the Nightly Update only if you have another machine or VM and NOT use it productively.</p> <ol> <li>use the cold standby script to copy the machine before the switch to the nightly builds on another system.</li> <li>run the <code>update.sh</code> script on the new machine with the parameter <code>--nightly</code> and confirm.</li> <li>experience/test the nightly updates on the secondary machine.</li> </ol>","path":["Update.en"],"tags":[]},{"location":"de/manual-guides/u_e-80_to_443.de/","level":1,"title":"U e 80 to 443.de","text":"<p>Wenn Sie einen Reverse Proxy vor mailcow verwenden, lesen Sie bitte unsere Reverse Proxy Anleitung, die eine Umleitung von HTTP auf HTTPS beinhaltet.</p> <p>Öffne <code>mailcow.conf</code> und setze <code>HTTP_BIND=</code> - falls nicht bereits gesetzt.</p>","path":["U e 80 to 443.de"],"tags":[]},{"location":"de/manual-guides/u_e-80_to_443.de/#version-2025-01a","level":3,"title":"Version &gt;= 2025-01a","text":"<p>Öffne <code>mailcow.conf</code> und setze <code>HTTP_REDIRECT=y</code>. Erstellen Sie den Container neu:  </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e 80 to 443.de"],"tags":[]},{"location":"de/manual-guides/u_e-80_to_443.de/#version-2025-01","level":3,"title":"Version &lt; 2025-01","text":"<p>Erstellen Sie eine neue Datei <code>data/conf/nginx/redirect.conf</code> und fügen Sie die folgende Serverkonfiguration in die Datei ein:</p> <pre><code>server {\n  root /web;\n  listen 80 default_server;\n  listen [::]:80 default_server;\n  include /etc/nginx/conf.d/server_name.active;\n  if ( $request_uri ~* \"%0A|%0D\" ) { return 403; }\n  location ^~ /.well-known/acme-challenge/ {\n    allow all;\n    default_type \"text/plain\";\n  }\n  location / {\n    return 301 https://$host$uri$is_args$args;\n  }\n}\n</code></pre> <p>Falls Sie den Parameter HTTP_BIND geändert haben, erstellen Sie den Container neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker compose up -d\n</code></pre> <p>Andernfalls starten Sie Nginx neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart\n</code></pre> <pre><code>docker compose restart\n</code></pre>","path":["U e 80 to 443.de"],"tags":[]},{"location":"de/manual-guides/u_e-80_to_443.en/","level":1,"title":"U e 80 to 443.en","text":"<p>If you are using a reverse proxy in front of mailcow, please see our reverse proxy guide for this, which includes a redirect from HTTP to HTTPS.</p> <p>Open <code>mailcow.conf</code> and set <code>HTTP_BIND=</code> - if not already set.</p>","path":["U e 80 to 443.en"],"tags":[]},{"location":"de/manual-guides/u_e-80_to_443.en/#version-2025-01a","level":3,"title":"Version &gt;= 2025-01a","text":"<p>Open <code>mailcow.conf</code> and set <code>HTTP_REDIRECT=y</code>. Recreate the container:  </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e 80 to 443.en"],"tags":[]},{"location":"de/manual-guides/u_e-80_to_443.en/#version-2025-01","level":3,"title":"Version &lt; 2025-01","text":"<p>Since February the 28th 2017 mailcow does come with port 80 and 443 enabled.</p> <p>Create a new file <code>data/conf/nginx/redirect.conf</code> and add the following server config to the file:</p> <pre><code>server {\n  root /web;\n  listen 80 default_server;\n  listen [::]:80 default_server;\n  include /etc/nginx/conf.d/server_name.active;\n  if ( $request_uri ~* \"%0A|%0D\" ) { return 403; }\n  location ^~ /.well-known/acme-challenge/ {\n    allow all;\n    default_type \"text/plain\";\n  }\n  location / {\n    return 301 https://$host$uri$is_args$args;\n  }\n}\n</code></pre> <p>In case you changed the HTTP_BIND parameter, recreate the container:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Otherwise restart Nginx:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart\n</code></pre> <pre><code>docker-compose restart\n</code></pre>","path":["U e 80 to 443.en"],"tags":[]},{"location":"de/manual-guides/u_e-autodiscover_config.de/","level":1,"title":"U e autodiscover config.de","text":"<p>Sie brauchen diese Datei nicht zu ändern oder zu erstellen, autodiscover funktioniert sofort. Diese Anleitung ist nur für Anpassungen des Autodiscover- oder Autokonfigurationsprozesses gedacht.</p> <p>Neuere Outlook-Clients (insbesondere solche, die mit O365 ausgeliefert werden) führen keine automatische Erkennung von E-Mail-Profilen durch. Denken Sie daran, dass ActiveSync NICHT mit einem Desktop-Client verwendet werden sollte.</p> <p>Öffnen/erstellen Sie <code>data/web/inc/vars.local.inc.php</code> und fügen Sie Ihre Änderungen in das Konfigurationsfeld ein.</p> <p>Die Änderungen werden mit \"$autodiscover_config\" in <code>data/web/inc/vars.inc.php</code> zusammengeführt):</p> <pre><code>&lt;?php\n$autodiscover_config = array(\n  // General autodiscover service type: \"activesync\" or \"imap\"\n  // emClient uses autodiscover, but does not support ActiveSync. mailcow excludes emClient from ActiveSync.\n  'autodiscoverType' =&gt; 'activesync',\n  // If autodiscoverType =&gt; activesync, also use ActiveSync (EAS) for Outlook desktop clients (&gt;= Outlook 2013 on Windows)\n  // Outlook for Mac does not support ActiveSync\n  'useEASforOutlook' =&gt; 'yes',\n  // Please don't use STARTTLS-enabled service ports in the \"port\" variable.\n  // The autodiscover service will always point to SMTPS and IMAPS (TLS-wrapped services).\n  // The autoconfig service will additionally announce the STARTTLS-enabled ports, specified in the \"tlsport\" variable.\n  'imap' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; array_pop(explode(':', getenv('IMAPS_PORT'))),\n    'tlsport' =&gt; array_pop(explode(':', getenv('IMAP_PORT'))),\n  ),\n  'pop3' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; array_pop(explode(':', getenv('POPS_PORT'))),\n    'tlsport' =&gt; array_pop(explode(':', getenv('POP_PORT'))),\n  ),\n  'smtp' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; array_pop(explode(':', getenv('SMTPS_PORT'))),\n    'tlsport' =&gt; array_pop(explode(':', getenv('SUBMISSION_PORT'))),\n  ),\n  'activesync' =&gt; array(\n    'url' =&gt; 'https://'.$mailcow_hostname.($https_port == 443 ? '' : ':'.$https_port).'/Microsoft-Server-ActiveSync',\n  ),\n  'caldav' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; $https_port,\n  ),\n  'carddav' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; $https_port,\n  ),\n);\n</code></pre> <p>Um immer IMAP und SMTP anstelle von EAS zu verwenden, setzen Sie <code>'autodiscoverType' =&gt; 'imap'</code>.</p> <p>Deaktivieren Sie ActiveSync für Outlook-Desktop-Clients, indem Sie \"useEASforOutlook\" auf \"no\" setzen.</p>","path":["U e autodiscover config.de"],"tags":[]},{"location":"de/manual-guides/u_e-autodiscover_config.en/","level":1,"title":"U e autodiscover config.en","text":"<p>You do not need to change or create this file, autodiscover works out of the box. This guide is only meant for customizations to the autodiscover or autoconfig process.</p> <p>Newer Outlook clients (especially those delivered with O365) will not autodiscover mail profiles. Keep in mind, that ActiveSync should NOT be used with a desktop client.</p> <p>Open/create <code>data/web/inc/vars.local.inc.php</code> and add your changes to the configuration array.</p> <p>Changes will be merged with \"$autodiscover_config\" in <code>data/web/inc/vars.inc.php</code>):</p> <pre><code>&lt;?php\n$autodiscover_config = array(\n  // General autodiscover service type: \"activesync\" or \"imap\"\n  // emClient uses autodiscover, but does not support ActiveSync. mailcow excludes emClient from ActiveSync.\n  'autodiscoverType' =&gt; 'activesync',\n  // If autodiscoverType =&gt; activesync, also use ActiveSync (EAS) for Outlook desktop clients (&gt;= Outlook 2013 on Windows)\n  // Outlook for Mac does not support ActiveSync\n  'useEASforOutlook' =&gt; 'yes',\n  // Please don't use STARTTLS-enabled service ports in the \"port\" variable.\n  // The autodiscover service will always point to SMTPS and IMAPS (TLS-wrapped services).\n  // The autoconfig service will additionally announce the STARTTLS-enabled ports, specified in the \"tlsport\" variable.\n  'imap' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; array_pop(explode(':', getenv('IMAPS_PORT'))),\n    'tlsport' =&gt; array_pop(explode(':', getenv('IMAP_PORT'))),\n  ),\n  'pop3' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; array_pop(explode(':', getenv('POPS_PORT'))),\n    'tlsport' =&gt; array_pop(explode(':', getenv('POP_PORT'))),\n  ),\n  'smtp' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; array_pop(explode(':', getenv('SMTPS_PORT'))),\n    'tlsport' =&gt; array_pop(explode(':', getenv('SUBMISSION_PORT'))),\n  ),\n  'activesync' =&gt; array(\n    'url' =&gt; 'https://'.$mailcow_hostname.($https_port == 443 ? '' : ':'.$https_port).'/Microsoft-Server-ActiveSync',\n  ),\n  'caldav' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; $https_port,\n  ),\n  'carddav' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; $https_port,\n  ),\n);\n</code></pre> <p>To always use IMAP and SMTP instead of EAS, set <code>'autodiscoverType' =&gt; 'imap'</code>.</p> <p>Disable ActiveSync for Outlook desktop clients by setting \"useEASforOutlook\" to \"no\".</p>","path":["U e autodiscover config.en"],"tags":[]},{"location":"de/manual-guides/u_e-reeanble-weak-protocols.de/","level":1,"title":"U e reeanble weak protocols.de","text":"<p>Am 12. Februar 2020 haben wir die veralteten Protokolle TLS 1.0 und 1.1 in Dovecot (POP3, POP3S, IMAP, IMAPS) und Postfix (SMTPS, SUBMISSION) deaktiviert.</p> <p>Mit dem Juni 2024 Patch (2024-06) wurde auch TLS 1.0 und TLS 1.1 für unauthentifizierte Mails über SMTP auf Port 25/tcp deaktiviert, da die meisten modernen und gut konfigurierten E-Mail-Server im Internet mittlerweile bessere Verschlüsselungen als TLS 1.0/1.1 nutzen.</p> <p>Wie kann man schwache Protokolle wieder aktivieren, falls erforderlich?</p> <p>Bearbeiten Sie <code>data/conf/postfix/extra.cf</code>:</p> <pre><code># Für SMTPS/Submission\nsubmission_smtpd_tls_mandatory_protocols = !SSLv2, !SSLv3\nsmtps_smtpd_tls_mandatory_protocols = !SSLv2, !SSLv3\n\n# Für SMTP (via STARTTLS)\nsmtp_tls_protocols = !SSLv2, !SSLv3\nsmtpd_tls_protocols = !SSLv2, !SSLv3\n</code></pre> <p>Bearbeiten Sie <code>data/conf/dovecot/extra.conf</code>:</p> <pre><code>ssl_min_protocol = TLSv1\n</code></pre> <p>Starten Sie die betroffenen Dienste neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow dovecot-mailcow\n</code></pre> <p>Tipp: Sie können TLS 1.2 in Windows 7 aktivieren.</p>","path":["U e reeanble weak protocols.de"],"tags":[]},{"location":"de/manual-guides/u_e-reeanble-weak-protocols.en/","level":1,"title":"U e reeanble weak protocols.en","text":"<p>On February 12th, 2020, we disabled the deprecated protocols TLS 1.0 and 1.1 in Dovecot (POP3, POP3S, IMAP, IMAPS) and Postfix (SMTPS, SUBMISSION).</p> <p>With the June 2024 Patch (2024-06), TLS 1.0 and TLS 1.1 were also disabled for unauthenticated mail via SMTP on port 25/tcp, as most modern and well-configured email servers on the internet now use better encryptions than TLS 1.0/1.1.</p> <p>How to re-enable weak protocols if necessary?</p> <p>Edit <code>data/conf/postfix/extra.cf</code>:</p> <pre><code># For SMTPS/Submission\nsubmission_smtpd_tls_mandatory_protocols = !SSLv2, !SSLv3\nsmtps_smtpd_tls_mandatory_protocols = !SSLv2, !SSLv3\n\n# For SMTP (via STARTTLS)\nsmtp_tls_protocols = !SSLv2, !SSLv3\nsmtpd_tls_protocols = !SSLv2, !SSLv3\n</code></pre> <p>Edit <code>data/conf/dovecot/extra.conf</code>:</p> <pre><code>ssl_min_protocol = TLSv1\n</code></pre> <p>Restart the affected services:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow dovecot-mailcow\n</code></pre> <p>Hint: You can enable TLS 1.2 in Windows 7.</p>","path":["U e reeanble weak protocols.en"],"tags":[]},{"location":"de/manual-guides/u_e-update-hooks.de/","level":1,"title":"U e update hooks.de","text":"<p>Es ist möglich, Pre- und Post-Update-Hooks zum <code>update.sh</code> Skript hinzuzufügen, das Ihre gesamte mailcow-Installation aktualisiert.</p> <p>Um dies zu tun, fügen Sie einfach das entsprechende Bash-Skript in Ihr mailcow-Root-Verzeichnis ein:  </p> <ul> <li><code>pre_update_hook.sh</code> für Befehle, die vor dem Update laufen sollen</li> <li><code>post_update_hook.sh</code> für Befehle, die nach dem Update ausgeführt werden sollen</li> </ul> <p>Beachten Sie, dass <code>pre_update_hook.sh</code> jedes Mal ausgeführt wird, wenn Sie <code>update.sh</code> aufrufen, und <code>post_update_hook.sh</code> wird nur ausgeführt, wenn die Aktualisierung erfolgreich war und das Skript nicht erneut ausgeführt werden muss.</p> <p>Die Skripte werden von der Bash ausgeführt, ein Interpreter (z.B. <code>#!/bin/bash</code>) sowie ein Execute Permission Flag (\"+x\") sind nicht erforderlich.</p>","path":["U e update hooks.de"],"tags":[]},{"location":"de/manual-guides/u_e-update-hooks.en/","level":1,"title":"U e update hooks.en","text":"<p>It is possible to add pre- and post-update-hooks to the <code>update.sh</code> script that upgrades your whole mailcow installation.</p> <p>To do so, just add the corresponding bash script into your mailcow root directory:  </p> <ul> <li><code>pre_update_hook.sh</code> for commands that should run before the update</li> <li><code>post_update_hook.sh</code> for commands that should run after the update is completed</li> </ul> <p>Keep in mind that <code>pre_update_hook.sh</code> runs every time you call <code>update.sh</code> and <code>post_update_hook.sh</code> will only run if the update was successful and the script doesn't have to be re-run.</p> <p>The scripts will be run by bash, an interpreter (e.g. <code>#!/bin/bash</code>) as well as an execute permission flag (\"+x\") are not required.</p>","path":["U e update hooks.en"],"tags":[]},{"location":"de/manual-guides/u_e-why_unbound.de/","level":1,"title":"U e why unbound.de","text":"<p>Für DNS-Blacklist-Lookups und DNSSEC.</p> <p>Die meisten Systeme verwenden entweder einen öffentlichen oder einen lokalen DNS-Auflöser mit Zwischenspeicher. Das ist eine sehr schlechte Idee, wenn es darum geht, Spam mit DNS-basierten Blackhole-Listen (DNSBL) oder ähnlichen Techniken zu filtern. Die meisten, wenn nicht alle Anbieter wenden eine Ratenbegrenzung an, die auf dem DNS-Resolver basiert, der für die Abfrage ihres Dienstes verwendet wird. Wenn Sie einen öffentlichen Resolver wie Google 4x8, OpenDNS oder einen anderen gemeinsam genutzten DNS-Resolver wie den Ihres Internetanbieters verwenden, werden Sie diese Grenze sehr bald erreichen.</p>","path":["U e why unbound.de"],"tags":[]},{"location":"de/manual-guides/u_e-why_unbound.en/","level":1,"title":"U e why unbound.en","text":"<p>For DNS blacklist lookups and DNSSEC.</p> <p>Most systems use either a public or a local caching DNS resolver. That's a very bad idea when it comes to filter spam using DNS-based black hole lists (DNSBL) or similar technics. Most if not all providers apply a rate limit based on the DNS resolver that is used to query their service. Using a public resolver like Googles 4x8, OpenDNS or any other shared DNS resolver like your ISPs will hit that limit very soon.</p>","path":["U e why unbound.en"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.de/","level":1,"title":"U e clamav additional dbs.de","text":"","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.de/#weitere-datenbanken-fur-clamav","level":2,"title":"Weitere Datenbanken für ClamAV","text":"<p>Die Standard ClamAV Datenbanken haben keine hohe Trefferquote, können aber durch kostenlose und kostenpflichtige Datenbanken erweitert werden.</p>","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.de/#liste-von-bekannten-kostenfreien-datenbanken-stand-april-2022","level":3,"title":"Liste von bekannten (kostenfreien) Datenbanken | Stand April 2022","text":"<ul> <li>SecurityInfo - kostenlose ClamAV DBs für Testzwecke. Registrierung der IP Adresse des Servers erforderlich (dann nutzbar für besagte IP).</li> <li>InterServer - kostenlose ClamAV DBs. Für E-Mail Zwecke eher ungeeignet.</li> </ul>","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.de/#securiteinfo-datenbank-aktivieren","level":3,"title":"SecuriteInfo Datenbank aktivieren","text":"","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.de/#arbeiten-im-clamav","level":4,"title":"Arbeiten im ClamAV","text":"<ol> <li>Kostenfreien Account auf https://www.securiteinfo.com/clients/customers/signup erstellen.</li> <li>Sie erhalten eine E-Mail um Ihren Account zu aktivieren gefolgt von einer E-Mail mit Ihrem Login Namen.</li> <li>Loggen Sie sich ein und navigieren Sie zu Ihrem Account https://www.securiteinfo.com/clients/customers/account</li> <li>Klicken Sie auf den 'Setup' Reiter.</li> <li>Sie brauchen <code>your_id</code> von den Downloadlinks. Diese sind pro User individuell.</li> <li> <p>Fügen Sie diese wie folgt in die <code>data/conf/clamav/freshclam.conf</code> ein und ersetzen Sie den <code>your_id</code> Teil mit Ihrer ID: <pre><code>DatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfo.hdb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfo.ign2\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/javascript.ndb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/spam_marketing.ndb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfohtml.hdb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfoascii.hdb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfopdf.hdb\n</code></pre></p> </li> <li> <p>Bei den kostenlosen SecuriteInfo Datenbanken ist die Download-Geschwindigkeit auf 300 kB/s begrenzt. Ändern Sie in <code>data/conf/clamav/freshclam.conf</code> den Standardwert <code>ReceiveTimeout 20</code> auf <code>ReceiveTimeout 90</code> (Zeitangabe in Sekunden), da ansonsten einige der Datenbank-Downloads aufgrund ihrer Größe abbrechen können.</p> </li> <li> <p>Passen Sie <code>data/conf/clamav/clamd.conf</code> mit den folgenden Einstellungen an: <pre><code>DetectPUA yes\nExcludePUA PUA.Win.Packer\nExcludePUA PUA.Win.Trojan.Packed\nExcludePUA PUA.Win.Trojan.Molebox\nExcludePUA PUA.Win.Packer.Upx\nExcludePUA PUA.Doc.Packed\nMaxScanSize 150M\nMaxFileSize 100M\nMaxRecursion 40\nMaxEmbeddedPE 100M\nMaxHTMLNormalize 50M\nMaxScriptNormalize 50M\nMaxZipTypeRcg 50M\n</code></pre></p> </li> <li>Starten Sie den ClamAV Container neu:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart clamd-mailcow\n</code></pre> <pre><code>docker-compose restart clamd-mailcow\n</code></pre> <p>Bitte beachten Sie:</p> <ul> <li>Sie können <code>ExcludePUA</code> und <code>IncludePUA</code> in der <code>clamd.conf</code> nicht gleichzeitig nutzen! Kommentieren Sie bitte <code>IncludePUA</code> aus, sollte es nicht auskommentiert sein.</li> <li>Die Liste der Datenbanken genutzt in diesem Beispiel sollten für die meisten Fälle passen. SecuriteInfo bietet jedoch noch andere Datenbanken an. Bitte schauen Sie sich das SecuriteInfo FAQ für weitere Informationen an.</li> <li>Mit den neu eingestellten Datenbanken (und den Standard Datenbanken) ClamAV verbraucht ClamAV etwa 1,3 GB RAM des Servers.</li> <li>Sollten Sie <code>message_size_limit</code> in Postfix verändert haben müssen Sie die <code>MaxSize</code> Einstellung in ClamAV auf den selben Wert eintragen.</li> </ul>","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.de/#arbeiten-im-rspamd","level":4,"title":"Arbeiten im Rspamd","text":"<p>Achtung</p> <p>mailcow mit der Version <code>&gt;= 2023-07</code> wird benötigt, damit die folgende Anleitung funktioniert, da sie die vordefinierten Scores für SecuriteInfo-Signaturen enthält!</p> <p>Nun haben Sie zwar die ClamAV-Signaturen hinzugefügt, werden aber feststellen, dass Rspamd diese nicht korrekt verwendet bzw. ALLES gnadenlos als VIRUS abstempelt.</p> <p>Wir können Rspamd aber mit ein wenig Handarbeit zähmen, so dass er nicht völlig aus dem Ruder läuft.</p> <p>Dazu gehen wir wie folgt vor:</p> <ol> <li>Fügen Sie innerhalb des bestehenden <code>clamav { ... }</code> block in <code>data/conf/rspamd/local.d/antivirus.conf</code>:</li> </ol> <pre><code>patterns {\n  # Extra Signatures (Securite) Not shipped with mailcow.\n  CLAM_SECI_SPAM = \"^SecuriteInfo\\.com\\.Spam.*\";\n  CLAM_SECI_JPG = \"^SecuriteInfo\\.com\\.JPG.*\";\n  CLAM_SECI_PDF = \"^SecuriteInfo\\.com\\.PDF.*\";\n  CLAM_SECI_HTML = \"^SecuriteInfo\\.com\\.HTML.*\";\n  CLAM_SECI_JS = \"^SecuriteInfo\\.com\\.JS.*\";\n}\n</code></pre> <ol> <li>Starten Sie den Rspamd neu:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Nun wird Rspamd die von uns angegebene Gewichtung für die einzelnen Signaturen anwenden, anstatt alles mit einem Wert von 2000 als VIRUS zu markieren und damit abzulehnen.</p> <p>Info</p> <p>Sie können die Gewichtungen jederzeit ändern:</p> <p><code>data/conf/rspamd/local.d/composites.conf</code></p> <p>Auch die zu registrierenden Strings des ClamAV können Sie manuell einstellen/anpassen.</p> <p>Nutzen Sie dazu einfach das gerade eben vorgegebene Schema in der <code>antivirus.conf</code> des Rspamd.</p> <p>Achtung</p> <p>Bitte beachten Sie, dass die Dateien <code>antivirus.conf</code> und <code>composites.conf</code> durch ein mailcow-Update überschrieben werden können.</p>","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.de/#interserver-datenbanken-aktivieren","level":3,"title":"InterServer Datenbanken aktivieren","text":"<ol> <li>Fügen Sie folgendes in <code>data/conf/clamav/freshclam.conf</code> ein: <pre><code>DatabaseCustomURL http://sigs.interserver.net/interserver256.hdb\nDatabaseCustomURL http://sigs.interserver.net/interservertopline.db\nDatabaseCustomURL http://sigs.interserver.net/shell.ldb\nDatabaseCustomURL http://sigs.interserver.net/whitelist.fp\n</code></pre></li> <li>Starten Sie den ClamAV Container neu:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart clamd-mailcow\n</code></pre> <pre><code>docker-compose restart clamd-mailcow\n</code></pre>","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.en/","level":1,"title":"U e clamav additional dbs.en","text":"","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.en/#additional-databases-for-clamav","level":2,"title":"Additional Databases for ClamAV","text":"<p>Default ClamAV databases do not have great detection levels, but it can be enhanced with free or paid signature databases.</p>","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.en/#list-of-known-free-databases-as-of-april-2022","level":3,"title":"List of known free databases | As of April 2022","text":"<ul> <li>SecurityInfo - free ClamAV DBs for testing purposes, required registration after which you can use them from 1 IP</li> <li>InterServer - free to use ClamAV DBs, but they do not fit well for email scanning</li> </ul>","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.en/#enable-securiteinfo-databases","level":3,"title":"Enable SecuriteInfo databases","text":"","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.en/#work-todo-in-clamav","level":4,"title":"Work todo in ClamAV","text":"<ol> <li>Sign up for a free account at https://www.securiteinfo.com/clients/customers/signup</li> <li>You will receive an email to activate your account and then a follow-up email with your login name</li> <li>Login and navigate to your customer account: https://www.securiteinfo.com/clients/customers/account</li> <li>Click on the Setup tab</li> <li>You will need to get <code>your_id</code> from one of the download links, they are individual for every user</li> <li> <p>Add to <code>data/conf/clamav/freshclam.conf</code> with replaced <code>your_id</code> part: <pre><code>DatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfo.hdb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfo.ign2\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/javascript.ndb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/spam_marketing.ndb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfohtml.hdb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfoascii.hdb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfopdf.hdb\n</code></pre></p> </li> <li> <p>For free SecuriteInfo databases, download speed is limited to 300 kB/s. In <code>data/conf/clamav/freshclam.conf</code>, increase the default <code>ReceiveTimeout 20</code> value to <code>ReceiveTimeout 90</code> (time in seconds), otherwise some of the database downloads could fail because of their size.</p> </li> <li> <p>Adjust <code>data/conf/clamav/clamd.conf</code> to align with next settings: <pre><code>DetectPUA yes\nExcludePUA PUA.Win.Packer\nExcludePUA PUA.Win.Trojan.Packed\nExcludePUA PUA.Win.Trojan.Molebox\nExcludePUA PUA.Win.Packer.Upx\nExcludePUA PUA.Doc.Packed\nMaxScanSize 150M\nMaxFileSize 100M\nMaxRecursion 40\nMaxEmbeddedPE 100M\nMaxHTMLNormalize 50M\nMaxScriptNormalize 50M\nMaxZipTypeRcg 50M\n</code></pre></p> </li> <li>Restart ClamAV container:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart clamd-mailcow\n</code></pre> <pre><code>docker-compose restart clamd-mailcow\n</code></pre> <p>Please note:</p> <ul> <li>You can't use <code>ExcludePUA</code> and <code>IncludePUA</code> in <code>clamd.conf</code> simultaneously, so please comment any <code>IncludePUA</code> if you uncommented them before.</li> <li>List of databases provided in this example fit most use-cases, but SecuriteInfo also provides other databases. Please check SecuriteInfo FAQ for additional information.</li> <li>With the current DB set (including default DBs) ClamAV will consume about 1.3Gb of RAM on your server.</li> <li>If you modified  <code>message_size_limit</code> in Postfix you need to adapt <code>MaxSize</code> settings in ClamAV as well.</li> </ul>","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.en/#work-todo-in-rspamd","level":4,"title":"Work todo in Rspamd","text":"<p>Danger</p> <p>mailcow with Version <code>&gt;= 2023-07</code> is needed for this following guide to work, as it includes the predefined scores for SecuriteInfo Signatures!</p> <p>Now you have added the ClamAV signatures, but you will notice that Rspamd does not use them correctly or mercilessly labels EVERYTHING as VIRUS.</p> <p>However, we can tame Rspamd with a little bit of manual work so that it doesn't get completely out of hand.</p> <p>For this we proceed as follows:</p> <ol> <li>Add the following inside the existing <code>clamav { ... }</code> block in <code>data/conf/rspamd/local.d/antivirus.conf</code>:</li> </ol> <pre><code>patterns {\n  # Extra Signatures (Securite) Not shipped with mailcow.\n  CLAM_SECI_SPAM = \"^SecuriteInfo\\.com\\.Spam.*\";\n  CLAM_SECI_JPG = \"^SecuriteInfo\\.com\\.JPG.*\";\n  CLAM_SECI_PDF = \"^SecuriteInfo\\.com\\.PDF.*\";\n  CLAM_SECI_HTML = \"^SecuriteInfo\\.com\\.HTML.*\";\n  CLAM_SECI_JS = \"^SecuriteInfo\\.com\\.JS.*\";\n}\n</code></pre> <ol> <li>Restart Rspamd afterwards:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Now Rspamd will apply the weighting we specified to each signature instead of marking everything with a value of 2000 as VIRUS and thus rejecting it.</p> <p>Info</p> <p>You can change the weights at any time:</p> <p><code>data/conf/rspamd/local.d/composites.conf</code>.</p> <p>You can also manually set/adjust the strings of the ClamAV to be registered.</p> <p>Just use the scheme given in the <code>antivirus.conf</code> of Rspamd.</p> <p>Warning</p> <p>Please note that the files <code>antivirus.conf</code> and <code>composites.conf</code> can be overwritten by a mailcow update.</p>","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-additional_dbs.en/#enable-interserver-databases","level":3,"title":"Enable InterServer databases","text":"<ol> <li>Add to <code>data/conf/clamav/freshclam.conf</code>: <pre><code>DatabaseCustomURL http://sigs.interserver.net/interserver256.hdb\nDatabaseCustomURL http://sigs.interserver.net/interservertopline.db\nDatabaseCustomURL http://sigs.interserver.net/shell.ldb\nDatabaseCustomURL http://sigs.interserver.net/whitelist.fp\n</code></pre></li> <li>Restart ClamAV container:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart clamd-mailcow\n</code></pre> <pre><code>docker-compose restart clamd-mailcow\n</code></pre>","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-whitelist.de/","level":1,"title":"U e clamav whitelist.de","text":"","path":["U e clamav whitelist.de"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-whitelist.de/#whitelist-fur-bestimmte-clamav-signaturen","level":2,"title":"Whitelist für bestimmte ClamAV-Signaturen","text":"<p>Es kann vorkommen, dass legitime (saubere) Mails von ClamAV blockiert werden (Rspamd markiert die Mail mit <code>VIRUS_FOUND</code>). So werden beispielsweise interaktive PDF-Formularanhänge standardmäßig blockiert, da der eingebettete Javascript-Code für schädliche Zwecke verwendet werden könnte. Überprüfen Sie dies anhand der clamd-Protokolle, z.B.:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs clamd-mailcow | grep \"FOUND\"\n</code></pre> <pre><code>docker-compose logs clamd-mailcow | grep \"FOUND\"\n</code></pre> <p>Diese Zeile bestätigt, dass ein solcher identifiziert wurde:</p> <pre><code>clamd-mailcow_1 | Sat Sep 28 07:43:24 2019 -&gt; instream(local): PUA.Pdf.Trojan.EmbeddedJavaScript-1(e887d2ac324ce90750768b86b63d0749:363325) FOUND\n</code></pre> <p>Um diese spezielle Signatur auf die Whitelist zu setzen (und den Versand dieses Dateityps im Anhang zu ermöglichen), fügen Sie sie der ClamAV-Signatur-Whitelist-Datei hinzu:</p> <pre><code>echo 'PUA.Pdf.Trojan.EmbeddedJavaScript-1' &gt;&gt; data/conf/clamav/whitelist.ign2\n</code></pre> <p>Dann starten Sie den clamd-mailcow Service Container in der mailcow UI oder mit docker compose neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart clamd-mailcow\n</code></pre> <pre><code>docker-compose restart clamd-mailcow\n</code></pre> <p>Bereinigen Sie zwischengespeicherte ClamAV-Ergebnisse in Redis:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow /bin/sh\n/data # redis-cli KEYS rs_cl* | xargs redis-cli DEL\n/data # exit\n</code></pre> <pre><code>docker-compose exec redis-mailcow /bin/sh\n/data # redis-cli KEYS rs_cl* | xargs redis-cli DEL\n/data # exit\n</code></pre>","path":["U e clamav whitelist.de"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-whitelist.en/","level":1,"title":"U e clamav whitelist.en","text":"","path":["U e clamav whitelist.en"],"tags":[]},{"location":"de/manual-guides/ClamAV/u_e-clamav-whitelist.en/#whitelist-specific-clamav-signatures","level":2,"title":"Whitelist specific ClamAV signatures","text":"<p>You may find that legitimate (clean) mail is being blocked by ClamAV (Rspamd will flag the mail with <code>VIRUS_FOUND</code>). For instance, interactive PDF form attachments are blocked by default because the embedded Javascript code may be used for nefarious purposes. Confirm by looking at the clamd logs, e.g.:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs clamd-mailcow | grep \"FOUND\"\n</code></pre> <pre><code>docker-compose logs clamd-mailcow | grep \"FOUND\"\n</code></pre> <p>This line confirms that such was identified:</p> <pre><code>clamd-mailcow_1      | Sat Sep 28 07:43:24 2019 -&gt; instream(local): PUA.Pdf.Trojan.EmbeddedJavaScript-1(e887d2ac324ce90750768b86b63d0749:363325) FOUND\n</code></pre> <p>To whitelist this particular signature (and enable sending this type of file attached), add it to the ClamAV signature whitelist file:</p> <pre><code>echo 'PUA.Pdf.Trojan.EmbeddedJavaScript-1' &gt;&gt; data/conf/clamav/whitelist.ign2\n</code></pre> <p>Then restart the clamd-mailcow service container in the mailcow UI or using docker compose:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart clamd-mailcow\n</code></pre> <pre><code>docker-compose restart clamd-mailcow\n</code></pre> <p>Cleanup cached ClamAV results in Redis:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow /bin/sh\n/data # redis-cli KEYS rs_cl* | xargs redis-cli DEL\n/data # exit\n</code></pre> <pre><code>docker-compose exec redis-mailcow /bin/sh\n/data # redis-cli KEYS rs_cl* | xargs redis-cli DEL\n/data # exit\n</code></pre>","path":["U e clamav whitelist.en"],"tags":[]},{"location":"de/manual-guides/Docker/u_e-docker-cust_dockerfiles.de/","level":1,"title":"U e docker cust dockerfiles.de","text":"<p>Sie müssen die Override-Datei mit den entsprechenden Build-Tags in den mailcow: dockerized Root-Ordner (d.h. <code>/opt/mailcow-dockerized</code>) kopieren: <pre><code>cp helper-scripts/docker-compose.override.yml.d/BUILD_FLAGS/docker-compose.override.yml docker-compose.override.yml\n</code></pre></p> <p>Nehmen Sie Ihre Änderungen in <code>data/Dockerfiles/$service</code> vor und erstellen Sie das Image lokal: <pre><code>docker build data/Dockerfiles/$service -t mailcow/$service:$tag\n</code></pre> (Ohne persönlichen :$tag wird automatisch :latest verwendet.)</p> <p>Nun muss dieser gerade erstellte Container in docker-compose.override.yml aktiviert werden, z.B.: <pre><code>$service-mailcow:\n    build: ./data/Dockerfiles/$service\n    image: mailcow/$service:$tag\n</code></pre></p> <p>Abschliessend müssen die geänderten Container automatisch neu erstellt werden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e docker cust dockerfiles.de"],"tags":[]},{"location":"de/manual-guides/Docker/u_e-docker-cust_dockerfiles.en/","level":1,"title":"U e docker cust dockerfiles.en","text":"<p>You need to copy the override file with corresponding build tags to the mailcow: dockerized root folder (i.e. <code>/opt/mailcow-dockerized</code>):</p> <pre><code>cp helper-scripts/docker-compose.override.yml.d/BUILD_FLAGS/docker-compose.override.yml docker-compose.override.yml\n</code></pre> <p>Customize <code>data/Dockerfiles/$service</code> and build the image locally: <pre><code>docker build data/Dockerfiles/$service -t mailcow/$service:$tag\n</code></pre> (without a personalized :$tag docker will use :latest automatically)</p> <p>Now the created image has to be activated in docker-compose.override.yml, e.g.: <pre><code>$service-mailcow:\n    build: ./data/Dockerfiles/$service\n    image: mailcow/$service:$tag\n</code></pre></p> <p>Now auto-recreate modified containers:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e docker cust dockerfiles.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-any_acl.de/","level":1,"title":"U e dovecot any acl.de","text":"<p>Am 17. August haben wir die Möglichkeit, mit \"jedem\" oder \"allen authentifizierten Benutzern\" zu teilen, standardmäßig deaktiviert.</p> <p>Diese Funktion kann wieder aktiviert werden, indem <code>ACL_ANYONE</code> auf <code>allow</code> in mailcow.conf gesetzt wird:</p> <pre><code>ACL_ANYONE=allow\n</code></pre> <p>Wenden Sie die Änderungen an, indem Sie den Docker Stack neustarten mit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e dovecot any acl.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-any_acl.en/","level":1,"title":"U e dovecot any acl.en","text":"<p>On August the 17th, we disabled the possibility to share with \"any\" or \"all authenticated users\" by default.</p> <p>This function can be re-enabled by setting <code>ACL_ANYONE</code> to <code>allow</code> in mailcow.conf:</p> <pre><code>ACL_ANYONE=allow\n</code></pre> <p>Apply the changes by restarting the stack:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e dovecot any acl.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-catchall_vacation.de/","level":1,"title":"U e dovecot catchall vacation.de","text":"<p>Der Dovecot-Parameter <code>sieve_vacation_dont_check_recipient</code> - der in mailcow-Konfigurationen vor dem 21. Juli 2021 standardmäßig auf <code>yes</code> gesetzt war - erlaubt Urlaubsantworten auch dann, wenn eine Mail an nicht existierende Mailboxen wie Catch-All-Adressen gesendet wird.</p> <p>Wir haben uns entschlossen, diesen Parameter wieder auf <code>no</code> zu setzen und dem Benutzer zu erlauben, die Empfängeradresse zu spezifizieren, die eine Urlaubsantwort auslöst. Die auslösenden Empfänger können auch in SOGos Autoresponder-Funktion konfiguriert werden.</p>","path":["U e dovecot catchall vacation.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-catchall_vacation.en/","level":1,"title":"U e dovecot catchall vacation.en","text":"<p>The Dovecot parameter <code>sieve_vacation_dont_check_recipient</code> - which was by default set to <code>yes</code> in mailcow configurations pre 21st July 2021 - allows for vacation replies even when a mail is sent to non-existent mailboxes like a catch-all addresses.</p> <p>We decided to switch this parameter back to <code>no</code> and allow a user to specify which recipient address triggers a vacation reply. The triggering recipients can also be configured in SOGos autoresponder feature.</p>","path":["U e dovecot catchall vacation.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-expunge.de/","level":1,"title":"U e dovecot expunge.de","text":"<p>Wenn Sie alte Mails aus den Ordnern <code>.Junk</code> oder <code>.Trash</code> löschen wollen oder vielleicht alle gelesenen Mails, die älter als eine bestimmte Zeitspanne sind, können Sie das dovecot-Tool doveadm man doveadm-expunge verwenden.</p>","path":["U e dovecot expunge.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-expunge.de/#der-manuelle-weg","level":2,"title":"Der manuelle Weg","text":"<p>Dann wollen wir mal loslegen:</p> <p>Löschen Sie die Mails eines Benutzers im Junk-Ordner, die gelesen und älter als 4 Stunden sind</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'Junk' SEEN not SINCE 4h\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'Junk' SEEN not SINCE 4h\n</code></pre> <p>Lösche alle Mails des Benutzers im Junk-Ordner, die älter als 7 Tage sind</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 7d\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 7d\n</code></pre> <p>Löscht alle Mails (aller Benutzer) in allen Ordnern, die älter als 52 Wochen sind (internes Datum der Mail, nicht das Datum, an dem sie auf dem System gespeichert wurde =&gt; <code>before</code> statt <code>savedbefore</code>). Nützlich zum Löschen sehr alter Mails in allen Benutzern und Ordnern (daher besonders nützlich für GDPR-Compliance).</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -A mailbox % before 52w\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -A mailbox % before 52w\n</code></pre> <p>Löschen von Mails in einem benutzerdefinierten Ordner innerhalb des Posteingangs eines Benutzers, die nicht gekennzeichnet und älter als 2 Wochen sind</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'INBOX/custom-folder' not FLAGGED not SINCE 2w\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'INBOX/custom-folder' not FLAGGED not SINCE 2w\n</code></pre> <p>Info</p> <p>Für mögliche Zeitspannen oder SearchQuery schauen Sie bitte in man doveadm-search-query</p>","path":["U e dovecot expunge.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-expunge.de/#job-scheduler","level":2,"title":"Job-Scheduler","text":"","path":["U e dovecot expunge.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-expunge.de/#uber-das-host-system-cron","level":3,"title":"über das Host-System cron","text":"<p>Wenn Sie eine solche Aufgabe automatisieren wollen, können Sie einen Cron-Job auf Ihrem Rechner erstellen, der ein Skript wie das folgende aufruft:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>#!/bin/bash\n# Pfad zu mailcow-dockerized, z.B. /opt/mailcow-dockerized\ncd /pfad/zu/ihrer/mailcow-dockerized\n\ndocker compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 2w\ndocker compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' SEEN not SINCE 12h\n[...]\n</code></pre> <pre><code>#!/bin/bash\n# Pfad zu mailcow-dockerized, z.B. /opt/mailcow-dockerized\ncd /pfad/zu/ihrer/mailcow-dockerized\n\ndocker-compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 2w\ndocker-compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' SEEN not SINCE 12h\n[...]\n</code></pre> <p>Um einen Cronjob zu erstellen, können Sie <code>crontab -e</code> ausführen und etwas wie das Folgende einfügen, um ein Skript auszuführen:</p> <pre><code># Jeden Tag um 04:00 Uhr morgens ausführen.\n0 4 * * * /pfad/zu/ihr/expunge_mailboxes.sh\n</code></pre>","path":["U e dovecot expunge.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-expunge.de/#uber-docker-job-scheduler","level":3,"title":"über Docker Job Scheduler","text":"<p>Um dies mit einem Docker-Job-Scheduler zu archivieren, verwenden Sie diese docker-compose.override.yml mit Ihrer mailcow: </p> <pre><code>services:\n\n  dovecot-mailcow:\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.dovecot-expunge-trash.schedule: \"0 0 4 * * *\"\n      ofelia.job-exec.dovecot-expunge-trash.command: \"doveadm expunge -A mailbox 'Junk' savedbefore 2w\"\n      ofelia.job-exec.dovecot-expunge-trash.tty: \"false\"\n</code></pre> <p>Wir fügen unserem Dovecot-Container ein paar Labels hinzu, um den Job-Scheduler zu aktivieren und ihm in einem Cron-kompatiblen Scheduling-Format mitzuteilen, wann er laufen soll. Hinweis: Ofelia verwendet das Scheduling-Format der Cron-Implementierung von Go, die mit einem Eintrag für Sekunden statt für Minuten beginnt.</p> <p>Diese docker-compose.override.yml löscht jeden Tag um 4 Uhr morgens alle Mails, die älter als 2 Wochen sind, aus dem Ordner \"Junk\". Um zu sehen, ob alles richtig gelaufen ist, können Sie nicht nur in Ihrer Mailbox nachsehen, sondern auch im Docker-Log von Ofelia, ob es etwa so aussieht:</p> <pre><code>common.go:124 ▶ NOTICE [Job \"dovecot-expunge-trash\" (8759567efa66)] Started - doveadm expunge -A mailbox 'Junk' savedbefore 2w,\ncommon.go:124 ▶ NOTICE [Job \"dovecot-expunge-trash\" (8759567efa66)] Finished in \"285.032291ms\", failed: false, skipped: false, error: none,\n</code></pre> <p>Wenn der Vorgang fehlgeschlagen ist, wird dies angegeben und die Ausgabe von doveadm im Protokoll aufgeführt, um Ihnen die Fehlersuche zu erleichtern.</p> <p>Falls Sie weitere Jobs hinzufügen wollen, stellen Sie sicher, dass Sie den \"dovecot-expunge-trash\"-Teil nach \"ofelia.job-exec.\" in etwas anderes ändern, er definiert den Namen des Jobs. Die Syntax der Labels finden Sie unter mcuadros/ofelia.</p>","path":["U e dovecot expunge.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-expunge.en/","level":1,"title":"U e dovecot expunge.en","text":"<p>If you want to delete old mails out of the <code>.Junk</code> or <code>.Trash</code> folders or maybe delete all read mails that are older than a certain amount of time you may use dovecot's tool doveadm man doveadm-expunge.</p>","path":["U e dovecot expunge.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-expunge.en/#the-manual-way","level":2,"title":"The manual way","text":"<p>That said, let's dive in:</p> <p>Delete a user's mails inside the junk folder that are read and older than 4 hours</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'Junk' SEEN not SINCE 4h\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'Junk' SEEN not SINCE 4h\n</code></pre> <p>Delete all user's mails in the junk folder that are older than 7 days</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 7d\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 7d\n</code></pre> <p>Delete all mails (of all users) in all folders that are older than 52 weeks (internal date of the mail, not the date it was saved on the system =&gt; <code>before</code> instead of <code>savedbefore</code>). Useful for deleting very old mails on all users and folders (thus especially useful for GDPR-compliance).</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -A mailbox % before 52w\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -A mailbox % before 52w\n</code></pre> <p>Delete mails inside a custom folder inside a user's inbox that are not flagged and older than 2 weeks</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'INBOX/custom-folder' not FLAGGED not SINCE 2w\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'INBOX/custom-folder' not FLAGGED not SINCE 2w\n</code></pre> <p>Info</p> <p>For possible time spans or search keys have a look at man doveadm-search-query</p>","path":["U e dovecot expunge.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-expunge.en/#job-scheduler","level":2,"title":"Job scheduler","text":"","path":["U e dovecot expunge.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-expunge.en/#via-the-host-system-cron","level":3,"title":"via the host system cron","text":"<p>If you want to automate such a task you can create a cron job on your host that calls a script like the one below:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>#!/bin/bash\n# Path to mailcow-dockerized, for example: /opt/mailcow-dockerized\ncd /path/to/your/mailcow-dockerized\n\ndocker compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 2w\ndocker compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' SEEN not SINCE 12h\n[...]\n</code></pre> <pre><code>#!/bin/bash\n# Path to mailcow-dockerized, for example: /opt/mailcow-dockerized\ncd /path/to/your/mailcow-dockerized\n\ndocker-compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 2w\ndocker-compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' SEEN not SINCE 12h\n[...]\n</code></pre> <p>To create a cron job you may execute <code>crontab -e</code> and insert something like the following to execute a script:</p> <pre><code># Execute everyday at 04:00 A.M.\n0 4 * * * /path/to/your/expunge_mailboxes.sh\n</code></pre>","path":["U e dovecot expunge.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-expunge.en/#via-docker-job-scheduler","level":3,"title":"via Docker job scheduler","text":"<p>To achieve this with a docker job scheduler use this docker-compose.override.yml with your mailcow: </p> <pre><code>services:\n\n  dovecot-mailcow:\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.dovecot-expunge-trash.schedule: \"0 0 4 * * *\"\n      ofelia.job-exec.dovecot-expunge-trash.command: \"doveadm expunge -A mailbox 'Junk' savedbefore 2w\"\n      ofelia.job-exec.dovecot-expunge-trash.tty: \"false\"\n</code></pre> <p>We add a few label to our dovecot-container to activate the job scheduler and tell him in a cron compatible scheduling format when to run. Note: Ofelia uses the scheduling format of the Go cron implementation which starts with a field for seconds instead of minutes.</p> <p>This docker-compose.override.yml deletes all mails older then 2 weeks from the \"Junk\" folder every day at 4 am. To see if things ran proper, you can not only see in your mailbox but also check Ofelia's docker log if it looks something like this:</p> <pre><code>common.go:124 ▶ NOTICE [Job \"dovecot-expunge-trash\" (8759567efa66)] Started - doveadm expunge -A mailbox 'Junk' savedbefore 2w,\ncommon.go:124 ▶ NOTICE [Job \"dovecot-expunge-trash\" (8759567efa66)] Finished in \"285.032291ms\", failed: false, skipped: false, error: none,\n</code></pre> <p>If it failed it will say so and give you the output of the doveadm in the log to make it easy on you to debug.</p> <p>In case you want to add more jobs, ensure you change the \"dovecot-expunge-trash\" part after \"ofelia.job-exec.\" to something else, it defines the name of the job. Syntax of the labels you find at mcuadros/ofelia.</p>","path":["U e dovecot expunge.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-extra_conf.de/","level":1,"title":"U e dovecot extra conf.de","text":"<p>Erstellen Sie eine Datei <code>data/conf/dovecot/extra.conf</code> - falls nicht vorhanden - und fügen Sie Ihren zusätzlichen Inhalt hier ein.</p> <p>Starten Sie <code>dovecot-mailcow</code> neu, um Ihre Änderungen zu übernehmen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart dovecot-mailcow\n</code></pre>","path":["U e dovecot extra conf.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-extra_conf.en/","level":1,"title":"U e dovecot extra conf.en","text":"<p>Create a file <code>data/conf/dovecot/extra.conf</code> - if missing - and add your additional content here.</p> <p>Restart <code>dovecot-mailcow</code> to apply your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart dovecot-mailcow\n</code></pre>","path":["U e dovecot extra conf.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.de/","level":1,"title":"U e dovecot fts.de","text":"<p>Neue Volltextsuche-Engine</p> <p>Mit dem Januar 2025 Update wurde Solr durch Flatcurve ersetzt. Alle bestehenden FTS-Indizes sind daher obsolet und können entfernt werden.</p> <p>mailcow verweist auf das alte solr-vol-1 und fragt bei jedem Update-Vorgang, ob es entfernt werden soll, falls es noch existiert.</p> <p>Flatcurve ist die neue Volltextsuche, die auch auf leistungsschwächeren Systemen besser funktioniert und langfristig auch zum Standard von Dovecot selbst wird.</p> <p>Anders als bei Solr ist für Flatcurve kein weiteres Docker-Volume notwendig. Flatcurve speichert seine FTS-Datenbanken im <code>vmail-index</code>-Volume und erzeugt eine ähnliche Ordnerstruktur wie:</p> <pre><code>/var/vmail_index/tester@develcow.de/.INBOX/\n├── dovecot.index\n├── dovecot.index.cache\n├── dovecot.index.log\n└── fts-flatcurve\n    └── index.814\n        ├── flintlock\n        ├── iamglass\n        ├── postlist.glass\n        └── termlist.glass\n</code></pre> <p>Jeder Unterordner im IMAP-Server erhält entsprechend einen eigenen <code>fts-flatcurve</code>-Ordner mit den jeweiligen Indizes der Mails des Ordners.</p> <p>Wichtig</p> <p>Sollten Sie bisher Solr verwendet haben, ist eine komplette Reindexierung erforderlich, da die beiden FTS-Engines nicht miteinander kompatibel sind.</p> <p>Eine automatische Indexierung des Postfachs wird aktiviert, sobald 20 oder mehr E-Mails eingehen oder eine Volltextsuche durchgeführt wird.</p> <p>Wir empfehlen, eine manuelle Reindexierung nur unter Aufsicht durchzuführen, da trotz niedriger Systemanforderungen eine übermäßige Systemauslastung nicht ausgeschlossen werden kann.</p> <p>Weiter unten erfahren Sie, wie Sie eine Reindexierung anstoßen können.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.de/#fts-bezogene-dovecot-befehle","level":2,"title":"FTS-bezogene Dovecot-Befehle","text":"","path":["U e dovecot fts.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.de/#fts-datenbank-auf-fehler-uberprufen-und-ggf-reparieren","level":3,"title":"FTS-Datenbank auf Fehler überprüfen und ggf. reparieren","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code># Einzelbenutzer\ndocker compose exec dovecot-mailcow doveadm fts rescan -u user@domain\n# Alle Benutzer\ndocker compose exec dovecot-mailcow doveadm fts rescan -A\n</code></pre> <pre><code># Einzelbenutzer\ndocker-compose exec dovecot-mailcow doveadm fts rescan -u user@domain\n# Alle Benutzer\ndocker-compose exec dovecot-mailcow doveadm fts rescan -A\n</code></pre> <p>Dovecot-Wiki: \"Scannt, welche Mails im Volltextsuchindex vorhanden sind, und vergleicht diese mit den tatsächlich in den Postfächern vorhandenen Mails. Dies entfernt Mails aus dem Index, die bereits gelöscht wurden, und stellt sicher, dass der nächste doveadm-Index alle fehlenden Mails (falls vorhanden) indiziert.\"</p> <p>Dies indiziert nicht eine Mailbox neu, sondern repariert lediglich einen vorhandenen Index.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.de/#fts-datenbank-neu-indizieren-reindex","level":3,"title":"FTS-Datenbank neu indizieren (Reindex)","text":"<p>Wenn Sie die Daten sofort neu indizieren möchten, können Sie den folgenden Befehl ausführen, wobei <code>*</code> auch eine Postfachmaske wie 'Sent' sein kann. Diese Befehle sind optional, können jedoch den Prozess beschleunigen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code># Einzelner Benutzer\ndocker compose exec dovecot-mailcow doveadm index -u user@domain '*'\n# Alle Benutzer, langsamer und risikoreicher\ndocker compose exec dovecot-mailcow doveadm index -A '*'\n</code></pre> <pre><code># Einzelner Benutzer\ndocker-compose exec dovecot-mailcow doveadm index -u user@domain '*'\n# Alle Benutzer, langsamer und risikoreicher\ndocker-compose exec dovecot-mailcow doveadm index -A '*'\n</code></pre> <p>Hinweis</p> <p>Die Indizierung wird einige Zeit in Anspruch nehmen.</p> <p>Es besteht die Möglichkeit einer übermäßigen Systemauslastung, bis hin zu Systemabstürzen in seltenen Fällen. Beobachten Sie daher den Indizierungsprozess und Ihre Systemauslastung aufmerksam!</p> <p>Da die Neuindizierung ressourcenintensiv sein kann, wurde sie nicht in die mailcow-UI integriert. </p> <p>Fehler beim Re-Indizieren müssen manuell über die CLI behoben werden.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.de/#fts-datenbank-loschen","level":3,"title":"FTS-Datenbank löschen","text":"<p>mailcow entfernt die Indexdaten eines Benutzers automatisch, wenn das entsprechende Postfach gelöscht wird.</p> <p>Alternativ können Sie den Index für Flatcurve manuell über die CLI entfernen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code># Einzelner Benutzer\ndocker compose exec dovecot-mailcow doveadm fts-flatcurve remove -u user@domain '*'\n# Alle Benutzer\ndocker compose exec dovecot-mailcow doveadm fts-flatcurve remove -A '*'\n</code></pre> <pre><code># Einzelner Benutzer\ndocker-compose exec dovecot-mailcow doveadm fts-flatcurve remove -u user@domain '*'\n# Alle Benutzer\ndocker-compose exec dovecot-mailcow doveadm fts-flatcurve remove -A '*'\n</code></pre>","path":["U e dovecot fts.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.de/#fts-spezifische-optionen-in-mailcowconf","level":2,"title":"FTS-spezifische Optionen in mailcow.conf","text":"<p>mailcow liefert standardmäßig niedrige Parameter für die neue FTS-Engine, um sie auch auf schwächeren Systemen nutzbar zu machen.</p> <p>Für leistungsstärkere Systeme können Sie einige Parameter anpassen, um eine effizientere Indexierung zu ermöglichen.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.de/#skip_fts-volltextsuche-deaktivieren","level":3,"title":"<code>SKIP_FTS</code> (Volltextsuche deaktivieren)","text":"<p>In der mailcow.conf können Sie die Volltextsuche komplett deaktivieren. Dies ist vor allem auf Low-End-Systemen zu empfehlen, welche Probleme haben mailcow sowie die Indexierung flüssig laufen zu lassen.</p> <p>Flatcurve ist ressourcenschonender als Solr, benötigt jedoch mehr Speicherplatz und gegebenenfalls mehr CPU-Leistung (abhängig vom Setup).</p> <p>mailcow-Standard</p> <p>Standardmäßig ist dieser Parameter auf n gesetzt, wodurch die Volltextsuche aktiviert ist.</p> Best Practice <p>Lassen Sie die Indexierung zunächst aktiviert. Sollte die neue FTS-Engine zu viele Ressourcen beanspruchen, können Sie die Einstellung später anpassen.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.de/#fts_procs-anzahl-der-indexierungsprozesse","level":3,"title":"<code>FTS_PROCS</code> (Anzahl der Indexierungsprozesse)","text":"<p>Mit der Variablen <code>FTS_PROCS</code> in der mailcow.conf können Sie die Anzahl der Indexierungsprozesse anpassen, die gleichzeitig arbeiten.</p> <p>mailcow-Standard</p> <p>Standardmäßig ist dieser Wert auf 1 Thread limitiert.</p> <p>ACHTUNG</p> <p>Die Indexierungsprozesse verwenden jeweils einen CPU-Thread vollständig. Systeme mit wenigen Kernen sollten eine niedrige Anzahl einstellen, um die restliche Systemleistung nicht zu beeinträchtigen.</p> Best Practice <p>Planen Sie etwa die Hälfte der CPU-Threads Ihres Systems für die Indexierungsprozesse ein. Bei ungerader Kernzahl verwenden Sie die niedrigere Anzahl an Threads, um genügend Ressourcen für das Hauptsystem zu lassen.</p> <p>Dual-Core- oder Single-Core-Systeme sollten die Volltextsuche deaktivieren.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.de/#fts_heap-max-arbeitsspeicher-pro-indexierungsprozess","level":3,"title":"<code>FTS_HEAP</code> (Max. Arbeitsspeicher pro Indexierungsprozess)","text":"<p>Mit <code>FTS_HEAP</code> in der mailcow.conf legen Sie den Arbeitsspeicher pro Indexierungsprozess fest.</p> <p>mailcow-Standard</p> <p>Standardmäßig ist dieser Wert auf 128 MB pro Prozess limitiert.</p> Best Practice <p>Weisen Sie jedem Prozess idealerweise 512 MB Arbeitsspeicher zu. Systeme mit weniger als 8 GB RAM sollten bei 128 MB bleiben oder höchstens auf 256 MB erhöhen.</p> <p>Bei ausgeschöpftem RAM kann Dovecot zwar weiterarbeiten, wird jedoch langsamer.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.de/#erweiterte-konfigurationsmoglichkeiten","level":2,"title":"Erweiterte Konfigurationsmöglichkeiten","text":"<p>Die Integration von Flatcurve erlaubt es, FTS-Optionen individuell anzupassen.</p> <p>Hinweis</p> <p>Jedes Setup ist anders, daher gibt es kein allgemeingültiges Optimum.</p> <p>Die Erfahrung mit der Engine variiert je nach System.</p> <p>Beispielsweise können Sie eine detailliertere Volltextsuche (Substring Search) aktivieren, die genauere Ergebnisse liefert, aber auch mehr Speicherplatz und Zeit erfordert.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.de/#substring-search-aktivieren-detailiertere-volltextsuche","level":3,"title":"Substring Search aktivieren (Detailiertere Volltextsuche)","text":"<p>Bearbeiten Sie die Datei <code>data/conf/dovecot/conf.d/fts.conf</code>:</p> <pre><code>plugin {\n    [...]\n\n    fts_flatcurve_substring_search=yes # Kann entweder yes oder no sein\n}\n</code></pre> <p>Ein Neustart von Dovecot aktiviert die Änderungen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart dovecot-mailcow\n</code></pre>","path":["U e dovecot fts.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.de/#weitere-tweaks","level":3,"title":"Weitere Tweaks","text":"<p>Wir nehmen gerne von der Community vorgeschlagene Tweaks auf.</p> <p>In der Zwischenzeit können Sie sich die offiziellen Dokumentationen zu Dovecot und Flatcurve ansehen:</p> <ul> <li>Dovecot FTS Modul Dokumentation</li> <li>Flatcurve FTS Engine Dokumentation</li> </ul>","path":["U e dovecot fts.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.en/","level":1,"title":"U e dovecot fts.en","text":"<p>New Full-Text Search Engine</p> <p>As of January 2025, Solr has been replaced by Flatcurve. All existing FTS indices are therefore obsolete and can be removed.</p> <p>mailcow references the old solr-vol-1 and prompts during every update process to remove it if it still exists.</p> <p>Flatcurve is the new full-text search engine that works better even on less powerful systems. Additionally, it is expected to become the default full-text search engine for Dovecot in the long term.</p> <p>Unlike Solr, Flatcurve does not require an additional Docker volume. Flatcurve stores its FTS databases in the <code>vmail-index</code> volume, resulting in a similar folder structure as:</p> <pre><code>/var/vmail_index/tester@develcow.de/.INBOX/\n├── dovecot.index\n├── dovecot.index.cache\n├── dovecot.index.log\n└── fts-flatcurve\n    └── index.814\n        ├── flintlock\n        ├── iamglass\n        ├── postlist.glass\n        └── termlist.glass\n</code></pre> <p>Each subfolder in the IMAP server thus receives its own <code>fts-flatcurve</code> folder with the respective indices of the folder's emails.</p> <p>Important</p> <p>If you have been using Solr, a complete reindexing is required, as the two FTS engines are not compatible with each other.</p> <p>An automatic indexing of the mailbox is activated as soon as 20 or more emails are received or a full-text search is performed.</p> <p>We recommend performing a manual reindexing only under supervision, as excessive system load cannot be ruled out despite low system requirements.</p> <p>Learn more about how to trigger a reindexing further down.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.en/#fts-related-dovecot-commands","level":2,"title":"FTS-Related Dovecot Commands","text":"","path":["U e dovecot fts.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.en/#check-and-repair-fts-database-for-errors","level":3,"title":"Check and Repair FTS Database for Errors","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code># Single user\ndocker compose exec dovecot-mailcow doveadm fts rescan -u user@domain\n# All users\ndocker compose exec dovecot-mailcow doveadm fts rescan -A\n</code></pre> <pre><code># Single user\ndocker-compose exec dovecot-mailcow doveadm fts rescan -u user@domain\n# All users\ndocker-compose exec dovecot-mailcow doveadm fts rescan -A\n</code></pre> <p>Dovecot Wiki: \"Scans which emails are present in the full-text search index and compares them with the emails actually present in the mailboxes. This removes emails from the index that have already been deleted and ensures that the next doveadm index indexes all missing emails (if any).\"</p> <p>This does not reindex a mailbox but merely repairs an existing index.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.en/#reindex-fts-database","level":3,"title":"Reindex FTS Database","text":"<p>If you want to reindex the data immediately, you can use the following command, where <code>*</code> can also be a mailbox mask such as 'Sent'. These commands are optional but can speed up the process:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code># Single user\ndocker compose exec dovecot-mailcow doveadm index -u user@domain '*'\n# All users, slower and riskier\ndocker compose exec dovecot-mailcow doveadm index -A '*'\n</code></pre> <pre><code># Single user\ndocker-compose exec dovecot-mailcow doveadm index -u user@domain '*'\n# All users, slower and riskier\ndocker-compose exec dovecot-mailcow doveadm index -A '*'\n</code></pre> <p>Note</p> <p>Indexing will take some time.</p> <p>Excessive system load, up to and including system crashes in rare cases, is possible. Monitor the indexing process and your system load closely!</p> <p>Since reindexing can be resource-intensive, it has not been integrated into the mailcow UI.</p> <p>You must manually address any errors during reindexing via the CLI.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.en/#delete-fts-database","level":3,"title":"Delete FTS Database","text":"<p>mailcow automatically deletes a user's index data when the corresponding mailbox is deleted.</p> <p>Alternatively, you can manually remove the index for Flatcurve via CLI:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code># Single user\ndocker compose exec dovecot-mailcow doveadm fts-flatcurve remove -u user@domain '*'\n# All users\ndocker compose exec dovecot-mailcow doveadm fts-flatcurve remove -A '*'\n</code></pre> <pre><code># Single user\ndocker-compose exec dovecot-mailcow doveadm fts-flatcurve remove -u user@domain '*'\n# All users\ndocker-compose exec dovecot-mailcow doveadm fts-flatcurve remove -A '*'\n</code></pre>","path":["U e dovecot fts.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.en/#fts-specific-options-in-mailcowconf","level":2,"title":"FTS-Specific Options in mailcow.conf","text":"<p>mailcow provides low default settings for the new FTS engine to ensure functionality even on less powerful systems.</p> <p>For more powerful systems, you can adjust some parameters to enable more efficient indexing.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.en/#skip_fts-disable-full-text-search","level":3,"title":"<code>SKIP_FTS</code> (Disable Full-Text Search)","text":"<p>In mailcow.conf, you can completely disable full-text search. This is still recommended for low-end systems which are struggeling to run mailcow and the indexing process(es) at the same time.</p> <p>Flatcurve is less resource-intensive than Solr but requires more storage and possibly more CPU power (depending on the setup).</p> <p>mailcow Default</p> <p>By default, this parameter is set to n, meaning full-text search is enabled.</p> Best Practice <p>Initially, leave the indexing enabled. If the new FTS engine uses too many resources, you can change the setting later.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.en/#fts_procs-number-of-indexing-processes","level":3,"title":"<code>FTS_PROCS</code> (Number of Indexing Processes)","text":"<p>With the <code>FTS_PROCS</code> variable in mailcow.conf, you can adjust the number of indexing processes that can run simultaneously.</p> <p>mailcow Default</p> <p>By default, this value is limited to 1 thread.</p> <p>CAUTION</p> <p>Indexing processes are single-threaded applications that fully utilize a CPU thread. Systems with few cores should use a lower number to avoid overloading the system.</p> Best Practice <p>Plan for about half of your system's CPU threads for the indexing processes. For odd numbers of CPU threads, use the lower count to leave sufficient resources for the main system.</p> <p>Dual-core or single-core systems should disable full-text search.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.en/#fts_heap-max-memory-per-indexing-process","level":3,"title":"<code>FTS_HEAP</code> (Max Memory Per Indexing Process)","text":"<p>With <code>FTS_HEAP</code> in mailcow.conf, you can set the memory allocated per indexing process.</p> <p>mailcow Default</p> <p>By default, this value is limited to 128 MB per process.</p> Best Practice <p>Ideally, allocate 512 MB of memory per process. Systems with less than 8 GB RAM should stick to 128 MB or increase to 256 MB, but reduce the number of processes to avoid OOM errors.</p> <p>While Dovecot continues to operate when RAM is exhausted per worker, it may become significantly slower.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.en/#advanced-configuration-options","level":2,"title":"Advanced Configuration Options","text":"<p>Flatcurve integration allows for customizing FTS options as needed.</p> <p>Note</p> <p>Every setup is unique, so there is no universal \"right\" or \"wrong\" configuration.</p> <p>Experience with the engine varies by system.</p> <p>For example, you can enable more detailed full-text search (substring search), which provides more accurate results but requires more storage and longer indexing times.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.en/#enable-substring-search-more-detailed-full-text-search","level":3,"title":"Enable Substring Search (More Detailed Full-Text Search)","text":"<p>Edit the file <code>data/conf/dovecot/conf.d/fts.conf</code>:</p> <pre><code>plugin {\n    [...]\n\n    fts_flatcurve_substring_search=yes # Can be yes or no\n}\n</code></pre> <p>Restart Dovecot to apply the changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart dovecot-mailcow\n</code></pre>","path":["U e dovecot fts.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-fts.en/#additional-tweaks","level":3,"title":"Additional Tweaks","text":"<p>We welcome community contributions for useful tweaks over time.</p> <p>Meanwhile, you can refer to the official Dovecot and Flatcurve documentation for an overview of available parameters:</p> <ul> <li>Dovecot FTS Module Documentation</li> <li>Flatcurve FTS Engine Documentation</li> </ul>","path":["U e dovecot fts.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-harden_ciphers.de/","level":1,"title":"U e dovecot harden ciphers.de","text":"<p>Wenn Sie die Standard-Cipher und TLS-Versionen, die in Dovecot akzeptiert werden, entsprechend der aktuellen Version auf stärkere Einstellungen ändern möchten, können Sie Folgendes zu Dovecots extra.conf hinzufügen:</p> <pre><code>ssl_min_protocol = TLSv1.2\nssl_cipher_list = ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-CHACHA20-POLY1305\n</code></pre> <p>Falls Sie auch die Cipher für Postfix anpassen wollen finden Sie hier eine entsprechende Anleitung.</p>","path":["U e dovecot harden ciphers.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-harden_ciphers.en/","level":1,"title":"U e dovecot harden ciphers.en","text":"<p>If you want to change the default ciphers and TLS versions accepted in Dovecot as per it's current release to something stronger, you could add following to Dovecot's extra.conf:</p> <pre><code>ssl_min_protocol = TLSv1.2\nssl_cipher_list = ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-CHACHA20-POLY1305\n</code></pre> <p>If you want to adjust the ciphers for Postfix as well you can find the corresponding tutorial here.</p>","path":["U e dovecot harden ciphers.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-idle_interval.de/","level":1,"title":"Ändern des IMAP-IDLE-Intervalls","text":"","path":["Ändern des IMAP-IDLE-Intervalls"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-idle_interval.de/#was-ist-das-idle-intervall","level":2,"title":"Was ist das IDLE-Intervall?","text":"<p>Standardmäßig sendet Dovecot eine \"Ich bin noch da\"-Benachrichtigung an jeden Client, der eine offene Verbindung mit Dovecot hat, um Mails so schnell wie möglich zu erhalten, ohne sie manuell abzufragen (IMAP PUSH). Diese Benachrichtigung wird durch die Einstellung <code>imap_idle_notify_interval</code> gesteuert, die standardmäßig auf 2 Minuten eingestellt ist. </p> <p>Ein kurzes Intervall führt dazu, dass der Client viele Nachrichten für diese Verbindung erhält, was für mobile Geräte schlecht ist, da jedes Mal, wenn das Gerät diese Nachricht erhält, die Mailing-App aufwachen muss. Dies kann zu einer unnötigen Entladung der Batterie führen.</p>","path":["Ändern des IMAP-IDLE-Intervalls"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-idle_interval.de/#bearbeiten-sie-den-wert","level":2,"title":"Bearbeiten Sie den Wert","text":"","path":["Ändern des IMAP-IDLE-Intervalls"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-idle_interval.de/#konfiguration-andern","level":3,"title":"Konfiguration ändern","text":"<p>Erstellen Sie eine neue Datei <code>data/conf/dovecot/extra.conf</code> (oder bearbeiten Sie sie, falls sie bereits existiert). Fügen Sie die Einstellung ein, gefolgt von dem neuen Wert. Um zum Beispiel das Intervall auf 5 Minuten zu setzen, können Sie Folgendes eingeben:</p> <pre><code>imap_idle_notify_interval = 5 mins\n</code></pre> <p>29 Minuten ist der maximale Wert, den der entsprechende RFC erlaubt.</p> <p>Warnung</p> <p>Dies ist keine Standardeinstellung in mailcow, da wir nicht wissen, wie diese Einstellung das Verhalten anderer Clients verändert. Seien Sie vorsichtig, wenn Sie dies ändern und ein anderes Verhalten beobachten.</p>","path":["Ändern des IMAP-IDLE-Intervalls"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-idle_interval.de/#dovecot-neu-laden","level":3,"title":"Dovecot neu laden","text":"<p>Nun laden Sie Dovecot neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow dovecot reload\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow dovecot reload\n</code></pre> <p>Info</p> <p>Sie können den Wert dieser Einstellung überprüfen mit </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow dovecot -a | grep \"imap_idle_notify_interval\"\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow dovecot -a | grep \"imap_idle_notify_interval\"\n</code></pre> <p>Wenn Sie den Wert nicht geändert haben, sollte er auf 2m stehen. Wenn Sie ihn geändert haben, sollten Sie den neuen Wert sehen.</p>","path":["Ändern des IMAP-IDLE-Intervalls"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-idle_interval.en/","level":1,"title":"Changing the IMAP IDLE interval","text":"","path":["Changing the IMAP IDLE interval"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-idle_interval.en/#what-is-the-idle-interval","level":2,"title":"What is the IDLE interval?","text":"<p>Per default, Dovecot sends a \"I'm still here\" notification to every client that has an open connection with Dovecot to get mails as quickly as possible without manually polling it (IMAP PUSH). This notification is controlled by the setting <code>imap_idle_notify_interval</code>, which defaults to 2 minutes. </p> <p>A short interval results in the client getting a lot of messages for this connection, which is bad for mobile devices, because every time the device receives this message, the mailing app has to wake up. This can result in unnecessary battery drain.</p>","path":["Changing the IMAP IDLE interval"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-idle_interval.en/#edit-the-value","level":2,"title":"Edit the value","text":"","path":["Changing the IMAP IDLE interval"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-idle_interval.en/#change-configuration","level":3,"title":"Change configuration","text":"<p>Create a new file <code>data/conf/dovecot/extra.conf</code> (or edit it if it already exists). Insert the setting followed by the new value. For example, to set the interval to 5 minutes you could type:</p> <pre><code>imap_idle_notify_interval = 5 mins\n</code></pre> <p>29 minutes is the maximum value allowed by the corresponding RFC.</p> <p>Warning</p> <p>This isn't a default setting in mailcow because we don't know how this setting changes the behavior of other clients. Be careful if you change this and monitor different behavior.</p>","path":["Changing the IMAP IDLE interval"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-idle_interval.en/#reload-dovecot","level":3,"title":"Reload Dovecot","text":"<p>Now reload Dovecot:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow dovecot reload\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow dovecot reload\n</code></pre> <p>Info</p> <p>You can check the value of this setting with </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow dovecot -a | grep \"imap_idle_notify_interval\"\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow dovecot -a | grep \"imap_idle_notify_interval\"\n</code></pre> <p>If you didn't change it, it should be at 2m. If you did change it, you should see your new value.</p>","path":["Changing the IMAP IDLE interval"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-lazy_expunge.de/","level":1,"title":"U e dovecot lazy expunge.de","text":"<p>Vorsicht</p> <p>Diese Anleitung befindet sich noch in Arbeit, Fehler können passieren! Nutzen Sie diese Funktion mit Bedacht!</p> <p>Hinweis</p> <p>Diese Funktion ist ab mailcow-Versionen 2024-11 kompatibel. Ältere Versionen sind theoretisch ebenfalls in der Lage, die Funktion zu nutzen. Aufgrund interner Änderungen ist die Implementierung jedoch schwieriger und wird hier nicht weiter beschrieben, da nicht unterstüzt.</p>","path":["U e dovecot lazy expunge.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-lazy_expunge.de/#vorwort","level":2,"title":"Vorwort","text":"<p>Dovecot unterstützt seit geraumer Zeit eine Funktion namens Lazy Expunge, welche es dem Serveradministrator ermöglicht, gelöschte E-Mails eines Benutzerkontos nach der eigentlichen Löschung zurückzuhalten.</p> <p>mailcow besitzt eine ähnliche Funktion, die jedoch für Benutzer nicht so leicht zugänglich ist (siehe Versehentlich gelöschte Daten wiederherstellen (Mail)) und eher als Fallback-Methode für Administratoren dient.</p> <p>Mit der Dovecot-Option können Benutzer selbst als gelöscht markierte E-Mails einsehen und wiederherstellen, bevor diese dann automatisch vom Dovecot-Server gelöscht werden.</p>","path":["U e dovecot lazy expunge.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-lazy_expunge.de/#einrichtung","level":2,"title":"Einrichtung","text":"<ol> <li> <p>Bearbeiten Sie die <code>extra.conf</code> im Dovecot-Konfigurationsordner (in der Regel unter <code>MAILCOW_ROOT/data/conf/dovecot</code>) mit folgendem Inhalt:     <pre><code>plugin {\n    # Kopiere alle gelöschten Mails in die .EXPUNGED Mailbox\n    lazy_expunge = .EXPUNGED\n\n    # Als gelöscht markierte Mails von der Quota ausschließen\n    quota_rule = .EXPUNGED:ignore\n}\n\n# Definiert die .EXPUNGED Mailbox\nnamespace inbox {\n    mailbox .EXPUNGED {\n        # Definiert, wie lange Mails in diesem Ordner bleiben sollen, bevor sie gelöscht werden. \n        # Zeit wird definiert nach: https://doc.dovecot.org/2.3/settings/types/#time\n        autoexpunge = 7days\n        # Definiert, wie viele Mails maximal in der EXPUNGED Mailbox gehalten werden sollen, bevor diese geleert wird\n        autoexpunge_max_mails = 100000\n    }\n}\n</code></pre></p> </li> <li> <p>Starten Sie den Dovecot-Container neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart dovecot-mailcow\n</code></pre> </li> <li> <p>Nun sollte, wenn der Papierkorb geleert wird, ein neuer Ordner mit dem Namen <code>.EXPUNGED</code> erscheinen. In diesem Ordner sind die E-Mails enthalten, die gemäß der in Schritt 1 definierten Regeln nach einer gewissen Zeit automatisch vom Server gelöscht werden.</p> </li> </ol>","path":["U e dovecot lazy expunge.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-lazy_expunge.en/","level":1,"title":"U e dovecot lazy expunge.en","text":"<p>Danger</p> <p>This guide is still a work in progress, and errors may occur! Use this feature with caution!</p> <p>Info</p> <p>This feature is compatible with mailcow versions starting from 2024-11. Older versions are theoretically capable of using it as well, but due to internal changes, the implementation is more complicated, so it won't be stated here as unsupported.</p>","path":["U e dovecot lazy expunge.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-lazy_expunge.en/#introduction","level":2,"title":"Introduction","text":"<p>Dovecot has supported a feature called Lazy Expunge for quite some time, which allows server administrators to temporarily retain deleted emails from a user account even after they have been deleted.</p> <p>mailcow also has a similar feature, but it is not easily accessible to users (see Recover accidentally deleted data (Mail)) and serves more as a fallback method for administrators.</p> <p>With the Dovecot option, users can view and restore emails that have been marked as deleted before they are automatically purged by the Dovecot server.</p>","path":["U e dovecot lazy expunge.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-lazy_expunge.en/#setup","level":2,"title":"Setup","text":"<ol> <li> <p>Edit the <code>extra.conf</code> file in the Dovecot configuration folder (usually located at <code>MAILCOW_ROOT/data/conf/dovecot</code>) with the following content:     <pre><code>plugin {\n    # Copy all deleted emails to the .EXPUNGED mailbox\n    lazy_expunge = .EXPUNGED\n\n    # Exclude marked-as-deleted emails from the quota\n    quota_rule = .EXPUNGED:ignore\n}\n\n# Define the .EXPUNGED mailbox\nnamespace inbox {\n    mailbox .EXPUNGED {\n        # Define how long emails will stay in this folder before they are deleted. Time is defined according to: https://doc.dovecot.org/2.3/settings/types/#time\n        autoexpunge = 7days\n        # Define how many emails can be kept in the EXPUNGED folder before it is cleared\n        autoexpunge_max_mails = 100000\n    }\n}\n</code></pre></p> </li> <li> <p>Restart the Dovecot container:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart dovecot-mailcow\n</code></pre> </li> <li> <p>Once the trash is emptied, a new folder named <code>.EXPUNGED</code> should appear. This folder will contain emails that, according to the rules defined in step 1, will be automatically deleted from the server after a certain period.</p> </li> </ol>","path":["U e dovecot lazy expunge.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-mail-crypt.de/","level":1,"title":"U e dovecot mail crypt.de","text":"<p>Achtung</p> <p>Die Mails werden komprimiert (lz4) und verschlüsselt gespeichert. Das Schlüsselpaar ist in crypt-vol-1 zu finden.</p> <p>Wenn Sie vorhandene maildir-Dateien entschlüsseln/verschlüsseln wollen, können Sie das folgende Skript auf eigene Gefahr verwenden:</p> <p>Wechseln Sie in den Dovecot Container, indem Sie folgenden Befehl im mailcow-dockerized Verzeichnis ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow /bin/bash\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow /bin/bash\n</code></pre> <pre><code># Entschlüsseln Sie /var/vmail\nfind /var/vmail/ -type f -regextype egrep -regex '.*S=.*W=.*' | while read -r file; do\nif [[ $(head -c7 \"$file\") == \"CRYPTED\" ]]; then\ndoveadm fs get compress lz4:1:crypt:private_key_path=/mail_crypt/ecprivkey.pem:public_key_path=/mail_crypt/ecpubkey.pem:posix:prefix=/ \\\n  \"$file\" &gt; \"/tmp/$(basename \"$file\")\"\n  if [[ -s \"/tmp/$(basename \"$file\")\" ]]; then\n    chmod 600 \"/tmp/$(basename \"$file\")\"\n    chown 5000:5000 \"/tmp/$(basename \"$file\")\"\n    mv \"/tmp/$(basename \"$file\")\" \"$file\"\n  else\n    rm \"/tmp/$(basename \"$file\")\"\n  fi\nfi\ndone\n\n\n# Verschlüsseln von /var/vmail\nfind /var/vmail/ -type f -regextype egrep -regex '.*S=.*W=.*' | while read -r file; do\nif [[ $(head -c7 \"$file\") != \"CRYPTED\" ]]; then\ndoveadm fs put crypt private_key_path=/mail_crypt/ecprivkey.pem:public_key_path=/mail_crypt/ecpubkey.pem:posix:prefix=/ \\\n  \"$file\" \"$file\"\n  chmod 600 \"$file\"\n  chown 5000:5000 \"$file\"\nfi\ndone\n</code></pre>","path":["U e dovecot mail crypt.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-mail-crypt.en/","level":1,"title":"U e dovecot mail crypt.en","text":"<p>Warning</p> <p>Mails are stored compressed (lz4) and encrypted. The key pair can be found in crypt-vol-1.</p> <p>If you want to decode/encode existing maildir files, you can use the following script at your own risk:</p> <p>Enter Dovecot by running the following command in the mailcow-dockerized location:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow /bin/bash\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow /bin/bash\n</code></pre> <pre><code># Decrypt /var/vmail\nfind /var/vmail/ -type f -regextype egrep -regex '.*S=.*W=.*' | while read -r file; do\nif [[ $(head -c7 \"$file\") == \"CRYPTED\" ]]; then\ndoveadm fs get compress lz4:1:crypt:private_key_path=/mail_crypt/ecprivkey.pem:public_key_path=/mail_crypt/ecpubkey.pem:posix:prefix=/ \\\n  \"$file\" &gt; \"/tmp/$(basename \"$file\")\"\n  if [[ -s \"/tmp/$(basename \"$file\")\" ]]; then\n    chmod 600 \"/tmp/$(basename \"$file\")\"\n    chown 5000:5000 \"/tmp/$(basename \"$file\")\"\n    mv \"/tmp/$(basename \"$file\")\" \"$file\"\n  else\n    rm \"/tmp/$(basename \"$file\")\"\n  fi\nfi\ndone\n\n# Encrypt /var/vmail\nfind /var/vmail/ -type f -regextype egrep -regex '.*S=.*W=.*' | while read -r file; do\nif [[ $(head -c7 \"$file\") != \"CRYPTED\" ]]; then\ndoveadm fs put crypt private_key_path=/mail_crypt/ecprivkey.pem:public_key_path=/mail_crypt/ecpubkey.pem:posix:prefix=/ \\\n  \"$file\" \"$file\"\n  chmod 600 \"$file\"\n  chown 5000:5000 \"$file\"\nfi\ndone\n</code></pre>","path":["U e dovecot mail crypt.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-more.de/","level":1,"title":"U e dovecot more.de","text":"<p>Hier ist nur eine unsortierte Liste von nützlichen <code>doveadm</code>-Befehlen, die nützlich sein könnten.</p>","path":["U e dovecot more.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-more.de/#doveadm-quota","level":2,"title":"doveadm quota","text":"<p>Die Befehle <code>quota get</code> und <code>quota recalc</code><sup>1</sup> werden verwendet, um die Quota-Nutzung des aktuellen Benutzers anzuzeigen oder neu zu berechnen. Die angezeigten Werte sind in Kilobytes.</p> <p>Um den aktuellen Quota-Status für einen Benutzer / eine Mailbox aufzulisten, tun Sie folgendes:</p> <pre><code>doveadm quota get -u 'mailbox@example.org'\n</code></pre> <p>Um den Quota-Speicherwert für alle Benutzer aufzulisten, tun Sie folgendes:</p> <pre><code>doveadm quota get -A |grep \"STORAGE\"\n</code></pre> <p>Berechnen Sie die Quota-Nutzung eines einzelnen Benutzers neu:</p> <pre><code>doveadm quota recalc -u 'mailbox@example.org'\n</code></pre>","path":["U e dovecot more.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-more.de/#doveadm-search","level":2,"title":"doveadm search","text":"<p>Der Befehl <code>doveadm search</code><sup>2</sup> wird verwendet, um Nachrichten zu finden, die Ihrer Anfrage entsprechen. Er kann den Benutzernamen, die Mailbox-GUID / -UID und die Nachrichten-GUIDs / -UIDs zurückgeben.</p> <p>Um die Anzahl der Nachrichten im .Trash Ordner eines Benutzers zu sehen:</p> <pre><code>doveadm search -A mailbox 'Trash' | awk '{print $1}' | sort | uniq -c\n</code></pre> <p>Alle Nachrichten im Postfach eines Benutzers anzeigen, die älter als 90 Tage sind:</p> <pre><code>doveadm search -u 'mailbox@example.org' mailbox 'INBOX' savedbefore 90d\n</code></pre> <p>Zeige alle Nachrichten in beliebigen Ordnern, die älter sind als 30 Tage für <code>mailbox@example.org</code>:</p> <pre><code>doveadm search -u 'mailbox@example.org' mailbox \"*\" savedbefore 30d\n</code></pre> <ol> <li> <p>https://wiki.dovecot.org/Tools/Doveadm/Quota ↩</p> </li> <li> <p>https://wiki.dovecot.org/Tools/Doveadm/Search ↩</p> </li> </ol>","path":["U e dovecot more.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-more.en/","level":1,"title":"U e dovecot more.en","text":"<p>Here is just an unsorted list of useful <code>doveadm</code> commands that could be useful.</p>","path":["U e dovecot more.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-more.en/#doveadm-quota","level":2,"title":"doveadm quota","text":"<p>The <code>quota get</code> and <code>quota recalc</code><sup>1</sup> commands are used to display or recalculate the current user's quota usage. The reported values are in kilobytes.</p> <p>To list the current quota status for a user / mailbox, do:</p> <pre><code>doveadm quota get -u 'mailbox@example.org'\n</code></pre> <p>To list the quota storage value for all users, do:</p> <pre><code>doveadm quota get -A |grep \"STORAGE\"\n</code></pre> <p>Recalculate a single user's quota usage:</p> <pre><code>doveadm quota recalc -u 'mailbox@example.org'\n</code></pre>","path":["U e dovecot more.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-more.en/#doveadm-search","level":2,"title":"doveadm search","text":"<p>The <code>doveadm search</code><sup>2</sup> command is used to find messages matching your query. It can return the username, mailbox-GUID / -UID and message-GUIDs / -UIDs.</p> <p>To view the number of messages, by user, in their .Trash folder:</p> <pre><code>doveadm search -A mailbox 'Trash' | awk '{print $1}' | sort | uniq -c\n</code></pre> <p>Show all messages in a user's inbox older then 90 days:</p> <pre><code>doveadm search -u 'mailbox@example.org' mailbox 'INBOX' savedbefore 90d\n</code></pre> <p>Show all messages in any folder that are older then 30 days for <code>mailbox@example.org</code>:</p> <pre><code>doveadm search -u 'mailbox@example.org' mailbox \"*\" savedbefore 30d\n</code></pre> <ol> <li> <p>https://wiki.dovecot.org/Tools/Doveadm/Quota ↩</p> </li> <li> <p>https://wiki.dovecot.org/Tools/Doveadm/Search ↩</p> </li> </ol>","path":["U e dovecot more.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-performance.de/","level":1,"title":"U e dovecot performance.de","text":"","path":["U e dovecot performance.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-performance.de/#maildir_very_dirty_syncs","level":2,"title":"maildir_very_dirty_syncs","text":"<p>Dovecot's <code>maildir_very_dirty_syncs</code> Option ist seit mailcow Release 2023-05 standardmäßig aktiviert. Diese Option kann die Leistung von Postfächern, die sehr große Ordner (über 100.000 E-Mails) enthalten, erheblich verbessern.</p> <p>Mit dieser Option wird vermieden, dass beim Laden einer E-Mail das gesamte <code>cur</code>-Verzeichnis erneut durchsucht wird. Wenn diese Option deaktiviert ist, geht Dovecot auf Nummer sicher und durchsucht das gesamte <code>cur</code>-Verzeichnis (vergleichbar mit dem Ausführen eines <code>ls</code>), um zu prüfen, ob diese bestimmte E-Mail berührt (umbenannt, etc.) wurde, indem es nach allen Dateien sucht, deren Namen die richtige ID enthalten. Dies ist sehr langsam, wenn das Verzeichnis groß ist, selbst auf Dateisystemen, die für solche Anwendungsfälle optimiert sind (wie ext4 mit aktiviertem <code>dir_index</code>) auf schnellen SSD-Laufwerken.</p> <p>Diese Option ist sicher, solange Sie Dateien unter <code>cur</code> nicht manuell anfassen (da Dovecot die Änderungen dann möglicherweise nicht bemerkt). Auch wenn diese Option aktiviert ist, wird Dovecot Änderungen bemerken, wenn die mtime (last modified time) der Datei geändert wurde, aber ansonsten wird das Verzeichnis nicht gescannt und es wird einfach angenommen, dass der Index aktuell ist. Dies entspricht im Wesentlichen dem, was sdbox/mdbox tun, und mit dieser Option können Sie einen Teil der Leistungssteigerung erhalten, die mit sdbox/mdbox einhergehen würde, während Sie weiterhin maildir verwenden.</p> <p>Diese Option ist bei einer Standard-mailcow-Installation sicher zu verwenden. Wenn Sie jedoch Tools von Drittanbietern verwenden, die manuell Dateien direkt im Maildir modifizieren (anstatt über IMAP), möchten Sie diese Option vielleicht deaktivieren. Um diese Option zu deaktivieren, erstellen Sie eine data/conf/dovecot/extra.conf Datei und fügen Sie diese Einstellung hinzu:</p> <pre><code>maildir_very_dirty_syncs=no\n</code></pre> <p>Achtung</p> <p>Bitte nutzen Sie für eigene Anpassungen IMMER, die oben erwähnte <code>extra.conf</code>, da Änderungen, welche in der normalen <code>dovecot.conf</code> geändert werden möglicherweise nach einem Update vom GitHub Quellcode überschrieben werden.</p>","path":["U e dovecot performance.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-performance.en/","level":1,"title":"U e dovecot performance.en","text":"","path":["U e dovecot performance.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-performance.en/#maildir_very_dirty_syncs","level":2,"title":"maildir_very_dirty_syncs","text":"<p>Dovecot's <code>maildir_very_dirty_syncs</code> option is enabled by default since mailcow Release 2023-05. This option can significantly improve the performance of mailboxes that contain very large folders (over 100,000 emails).</p> <p>What this option does is it avoids rescanning the entire <code>cur</code> directory whenever loading an email. With this option disabled, Dovecot takes it safe and scans the entire <code>cur</code> directory (comparable with running an <code>ls</code>) to check if that particular email was touched (renamed, etc), by looking for all files whose names contain the correct ID. This is very slow if the directory is large, even on filesystems optimized for such use cases (such as ext4 with <code>dir_index</code> enabled) on fast SSD drives.</p> <p>This option is safe to use as long as you do not manually touch files under <code>cur</code> (as then Dovecot may not notice the changes). Even with this option enabled, Dovecot will still notice changes if the file's mtime (last modified time) is changed, but otherwise it will not scan the directory and just assumes the index is up-to-date. This is essentially the same as what sdbox/mdbox do, and with this option you can get some of the performance increase that would come with sdbox/mdbox while still using maildir.</p> <p>This option is safe to use on a standard Mailcow installation. However, if you use any third-party tools that manually modify files directly in the maildir (rather than via IMAP), you may wish to disable it. To disable this option, create a data/conf/dovecot/extra.conf file and add this setting to it:</p> <pre><code>maildir_very_dirty_syncs=no\n</code></pre> <p>Warning</p> <p>Please ALWAYS use the above mentioned <code>extra.conf</code> for your own customizations, as changes made in the normal <code>dovecot.conf</code> might be overwritten after an update from GitHub source code.</p>","path":["U e dovecot performance.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-public_folder.de/","level":1,"title":"U e dovecot public folder.de","text":"<p>Erstellen Sie einen neuen öffentlichen Namespace \"Public\" und eine Mailbox \"Develcow\" innerhalb dieses Namespaces:</p> <p>Bearbeiten oder erstellen Sie <code>data/conf/dovecot/extra.conf</code>, fügen Sie hinzu:</p> <pre><code>namespace {\n  type = public\n  separator = /\n  prefix = Public/\n  location = maildir:/var/vmail/public:INDEXPVT=~/public\n  subscriptions = yes\n  mailbox \"Develcow\" {\n    auto = subscribe\n  }\n}\n</code></pre> <p><code>:INDEXPVT=~/public</code> kann weggelassen werden, wenn die Flags, die pro Benutzer gesehen werden, nicht gewünscht sind.</p> <p>Die neue Mailbox im öffentlichen Namensraum wird von den Benutzern automatisch abonniert.</p> <p>Um allen authentifizierten Benutzern vollen Zugriff auf das neue Postfach (nicht auf den gesamten Namespace) zu gewähren, führen Sie aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm acl set -A \"Public/Develcow\" \"authenticated\" lookup read write write-seen write-deleted insert post delete expunge create\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm acl set -A \"Public/Develcow\" \"authenticated\" lookup read write write-seen write-deleted insert post delete expunge create\n</code></pre> <p>Passen Sie den Befehl an Ihre Bedürfnisse an, wenn Sie detailliertere Rechte pro Benutzer vergeben möchten (verwenden Sie z.B. <code>-u user@domain</code> anstelle von <code>-A</code>).</p>","path":["U e dovecot public folder.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-public_folder.de/#erlaube-authentifizierten-benutzern-den-zugriff-auf-den-gesamten-offentlichen-namespace","level":2,"title":"Erlaube authentifizierten Benutzern den Zugriff auf den gesamten öffentlichen Namespace","text":"<p>Um allen authentifizierten Benutzern vollen Zugriff auf den gesamten öffentlichen Namespace und seine Unterordner zu gewähren, erstellen Sie eine neue Datei <code>dovecot-acl</code> im Namespace-Stammverzeichnis:</p> <p>Öffnen/bearbeiten/erstellen Sie <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/public/dovecot-acl</code> (passen Sie den Pfad entsprechend an), um die globale ACL-Datei mit dem folgenden Inhalt zu erstellen:</p> <pre><code>authenticated kxeilprwts\n</code></pre> <p>kxeilprwts\" ist gleichbedeutend mit \"lookup read write write-seen write-deleted insert post delete expunge create\".</p> <p>Sie können <code>doveadm acl set -u user@domain \"Public/Develcow\" user=user@domain lookup read</code> verwenden, um den Zugriff für einen einzelnen Benutzer zu beschränken. Sie können es auch umdrehen und den Zugriff für alle Benutzer auf \"lr\" beschränken und nur einigen Benutzern vollen Zugriff gewähren.</p> <p>Siehe Dovecot ACL für weitere Informationen über ACL.</p>","path":["U e dovecot public folder.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-public_folder.en/","level":1,"title":"U e dovecot public folder.en","text":"<p>Create a new public namespace \"Public\" and a mailbox \"Develcow\" inside that namespace:</p> <p>Edit or create <code>data/conf/dovecot/extra.conf</code>, add:</p> <pre><code>namespace {\n  type = public\n  separator = /\n  prefix = Public/\n  location = maildir:/var/vmail/public:INDEXPVT=~/public\n  subscriptions = yes\n  mailbox \"Develcow\" {\n    auto = subscribe\n  }\n}\n</code></pre> <p><code>:INDEXPVT=~/public</code> can be omitted if per-user seen flags are not wanted.</p> <p>The new mailbox in the public namespace will be auto-subscribed by users.</p> <p>To allow all authenticated users access full to that new mailbox (not the whole namespace), run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm acl set -A \"Public/Develcow\" \"authenticated\" lookup read write write-seen write-deleted insert post delete expunge create\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm acl set -A \"Public/Develcow\" \"authenticated\" lookup read write write-seen write-deleted insert post delete expunge create\n</code></pre> <p>Adjust the command to your needs if you like to assign more granular rights per user (use <code>-u user@domain</code> instead of <code>-A</code> for example).</p>","path":["U e dovecot public folder.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-public_folder.en/#allow-authenticated-users-access-to-the-whole-public-namespace","level":2,"title":"Allow authenticated users access to the whole public namespace","text":"<p>To allow all authenticated users access full access to the whole public namespace and its subfolders, create a new <code>dovecot-acl</code> file in the namespace root directory:</p> <p>Open/edit/create <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/public/dovecot-acl</code> (adjust the path accordingly) to create the global ACL file with the following content:</p> <pre><code>authenticated kxeilprwts\n</code></pre> <p><code>kxeilprwts</code> equals to <code>lookup read write write-seen write-deleted insert post delete expunge create</code>.</p> <p>You can use <code>doveadm acl set -u user@domain \"Public/Develcow\" user=user@domain lookup read</code> to limit access for a single user. You may also turn it around to limit access for all users to \"lr\" and grant only some users full access.</p> <p>See Dovecot ACL for further information about ACL.</p>","path":["U e dovecot public folder.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-static_master.de/","level":1,"title":"U e dovecot static master.de","text":"<p>Zufällige Master-Benutzernamen und Passwörter werden automatisch bei jedem Neustart von dovecot-mailcow erstellt.</p> <p>Das wird empfohlen und sollte nicht geändert werden.</p> <p>Wenn der Benutzer trotzdem statisch sein soll, geben Sie bitte zwei Variablen in <code>mailcow.conf</code> an.</p> <p>Beide Parameter dürfen nicht leer sein!</p> <pre><code>DOVECOT_MASTER_USER=mymasteruser\nDOVECOT_MASTER_PASS=mysecretpass\n</code></pre> <p>Führen Sie folgenden Befehl aus, um Ihre Änderungen zu übernehmen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Der statische Master-Benutzername wird zu <code>DOVECOT_MASTER_USER@mailcow.local</code> erweitert.</p> <p>Um sich als <code>test@example.org</code> anzumelden, würde dies <code>test@example.org*mymasteruser@mailcow.local</code> mit dem oben angegebenen Passwort entsprechen.</p> <p>Eine Anmeldung bei SOGo ist mit diesem Benutzernamen nicht möglich. Für Admins steht eine Click-to-Login-Funktion für SOGo zur Verfügung, wie [hier] beschrieben (https://docs.mailcow.email/debug-admin_login_sogo/) Es wird kein Hauptbenutzer benötigt.</p>","path":["U e dovecot static master.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-static_master.en/","level":1,"title":"U e dovecot static master.en","text":"<p>Random master usernames and passwords are automatically created on every restart of dovecot-mailcow.</p> <p>That's recommended and should not be changed.</p> <p>If you need the user to be static anyway, please specify two variables in <code>mailcow.conf</code>.</p> <p>Both parameters must not be empty!</p> <pre><code>DOVECOT_MASTER_USER=mymasteruser\nDOVECOT_MASTER_PASS=mysecretpass\n</code></pre> <p>Run the command below to apply your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>The static master username will be expanded to <code>DOVECOT_MASTER_USER@mailcow.local</code>.</p> <p>To login as <code>test@example.org</code> this would equal to <code>test@example.org*mymasteruser@mailcow.local</code> with the specified password above.</p> <p>A login to SOGo is not possible with this username. A click-to-login function for SOGo is available for admins as described here No master user is required.</p>","path":["U e dovecot static master.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-vmail-volume.de/","level":1,"title":"U e dovecot vmail volume.de","text":"","path":["U e dovecot vmail volume.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-vmail-volume.de/#der-neue-weg","level":2,"title":"Der \"neue\" Weg","text":"<p>Warnung</p> <p>Neuere Docker-Versionen scheinen sich über bestehende Volumes zu beschweren. Man kann dies vorübergehend beheben, indem man das bestehende Volume entfernt und mailcow mit der Override-Datei startet. Aber es scheint nach einem Neustart problematisch zu sein (muss bestätigt werden).</p> <p>Ein einfacher, schmutziger, aber stabiler Workaround ist es, mailcow zu stoppen, <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data</code> zu entfernen und einen neuen Link zu Ihrem entfernten Dateisystem zu erstellen, zum Beispiel:</p> <pre><code>mv /var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data /var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data_backup\nln -s /mnt/volume-xy/vmail_data /var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data\n</code></pre> <p>Starten Sie anschließend mailcow.</p>","path":["U e dovecot vmail volume.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-vmail-volume.de/#der-alte-weg","level":2,"title":"Der \"alte\" Weg","text":"<p>Wenn man einen anderen Ordner für das vmail-Volume verwenden möchte, kann man eine <code>docker-compose.override.yml</code> Datei erstellen und den folgenden Inhalt hinzufügen:</p> <pre><code>volumes:\n  vmail-vol-1:\n    driver_opts:\n      type: none\n      device: /data/mailcow/vmail   \n      o: bind\n</code></pre>","path":["U e dovecot vmail volume.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-vmail-volume.de/#verschieben-eines-bestehenden-vmail-ordners","level":3,"title":"Verschieben eines bestehenden vmail-Ordners:","text":"<ul> <li>Finden Sie den aktuellen vmail-Ordner anhand seines \"Mountpoint\"-Attributs: <code>docker volume inspect mailcowdockerized_vmail-vol-1</code></li> </ul> <pre><code>[\n    {\n        \"CreatedAt\": \"2019-06-16T22:08:34+02:00\",\n        \"Driver\": \"local\",\n        \"Labels\": {\n            \"com.docker.compose.project\": \"mailcowdockerized\",\n            \"com.docker.compose.version\": \"1.23.2\",\n            \"com.docker.compose.volume\": \"vmail-vol-1\"\n        },\n        \"Mountpoint\": \"/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data\",\n        \"Name\": \"mailcowdockerized_vmail-vol-1\",\n        \"Options\": null,\n        \"Scope\": \"local\"\n    }\n]\n</code></pre> <ul> <li>Kopieren Sie den Inhalt des <code>Mountpoint</code>-Ordners an den neuen Speicherort (z.B. <code>/data/mailcow/vmail</code>) mit <code>cp -a</code>, <code>rsync -a</code> oder einem ähnlichen, nicht strikten Kopierbefehl</li> <li>Stoppen Sie mailcow durch Ausführen des kommenden Befehls aus Ihrem mailcow-Stammverzeichnis (z.B. <code>/opt/mailcow-dockerized</code>):</li> </ul> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\n</code></pre> <pre><code>docker-compose down    \n</code></pre> <ul> <li>Erstellen Sie die Datei <code>docker-compose.override.yml</code>, bearbeiten Sie den Gerätepfad entsprechend</li> <li>Löschen Sie den aktuellen vmail-Ordner: <code>docker volume rm mailcowdockerized_vmail-vol-1</code></li> <li>Starten Sie mailcow durch Ausführen des folgenden Befehls aus Ihrem mailcow-Stammverzeichnis (z.B. <code>/opt/mailcow-dockerized</code>):</li> </ul> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e dovecot vmail volume.de"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-vmail-volume.en/","level":1,"title":"U e dovecot vmail volume.en","text":"","path":["U e dovecot vmail volume.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-vmail-volume.en/#the-new-way","level":2,"title":"The \"new\" way","text":"<p>Warning</p> <p>Newer Docker versions seem to complain about existing volumes. You can fix this temporarily by removing the existing volume and start mailcow with the override file. But it seems to be problematic after a reboot (needs to be confirmed).</p> <p>An easy, dirty, yet stable workaround is to stop mailcow, remove <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data</code> and create a new link to your remote filesystem location, for example:</p> <pre><code>mv /var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data /var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data_backup\nln -s /mnt/volume-xy/vmail_data /var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data\n</code></pre> <p>Start mailcow afterwards.</p>","path":["U e dovecot vmail volume.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-vmail-volume.en/#the-old-way","level":2,"title":"The \"old\" way","text":"<p>If you want to use another folder for the vmail-volume, you can create a <code>docker-compose.override.yml</code> file and add the following content:</p> <pre><code>volumes:\n  vmail-vol-1:\n    driver_opts:\n      type: none\n      device: /data/mailcow/vmail   \n      o: bind\n</code></pre>","path":["U e dovecot vmail volume.en"],"tags":[]},{"location":"de/manual-guides/Dovecot/u_e-dovecot-vmail-volume.en/#moving-an-existing-vmail-folder","level":3,"title":"Moving an existing vmail folder:","text":"<ul> <li>Locate the current vmail folder by its \"Mountpoint\" attribute: <code>docker volume inspect mailcowdockerized_vmail-vol-1</code></li> </ul> <pre><code>[\n    {\n        \"CreatedAt\": \"2019-06-16T22:08:34+02:00\",\n        \"Driver\": \"local\",\n        \"Labels\": {\n            \"com.docker.compose.project\": \"mailcowdockerized\",\n            \"com.docker.compose.version\": \"1.23.2\",\n            \"com.docker.compose.volume\": \"vmail-vol-1\"\n        },\n        \"Mountpoint\": \"/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data\",\n        \"Name\": \"mailcowdockerized_vmail-vol-1\",\n        \"Options\": null,\n        \"Scope\": \"local\"\n    }\n]\n</code></pre> <ul> <li>Copy the content of the <code>Mountpoint</code> folder to the new location (e.g. <code>/data/mailcow/vmail</code>) using <code>cp -a</code>, <code>rsync -a</code> or a similar non strcuture breaking copy command</li> <li>Stop mailcow by executing the following command from within your mailcow root folder (e.g. <code>/opt/mailcow-dockerized</code>):</li> </ul> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\n</code></pre> <pre><code>docker-compose down    \n</code></pre> <ul> <li>Create the file <code>docker-compose.override.yml</code>, edit the device path accordingly</li> <li>Delete the current vmail folder: <code>docker volume rm mailcowdockerized_vmail-vol-1</code></li> <li>Start mailcow by executing the following command from within your mailcow root folder (e.g. <code>/opt/mailcow-dockerized</code>):</li> </ul> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e dovecot vmail volume.en"],"tags":[]},{"location":"de/manual-guides/Nginx/u_e-nginx_custom.de/","level":1,"title":"U e nginx custom.de","text":"","path":["U e nginx custom.de"],"tags":[]},{"location":"de/manual-guides/Nginx/u_e-nginx_custom.de/#ssl","level":2,"title":"SSL","text":"<p>Bitte lesen Sie Erweitertes SSL und überprüfen Sie explizit <code>ADDITIONAL_SERVER_NAMES</code> für die SSL-Konfiguration.</p> <p>Bitte fügen Sie ADDITIONAL_SERVER_NAMES nicht hinzu, wenn Sie planen, einen anderen Web-Root zu verwenden.</p>","path":["U e nginx custom.de"],"tags":[]},{"location":"de/manual-guides/Nginx/u_e-nginx_custom.de/#neue-website","level":2,"title":"Neue Website","text":"<p>Um persistente (über Updates) Sites zu erstellen, die von mailcow: dockerized gehostet werden, muss eine neue Site-Konfiguration in <code>data/conf/nginx/</code> platziert werden:</p> <p>Eine gute Vorlage, um damit zu beginnen:</p> <pre><code>nano data/conf/nginx/my_custom_site.conf\n</code></pre> <pre><code>server {\n  ssl_certificate /etc/ssl/mail/cert.pem;\n  ssl_certificate_key /etc/ssl/mail/key.pem;\n  ssl_protocols TLSv1.2 TLSv1.3;\n  ssl_prefer_server_ciphers on;\n  ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305;\n  ssl_ecdh_curve X25519:X448:secp384r1:secp256k1;\n  ssl_session_cache shared:SSL:50m;\n  ssl_session_timeout 1d;\n  ssl_session_tickets off;\n  index index.php index.html;\n  client_max_body_size 0;\n  # Location: data/web\n  root /web;\n  # Location: data/web/mysite.com\n  #root /web/mysite.com\n  include /etc/nginx/conf.d/listen_plain.active;\n  include /etc/nginx/conf.d/listen_ssl.active;\n  server_name mysite.example.org;\n  server_tokens off;\n\n  # This allows acme to be validated even with a different web root\n  location ^~ /.well-known/acme-challenge/ {\n    default_type \"text/plain\";\n    rewrite /.well-known/acme-challenge/(.*) /$1 break;\n    root /web/.well-known/acme-challenge/;\n  }\n\n  if ($scheme = http) {\n    return 301 https://$server_name$request_uri;\n  }\n}\n</code></pre>","path":["U e nginx custom.de"],"tags":[]},{"location":"de/manual-guides/Nginx/u_e-nginx_custom.de/#neue-website-mit-proxy-zu-einem-entfernten-location","level":2,"title":"Neue Website mit Proxy zu einem entfernten Location","text":"<p>Ein weiteres Beispiel mit einer Reverse-Proxy-Konfiguration:</p> <pre><code>nano data/conf/nginx/my_custom_site.conf\n</code></pre> <pre><code>server {\n  ssl_certificate /etc/ssl/mail/cert.pem;\n  ssl_certificate_key /etc/ssl/mail/key.pem;\n  ssl_protocols TLSv1.2 TLSv1.3;\n  ssl_prefer_server_ciphers on;\n  ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305;\n  ssl_ecdh_curve X25519:X448:secp384r1:secp256k1;\n  ssl_session_cache shared:SSL:50m;\n  ssl_session_timeout 1d;\n  ssl_session_tickets off;\n  index index.php index.html;\n  client_max_body_size 0;\n  root /web;\n  include /etc/nginx/conf.d/listen_plain.active;\n  include /etc/nginx/conf.d/listen_ssl.active;\n  server_name example.domain.tld;\n  server_tokens off;\n\n  location ^~ /.well-known/acme-challenge/ {\n    allow all;\n    default_type \"text/plain\";\n  }\n\n  if ($scheme = http) {\n    return 301 https://$host$request_uri;\n  }\n\n  location / {\n    proxy_pass http://service:3000/;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    client_max_body_size 0;\n  }\n}\n</code></pre>","path":["U e nginx custom.de"],"tags":[]},{"location":"de/manual-guides/Nginx/u_e-nginx_custom.de/#konfig-erweiterung-in-mailcows-nginx","level":2,"title":"Konfig-Erweiterung in mailcows Nginx","text":"<p>Der Dateiname, der für eine neue Site verwendet wird, ist nicht wichtig, solange der Dateiname eine .conf-Erweiterung trägt.</p> <p>Es ist auch möglich, die Konfiguration der Standarddatei <code>site.conf</code> Datei zu erweitern:</p> <pre><code>nano data/conf/nginx/site.my_content.custom\n</code></pre> <p>Dieser Dateiname muss keine \".conf\"-Erweiterung haben, sondern folgt dem Muster <code>site.*.custom</code>, wobei <code>*</code> ein eigener Name ist.</p> <p>Wenn PHP in eine benutzerdefinierte Site eingebunden werden soll, verwenden Sie bitte den PHP-FPM-Listener auf phpfpm:9002 oder erstellen Sie einen neuen Listener in <code>data/conf/phpfpm/php-fpm.d/pools.conf</code>.</p> <p>Starten Sie Nginx neu (und PHP-FPM, falls ein neuer Listener erstellt wurde):</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart nginx-mailcow\ndocker compose restart php-fpm-mailcow\n</code></pre> <pre><code>docker-compose restart nginx-mailcow\ndocker-compose restart php-fpm-mailcow\n</code></pre>","path":["U e nginx custom.de"],"tags":[]},{"location":"de/manual-guides/Nginx/u_e-nginx_custom.en/","level":1,"title":"U e nginx custom.en","text":"","path":["U e nginx custom.en"],"tags":[]},{"location":"de/manual-guides/Nginx/u_e-nginx_custom.en/#ssl","level":2,"title":"SSL","text":"<p>Please see Advanced SSL and explicitly check <code>ADDITIONAL_SERVER_NAMES</code> for SSL configuration.</p> <p>Please do not add ADDITIONAL_SERVER_NAMES when you plan to use a different web root.</p>","path":["U e nginx custom.en"],"tags":[]},{"location":"de/manual-guides/Nginx/u_e-nginx_custom.en/#new-site","level":2,"title":"New site","text":"<p>To create persistent (over updates) sites hosted by mailcow: dockerized, a new site configuration must be placed inside <code>data/conf/nginx/</code>:</p> <p>A good template to begin with:</p> <pre><code>nano data/conf/nginx/my_custom_site.conf\n</code></pre> <pre><code>server {\n  ssl_certificate /etc/ssl/mail/cert.pem;\n  ssl_certificate_key /etc/ssl/mail/key.pem;\n  ssl_protocols TLSv1.2 TLSv1.3;\n  ssl_prefer_server_ciphers on;\n  ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305;\n  ssl_ecdh_curve X25519:X448:secp384r1:secp256k1;\n  ssl_session_cache shared:SSL:50m;\n  ssl_session_timeout 1d;\n  ssl_session_tickets off;\n  index index.php index.html;\n  client_max_body_size 0;\n  # Location: data/web\n  root /web;\n  # Location: data/web/mysite.com\n  #root /web/mysite.com\n  include /etc/nginx/conf.d/listen_plain.active;\n  include /etc/nginx/conf.d/listen_ssl.active;\n  server_name mysite.example.org;\n  server_tokens off;\n\n  # This allows acme to be validated even with a different web root\n  location ^~ /.well-known/acme-challenge/ {\n    default_type \"text/plain\";\n    rewrite /.well-known/acme-challenge/(.*) /$1 break;\n    root /web/.well-known/acme-challenge/;\n  }\n\n  if ($scheme = http) {\n    return 301 https://$server_name$request_uri;\n  }\n}\n</code></pre>","path":["U e nginx custom.en"],"tags":[]},{"location":"de/manual-guides/Nginx/u_e-nginx_custom.en/#new-site-with-proxy-to-a-remote-location","level":2,"title":"New site with proxy to a remote location","text":"<p>Another example with a reverse proxy configuration:</p> <pre><code>nano data/conf/nginx/my_custom_site.conf\n</code></pre> <pre><code>server {\n  ssl_certificate /etc/ssl/mail/cert.pem;\n  ssl_certificate_key /etc/ssl/mail/key.pem;\n  ssl_protocols TLSv1.2 TLSv1.3;\n  ssl_prefer_server_ciphers on;\n  ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305;\n  ssl_ecdh_curve X25519:X448:secp384r1:secp256k1;\n  ssl_session_cache shared:SSL:50m;\n  ssl_session_timeout 1d;\n  ssl_session_tickets off;\n  index index.php index.html;\n  client_max_body_size 0;\n  root /web;\n  include /etc/nginx/conf.d/listen_plain.active;\n  include /etc/nginx/conf.d/listen_ssl.active;\n  server_name example.domain.tld;\n  server_tokens off;\n\n  location ^~ /.well-known/acme-challenge/ {\n    allow all;\n    default_type \"text/plain\";\n  }\n\n  if ($scheme = http) {\n    return 301 https://$host$request_uri;\n  }\n\n  location / {\n    proxy_pass http://service:3000/;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    client_max_body_size 0;\n  }\n}\n</code></pre>","path":["U e nginx custom.en"],"tags":[]},{"location":"de/manual-guides/Nginx/u_e-nginx_custom.en/#config-expansion-in-mailcows-nginx","level":2,"title":"Config expansion in mailcows Nginx","text":"<p>The filename used for a new site is not important, as long as the filename carries a .conf extension.</p> <p>It is also possible to extend the configuration of the default file <code>site.conf</code> file:</p> <pre><code>nano data/conf/nginx/site.my_content.custom\n</code></pre> <p>This filename does not need to have a \".conf\" extension but follows the pattern <code>site.*.custom</code>, where <code>*</code> is a custom name.</p> <p>If PHP is to be included in a custom site, please use the PHP-FPM listener on phpfpm:9002 or create a new listener in <code>data/conf/phpfpm/php-fpm.d/pools.conf</code>.</p> <p>Restart Nginx (and PHP-FPM, if a new listener was created):</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart nginx-mailcow\ndocker compose restart php-fpm-mailcow\n</code></pre> <pre><code>docker-compose restart nginx-mailcow\ndocker-compose restart php-fpm-mailcow\n</code></pre>","path":["U e nginx custom.en"],"tags":[]},{"location":"de/manual-guides/Nginx/u_e-nginx_webmail-site.de/","level":1,"title":"U e nginx webmail site.de","text":"<p>WICHTIG: Diese Anleitung gilt nur für Konfigurationen, bei denen SNI nicht aktiviert ist. Wenn SNI aktiviert ist, muss der Zertifikatspfad angepasst werden. Etwas wie <code>ssl_certificate,key /etc/ssl/mail/webmail.example.org/cert.pem,key.pem;</code> wird genügen. Aber: Das Zertifikat sollte zuerst bezogen werden und erst wenn das Zertifikat existiert, sollte eine Site Config erstellt werden. Nginx wird nicht starten, wenn es das Zertifikat und den Schlüssel nicht finden kann.</p> <p>Um eine Subdomain <code>webmail.example.org</code> zu erstellen und sie auf SOGo umzuleiten, müssen Sie eine neue Nginx-Site erstellen. Achten Sie dabei auf \"CHANGE_TO_MAILCOW_HOSTNAME\"!</p> <p>nano data/conf/nginx/webmail.conf</p> <pre><code>server {\n  ssl_certificate /etc/ssl/mail/cert.pem;\n  ssl_certificate_key /etc/ssl/mail/key.pem;\n  index index.php index.html;\n  client_max_body_size 0;\n  root /web;\n  include /etc/nginx/conf.d/listen_plain.active;\n  include /etc/nginx/conf.d/listen_ssl.active;\n  server_name webmail.example.org;\n  server_tokens off;\n  location ^~ /.well-known/acme-challenge/ {\n    allow all;\n    default_type \"text/plain\";\n  }\n\n  location / {\n    return 301 https://CHANGE_TO_MAILCOW_HOSTNAME/SOGo;\n  }\n}\n</code></pre> <p>Speichern Sie und starten Sie Nginx neu: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose restart nginx-mailcow\n</code></pre> <p>Öffnen Sie nun <code>mailcow.conf</code> und suchen Sie <code>ADDITIONAL_SAN</code>. Fügen Sie <code>webmail.example.org</code> zu diesem Array hinzu, verwenden Sie keine Anführungszeichen!</p> <pre><code>ADDITIONAL_SAN=webmail.example.org\n</code></pre> <p>Führen Sie den Befehl aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Siehe \"acme-mailcow\" und \"nginx-mailcow\" Logs, wenn etwas fehlschlägt</p>","path":["U e nginx webmail site.de"],"tags":[]},{"location":"de/manual-guides/Nginx/u_e-nginx_webmail-site.en/","level":1,"title":"U e nginx webmail site.en","text":"<p>IMPORTANT: This guide only applies to non SNI enabled configurations. The certificate path needs to be adjusted if SNI is enabled. Something like <code>ssl_certificate,key /etc/ssl/mail/webmail.example.org/cert.pem,key.pem;</code> will do. But: The certificate should be acquired first and only after the certificate exists a site config should be created. Nginx will fail to start if it cannot find the certificate and key.</p> <p>To create a subdomain <code>webmail.example.org</code> and redirect it to SOGo, you need to create a new Nginx site. Take care of \"CHANGE_TO_MAILCOW_HOSTNAME\"!</p> <p>nano data/conf/nginx/webmail.conf</p> <pre><code>server {\n  ssl_certificate /etc/ssl/mail/cert.pem;\n  ssl_certificate_key /etc/ssl/mail/key.pem;\n  index index.php index.html;\n  client_max_body_size 0;\n  root /web;\n  include /etc/nginx/conf.d/listen_plain.active;\n  include /etc/nginx/conf.d/listen_ssl.active;\n  server_name webmail.example.org;\n  server_tokens off;\n  location ^~ /.well-known/acme-challenge/ {\n    allow all;\n    default_type \"text/plain\";\n  }\n\n  location / {\n    return 301 https://CHANGE_TO_MAILCOW_HOSTNAME/SOGo;\n  }\n}\n</code></pre> <p>Save and restart Nginx: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose restart nginx-mailcow\n</code></pre> <p>Now open <code>mailcow.conf</code> and find <code>ADDITIONAL_SAN</code>. Add <code>webmail.example.org</code> to this array, don't use quotes!</p> <pre><code>ADDITIONAL_SAN=webmail.example.org\n</code></pre> <p>Run the command to apply the changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>See \"acme-mailcow\" and \"nginx-mailcow\" logs if anything fails.</p>","path":["U e nginx webmail site.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-attachment_size.de/","level":1,"title":"U e postfix attachment size.de","text":"<p>Öffnen Sie <code>data/conf/postfix/extra.cf</code> und setzen Sie das <code>message_size_limit</code> entsprechend in Bytes. Siehe <code>main.cf</code> für den Standardwert.</p> <p>Sie müssen auch die Nachrichtengröße in den Konfigurationen von Rspamd und Clamav anpassen:</p> <ul> <li>in <code>data/conf/rspamd/local.d/options.inc</code> fügen Sie den <code>max_message</code> Parameter entsprechend den im Postfix gesetzten Wert hinzu. Ziehen Sie die Rspamd Docs für den Standardwert zu rate.</li> <li>in <code>data/conf/rspamd/local.d/external_services.conf</code> ändern Sie den Wert <code>max_size</code> Parameter für <code>oletools</code></li> <li>in <code>data/conf/rspamd/local.d/antivirus.conf</code> ändern Sie den Wert <code>max_size</code> Parameter für <code>clamav</code></li> <li>in <code>data/conf/clamav/clamd.conf</code> ändern Sie den Wert <code>MaxScanSize</code> und <code>MaxFileSize</code> auf dieselbe Größe wie in der Postfix <code>extra.cf</code></li> </ul> <p>Starten Sie Postfix, Rspamd and Clamav neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow rspamd-mailcow clamd-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow rspamd-mailcow clamd-mailcow\n</code></pre>","path":["U e postfix attachment size.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-attachment_size.en/","level":1,"title":"U e postfix attachment size.en","text":"<p>Open <code>data/conf/postfix/extra.cf</code> and set the <code>message_size_limit</code> accordingly in bytes. See <code>main.cf</code> for the default value.</p> <p>You will also need to adjust message size in Rspamd and Clamav configurations:</p> <ul> <li>in <code>data/conf/rspamd/local.d/options.inc</code> add <code>max_message</code> parameter, check Rspamd Docs for defaults</li> <li>in <code>data/conf/rspamd/local.d/external_services.conf</code> adjust <code>max_size</code> parameter for <code>oletools</code></li> <li>in <code>data/conf/rspamd/local.d/antivirus.conf</code> adjust <code>max_size</code> parameter for <code>clamav</code></li> <li>in <code>data/conf/clamav/clamd.conf</code> adjust <code>MaxScanSize</code> and <code>MaxFileSize</code></li> </ul> <p>Restart Postfix, Rspamd and Clamav:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow rspamd-mailcow clamd-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow rspamd-mailcow clamd-mailcow\n</code></pre>","path":["U e postfix attachment size.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-custom_transport.de/","level":1,"title":"U e postfix custom transport.de","text":"<p>Für Transport maps, die nicht in mailcow UI konfiguriert werden, verwenden Sie bitte <code>data/conf/postfix/custom_transport.pcre</code>, um zu verhindern, dass bestehende Maps oder Einstellungen durch Updates überschrieben werden.</p> <p>In den meisten Fällen ist die Verwendung dieser Datei nicht notwendig. Bitte vergewissern Sie sich, dass mailcow UI nicht in der Lage ist, den gewünschten Datenverkehr richtig zu routen, bevor Sie diese Datei verwenden.</p> <p>Die Datei benötigt gültigen PCRE-Inhalt und kann Postfix zerstören, wenn sie falsch konfiguriert ist.</p>","path":["U e postfix custom transport.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-custom_transport.en/","level":1,"title":"U e postfix custom transport.en","text":"<p>For transport maps other than those to be configured in mailcow UI, please use <code>data/conf/postfix/custom_transport.pcre</code> to prevent existing maps or settings from being overwritten by updates.</p> <p>In most cases using this file is not necessary. Please make sure mailcow UI is not able to route your desired traffic properly before using that file.</p> <p>The file needs valid PCRE content and can break Postfix, if configured incorrectly.</p>","path":["U e postfix custom transport.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-disable_sender_verification.de/","level":1,"title":"U e postfix disable sender verification.de","text":"","path":["U e postfix disable sender verification.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-disable_sender_verification.de/#neue-anleitung","level":2,"title":"Neue Anleitung","text":"<p>Bearbeiten Sie ein Postfach und wählen Sie \"Senden als * zulassen\".</p> <p>Aus historischen Gründen haben wir die alte und veraltete Anleitung unten beibehalten:</p>","path":["U e postfix disable sender verification.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-disable_sender_verification.de/#veraltete-anleitung-nicht-fur-neuere-mailcows-verwenden","level":2,"title":"Veraltete Anleitung (NICHT FÜR NEUERE MAILCOWS VERWENDEN!)","text":"<p>Diese Option ist keine Best-Practice und sollte nur verwendet werden, wenn es keine andere Möglichkeit gibt, das zu erreichen, was Sie erreichen wollen.</p> <p>Erstellen Sie einfach eine Datei <code>data/conf/postfix/check_sasl_access</code> und tragen Sie den folgenden Inhalt ein. Dieser Benutzer muss in Ihrer Installation existieren und muss sich vor dem Versenden von Mails authentifizieren. <pre><code>user-to-allow-everything@example.com OK\n</code></pre></p> <p>Öffnen Sie <code>data/conf/postfix/main.cf</code> und suchen Sie <code>smtpd_sender_restrictions</code>. Fügen Sie <code>check_sasl_access hash:/opt/postfix/conf/check_sasl_access</code> wie folgt ein: <pre><code>smtpd_sender_restrictions = check_sasl_access hash:/opt/postfix/conf/check_sasl_access reject_authenticated_sender_login_mismatch [...]\n</code></pre></p> <p>Postmap auf check_sasl_access ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec postfix-mailcow postmap /opt/postfix/conf/check_sasl_access\n</code></pre> <pre><code>docker-compose exec postfix-mailcow postmap /opt/postfix/conf/check_sasl_access\n</code></pre> <p>Starten Sie den Postfix-Container neu.</p>","path":["U e postfix disable sender verification.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-disable_sender_verification.en/","level":1,"title":"U e postfix disable sender verification.en","text":"","path":["U e postfix disable sender verification.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-disable_sender_verification.en/#new-guide","level":2,"title":"New guide","text":"<p>Edit a mailbox and select \"Allow to send as *\".</p> <p>For historical reasons we kept the old and deprecated guide below:</p>","path":["U e postfix disable sender verification.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-disable_sender_verification.en/#deprecated-guide-do-not-use-on-newer-mailcows","level":2,"title":"Deprecated guide (DO NOT USE ON NEWER MAILCOWS!)","text":"<p>This option is not best-practice and should only be implemented when there is no other option available to achieve whatever you are trying to do.</p> <p>Simply create a file <code>data/conf/postfix/check_sasl_access</code> and enter the following content. This user must exist in your installation and needs to authenticate before sending mail. <pre><code>user-to-allow-everything@example.com OK\n</code></pre></p> <p>Open <code>data/conf/postfix/main.cf</code> and find <code>smtpd_sender_restrictions</code>. Prepend <code>check_sasl_access hash:/opt/postfix/conf/check_sasl_access</code> like this: <pre><code>smtpd_sender_restrictions = check_sasl_access hash:/opt/postfix/conf/check_sasl_access reject_authenticated_sender_login_mismatch [...]\n</code></pre></p> <p>Run postmap on check_sasl_access:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec postfix-mailcow postmap /opt/postfix/conf/check_sasl_access\n</code></pre> <pre><code>docker-compose exec postfix-mailcow postmap /opt/postfix/conf/check_sasl_access\n</code></pre> <p>Restart the Postfix container.</p>","path":["U e postfix disable sender verification.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-extra_cf.de/","level":1,"title":"U e postfix extra cf.de","text":"<p>Bitte erstellen Sie eine neue Datei <code>data/conf/postfix/extra.cf</code> für Überschreibungen oder zusätzliche Inhalte zur <code>main.cf</code>.</p> <p>Postfix wird sich einmal nach dem Start von postfix-mailcow über doppelte Werte beschweren, dies ist beabsichtigt.</p> <p>Syslog-ng wurde so konfiguriert, dass es diese Warnungen ausblendet, während Postfix läuft, um die Log-Dateien nicht jedes Mal mit unnötigen Informationen zu spammen, wenn ein Dienst benutzt wird.</p> <p>Starten Sie <code>postfix-mailcow</code> neu, um Ihre Änderungen zu übernehmen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow\n</code></pre>","path":["U e postfix extra cf.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-extra_cf.en/","level":1,"title":"U e postfix extra cf.en","text":"<p>Please create a new file <code>data/conf/postfix/extra.cf</code> for overrides or additional content to <code>main.cf</code>.</p> <p>Postfix will complain about duplicate values once after starting <code>postfix-mailcow</code>, this is intended.</p> <p>Syslog-ng was configured to hide those warnings while Postfix is running, to not spam the log files with unnecessary information every time a service is used.</p> <p>Restart <code>postfix-mailcow</code> to apply your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow\n</code></pre>","path":["U e postfix extra cf.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-harden_ciphers.de/","level":1,"title":"U e postfix harden ciphers.de","text":"<p>Wenn Sie die Standard-Cipher und TLS-Versionen, die in Postfix akzeptiert werden, entsprechend der aktuellen Version auf stärkere Einstellungen ändern möchten, können Sie Folgendes zu Postfix extra.cf hinzufügen:</p> <pre><code>tls_high_cipherlist = ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256\ntls_preempt_cipherlist = yes\n\nsmtp_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1\nsmtp_tls_ciphers = high\nsmtp_tls_mandatory_ciphers = high\n\nsmtpd_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1\nsmtpd_tls_ciphers = high\nsmtpd_tls_mandatory_ciphers = high\n</code></pre> <p>Eine solche Konfiguration wird die aktuellen (2024-10-21) Konfigurationsprüfungen bei Diensten wie Internet.nl bestehen.</p> <p>Falls Sie auch die Cipher für Dovecot anpassen wollen finden Sie hier eine entsprechende Anleitung.</p>","path":["U e postfix harden ciphers.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-harden_ciphers.en/","level":1,"title":"U e postfix harden ciphers.en","text":"<p>If you want to change the default ciphers and TLS versions accepted in postfix as per it's current release to something stronger, you could add following inside Postfix extra.cf:</p> <pre><code>tls_high_cipherlist = ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256\ntls_preempt_cipherlist = yes\n\nsmtp_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1\nsmtp_tls_ciphers = high\nsmtp_tls_mandatory_ciphers = high\n\nsmtpd_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1\nsmtpd_tls_ciphers = high\nsmtpd_tls_mandatory_ciphers = high\n</code></pre> <p>Such a configuration will pass current (2024-10-21) configuration checks against services like Internet.nl.</p> <p>If you want to adjust the ciphers for Dovecot as well you can find the corresponding tutorial here.</p>","path":["U e postfix harden ciphers.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-pflogsumm.de/","level":1,"title":"U e postfix pflogsumm.de","text":"<p>Um pflogsumm mit dem Standard-Logging-Treiber zu verwenden, müssen wir postfix-mailcow über docker logs abfragen und die Ausgabe zu pflogsumm leiten:</p> <pre><code>docker logs --since 24h $(docker ps -qf name=postfix-mailcow) | pflogsumm\n</code></pre> <p>Die obige Log-Ausgabe ist auf die letzten 24 Stunden beschränkt.</p> <p>Es ist auch möglich, einen täglichen pflogsumm-Bericht über cron zu erstellen. Erstellen Sie die Datei /etc/cron.d/pflogsumm mit dem folgenden Inhalt:</p> <pre><code>SHELL=/bin/bash\n59 23 * * * root docker logs --since 24h $(docker ps -qf name=postfix-mailcow) | /usr/sbin/pflogsumm -d today | mail -s \"Postfix Report of $(date)\" postmaster@example.net\n</code></pre> <p>Um zu funktionieren muss ein lokaler Postfix auf dem Server installiert werden, welcher an den Postfix der mailcow relayed.</p> <p>Frage</p> <p>Genauere Informationen lassen sich unter Sektion Post-Installationsaufgaben -&gt; Lokaler MTA auf Dockerhost finden.</p> <p>Basierend auf den Postfix-Logs der letzten 24 Stunden sendet dieses Beispiel dann jeden Tag um 23:59:00 Uhr einen pflogsumm-Bericht an postmaster@example.net.</p>","path":["U e postfix pflogsumm.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-pflogsumm.en/","level":1,"title":"U e postfix pflogsumm.en","text":"<p>To use pflogsumm with the default logging driver, we need to query postfix-mailcow via docker logs and direct the output to pflogsumm:</p> <pre><code>docker logs --since 24h $(docker ps -qf name=postfix-mailcow) | pflogsumm\n</code></pre> <p>The above log output is limited to the last 24 hours.</p> <p>It is also possible to create a daily pflogsumm report via cron. Create the /etc/cron.d/pflogsumm file with the following content:</p> <pre><code>SHELL=/bin/bash\n59 23 * * * root docker logs --since 24h $(docker ps -qf name=postfix-mailcow) | /usr/sbin/pflogsumm -d today | mail -s \"Postfix Report of $(date)\" postmaster@example.net\n</code></pre> <p>To work, a local postfix must be installed on the server, which relays to the mailcow postfix.</p> <p>Question</p> <p>More detailed information can be found in section Post installation tasks -&gt; Local MTA on Dockerhost.</p> <p>Based on the postfix logs of the last 24 hours, this example then sends a pflogsumm report to postmaster@example.net every day at 23:59:00.</p>","path":["U e postfix pflogsumm.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-postscreen_whitelist.de/","level":1,"title":"U e postfix postscreen whitelist.de","text":"<p>IPs können in der Datei <code>data/conf/postfix/custom_postscreen_whitelist.cidr</code> aus dem Postscreen und damit auch aus den RBL-Prüfungen entfernt werden.</p> <p>Postscreen führt mehrere Prüfungen durch, um bösartige Absender zu identifizieren. In den meisten Fällen möchten Sie eine IP-Adresse auf die Whitelist setzen, um sie von der Suche nach einer Blacklist auszuschließen.</p> <p>Das Format der Datei ist wie folgt</p> <p><code>CIDR ACTION</code></p> <p>Dabei steht CIDR für eine einzelne IP-Adresse oder einen IP-Bereich in CIDR-Notation und action entweder für \"permit\" oder \"reject\".</p> <p>Beispiel:</p> <pre><code># Regeln werden in der angegebenen Reihenfolge ausgewertet.\n# Blacklist 192.168.* außer 192.168.0.1.\n192.168.0.1 permit\n192.168.0.0/16 reject\n</code></pre> <p>Die Datei wird spontan neu geladen, ein Neustart von Postfix ist nicht erforderlich.</p>","path":["U e postfix postscreen whitelist.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-postscreen_whitelist.en/","level":1,"title":"U e postfix postscreen whitelist.en","text":"<p>IPs can be removed from Postscreen and therefore also from RBL checks in <code>data/conf/postfix/custom_postscreen_whitelist.cidr</code>.</p> <p>Postscreen does multiple checks to identify malicious senders. In most cases you want to whitelist an IP to exclude it from blacklist lookups.</p> <p>The format of the file is as follows:</p> <p><code>CIDR   ACTION</code></p> <p>Where CIDR is a single IP address or IP range in CIDR notation, and action is either \"permit\" or \"reject\".</p> <p>Example:</p> <pre><code># Rules are evaluated in the order as specified.\n# Blacklist 192.168.* except 192.168.0.1.\n192.168.0.1          permit\n192.168.0.0/16       reject\n</code></pre> <p>The file is reloaded on the fly, postfix restart is not required.</p>","path":["U e postfix postscreen whitelist.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-relayhost.de/","level":1,"title":"U e postfix relayhost.de","text":"<p>Seit dem 12. September 2018 können Sie Relayhosts als Admin über die mailcow UI einrichten.</p> <p>Dies ist nützlich, wenn Sie ausgehende E-Mails für eine bestimmte Domain an einen Drittanbieter-Spamfilter oder einen Dienst wie Mailgun oder Sendgrid weiterleiten möchten. Dies ist auch bekannt als ein smarthost. Falls nicht, überprüfen Sie den Fehler und beheben Sie ihn.</p>","path":["U e postfix relayhost.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-relayhost.de/#einen-neuen-relayhost-hinzufugen","level":2,"title":"Einen neuen Relayhost hinzufügen","text":"<p>Gehen Sie auf die Registerkarte \"Routing\" im Abschnitt \"Konfiguration und Details\" der mailcow UI. Hier sehen Sie eine Liste der derzeit eingerichteten Relayhosts.</p> <p>Blättern Sie zum Abschnitt \"Absenderabhängigen Transport hinzufügen\".</p> <p>Fügen Sie unter <code>Host</code> den Host hinzu, an den Sie weiterleiten möchten. Beispiel: Wenn Sie Mailgun zum Senden von E-Mails anstelle Ihrer Server-IP verwenden möchten, geben Sie smtp.mailgun.org ein.</p> <p>Wenn der Relay-Host zur Authentifizierung einen Benutzernamen und ein Passwort benötigt, geben Sie diese in die entsprechenden Felder ein. Beachten Sie, dass die Anmeldedaten im Klartext gespeichert werden.</p>","path":["U e postfix relayhost.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-relayhost.de/#testen-sie-einen-relayhost","level":3,"title":"Testen Sie einen Relayhost","text":"<p>Um zu testen, ob die Verbindung zum Host funktioniert, klicken Sie in der Liste der Relayhosts auf <code>Test</code> und geben Sie eine Von:-Adresse ein. Führen Sie dann den Test aus.</p> <p>Sie sehen dann die Ergebnisse der SMTP-Übertragung. Wenn alles klappt, sollten Sie Folgendes sehen: <code>SERVER -&gt; CLIENT: 250 2.0.0 Ok: queued as A093B401D4</code> als eine der letzten Zeilen.</p> <p>Ist dies nicht der Fall, überprüfen Sie den angegebenen Fehler und beheben Sie ihn.</p> <p>Hinweis: Einige Hosts, insbesondere solche, die keine Authentifizierung verlangen, verweigern Verbindungen von Servern, die nicht zuvor in ihr System aufgenommen wurden. Lesen Sie unbedingt die Dokumentation des Relayhosts, um sicherzustellen, dass Sie Ihre Domain und/oder die Server-IP zu ihrem System hinzugefügt haben.</p> <p>Tipp: Sie können die standardmäßige Von:-Adresse, die der Test verwendet, von null@mailcow.email auf eine beliebige E-Mail-Adresse ändern, indem Sie die Variable $RELAY_TO in der Datei vars.inc.php unter /opt/mailcow-dockerized/data/web/inc ändern.  Auf diese Weise können Sie überprüfen, ob das Relay funktioniert hat, indem Sie das Zielpostfach überprüfen.</p>","path":["U e postfix relayhost.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-relayhost.de/#relayhost-fur-eine-domain-festlegen","level":2,"title":"Relayhost für eine Domain festlegen","text":"<p>Wechseln Sie auf die Registerkarte \"Domains\" im Abschnitt \"E-Mail-Setup\" der mailcow UI.</p> <p>Bearbeiten Sie die gewünschte Domain.</p> <p>Wählen Sie den neu hinzugefügten Host in der Dropdown-Liste \"Absenderabhängige Transporte\" aus und speichern Sie die Änderungen.</p> <p>Senden Sie eine E-Mail von einer Mailbox auf dieser Domain und Sie sollten in den Protokollen sehen, dass Postfix die Nachricht an den Relayhost weiterleitet.</p>","path":["U e postfix relayhost.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-relayhost.en/","level":1,"title":"U e postfix relayhost.en","text":"<p>As of September 12, 2018 you can setup relayhosts as admin by using the mailcow UI.</p> <p>This is useful if you want to relay outgoing emails for a specific domain to a third-party spam filter or a service like Mailgun or Sendgrid. This is also known as a smarthost.</p>","path":["U e postfix relayhost.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-relayhost.en/#add-a-new-relayhost","level":2,"title":"Add a new relayhost","text":"<p>Go to the <code>Routing</code> tab of the <code>Configuration and Details</code> section of the admin UI. Here you will see a list of relayhosts currently setup.</p> <p>Scroll to the <code>Add sender-dependent transport</code> section.</p> <p>Under <code>Host</code>, add the host you want to relay to.  Example: if you want to use Mailgun to send emails instead of your server IP, enter smtp.mailgun.org</p> <p>If the relay host requires a username and password to authenticate, enter them in the respective fields.  Keep in mind the credentials will be stored in plain text.</p>","path":["U e postfix relayhost.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-relayhost.en/#test-a-relayhost","level":3,"title":"Test a relayhost","text":"<p>To test that connectivity to the host works, click on <code>Test</code> from the list of relayhosts and enter a From: address. Then, run the test.</p> <p>You will then see the results of the SMTP transmission. If all went well, you should see <code>SERVER -&gt; CLIENT: 250 2.0.0 Ok: queued as A093B401D4</code> as one of the last lines.</p> <p>If not, review the error provided and resolve it.</p> <p>Note: Some hosts, especially those who do not require authentication, will deny connections from servers that have not been added to their system beforehand. Make sure you read the documentation of the relayhost to make sure you've added your domain and/or the server IP to their system.</p> <p>Tip: You can change the default test To: address the test uses from null@mailcow.email to any email address you choose by modifying the $RELAY_TO variable on the vars.inc.php file under /opt/mailcow-dockerized/data/web/inc  This way you can check that the relay worked by checking the destination mailbox.</p>","path":["U e postfix relayhost.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-relayhost.en/#set-the-relayhost-for-a-domain","level":2,"title":"Set the relayhost for a domain","text":"<p>Go to the <code>Domains</code> tab of the <code>Mail setup</code> section of the admin UI.</p> <p>Edit the desired domain.</p> <p>Select the newly added host on the <code>Sender-dependent transports</code> dropdown and save changes.</p> <p>Send an email from a mailbox on that domain and you should see postfix handing the message over to the relayhost in the logs.</p>","path":["U e postfix relayhost.en"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-unauthenticated-relaying.de/","level":1,"title":"U e postfix unauthenticated relaying.de","text":"<p>Standardmäßig betrachtet mailcow's Postfix alle Netzwerke als nicht vertrauenswürdig, ausgenommen seine eigenen IPV4_NETWORK und IPV6_NETWORK Bereiche, die in <code>mailcow.conf</code> festgelegt sind. Obwohl dies in den meisten Fällen vernünftig ist, kann es Umstände geben, unter denen Sie einen Host oder ein Subnetz als unauthentifizierten Relayer hinzufügen möchten.</p> <p>Standardmäßig verwendet mailcow <code>mynetworks_style = subnet</code> um interne Subnetze zu bestimmen und lässt <code>mynetworks</code> unkonfiguriert.</p> <p>Wenn Sie sich entscheiden, <code>mynetworks</code> selbständig in der <code>extra.conf</code> von Postfix zu setzen, ignoriert Postfix die mynetworks_style Einstellung. Das bedeutet, dass Sie die von mailcow intern benutzen IPv4- und IPv6-Adressen (in der <code>mailcow.conf</code> angegeben als IPV4_NETWORK bzw. IPV6_NETWORK), sowie die Loopback-Subnetze manuell hinzufügen müssen!</p> <p>Erläuterung</p> <p>Die Einstellung <code>mynetworks</code> erlaubt es eingetragenen Hosts bzw. Subnets OHNE Authentifizierung E-Mails an den Postfix MTA zu schicken. Insbesondere dann praktisch, wenn bspw. Monitoring E-Mails von Linux Servern im selben Netzwerk ohne extra Authentifizierung verschickt werden sollen.</p> <p>Achtung</p> <p>Eine falsche Einstellung von <code>mynetworks</code> erlaubt es Ihrem Server, als offenes Relay verwendet zu werden. Wenn dies missbraucht wird, beeinträchtigt dies Ihre Fähigkeit, E-Mails zu versenden, und es kann einige Zeit dauern, bis dies abgeklungen ist.</p> <p>Beispiel</p> <p>Als Beispiel nehmen wir das Subnetz <code>192.168.2.0/24</code>, welches wir unauthentifiziert Relayen lassen wollen.</p> <p>Bearbeiten Sie <code>data/conf/postfix/extra.cf</code>:</p> <pre><code>mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 [fe80::]/10 172.22.1.0/24 [fd4d:6169:6c63:6f77::]/64 192.168.2.0/24\n</code></pre> <p>Bearbeiten Sie zusätzlich noch <code>data/conf/rspamd/local.d/options.inc</code>:</p> <pre><code>local_addrs = [127.0.0.0/8, ::ffff:127.0.0.0/104, ::1/128, fe80::/10, 172.22.1.0/24, fd4d:6169:6c63:6f77::/64, 192.168.2.0/24];\n</code></pre> <p>Vorsicht</p> <p>Die Subnetze vor unserem angehangenen Beispiel Subnetz MÜSSEN vor oder nach den eigens eingetragenen Werten stehen, da sonst einige mailcow Komponenten wie bspw. der Watchdog oder einige Sieve Filter (wie bspw. Abwesenheitsagenten) nicht funktionieren und Fehler beim Betriebsablauf entstehen.</p> <p>Führen Sie nach Ihren Änderungen folgenden Befehl aus aus, um Ihre neuen Einstellungen zu übernehmen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow rspamd-mailcow\n</code></pre> <p>Gut zu wissen!</p> <p>IPv6 Adressen MÜSSEN in diesem Fall mit <code>[]</code> (Eckigen Klammern) als <code>mynetworks</code> Parameter eingetragen werden, da diese sonst nicht verarbeitet werden können.</p> <p>Info</p> <p>Weitere Informationen über mynetworks finden Sie in der Postfix-Dokumentation.</p>","path":["U e postfix unauthenticated relaying.de"],"tags":[]},{"location":"de/manual-guides/Postfix/u_e-postfix-unauthenticated-relaying.en/","level":1,"title":"U e postfix unauthenticated relaying.en","text":"<p>By default, mailcow's postfix considers all networks untrusted except its own IPV4_NETWORK and IPV6_NETWORK ranges, which are specified in <code>mailcow.conf</code>. Although this is reasonable in most cases, there may be circumstances where you want to add a host or subnet as an unauthenticated relayer.</p> <p>By default, mailcow uses <code>mynetworks_style = subnet</code> to specify internal subnets and leaves <code>mynetworks</code> unconfigured.</p> <p>If you decide to set <code>mynetworks</code> independently in Postfix's <code>extra.conf</code>, Postfix will ignore the mynetworks_style setting. This means that you will have to add the IPv4 and IPv6 addresses used internally by mailcow (specified in <code>mailcow.conf</code> as IPV4_NETWORK and IPV6_NETWORK respectively), as well as the loopback subnets manually!</p> <p>Explanation</p> <p>The setting <code>mynetworks</code> allows registered hosts or subnets to send e-mails to the Postfix MTA WITHOUT authentication. This is especially useful if monitoring e-mails are to be sent from Linux servers in the same network without extra authentication.</p> <p>Danger</p> <p>A wrong setting of <code>mynetworks</code> allows your server to be used as an open relay. If this is abused, it will impair your ability to send email and it may take some time for this to subside.</p> <p>Example</p> <p>As an example, let's take the subnet <code>192.168.2.0/24</code>, which we want to relay unauthenticated.</p> <p>Edit <code>data/conf/postfix/extra.cf</code>:</p> <pre><code>mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 [fe80::]/10 172.22.1.0/24 [fd4d:6169:6c63:6f77::]/64 192.168.2.0/24\n</code></pre> <p>Edit <code>data/conf/rspamd/local.d/options.inc</code> aswell:</p> <pre><code>local_addrs = [127.0.0.0/8, ::ffff:127.0.0.0/104, ::1/128, fe80::/10, 172.22.1.0/24, fd4d:6169:6c63:6f77::/64, 192.168.2.0/24];\n</code></pre> <p>Warning</p> <p>The subnets before our attached example subnet MUST exists before or after your entered values. Otherwise some mailcow components such as Watchdog or some Sieve Filters (such as Absence Agents) will not work and errors will occur during operation.</p> <p>Run the following command to apply your new settings:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow rspamd-mailcow\n</code></pre> <p>Good to know!</p> <p>IPv6 addresses MUST be entered with <code>[]</code> (square brackets) as <code>mynetworks</code> parameters in this case. Otherwise they cannot be processed.</p> <p>Info</p> <p>More information about mynetworks can be found in the Postfix documentation.</p>","path":["U e postfix unauthenticated relaying.en"],"tags":[]},{"location":"de/manual-guides/Redis/u_e-redis.de/","level":1,"title":"U e redis.de","text":"<p>Redis wird als Key-Value-Speicher für die Einstellungen und Daten von rspamd und (einige von) mailcow verwendet. Wenn Sie mit Redis nicht vertraut sind, lesen Sie bitte die Einführung in Redis und besuchen Sie gegebenenfalls diese wunderbare Anleitung, um zu erfahren, wie man Redis benutzt.</p>","path":["U e redis.de"],"tags":[]},{"location":"de/manual-guides/Redis/u_e-redis.de/#client","level":2,"title":"Client","text":"<p>Um sich mit dem redis cli zu verbinden, führen Sie aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli\n</code></pre>","path":["U e redis.de"],"tags":[]},{"location":"de/manual-guides/Redis/u_e-redis.de/#fehlersuche","level":3,"title":"Fehlersuche","text":"<p>Hier sind einige nützliche Befehle für den redis-cli zur Fehlersuche:</p>","path":["U e redis.de"],"tags":[]},{"location":"de/manual-guides/Redis/u_e-redis.de/#monitor","level":5,"title":"MONITOR","text":"<p>Überwacht alle vom Server empfangenen Anfragen in Echtzeit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>#docker compose exec redis-mailcow redis-cli\n127.0.0.1:6379&gt; monitor\nOK\n1494077286.401963 [0 172.22.1.253:41228] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n1494077288.292970 [0 172.22.1.253:41229] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n[...]\n</code></pre> <pre><code>#docker-compose exec redis-mailcow redis-cli\n127.0.0.1:6379&gt; monitor\nOK\n1494077286.401963 [0 172.22.1.253:41228] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n1494077288.292970 [0 172.22.1.253:41229] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n[...]\n</code></pre>","path":["U e redis.de"],"tags":[]},{"location":"de/manual-guides/Redis/u_e-redis.de/#schlussel-keys","level":5,"title":"SCHLÜSSEL (Keys)","text":"<p>Ermittelt alle Schlüssel, die dem Muster entsprechen:</p> <pre><code>KEYS *\n</code></pre>","path":["U e redis.de"],"tags":[]},{"location":"de/manual-guides/Redis/u_e-redis.de/#ping","level":5,"title":"PING","text":"<p>Testen Sie eine Verbindung:</p> <pre><code>127.0.0.1:6379&gt; PING\nPONG\n</code></pre> <p>Wenn Sie mehr wissen wollen, hier ist ein Cheat-Sheet.</p>","path":["U e redis.de"],"tags":[]},{"location":"de/manual-guides/Redis/u_e-redis.en/","level":1,"title":"U e redis.en","text":"<p>Redis is used as a key-value store for rspamd's and (some of) mailcow's settings and data. If you are unfamiliar with redis please read the introduction to redis and maybe visit this wonderful guide on how to use it.</p>","path":["U e redis.en"],"tags":[]},{"location":"de/manual-guides/Redis/u_e-redis.en/#client","level":2,"title":"Client","text":"<p>To connect to the redis cli execute:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli\n</code></pre>","path":["U e redis.en"],"tags":[]},{"location":"de/manual-guides/Redis/u_e-redis.en/#debugging","level":3,"title":"Debugging","text":"<p>Here are some useful commands for the redis-cli for debugging:</p>","path":["U e redis.en"],"tags":[]},{"location":"de/manual-guides/Redis/u_e-redis.en/#monitor","level":5,"title":"MONITOR","text":"<p>Listens for all requests received by the server in real time:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>#docker compose exec redis-mailcow redis-cli\n127.0.0.1:6379&gt; monitor\nOK\n1494077286.401963 [0 172.22.1.253:41228] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n1494077288.292970 [0 172.22.1.253:41229] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n[...]\n</code></pre> <pre><code>#docker-compose exec redis-mailcow redis-cli\n127.0.0.1:6379&gt; monitor\nOK\n1494077286.401963 [0 172.22.1.253:41228] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n1494077288.292970 [0 172.22.1.253:41229] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n[...]\n</code></pre>","path":["U e redis.en"],"tags":[]},{"location":"de/manual-guides/Redis/u_e-redis.en/#keys","level":5,"title":"KEYS","text":"<p>Get all keys matching your pattern:</p> <pre><code>KEYS *\n</code></pre>","path":["U e redis.en"],"tags":[]},{"location":"de/manual-guides/Redis/u_e-redis.en/#ping","level":5,"title":"PING","text":"<p>Test a connection:</p> <pre><code>127.0.0.1:6379&gt; PING\nPONG\n</code></pre> <p>If you want to know more, here is a cheat sheet.</p>","path":["U e redis.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-add-additional-modules.de/","level":1,"title":"U e rspamd add additional modules.de","text":"<p>Laden Sie das Modul herunter und speichern Sie es in folgenden Pfad ab: <code>data/conf/rspamd/plugins.d/</code>.</p> <p>Danach müssen Sie die Konfigurationsparameter des Modules in <code>data/conf/rspamd/rspamd.conf.local</code> hinzufügen. Falls das Modul <code>my_plugin.lua</code> heißt, sollte die Datei wie folgt aussehen:</p> <pre><code># rspamd.conf.local\nmy_plugin {\n    some_setting = \"some value\";\n}\n</code></pre> <p>Falls Ihr Modul keine zusätzlichen Konfigurationen benötigt, reicht es aus einen leeren Konfigurationsblock hinzuzufügen. Wie im folgenden Beispiel zu sehen:</p> <pre><code># rspamd.conf.local\nmy_plugin { }\n</code></pre> <p>Falls Sie keinen Konfigurationsblock hinzufügen, dann wird das Modul automatisch deaktiviert und im Logfile des rspamd-mailcow Containers sehen Sie folgende Nachricht:</p> <pre><code>mailcowdockerized-rspamd-mailcow-1  | 2023-05-20 14:01:32 #1(main) &lt;sh6j9z&gt;; cfg; rspamd_config_is_module_enabled: lua module my_plugin is enabled but has not been configured\nmailcowdockerized-rspamd-mailcow-1  | 2023-05-20 14:01:32 #1(main) &lt;sh6j9z&gt;; cfg; rspamd_config_is_module_enabled: my_plugin disabling unconfigured lua module\n</code></pre> <p>Falls Sie das Modul erfolgreich konfiguiert haben, dann sollte das Logfile des rspamd-mailcow Containers wie folgt aussehen:</p> <pre><code>mailcowdockerized-rspamd-mailcow-1  | 2023-05-20 14:04:50 #1(main) &lt;8ayxpf&gt;; cfg; rspamd_init_lua_filters: init lua module my_plugin from /etc/rspamd/plugins.d//my_plugin.lua; digest: 5cb88961e5\n</code></pre>","path":["U e rspamd add additional modules.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-add-additional-modules.en/","level":1,"title":"U e rspamd add additional modules.en","text":"<p>Download the module and save it in the following path: <code>data/conf/rspamd/plugins.d/</code>.</p> <p>Next, add any necessary configuration for your module to <code>data/conf/rspamd/rspamd.conf.local</code>. \\ If you have a module named <code>my_plugin.lua</code>, configuration might look like the following:</p> <pre><code># rspamd.conf.local\nmy_plugin {\n    some_setting = \"some value\";\n}\n</code></pre> <p>If your module does not require any additional configuration, simply add an empty configuration block, for example:</p> <pre><code># rspamd.conf.local\nmy_plugin { }\n</code></pre> <p>If you do not add a configuration block, the module will be automatically disabled, and the rspamd-mailcow container log will contain a message such as:</p> <pre><code>mailcowdockerized-rspamd-mailcow-1  | 2023-05-20 14:01:32 #1(main) &lt;sh6j9z&gt;; cfg; rspamd_config_is_module_enabled: lua module my_plugin is enabled but has not been configured\nmailcowdockerized-rspamd-mailcow-1  | 2023-05-20 14:01:32 #1(main) &lt;sh6j9z&gt;; cfg; rspamd_config_is_module_enabled: my_plugin disabling unconfigured lua module\n</code></pre> <p>If you have successfully configured your module, the rspamd-mailcow container logs should show:</p> <pre><code>mailcowdockerized-rspamd-mailcow-1  | 2023-05-20 14:04:50 #1(main) &lt;8ayxpf&gt;; cfg; rspamd_init_lua_filters: init lua module my_plugin from /etc/rspamd/plugins.d//my_plugin.lua; digest: 5cb88961e5\n</code></pre>","path":["U e rspamd add additional modules.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-tweaks.de/","level":1,"title":"U e rspamd tweaks.de","text":"","path":["U e rspamd tweaks.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-tweaks.de/#spamfilter-schwellenwerte-global","level":2,"title":"Spamfilter-Schwellenwerte (global)","text":"<p>Jeder Benutzer kann seine Spam-Bewertung individuell ändern. </p> <p>Um eine neue serverweite Grenze zu definieren, editieren Sie <code>data/conf/rspamd/local.d/actions.conf</code>:</p> <pre><code>reject = 15;\nadd_header = 8;\ngreylist = 7;\n</code></pre> <p>Speichern Sie die Datei und starten Sie \"rspamd-mailcow\" neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Achtung</p> <p>Bestehende Einstellungen der Benutzer werden nicht überschrieben!</p> <p>Um benutzerdefinierte Schwellenwerte zurückzusetzen, führen Sie aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf\ndocker compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel';\"\n# oder:\ndocker compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel' and object = 'only-this-mailbox@example.org';\"\n</code></pre> <pre><code>source mailcow.conf\ndocker-compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel';\"\n# oder:\ndocker-compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel' and object = 'only-this-mailbox@example.org';\"\n</code></pre>","path":["U e rspamd tweaks.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-tweaks.de/#benutzerdefinierte-ablehnungsnachrichten","level":2,"title":"Benutzerdefinierte Ablehnungsnachrichten","text":"<p>Die Standard-Spam-Reject-Meldung kann durch Hinzufügen einer neuen Datei <code>data/conf/rspamd/override.d/worker-proxy.custom.inc</code> mit dem folgenden Inhalt geändert werden:</p> <pre><code>reject_message = \"Meine eigene Ablehnungsnachricht\";\n</code></pre> <p>Speichern Sie die Datei und starten Sie Rspamd neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Während das oben genannte für abgelehnte Mails mit einem hohen Spam-Score funktioniert, ignorieren Prefilter-Aktionen diese Einstellung. Für diese muss das Multimap-Modul in Rspamd angepasst werden:</p> <ol> <li> <p>Finden Sie das Prefilet-Reject-Symbol, für das Sie die Nachricht ändern wollen, führen Sie dazu aus: <code>grep -R \"SYMBOL_WELCHES_ANGEPASST_WERDEN_SOLL\" /opt/mailcow-dockerized/data/conf/rspamd/</code></p> </li> <li> <p>Fügen Sie Ihre eigene Nachricht als neue Zeile hinzu:</p> <pre><code>GLOBAL_RCPT_BL {\nTyp = \"rcpt\";\nmap = \"${LOCAL_CONFDIR}/custom/global_rcpt_blacklist.map\";\nregexp = true;\nprefilter = true;\naction = \"reject\";\nmessage = \"Der Versand von E-Mails an diesen Empfänger ist durch postmaster@your.domain verboten\";\n}\n</code></pre> </li> <li> <p>Speichern Sie die Datei und starten Sie Rspamd neu:</p> </li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd tweaks.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-tweaks.de/#e-mails-verwerfen-discard-anstatt-zuruckzuweisen-reject","level":2,"title":"E-Mails verwerfen (discard) anstatt zurückzuweisen (reject)","text":"<p>Wenn Sie eine Nachricht stillschweigend verwerfen wollen, erstellen oder bearbeiten Sie die Datei <code>data/conf/rspamd/override.d/worker-proxy.custom.inc</code> und fügen Sie den folgenden Inhalt hinzu:</p> <pre><code>discard_on_reject = true;\n</code></pre> <p>Starten Sie Rspamd neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd tweaks.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-tweaks.en/","level":1,"title":"U e rspamd tweaks.en","text":"","path":["U e rspamd tweaks.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-tweaks.en/#spam-filter-thresholds-global","level":2,"title":"Spam filter thresholds (global)","text":"<p>Each user is able to change their spam rating individually. To define a new server-wide limit, edit <code>data/conf/rspamd/local.d/actions.conf</code>:</p> <pre><code>reject = 15;\nadd_header = 8;\ngreylist = 7;\n</code></pre> <p>Save the file and restart \"rspamd-mailcow\":</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Warning</p> <p>Existing settings of users will not be overwritten!</p> <p>To reset custom defined thresholds, run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf\ndocker compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel';\"\n# or:\ndocker compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel' and object = 'only-this-mailbox@example.org';\"\n</code></pre> <pre><code>source mailcow.conf\ndocker-compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel';\"\n# or:\ndocker-compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel' and object = 'only-this-mailbox@example.org';\"\n</code></pre>","path":["U e rspamd tweaks.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-tweaks.en/#custom-reject-messages","level":2,"title":"Custom reject messages","text":"<p>The default spam reject message can be changed by adding a new file <code>data/conf/rspamd/override.d/worker-proxy.custom.inc</code> with the following content:</p> <pre><code>reject_message = \"My custom reject message\";\n</code></pre> <p>Save the file and restart Rspamd:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>While the above works for rejected mails with a high spam score, prefilter reject actions will ignore this setting. For these maps, the multimap module in Rspamd needs to be adjusted:</p> <ol> <li> <p>Find prefilet reject symbol for which you want change message, to do it run: <code>grep -R \"SYMBOL_YOU_WANT_TO_ADJUST\" /opt/mailcow-dockerized/data/conf/rspamd/</code></p> </li> <li> <p>Add your custom message as new line:</p> <pre><code>GLOBAL_RCPT_BL {\ntype = \"rcpt\";\nmap = \"${LOCAL_CONFDIR}/custom/global_rcpt_blacklist.map\";\nregexp = true;\nprefilter = true;\naction = \"reject\";\nmessage = \"Sending mail to this recipient is prohibited by postmaster@your.domain\";\n}\n</code></pre> </li> <li> <p>Save the file and restart Rspamd:</p> </li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd tweaks.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-tweaks.en/#discard-instead-of-reject","level":2,"title":"Discard instead of reject","text":"<p>If you want to silently drop a message, create or edit the file <code>data/conf/rspamd/override.d/worker-proxy.custom.inc</code> and add the following content:</p> <pre><code>discard_on_reject = true;\n</code></pre> <p>Restart Rspamd:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd tweaks.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/","level":1,"title":"U e rspamd work with spamdata.de","text":"","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#spam-ham-lernen","level":2,"title":"Spam &amp; Ham lernen","text":"<p>Rspamd lernt, ob es sich um Spam oder Ham handelt, wenn Sie eine Nachricht in oder aus dem Junk-Ordner in ein anderes Postfach als den Papierkorb verschieben. Dies wird durch die Verwendung des Sieve-Plugins \"sieve_imapsieve\" und Parser-Skripte erreicht.</p> <p>Rspamd liest auch automatisch Mails, wenn eine hohe oder niedrige Punktzahl erkannt wird (siehe https://rspamd.com/doc/configuration/statistic.html#autolearning). Wir haben das Plugin so konfiguriert, dass es ein vernünftiges Verhältnis zwischen Spam- und Ham-Learnings beibehält.</p> <p>Die Bayes-Statistiken werden in Redis als Schlüssel <code>BAYES_HAM</code> und <code>BAYES_SPAM</code> gespeichert.</p> <p>Neben Bayes wird ein lokaler Fuzzy-Speicher verwendet, um wiederkehrende Muster in Texten oder Bildern zu lernen, die auf Ham oder Spam hinweisen.</p> <p>Sie können auch die Web-UI von Rspamd verwenden, um Ham und/oder Spam zu lernen oder bestimmte Einstellungen von Rspamd anzupassen.</p>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#spam-oder-ham-aus-bestehendem-verzeichnis-lernen","level":3,"title":"Spam oder Ham aus bestehendem Verzeichnis lernen","text":"<p>Sie können einen Einzeiler verwenden, um Mails im Klartextformat (unkomprimiert) zu lernen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code># Ham\nfor file in /my/folder/cur/*; do docker exec -i $(docker compose ps -q rspamd-mailcow) rspamc learn_ham &lt; $file; done\n# Spam\nfor file in /my/folder/.Junk/cur/*; do docker exec -i $(docker compose ps -q rspamd-mailcow) rspamc learn_spam &lt; $file; done\n</code></pre> <pre><code># Ham\nfor file in /my/folder/cur/*; do docker exec -i $(docker-compose ps -q rspamd-mailcow) rspamc learn_ham &lt; $file; done\n# Spam\nfor file in /my/folder/.Junk/cur/*; do docker exec -i $(docker-compose ps -q rspamd-mailcow) rspamc learn_spam &lt; $file; done\n</code></pre> <p>Erwägen Sie, einen lokalen Ordner als neues Volume an <code>rspamd-mailcow</code> in <code>docker-compose.yml</code> anzuhängen und die gegebenen Dateien innerhalb des Containers zu lernen. Dies kann als Workaround verwendet werden, um komprimierte Daten mit zcat zu parsen. Beispiel:</p> <pre><code>for file in /data/old_mail/.Junk/cur/*; do rspamc learn_spam &lt; zcat $file; done\n</code></pre>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#gelernte-daten-zurucksetzen-bayes-neural","level":2,"title":"Gelernte Daten zurücksetzen (Bayes, Neural)","text":"<p>Sie müssen die Schlüssel in Redis löschen, um die gelernten Daten zurückzusetzen, also erstellen Sie zuerst eine Kopie Ihrer Redis-Datenbank:</p>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#kopie-der-redis-datenbank","level":3,"title":"Kopie der Redis Datenbank","text":"<pre><code># Es ist besser, Redis zu stoppen, bevor Sie die Datei kopieren.\ncp /var/lib/docker/volumes/mailcowdockerized_redis-vol-1/_data/dump.rdb /root/\n</code></pre>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#bayes-daten-zurucksetzen","level":3,"title":"Bayes-Daten zurücksetzen","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow sh -c 'redis-cli --scan --pattern BAYES_* | xargs redis-cli del'\ndocker compose exec redis-mailcow sh -c 'redis-cli --scan --pattern RS* | xargs redis-cli del'\n</code></pre> <pre><code>docker-compose exec redis-mailcow sh -c 'redis-cli --scan --pattern BAYES_* | xargs redis-cli del'\ndocker-compose exec redis-mailcow sh -c 'redis-cli --scan --pattern RS* | xargs redis-cli del'\n</code></pre>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#neurale-daten-zurucksetzen","level":3,"title":"Neurale Daten zurücksetzen","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow sh -c 'redis-cli --scan --pattern rn_* | xargs redis-cli del'\n</code></pre> <pre><code>docker-compose exec redis-mailcow sh -c 'redis-cli --scan --pattern rn_* | xargs redis-cli del'\n</code></pre>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#fuzzy-daten-zurucksetzen","level":3,"title":"Fuzzy-Daten zurücksetzen","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code># Wir müssen zuerst die redis-cli aufrufen:\ndocker compose exec redis-mailcow redis-cli\n# In redis-cli geben wir nun ein:\n127.0.0.1:6379&gt; EVAL \"for i, name in ipairs(redis.call('KEYS', ARGV[1])) do redis.call('DEL', name); end\" 0 fuzzy*\n</code></pre> <pre><code># Wir müssen zuerst die redis-cli aufrufen:\ndocker-compose exec redis-mailcow redis-cli\n# In redis-cli geben wir nun ein:\n127.0.0.1:6379&gt; EVAL \"for i, name in ipairs(redis.call('KEYS', ARGV[1])) do redis.call('DEL', name); end\" 0 fuzzy*\n</code></pre> <p>Info</p> <p>Wenn redis-cli sich darüber beschwert... <pre><code>(error) ERR wrong number of arguments for 'del' command\n</code></pre> ...,dass das Schlüsselmuster nicht gefunden wurde und somit keine Daten zum Löschen vorhanden sind - ist dies in Ordnung.</p>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/","level":1,"title":"U e rspamd work with spamdata.en","text":"","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#learn-spam-ham","level":2,"title":"Learn Spam &amp; Ham","text":"<p>Rspamd learns mail as spam or ham when you move a message in or out of the junk folder to any mailbox besides trash. This is achieved by using the Sieve plugin \"sieve_imapsieve\" and parser scripts.</p> <p>Rspamd also auto-learns mail when a high or low score is detected (see https://rspamd.com/doc/configuration/statistic.html#autolearning). We configured the plugin to keep a sane ratio between spam and ham learns.</p> <p>The bayes statistics are written to Redis as keys <code>BAYES_HAM</code> and <code>BAYES_SPAM</code>.</p> <p>Besides bayes, a local fuzzy storage is used to learn recurring patterns in text or images that indicate ham or spam.</p> <p>You can also use Rspamd's web UI to learn ham and / or spam or to adjust certain settings of Rspamd.</p>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#learn-spam-or-ham-from-existing-directory","level":3,"title":"Learn Spam or Ham from existing directory","text":"<p>You can use a one-liner to learn mail in plain-text (uncompressed) format:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code># Ham\nfor file in /my/folder/cur/*; do docker exec -i $(docker compose ps -q rspamd-mailcow) rspamc learn_ham &lt; $file; done\n# Spam\nfor file in /my/folder/.Junk/cur/*; do docker exec -i $(docker compose ps -q rspamd-mailcow) rspamc learn_spam &lt; $file; done\n</code></pre> <pre><code># Ham\nfor file in /my/folder/cur/*; do docker exec -i $(docker-compose ps -q rspamd-mailcow) rspamc learn_ham &lt; $file; done\n# Spam\nfor file in /my/folder/.Junk/cur/*; do docker exec -i $(docker-compose ps -q rspamd-mailcow) rspamc learn_spam &lt; $file; done\n</code></pre> <p>Consider attaching a local folder as new volume to <code>rspamd-mailcow</code> in <code>docker-compose.yml</code> and learn given files inside the container. This can be used as workaround to parse compressed data with zcat. Example:</p> <pre><code>for file in /data/old_mail/.Junk/cur/*; do rspamc learn_spam &lt; zcat $file; done\n</code></pre>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#reset-learned-data-bayes-neural","level":2,"title":"Reset learned data (Bayes, Neural)","text":"<p>You need to delete keys in Redis to reset learned data, so create a copy of your Redis database now:</p>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#copy-of-redis-database","level":3,"title":"Copy of Redis database","text":"<pre><code># It is better to stop Redis before you copy the file.\ncp /var/lib/docker/volumes/mailcowdockerized_redis-vol-1/_data/dump.rdb /root/\n</code></pre>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#reset-bayes-data","level":3,"title":"Reset Bayes data","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow sh -c 'redis-cli --scan --pattern BAYES_* | xargs redis-cli del'\ndocker compose exec redis-mailcow sh -c 'redis-cli --scan --pattern RS* | xargs redis-cli del'\n</code></pre> <pre><code>docker-compose exec redis-mailcow sh -c 'redis-cli --scan --pattern BAYES_* | xargs redis-cli del'\ndocker-compose exec redis-mailcow sh -c 'redis-cli --scan --pattern RS* | xargs redis-cli del'\n</code></pre>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#reset-neural-data","level":3,"title":"Reset Neural data","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow sh -c 'redis-cli --scan --pattern rn_* | xargs redis-cli del'\n</code></pre> <pre><code>docker-compose exec redis-mailcow sh -c 'redis-cli --scan --pattern rn_* | xargs redis-cli del'\n</code></pre>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#reset-fuzzy-data","level":3,"title":"Reset Fuzzy data","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code># We need to enter the redis-cli first:\ndocker compose exec redis-mailcow redis-cli\n# In redis-cli:\n127.0.0.1:6379&gt; EVAL \"for i, name in ipairs(redis.call('KEYS', ARGV[1])) do redis.call('DEL', name); end\" 0 fuzzy*\n</code></pre> <pre><code># We need to enter the redis-cli first:\ndocker-compose exec redis-mailcow redis-cli\n# In redis-cli:\n127.0.0.1:6379&gt; EVAL \"for i, name in ipairs(redis.call('KEYS', ARGV[1])) do redis.call('DEL', name); end\" 0 fuzzy*\n</code></pre> <p>Info</p> <p>If redis-cli complains about... <pre><code>(error) ERR wrong number of arguments for 'del' command\n</code></pre> ...the key pattern was not found and thus no data is available to delete - it is fine.</p>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u_e-rspamd-disable-greylisting.de/","level":1,"title":"U e rspamd disable greylisting.de","text":"<p>Hinweis</p> <p>In dieser Anleitung gehen wir von dem standard mailcow Pfad (<code>/opt/mailcow-dockerized</code>) aus. Der Pfad in Ihrer Installation kann möglicherweise variieren!</p> <p>Nur Nachrichten mit einem höheren Rspamd Score werden Greylisted (soft rejected). </p> <p>Wir selbst empfehlen NICHT das Greylisting zu deaktivieren.</p> <p>Falls Sie einen validen Grund dafür sehen, dass Greylisting zu deaktivieren, können Sie dies serverweit durch das Editieren der <code>greylist.conf</code> deaktivieren:</p> <p><code>/opt/mailcow-dockerized/data/conf/rspamd/local.d/greylist.conf</code></p> <p>Fügen Sie die Zeile hinzu:</p> <pre><code>enabled = false;\n</code></pre> <p>Speichern Sie die Datei und starten Sie \"rspamd-mailcow\" neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Das Greylisting ist nun serverweit deaktiviert!</p>","path":["U e rspamd disable greylisting.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u_e-rspamd-disable-greylisting.en/","level":1,"title":"U e rspamd disable greylisting.en","text":"<p>Info</p> <p>In this guide we assume the default mailcow path (<code>/opt/mailcow-dockerized</code>). The path in your installation may vary.</p> <p>Only messages with a higher Rspamd score will be considered to be greylisted (soft rejected).</p> <p>We do NOT recommend deactivating greylisting.</p> <p>However, if you see a valid reason to disable greylisting, you can disable it server-wide by editing the <code>greylist.conf</code>:</p> <p><code>/opt/mailcow-dockerized/data/conf/rspamd/local.d/greylist.conf</code></p> <p>Add the line:</p> <pre><code>enabled = false;\n</code></pre> <p>Save the file and restart \"rspamd-mailcow\":</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Greylisting is now deactivated serverwide!</p>","path":["U e rspamd disable greylisting.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u_e-rspamd-general.de/","level":1,"title":"U e rspamd general.de","text":"<p>Rspamd wird für die AV-Verarbeitung, DKIM-Signierung und SPAM-Verarbeitung verwendet. Es ist ein leistungsfähiges und schnelles Filtersystem. Für eine ausführlichere Dokumentation über Rspamd besuchen Sie bitte die [Rspamd Dokumentation] (https://rspamd.com/doc/index.html).</p>","path":["U e rspamd general.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u_e-rspamd-general.de/#ui-zugang","level":2,"title":"UI Zugang","text":"<p>Rspamd bietet eine umfangreiche WebUI, welche jeder mailcow: dockerized Installation beiliegt.</p> <p>Diese ist mit einem Login versehen, welcher während der initialen Installation auf ein zufälliges Passwort gesetzt wird um den Zugang dritter zu verweigern.</p> <p>Damit Sie sich in die Rspamd UI einloggen können müssen Sie zunächst ein eigenes Passwort für die Rspamd Oberfläche setzen.</p> <p>Dies tun Sie wie folgt:</p> <ol> <li>Loggen Sie sich als Administrator in ihrer mailcow UI ein.</li> <li>Wechseln Sie auf den Reiter (oben links) <code>System</code> <code>Konfiguration</code> und dort den Unterreiter: <code>Zugang</code> <code>Rspamd UI</code>.</li> <li>Ändern Sie hier das Rspamd UI Passwort, bzw. legen Sie eines fest.</li> <li>Gehen Sie in einem Browser zu https://${MAILCOW_HOSTNAME}/rspamd und melden Sie sich an!</li> </ol> <p>Weitere Konfigurationsoptionen und Dokumentation zur WebUI finden Sie hier: https://rspamd.com/webui/</p>","path":["U e rspamd general.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u_e-rspamd-general.de/#cli-werkzeuge","level":2,"title":"CLI-Werkzeuge","text":"<p>Rspamd bietet eine vielzahl von Befehlen, welche via CLI benutzt werden können.</p> <p>Geben Sie folgende Befehle ein, um einen Überblick auf diese zu erhalten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow rspamc --help\ndocker compose exec rspamd-mailcow rspamadm --help\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow rspamc --help\ndocker-compose exec rspamd-mailcow rspamadm --help\n</code></pre>","path":["U e rspamd general.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u_e-rspamd-general.de/#speicherung-der-historie-erhohen","level":2,"title":"Speicherung der Historie erhöhen","text":"<p>Standardmäßig speichert Rspamd 1000 Elemente in der Historie.</p> <p>Die Historie wird komprimiert gespeichert.</p> <p>Es wird empfohlen, hier keinen unverhältnismäßig hohen Wert zu verwenden, probieren Sie etwas in der Größenordnung von 5000 oder 10000 und sehen Sie, wie Ihr Server damit umgeht:</p> <p>Bearbeiten Sie <code>data/conf/rspamd/local.d/history_redis.conf</code>:</p> <pre><code>nrows = 1000; # Ändern Sie diesen Wert\n</code></pre> <p>Starten Sie anschließend Rspamd neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd general.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u_e-rspamd-general.de/#losche-alle-ratelimit-schlussel","level":2,"title":"Lösche alle Ratelimit-Schlüssel","text":"<p>Wenn Sie die mailcow UI nicht verwenden wollen und stattdessen alle Schlüssel in der Redis-Datenbank löschen wollen, können Sie redis-cli für diese Aufgabe verwenden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow sh\n# Unlink (verfügbar in Redis &gt;=4.) löscht im Hintergrund\nredis-cli --scan --pattern RL* | xargs redis-cli unlink\n</code></pre> <pre><code>docker-compose exec redis-mailcow sh\n# Unlink (verfügbar in Redis &gt;=4.) löscht im Hintergrund\nredis-cli --scan --pattern RL* | xargs redis-cli unlink\n</code></pre> <p>Starten Sie Rspamd neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd general.de"],"tags":[]},{"location":"de/manual-guides/Rspamd/u_e-rspamd-general.en/","level":1,"title":"U e rspamd general.en","text":"<p>Rspamd is used for AV handling, DKIM signing and SPAM handling. It's a powerful and fast filter system. For a more in-depth documentation on Rspamd please visit its own documentation.</p>","path":["U e rspamd general.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u_e-rspamd-general.en/#ui-access","level":2,"title":"UI access","text":"<p>Rspamd offers a comprehensive WebUI, which is included in every mailcow: dockerized installation.</p> <p>The Rspamd UI is provided with a login, which is set to a random password during the initial installation to deny third party access.</p> <p>To be able to log in to the Rspamd UI, you must first set your own password for the Rspamd interface.</p> <p>You do this as follows:</p> <ol> <li>Log in to your mailcow UI as administrator.</li> <li>Switch to the tab (top left) <code>System</code> <code>Configuration</code> and there the sub-tab: <code>Access</code> <code>Rspamd UI</code>.</li> <li>Change the Rspamd UI password here, or set one.</li> <li>Go to https://${MAILCOW_HOSTNAME}/rspamd in a browser and log in!</li> </ol> <p>Further configuration options and documentation for the WebUI can be found here: https://rspamd.com/webui/</p>","path":["U e rspamd general.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u_e-rspamd-general.en/#cli-tools","level":2,"title":"CLI tools","text":"<p>Rspamd offers a variety of commands that can be used via CLI.</p> <p>Enter the following commands to get an overview of these:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow rspamc --help\ndocker compose exec rspamd-mailcow rspamadm --help\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow rspamc --help\ndocker-compose exec rspamd-mailcow rspamadm --help\n</code></pre>","path":["U e rspamd general.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u_e-rspamd-general.en/#increase-history-retention","level":2,"title":"Increase history retention","text":"<p>By default Rspamd keeps 1000 elements in the history.</p> <p>The history is stored compressed.</p> <p>It is recommended not to use a disproportionate high value here, try something along 5000 or 10000 and see how your server handles it:</p> <p>Edit <code>data/conf/rspamd/local.d/history_redis.conf</code>:</p> <pre><code>nrows = 1000; # change this value\n</code></pre> <p>Restart Rspamd afterwards:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd general.en"],"tags":[]},{"location":"de/manual-guides/Rspamd/u_e-rspamd-general.en/#wipe-all-ratelimit-keys","level":2,"title":"Wipe all ratelimit keys","text":"<p>If you don't want to use the UI and instead wipe all keys in the Redis database, you can use redis-cli for that task:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow sh\n# Unlink (available in Redis &gt;=4.) will delete in the backgronud\nredis-cli --scan --pattern RL* | xargs redis-cli unlink\n</code></pre> <pre><code>docker-compose exec redis-mailcow sh\n# Unlink (available in Redis &gt;=4.) will delete in the backgronud\nredis-cli --scan --pattern RL* | xargs redis-cli unlink\n</code></pre> <p>Restart Rspamd:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd general.en"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.de/","level":1,"title":"U e sogo.de","text":"<p>SOGo wird verwendet, um über einen Webbrowser auf Ihre Mails zuzugreifen und Ihre Kontakte oder Kalender hinzuzufügen und zu teilen. Für eine ausführlichere Dokumentation zu SOGo besuchen Sie bitte die Dokumentation von SOGo.</p>","path":["U e sogo.de"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.de/#benutzerdefiniertes-sogo-thema-css-anwenden","level":2,"title":"Benutzerdefiniertes SOGo-Thema (CSS) anwenden","text":"<p>mailcow-Builds nach dem 28. Januar 2021 können das CSS-Thema von SOGo ändern, indem sie <code>data/conf/sogo/custom-theme.js</code> bearbeiten. Bitte schauen Sie sich die AngularJS Material intro und documentation sowie die material style guideline an, um zu erfahren, wie das funktioniert. </p> <p>Sie können die mitgelieferte <code>custom-theme.js</code> als Beispiel verwenden, indem Sie die Kommentare entfernen. Nachdem Sie <code>data/conf/sogo/custom-theme.js</code> modifiziert und Änderungen an Ihrem neuen SOGo-Theme vorgenommen haben, müssen Sie </p> <p>1. Bearbeiten Sie <code>data/conf/sogo/sogo.conf</code> und fügen Sie <code>SOGoUIxDebugEnabled = YES;</code> ein.</p> <p>2. SOGo und Memcached Container neu starten, indem man folgenden Befehl ausführt:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre> <p>3. SOGo im Browser öffnen</p> <p>4. öffnen Sie die Entwicklerkonsole des Browsers, normalerweise ist die Tastenkombination F12</p> <p>5. nur wenn Sie Firefox benutzen: schreiben Sie mit der Hand in die Entwicklerkonsole <code>allow pasting</code> und drücken Sie Enter</p> <p>6. fügen Sie den Java-Script-Schnipsel in die Entwicklungskonsole ein: <pre><code>copy([].slice.call(document.styleSheets)\n  .map(e =&gt; e.ownerNode)\n  .filter(e =&gt; e.hasAttribute('md-theme-style'))\n  .map(e =&gt; e.textInhalt)\n  .join('\\n')\n)\n</code></pre> 7. Öffnen Sie den Texteditor und fügen Sie die Daten aus der Zwischenablage ein (Strg+V), Sie sollten ein minimiertes CSS erhalten, speichern Sie es</p> <p>8. kopieren Sie die CSS-Datei auf den mailcow-Server <code>data/conf/sogo/custom-theme.css</code></p> <p>9. editiere <code>data/conf/sogo/sogo.conf</code> und setze <code>SOGoUIxDebugEnabled = NO;</code></p> <p>10. Anhängen/Erstellen von <code>docker-compose.override.yml</code> mit: <pre><code>services:\n  sogo-mailcow:\n    volumes:\n      - ./data/conf/sogo/custom-theme.css:/usr/lib/GNUstep/SOGo/WebServerResources/css/theme-default.css:z\n</code></pre> 11. Führen Sie folgenden Befehl aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>12. Neustarten des memcached Containers mit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.de/#zurucksetzen-auf-das-sogo-standardthema","level":2,"title":"Zurücksetzen auf das SOGo Standardthema","text":"<ol> <li>checken Sie <code>data/conf/sogo/custom-theme.js</code> aus, indem Sie <code>git fetch ; git checkout origin/master data/conf/sogo/custom-theme.js data/conf/sogo/custom-theme.js</code> ausführen</li> <li>Suchen Sie in <code>data/conf/sogo/custom-theme.js</code>: <pre><code>// Neue Paletten auf das Standardthema anwenden, einige Farbtöne neu zuordnen\n    $mdThemingProvider.theme('default')\n      .primaryPalette('green-cow', {\n        'default': '400', // Hintergrundfarbe der oberen Symbolleisten\n        hue-1': '400',\n        'hue-2': '600', // Hintergrundfarbe der Seitenleiste\n        'hue-3': 'A700'\n      })\n      .accentPalette('green', {\n        'default': '600', // Hintergrundfarbe der Fab-Schaltflächen und des Anmeldebildschirms\n        hue-1': '300', // Hintergrundfarbe der Symbolleiste der mittleren Liste\n        hue-2': '300', // Hervorhebungsfarbe für ausgewählte Nachrichten und den aktuellen Tageskalender\n        hue-3': 'A700'\n      })\n      .backgroundPalette('frost-grey');\n</code></pre> und ersetzen Sie es durch: <pre><code>    $mdThemingProvider.theme('default');\n</code></pre></li> <li>Entfernen Sie aus <code>docker-compose.override.yml</code> Volume Mount in <code>sogo-mailcow</code>: <pre><code>- ./data/conf/sogo/custom-theme.css:/usr/lib/GNUstep/SOGo/WebServerResources/css/theme-default.css:z\n</code></pre></li> <li>Führen Sie folgenden Befehl aus:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <ol> <li>Starten Sie memcached neu mit:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.de/#favicon-andern","level":2,"title":"Favicon ändern","text":"<p>mailcow-Builds nach dem 31. Januar 2021 können SOGo's Favicon ändern, indem sie <code>data/conf/sogo/custom-favicon.ico</code> für SOGo und <code>data/web/favicon.png</code> für mailcow UI ersetzen.</p> <p>Anmerkung: Sie können <code>.png</code> Favicons für SOGo verwenden, indem Sie sie in <code>custom-favicon.ico</code> umbenennen. Für beide, SOGo und mailcow UI Favicons, müssen Sie eine der Standardgrößen verwenden: 16x16, 32x32, 64x64, 128x128 und 256x256. Nachdem Sie diese Datei ersetzt haben, müssen Sie SOGo und Memcached Container neu starten, indem Sie folgenden Befehl ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.de/#logo-andern","level":2,"title":"Logo ändern","text":"<p>mailcow-Builds nach dem 21. Dezember 2018 können das SOGo-Logo ändern, indem sie die Datei <code>data/conf/sogo/sogo-full.svg</code> ersetzen oder erstellen (falls sie fehlt). Nachdem Sie diese Datei ersetzt haben, müssen Sie SOGo und Memcached Container neu starten, indem Sie folgendes ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.de/#domains-verbinden-untereinander-sichtbar-machen","level":2,"title":"Domains verbinden (untereinander sichtbar machen)","text":"<p>Domains sind normalerweise voneinander isoliert.</p> <p>Sie können das ändern, indem Sie <code>data/conf/sogo/sogo.conf</code> modifizieren:</p> <p>Suche... <pre><code>   // SOGoDomainsVisibility = (\n    // (domain1.tld, domain5.tld),\n    // (domain3.tld, domain2.tld)\n    // );\n</code></pre> ...und ersetzen Sie diese durch - zum Beispiel:</p> <pre><code>    SOGoDomainsVisibility = (\n      (beispiel.org, beispiel.com, beispiel.net)\n    );\n</code></pre> <p>SOGo neu starten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart sogo-mailcow\n</code></pre> <pre><code>docker-compose restart sogo-mailcow\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.de/#aktivieren-der-passwortanderung-in-sogo","level":2,"title":"Aktivieren der Passwortänderung in SOGo","text":"<p>Die Möglichkeit ihr Passwort in SOGo zu ändern wurde standardmäßig deaktiviert, da:</p> <ul> <li>es nicht die Passwortrichtlinien der mailcow UI beachten kann.</li> <li>es nicht funktioniert, wenn ein User sich direkt in SOGo angemeldet hat (über die mailcow UI) <code>In Webmail einloggen</code> (Auth Proxy)</li> </ul> <p>Sollten Sie diese Funktion dennoch aktiviert haben wollen bearbeiten Sie einfach <code>data/conf/sogo/sogo.conf</code> und ändern <code>SOGoPasswordChangeEnabled</code> zu <code>YES</code>. Bitte hier keine anderen Parameter außer <code>YES</code> oder <code>NO</code> verwenden.</p> <p>Anschließend SOGo neustarten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.de/#totp-zurucksetzen-totp-deaktivieren","level":2,"title":"TOTP zurücksetzen / TOTP deaktivieren","text":"<p>Führen Sie folgenden Befehl aus dem mailcow Verzeichnis aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec -u sogo sogo-mailcow sogo-tool user-preferences set defaults user@example.com SOGoTOTPEnabled '{\"SOGoTOTPEnabled\":0}'\n</code></pre> <pre><code>docker-compose exec -u sogo sogo-mailcow sogo-tool user-preferences set defaults user@example.com SOGoTOTPEnabled '{\"SOGoTOTPEnabled\":0}'\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.en/","level":1,"title":"U e sogo.en","text":"<p>SOGo is used for accessing your mails via a webbrowser, adding and sharing your contacts or calendars. For a more in-depth documentation on SOGo please visit its own documentation.</p>","path":["U e sogo.en"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.en/#apply-custom-sogo-theme","level":2,"title":"Apply custom SOGo theme","text":"<p>mailcow builds after 28 January 2021 can change SOGo's theme by editing <code>data/conf/sogo/custom-theme.js</code>. Please check the AngularJS Material intro and documentation as well as the material style guideline to learn how this works. </p> <p>You can use the provided <code>custom-theme.js</code> as an example starting point by removing the comments. After you modified <code>data/conf/sogo/custom-theme.js</code> and made changes to your new SOGo theme you need to </p> <p>1. edit <code>data/conf/sogo/sogo.conf</code> and append/set <code>SOGoUIxDebugEnabled = YES;</code></p> <p>2. restart SOGo and Memcached containers by executing the command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre> <p>3. open SOGo in browser</p> <p>4. open browser developer console, usually shortcut is F12</p> <p>5. only if you use Firefox: write by hands in dev console <code>allow pasting</code> and press enter</p> <p>6. paste java script snippet in dev console: <pre><code>copy([].slice.call(document.styleSheets)\n  .map(e =&gt; e.ownerNode)\n  .filter(e =&gt; e.hasAttribute('md-theme-style'))\n  .map(e =&gt; e.textContent)\n  .join('\\n')\n)\n</code></pre></p> <p>7. open text editor and paste data from clipboard (Ctrl+V), you should get minified CSS, save it</p> <p>8. copy CSS file to mailcow server <code>data/conf/sogo/custom-theme.css</code></p> <p>9. edit <code>data/conf/sogo/sogo.conf</code> and set <code>SOGoUIxDebugEnabled = NO;</code></p> <p>10. append/create <code>docker-compose.override.yml</code> with: <pre><code>services:\n  sogo-mailcow:\n    volumes:\n      - ./data/conf/sogo/custom-theme.css:/usr/lib/GNUstep/SOGo/WebServerResources/css/theme-default.css:z\n</code></pre></p> <p>11. Run: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>12. Run: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.en/#reset-to-sogo-default-theme","level":2,"title":"Reset to SOGo default theme","text":"<p>1. checkout <code>data/conf/sogo/custom-theme.js</code> by executing <code>git fetch ; git checkout origin/master data/conf/sogo/custom-theme.js data/conf/sogo/custom-theme.js</code></p> <p>2. find in <code>data/conf/sogo/custom-theme.js</code>: <pre><code>// Apply new palettes to the default theme, remap some of the hues\n    $mdThemingProvider.theme('default')\n      .primaryPalette('green-cow', {\n        'default': '400',  // background color of top toolbars\n        'hue-1': '400',\n        'hue-2': '600',    // background color of sidebar toolbar\n        'hue-3': 'A700'\n      })\n      .accentPalette('green', {\n        'default': '600',  // background color of fab buttons and login screen\n        'hue-1': '300',    // background color of center list toolbar\n        'hue-2': '300',    // highlight color for selected mail and current day calendar\n        'hue-3': 'A700'\n      })\n      .backgroundPalette('frost-grey');\n</code></pre> and replace it with: <pre><code>    $mdThemingProvider.theme('default');\n</code></pre></p> <p>3. remove from <code>docker-compose.override.yml</code> volume mount in <code>sogo-mailcow</code>: <pre><code>- ./data/conf/sogo/custom-theme.css:/usr/lib/GNUstep/SOGo/WebServerResources/css/theme-default.css:z\n</code></pre></p> <p>4. Run: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>5. Run: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.en/#change-favicon","level":2,"title":"Change favicon","text":"<p>mailcow builds after 31 January 2021 can change SOGo's favicon by replacing <code>data/conf/sogo/custom-favicon.ico</code> for SOGo and <code>data/web/favicon.png</code> for mailcow UI. Note: You can use <code>.png</code> favicons for SOGo by renaming them to <code>custom-favicon.ico</code>. For both SOGo and mailcow UI favicons you need use one of the standard dimensions: 16x16, 32x32, 64x64, 128x128 and 256x256. After you replaced said file you need to restart SOGo and Memcached containers by executing:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.en/#change-logo","level":2,"title":"Change logo","text":"<p>mailcow builds after 21 December 2018 can change SOGo's logo by replacing or creating (if missing) <code>data/conf/sogo/sogo-full.svg</code>. After you replaced said file you need to restart SOGo and Memcached containers by executing:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.en/#connect-domains","level":2,"title":"Connect domains","text":"<p>Domains are usually isolated from eachother.</p> <p>You can change that by modifying <code>data/conf/sogo/sogo.conf</code>:</p> <p>Search... <pre><code>   // SOGoDomainsVisibility = (\n    //  (domain1.tld, domain5.tld),\n    //  (domain3.tld, domain2.tld)\n    // );\n</code></pre> ...and replace it by - for example:</p> <pre><code>    SOGoDomainsVisibility = (\n      (example.org, example.com, example.net)\n    );\n</code></pre> <p>Restart SOGo:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart sogo-mailcow\n</code></pre> <pre><code>docker-compose restart sogo-mailcow\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.en/#enable-password-changing","level":2,"title":"Enable password changing","text":"<p>The password change option in SOGo is disabled by default because it:</p> <ul> <li>doesn't take into account the password policy set in the mailcow UI</li> <li>doesn't work when the user is logged in into SOGo using the <code>Login to Webmail</code> function in the mailcow UI (Auth Proxy)</li> </ul> <p>If you still want enable this option edit <code>data/conf/sogo/sogo.conf</code> and change <code>SOGoPasswordChangeEnabled</code> to <code>YES</code>. Please do not add a new parameter.</p> <p>Run this command to activate the changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"de/manual-guides/SOGo/u_e-sogo.en/#reset-totp-disable-totp","level":2,"title":"Reset TOTP / Disable TOTP","text":"<p>Run the following command from within the mailcow directory:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec -u sogo sogo-mailcow sogo-tool user-preferences set defaults user@example.com SOGoTOTPEnabled '{\"SOGoTOTPEnabled\":0}'\n</code></pre> <pre><code>docker-compose exec -u sogo sogo-mailcow sogo-tool user-preferences set defaults user@example.com SOGoTOTPEnabled '{\"SOGoTOTPEnabled\":0}'\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"de/manual-guides/Unbound/u_e-unbound-fwd.de/","level":1,"title":"U e unbound fwd.de","text":"<p>Wenn Sie einen externen DNS-Dienst verwenden wollen oder müssen, können Sie entweder einen Forwarder in Unbound einstellen oder eine Override-Datei kopieren, um externe DNS-Server zu definieren:</p> <p>Warnung</p> <p>Bitte verwenden Sie keinen öffentlichen Resolver, wie wir es im obigen Beispiel getan haben. Viele - wenn nicht sogar alle - Blacklist-Lookups werden mit öffentlichen Resolvern fehlschlagen, da der Blacklist-Server Grenzen hat, wie viele Anfragen von einer IP gestellt werden können und öffentliche Resolver diese Grenzen normalerweise erreichen.  Wichtig: Nur DNSSEC-validierende DNS-Dienste werden funktionieren.</p>","path":["U e unbound fwd.de"],"tags":[]},{"location":"de/manual-guides/Unbound/u_e-unbound-fwd.de/#methode-a-unbound","level":2,"title":"Methode A, Unbound","text":"<p>Bearbeiten Sie <code>data/conf/unbound/unbound.conf</code> und fügen Sie die folgenden Parameter hinzu:</p> <pre><code>forward-zone:\n  name: \".\"\n  forward-addr: 8.8.8.8 # VERWENDEN SIE KEINE ÖFFENTLICHEN DNS-SERVER - NUR EIN BEISPIEL\n  forward-addr: 8.8.4.4 # VERWENDET KEINE ÖFFENTLICHEN DNS-SERVER - NUR EIN BEISPIEL\n</code></pre> <p>Unbound neu starten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>  docker compose restart unbound-mailcow\n</code></pre> <pre><code>  docker-compose restart unbound-mailcow\n</code></pre>","path":["U e unbound fwd.de"],"tags":[]},{"location":"de/manual-guides/Unbound/u_e-unbound-fwd.de/#methode-b-uberschreiben-der-datei","level":2,"title":"Methode B, Überschreiben der Datei","text":"<pre><code>cd /opt/mailcow-dockerized\ncp helper-scripts/docker-compose.override.yml.d/EXTERNAL_DNS/docker-compose.override.yml .\n</code></pre> <p>Bearbeiten Sie <code>docker-compose.override.yml</code> und passen Sie die IP an.</p> <p>Stoppen und starten Sie bitte im Anschluss noch den Docker Stack:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>  docker compose down\n  docker compose up -d\n</code></pre> <pre><code>  docker-compose down\n  docker-compose up -d\n</code></pre>","path":["U e unbound fwd.de"],"tags":[]},{"location":"de/manual-guides/Unbound/u_e-unbound-fwd.en/","level":1,"title":"U e unbound fwd.en","text":"<p>If you want or have to use an external DNS service, you can either set a forwarder in Unbound or copy an override file to define external DNS servers:</p> <p>Warning</p> <p>Please do not use a public resolver like we did in the example above. Many - if not all - blacklist lookups will fail with public resolvers, because blacklist server has limits on how much requests can be done from one IP and public resolvers usually reach this limits.  Important: Only DNSSEC validating DNS services will work.</p>","path":["U e unbound fwd.en"],"tags":[]},{"location":"de/manual-guides/Unbound/u_e-unbound-fwd.en/#method-a-unbound","level":2,"title":"Method A, Unbound","text":"<p>Edit <code>data/conf/unbound/unbound.conf</code> and append the following parameters:</p> <pre><code>forward-zone:\n  name: \".\"\n  forward-addr: 8.8.8.8 # DO NOT USE PUBLIC DNS SERVERS - JUST AN EXAMPLE\n  forward-addr: 8.8.4.4 # DO NOT USE PUBLIC DNS SERVERS - JUST AN EXAMPLE\n</code></pre> <p>Restart Unbound:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>  docker compose restart unbound-mailcow\n</code></pre> <pre><code>  docker-compose restart unbound-mailcow\n</code></pre>","path":["U e unbound fwd.en"],"tags":[]},{"location":"de/manual-guides/Unbound/u_e-unbound-fwd.en/#method-b-override-file","level":2,"title":"Method B, Override file","text":"<pre><code>cd /opt/mailcow-dockerized\ncp helper-scripts/docker-compose.override.yml.d/EXTERNAL_DNS/docker-compose.override.yml .\n</code></pre> <p>Edit <code>docker-compose.override.yml</code> and adjust the IP.</p> <p>Afterwards stop and start the Docker Stack again:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>  docker compose down\n  docker compose up -d\n</code></pre> <pre><code>  docker-compose down\n  docker-compose up -d\n</code></pre>","path":["U e unbound fwd.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/","level":1,"title":"U e watchdog thresholds.de","text":"<p>Watchdog verwendet Standardwerte für alle in <code>docker-compose.yml</code> definierten Thresholde.</p> <p>Die Standardwerte sind für die meisten Konfigurationen geeignet. Beispiel: <pre><code>- NGINX_THRESHOLD=${NGINX_THRESHOLD:-5}\n- UNBOUND_THRESHOLD=${UNBOUND_THRESHOLD:-5}\n- REDIS_THRESHOLD=${REDIS_THRESHOLD:-5}\n- MYSQL_THRESHOLD=${MYSQL_THRESHOLD:-5}\n- MYSQL_REPLICATION_THRESHOLD=${MYSQL_REPLICATION_THRESHOLD:-1}\n- SOGO_THRESHOLD=${SOGO_THRESHOLD:-3}\n- POSTFIX_THRESHOLD=${POSTFIX_THRESHOLD:-8}\n- CLAMD_THRESHOLD=${CLAMD_THRESHOLD:-15}\n- DOVECOT_THRESHOLD=${DOVECOT_THRESHOLD:-12}\n- DOVECOT_REPL_THRESHOLD=${DOVECOT_REPL_THRESHOLD:-20}\n- PHPFPM_THRESHOLD=${PHPFPM_THRESHOLD:-5}\n- RATELIMIT_THRESHOLD=${RATELIMIT_THRESHOLD:-1}\n- FAIL2BAN_THRESHOLD=${FAIL2BAN_THRESHOLD:-1}\n- ACME_THRESHOLD=${ACME_THRESHOLD:-1}\n- RSPAMD_THRESHOLD=${RSPAMD_THRESHOLD:-5}\n- OLEFY_THRESHOLD=${OLEFY_THRESHOLD:-5}\n- MAILQ_THRESHOLD=${MAILQ_THRESHOLD:-20}\n- MAILQ_CRIT=${MAILQ_CRIT:-30}\n</code></pre></p> <p>Um sie anzupassen, fügen Sie einfach die notwendigen Threshold Variablen (z.B. <code>MAILQ_THRESHOLD=10</code>) zu <code>mailcow.conf</code> hinzu und führen Sie den folgenden Befehl aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#threshold-beschreibungen","level":3,"title":"Threshold Beschreibungen","text":"","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#nginx_threshold","level":4,"title":"NGINX_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn Watchdog keine Verbindung zu Nginx auf Port 8081 herstellen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht wurde.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#unbound_threshold","level":4,"title":"UNBOUND_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn Unbound externe Domänen/DNSSEC nicht auflösen/überprüfen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#redis_threshold","level":4,"title":"REDIS_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn der Watchdog keine Verbindung zu Redis auf Port 6379 herstellen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#mysql_threshold","level":4,"title":"MYSQL_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn watchdog keine Verbindung zu MySQL herstellen kann oder eine Tabelle nicht abfragen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht wurde.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#mysql_replication_threshold","level":4,"title":"MYSQL_REPLICATION_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn die MySQL-Replikation fehlschlägt.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#sogo_threshold","level":4,"title":"SOGO_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn der Watchdog keine Verbindung zu SOGo auf Port 20000 herstellen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#postfix_threshold","level":4,"title":"POSTFIX_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn watchdog keine Testmail über Port 589 senden kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#clamd_threshold","level":4,"title":"CLAMD_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn Watchdog keine Verbindung zu Clamd herstellen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht wurde.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#dovecot_threshold","level":4,"title":"DOVECOT_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn watchdog bei verschiedenen Tests mit dem Dovecot-Container fehlschlägt. Der Container wird automatisch neu gestartet, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#dovecot_repl_threshold","level":4,"title":"DOVECOT_REPL_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn die Dovecot-Replikation fehlschlägt.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#phpfpm_threshold","level":4,"title":"PHPFPM_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn Watchdog keine Verbindung zu PHP-FPM auf Port 9001/9002 herstellen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#ratelimit_threshold","level":4,"title":"RATELIMIT_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn ein Ratelimit erreicht wurde.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#fail2ban_threshold","level":4,"title":"FAIL2BAN_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn ein fail2ban eine IP gesperrt hat.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#acme_threshold","level":4,"title":"ACME_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn etwas mit dem acme-mailcow-Container nicht in Ordnung ist. Sie können dessen Logs überprüfen.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#rspamd_threshold","level":4,"title":"RSPAMD_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn Watchdog bei verschiedenen Tests mit dem Rspamd-Container fehlschlägt und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht wurde.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#olefy_threshold","level":4,"title":"OLEFY_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn watchdog keine Verbindung zu olefy auf Port 10005 herstellen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.de/#mailq_crit-und-mailq_threshold","level":4,"title":"MAILQ_CRIT und MAILQ_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn die Anzahl der E-Mails in der Postfix-Warteschlange größer ist als <code>MAILQ_CRIT</code> für einen Zeitraum von <code>MAILQ_THRESHOLD * (60±30)</code> Sekunden.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/","level":1,"title":"U e watchdog thresholds.en","text":"<p>Watchdog uses default values for all thresholds defined in <code>docker-compose.yml</code>.</p> <p>The default values will work for most setups. Example: <pre><code>- NGINX_THRESHOLD=${NGINX_THRESHOLD:-5}\n- UNBOUND_THRESHOLD=${UNBOUND_THRESHOLD:-5}\n- REDIS_THRESHOLD=${REDIS_THRESHOLD:-5}\n- MYSQL_THRESHOLD=${MYSQL_THRESHOLD:-5}\n- MYSQL_REPLICATION_THRESHOLD=${MYSQL_REPLICATION_THRESHOLD:-1}\n- SOGO_THRESHOLD=${SOGO_THRESHOLD:-3}\n- POSTFIX_THRESHOLD=${POSTFIX_THRESHOLD:-8}\n- CLAMD_THRESHOLD=${CLAMD_THRESHOLD:-15}\n- DOVECOT_THRESHOLD=${DOVECOT_THRESHOLD:-12}\n- DOVECOT_REPL_THRESHOLD=${DOVECOT_REPL_THRESHOLD:-20}\n- PHPFPM_THRESHOLD=${PHPFPM_THRESHOLD:-5}\n- RATELIMIT_THRESHOLD=${RATELIMIT_THRESHOLD:-1}\n- FAIL2BAN_THRESHOLD=${FAIL2BAN_THRESHOLD:-1}\n- ACME_THRESHOLD=${ACME_THRESHOLD:-1}\n- RSPAMD_THRESHOLD=${RSPAMD_THRESHOLD:-5}\n- OLEFY_THRESHOLD=${OLEFY_THRESHOLD:-5}\n- MAILQ_THRESHOLD=${MAILQ_THRESHOLD:-20}\n- MAILQ_CRIT=${MAILQ_CRIT:-30}\n</code></pre></p> <p>To adjust them just add necessary threshold variables (e.g. <code>MAILQ_THRESHOLD=10</code>) to <code>mailcow.conf</code> and run the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#thresholds-descriptions","level":3,"title":"Thresholds descriptions","text":"","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#nginx_threshold","level":4,"title":"NGINX_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to Nginx on port 8081 and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#unbound_threshold","level":4,"title":"UNBOUND_THRESHOLD","text":"<p>Notifies administrators if Unbound can not resolve/valide external domains/DNSSEC and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#redis_threshold","level":4,"title":"REDIS_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to Redis on port 6379 and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#mysql_threshold","level":4,"title":"MYSQL_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to MySQL or can not query a table and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#mysql_replication_threshold","level":4,"title":"MYSQL_REPLICATION_THRESHOLD","text":"<p>Notifies administrators if the MySQL replication fails.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#sogo_threshold","level":4,"title":"SOGO_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to SOGo on port 20000 and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#postfix_threshold","level":4,"title":"POSTFIX_THRESHOLD","text":"<p>Notifies administrators if watchdog can not sent a test mail via port 589 and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#clamd_threshold","level":4,"title":"CLAMD_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to Clamd and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#dovecot_threshold","level":4,"title":"DOVECOT_THRESHOLD","text":"<p>Notifies administrators if watchdog fails with various tests with Dovecot container and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#dovecot_repl_threshold","level":4,"title":"DOVECOT_REPL_THRESHOLD","text":"<p>Notifies administrators if the Dovecot replication fails.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#phpfpm_threshold","level":4,"title":"PHPFPM_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to PHP-FPM on port 9001/9002 and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#ratelimit_threshold","level":4,"title":"RATELIMIT_THRESHOLD","text":"<p>Notifies administrators if a ratelimit got hit.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#fail2ban_threshold","level":4,"title":"FAIL2BAN_THRESHOLD","text":"<p>Notifies administrators if a fail2ban banned an IP.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#acme_threshold","level":4,"title":"ACME_THRESHOLD","text":"<p>Notifies administrators if something is wrong with the acme-mailcow container. You may check its logs.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#rspamd_threshold","level":4,"title":"RSPAMD_THRESHOLD","text":"<p>Notifies administrators if watchdog fails with various tests with Rspamd container and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#olefy_threshold","level":4,"title":"OLEFY_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to olefy on port 10005 and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/Watchdog/u_e-watchdog-thresholds.en/#mailq_crit-and-mailq_threshold","level":4,"title":"MAILQ_CRIT and MAILQ_THRESHOLD","text":"<p>Notifies administrators if number of emails in the postfix queue is greater then <code>MAILQ_CRIT</code> for period of <code>MAILQ_THRESHOLD * (60±30)</code> seconds.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-bl_wl.de/","level":1,"title":"U e mailcow ui bl wl.de","text":"<p>Um einen Eintrag zu Ihrer domain-weiten Filtertabelle hinzuzufügen oder zu bearbeiten, loggen Sie sich als (Domain-)Administrator in Ihre mailcow UI ein und wechseln Sie zu:  <code>Konfiguration &gt; E-Mail-Setup &gt; Domains &gt; (Domain) Bearbeiten &gt; Spamfilter</code>.</p> <p></p> <p>Info</p> <p>Seien Sie sich bewusst, dass ein Benutzer diese Einstellung überschreiben kann, indem er seine eigene Black- und Whitelist setzt!</p> <p>Es ist auch eine globale Filtertabelle in <code>Konfiguration &gt; Server-Konfiguration &gt; Globale Filter-Maps</code> verfügbar, um einen server-weiten (also domainübergreifenden) Filter für ein oder mehrere Regex-Maps zu konfigurieren (Todo: Screenshots).</p>","path":["U e mailcow ui bl wl.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-bl_wl.en/","level":1,"title":"U e mailcow ui bl wl.en","text":"<p>To add or edit an entry to your domain-wide filter table, log in to your mailcow UI as (domain) administrator and go to:  <code>Configuration &gt; Email Setup &gt; Domains &gt; Edit Domain &gt; Spam Filter</code>.</p> <p></p> <p>Info</p> <p>Be aware that a user can override this setting by setting their own blacklist and whitelist!</p> <p>There is also a global filter table in <code>Configuration &gt; Configuration &amp; Details &gt; Global filter maps</code> to configure a server wide filter for multiple regex maps (todo: screenshots).</p>","path":["U e mailcow ui bl wl.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-config.de/","level":1,"title":"U e mailcow ui config.de","text":"<p>Mehrere Konfigurationsparameter der mailcow-Benutzeroberfläche können geändert werden, indem eine Datei <code>data/web/inc/vars.local.inc.php</code> erstellt wird, die die Standardeinstellungen in <code>data/web/inc/vars.inc.php</code> überschreibt.</p> <p>Die lokale Konfigurationsdatei ist über Updates von mailcow hinweg beständig. Versuchen Sie nicht, die Werte in <code>data/web/inc/vars.inc.php</code> zu ändern, sondern verwenden Sie diese als Vorlage für die lokale Überschreibung.</p> <p>mailcow UI Konfigurationsparameter können verwendet werden, um...</p> <ul> <li>...die Standardsprache zu ändern<sup>1</sup></li> <li>...das Standard-Bootstrap-Theme zu ändern</li> <li>...eine Passwort-Komplexitäts-Regex zu setzen</li> <li>...die Sichtbarkeit des privaten DKIM-Schlüssels aktivieren</li> <li>...eine Größe für den Paginierungsauslöser festlegen</li> <li>...Standard-Postfach-Attribute festlegen</li> <li>...Sitzungs-Lebensdauern ändern</li> <li>...feste App-Menüs erstellen (die nicht in der mailcow UI geändert werden können)</li> <li>...ein Standard \"To\"-Feld für Relayhost-Tests einstellen</li> <li>...ein Timeout für Docker API Anfragen setzen</li> <li>...IP-Anonymisierung umschalten</li> </ul> <ol> <li> <p>Um SOGos Standardsprache zu ändern, müssen Sie <code>data/conf/sogo/sogo.conf</code> bearbeiten und \"English\" durch Ihre bevorzugte Sprache ersetzen. ↩</p> </li> </ol>","path":["U e mailcow ui config.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-config.en/","level":1,"title":"U e mailcow ui config.en","text":"<p>Several configuration parameters of the mailcow UI can be changed by creating a file <code>data/web/inc/vars.local.inc.php</code> which overrides defaults settings found in <code>data/web/inc/vars.inc.php</code>.</p> <p>The local configuration file is persistent over updates of mailcow. Try not to change values inside <code>data/web/inc/vars.inc.php</code>, but use them as template for the local override.</p> <p>mailcow UI configuration parameters can be used to...</p> <ul> <li>...change the default language<sup>1</sup></li> <li>...change the default bootstrap theme</li> <li>...set a password complexity regex</li> <li>...enable DKIM private key visibility</li> <li>...set a pagination trigger size</li> <li>...set default mailbox attributes</li> <li>...change session lifetimes</li> <li>...create fixed app menus (which cannot be changed in mailcow UI)</li> <li>...set a default \"To\" field for relayhost tests</li> <li>...set a timeout for Docker API requests</li> <li>...toggle IP anonymization</li> </ul> <ol> <li> <p>To change SOGos default language, you will need to edit <code>data/conf/sogo/sogo.conf</code> and replace \"English\" by your preferred language. ↩</p> </li> </ol>","path":["U e mailcow ui config.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-css.de/","level":1,"title":"U e mailcow ui css.de","text":"<p>Für benutzerdefinierte Überschreibungen bestimmter Elemente über CSS, verwenden Sie die <code>data/web/css/build/0081-custom-mailcow.css</code> Datei.</p> <p>Die Datei wird von der Verfolgung (via Git) ausgeschlossen und bleibt bei Aktualisierungen erhalten.</p>","path":["U e mailcow ui css.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-css.en/","level":1,"title":"U e mailcow ui css.en","text":"<p>For custom overrides of specific elements via CSS, use <code>data/web/css/build/0081-custom-mailcow.css</code>.</p> <p>The file is excluded from tracking and persists over updates.</p>","path":["U e mailcow ui css.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-fido.de/","level":1,"title":"U e mailcow ui fido.de","text":"","path":["U e mailcow ui fido.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-fido.de/#wie-wird-uv-in-mailcow-gehandhabt","level":2,"title":"Wie wird UV in mailcow gehandhabt?","text":"<p>Das UV-Flag (wie in \"user verification\") erzwingt, dass WebAuthn den Benutzer verifiziert, bevor es den Zugriff auf den Schlüssel erlaubt (denken Sie an eine PIN). Wir erzwingen keine UV, um Logins über iOS und NFC (YubiKey) zu ermöglichen.</p>","path":["U e mailcow ui fido.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-fido.de/#login-und-schlussel-verarbeitung","level":2,"title":"Login und Schlüssel-Verarbeitung","text":"<p>mailcow verwendet Client-seitige Schlüsselverarbeitung. Wir bitten den Authentifikator (d.h. YubiKey), die Registrierung in seinem Speicher zu speichern.</p> <p>Ein Benutzer muss keinen Benutzernamen eingeben. Die verfügbaren Anmeldedaten - falls vorhanden - werden dem Nutzer angezeigt, wenn er den \"Schlüssel-Login\" über das mailcow UI Login auswählt.</p> <p>Beim Aufruf des Login-Prozesses werden dem Authentifikator keine Credential-IDs übergeben. Dies wird ihn dazu zwingen, die Anmeldeinformationen in seinem eigenen Speicher zu suchen.</p>","path":["U e mailcow ui fido.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-fido.de/#wer-kann-webauthn-benutzen-um-sich-bei-mailcow-anzumelden","level":2,"title":"Wer kann WebAuthn benutzen, um sich bei mailcow anzumelden?","text":"<p>Ab heute sind nur Administratoren und Domain-Administratoren in der Lage, WebAuthn/FIDO2 einzurichten.</p> <p>Sie wollen WebAuthn/Fido als 2FA verwenden? Schauen Sie sich das hier an: Zwei-Faktoren-Authentifizierung</p>","path":["U e mailcow ui fido.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-fido.en/","level":1,"title":"U e mailcow ui fido.en","text":"","path":["U e mailcow ui fido.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-fido.en/#how-is-uv-handled-in-mailcow","level":2,"title":"How is UV handled in mailcow?","text":"<p>The UV flag (as in \"user verification\") enforces WebAuthn to verify the user before it allows access to the key (think of a PIN). We don't enforce UV to allow logins via iOS and NFC (YubiKey).</p>","path":["U e mailcow ui fido.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-fido.en/#login-and-key-processing","level":2,"title":"Login and key processing","text":"<p>mailcow uses client-side key processing. We ask the authenticator (i.e. YubiKey) to save the registration in its memory.</p> <p>A user does not need to enter a username. The available credentials - if any - will be shown to the user when selecting the \"key login\" via mailcow UI login.</p> <p>When calling the login process, the authenticator is not given any credential IDs. This will force it to lookup credentials in its own memory.</p>","path":["U e mailcow ui fido.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-fido.en/#who-can-use-webauthn-to-login-to-mailcow","level":2,"title":"Who can use WebAuthn to login to mailcow?","text":"<p>As of today, only administrators and domain administrators are able to setup WebAuthn/FIDO2.</p> <p>You want to use WebAuthn/Fido as 2FA? Check it out here: Two-Factor Authentication</p>","path":["U e mailcow ui fido.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/","level":1,"title":"U e mailcow ui forgot password.de","text":"<p>Hinweis</p> <p>Für dieses Feature ist eine mailcow Installation ab Version 2024-08 erforderlich!</p> <p>Der aktuell installierte Patchstand kann in mailcow Versionen seit 2022 innerhalb der UI eingesehen werden.</p>","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/#vorwort","level":3,"title":"Vorwort","text":"<p>Danke!</p> <p>Diese Funktionalität wurde von der Jugendstiftung Baden-Württemberg im Rahmen eines Sponsored Developments im August 2024 in mailcow integriert.</p> <p>Vielen Dank für das Sponsoring dieses Features!</p> <p>Mit der Passwort-vergessen-Funktion ist es Mailbox-Nutzern möglich, durch die Angabe einer Backup-E-Mail-Adresse, sich einen Link zur Zurücksetzung ihres Passwortes schicken zu lassen und dieses dann zurückzusetzen.</p>","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/#voraussetzungen","level":3,"title":"Voraussetzungen","text":"<p>Damit dieses Feature für einen Benutzer aktiviert und nutzbar ist, sind folgende Dinge zu beachten:</p> <ol> <li>Der mailcow Administrator muss eine Absender E-Mail und einen Betreff (siehe unten) eingestellt haben. Die Absender E-Mail muss nicht als Mailbox existieren, die Domain allerdings muss auf mailcow komplett eingerichtet sein, so dass mit dieser das Senden und vor allem die Zustellung von E-Mails sichergestellt ist.</li> <li>Der Mailbox-Benutzer muss eine Backup-E-Mail in seinen Optionen hinterlegt haben. Dies kann der User selber tun (wenn die dazugehörige ACL nicht deaktiviert ist) oder der Administrator.</li> <li>Die Backup-E-Mail sollte eine andere E-Mail sein, als die des Mailkontos, für welches das Passwort zurückgesetzt werden soll.</li> <li>Ebenfalls muss diese Backup-E-Mail externe E-Mails empfangen dürfen und sollte (wenn möglich) bei einem anderen Anbieter liegen und nicht direkt auf dem mailcow-Server sein. (Dieser Punkt ist allerdings optional und dient nur als Empfehlung).</li> <li>Der Nutzer muss Zugriff auf das Postfach der Backup-E-Mail haben, da die Links nur eine begrenzte Zeit gültig sind.</li> </ol>","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/#einstellungsmoglichkeiten-in-der-mailcow-ui","level":3,"title":"Einstellungsmöglichkeiten in der mailcow UI","text":"","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/#mailbox-einstellungen","level":4,"title":"Mailbox-Einstellungen","text":"<p>Durch dieses Feature wird ein neues Feld in den Mailbox-Optionen hinzugefügt:</p> <p></p> <p>Achtung</p> <p>Zur Erinnerung: Dieses Feld MUSS ausgefüllt sein, damit der Benutzer sein Passwort zurücksetzen kann! Sollte es nicht gesetzt sein, ist es ihm nicht möglich, sein Passwort zurückzusetzen!</p> <p>Für Administratoren gibt es eine neue ACL, die entweder pro Mailbox im Nachhinein oder auch als Vorlage für Mailboxen gesetzt werden kann: <code>Verwalten der E-Mail zur Passwortwiederherstellung erlauben</code>: </p> <p>Hinweis</p> <p>Wenn ein Benutzer bereits eine Backup-E-Mail gesetzt hat, aber der Admin ihm diese ACL entzieht, so kann er trotzdem sein Passwort zurücksetzen, da die Backup-E-Mail weiterhin im System existiert. Die ACL verbietet dadurch also nicht automatisch die Möglichkeit, das Passwort zurückzusetzen, wenn es eine E-Mail gibt!</p> <p>Um dies zu erreichen, muss zusätzlich noch die Backup-E-Mail für den Benutzer von einem Administrator entfernt werden.</p>","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/#server-einstellungen","level":4,"title":"Server-Einstellungen","text":"<p>Der mailcow-Administrator kann (ähnlich wie die Quota- und Quarantäne-Mails) auch für die Passwort-vergessen-E-Mails das Template bearbeiten, wie die Mails dann verschickt werden sollen. Standardmäßig ist das Template immer auf Englisch.</p> <p>Dieses kann unter dem Reiter: <code>System -&gt; Konfiguration -&gt; Einstellungen -&gt; Passwort-Einstellungen</code> erreicht werden:</p> <p></p>","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/#versteckte-einstellungen-nicht-in-der-mailcow-ui","level":3,"title":"Versteckte Einstellungen (nicht in der mailcow UI)","text":"<p>Standardmäßig kann jeder Nutzer maximal 3 Passwort-Reset-Tokens anfordern, die dann standardmäßig 15 Minuten gültig sind.</p> <p>Server-Administratoren können die Ablaufzeit sowie die maximalen Tokens pro Nutzer allerdings konfigurieren.</p> <p>Dafür muss (falls noch nicht vorhanden) eine Datei namens <code>vars.local.inc.php</code> in dem Ordner <code>MAILCOW_ROOT/data/web/inc</code> angelegt werden.</p> <p>Diese muss dann mindestens Folgendes enthalten:</p> <pre><code>&lt;?php\n\n// Maximum number of password reset tokens that can be generated at once per user\n$PW_RESET_TOKEN_LIMIT = 3; // Zahl hier abändern auf einen anderen Wert\n\n// Maximum time in minutes a password reset token is valid\n$PW_RESET_TOKEN_LIFETIME = 15; // Zahl hier abändern auf einen anderen Wert. Wert in Minuten\n</code></pre> <p>Die Datei wird automatisch eingelesen, es ist kein Neustart von mailcow oder einem der Container erforderlich!</p>","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/","level":1,"title":"U e mailcow ui forgot password.en","text":"<p>Note</p> <p>This feature requires a mailcow installation at 2024-08!</p> <p>The currently installed patch level can be viewed in the mailcow versions since 2022 within the UI.</p>","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/#preface","level":3,"title":"Preface","text":"<p>Thank You!</p> <p>This functionality was integrated into mailcow due to the Youth Foundation Baden-Württemberg (Germany) as part of a sponsored development in August 2024.</p> <p>Thank you for sponsoring this feature!</p> <p>With the \"Forgot Password\" function, mailbox users can request a link to reset their password by providing a backup email address and then reset their password.</p>","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/#requirements","level":3,"title":"Requirements","text":"<p>To activate and use this feature for a user, the following must be noted:</p> <ol> <li>The mailcow administrator must have configured a sender email and a subject (see below). The sender email does not need to exist as a mailbox; however, the domain must be fully set up in mailcow to ensure that sending and especially delivery of emails is guaranteed.</li> <li>The mailbox user must have a backup email address set in their options. This can be done by the user themselves (if the corresponding ACL is not disabled) or by the administrator.</li> <li>The backup email should be different from the email address of the account for which the password is to be reset.</li> <li>The backup email must also be able to receive external emails and should, if possible, be from a different provider and not directly on the mailcow server (this point is optional and serves only as a recommendation).</li> <li>The user must have access to the backup email's mailbox since the links are only valid for a limited time.</li> </ol>","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/#configuration-options-in-the-mailcow-ui","level":3,"title":"Configuration Options in the mailcow UI","text":"","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/#mailbox-settings","level":4,"title":"Mailbox Settings","text":"<p>This feature adds a new field to the mailbox options:</p> <p></p> <p>Attention</p> <p>Reminder: This field MUST be filled in for the user to reset their password! If it is not set, they will not be able to reset their password!</p> <p>For administrators, there is a new ACL that can be set either per mailbox afterwards or as a template for mailboxes: <code>Allow management of the password recovery email</code>: </p> <p>Note</p> <p>If a user has already set a backup email but the admin removes this ACL from them, they can still reset their password since the backup email remains in the system. The ACL does not automatically forbid the possibility of resetting the password if there is an email!</p> <p>To achieve this, the backup email for the user must also be removed by an administrator.</p>","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/#server-settings","level":4,"title":"Server Settings","text":"<p>The mailcow administrator can also edit the template for the \"Forgot Password\" emails, similar to the quota and quarantine emails, to customize how the emails are sent. By default, the template is always in English.</p> <p>This can be accessed under the tab: <code>System -&gt; Configuration -&gt; Options -&gt; Password Settings</code>:</p> <p></p>","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/#hidden-settings-not-in-the-mailcow-ui","level":3,"title":"Hidden Settings (not in the mailcow UI)","text":"<p>By default, each user can request a maximum of 3 password reset tokens, which are valid for 15 minutes.</p> <p>Server administrators can configure the expiration time and the maximum tokens per user.</p> <p>For this, a file named <code>vars.local.inc.php</code> must be created in the folder <code>MAILCOW_ROOT/data/web/inc</code> if it does not already exist.</p> <p>This file must contain at least the following:</p> <pre><code>&lt;?php\n\n// Maximum number of password reset tokens that can be generated at once per user\n$PW_RESET_TOKEN_LIMIT = 3; // Change this number to another value\n\n// Maximum time in minutes a password reset token is valid\n$PW_RESET_TOKEN_LIFETIME = 15; // Change this number to another value. Value in minutes\n</code></pre> <p>The file is automatically loaded, no restart of mailcow or any of the containers is required!</p>","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.de/","level":1,"title":"U e mailcow ui netfilter.de","text":"","path":["U e mailcow ui netfilter.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.de/#netfilter-ban-einstellungen-andern","level":2,"title":"Netfilter Ban-Einstellungen ändern","text":"<p>Um die Netfilter Ban-Einstellungen zu ändern navigieren Sie zu dem Menü Punkt: <code>Konfiguration -&gt; Server-Konfiguration -&gt; Konfiguration -&gt; Fail2ban-Parameter</code>.</p> <p>Sie sollten dann dieses Fenster sehen:</p> <p></p> <p>Hier können Sie verschiedene Optionen für die Banns selbst festlegen.  Zum Beispiel die max. Ban-Zeit oder die max. Versuche bevor ein Ban ausgeführt wird.</p>","path":["U e mailcow ui netfilter.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.de/#netfilter-regex-andern","level":2,"title":"Netfilter Regex ändern","text":"<p>Achtung</p> <p>Folgender Bereich erfordert zumindest grundlegende Regex kenntnisse.  Sollten Sie sich nicht sicher sein, was Sie dort tun, können wir Ihnen nur von der Umkonfiguration abraten.</p> <p>Sie können neben den Sperreinstellungen ebenfalls definieren, was genau aus den Logs der mailcow Container verwendet werden soll um einen möglichen Angreifer zu sperren.</p> <p>Dafür müssen Sie das Regex Feld erst einmal aufklappen, was dann in etwa so aussieht:</p> <p></p> <p>Dort können Sie nun verschiedenste neue Filter-Regeln anlegen.</p> <p>Hinweis</p> <p>Mit weiterschreitenden Updates ist es möglich, dass neue Netfilter Regex Regeln dazu kommen oder entfernt werden.  Sollte das der Fall sein empfiehlt es sich mit einem Klick auf <code>Zurücksetzen auf Standard</code> die Netfilter Regex Regeln neu laden zu lassen.</p>","path":["U e mailcow ui netfilter.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.de/#netfilter-entscheidungen-via-url-als-quelle-fur-firewall-blockregeln-bereitstellen","level":2,"title":"Netfilter Entscheidungen via URL als Quelle für Firewall Blockregeln bereitstellen","text":"<p>Hinweis</p> <p>Die Option ist jedoch standardmäßig deaktiviert und muss erst von Ihnen aktiviert werden.</p> <p>Seit dem 2023-12 Update bietet mailcow die Möglichkeit die Netfilter Entscheidungen als externer Endpoint zu exportieren um die Daten daraus in einem externen Firewall System einbinden zu können, Quasi als Blocklisten Quelle.</p> Was bringt mir diese Funktion? <p>Mit dieser Funktionalität können Sie die von Netfilter als gesperrt Markierten IPs an einen Endpunkt weitergeben, welcher diese IPs dann verarbeiten kann. Bspw. eine OPNsense Firewall kann diese Liste dynamisch reinladen.</p> <p>Schauen wir uns doch mal diese Einstellungen dazu an:</p> <p></p> <p>Um die generelle Funktion zu aktivieren muss der Haken bei <code>Fail2Ban extern verwalten</code> gesetzt werden.</p> <p>Sobald dies getan ist kann die URL (Punkt 2) kopiert werden und in den jeweiligen Endpunkt eingesetzt werden.</p> <p>Wichtig</p> <p>Die URL kann bei bedarf regeneriert werden. Dafür auf das Symbol neben Kopieren <code>Neuladen Symbol</code> klicken.</p>","path":["U e mailcow ui netfilter.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.en/","level":1,"title":"U e mailcow ui netfilter.en","text":"","path":["U e mailcow ui netfilter.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.en/#change-netfilter-ban-settings","level":2,"title":"Change Netfilter Ban Settings","text":"<p>To change the Netfilter settings in general please navigate to: <code>Configuration -&gt; Configuration &amp; Details -&gt; Configuration -&gt; Fail2ban parameters</code>.</p> <p>You should now see a familar interface:</p> <p></p> <p>Here you can set several options regarding the bans itself.  For example the max. Ban time or the max. attempts before a ban is executed.</p>","path":["U e mailcow ui netfilter.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.en/#change-netfilter-regex","level":2,"title":"Change Netfilter Regex","text":"<p>Danger</p> <p>The following area requires at least basic regex knowledge.  If you are not sure what you are doing there, we can only advise you not to attempt a reconfiguration.</p> <p>In addition to the ban settings, you can also define what exactly should be used from the mailcow container logs to ban a possible attacker.</p> <p>To do this, you must first expand the regex field, which will look something like this:</p> <p></p> <p>There you can now create various new filter rules.</p> <p>Info</p> <p>As updates progress, it is possible that new Netfilter regex rules will be added or removed.  If this is the case, it is recommended to reset the Netfilter regex rules by clicking on <code>Reset to default</code>.</p>","path":["U e mailcow ui netfilter.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.en/#provide-netfilter-decisions-via-url-as-source-for-firewall-block-rules","level":2,"title":"Provide Netfilter decisions via URL as source for firewall block rules","text":"<p>Info</p> <p>However, the option is deactivated by default and must first be activated by you.</p> <p>Since the 2023-12 update, mailcow offers the possibility to export the netfilter decisions as an external endpoint in order to be able to integrate the data from it into an external firewall system, quasi as a blocklist source.</p> What does this function do for me? <p>With this functionality, you can forward the IPs marked as blocked by Netfilter to an endpoint, which can then process these IPs. For example, an OPNsense firewall can dynamically load this list.</p> <p>Let's take a look at these settings:</p> <p></p> <p>To activate the general function, the checkbox <code>Manage Fail2Ban externally</code> must be checked.</p> <p>As soon as this is done, the URL (point 2) can be copied and pasted into the respective endpoint.</p> <p>Important</p> <p>The URL can be regenerated if required. To do this, click on the symbol next to Copy <code>Reload symbol</code>.</p>","path":["U e mailcow ui netfilter.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-notification-templates.de/","level":1,"title":"U e mailcow ui notification templates.de","text":"<p>mailcow verwendet für die Benachrichtigungs-Mails die Template-Engine Jinja. Durch Platzhalter können mit diesen Templates dynamische Inhalte erzeugt werden, indem bei der Ausführung diese Platzhalter mit übergeben Variablen ersetzt werden. Eine Doku zur Entwicklung von Jinja Templates findet sich hier. </p> <p>Für die Templates der Benachrichtungs-Emails können die folgenden Variablen verwendet werden:</p>","path":["U e mailcow ui notification templates.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-notification-templates.de/#quarantane-template","level":2,"title":"Quarantäne Template","text":"<p>Die bereitgestellten Variablen können auch auf GitHub aus dem Script dovecot/quarantine_notify.py entnommen werden.</p> <p>Info</p> <p>Das Template für die Qarantäne Mails kann man als Administrator in der Benutzeroberfläche in den globalen Quarantäne-Einstellungen bearbeiten und dort ebenso das Standard Template wiederherstellen.  Code Beispiele kann man dem Standard Template entnehmen. Es kann auch auf GitHub eingesehen werden.</p> Name Inhalt username E-Mail Adresse des Mailbox Benutzers counter Anzahl der Nachrichten in der Quarantäne, über die in dieser Mail benachrichtigt wird hostname Name der Mailcow Instanz (Siehe auch die Umgebungsvariable MAILCOW_HOSTNAME) quarantine_acl Einstellung der Quarantäne ACL des Benutzers (Berechtigung zur Bearbeitung von Mails in der Quarantäne) meta Array/Liste aller Nachrichten/Einträge in der Quarantäne, über die benachrichtigt wird meta.qhash Hashwert des Quarantäne Eintrags (Bspw für Direktlink zur Nachricht in der Quarantäne) meta.id ID des Quarantäne Eintrags meta.subject Titel der E-Mail des Quarantäne Eintrags meta.score Spam Score der E-Mail des Quarantäne Eintrags meta.sender Absender Adresse der E-Mail des Quarantäne Eintrags meta.created Datum der Erstellung des Quarantäne Eintrags, bzw Empfang der E-Mail meta.action Aktion des Spamfilters (Verschoben in Spam-Ordner oder in die Quarantäne)","path":["U e mailcow ui notification templates.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-notification-templates.de/#quota-template","level":2,"title":"Quota Template","text":"<p>Die bereitgestellten Variablen können auch auf GitHub aus dem Script dovecot/quota_notify.py entnommen werden.</p> <p>Info</p> <p>Das Template für die Quota Mails kann man als Administrator in der Benutzeroberfläche in den Quota-Einstellungen bearbeiten und dort ebenso das Standard Template wiederherstellen.  Code Beispiele kann man dem Standard Template entnehmen. Es kann auch auf GitHub eingesehen werden.</p> Name Inhalt username E-Mail Adresse des Mailbox Benutzers percent Prozentualer Anteil des belegten Speicherplatzes der Mailbox","path":["U e mailcow ui notification templates.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-notification-templates.en/","level":1,"title":"U e mailcow ui notification templates.en","text":"<p>mailcow uses the template engine Jinja for the notification mails. Placeholders can be used to create dynamic content with these templates by replacing them with passed variables during execution. A documentation about the development of Jinja templates can be found here.</p> <p>The following variables can be used for the notification email templates:</p>","path":["U e mailcow ui notification templates.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-notification-templates.en/#quarantine-template","level":2,"title":"Quarantine template","text":"<p>The provided variables can also be obtained on GitHub from the script dovecot/quarantine_notify.py.</p> <p>Info</p> <p>As an administrator, you can edit the template for the quarantine mails in the mailcow user interface in the global quarantine settings and restore the default template there as well.  Code examples can be found in the default template. It can also be viewed on GitHub.</p> Name Content username E-mail address of the mailbox user counter Number of messages in the quarantine, about which this e-mail informs hostname Name of the mailcow instance (See also the environment variable MAILCOW_HOSTNAME) quarantine_acl Quarantine ACL setting of the mailbox user (Permission to process the mails in the quarantine) meta Array/list of all messages in the quarantine about which this e-mail informs meta.qhash Hash value of the quarantine entry (e.g. for direct link to the message in the quarantine) meta.id ID of the quarantine entry meta.subject Title of the quarantine entry meta.score Spam score of the quarantine entry meta.sender Sender address of the quarantine entry meta.created Creation date of the quarantine entry / receipt of the e-mail meta.action Action of the spam filter (moved to spam folder or quarantine).","path":["U e mailcow ui notification templates.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-notification-templates.en/#quota-template","level":2,"title":"Quota template","text":"<p>The provided variables can also be obtained on GitHub from the script dovecot/quota_notify.py.</p> <p>Info</p> <p>The template for the quota mails can be edited as an administrator in the mailcow user interface in the quota settings and there also restore the default template.  Code examples can be found in the default template. It can also be viewed on GitHub.</p> Name Content username E-mail address of the mailbox user percent Percentage of the occupied space of the mailbox","path":["U e mailcow ui notification templates.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-pushover.de/","level":1,"title":"U e mailcow ui pushover.de","text":"<p>Info</p> <p>Pushover macht es einfach, Echtzeit-Benachrichtigungen auf Ihrem Android, iPhone, iPad und Desktop zu erhalten</p> <p>Sie können Pushover verwenden, um eine Push-Benachrichtigung über jede E-Mail zu erhalten, die Sie für jede Mailbox erhalten, in der Sie diese Funktion aktiviert haben.</p> <p>1. Öffnen Sie als Administrator die Einstellungen Ihres Postfachs und scrollen Sie nach unten zu den Pushover-Einstellungen</p> <p>2. Registrieren Sie sich bei Pushover</p> <p>3. Geben Sie Ihren \"Benutzerschlüssel\" in das Feld \"Benutzer-/Gruppenschlüssel\" in den Einstellungen Ihres Postfachs ein</p> <p>4. Erstellen Sie eine Anwendung, um das API-Token/den API-Schlüssel zu erhalten, das/den Sie ebenfalls in Ihre Postfacheinstellungen eintragen müssen.</p> <p>5. Optional können Sie den Titel/Text der Benachrichtigung bearbeiten und bestimmte Absender-E-Mail-Adressen festlegen, bei denen eine Push-Benachrichtigung ausgelöst wird</p> <p>6. Speichern Sie alles und überprüfen Sie dann Ihre Anmeldedaten.</p> <p>Wenn alles erledigt ist, können Sie testen, ob Sie eine E-Mail senden können, und Sie erhalten eine Push-Nachricht auf Ihrem Telefon</p>","path":["U e mailcow ui pushover.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-pushover.en/","level":1,"title":"U e mailcow ui pushover.en","text":"<p>Info</p> <p>Pushover makes it easy to get real-time notifications on your Android, iPhone, iPad, and Desktop</p> <p>You can use Pushover to get a push notification on every mail you receive for each mailbox where you enabled this feature.</p> <p>1. As admin open your mailbox' settings and scroll down to the Pushover settings</p> <p>2. Register yourself on Pushover</p> <p>3. Put your 'User Key' in the 'User/Group Key' field in your mailbox settings</p> <p>4. Create an Applications to get the API Token/Key which you also need to put in your mailbox settings</p> <p>5. Optional you can edit the notification title/text and define certain sender email addresses where a push notification is triggered</p> <p>6. Save everything and then you can verify your credentials</p> <p>If everything is done you can test sending a mail and you will receive a push message on your phone</p>","path":["U e mailcow ui pushover.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-spamalias.de/","level":1,"title":"U e mailcow ui spamalias.de","text":"<p>Diese temporären E-Mail-Aliasnamen werden meist dort verwendet, wo wir eine E-Mail-Adresse angeben müssen, aber keine weitere E-Mails wünschen. Sie werden auch Spam-Alias genannt.</p> <p>Um ein temporäres E-Mail-Alias zu erstellen, zu löschen oder zu erweitern, müssen Sie sich in mailcow's UI als Mailbox-Nutzer anmelden und zum Reiter Temporäre E-Mail-Aliase navigieren:</p> <p></p>","path":["U e mailcow ui spamalias.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-spamalias.en/","level":1,"title":"U e mailcow ui spamalias.en","text":"<p>These temporary email aliases are mostly used for places where we need to provide an email address but don't want future correspondence with. They are also called spam alias.</p> <p>To create, delete or extend a temporary email aliases you need to login to mailcow's UI as a mailbox user and navigate to the tab Temporary email aliases:</p> <p></p>","path":["U e mailcow ui spamalias.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-spamfilter.de/","level":1,"title":"U e mailcow ui spamfilter.de","text":"<p>Ein Mailbox-Nutzer kann den Spam-Filter und die Black-/Whitelist-Einstellungen für seine Mailbox individuell anpassen, indem er zum Reiter Spam-Filter in der mailcow-Benutzeroberfläche navigiert.</p> <p></p> <p>Info</p> <p>Für globale Einstellungen Ihres Spamfilters lesen Sie bitte unseren Abschnitt über Rspamd. Für eine domainweite Black- und Whitelist lesen Sie bitte unsere Anleitung zu Black / Whitelist</p>","path":["U e mailcow ui spamfilter.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-spamfilter.en/","level":1,"title":"U e mailcow ui spamfilter.en","text":"<p>A mailbox user may adjust the spam filter and black- / whitelist settings for his mailbox individually by navigating to the Spam filter tab in the users mailcow UI.</p> <p></p> <p>Info</p> <p>For global adjustments on your spam filter please check our section on Rspamd. For a domain wide black- and whitelist please check our guide on Black / Whitelist</p>","path":["U e mailcow ui spamfilter.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-sub_addressing.de/","level":1,"title":"U e mailcow ui sub addressing.de","text":"<p>Mailbox-Nutzer können ihre Mailadresse wie in \"me+facebook@example.org\" markieren. Sie können die Tag-Behandlung im mailcow UI Panel (für den Benutzer) unter <code>Mailbox &gt; Einstellungen</code> kontrollieren. </p> <p><code>Sub-Adressierung</code> (RFC 5233) oder <code>Plus-Adressierung</code> auch als Tagging bekannt (nicht zu verwechseln mit Tags)</p>","path":["U e mailcow ui sub addressing.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-sub_addressing.de/#verfugbare-aktionen","level":3,"title":"Verfügbare Aktionen","text":"<p>1. Diese Nachricht in einen Unterordner \"facebook\" verschieben (wird in Kleinbuchstaben erstellt, falls nicht vorhanden)</p> <p>2. Den Tag dem Betreff voranstellen: \"[facebook] Betreff\"</p> <p>Bitte beachten Sie: Großgeschriebene Tags werden in Kleinbuchstaben umgewandelt, mit Ausnahme des ersten Buchstabens. Wenn Sie den Tag so lassen wollen, wie er ist, wenden Sie bitte den folgenden Diff an und starten Sie mailcow neu: <pre><code>diff --git a/data/conf/dovecot/global_sieve_after b/data/conf/dovecot/global_sieve_after\nindex e047136e..933c4137 100644\n--- a/data/conf/dovecot/global_sieve_after\n+++ b/data/conf/dovecot/global_sieve_after\n@@ -15,7 +15,7 @@ if allof (\n   envelope :detail :matches \"to\" \"*\",\n   header :contains \"X-Moo-Tag\" \"YES\"\n   ) {\n-  set :lower :upperfirst \"tag\" \"${1}\";\n+  set \"tag\" \"${1}\";\n   if mailboxexists \"INBOX/${1}\" {\n     fileinto \"INBOX/${1}\";\n   } else {\n</code></pre></p>","path":["U e mailcow ui sub addressing.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-sub_addressing.en/","level":1,"title":"U e mailcow ui sub addressing.en","text":"<p>Mailbox users can tag their mail address like in <code>me+facebook@example.org</code>. They can control the tag handling in the users mailcow UI panel under <code>Mailbox &gt; Settings</code>. </p> <p><code>sub-addressing</code> (RFC 5233) or <code>plus addressing</code> also known as tagging (do not mix with Tags)</p>","path":["U e mailcow ui sub addressing.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-sub_addressing.en/#available-actions","level":3,"title":"Available Actions","text":"<p>1. Move this message to a sub folder \"facebook\" (will be created lower case if not existing)</p> <p>2. Prepend the tag to the subject: \"[facebook] Subject\"</p> <p>Please note: Uppercase tags are converted to lowercase except for the first letter. If you want to keep the tag as it is, please apply the following diff and restart mailcow: <pre><code>diff --git a/data/conf/dovecot/global_sieve_after b/data/conf/dovecot/global_sieve_after\nindex e047136e..933c4137 100644\n--- a/data/conf/dovecot/global_sieve_after\n+++ b/data/conf/dovecot/global_sieve_after\n@@ -15,7 +15,7 @@ if allof (\n   envelope :detail :matches \"to\" \"*\",\n   header :contains \"X-Moo-Tag\" \"YES\"\n   ) {\n-  set :lower :upperfirst \"tag\" \"${1}\";\n+  set \"tag\" \"${1}\";\n   if mailboxexists \"INBOX/${1}\" {\n     fileinto \"INBOX/${1}\";\n   } else {\n</code></pre></p>","path":["U e mailcow ui sub addressing.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tags.de/","level":1,"title":"U e mailcow ui tags.de","text":"<p>Hinweis</p> <p>Um diese Funktion nutzen zu können ist das Update 2022-05 (oder höher) erforderlich! Sollten Sie das Update nicht installiert haben, denken Sie bitte über ein Update nach. Für weitere Informationen bezüglich dem Update Prozess schauen Sie hier.</p>","path":["U e mailcow ui tags.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tags.de/#wofur-wurden-die-tags-implementiert","level":3,"title":"Wofür wurden die Tags implementiert?","text":"<p>Mit den Tags ist es deutlich einfacher gezielt nach Domains bzw. Mailboxen zu suchen (wenn diese einen Tag haben).</p>","path":["U e mailcow ui tags.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tags.de/#wo-lassen-sich-die-tags-finden","level":3,"title":"Wo lassen sich die Tags finden?","text":"<p>Die Tags befinden sich in der Domain/Mailbox Sektion der mailcow UI. Um sie zu sehen, klicken Sie einfach auf das kleine Plus-Symbol auf der linken Seite Ihrer Domain/Mailbox (das folgende Bild zeigt das Domain-Ribbon-Menü): </p>","path":["U e mailcow ui tags.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tags.de/#wie-kann-ich-ein-tag-hinzufugenentfernen","level":3,"title":"Wie kann ich ein Tag hinzufügen/entfernen?","text":"<p>Sie können bei der Erstellung einer neuen Domain/eines neuen Postfachs einfach ein Tag hinzufügen/entfernen. Sie können sie auch hinzufügen/entfernen, wenn Sie Ihre gewünschte Domain/Mailbox bearbeiten.</p> <p>Es sieht ähnlich aus wie hier (das folgende Bild zeigt den Bereich zur Bearbeitung der Domäne):</p> <p></p>","path":["U e mailcow ui tags.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tags.de/#wie-kann-ich-nach-einem-tag-suchen","level":3,"title":"Wie kann ich nach einem Tag suchen?","text":"<p>Geben Sie einfach den Tag-Namen in die Suchleiste im Bereich Domain/Postfach ein und warten Sie, bis der Vorgang abgeschlossen ist.</p> <p>Sie können sogar angeben, ob Sie nur nach Tags suchen möchten.</p>","path":["U e mailcow ui tags.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tags.en/","level":1,"title":"U e mailcow ui tags.en","text":"<p>Info</p> <p>You need the mailcow Version 2022-05 at least for this feature. If you don´t have the Version installed please consider a update. For more informations about a mailcow update please take a look at the Update section here in the docs.</p>","path":["U e mailcow ui tags.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tags.en/#what-are-tags-designed-for","level":3,"title":"What are Tags designed for?","text":"<p>With the Tags you can easily sort your Domains and Mailboxes by the tags instead of their name.</p>","path":["U e mailcow ui tags.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tags.en/#where-are-the-tags-located","level":3,"title":"Where are the Tags located?","text":"<p>The Tags are located in the Domain/Mailbox section of the mailcow UI. To view them simply click on the small plus symbol on the left of your Domain/Mailbox (following picture is showing the domain ribbon menu): </p>","path":["U e mailcow ui tags.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tags.en/#how-can-i-addremove-a-tag","level":3,"title":"How can i add/remove a Tag?","text":"<p>You can simply add/remove a Tag during the creation of a new Domain/Mailbox. You also can add/remove them if you edit your desired Domain/Mailbox.</p> <p>It looks similar to this (following picture showing the domain edit section):</p> <p></p>","path":["U e mailcow ui tags.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tags.en/#how-can-i-search-for-a-tag","level":3,"title":"How can i search for a tag?","text":"<p>Simply type the Tag Name in the search bar in the Domain/Mailbox Section and wait for it to complete.</p> <p>You can even specify if you want to search for tags only.</p>","path":["U e mailcow ui tags.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/","level":1,"title":"U e mailcow ui tfa.de","text":"<p>Bislang sind drei Methoden für die Zwei-Faktor-Authentifizierung implementiert: WebAuthn (ersetzt seit Februar 2022 U2F), Yubi OTP und TOTP</p> <ul> <li>Damit WebAuthn funktioniert, benötigen Sie eine verschlüsselte Verbindung zum Server (HTTPS) sowie einen FIDO-Sicherheitsschlüssel.</li> <li>Sowohl WebAuthn als auch Yubi OTP funktionieren gut mit dem fantastischen Yubikey.</li> <li>Während Yubi OTP eine aktive Internetverbindung und eine API ID + Schlüssel benötigt, funktioniert WebAuthn mit jedem Fido Security Key, kann aber nur verwendet werden, wenn der Zugriff auf mailcow über HTTPS erfolgt.</li> <li>WebAuthn und Yubi OTP unterstützen mehrere Schlüssel pro Nutzer.</li> <li>Als dritte TFA-Methode verwendet mailcow TOTP: zeitbasierte Einmal-Passwörter. Diese Passwörter können mit Apps wie \"Google Authenticator\" generiert werden, nachdem zunächst ein QR-Code gescannt oder das gegebene Geheimnis manuell eingegeben wurde.</li> </ul> <p>Als Administrator können Sie den TFA-Login eines Domain-Administrators vorübergehend deaktivieren, bis dieser sich erfolgreich eingeloggt hat.</p> <p>Der für die Anmeldung verwendete Schlüssel wird in grüner Farbe angezeigt, während andere Schlüssel grau bleiben.</p> <p>Informationen zum Entfernen von 2FA finden Sie hier.</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#yubi-otp","level":2,"title":"Yubi OTP","text":"<p>Die Yubi API ID und der Schlüssel werden mit der Yubico Cloud API abgeglichen. Bei der Einrichtung von TFA werden Sie nach Ihrem persönlichen API-Konto für diesen Schlüssel gefragt. Die API-ID, der API-Schlüssel und die ersten 12 Zeichen (Ihre YubiKeys ID in modhex) werden in der MySQL-Tabelle als Geheimnis gespeichert.</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#beispiel-einrichtung","level":3,"title":"Beispiel-Einrichtung","text":"<p>Als erstes muss der YubiKey für die Verwendung als OTP-Generator konfiguriert werden. Laden Sie dazu den <code>YubiKey Manager</code> von der Yubico Website herunter: hier</p> <p>Im Folgenden konfigurieren Sie den YubiKey für OTP. Über den Menüpunkt <code>Anwendungen</code> -&gt; <code>OTP</code> und einem Klick auf den <code>Konfigurieren</code> Button. Wählen Sie im folgenden Menü <code>Credential Type</code> -&gt; <code>Yubico OTP</code> und klicken Sie auf <code>Next</code>.</p> <p>Setzen Sie ein Häkchen in die Checkbox <code>Use serial</code>, generieren Sie eine <code>Private ID</code> und einen <code>Secret key</code> über die Schaltflächen.  Damit der YubiKey später validiert werden kann, muss auch das Häkchen in der <code>Upload</code> Checkbox gesetzt werden und klicken Sie dann auf <code>Finish</code>.</p> <p>Nun öffnet sich ein neues Browserfenster, in dem Sie unten im Formular ein OTP Ihres YubiKey eingeben müssen (auf das Feld klicken und dann auf Ihren YubiKey tippen). Bestätigen Sie das Captcha und laden Sie die Daten auf den Yubico-Server hoch, indem Sie auf 'Hochladen' klicken. Die Verarbeitung der Daten wird einen Moment dauern.</p> <p>Nachdem die Generierung erfolgreich war, werden Ihnen eine <code>Client ID</code> und ein <code>Secret key</code> angezeigt, notieren Sie sich diese Informationen an einem sicheren Ort.</p> <p>Nun können Sie <code>Yubico OTP-Authentifizierung</code> aus dem Dropdown-Menü in der mailcow UI auf der Startseite unter <code>Zugang</code> -&gt; <code>Zwei-Faktor-Authentifizierung</code> auswählen.  In dem sich nun öffnenden Dialog können Sie einen Namen für diesen YubiKey eingeben und die zuvor notierte <code>Client ID</code> sowie den <code>Secret key</code> in die vorgesehenen Felder eintragen. Geben Sie schließlich Ihr aktuelles Kontopasswort ein und berühren Sie nach Auswahl des Feldes <code>Touch Yubikey</code> die Schaltfläche Ihres YubiKey.</p> <p>Herzlichen Glückwunsch! Sie können sich nun mit Ihrem YubiKey in die mailcow UI einloggen!</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#webauthn-u2f-ersatz","level":2,"title":"WebAuthn (U2F, Ersatz)","text":"<p>Warnung</p> <p>Seit Februar 2022 hat Google Chrome die Unterstützung für U2F aufgegeben und die Verwendung von WebAuthn standardisiert. Die WebAuthn API (der Ersatz für U2F) ist seit dem 21. Januar 2022 Teil von mailcow, wenn Sie also den Key über Februar 2022 hinaus nutzen wollen, sollten Sie ein Update mit der <code>update.sh</code> in Betracht ziehen. </p> <p>Um WebAuthn zu nutzen, muss der Browser diesen Standard unterstützen:</p> <ul> <li>Edge (&gt;=18)</li> <li>Firefox (&gt;=60)</li> <li>Chrome (&gt;=67)</li> <li>Safari (&gt;=13)</li> <li>Opera (&gt;=54)</li> </ul> <p>Die folgenden mobilen Browser unterstützen diesen Authentifizierungstyp:</p> <ul> <li>Safari auf iOS (&gt;=14.5)</li> <li>Android-Browser (&gt;=97)</li> <li>Opera Mobil (&gt;=64)</li> <li>Chrome für Android (&gt;=97)</li> </ul> <p>Quellen: caniuse.com, blog.mozilla.org</p> <p>WebAuthn funktioniert auch ohne Internetverbindung.</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#was-passiert-mit-meinem-registrierten-fido-security-key-nach-dem-update-von-u2f-auf-webauthn","level":3,"title":"Was passiert mit meinem registrierten Fido Security Key nach dem Update von U2F auf WebAuthn?","text":"<p>Warnung</p> <p>Mit dem neuen U2F-Ersatz (WebAuthn) müssen Sie Ihren Fido Security Key neu registrieren, zum Glück ist WebAuthn abwärtskompatibel und unterstützt das U2F-Protokoll.</p> <p>Im Idealfall sollten Sie beim nächsten Einloggen (mit dem Schlüssel) ein Textfeld erhalten, das besagt, dass Ihr Fido Security Key aufgrund des Updates auf WebAuthn entfernt und als 2-Faktor-Authentifikator gelöscht wurde.</p> <p>Aber keine Sorge! Sie können Ihren bestehenden Schlüssel einfach neu registrieren und ihn wie gewohnt verwenden. Sie werden wahrscheinlich nicht einmal einen Unterschied bemerken, außer dass Ihr Browser die U2F-Deaktivierungsmeldung nicht mehr anzeigt.</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#deaktivieren-inoffizieller-unterstutzter-fido-security-keys","level":3,"title":"Deaktivieren inoffizieller unterstützter Fido Security Keys","text":"<p>Mit WebAuthn gibt es die Möglichkeit, nur offizielle Fido Security Keys zu verwenden (von den großen Marken wie: Yubico, Apple, Nitro, Google, Huawei, Microsoft, usw.) zu verwenden.</p> <p>Dies dient in erster Linie der Sicherheit, da es Administratoren ermöglicht, sicherzustellen, dass nur offizielle Hardware in ihrer Umgebung verwendet werden kann.</p> <p>Um diese Funktion zu aktivieren, ändern Sie den Wert <code>WEBAUTHN_ONLY_TRUSTED_VENDORS</code> in mailcow.conf von <code>n</code> auf <code>y</code> und starten Sie die betroffenen Container mit dem folgenden Befehl neu: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Die mailcow wird nun die Vendor-Zertifikate verwenden, die sich in Ihrem mailcow-Verzeichnis unter <code>data/web/inc/lib/WebAuthn/rootCertificates</code> befinden. </p> <p>Beispiel</p> <p>Wenn Sie die offiziellen Hersteller-Geräte nur auf Apple beschränken wollen, brauchen Sie nur das Apple Hersteller-Zertifikat im <code>data/web/inc/lib/WebAuthn/rootCertificates</code>. Nachdem Sie alle anderen Zertifikate gelöscht haben, können Sie WebAuthn 2FA nur noch mit Apple-Geräten aktivieren.</p> <p>Das ist für jeden Hersteller gleich, also wählen Sie aus, was Ihnen gefällt (wenn Sie wollen).</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#eigene-zertifikate-fur-webauthn-verwenden","level":3,"title":"Eigene Zertifikate für WebAuthn verwenden","text":"<p>Wenn Sie ein gültiges Zertifikat vom Hersteller eines Schlüssels haben, können Sie es auch zu ihrer mailcow hinzufügen!</p> <p>Kopieren Sie einfach das Zertifikat in den <code>data/web/inc/lib/WebAuthn/rootCertificates</code> Ordner und starten Sie Ihre mailcow neu.</p> <p>Nun sollten Sie in der Lage sein, auch dieses Gerät zu registrieren, obwohl die Überprüfung für die Herstellerzertifikate aktiviert ist, da Sie das Zertifikat manuell hinzugefügt haben. </p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#ist-es-gefahrlich-den-vendor-check-deaktiviert-zu-lassen","level":3,"title":"Ist es gefährlich, den Vendor Check deaktiviert zu lassen?","text":"<p>Nein, das ist es nicht! Diese Herstellerzertifikate werden nur zur Überprüfung der Originalhardware verwendet, nicht zur Absicherung des Registrierungsprozesses.</p> <p>Wie Sie in diesen Artikeln lesen können, hat die Deaktivierung nichts mit der Software-Sicherheit zu tun:</p> <ul> <li>https://developers.yubico.com/U2F/Attestation_and_Metadata/</li> <li>https://medium.com/webauthnworks/webauthn-fido2-demystifying-attestation-and-mds-efc3b3cb3651</li> <li>https://medium.com/webauthnworks/sorting-fido-ctap-webauthn-terminology-7d32067c0b01</li> </ul> <p>Letztendlich ist es aber natürlich Ihre Entscheidung, ob Sie dieses Häkchen deaktiviert oder aktiviert lassen. </p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#totp","level":2,"title":"TOTP","text":"<p>Die bekannteste TFA-Methode, die meist mit einem Smartphone verwendet wird.</p> <p>Um die TOTP-Methode einzurichten, loggen Sie sich in die Admin UI ein und wählen Sie <code>Time-based OTP (TOTP)</code> aus der Liste.</p> <p>Nun öffnet sich ein Modal, in dem Sie einen Namen für Ihr 2FA-\"Gerät\" (Beispiel: John Deer's Smartphone) und das Passwort des betroffenen Admin-Kontos (mit dem Sie derzeit eingeloggt sind) eingeben müssen.</p> <p>Sie haben zwei verschiedene Methoden, um TOTP für Ihr Konto zu registrieren: 1. Scannen Sie den QR-Code mit Ihrer Authenticator App auf einem Smartphone oder Tablet. 2. Verwenden Sie den TOTP-Code (unter dem QR-Code) in Ihrem TOTP-Programm oder Ihrer App (wenn Sie keinen QR-Code scannen können).</p> <p>Nachdem Sie den QR- oder TOTP-Code in der TOTP-App/dem TOTP-Programm Ihrer Wahl registriert haben, müssen Sie nur noch den nun generierten TOTP-Token (in der App/dem Programm) als Bestätigung in der mailcow UI eingeben, um die TOTP 2FA endgültig zu aktivieren, ansonsten wird sie nicht aktiviert, obwohl der TOTP-Token bereits in Ihrer App/ Ihrem Programm generiert wurde.</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/","level":1,"title":"U e mailcow ui tfa.en","text":"<p>So far three methods for Two-Factor Authentication are implemented: WebAuthn (replacing U2F since February 2022), Yubi OTP, and TOTP</p> <ul> <li>For WebAuthn to work, you need an encrypted connection to the server (HTTPS) as well as a FIDO security key.</li> <li>Both WebAuthn and Yubi OTP work well with the fantastic Yubikey.</li> <li>While Yubi OTP needs an active internet connection and an API ID + key, WebAuthn will work with any Fido Security Key out of the box, but can only be used when mailcow is accessed over HTTPS.</li> <li>WebAuthn and Yubi OTP support multiple keys per user.</li> <li>As the third TFA method mailcow uses TOTP: time-based one-time passwords. Those passwords can be generated with apps like \"Google Authenticator\" after initially scanning a QR code or entering the given secret manually.</li> </ul> <p>As administrator you are able to temporary disable a domain administrators TFA login until they successfully logged in.</p> <p>The key used to login will be displayed in green, while other keys remain grey.</p> <p>Information on how to remove 2FA can be found here.</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#yubi-otp","level":2,"title":"Yubi OTP","text":"<p>The Yubi API ID and Key will be checked against the Yubico Cloud API. When setting up TFA you will be asked for your personal API account for this key. The API ID, API key and the first 12 characters (your YubiKeys ID in modhex) are stored in the MySQL table as secret.</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#example-setup","level":3,"title":"Example setup","text":"<p>First of all, the YubiKey must be configured for use as an OTP Generator. To do this, download the <code>YubiKey Manager</code> from the Yubico website: here</p> <p>In the following you configure the YubiKey for OTP. Via the menu item <code>Applications</code> -&gt; <code>OTP</code> and a click on the <code>Configure</code> button. In the following menu select <code>Credential Type</code> -&gt; <code>Yubico OTP</code> and click on <code>Next</code>.</p> <p>Set a checkmark in the <code>Use serial</code> checkbox, generate a <code>Private ID</code> and a <code>Secret key</code> via the buttons.  So that the YubiKey can be validated later, the checkmark in the <code>Upload</code> checkbox must also be set and then click on <code>Finish</code>.</p> <p>Now a new browser window will open in which you have to enter an OTP of your YubiKey at the bottom of the form (click on the field and then tap on your YubiKey). Confirm the captcha and upload the information to the Yubico server by clicking 'Upload'. The processing of the data will take a moment.</p> <p>After the generation was successful, you will be shown a <code>Client ID</code> and a <code>Secret key</code>, make a note of this information in a safe place.</p> <p>Now you can select <code>Yubico OTP authentication</code> from the dropdown menu in the mailcow UI on the start page under <code>Access</code> -&gt; <code>Two-factor authentication</code>.  In the dialog that opened now you can enter a name for this YubiKey and insert the <code>Client ID</code> you noted before as well as the <code>Secret key</code> into the fields provided. Finally, enter your current account password and, after selecting the <code>Touch Yubikey</code> field, touch your YubiKey button.</p> <p>Congratulations! You can now log in to the mailcow UI using your YubiKey!</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#webauthn-u2f-replacement","level":2,"title":"WebAuthn (U2F, replacement)","text":"<p>Warning</p> <p>Since February 2022 Google Chrome has discarded support for U2F and standardized the use of WebAuthn. The WebAuthn (U2F removal) is part of mailcow since 21th January 2022, so if you want to use the Key past February 2022 please consider a update with the <code>update.sh</code> </p> <p>To use WebAuthn, the browser must support this standard.</p> <p>The following desktop browsers support this authentication type:</p> <ul> <li>Edge (&gt;=18)</li> <li>Firefox (&gt;=60)</li> <li>Chrome (&gt;=67)</li> <li>Safari (&gt;=13)</li> <li>Opera (&gt;=54)</li> </ul> <p>The following mobile browsers support this authentication type:</p> <ul> <li>Safari on iOS (&gt;=14.5)</li> <li>Android Browser (&gt;=97)</li> <li>Opera Mobile (&gt;=64)</li> <li>Chrome for Android (&gt;=97)</li> </ul> <p>Sources: caniuse.com, blog.mozilla.org</p> <p>WebAuthn works without an internet connection.</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#what-will-happen-to-my-registered-fido-security-key-after-the-update-from-u2f-to-webauthn","level":3,"title":"What will happen to my registered Fido Security Key after the Update from U2F to WebAuthn?","text":"<p>Warning</p> <p>With this new U2F replacement (WebAuthn) you have to re-register your Fido Security Key, thankfully WebAuthn is backwards compatible and supports the U2F protocol.</p> <p>Ideally, the next time you log in (with the key), you should get a text box saying that your Fido Security Key has been removed due to the update to WebAuthn and deleted as a 2-factor authenticator.</p> <p>But don't worry! You can simply re-register your existing key and use it as usual, you probably won't even notice a difference, except that your browser won't show the U2F deactivation message anymore.</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#disable-unofficial-supported-fido-security-keys","level":3,"title":"Disable unofficial supported Fido Security Keys","text":"<p>With WebAuthn there is the possibility to use only official Fido Security Keys (from the big brands like: Yubico, Apple, Nitro, Google, Huawei, Microsoft, etc.).</p> <p>This is primarily for security purposes, as it allows administrators to ensure that only official hardware can be used in their environment.</p> <p>To enable this feature, change the value <code>WEBAUTHN_ONLY_TRUSTED_VENDORS</code> in mailcow.conf from <code>n</code> to <code>y</code> and restart the affected containers with the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>The mailcow will now use the Vendor Certificates located in your mailcow directory under <code>data/web/inc/lib/WebAuthn/rootCertificates</code>. </p> <p>Example</p> <p>If you want to limit the official Vendor devices to Apple only you only need the Apple Vendor Certificate inside the <code>data/web/inc/lib/WebAuthn/rootCertificates</code>. After you deleted all other certs you now only can activate WebAuthn 2FA with Apple devices.</p> <p>Every vendor (listed there) behaves the same, so choose what you like (if you want to).</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#use-own-certificates-for-webauthn","level":3,"title":"Use own certificates for WebAuthn","text":"<p>If you have a valid certificate from the vendor of your key you can also add it to your mailcow!</p> <p>Just copy the certificate into the <code>data/web/inc/lib/WebAuthn/rootCertificates</code> folder and restart your mailcow.</p> <p>Now you should be able to register this device as well, even though the verification for the vendor certificates is enabled, since you just added the certificate manually. </p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#is-it-dangerous-to-keep-the-vendor-check-disabled","level":3,"title":"Is it dangerous to keep the Vendor Check disabled?","text":"<p>No, it isn´t! These vendor certificates are only used to verify original hardware, not to secure the registration process.</p> <p>As you can read in these articles, the deactivation is not software security related:</p> <ul> <li>https://developers.yubico.com/U2F/Attestation_and_Metadata/</li> <li>https://medium.com/webauthnworks/webauthn-fido2-demystifying-attestation-and-mds-efc3b3cb3651</li> <li>https://medium.com/webauthnworks/sorting-fido-ctap-webauthn-terminology-7d32067c0b01</li> </ul> <p>In the end, however, it is of course your decision to leave this check disabled or enabled. </p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"de/manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#totp","level":2,"title":"TOTP","text":"<p>The best known TFA method mostly used with a smartphone.</p> <p>To setup the TOTP method login to the Admin UI and select <code>Time-based OTP (TOTP)</code> from the list.</p> <p>Now a modal will open in which you have to type in a name for your 2FA \"device\" (example: John Deer´s Smartphone) and the password of the affected Admin account (you are currently logged in with).</p> <p>You have two seperate methods to register TOTP to your account: 1. Scan the QR-Code with your Authenticator App on a Smartphone or Tablet. 2. Use the TOTP Code (under the QR Code) in your TOTP Program or App (if you can´t scan a QR Code).</p> <p>After you have registered the QR or TOTP code in the TOTP app/program of your choice you only need to enter the now generated TOTP token (in the app/program) as confirmation in the mailcow UI to finally activate the TOTP 2FA, otherwise it will not be activated even though the TOTP token is already generated in your app/program.</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"de/models/model-acl.de/","level":1,"title":"Model acl.de","text":"<p>Die Bearbeitung eines Domänenadministrators oder eines Mailboxbenutzers ermöglicht es, Einschränkungen für dieses Konto festzulegen.</p> <p>Wichtig: Bei sich überschneidenden Modulen wie Synchronisierungsaufträgen, auf die sowohl Domänenadministratoren als auch Mailbox-Benutzer Zugriff erhalten können, werden die Rechte des Domänenadministrators geerbt, wenn man sich als Mailbox-Benutzer anmeldet.</p> <p>Einige Beispiele:</p> <p>1.</p> <ul> <li>Ein Domänenadministrator hat keinen Zugriff auf Synchronisierungsaufträge, kann sich aber als Mailbox-Benutzer anmelden</li> <li>Wenn er sich als Mailbox-Benutzer anmeldet, erhält er keinen Zugriff auf Synchronisierungsaufträge, auch wenn der betreffende Mailbox-Benutzer bei der direkten Anmeldung Zugriff hat.</li> </ul> <p>2.</p> <ul> <li>Ein Domänenadministrator hat Zugriff auf Synchronisierungsaufträge und kann sich als Postfachbenutzer anmelden</li> <li>Der Mailbox-Benutzer, als der er sich anzumelden versucht, hat keinen Zugang zu Synchronisierungsaufträgen</li> <li>Der Domänenadministrator, der nun als Mailbox-Benutzer angemeldet ist, erbt die Berechtigung des Mailbox-Benutzers und kann auf Synchronisierungsaufträge zugreifen.</li> </ul> <p>3.</p> <ul> <li>Ein Domänenadministrator meldet sich als Mailbox-Benutzer an</li> <li>Jede Berechtigung, die nicht in der ACL eines Domänenadministrators vorhanden ist, wird automatisch gewährt (Beispiel: zeitlich begrenzter Alias, TLS-Richtlinie usw.)</li> </ul>","path":["Model acl.de"],"tags":[]},{"location":"de/models/model-acl.en/","level":1,"title":"Model acl.en","text":"<p>Editing a domain administrator or a mailbox user allows to set restrictions to that account.</p> <p>Important: For overlapping modules like sync jobs, which both domain administrators and mailbox users can be granted access to, the domain administrators permissions are inherited, when logging in as mailbox user.</p> <p>Some examples:</p> <p>1.</p> <ul> <li>A domain administror has not access to sync jobs but can login as mailbox user</li> <li>When logging in as mailbox user, he does not gain access to sync jobs, even if the given mailbox user has access when logging in directly</li> </ul> <p>2.</p> <ul> <li>A domain administror has access to sync jobs and can login as mailbox user</li> <li>The mailbox user he tries to login as has not access to sync jobs</li> <li>The domain administrator, now logged in as mailbox user, inherits its permission to the mailbox user and can access sync jobs</li> </ul> <p>3.</p> <ul> <li>A domain administrator logs in as mailbox user</li> <li>Every permission, that does not exist in a domain administrators ACL, is automatically granted (example: time-limited alias, TLS policy etc.)</li> </ul>","path":["Model acl.en"],"tags":[]},{"location":"de/models/model-passwd.de/","level":1,"title":"Model passwd.de","text":"","path":["Model passwd.de"],"tags":[]},{"location":"de/models/model-passwd.de/#vollstandig-unterstutzte-hashing-methoden","level":2,"title":"Vollständig unterstützte Hashing-Methoden","text":"<p>Die aktuellste Version von mailcow unterstützt die folgenden Hashing-Methoden vollständig. Die Standard-Hashing-Methode ist fett geschrieben:</p> <ul> <li>BLF-CRYPT</li> <li>SSHA</li> <li>SSHA256</li> <li>SSHA512</li> </ul> <p>Die obigen Methoden können in <code>mailcow.conf</code> als <code>MAILCOW_PASS_SCHEME</code> Wert verwendet werden.</p>","path":["Model passwd.de"],"tags":[]},{"location":"de/models/model-passwd.de/#nur-lese-hashing-methoden","level":2,"title":"Nur-Lese-Hashing-Methoden","text":"<p>Die folgenden Methoden werden nur lesend unterstützt. Wenn Sie planen, SOGo zu benutzen (wie standardmäßig), benötigen Sie eine SOGo-kompatible Hash-Methode. Bitte beachten Sie den Hinweis am Ende dieser Seite, wie Sie die Ansicht bei Bedarf aktualisieren können. Wenn SOGo deaktiviert ist, können alle unten aufgeführten Hashing-Methoden von mailcow und Dovecot gelesen werden.</p> <ul> <li>ARGON2I (SOGo kompatibel)</li> <li>ARGON2ID (SOGo kompatibel)</li> <li>CLEAR</li> <li>CLEARTEXT</li> <li>CRYPT (SOGo-kompatibel)</li> <li>DES-CRYPT</li> <li>LDAP-MD5 (SOGo-kompatibel)</li> <li>MD5 (SOGo-kompatibel)</li> <li>MD5-CRYPT (SOGo-kompatibel)</li> <li>PBKDF2 (SOGo-kompatibel)</li> <li>PLAIN (SOGo-kompatibel)</li> <li>PLAIN-MD4</li> <li>PLAIN-MD5</li> <li>PLAIN-TRUNC</li> <li>SHA (SOGo-kompatibel)</li> <li>SHA1 (SOGo-kompatibel)</li> <li>SHA256 (SOGo-kompatibel)</li> <li>SHA256-CRYPT (SOGo-kompatibel)</li> <li>SHA512 (SOGo-kompatibel)</li> <li>SHA512-CRYPT (SOGo-kompatibel)</li> <li>SMD5 (SOGo kompatibel)</li> </ul> <p>Das bedeutet, mailcow ist in der Lage, Nutzer mit einem Hash wie <code>{MD5}1a1dc91c907325c69271ddf0c944bc72</code> aus der Datenbank zu verifizieren.</p> <p>Der Wert von <code>MAILCOW_PASS_SCHEME</code> wird immer verwendet, um neue Passwörter zu verschlüsseln.</p> <p>Ich habe die Passwort-Hashes in der SQL-Tabelle \"Mailbox\" geändert und kann mich nicht anmelden.</p> <p>Eine \"Ansicht\" muss aktualisiert werden. Sie können dies durch einen Neustart von sogo-mailcow auslösen: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart sogo-mailcow\n</code></pre> <pre><code>docker-compose restart sogo-mailcow\n</code></pre>","path":["Model passwd.de"],"tags":[]},{"location":"de/models/model-passwd.en/","level":1,"title":"Model passwd.en","text":"","path":["Model passwd.en"],"tags":[]},{"location":"de/models/model-passwd.en/#fully-supported-hashing-methods","level":2,"title":"Fully supported hashing methods","text":"<p>The most current mailcow fully supports the following hashing methods. The default hashing method is written in bold:</p> <ul> <li>BLF-CRYPT</li> <li>SSHA</li> <li>SSHA256</li> <li>SSHA512</li> </ul> <p>The methods above can be used in <code>mailcow.conf</code> as <code>MAILCOW_PASS_SCHEME</code> value.</p>","path":["Model passwd.en"],"tags":[]},{"location":"de/models/model-passwd.en/#read-only-hashing-methods","level":2,"title":"Read-only hashing methods","text":"<p>The following methods are supported read only. If you plan to use SOGo (as per default), you need a SOGo compatible hashing method. Please see the note at the bottom of this page how to update the view if necessary. With SOGo disabled, all hashing methods below will be able to be read by mailcow and Dovecot.</p> <ul> <li>ARGON2I (SOGo compatible)</li> <li>ARGON2ID (SOGo compatible)</li> <li>CLEAR</li> <li>CLEARTEXT</li> <li>CRYPT (SOGo compatible)</li> <li>DES-CRYPT</li> <li>LDAP-MD5 (SOGo compatible)</li> <li>MD5 (SOGo compatible)</li> <li>MD5-CRYPT (SOGo compatible)</li> <li>PBKDF2 (SOGo compatible)</li> <li>PLAIN (SOGo compatible)</li> <li>PLAIN-MD4</li> <li>PLAIN-MD5</li> <li>PLAIN-TRUNC</li> <li>SHA (SOGo compatible)</li> <li>SHA1 (SOGo compatible)</li> <li>SHA256 (SOGo compatible)</li> <li>SHA256-CRYPT (SOGo compatible)</li> <li>SHA512 (SOGo compatible)</li> <li>SHA512-CRYPT (SOGo compatible)</li> <li>SMD5 (SOGo compatible)</li> </ul> <p>That means mailcow is able to verify users with a hash like <code>{MD5}1a1dc91c907325c69271ddf0c944bc72</code> from the database.</p> <p>The value of <code>MAILCOW_PASS_SCHEME</code> will always be used to encrypt new passwords.</p> <p>I changed the password hashes in the \"mailbox\" SQL table and cannot login.</p> <p>A \"view\" needs to be updated. You can trigger this by restarting sogo-mailcow: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart sogo-mailcow\n</code></pre> <pre><code>docker-compose restart sogo-mailcow\n</code></pre>","path":["Model passwd.en"],"tags":[]},{"location":"de/models/model-sender_rcv.de/","level":1,"title":"Model sender rcv.de","text":"<p>Wenn eine Mailbox erstellt wird, kann ein Benutzer Mails von seiner eigenen Mailboxadresse senden und empfangen.</p> <pre><code>Die Mailbox me@example.org wird erstellt. example.org ist eine primäre Domäne.\nHinweis: Eine Mailbox kann nicht in einer Alias-Domäne erstellt werden.\n\nme@example.org ist nur als me@example.org bekannt.\nme@example.org darf als me@example.org senden.\n</code></pre> <p>Wir können eine Alias-Domäne für example.org hinzufügen:</p> <pre><code>Die Alias-Domäne alias.com wird hinzugefügt und der primären Domäne example.org zugewiesen.\nme@example.org ist nun als me@example.org und me@alias.com bekannt.\nme@example.org darf nun als me@example.org und me@alias.com senden.\n</code></pre> <p>Wir können Aliase für eine Mailbox hinzufügen, um Mails von dieser neuen Adresse zu empfangen und zu senden.</p> <p>Es ist wichtig zu wissen, dass Sie nicht in der Lage sind, Mails für <code>my-alias@my-alias-domain.tld</code> zu empfangen. Sie müssen diesen speziellen Alias erstellen.</p> <pre><code>me@example.org wird der Alias alias@example.org zugewiesen.\nme@example.org ist jetzt bekannt als me@example.org, me@alias.com, alias@example.org\n\nme@example.org ist NICHT als alias@alias.com bekannt.\n</code></pre> <p>Bitte beachten Sie, dass dies nicht für \"catch-all\"-Aliasnamen gilt:</p> <pre><code>Die Alias-Domäne alias.com wird hinzugefügt und der primären Domäne example.org zugewiesen\nme@example.org wird der Catch-all-Alias @example.org zugewiesen\nme@example.org ist weiterhin nur als me@example.org bekannt, was die einzige verfügbare send-as Option ist.\n\nJede an alias.com gesendete E-Mail wird mit dem Catch-All-Alias für example.org übereinstimmen.\n</code></pre> <p>Administratoren und Domänenadministratoren können Postfächer bearbeiten, um bestimmten Benutzern zu erlauben, als andere Postfachbenutzer zu senden (sie zu \"delegieren\").</p> <p>Sie können zwischen Mailbox-Benutzern wählen oder die Absenderprüfung für Domänen komplett deaktivieren.</p>","path":["Model sender rcv.de"],"tags":[]},{"location":"de/models/model-sender_rcv.de/#sogo-mail-von-adressen","level":3,"title":"SOGo \"Mail von\"-Adressen","text":"<p>Mailbox-Benutzer können natürlich ihre eigene Mailbox-Adresse auswählen, sowie alle Alias-Adressen und Aliase, die über Alias-Domänen existieren.</p> <p>Wenn Sie einen anderen existierenden Mailbox-Benutzer als Ihre \"Mail von\"-Adresse auswählen wollen, muss dieser Benutzer Ihnen den Zugriff über SOGo delegieren (siehe SOGo-Dokumentation). Außerdem muss ein mailcow (Domain) Administrator Ihnen den Zugang wie oben beschrieben gewähren.</p>","path":["Model sender rcv.de"],"tags":[]},{"location":"de/models/model-sender_rcv.en/","level":1,"title":"Model sender rcv.en","text":"<p>When a mailbox is created, a user is allowed to send mail from and receive mail for his own mailbox address.</p> <pre><code>Mailbox me@example.org is created. example.org is a primary domain.\nNote: a mailbox cannot be created in an alias domain.\n\nme@example.org is only known as me@example.org.\nme@example.org is allowed to send as me@example.org.\n</code></pre> <p>We can add an alias domain for example.org:</p> <pre><code>Alias domain alias.com is added and assigned to primary domain example.org.\nme@example.org is now known as me@example.org and me@alias.com.\nme@example.org is now allowed to send as me@example.org and me@alias.com.\n</code></pre> <p>We can add aliases for a mailbox to receive mail for and to send from this new address.</p> <p>It is important to know, that you are not able to receive mail for <code>my-alias@my-alias-domain.tld</code>. You would need to create this particular alias.</p> <pre><code>me@example.org is assigned the alias alias@example.org\nme@example.org is now known as me@example.org, me@alias.com, alias@example.org\n\nme@example.org is NOT known as alias@alias.com.\n</code></pre> <p>Please note that this does not apply to catch-all aliases:</p> <pre><code>Alias domain alias.com is added and assigned to primary domain example.org\nme@example.org is assigned the catch-all alias @example.org\nme@example.org is still just known as me@example.org, which is the only available send-as option\n\nAny email send to alias.com will match the catch-all alias for example.org\n</code></pre> <p>Administrators and domain administrators can edit mailboxes to allow specific users to send as other mailbox users (\"delegate\" them).</p> <p>You can choose between mailbox users or completely disable the sender check for domains.</p>","path":["Model sender rcv.en"],"tags":[]},{"location":"de/models/model-sender_rcv.en/#sogo-mail-from-addresses","level":3,"title":"SOGo \"mail from\" addresses","text":"<p>Mailbox users can, obviously, select their own mailbox address, as well as all alias addresses and aliases that exist through alias domains.</p> <p>If you want to select another existing mailbox user as your \"mail from\" address, this user has to delegate you access through SOGo (see SOGo documentation). Moreover a mailcow (domain) administrator needs to grant you access as described above.</p>","path":["Model sender rcv.en"],"tags":[]},{"location":"de/post_installation/firststeps-authorize_watchdog_and_bounces.de/","level":1,"title":"Firststeps authorize watchdog and bounces.de","text":"<p>mailcow verwendet <code>MAILCOW_HOSTNAME</code> als Absenderdomain, um Watchdog-Benachrichtigungen zu senden und Bounce-E-Mails zu erstellen.</p> <ol> <li> <p><code>WATCHDOG_NOTIFY_EMAIL</code> sollte auf externe Empfänger verweisen, die von einem anderen Mailserver verwaltet werden. Dies ist sehr wichtig, da der Watchdog über Systemausfälle informiert, und im Falle eines solchen Ausfalls wäre Ihre Instanz möglicherweise nicht in der Lage, diese Benachrichtigung zu empfangen oder anzuzeigen.</p> </li> <li> <p>Da der Watchdog so konzipiert ist, dass er in allen Situationen funktioniert, einschließlich Fällen, in denen Postfix, Rspamd oder Redis nicht funktionieren, senden wir E-Mails direkt über den Watchdog-Container an den Empfänger-MX, ohne DKIM-Signierung.</p> </li> </ol> <p>Um Watchdog-Benachrichtigungen und Bounces ordnungsgemäß an externe Mailserver zu senden, müssen Sie SPF und DMARC für <code>MAILCOW_HOSTNAME</code> konfigurieren (ersetzen Sie <code>mail.example.com</code> und die IPs entsprechend Ihrer Konfiguration):</p> <pre><code>_dmarc.mail.example.com IN TXT \"v=DMARC1; p=reject\"\nmail.example.com IN TXT \"v=spf1 ip4:192.0.2.146/32 ip6:2001:db8::1/128 -all\"\n</code></pre> <p>Hinweis</p> <p>Wenn Sie möchten, können Sie dieses SPF später als Include für andere Domains verwenden, wie zum Beispiel:</p> <pre><code>example.com IN TXT \"v=spf1 include:mail.example.com -all\"\n</code></pre>","path":["Firststeps authorize watchdog and bounces.de"],"tags":[]},{"location":"de/post_installation/firststeps-authorize_watchdog_and_bounces.en/","level":1,"title":"Firststeps authorize watchdog and bounces.en","text":"<p>mailcow uses <code>MAILCOW_HOSTNAME</code> as the sender domain to send watchdog notifications and compose bounce emails.</p> <ol> <li><code>WATCHDOG_NOTIFY_EMAIL</code> should point to external recipients, managed by another mail server. This is very important because the watchdog notifies you about system outages. If this happens, your instance might not be capable of accepting or displaying this notification.</li> <li>Since the watchdog is designed to work in any situation, including cases when Postfix, Rspamd, or Redis is not functioning, we send emails directly via the watchdog container to the recipient's MX without any DKIM signing.</li> </ol> <p>To properly send watchdog notifications and bounces to external mail servers, you need to configure SPF and DMARC for <code>MAILCOW_HOSTNAME</code> (replace <code>mail.example.com</code> and the IPs to reflect your setup):</p> <pre><code>_dmarc.mail.example.com IN TXT \"v=DMARC1; p=reject\"\nmail.example.com IN TXT \"v=spf1 ip4:192.0.2.146/32 ip6:2001:db8::1/128 -all\"\n</code></pre> <p>Info</p> <p>If you want, later you can use this SPF as an include on other domains as: <pre><code>example.com IN TXT \"v=spf1 include:mail.example.com -all\"\n</code></pre></p>","path":["Firststeps authorize watchdog and bounces.en"],"tags":[]},{"location":"de/post_installation/firststeps-disable_ipv6.de/","level":1,"title":"Firststeps disable ipv6.de","text":"<p>ACHTUNG</p> <p>Bei Installationen, welche eine Docker Version zwischen 25.0.0 und 25.0.2 (zum überprüfen nutzt <code>docker version</code>) verwenden hat sich das Verhalten der IPv6-Adressen Allokation durch einen Bug verändert. Ein simples <code>enable_ipv6: false</code> reicht damit NICHT mehr aus, um IPv6 komplett im Stack zu deaktivieren. Dies war ein Bug im Docker Daemon, welcher mit Version 25.0.3 gefixt wurde.</p> <p>Dies wird NUR empfohlen, wenn Sie kein IPv6-fähiges Netzwerk auf Ihrem Host haben!</p> <p>Wenn Sie es wirklich brauchen, können Sie die Verwendung von IPv6 in der Compose-Datei deaktivieren. Zusätzlich können Sie auch den Start des Containers \"ipv6nat-mailcow\" deaktivieren, da er nicht benötigt wird, wenn Sie IPv6 nicht verwenden.</p> <p>Anstatt die Datei docker-compose.yml direkt zu bearbeiten, ist es besser, eine Override-Datei zu erstellen zu erstellen und Ihre Änderungen am Dienst dort zu implementieren. Leider scheint dies im Moment nur für Dienste zu funktionieren, nicht für Netzwerkeinstellungen.</p> <p>Um IPv6 im mailcow-Netzwerk zu deaktivieren, öffnen Sie docker-compose.yml mit Ihrem bevorzugten Texteditor und suchen Sie nach dem Netzwerk-Abschnitt (er befindet sich am Ende der Datei).</p> <p>1. Ändern Sie docker-compose.yml</p> <p>Ändern Sie <code>enable_ipv6: true</code> in <code>enable_ipv6: false</code>:</p> <pre><code>networks:\n  mailcow-network:\n    [...]\n    enable_ipv6: true # &lt;&lt;&lt; auf false setzen\n    ipam:\n      driver: default\n      config:\n        - subnet: ${IPV4_NETWORK:-172.22.1}.0/24\n    [...]\n</code></pre> <p>2. ipv6nat-mailcow deaktivieren</p> <p>Um den ipv6nat-mailcow Container ebenfalls zu deaktivieren, gehen Sie in Ihr mailcow Verzeichnis und erstellen Sie eine neue Datei namens \"docker-compose.override.yml\":</p> <p>HINWEIS: Wenn Sie bereits eine Override-Datei haben, erstellen Sie diese natürlich nicht neu, sondern fügen Sie die untenstehenden Zeilen entsprechend in Ihre bestehende Datei ein!</p> <pre><code># cd /opt/mailcow-dockerized\n# touch docker-compose.override.yml\n</code></pre> <p>Öffnen Sie die Datei in Ihrem bevorzugten Texteditor und tragen Sie folgendes ein:</p> <pre><code>services:\n\n    ipv6nat-mailcow:\n      image: bash:latest\n      restart: \"no\"\n      entrypoint: [\"echo\", \"ipv6nat disabled in compose.override.yml\"]\n</code></pre> <p>Damit diese Änderungen wirksam werden, müssen Sie den Stack vollständig stoppen und dann neu starten, damit Container und Netzwerke neu erstellt werden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre> <p>3. Deaktivieren Sie IPv6 in unbound-mailcow</p> <p>Bearbeiten Sie <code>data/conf/unbound/unbound.conf</code> und setzen Sie <code>do-ip6</code> auf \"no\":</p> <pre><code>Server:\n  [...]\n  do-ip6: no\n  [...]\n</code></pre> <p>unbound neu starten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart unbound-mailcow\n</code></pre> <pre><code>docker-compose restart unbound-mailcow\n</code></pre> <p>4. Deaktivieren Sie IPv6 in postfix-mailcow</p> <p>Erstellen Sie <code>data/conf/postfix/extra.cf</code> und setzen Sie <code>smtp_address_preference</code> auf <code>ipv4</code>:</p> <pre><code>smtp_address_preference = ipv4\ninet_protocols = ipv4\n</code></pre> <p>Starten Sie Postfix neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow\n</code></pre> <p>5. Wenn im Docker Daemon IPv6 komplett deaktiviert ist:</p> <p>Folgende Dovecot und Php-fpm Konfigurationsdateien anpassen</p> <pre><code>sed -i 's/,\\[::\\]//g' data/conf/dovecot/dovecot.conf\nsed -i 's/\\[::\\]://g' data/conf/phpfpm/php-fpm.d/pools.conf\n</code></pre> <p>6. IPv6 Listener für NGINX deaktivieren</p> <p>Setze <code>DISABLE_IPv6=y</code> in der Datei <code>mailcow.conf</code>.</p> <p>Damit diese Änderung wirksam wird, muss der Container <code>nginx-mailcow</code> neu erstellt werden.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps disable ipv6.de"],"tags":[]},{"location":"de/post_installation/firststeps-disable_ipv6.en/","level":1,"title":"Firststeps disable ipv6.en","text":"<p>Danger</p> <p>In installations using a Docker version between 25.0.0 and 25.0.2 (to check, use <code>docker version</code>) the behavior of IPv6 address allocation has changed due to a bug. Simply using <code>enable_ipv6: false</code> is NO LONGER sufficient to completely disable IPv6 in the stack. This was a bug in the Docker Daemon, which has been fixed with version 25.0.3.</p> <p>This is ONLY recommended if you do not have an IPv6 enabled network on your host!</p> <p>If you really need to, you can disable the usage of IPv6 in the compose file. Additionally, you can  also disable the startup of container \"ipv6nat-mailcow\", as it's not needed if you won't use IPv6.</p> <p>Instead of editing docker-compose.yml directly, it is preferable to create an override file for it and implement your changes to the service there. Unfortunately, this right now only seems to work for services, not for network settings.</p> <p>To disable IPv6 on the mailcow network, open docker-compose.yml with your favourite text editor and search for the network section (it's near the bottom of the file).</p> <p>1. Modify docker-compose.yml</p> <p>Change <code>enable_ipv6: true</code> to <code>enable_ipv6: false</code> and comment out the IPv6 subnet:</p> <pre><code>networks:\n  mailcow-network:\n    [...]\n    enable_ipv6: true # &lt;&lt;&lt; set to false\n    ipam:\n      driver: default\n      config:\n        - subnet: ${IPV4_NETWORK:-172.22.1}.0/24\n        - subnet: ${IPV6_NETWORK:-fd4d:6169:6c63:6f77::/64} # &lt;&lt;&lt; comment out with #\n    [...]\n</code></pre> <p>2. Disable ipv6nat-mailcow</p> <p>To disable the ipv6nat-mailcow container as well, go to your mailcow directory and create a new file called \"docker-compose.override.yml\":</p> <p>NOTE: If you already have an override file, of course don't recreate it, but merge the lines below into your existing one accordingly!</p> <pre><code># cd /opt/mailcow-dockerized\n# touch docker-compose.override.yml\n</code></pre> <p>Open the file in your favourite text editor and fill in the following:</p> <pre><code>services:\n\n    ipv6nat-mailcow:\n      image: bash:latest\n      restart: \"no\"\n      entrypoint: [\"echo\", \"ipv6nat disabled in compose.override.yml\"]\n</code></pre> <p>For these changes to be effective, you need to fully stop and then restart the stack, so containers and networks are recreated:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre> <p>3. Disable IPv6 in unbound-mailcow</p> <p>Edit <code>data/conf/unbound/unbound.conf</code> and set <code>do-ip6</code> to \"no\":</p> <pre><code>server:\n  [...]\n  do-ip6: no\n  [...]\n</code></pre> <p>Restart Unbound:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart unbound-mailcow\n</code></pre> <pre><code>docker-compose restart unbound-mailcow\n</code></pre> <p>4. Disable IPv6 in postfix-mailcow</p> <p>Create <code>data/conf/postfix/extra.cf</code> and set <code>smtp_address_preference</code> to <code>ipv4</code>:</p> <pre><code>smtp_address_preference = ipv4\ninet_protocols = ipv4\n</code></pre> <p>Restart Postfix:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow\n</code></pre> <p>5. If your docker daemon completly disabled IPv6:</p> <p>Fix the following Dovecot and php-fpm config files</p> <pre><code>sed -i 's/,\\[::\\]//g' data/conf/dovecot/dovecot.conf\nsed -i 's/\\[::\\]://g' data/conf/phpfpm/php-fpm.d/pools.conf\n</code></pre> <p>6. Disable IPv6 listeners for NGINX</p> <p>Set <code>DISABLE_IPv6=y</code> in <code>mailcow.conf</code></p> <p>For this change to be effective, you need to recreate the <code>nginx-mailcow</code> Container</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps disable ipv6.en"],"tags":[]},{"location":"de/post_installation/firststeps-dmarc_reporting.de/","level":1,"title":"Firststeps dmarc reporting.de","text":"<p>Die DMARC-Berichterstattung erfolgt über das Rspamd DMARC-Modul.</p> <p>Die Rspamd-Dokumentation finden Sie hier: https://rspamd.com/doc/modules/dmarc.html</p> <p>Wichtig:</p> <ol> <li> <p>Ändern Sie <code>example.com</code>, <code>mail.example.com</code> und <code>Example</code> so, dass sie Ihrer Einrichtung entsprechen</p> </li> <li> <p>Die DMARC-Berichterstattung erfordert zusätzliche Aufmerksamkeit, insbesondere in den ersten Tagen</p> </li> <li> <p>Alle empfangenden Domains, die auf mailcow gehostet werden, senden von einer Reporting-Domain. Es wird empfohlen, die übergeordnete Domain Ihres <code>MAILCOW_HOSTNAME</code> zu verwenden:</p> <ul> <li>Wenn Ihr <code>MAILCOW_HOSTNAME</code> <code>mail.example.com</code> ist, ändern Sie die folgende Konfiguration in <code>domain = \"example.com\";</code></li> <li>Setzen Sie <code>email</code> gleich, z.B. <code>email = \"noreply-dmarc@example.com\";</code></li> </ul> </li> <li> <p>Es ist optional, aber empfohlen, einen E-Mail-Benutzer <code>noreply-dmarc</code> in mailcow zu erstellen, um Bounces zu behandeln.</p> </li> </ol>","path":["Firststeps dmarc reporting.de"],"tags":[]},{"location":"de/post_installation/firststeps-dmarc_reporting.de/#aktivieren-sie-dmarc-berichterstattung","level":2,"title":"Aktivieren Sie DMARC-Berichterstattung","text":"<p>Erstellen Sie die Datei <code>data/conf/rspamd/local.d/dmarc.conf</code> und setzen Sie den folgenden Inhalt:</p> <pre><code>reporting {\n    enabled = true;\n    email = 'noreply-dmarc@example.com';\n    domain = 'example.com';\n    org_name = 'Example';\n    helo = 'rspamd';\n    smtp = 'postfix';\n    smtp_port = 25;\n    from_name = 'Example DMARC Report';\n    msgid_from = 'rspamd.mail.example.com';\n    max_entries = 2k;\n    keys_expire = 2d;\n}\n</code></pre> <p>Erstellen oder ändern Sie <code>docker-compose.override.yml</code> im mailcow-dockerized Basisverzeichnis:</p> <pre><code>services:\n  rspamd-mailcow:\n    environment:\n      - MASTER=${MASTER:-y}\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.schedule: \"@every 24h\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.command: \"/bin/bash -c \\\"[[ $${MASTER} == y ]] &amp;&amp; /usr/bin/rspamadm dmarc_report $(date --date yesterday '+%Y%m%d') &gt; /var/lib/rspamd/dmarc_reports_last_log 2&gt;&amp;1 || exit 0\\\"\"\n  ofelia-mailcow:\n    depends_on:\n      - rspamd-mailcow\n</code></pre> <p>Starten Sie den mailcow Stack mit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps dmarc reporting.de"],"tags":[]},{"location":"de/post_installation/firststeps-dmarc_reporting.de/#senden-sie-eine-kopie-der-berichte-an-sich-selbst","level":2,"title":"Senden Sie eine Kopie der Berichte an sich selbst","text":"<p>Um eine versteckte Kopie der von Rspamd erzeugten Berichte zu erhalten, können Sie eine <code>bcc_addrs</code> Liste im <code>reporting</code> Konfigurationsabschnitt von <code>data/conf/rspamd/local.d/dmarc.conf</code> setzen:</p> <pre><code>reporting {\n    enabled = true;\n    email = 'noreply-dmarc@example.com';\n    bcc_addrs = [\"noreply-dmarc@example.com\", \"parsedmarc@example.com\"];\n[...]\n</code></pre> <p>Rspamd lädt Änderungen in Echtzeit, so dass Sie den Container zu diesem Zeitpunkt nicht neu starten müssen.</p> <p>Dies kann nützlich sein, wenn Sie...</p> <ul> <li>...überprüfen wollen, ob Ihre DMARC-Berichte korrekt und authentifiziert gesendet werden.</li> <li>...Ihre eigenen Berichte analysieren wollen, um Statistiken zu erhalten, z.B. um sie mit ParseDMARC oder anderen Analysesystemen zu verwenden.</li> </ul>","path":["Firststeps dmarc reporting.de"],"tags":[]},{"location":"de/post_installation/firststeps-dmarc_reporting.de/#fehlersuche","level":2,"title":"Fehlersuche","text":"<p>Prüfen Sie, wann der Berichtsplan zuletzt ausgeführt wurde:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow date -r /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow date -r /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <p>Sehen Sie sich die letzte Berichtsausgabe an:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow cat /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow cat /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <p>Manuelles Auslösen eines DMARC-Berichts:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow rspamadm dmarc_report\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow rspamadm dmarc_report\n</code></pre> <p>Bestätigen Sie, dass Rspamd Daten in Redis aufgezeichnet hat: Ändern Sie <code>20220428</code> in Ihr gewünschtes Datum zum überprüfen.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli SMEMBERS \"dmarc_idx;20220428\"\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli SMEMBERS \"dmarc_idx;20220428\"\n</code></pre> <p>Nehmen Sie eine der Zeilen aus der Ausgabe, die Sie interessiert, und fordern Sie sie an, z. B.:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli ZRANGE \"dmarc_rpt;microsoft.com;mailto:d@rua.agari.com;20220428\" 0 49\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli ZRANGE \"dmarc_rpt;microsoft.com;mailto:d@rua.agari.com;20220428\" 0 49\n</code></pre>","path":["Firststeps dmarc reporting.de"],"tags":[]},{"location":"de/post_installation/firststeps-dmarc_reporting.de/#andern-sie-die-haufigkeit-der-dmarc-berichte","level":2,"title":"Ändern Sie die Häufigkeit der DMARC-Berichte","text":"<p>Im obigen Beispiel werden die Berichte einmal alle 24 Stunden sowie für den gestrigen Tag versendet. Dies ist für die meisten Konfigurationen ausreichend.</p> <p>Wenn Sie ein großes E-Mail-Aufkommen haben und die DMARC-Berichterstattung mehr als einmal am Tag durchführen wollen, müssen Sie einen zweiten Zeitplan erstellen und ihn mit <code>dmarc_report $(date '+%Y%m%d')</code> ausführen, um den aktuellen Tag zu verarbeiten. Sie müssen sicherstellen, dass der erste Lauf an jedem Tag auch den letzten Bericht vom Vortag verarbeitet, also muss er zweimal gestartet werden, einmal mit <code>$(date --date yesterday '+%Y%m%d')</code> um <code>0 5 0 * * *</code> (00:05 AM) und dann mit <code>$(date '+%Y%m%d')</code> mit dem gewünschten Intervall.</p> <p>Der Ofelia-Zeitplan hat die gleiche Implementierung wie <code>cron</code> in Go, die unterstützte Syntax ist beschrieben in cron Documentation</p> <p>Um den Zeitplan zu ändern:</p> <ol> <li> <p><code>docker-compose.override.yml</code> bearbeiten:     <pre><code>services:\n  rspamd-mailcow:\n    environment:\n      - MASTER=${MASTER:-y}\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.schedule: \"0 5 0 * * *\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.command: \"/bin/bash -c \\\"[[ $${MASTER} == y ]] &amp;&amp; /usr/bin/rspamadm dmarc_report $(date --date yesterday '+%Y%m%d') &gt; /var/lib/rspamd/dmarc_reports_last_log 2&gt;&amp;1 || exit 0\\\"\"\n      ofelia.job-exec.rspamd_dmarc_reporting_today.schedule: \"@every 12h\"\n      ofelia.job-exec.rspamd_dmarc_reporting_today.command: \"/bin/bash -c \\\"[[ $${MASTER} == y ]] &amp;&amp; /usr/bin/rspamadm dmarc_report $(date '+%Y%m%d') &gt; /var/lib/rspamd/dmarc_reports_last_log 2&gt;&amp;1 || exit 0\\\"\"\n  ofelia-mailcow:\n    depends_on:\n      - rspamd-mailcow\n</code></pre></p> </li> <li> <p>Starten Sie die betroffenen Container neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> </li> <li> <p>Führen Sie einen Neustart nur von Ofelia aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart ofelia-mailcow\n</code></pre> <pre><code>docker-compose restart ofelia-mailcow\n</code></pre> </li> </ol>","path":["Firststeps dmarc reporting.de"],"tags":[]},{"location":"de/post_installation/firststeps-dmarc_reporting.de/#dmarc-berichterstattung-deaktivieren","level":2,"title":"DMARC-Berichterstattung deaktivieren","text":"<p>Zum Deaktivieren der Berichterstattung:</p> <ol> <li> <p>Setzen Sie <code>enabled</code> auf <code>false</code> in <code>data/conf/rspamd/local.d/dmarc.conf</code>.</p> </li> <li> <p>Machen Sie Änderungen in <code>docker-compose.override.yml</code> an <code>rspamd-mailcow</code> und <code>ofelia-mailcow</code> rückgängig</p> </li> <li> <p>Starten Sie die betroffenen Container neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> </li> </ol>","path":["Firststeps dmarc reporting.de"],"tags":[]},{"location":"de/post_installation/firststeps-dmarc_reporting.en/","level":1,"title":"Firststeps dmarc reporting.en","text":"<p>DMARC Reporting done via Rspamd DMARC Module.</p> <p>Rspamd documentation can be found here: https://rspamd.com/doc/modules/dmarc.html</p> <p>Important:</p> <ol> <li> <p>Change <code>example.com</code>, <code>mail.example.com</code> and <code>Example</code> to reflect your setup</p> </li> <li> <p>DMARC reporting requires additional attention, especially over the first few days</p> </li> <li> <p>All receiving domains hosted on mailcow send from one reporting domain. It is recommended to use the parent domain of your <code>MAILCOW_HOSTNAME</code>:</p> <ul> <li>If your <code>MAILCOW_HOSTNAME</code> is <code>mail.example.com</code> change the following config to <code>domain = \"example.com\";</code></li> <li>Set <code>email</code> equally, e.g. <code>email = \"noreply-dmarc@example.com\";</code></li> </ul> </li> <li> <p>It is optional but recommended to create an email user <code>noreply-dmarc</code> in mailcow to handle bounces.</p> </li> </ol>","path":["Firststeps dmarc reporting.en"],"tags":[]},{"location":"de/post_installation/firststeps-dmarc_reporting.en/#enable-dmarc-reporting","level":2,"title":"Enable DMARC reporting","text":"<p>Create the file <code>data/conf/rspamd/local.d/dmarc.conf</code> and set the following content:</p> <pre><code>reporting {\n    enabled = true;\n    email = 'noreply-dmarc@example.com';\n    domain = 'example.com';\n    org_name = 'Example';\n    helo = 'rspamd';\n    smtp = 'postfix';\n    smtp_port = 25;\n    from_name = 'Example DMARC Report';\n    msgid_from = 'rspamd.mail.example.com';\n    max_entries = 2k;\n    keys_expire = 2d;\n}\n</code></pre> <p>Create or modify <code>docker-compose.override.yml</code> in the mailcow-dockerized base directory:</p> <pre><code>services:\n  rspamd-mailcow:\n    environment:\n      - MASTER=${MASTER:-y}\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.schedule: \"@every 24h\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.command: \"/bin/bash -c \\\"[[ $${MASTER} == y ]] &amp;&amp; /usr/bin/rspamadm dmarc_report $(date --date yesterday '+%Y%m%d') &gt; /var/lib/rspamd/dmarc_reports_last_log 2&gt;&amp;1 || exit 0\\\"\"\n  ofelia-mailcow:\n    depends_on:\n      - rspamd-mailcow\n</code></pre> <p>Start the mailcow stack with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps dmarc reporting.en"],"tags":[]},{"location":"de/post_installation/firststeps-dmarc_reporting.en/#send-a-copy-reports-to-yourself","level":2,"title":"Send a copy reports to yourself","text":"<p>To receive a hidden copy of reports generated by Rspamd you can set a <code>bcc_addrs</code> list in the <code>reporting</code> config section of <code>data/conf/rspamd/local.d/dmarc.conf</code>:</p> <pre><code>reporting {\n    enabled = true;\n    email = 'noreply-dmarc@example.com';\n    bcc_addrs = [\"noreply-dmarc@example.com\",\"parsedmarc@example.com\"];\n[...]\n</code></pre> <p>Rspamd will load changes in real time, so you won't need to restart the container at this point.</p> <p>This can be useful if you...</p> <ul> <li>...want to check that your DMARC reports are sent correctly and authenticated.</li> <li>...want to analyze your own reports to get statistics, i.e. to use with ParseDMARC or other analytic systems.</li> </ul>","path":["Firststeps dmarc reporting.en"],"tags":[]},{"location":"de/post_installation/firststeps-dmarc_reporting.en/#troubleshooting","level":2,"title":"Troubleshooting","text":"<p>Check when the report schedule last ran:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow date -r /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow date -r /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <p>See the latest report output:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow cat /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow cat /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <p>Manually trigger a DMARC report:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow rspamadm dmarc_report\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow rspamadm dmarc_report\n</code></pre> <p>Validate that Rspamd has recorded data in Redis: Change <code>20220428</code> to date which you interested in.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli SMEMBERS \"dmarc_idx;20220428\"\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli SMEMBERS \"dmarc_idx;20220428\"\n</code></pre> <p>Take one of the lines from output you interested in and request it, f.e.:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli ZRANGE \"dmarc_rpt;microsoft.com;mailto:d@rua.agari.com;20220428\" 0 49\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli ZRANGE \"dmarc_rpt;microsoft.com;mailto:d@rua.agari.com;20220428\" 0 49\n</code></pre>","path":["Firststeps dmarc reporting.en"],"tags":[]},{"location":"de/post_installation/firststeps-dmarc_reporting.en/#change-dmarc-reporting-frequency","level":2,"title":"Change DMARC reporting frequency","text":"<p>In the example above reports are sent once every 24 hours and send reports for yesterday. This will be okay for most setups.</p> <p>If you have a large mail volume and want to run the DMARC reporting more than once a day you need create second schedule and run it with <code>dmarc_report $(date '+%Y%m%d')</code> to process the current day. You have to make sure that the first run on each day also processes the last report from the day before, so it needs to be started twice, one time with <code>$(date --date yesterday '+%Y%m%d')</code> at <code>0 5 0 * * *</code> (00:05 AM) and then with <code>$(date '+%Y%m%d')</code> with desired interval.</p> <p>The Ofelia schedule has the same implementation as <code>cron</code> in Go, supported syntax described at cron Documentation</p> <p>To change schedule:</p> <ol> <li>Edit <code>docker-compose.override.yml</code>:</li> </ol> <pre><code>services:\n  rspamd-mailcow:\n    environment:\n      - MASTER=${MASTER:-y}\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.schedule: \"0 5 0 * * *\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.command: \"/bin/bash -c \\\"[[ $${MASTER} == y ]] &amp;&amp; /usr/bin/rspamadm dmarc_report $(date --date yesterday '+%Y%m%d') &gt; /var/lib/rspamd/dmarc_reports_last_log 2&gt;&amp;1 || exit 0\\\"\"\n      ofelia.job-exec.rspamd_dmarc_reporting_today.schedule: \"@every 12h\"\n      ofelia.job-exec.rspamd_dmarc_reporting_today.command: \"/bin/bash -c \\\"[[ $${MASTER} == y ]] &amp;&amp; /usr/bin/rspamadm dmarc_report $(date '+%Y%m%d') &gt; /var/lib/rspamd/dmarc_reports_last_log 2&gt;&amp;1 || exit 0\\\"\"\n  ofelia-mailcow:\n    depends_on:\n      - rspamd-mailcow\n</code></pre> <ol> <li> <p>Restart the desired containers with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> </li> <li> <p>Restart the ofelia container only:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart ofelia-mailcow\n</code></pre> <pre><code>docker-compose restart ofelia-mailcow\n</code></pre> </li> </ol>","path":["Firststeps dmarc reporting.en"],"tags":[]},{"location":"de/post_installation/firststeps-dmarc_reporting.en/#disable-dmarc-reporting","level":2,"title":"Disable DMARC Reporting","text":"<p>To disable reporting:</p> <ol> <li> <p>Set <code>enabled</code> to <code>false</code> in <code>data/conf/rspamd/local.d/dmarc.conf</code></p> </li> <li> <p>Revert changes done in <code>docker-compose.override.yml</code> to <code>rspamd-mailcow</code> and <code>ofelia-mailcow</code></p> </li> <li> <p>Restart the desired containers with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> </li> </ol>","path":["Firststeps dmarc reporting.en"],"tags":[]},{"location":"de/post_installation/firststeps-ip_bindings.de/","level":1,"title":"Firststeps ip bindings.de","text":"<p>Warnung</p> <p>Das Ändern der Bindung hat keinen Einfluss auf Source-NAT. Siehe SNAT für die erforderlichen Schritte.</p>","path":["Firststeps ip bindings.de"],"tags":[]},{"location":"de/post_installation/firststeps-ip_bindings.de/#ipv4-binding","level":2,"title":"IPv4-Binding","text":"<p>Um eine oder mehrere IPv4-Bind(ings) anzupassen, öffne <code>mailcow.conf</code> und editiere eine, mehrere oder alle Variablen nach deinen Bedürfnissen:</p> <pre><code># Aus technischen Gründen unterscheiden sich die http-Bindungen ein wenig von anderen Service-Bindungen.\n# Sie werden die folgenden Variablen finden, getrennt durch eine Bindungsadresse und deren Port:\n# Beispiel: HTTP_BIND=1.2.3.4\n\nHTTP_PORT=80\nHTTP_BIND=\nHTTPS_PORT=443\nHTTPS_BIND=\n\n# Andere Dienste werden nach folgendem Format gebunden:\n# SMTP_PORT=1.2.3.4:25 bindet SMTP an die IP 1.2.3.4 auf Port 25\n# Wichtig! Durch die Angabe einer IPv4-Adresse werden alle IPv6-Bindungen seit Docker 20.x übersprungen.\n# doveadm, SQL sowie Solr sind nur an lokale Ports gebunden, bitte ändern Sie das nicht, es sei denn, Sie wissen, was Sie tun.\n\nSMTP_PORT=25\nSMTPS_PORT=465\nSUBMISSION_PORT=587\nIMAP_PORT=143\nIMAPS_PORT=993\nPOP_PORT=110\nPOPS_PORT=995\nSIEVE_PORT=4190\nDOVEADM_PORT=127.0.0.1:19991\nSQL_PORT=127.0.0.1:13306\nSOLR_PORT=127.0.0.1:18983\n</code></pre> <p>Um Ihre Änderungen zu übernehmen, führen Sie folgende Befehle aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Firststeps ip bindings.de"],"tags":[]},{"location":"de/post_installation/firststeps-ip_bindings.de/#ipv6-binding","level":2,"title":"IPv6-Binding","text":"<p>Das Ändern von IPv6-Bindings ist anders als bei IPv4. Auch dies hat einen technischen Hintergrund.</p> <p>Eine <code>docker-compose.override.yml</code> Datei wird verwendet, anstatt die <code>docker-compose.yml</code> Datei direkt zu bearbeiten. Dies geschieht, um die Aktualisierbarkeit zu erhalten, da die Datei <code>docker-compose.yml</code> regelmäßig aktualisiert wird und Ihre Änderungen höchstwahrscheinlich überschrieben werden.</p> <p>Bearbeiten Sie die Datei \"docker-compose.override.yml\" und erstellen Sie sie mit dem folgenden Inhalt. Ihr Inhalt wird mit der produktiven Datei \"docker-compose.yml\" zusammengeführt.</p> <p>Es wird eine beispielhafte IPv6 2001:db8:dead:beef::123 in [] angegeben. Das erste Suffix <code>:PORT1</code> definiert den externen Port, während das zweite Suffix <code>:PORT2</code> zu dem entsprechenden Port innerhalb des Containers führt und nicht verändert werden darf.</p> <pre><code>services:\n\n    dovecot-mailcow:\n      ports:\n        - '[2001:db8:dead:beef::123]:143:143'\n        - '[2001:db8:dead:beef::123]:993:993'\n        - '[2001:db8:dead:beef::123]:110:110'\n        - '[2001:db8:dead:beef::123]:995:995'\n        - '[2001:db8:dead:beef::123]:4190:4190'\n\n    postfix-mailcow:\n      ports:\n        - '[2001:db8:dead:beef::123]:25:25'\n        - '[2001:db8:dead:beef::123]:465:465'\n        - '[2001:db8:dead:beef::123]:587:587'\n\n    nginx-mailcow:\n      ports:\n        - '[2001:db8:dead:beef::123]:80:80'\n        - '[2001:db8:dead:beef::123]:443:443'\n</code></pre> <p>Um Ihre Änderungen zu übernehmen, führen Sie folgendes aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Firststeps ip bindings.de"],"tags":[]},{"location":"de/post_installation/firststeps-ip_bindings.en/","level":1,"title":"Firststeps ip bindings.en","text":"<p>Warning</p> <p>Changing the binding does not affect source NAT. See SNAT for required steps.</p>","path":["Firststeps ip bindings.en"],"tags":[]},{"location":"de/post_installation/firststeps-ip_bindings.en/#ipv4-binding","level":2,"title":"IPv4 binding","text":"<p>To adjust one or multiple IPv4 bindings, open <code>mailcow.conf</code> and edit one, multiple or all variables as per your needs:</p> <pre><code># For technical reasons, http bindings are a bit different from other service bindings.\n# You will find the following variables, separated by a bind address and its port:\n# Example: HTTP_BIND=1.2.3.4\n\nHTTP_PORT=80\nHTTP_BIND=\nHTTPS_PORT=443\nHTTPS_BIND=\n\n# Other services are bound by using the following format:\n# SMTP_PORT=1.2.3.4:25 will bind SMTP to the IP 1.2.3.4 on port 25\n# Important! Specifying an IPv4 address will skip all IPv6 bindings since Docker 20.x.\n# doveadm, SQL as well as Solr are bound to local ports only, please do not change that, unless you know what you are doing.\n\nSMTP_PORT=25\nSMTPS_PORT=465\nSUBMISSION_PORT=587\nIMAP_PORT=143\nIMAPS_PORT=993\nPOP_PORT=110\nPOPS_PORT=995\nSIEVE_PORT=4190\nDOVEADM_PORT=127.0.0.1:19991\nSQL_PORT=127.0.0.1:13306\nSOLR_PORT=127.0.0.1:18983\n</code></pre> <p>To apply your changes, run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Firststeps ip bindings.en"],"tags":[]},{"location":"de/post_installation/firststeps-ip_bindings.en/#ipv6-binding","level":2,"title":"IPv6 binding","text":"<p>Changing IPv6 bindings is different from IPv4. Again, this has a technical background.</p> <p>A <code>docker-compose.override.yml</code> file will be used instead of editing the <code>docker-compose.yml</code> file directly. This is to maintain updatability, as the <code>docker-compose.yml</code> file gets updated regularly and your changes will most likely be overwritten.</p> <p>Edit to create a file  <code>docker-compose.override.yml</code> with the following content. Its content will be merged with the productive <code>docker-compose.yml</code> file.</p> <p>An example IPv6 2001:db8:dead:beef::123 is given. The first suffix <code>:PORT1</code> defines the external port, while the second suffix <code>:PORT2</code> routes to the corresponding port inside the container and must not be changed.</p> <pre><code>services:\n\n    dovecot-mailcow:\n      ports:\n        - '[2001:db8:dead:beef::123]:143:143'\n        - '[2001:db8:dead:beef::123]:993:993'\n        - '[2001:db8:dead:beef::123]:110:110'\n        - '[2001:db8:dead:beef::123]:995:995'\n        - '[2001:db8:dead:beef::123]:4190:4190'\n\n    postfix-mailcow:\n      ports:\n        - '[2001:db8:dead:beef::123]:25:25'\n        - '[2001:db8:dead:beef::123]:465:465'\n        - '[2001:db8:dead:beef::123]:587:587'\n\n    nginx-mailcow:\n      ports:\n        - '[2001:db8:dead:beef::123]:80:80'\n        - '[2001:db8:dead:beef::123]:443:443'\n</code></pre> <p>To apply your changes, run the commands below:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Firststeps ip bindings.en"],"tags":[]},{"location":"de/post_installation/firststeps-local_mta.de/","level":1,"title":"Firststeps local mta.de","text":"<p>Die einfachste Möglichkeit wäre, den Listener an Port 25/tcp zu deaktivieren.</p> <p>Postfix-Benutzer deaktivieren den Listener, indem sie die folgende Zeile (beginnend mit <code>smtp</code> oder <code>25</code>) in <code>/etc/postfix/master.cf</code> auskommentieren: <pre><code>#smtp      inet  n       -       -       -       -       smtpd\n</code></pre></p> <p>Außerdem, um über eine Dockerized mailcow weiterzuleiten, sollten Sie <code>172.22.1.1</code> als Relayhost hinzufügen und das Docker-Interface aus \"inet_interfaces\" entfernen:</p> <pre><code>postconf -e 'relayhost = 172.22.1.1'\npostconf -e \"mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128\"\npostconf -e \"inet_interfaces = loopback-only\"\npostconf -e \"relay_transport = relay\"\npostconf -e \"default_transport = smtp\"\n</code></pre> <p>Jetzt ist es wichtig, dass Sie nicht denselben FQDN in <code>myhostname</code> haben, den Sie für Ihre mailcow verwenden. Prüfen Sie Ihre lokale (nicht-Docker) Postfix' main.cf auf <code>myhostname</code> und setzen Sie ihn auf etwas anderes, zum Beispiel <code>local.my.fqdn.tld</code>.</p> <p>\"172.22.1.1\" ist das von mailcow erstellte Netzwerk-Gateway in Docker. Das Relaying über diese Schnittstelle ist notwendig (anstatt - zum Beispiel - direkt über ${MAILCOW_HOSTNAME}), um über ein bekanntes internes Netzwerk weiterzuleiten.</p> <p>Starten Sie Postfix neu, nachdem Sie Ihre Änderungen vorgenommen haben.</p>","path":["Firststeps local mta.de"],"tags":[]},{"location":"de/post_installation/firststeps-local_mta.en/","level":1,"title":"Firststeps local mta.en","text":"<p>The easiest option would be to disable the listener on port 25/tcp.</p> <p>Postfix users disable the listener by commenting the following line (starting with <code>smtp</code> or <code>25</code>) in <code>/etc/postfix/master.cf</code>: <pre><code>#smtp      inet  n       -       -       -       -       smtpd\n</code></pre></p> <p>Furthermore, to relay over a dockerized mailcow, you may want to add <code>172.22.1.1</code> as relayhost and remove the Docker interface from \"inet_interfaces\":</p> <pre><code>postconf -e 'relayhost = 172.22.1.1'\npostconf -e \"mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128\"\npostconf -e \"inet_interfaces = loopback-only\"\npostconf -e \"relay_transport = relay\"\npostconf -e \"default_transport = smtp\"\n</code></pre> <p>Now it is important to not have the same FQDN in <code>myhostname</code> as you use for your dockerized mailcow. Check your local (non-Docker) Postfix' main.cf for <code>myhostname</code> and set it to something different, for example <code>local.my.fqdn.tld</code>.</p> <p>\"172.22.1.1\" is the mailcow created network gateway in Docker. Relaying over this interface is necessary (instead of - for example - relaying directly over ${MAILCOW_HOSTNAME}) to relay over a known internal network.</p> <p>Restart Postfix after applying your changes.</p>","path":["Firststeps local mta.en"],"tags":[]},{"location":"de/post_installation/firststeps-logging.de/","level":1,"title":"Firststeps logging.de","text":"<p>Das Logging in mailcow: dockerized besteht aus mehreren Stufen, ist aber immerhin wesentlich flexibler und einfacher in einen Logging-Daemon zu integrieren als bisher.</p> <p>In Docker schreibt die containerisierte Anwendung (PID 1) ihre Ausgabe auf stdout. Für echte Ein-Anwendungs-Container funktioniert das sehr gut. Führen Sie folgenden Befehl aus, um mehr zu erfahren:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --help\n</code></pre> <pre><code>docker-compose logs --help\n</code></pre> <p>Einige Container protokollieren oder streamen an mehrere Ziele.</p> <p>Kein Container wird persistente Logs in sich behalten. Container sind flüchtige Objekte!</p> <p>Am Ende wird jede Zeile der Logs den Docker-Daemon erreichen - ungefiltert.</p> <p>Der Standard-Logging-Treiber ist \"json \".</p>","path":["Firststeps logging.de"],"tags":[]},{"location":"de/post_installation/firststeps-logging.de/#gefilterte-logs","level":3,"title":"Gefilterte Logs","text":"<p>Einige Logs werden gefiltert und in Redis-Schlüssel geschrieben, aber auch in einen Redis-Kanal gestreamt.</p> <p>Der Redis-Kanal wird verwendet, um Protokolle mit fehlgeschlagenen Authentifizierungsversuchen zu streamen, die von netfilter-mailcow gelesen werden.</p> <p>Die Redis-Schlüssel sind persistent und halten 10000 Zeilen von Logs für die Web-UI.</p> <p>Dieser Mechanismus macht es möglich, jeden beliebigen Docker-Logging-Treiber zu verwenden, ohne die  ohne die Fähigkeit zu verlieren, Logs von der UI zu lesen oder verdächtige Clients mit netfilter-mailcow zu sperren.</p> <p>Redis-Schlüssel enthalten nur Logs von Anwendungen und filtern Systemmeldungen heraus (man denke an Cron etc.).</p>","path":["Firststeps logging.de"],"tags":[]},{"location":"de/post_installation/firststeps-logging.de/#logging-treiber","level":3,"title":"Logging-Treiber","text":"","path":["Firststeps logging.de"],"tags":[]},{"location":"de/post_installation/firststeps-logging.de/#uber-docker-composeoverrideyml","level":4,"title":"Über docker-compose.override.yml","text":"<p>Hier ist die gute Nachricht: Da Docker einige großartige Logging-Treiber hat, können Sie mailcow: dockerized mit Leichtigkeit in Ihre bestehende Logging-Umgebung integrieren.</p> <p>Erstellen Sie eine <code>docker-compose.override.yml</code> und fügen Sie zum Beispiel diesen Block hinzu, um das \"gelf\" Logging-Plugin für <code>postfix-mailcow</code> zu verwenden:</p> <pre><code>services:\n  postfix-mailcow: # oder ein anderer\n    logging:\n      driver: \"gelf\"\n      options:\n        gelf-address: \"udp://graylog:12201\"\n</code></pre> <p>Ein weiteres Beispiel für Syslog:</p> <pre><code>services:\n\n  postfix-mailcow: # oder ein anderer\n    logging:\n      driver: \"syslog\"\n      options:\n        syslog-address: \"udp://127.0.0.1:514\"\n        syslog-facility: \"local3\"\n\n  dovecot-mailcow: # oder ein anderer\n    logging:\n      driver: \"syslog\"\n      options:\n        syslog-address: \"udp://127.0.0.1:514\"\n        syslog-facility: \"local3\"\n\n  rspamd-mailcow: # oder ein anderer\n    logging:\n      driver: \"syslog\"\n      options:\n        syslog-address: \"udp://127.0.0.1:514\"\n        syslog-facility: \"local3\"\n</code></pre>","path":["Firststeps logging.de"],"tags":[]},{"location":"de/post_installation/firststeps-logging.de/#nur-fur-rsyslog","level":5,"title":"Nur für rsyslog:","text":"<p>Stellen Sie sicher, dass folgende Zeilen in <code>/etc/rsyslog.conf</code> nicht auskommentiert sind:</p> <pre><code># provides UDP syslog reception\nmodule(load=\"imudp\")\ninput(type=\"imudp\" port=\"514\")\n</code></pre> <p>Um Eingänge von <code>local3</code> in <code>/var/log/mailcow.log</code> zu leiten und danach die Verarbeitung zu stoppen, erstellen Sie die Datei <code>/etc/rsyslog.d/docker.conf</code>:</p> <pre><code>local3.*        /var/log/mailcow.log\n&amp; stop\n</code></pre> <p>Starten Sie rsyslog danach neu.</p>","path":["Firststeps logging.de"],"tags":[]},{"location":"de/post_installation/firststeps-logging.de/#uber-daemonjson-global","level":4,"title":"Über daemon.json (global)","text":"<p>Wenn Sie den Logging-Treiber global ändern wollen, editieren Sie die Konfigurationsdatei des Docker-Daemons <code>/etc/docker/daemon.json</code> und starten Sie den Docker-Dienst neu:</p> <pre><code>{\n[...]\n  \"log-driver\": \"gelf\",\n  \"log-opts\": {\n    \"gelf-address\": \"udp://graylog:12201\"\n  }\n[...]\n}\n</code></pre> <p>Für Syslog:</p> <pre><code>{\n[...]\n  \"log-driver\": \"syslog\",\n  \"log-opts\": {\n    \"syslog-address\": \"udp://1.2.3.4:514\"\n  }\n[...]\n}\n</code></pre> <p>Starten Sie den Docker-Daemon neu und führen Sie die folgenden Befehle aus, um die Container mit dem neuen Protokollierungstreiber neu zu erstellen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Firststeps logging.de"],"tags":[]},{"location":"de/post_installation/firststeps-logging.de/#log-rotation","level":3,"title":"Log rotation","text":"<p>Da diese Logs sehr groß werden können, ist es eine gute Idee logrotate zu nutzen, um Logs nach einer gewissen Zeit zu komprimieren und zu löschen.</p> <p>Erstellen Sie die Datei <code>/etc/logrotate.d/mailcow</code> mit folgendem Inhalt:</p> <pre><code>/var/log/mailcow.log {\n        rotate 7\n        daily\n        compress\n        delaycompress\n        missingok\n        notifempty\n        create 660 root root\n}\n</code></pre> <p>Mit dieser Konfiguration wird logrotate täglich ausgeführt und es werden maximal 7 Archive gespeichert.</p> <p>Um die Logdatei wöchentlich oder monatlich zu rotieren, muss <code>daily</code> durch <code>weekly</code> oder respektive <code>monthly</code> ersetzt werden.</p> <p>Um mehr Archive zu speichern, muss die Nummer hinter <code>rotate</code> angepasst werden.</p> <p>Danach kann logrotate neu gestartet werden.</p>","path":["Firststeps logging.de"],"tags":[]},{"location":"de/post_installation/firststeps-logging.en/","level":1,"title":"Firststeps logging.en","text":"<p>Logging in mailcow: dockerized consists of multiple stages, but is, after all, much more flexible and easier to integrate into a logging daemon than before.</p> <p>In Docker the containerized application (PID 1) writes its output to stdout. For real one-application containers this works just fine. Run the command below to learn more:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --help\n</code></pre> <pre><code>docker-compose logs --help\n</code></pre> <p>Some containers log or stream to multiple destinations.</p> <p>No container will keep persistent logs in it. Containers are transient items!</p> <p>In the end, every line of logs will reach the Docker daemon - unfiltered.</p> <p>The default logging driver is \"json\".</p>","path":["Firststeps logging.en"],"tags":[]},{"location":"de/post_installation/firststeps-logging.en/#filtered-logs","level":3,"title":"Filtered logs","text":"<p>Some logs are filtered and written to Redis keys but also streamed to a Redis channel.</p> <p>The Redis channel is used to stream logs with failed authentication attempts to be read by netfilter-mailcow.</p> <p>The Redis keys are persistent and will keep 10000 lines of logs for the web UI.</p> <p>This mechanism makes it possible to use whatever Docker logging driver you want to, without losing  the ability to read logs from the UI or ban suspicious clients with netfilter-mailcow.</p> <p>Redis keys will only hold logs from applications and filter out system messages (think of cron etc.).</p>","path":["Firststeps logging.en"],"tags":[]},{"location":"de/post_installation/firststeps-logging.en/#logging-drivers","level":3,"title":"Logging drivers","text":"","path":["Firststeps logging.en"],"tags":[]},{"location":"de/post_installation/firststeps-logging.en/#via-docker-composeoverrideyml","level":4,"title":"Via docker-compose.override.yml","text":"<p>Here is the good news: Since Docker has some great logging drivers, you can integrate mailcow: dockerized into your existing logging environment with ease.</p> <p>Create a <code>docker-compose.override.yml</code> and add, for example, this block to use the \"gelf\" logging plugin for <code>postfix-mailcow</code>:</p> <pre><code>services:\n  postfix-mailcow: # or any other\n    logging:\n      driver: \"gelf\"\n      options:\n        gelf-address: \"udp://graylog:12201\"\n</code></pre> <p>Another example for Syslog:</p> <pre><code>services:\n\n  postfix-mailcow: # or any other\n    logging:\n      driver: \"syslog\"\n      options:\n        syslog-address: \"udp://127.0.0.1:514\"\n        syslog-facility: \"local3\"\n\n  dovecot-mailcow: # or any other\n    logging:\n      driver: \"syslog\"\n      options:\n        syslog-address: \"udp://127.0.0.1:514\"\n        syslog-facility: \"local3\"\n\n  rspamd-mailcow: # or any other\n    logging:\n      driver: \"syslog\"\n      options:\n        syslog-address: \"udp://127.0.0.1:514\"\n        syslog-facility: \"local3\"\n</code></pre>","path":["Firststeps logging.en"],"tags":[]},{"location":"de/post_installation/firststeps-logging.en/#for-rsyslog-only","level":5,"title":"For Rsyslog only:","text":"<p>Make sure the following lines aren't commented out in <code>/etc/rsyslog.conf</code>:</p> <pre><code># provides UDP syslog reception\nmodule(load=\"imudp\")\ninput(type=\"imudp\" port=\"514\")\n</code></pre> <p>To move <code>local3</code> input to <code>/var/log/mailcow.log</code> and stop processing, create a file <code>/etc/rsyslog.d/docker.conf</code>:</p> <pre><code>local3.*        /var/log/mailcow.log\n&amp; stop\n</code></pre> <p>Restart rsyslog afterwards.</p>","path":["Firststeps logging.en"],"tags":[]},{"location":"de/post_installation/firststeps-logging.en/#via-daemonjson-globally","level":4,"title":"via daemon.json (globally)","text":"<p>If you want to change the logging driver globally, edit Dockers daemon configuration file <code>/etc/docker/daemon.json</code> and restart the Docker service:</p> <pre><code>{\n...\n  \"log-driver\": \"gelf\",\n  \"log-opts\": {\n    \"gelf-address\": \"udp://graylog:12201\"\n  }\n...\n}\n</code></pre> <p>For Syslog:</p> <pre><code>{\n...\n  \"log-driver\": \"syslog\",\n  \"log-opts\": {\n    \"syslog-address\": \"udp://1.2.3.4:514\"\n  }\n...\n}\n</code></pre> <p>Restart the Docker daemon and run the commands below to recreate the containers with the new logging driver:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Firststeps logging.en"],"tags":[]},{"location":"de/post_installation/firststeps-logging.en/#log-rotation","level":3,"title":"Log rotation","text":"<p>As those logs can get quite big, it is a good idea to use logrotate to compress and delete them after a certain time period.</p> <p>Create <code>/etc/logrotate.d/mailcow</code> with the following content:</p> <pre><code>/var/log/mailcow.log {\n        rotate 7\n        daily\n        compress\n        delaycompress\n        missingok\n        notifempty\n        create 660 root root\n}\n</code></pre> <p>With this configuration, logrotate will run daily and keep a maximum of 7 archives.</p> <p>To rotate the logfile weekly or monthly replace <code>daily</code> with <code>weekly</code> or <code>monthly</code> respectively.</p> <p>To keep more archives, set the desired number of <code>rotate</code>.</p> <p>Afterwards, logrotate can be restarted.</p>","path":["Firststeps logging.en"],"tags":[]},{"location":"de/post_installation/firststeps-snat.de/","level":1,"title":"Firststeps snat.de","text":"<p>SNAT wird verwendet, um die Quelladresse der von mailcow gesendeten Pakete zu ändern. Es kann verwendet werden, um die ausgehende IP-Adresse auf Systemen mit mehreren IP-Adressen zu ändern.</p> <p>Öffnen Sie <code>mailcow.conf</code>, setzen Sie einen oder beide der folgenden Parameter:</p> <pre><code># Benutze diese IPv4 für ausgehende Verbindungen (SNAT)\nSNAT_TO_SOURCE=1.2.3.4\n\n# Benutze dieses IPv6 für ausgehende Verbindungen (SNAT)\nSNAT6_TO_SOURCE=dead:beef\n</code></pre> <p>Führen Sie folgendes aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Die Werte werden von netfilter-mailcow gelesen. netfilter-mailcow stellt sicher, dass die Post-Routing-Regeln auf Position 1 in der Netfilter-Tabelle stehen. Es löscht sie automatisch und legt sie neu an, wenn sie an einer anderen Position als 1 gefunden werden.</p> <p>Überprüfen Sie die Ausgabe mit hilfe des folgendem Befehles um sicherzustellen, dass die SNAT-Einstellungen angewendet wurden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --tail=200 netfilter-mailcow\n</code></pre> <pre><code>docker-compose logs --tail=200 netfilter-mailcow\n</code></pre>","path":["Firststeps snat.de"],"tags":[]},{"location":"de/post_installation/firststeps-snat.en/","level":1,"title":"Firststeps snat.en","text":"<p>SNAT is used to change the source address of the packets sent by mailcow. It can be used to change the outgoing IP address on systems with multiple IP addresses.</p> <p>Open <code>mailcow.conf</code>, set either or both of the following parameters:</p> <pre><code># Use this IPv4 for outgoing connections (SNAT)\nSNAT_TO_SOURCE=1.2.3.4\n\n# Use this IPv6 for outgoing connections (SNAT)\nSNAT6_TO_SOURCE=dead:beef\n</code></pre> <p>Run the command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>The values are read by netfilter-mailcow. netfilter-mailcow will make sure, the post-routing rules are on position 1 in the netfilter table. It does automatically delete and re-create them if they are found on another position than 1.</p> <p>Check the output with the following command to ensure the SNAT settings have been applied:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --tail=200 netfilter-mailcow\n</code></pre> <pre><code>docker-compose logs --tail=200 netfilter-mailcow\n</code></pre>","path":["Firststeps snat.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/","level":1,"title":"Firststeps ssl.de","text":"","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#lets-encrypt-wird-mitgeliefert","level":2,"title":"Let's Encrypt (wird mitgeliefert)","text":"<p>Der \"acme-mailcow\" Container wird versuchen, ein LE-Zertifikat für <code>${MAILCOW_HOSTNAME}</code>, <code>autodiscover.ADDED_MAIL_DOMAIN</code> und <code>autoconfig.ADDED_MAIL_DOMAIN</code> zu erhalten.</p> <p>Warnung</p> <p>mailcow muss auf Port 80 verfügbar sein, damit der acme-Client funktioniert. Unsere Reverse Proxy Beispielkonfigurationen decken das ab. Sie können auch jeden externen ACME-Client (z.B. certbot) verwenden, um Zertifikate zu erhalten, aber Sie müssen sicherstellen, dass sie an den richtigen Ort kopiert werden und ein Post-Hook die betroffenen Container neu lädt. Weitere Informationen finden Sie in der Reverse Proxy-Dokumentation.</p> <p>Standardmäßig, d.h. 0 Domains sind zu mailcow hinzugefügt, wird es versuchen, ein Zertifikat für <code>${MAILCOW_HOSTNAME}</code> zu erhalten.</p> <p>Für jede hinzugefügte Domain wird versucht, <code>autodiscover.ADDED_MAIL_DOMAIN</code> und <code>autoconfig.ADDED_MAIL_DOMAIN</code> in die IPv6-Adresse oder - falls IPv6 in der Domain nicht konfiguriert ist - in die IPv4-Adresse aufzulösen. Wenn dies gelingt, wird ein Name als SAN zur Zertifikatsanforderung hinzugefügt.</p> <p>Nur Namen, die validiert werden können, werden als SAN hinzugefügt.</p> <p>Für jede Domain, die Sie entfernen, wird das Zertifikat verschoben und ein neues Zertifikat angefordert. Es ist nicht möglich, Domains in einem Zertifikat zu behalten, wenn wir nicht in der Lage sind, die Challenge für diese zu validieren.</p> <p>Wenn Sie den ACME-Client neu starten wollen, verwenden Sie den folgenden Befehl:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart acme-mailcow\n</code></pre> <pre><code>docker-compose restart acme-mailcow\n</code></pre> <p>Überwachen Sie die Logs mit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --tail=200 -f acme-mailcow\n</code></pre> <pre><code>docker-compose logs --tail=200 -f acme-mailcow\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#zusatzliche-domain-namen","level":3,"title":"Zusätzliche Domain-Namen","text":"<p>Bearbeiten Sie \"mailcow.conf\" und fügen Sie einen Parameter <code>ADDITIONAL_SAN</code> wie folgt hinzu:</p> <p>Verwenden Sie keine Anführungszeichen (<code>\"</code>) und keine Leerzeichen zwischen den Namen!</p> <pre><code>ADDITIONAL_SAN=smtp.*,cert1.example.com,cert2.example.org,whatever.*\n</code></pre> <p>Jeder Name wird anhand seiner IPv6-Adresse oder - wenn IPv6 in Ihrer Domäne nicht konfiguriert ist - anhand seiner IPv4-Adresse überprüft.</p> <p>Ein Wildcard-Name wie <code>smtp.*</code> wird versuchen, ein smtp.DOMAIN_NAME SAN für jede zu mailcow hinzugefügte Domain zu erhalten.</p> <p>Führen Sie den folgenden Befehl aus, um betroffene Container automatisch neu zu erstellen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Info</p> <p>Die Verwendung anderer Namen als <code>MAILCOW_HOSTNAME</code> für den Zugriff auf das mailcow UI kann weitere Konfiguration erfordern.</p> <p>Wenn Sie planen, einen anderen Servernamen als <code>MAILCOW_HOSTNAME</code> für den Zugriff auf die mailcow UI zu verwenden (z.B. durch Hinzufügen von <code>mail.*</code> zu <code>ADDITIONAL_SAN</code>), stellen Sie sicher, dass Sie diesen Namen in mailcow.conf über <code>ADDITIONAL_SERVER_NAMES</code> eintragen. Die Namen müssen durch Kommas getrennt sein und dürfen keine Leerzeichen enthalten. Wenn Sie diesen Schritt auslassen, kann mailcow mit einer falschen Seite antworten.</p> <pre><code>ADDITIONAL_SERVER_NAMES=webmail.domain.tld,other.example.tld\n</code></pre> <p>Führen Sie den folgenden Befehl aus, um es anzuwenden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#erneuerung-erzwingen","level":3,"title":"Erneuerung erzwingen","text":"<p>Um eine Erneuerung zu erzwingen, müssen Sie eine Datei namens <code>force_renew</code> erstellen und den <code>acme-mailcow</code> Container neu starten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ntouch data/assets/ssl/force_renew\ndocker compose restart acme-mailcow\n# Prüfen Sie nun die Logs auf eine Erneuerung\ndocker compose logs --tail=200 -f acme-mailcow\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ntouch data/assets/ssl/force_renew\ndocker-compose restart acme-mailcow\n# Prüfen Sie nun die Logs auf eine Erneuerung\ndocker-compose logs --tail=200 -f acme-mailcow\n</code></pre> <p>Die Datei wird automatisch gelöscht.</p>","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#validierungsfehler-und-wie-man-die-validierung-uberspringt","level":3,"title":"Validierungsfehler und wie man die Validierung überspringt","text":"<p>Sie können die IP-Überprüfung überspringen, indem Sie <code>SKIP_IP_CHECK=y</code> in mailcow.conf setzen (keine Anführungszeichen). Seien Sie gewarnt, dass eine Fehlkonfiguration dazu führt, dass Sie von Let's Encrypt eingeschränkt werden! Dies ist vor allem für Multi-IP-Setups nützlich, bei denen der IP-Check die falsche Quell-IP-Adresse zurückgeben würde. Aufgrund der Verwendung von dynamischen IPs für acme-mailcow ist Source-NAT bei Neustarts nicht konsistent.</p> <p>Wenn Sie Probleme mit der \"HTTP-Validierung\" haben, aber Ihre IP-Adressbestätigung erfolgreich ist, verwenden Sie höchstwahrscheinlich firewalld, ufw oder eine andere Firewall, die Verbindungen von <code>br-mailcow</code> zu Ihrem externen Interface verbietet. Sowohl firewalld als auch ufw lassen dies standardmäßig nicht zu. Es reicht oft nicht aus, diese Firewall-Dienste einfach zu stoppen. Sie müssen mailcow stoppen, den Firewall-Dienst stoppen, die Chains flushen und Docker neu starten.</p> <p>Sie können diese Validierungsmethode auch überspringen, indem Sie <code>SKIP_HTTP_VERIFICATION=y</code> in \"mailcow.conf\" setzen. Seien Sie gewarnt, dass dies nicht zu empfehlen ist. In den meisten Fällen wird die HTTP-Überprüfung übersprungen, um unbekannte NAT-Reflection-Probleme zu umgehen, die durch das Ignorieren dieser spezifischen Netzwerk-Fehlkonfiguration nicht gelöst werden. Wenn Sie Probleme haben, TLSA-Einträge in der DNS-Übersicht innerhalb von mailcow zu generieren, haben Sie höchstwahrscheinlich Probleme mit NAT-Reflexion, die Sie beheben sollten.</p> <p>Wenn Sie einen SKIP_* Parameter geändert haben, führen Sie den folgenden Befehl aus, um die Änderungen zu übernehmen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#deaktivieren-sie-lets-encrypt","level":3,"title":"Deaktivieren Sie Let's Encrypt","text":"","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#deaktivieren-sie-lets-encrypt-vollstandig","level":4,"title":"Deaktivieren Sie Let's Encrypt vollständig","text":"<p>Setzen Sie <code>SKIP_LETS_ENCRYPT=y</code> in \"mailcow.conf\" und erstellen Sie \"acme-mailcow\" neu, mit dem folgenden Befehl:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#alle-namen-auer-mailcow_hostname-uberspringen","level":4,"title":"Alle Namen außer ${MAILCOW_HOSTNAME} überspringen","text":"<p>Fügen Sie <code>ONLY_MAILCOW_HOSTNAME=y</code> zu \"mailcow.conf\" hinzu und erstellen Sie \"acme-mailcow\" neu, mit dem folgenden Befehl:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#das-lets-encrypt-subjectaltname-limit-von-100-domains","level":3,"title":"Das Let's Encrypt subjectAltName-Limit von 100 Domains","text":"<p>Let's Encrypt hat derzeit ein Limit von 100 Domainnamen pro Zertifikat.</p> <p>Standardmäßig erstellt \"acme-mailcow\" ein einzelnes SAN-Zertifikat für alle validierten Domains (siehe den ersten Abschnitt und Zusätzliche Domainnamen). Dies bietet beste Kompatibilität, bedeutet aber, dass das Let's Encrypt-Limit überschritten wird, wenn Sie zu viele Domains zu einer einzelnen mailcow-Installation hinzufügen.</p> <p>Um dies zu lösen, können Sie <code>ENABLE_SSL_SNI</code> so konfigurieren, dass es generiert wird:</p> <ul> <li>Ein Hauptserver-Zertifikat mit <code>MAILCOW_HOSTNAME</code> und allen voll qualifizierten Domainnamen in der <code>ADDITIONAL_SAN</code> Konfiguration</li> <li>Ein zusätzliches Zertifikat für jede in der Datenbank gefundene Domain mit autodiscover., autoconfig. und jeder anderen in diesem Format konfigurierten <code>ADDITIONAL_SAN</code> (subdomain.*).</li> <li>Begrenzungen: Ein Zertifikatsname <code>ADDITIONAL_SAN=test.example.com</code> wird als SAN zum Hauptzertifikat hinzugefügt. Ein separates Zertifikat/Schlüsselpaar wird für dieses Format nicht erzeugt.</li> </ul> <p>Postfix, Dovecot und Nginx werden dann diese Zertifikate mit SNI bedienen.</p> <p>Setzen Sie <code>ENABLE_SSL_SNI=y</code> in \"mailcow.conf\" und erstellen Sie \"acme-mailcow\" mit dem folgenden Befehl neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Warnung</p> <p>Nicht alle Clients unterstützen SNI, siehe Dovecot Dokumentation oder Wikipedia. Sie sollten sicherstellen, dass diese Clients den <code>MAILCOW_HOSTNAME</code> für sichere Verbindungen verwenden, wenn Sie diese Funktion aktivieren.</p> <p>Hier ist ein Beispiel:</p> <ul> <li><code>MAILCOW_HOSTNAME=server.email.tld</code></li> <li><code>ADDITIONAL_SAN=webmail.email.tld,mail.*</code></li> <li>mailcow E-Mail-Domänen: \"domain1.tld\" und \"domain2.tld\"</li> </ul> <p>Die folgenden Zertifikate werden generiert:</p> <ul> <li><code>server.email.tld, webmail.email.tld</code> -&gt; dies ist das Standard-Zertifikat, alle Clients können sich mit diesen Domains verbinden</li> <li><code>mail.domain1.tld, autoconfig.domain1.tld, autodiscover.domain1.tld</code> -&gt; individuelles Zertifikat für domain1.tld, kann von Clients ohne SNI-Unterstützung nicht verwendet werden</li> <li><code>mail.domain2.tld, autoconfig.domain2.tld, autodiscover.domain2.tld</code> -&gt; individuelles Zertifikat für domain2.tld, kann von Clients ohne SNI-Unterstützung nicht verwendet werden</li> </ul>","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#ein-eigenes-zertifikat-verwenden","level":3,"title":"Ein eigenes Zertifikat verwenden","text":"<p>Stellen Sie sicher, dass Sie mailcows internen LE-Client deaktivieren (siehe oben).</p> <p>Um Ihre eigenen Zertifikate zu verwenden, speichern Sie einfach das kombinierte Zertifikat (mit dem Zertifikat und der zwischengeschalteten CA/CA, falls vorhanden) unter <code>data/assets/ssl/cert.pem</code> und den entsprechenden Schlüssel unter <code>data/assets/ssl/key.pem</code>.</p> <p>WICHTIG: Verwenden Sie keine symbolischen Links! Stellen Sie sicher, dass Sie die Zertifikate kopieren und sie nicht mit <code>data/assets/ssl</code> verknüpfen.</p> <p>Starten Sie die betroffenen Dienste anschließend neu:</p> <pre><code>docker restart $(docker ps -qaf name=postfix-mailcow)\ndocker restart $(docker ps -qaf name=nginx-mailcow)\ndocker restart $(docker ps -qaf name=dovecot-mailcow)\n</code></pre> <p>Siehe Post-Hook-Skript für Nicht-mailcow-ACME-Clients für ein vollständiges Beispielskript.</p>","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#test-gegen-das-acme-verzeichnis","level":3,"title":"Test gegen das ACME-Verzeichnis","text":"<p>Bearbeiten Sie <code>mailcow.conf</code> und fügen Sie <code>LE_STAGING=y</code> hinzu.</p> <p>Führen Sie den folgenden Befehl aus, um Ihre Änderungen zu aktivieren:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#benutzerdefinierte-verzeichnis-url","level":3,"title":"Benutzerdefinierte Verzeichnis-URL","text":"<p>Editieren Sie <code>mailcow.conf</code> und fügen Sie die entsprechende Verzeichnis-URL in die neue Variable <code>DIRECTORY_URL</code> ein:</p> <pre><code>DIRECTORY_URL=https://acme-custom-v9000.api.letsencrypt.org/directory\n</code></pre> <p>Sie können <code>LE_STAGING</code> nicht mit <code>DIRECTORY_URL</code> verwenden. Wenn beide gesetzt sind, wird nur <code>LE_STAGING</code> verwendet.</p> <p>Führen Sie den folgenden Befehl aus, um Ihre Änderungen zu aktivieren:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#caa-eintrage-mit-dem-accounturi-parameter","level":3,"title":"CAA-Einträge mit dem <code>accounturi</code>-Parameter","text":"<p>Let's Encrypt ermöglicht es, mithilfe des <code>accounturi</code>-Paramaters in CAA-Einträgen die Zertifikatsausstellung auf spezifische Account-IDs zu beschränken. Sie können das Helper-Skript <code>generate_caa_record.py</code> verwenden, um einen CAA-Eintrag mit <code>accounturi</code> zu erstellen, welchen Sie dann bei Ihrem DNS-Anbieter eintragen können:</p> <pre><code>./helper-scripts/generate_caa_record.py --account-key data/assets/ssl/acme/account.pem --contact mailto:ihre_acme_email@beispiel.de\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.de/#uberprufen-sie-ihre-konfiguration","level":3,"title":"Überprüfen Sie Ihre Konfiguration","text":"<p>Führen Sie den folgenden Befehl aus, um herauszufinden, warum eine Validierung fehlschlägt:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --tail=200 acme-mailcow\n</code></pre> <pre><code>docker-compose logs --tail=200 acme-mailcow\n</code></pre> <p>Um zu überprüfen, ob nginx das richtige Zertifikat verwendet, benutzen Sie einfach einen Browser Ihrer Wahl und überprüfen Sie das angezeigte Zertifikat.</p> <p>Um das von Postfix, Dovecot und Nginx verwendete Zertifikat zu überprüfen, verwenden wir <code>openssl</code>:</p> <pre><code># Verbindung über SMTP STARTTLS (587)\nopenssl s_client -starttls smtp -connect MAILCOW_HOSTNAME:587 | openssl x509 -noout -text\n# Verbindung über SMTP (465)\nopenssl s_client -connect MAILCOW_HOSTNAME:465 | openssl x509 -noout -text\n\n# Verbindung über IMAP STARTTLS (143)\nopenssl s_client -starttls imap -connect MAILCOW_HOSTNAME:143 | openssl x509 -noout -text\n# Verbindung über IMAP (993)\nopenssl s_client -connect MAILCOW_HOSTNAME:993 | openssl x509 -noout -text\n\n# Verbindung über HTTPS (443)\nopenssl s_client -connect MAILCOW_HOSTNAME:443 | openssl x509 -noout -text\n</code></pre> <p>Um die von openssl zurückgegebenen Verfallsdaten gegen MAILCOW_HOSTNAME zu validieren, können Sie unser Hilfsskript verwenden:</p> <pre><code>cd /opt/mailcow-dockerized\nbash helper-scripts/expiry-dates.sh\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/","level":1,"title":"Firststeps ssl.en","text":"","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#lets-encrypt-out-of-the-box","level":2,"title":"Let's Encrypt (out-of-the-box)","text":"<p>The \"acme-mailcow\" container will try to obtain a LE certificate for <code>${MAILCOW_HOSTNAME}</code>, <code>autodiscover.ADDED_MAIL_DOMAIN</code> and <code>autoconfig.ADDED_MAIL_DOMAIN</code>.</p> <p>Warning</p> <p>mailcow must be available on port 80 for the acme-client to work. Our reverse proxy example configurations do cover that. You can also use any external ACME client (certbot for example) to obtain certificates, but you will need to make sure, that they are copied to the correct location and a post-hook reloads affected containers. See more in the Reverse Proxy documentation.</p> <p>By default, which means 0 domains are added to mailcow, it will try to obtain a certificate for <code>${MAILCOW_HOSTNAME}</code>.</p> <p>For each domain you add, it will try to resolve <code>autodiscover.ADDED_MAIL_DOMAIN</code> and <code>autoconfig.ADDED_MAIL_DOMAIN</code> to its IPv6 address or - if IPv6 is not configured in your domain - IPv4 address. If it succeeds, a name will be added as SAN to the certificate request.</p> <p>Only names that can be validated, will be added as SAN.</p> <p>For every domain you remove, the certificate will be moved and a new certificate will be requested. It is not possible to keep domains in a certificate, when we are not able validate the challenge for those.</p> <p>If you want to re-run the ACME client, use the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart acme-mailcow\n</code></pre> <pre><code>docker-compose restart acme-mailcow\n</code></pre> <p>Monitor its logs with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --tail=200 -f acme-mailcow\n</code></pre> <pre><code>docker-compose logs --tail=200 -f acme-mailcow\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#additional-domain-names","level":3,"title":"Additional domain names","text":"<p>Edit \"mailcow.conf\" and add a parameter <code>ADDITIONAL_SAN</code> like this:</p> <p>Do not use quotes (<code>\"</code>) and do not use spaces between the names!</p> <pre><code>ADDITIONAL_SAN=smtp.*,cert1.example.com,cert2.example.org,whatever.*\n</code></pre> <p>Each name will be validated against its IPv6 address or - if IPv6 is not configured in your domain - IPv4 address.</p> <p>A wildcard name like <code>smtp.*</code> will try to obtain a smtp.DOMAIN_NAME SAN for each domain added to mailcow.</p> <p>Run the following command  to recreate affected containers automatically:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Info</p> <p>Using names other name <code>MAILCOW_HOSTNAME</code> to access the mailcow UI may need further configuration.</p> <p>If you plan to use a server name that is not <code>MAILCOW_HOSTNAME</code> to access the mailcow UI (for example by adding <code>mail.*</code> to <code>ADDITIONAL_SAN</code> make sure to populate that name in mailcow.conf via <code>ADDITIONAL_SERVER_NAMES</code>. Names must be separated by commas and must not contain spaces. If you skip this step, mailcow may respond with an incorrect site.</p> <pre><code>ADDITIONAL_SERVER_NAMES=webmail.domain.tld,other.example.tld\n</code></pre> <p>Run the command below to apply:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#force-renewal","level":3,"title":"Force renewal","text":"<p>To force a renewal, you need to create a file named <code>force_renew</code> and restart the <code>acme-mailcow</code> container:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ntouch data/assets/ssl/force_renew\ndocker compose restart acme-mailcow\n# Now check the logs for a renewal\ndocker compose logs --tail=200 -f acme-mailcow\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ntouch data/assets/ssl/force_renew\ndocker-compose restart acme-mailcow\n# Now check the logs for a renewal\ndocker-compose logs --tail=200 -f acme-mailcow\n</code></pre> <p>The file will be deleted automatically.</p>","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#validation-errors-and-how-to-skip-validation","level":3,"title":"Validation errors and how to skip validation","text":"<p>You can skip the IP verification by setting <code>SKIP_IP_CHECK=y</code> in mailcow.conf (no quotes). Be warned that a misconfiguration will get you ratelimited by Let's Encrypt! This is primarily useful for multi-IP setups where the IP check would return the incorrect source IP address. Due to using dynamic IPs for acme-mailcow, source NAT is not consistent over restarts.</p> <p>If you encounter problems with \"HTTP validation\", but your IP address confirmation succeeds, you are most likely using firewalld, ufw or any other firewall, that disallows connections from <code>br-mailcow</code> to your external interface. Both firewalld and ufw disallow this by default. It is often not enough to just stop these firewall services. You'd need to stop mailcow, stop the firewall service, flush the chains and restart Docker.</p> <p>You can also skip this validation method by setting <code>SKIP_HTTP_VERIFICATION=y</code> in \"mailcow.conf\". Be warned that this is discouraged. In most cases, the HTTP verification is skipped to workaround unknown NAT reflection issues, which are not resolved by ignoring this specific network misconfiguration. If you encounter problems generating TLSA records in the DNS overview within mailcow, you are most likely having issues with NAT reflection you should fix.</p> <p>If you changed a SKIP_* parameter, run the command below to apply your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#disable-lets-encrypt","level":3,"title":"Disable Let's Encrypt","text":"","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#disable-lets-encrypt-completely","level":4,"title":"Disable Let's Encrypt completely","text":"<p>Set <code>SKIP_LETS_ENCRYPT=y</code> in \"mailcow.conf\" and recreate \"acme-mailcow\" with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#skip-all-names-but-mailcow_hostname","level":4,"title":"Skip all names but ${MAILCOW_HOSTNAME}","text":"<p>Add <code>ONLY_MAILCOW_HOSTNAME=y</code> to \"mailcow.conf\" and recreate \"acme-mailcow\" with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#the-lets-encrypt-subjectaltname-limit-of-100-domains","level":3,"title":"The Let's Encrypt subjectAltName limit of 100 domains","text":"<p>Let's Encrypt currently has a limit of 100 Domain Names per Certificate.</p> <p>By default, \"acme-mailcow\" will create a single SAN certificate for all validated domains (see the first section and Additional domain names). This provides best compatibility but means the Let's Encrypt limit exceeds if you add too many domains to a single mailcow installation.</p> <p>To solve this, you can configure <code>ENABLE_SSL_SNI</code> to generate:</p> <ul> <li>A main server certificate with <code>MAILCOW_HOSTNAME</code> and all fully qualified domain names in the <code>ADDITIONAL_SAN</code> config</li> <li>One additional certificate for each domain found in the database with autodiscover., autoconfig. and any other <code>ADDITIONAL_SAN</code> configured in this format (subdomain.*).</li> <li>Limitations: A certificate name <code>ADDITIONAL_SAN=test.example.com</code> will be added as SAN to the main certificate. A separate certificate/key pair will not be generated for this format.</li> </ul> <p>Postfix, Dovecot and Nginx will then serve these certificates with SNI.</p> <p>Set <code>ENABLE_SSL_SNI=y</code> in \"mailcow.conf\" and recreate \"acme-mailcow\" with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Warning</p> <p>Not all clients support SNI, see Dovecot documentation or Wikipedia. You should make sure these clients use the <code>MAILCOW_HOSTNAME</code> for secure connections if you enable this feature.</p> <p>Here is an example:</p> <ul> <li><code>MAILCOW_HOSTNAME=server.email.tld</code></li> <li><code>ADDITIONAL_SAN=webmail.email.tld,mail.*</code></li> <li>mailcow email domains: \"domain1.tld\" and \"domain2.tld\"</li> </ul> <p>The following certificates will be generated:</p> <ul> <li><code>server.email.tld, webmail.email.tld</code> -&gt; this is the default certificate, all clients can connect with these domains</li> <li><code>mail.domain1.tld, autoconfig.domain1.tld, autodiscover.domain1.tld</code> -&gt; individual certificate for domain1.tld, cannot be used by clients without SNI support</li> <li><code>mail.domain2.tld, autoconfig.domain2.tld, autodiscover.domain2.tld</code> -&gt; individual certificate for domain2.tld, cannot be used by clients without SNI support</li> </ul>","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#how-to-use-your-own-certificate","level":3,"title":"How to use your own certificate","text":"<p>Make sure you disable mailcows internal LE client (see above).</p> <p>To use your own certificates, just save the combined certificate (containing the certificate and intermediate CA/CA if any) to <code>data/assets/ssl/cert.pem</code> and the corresponding key to <code>data/assets/ssl/key.pem</code>.</p> <p>IMPORTANT: Do not use symbolic links! Make sure you copy the certificates and do not link them to <code>data/assets/ssl</code>.</p> <p>Restart affected services afterwards:</p> <pre><code>docker restart $(docker ps -qaf name=postfix-mailcow)\ndocker restart $(docker ps -qaf name=nginx-mailcow)\ndocker restart $(docker ps -qaf name=dovecot-mailcow)\n</code></pre> <p>See Post-hook script for non-mailcow ACME clients for a full example script.</p>","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#test-against-staging-acme-directory","level":3,"title":"Test against staging ACME directory","text":"<p>Edit <code>mailcow.conf</code> and add <code>LE_STAGING=y</code>.</p> <p>Run the command below to activate your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#custom-directory-url","level":3,"title":"Custom directory URL","text":"<p>Edit <code>mailcow.conf</code> and add the corresponding directory URL to the new variable <code>DIRECTORY_URL</code>:</p> <pre><code>DIRECTORY_URL=https://acme-custom-v9000.api.letsencrypt.org/directory\n</code></pre> <p>You cannot use <code>LE_STAGING</code> with <code>DIRECTORY_URL</code>. If both are set, only <code>LE_STAGING</code> is used.</p> <p>Run the command below to activate your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#use-caa-records-with-the-accounturi-parameter","level":3,"title":"Use CAA records with the <code>accounturi</code> parameter","text":"<p>Let's Encrypt allows restricting certificate issuance to specific account IDs via the <code>accounturi</code> parameter in CAA records. You can use the <code>generate_caa_record.py</code> helper script to generate a CAA record with <code>accounturi</code>, which you can then enter with your DNS provider:</p> <pre><code>./helper-scripts/generate_caa_record.py --account-key data/assets/ssl/acme/account.pem --contact mailto:your_acme_email@example.com\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-ssl.en/#check-your-configuration","level":3,"title":"Check your configuration","text":"<p>Run the command below to find out why a validation fails:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --tail=200 acme-mailcow\n</code></pre> <pre><code>docker-compose logs --tail=200 acme-mailcow\n</code></pre> <p>To check if nginx serves the correct certificate, simply use a browser of your choice and check the displayed certificate.</p> <p>To check the certificate served by Postfix, Dovecot and Nginx we will use <code>openssl</code>:</p> <pre><code># Connect via SMTP STARTTLS (587)\nopenssl s_client -starttls smtp -connect MAILCOW_HOSTNAME:587 | openssl x509 -noout -text\n# Connect via SMTP (465)\nopenssl s_client -connect MAILCOW_HOSTNAME:465 | openssl x509 -noout -text\n\n# Connect via IMAP STARTTLS (143)\nopenssl s_client -starttls imap -connect MAILCOW_HOSTNAME:143 | openssl x509 -noout -text\n# Connect via IMAP (993)\nopenssl s_client -connect MAILCOW_HOSTNAME:993 | openssl x509 -noout -text\n\n# Connect via HTTPS (443)\nopenssl s_client -connect MAILCOW_HOSTNAME:443 | openssl x509 -noout -text\n</code></pre> <p>To validate the expiry dates as returned by openssl against MAILCOW_HOSTNAME, you are able to use our helper script:</p> <pre><code>cd /opt/mailcow-dockerized\nbash helper-scripts/expiry-dates.sh\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"de/post_installation/firststeps-sync_jobs_migration.de/","level":1,"title":"Firststeps sync jobs migration.de","text":"<p>Sync-Aufträge werden verwendet, um bestehende E-Mails von einem externen IMAP-Server oder innerhalb von mailcow's bestehenden Mailboxen zu kopieren oder zu verschieben.</p> <p>Info</p> <p>Abhängig von der ACL Ihrer Mailbox haben Sie möglicherweise nicht die Möglichkeit, einen Sync-Job hinzuzufügen. Bitte kontaktieren Sie in diesem Fall Ihren Domain-Administrator.</p>","path":["Firststeps sync jobs migration.de"],"tags":[]},{"location":"de/post_installation/firststeps-sync_jobs_migration.de/#einrichten-eines-sync-jobs","level":2,"title":"Einrichten eines Sync-Jobs","text":"<ol> <li> <p>Erstellen Sie unter dem Punkt \"Konfiguration &gt; E-Mail-Setup\" oder \"Benutzereinstellungen\" einen neuen Synchronisierungsauftrag.</p> </li> <li> <p>Wenn Sie ein Administrator sind, wählen Sie den Benutzernamen der nachgelagerten mailcow-Mailbox im Dropdown-Menü \"Benutzername\".</p> </li> <li> <p>Füllen Sie die Felder \"Host\" und \"Port\" mit den entsprechenden korrekten Werten des vorgelagerten IMAP-Servers aus.</p> </li> <li> <p>Geben Sie in den Feldern \"Benutzername\" und \"Passwort\" die korrekten Zugangsdaten des vorgelagerten IMAP-Servers ein.</p> </li> <li> <p>Wählen Sie die \"Verschlüsselungsmethode\". Wenn der vorgelagerte IMAP-Server Port 143 verwendet, ist es wahrscheinlich, dass die Verschlüsselungsmethode TLS und SSL für Port 993 ist. Sie können auch PLAIN-Authentifizierung verwenden, aber davon wird dringend abgeraten.</p> </li> <li> <p>Alle anderen Felder können Sie so lassen, wie sie sind, oder sie nach Belieben ändern.</p> </li> <li> <p>Vergewissern Sie sich, dass Sie \"Aktiv\" ankreuzen und klicken Sie auf \"Hinzufügen\".</p> </li> </ol> <p>Info</p> <p>Sobald Sie fertig sind, melden Sie sich in der Mailbox an und überprüfen Sie, ob alle E-Mails korrekt importiert wurden. Wenn alles gut geht, werden alle Ihre E-Mails in Ihrem neuen Postfach landen. Vergessen Sie nicht, den Synchronisierungsauftrag zu löschen oder zu deaktivieren, nachdem er verwendet wurde.</p>","path":["Firststeps sync jobs migration.de"],"tags":[]},{"location":"de/post_installation/firststeps-sync_jobs_migration.en/","level":1,"title":"Firststeps sync jobs migration.en","text":"<p>Sync jobs are used to copy or move existing emails from an external IMAP server or within mailcow's existing mailboxes.</p> <p>Info</p> <p>Depending on your mailbox's ACL you may not have the option to add a sync job. Please contact your domain administrator if so.</p>","path":["Firststeps sync jobs migration.en"],"tags":[]},{"location":"de/post_installation/firststeps-sync_jobs_migration.en/#setup-a-sync-job","level":2,"title":"Setup a Sync Job","text":"<ol> <li> <p>In the \"Configuration &gt; Mail Setup\" or \"User Settings\" interface, create a new sync job.</p> </li> <li> <p>If you are an administrator, select the username of the downstream mailcow mailbox in the \"Username\" dropdown.</p> </li> <li> <p>Fill in the \"Host\" and \"Port\" fields with their respective correct values from the upstream IMAP server.</p> </li> <li> <p>In the \"Username\" and \"Password\" fields, supply the correct access credentials from the upstream IMAP server.</p> </li> <li> <p>Select the \"Encryption Method\". If the upstream IMAP server uses port 143, it is likely that the encryption method is TLS and SSL for port 993. Nevertheless, you can use PLAIN authentication, but it is stongly discouraged.</p> </li> <li> <p>For all ther other fields, you can leave them as is or modify them as desired.</p> </li> <li> <p>Make sure to tick \"Active\" and click \"Add\".</p> </li> </ol> <p>Info</p> <p>Once Completed, log into the mailbox and check if all emails are imported correctly. If all goes well, all your mails shall end up in your new mailbox. And don't forget to delete or deactivate the sync job after it is used.</p>","path":["Firststeps sync jobs migration.en"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p-apache24.de/","level":1,"title":"R p apache24.de","text":"<p>Wichtig</p> <p>Lesen Sie zuerst die Übersicht.</p> <p>Erforderliche Module: <pre><code>a2enmod rewrite proxy proxy_http headers ssl\n</code></pre></p> <p>Let's Encrypt wird unserem Rewrite folgen, Zertifikatsanfragen in mailcow werden problemlos funktionieren.</p> <p>Die hervorgehobenen Zeilen müssen beachtet werden.</p> <pre><code>&lt;VirtualHost *:80&gt;\n  ServerName ZU MAILCOW HOSTNAMEN ÄNDERN\n  ServerAlias autodiscover.*\n  ServerAlias autoconfig.*\n  RewriteEngine on\n\n  RewriteCond %{HTTPS} off\n  RewriteRule ^/?(.*) https://%{HTTP_HOST}/$1 [R=301,L]\n\n  ProxyPass / http://127.0.0.1:8080/\n  ProxyPassReverse / http://127.0.0.1:8080/\n  ProxyPreserveHost On\n  ProxyAddHeaders On\n  RequestHeader set X-Forwarded-Proto \"http\"\n&lt;/VirtualHost&gt;\n&lt;VirtualHost *:443&gt;\n  ServerName ZU MAILCOW HOSTNAMEN ÄNDERN\n  ServerAlias autodiscover.*\n  ServerAlias autoconfig.*\n\n  # You should proxy to a plain HTTP session to offload SSL processing\n  ProxyPass /Microsoft-Server-ActiveSync http://127.0.0.1:8080/Microsoft-Server-ActiveSync connectiontimeout=4000\n  ProxyPassReverse /Microsoft-Server-ActiveSync http://127.0.0.1:8080/Microsoft-Server-ActiveSync\n  ProxyPass / http://127.0.0.1:8080/\n  ProxyPassReverse / http://127.0.0.1:8080/\n  ProxyPreserveHost On\n  ProxyAddHeaders On\n  RequestHeader set X-Forwarded-Proto \"https\"\n\n  SSLCertificateFile MAILCOW_ORDNER/data/assets/ssl/cert.pem\n  SSLCertificateKeyFile MAILCOW_ORDNER/data/assets/ssl/key.pem\n\n  # Wenn Sie einen HTTPS-Host als Proxy verwenden möchten:\n  #SSLProxyEngine On\n\n  # Wenn Sie einen Proxy für einen nicht vertrauenswürdigen HTTPS-Host einrichten wollen:\n  #SSLProxyVerify none\n  #SSLProxyCheckPeerCN off\n  #SSLProxyCheckPeerName off\n  #SSLProxyCheckPeerExpire off\n&lt;/VirtualHost&gt;\n</code></pre>","path":["R p apache24.de"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p-apache24.en/","level":1,"title":"R p apache24.en","text":"<p>Important</p> <p>First read the overview.</p> <p>Required modules: <pre><code>a2enmod rewrite proxy proxy_http headers ssl\n</code></pre></p> <p>Let's Encrypt will follow our rewrite, certificate requests in mailcow will work fine.</p> <p>Take care of highlighted lines.</p> <pre><code>&lt;VirtualHost *:80&gt;\n  ServerName CHANGE_TO_MAILCOW_HOSTNAME\n  ServerAlias autodiscover.*\n  ServerAlias autoconfig.*\n  RewriteEngine on\n\n  RewriteCond %{HTTPS} off\n  RewriteRule ^/?(.*) https://%{HTTP_HOST}/$1 [R=301,L]\n\n  ProxyPass / http://127.0.0.1:8080/\n  ProxyPassReverse / http://127.0.0.1:8080/\n  ProxyPreserveHost On\n  ProxyAddHeaders On\n  RequestHeader set X-Forwarded-Proto \"http\"\n&lt;/VirtualHost&gt;\n&lt;VirtualHost *:443&gt;\n  ServerName CHANGE_TO_MAILCOW_HOSTNAME\n  ServerAlias autodiscover.*\n  ServerAlias autoconfig.*\n\n  # You should proxy to a plain HTTP session to offload SSL processing\n  ProxyPass /Microsoft-Server-ActiveSync http://127.0.0.1:8080/Microsoft-Server-ActiveSync connectiontimeout=4000\n  ProxyPassReverse /Microsoft-Server-ActiveSync http://127.0.0.1:8080/Microsoft-Server-ActiveSync\n  ProxyPass / http://127.0.0.1:8080/\n  ProxyPassReverse / http://127.0.0.1:8080/\n  ProxyPreserveHost On\n  ProxyAddHeaders On\n  RequestHeader set X-Forwarded-Proto \"https\"\n\n  SSLCertificateFile MAILCOW_PATH/data/assets/ssl/cert.pem\n  SSLCertificateKeyFile MAILCOW_PATH/data/assets/ssl/key.pem\n\n  # If you plan to proxy to a HTTPS host:\n  #SSLProxyEngine On\n\n  # If you plan to proxy to an untrusted HTTPS host:\n  #SSLProxyVerify none\n  #SSLProxyCheckPeerCN off\n  #SSLProxyCheckPeerName off\n  #SSLProxyCheckPeerExpire off\n&lt;/VirtualHost&gt;\n</code></pre>","path":["R p apache24.en"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p-caddy2.de/","level":1,"title":"R p caddy2.de","text":"<p>Wichtig</p> <p>Lesen Sie zuerst die Übersicht.</p> <p>Warnung</p> <p>Dies ist ein nicht unterstützter Communitybeitrag. Korrekturen sind immer erwünscht!</p> <p>Die Konfiguration von Caddy mit mailcow ist sehr simpel.</p> <p>In der Caddyfile muss einfach nur ein Bereich für den E-Mailserver angelegt werden.</p> <p>Bspw:</p> <pre><code>MAILCOW_HOSTNAME autodiscover.MAILCOW_HOSTNAME autoconfig.MAILCOW_HOSTNAME {\n        log {\n                output file /var/log/caddy/MAILCOW_HOSTNAME.log {\n                        roll_disabled\n                        roll_size 512M\n                        roll_uncompressed\n                        roll_local_time\n                        roll_keep 3\n                        roll_keep_for 48h\n                }\n        }\n\n        reverse_proxy 127.0.0.1:HTTP_BIND\n}\n</code></pre> <p>Dies erlaubt es Caddy automatisch die Zertifikate zu erstellen und den Traffic für diese erwähnten Domains anzunehmen und an mailcow weiterzuleiten.</p> <p>Wichtig: Der ACME Client der mailcow muss deaktiviert sein, da es sonst zu Fehlern seitens mailcow kommt.</p> <p>Da Caddy sich direkt selbst um die Zertifikate kümmert, können wir mit dem folgenden Skript die Caddy generierten Zertifikate in die mailcow inkludieren:</p> <pre><code>#!/bin/bash\nMAILCOW_HOSTNAME=your.domain.tld\nCADDY_CERTS_DIR=/var/lib/caddy/.local/share/caddy/certificates/acme-v02.api.letsencrypt.org-directory\nMD5SUM_CURRENT_CERT=($(md5sum /opt/mailcow-dockerized/data/assets/ssl/cert.pem))\nMD5SUM_NEW_CERT=($(md5sum $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.crt))\n\nif [ $MD5SUM_CURRENT_CERT != $MD5SUM_NEW_CERT ]; then\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.crt /opt/mailcow-dockerized/data/assets/ssl/cert.pem\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.key /opt/mailcow-dockerized/data/assets/ssl/key.pem\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.crt /opt/mailcow-dockerized/data/assets/ssl/$MAILCOW_HOSTNAME/cert.pem\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.key /opt/mailcow-dockerized/data/assets/ssl/$MAILCOW_HOSTNAME/key.pem\n        postfix_c=$(docker ps -qaf name=postfix-mailcow)\n        dovecot_c=$(docker ps -qaf name=dovecot-mailcow)\n        nginx_c=$(docker ps -qaf name=nginx-mailcow)\n        docker restart ${postfix_c} ${dovecot_c} ${nginx_c}\n\nelse\n        echo \"Certs not copied from Caddy (Not needed)\"\nfi\n</code></pre> <p>Achtung</p> <p>Der Zertifikatspfad von Caddy variiert je nach Installationsart. Bei diesem Installationsbeispiel wurde Caddy mithilfe des Caddy Repos (weitere Informationen hier) installiert.  Um den Caddy Zertifikatspfad auf Ihrem System herauszufinden, genügt ein <code>find / -name \"certificates\"</code>.</p> <p>Dieses Skript könnte dann als Cronjob jede Stunde aufgerufen werden:</p> <pre><code>0 * * * * /bin/bash /path/to/script/deploy-certs.sh  &gt;/dev/null 2&gt;&amp;1\n</code></pre>","path":["R p caddy2.de"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p-caddy2.en/","level":1,"title":"R p caddy2.en","text":"<p>Important</p> <p>First read the overview.</p> <p>Warning</p> <p>This is an unsupported community contribution. Feel free to provide fixes.</p> <p>The configuration of Caddy with mailcow is very simple.</p> <p>In the caddyfile you just have to create a section for the mailserver.</p> <p>For example <pre><code>MAILCOW_HOSTNAME autodiscover.MAILCOW_HOSTNAME autoconfig.MAILCOW_HOSTNAME {\n        log {\n                output file /var/log/caddy/MAILCOW_HOSTNAME.log {\n                        roll_disabled\n                        roll_size 512M\n                        roll_uncompressed\n                        roll_local_time\n                        roll_keep 3\n                        roll_keep_for 48h\n                }\n        }\n\n        reverse_proxy 127.0.0.1:HTTP_BIND\n}\n</code></pre></p> <p>This allows Caddy to automatically create the certificates and accept traffic for these mentioned domains and forward them to mailcow.</p> <p>Important: The ACME client of mailcow must be disabled, otherwise mailcow will fail.</p> <p>Since Caddy takes care of the certificates itself, we can use the following script to include the Caddy generated certificates into mailcow:</p> <pre><code>#!/bin/bash\nMAILCOW_HOSTNAME=your.domain.tld\nCADDY_CERTS_DIR=/var/lib/caddy/.local/share/caddy/certificates/acme-v02.api.letsencrypt.org-directory\nMD5SUM_CURRENT_CERT=($(md5sum /opt/mailcow-dockerized/data/assets/ssl/cert.pem))\nMD5SUM_NEW_CERT=($(md5sum $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.crt))\n\nif [ $MD5SUM_CURRENT_CERT != $MD5SUM_NEW_CERT ]; then\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.crt /opt/mailcow-dockerized/data/assets/ssl/cert.pem\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.key /opt/mailcow-dockerized/data/assets/ssl/key.pem\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.crt /opt/mailcow-dockerized/data/assets/ssl/$MAILCOW_HOSTNAME/cert.pem\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.key /opt/mailcow-dockerized/data/assets/ssl/$MAILCOW_HOSTNAME/key.pem\n        postfix_c=$(docker ps -qaf name=postfix-mailcow)\n        dovecot_c=$(docker ps -qaf name=dovecot-mailcow)\n        nginx_c=$(docker ps -qaf name=nginx-mailcow)\n        docker restart ${postfix_c} ${dovecot_c} ${nginx_c}\n\nelse\n        echo \"Certs not copied from Caddy (Not needed)\"\nfi\n</code></pre> <p>Attention</p> <p>Caddy's certificate path varies depending on the installation type. In this installation example, Caddy was installed using the Caddy repo (more informations here).  To find out the Caddy certificate path on your system, just run a <code>find / -name \"certificates\"</code>.</p> <p>This script could be called as a cronjob every hour:</p> <pre><code>0 * * * * /bin/bash /path/to/script/deploy-certs.sh  &gt;/dev/null 2&gt;&amp;1\n</code></pre>","path":["R p caddy2.en"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p-haproxy.de/","level":1,"title":"R p haproxy.de","text":"<p>Wichtig</p> <p>Lesen Sie zuerst die Übersicht.</p> <p>Warnung</p> <p>Dies ist ein nicht unterstützter Community Beitrag. Korrekturen sind immer erwünscht!</p> <p>Dieses Beispiel leitet den gesamten HTTP-Verkehr zu HTTPS um, außer für den eingebauten ACME-Client von mailcow. Wenn Sie den eingebauten ACME-Client nicht verwenden möchten, ändern Sie bitte die Konfiguration selbst.</p> <pre><code>frontend https-in\n  bind :::80 v4v6\n  bind :::443 v4v6 ssl crt mailcow.pem\n\n  acl mailcow_acme path -i -m beg /.well-known/\n\n  redirect scheme https unless { ssl_fc || mailcow_acme }\n\n  default_backend mailcow\n\nbackend mailcow\n  option forwardfor\n  http-request set-header X-Forwarded-Proto https if { ssl_fc }\n  http-request set-header X-Forwarded-Proto http if !{ ssl_fc }\n  server mailcow 127.0.0.1:8080 check\n</code></pre>","path":["R p haproxy.de"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p-haproxy.en/","level":1,"title":"R p haproxy.en","text":"<p>Important</p> <p>First read the overview.</p> <p>Warning</p> <p>This is an unsupported community contribution. Feel free to provide fixes.</p> <p>This example redirects all HTTP traffic to HTTPS except for mailcow's built-in ACME client. If you do not want to use the built-in ACME client, please modify the configuration yourself.</p> <pre><code>frontend https-in\n  bind :::80 v4v6\n  bind :::443 v4v6 ssl crt mailcow.pem\n\n  acl mailcow_acme path -i -m beg /.well-known/\n\n  redirect scheme https unless { ssl_fc || mailcow_acme }\n\n  default_backend mailcow\n\nbackend mailcow\n  option forwardfor\n  http-request set-header X-Forwarded-Proto https if { ssl_fc }\n  http-request set-header X-Forwarded-Proto http if !{ ssl_fc }\n  server mailcow 127.0.0.1:8080 check\n</code></pre>","path":["R p haproxy.en"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p-nginx.de/","level":1,"title":"R p nginx.de","text":"<p>Wichtig</p> <p>Lesen Sie zuerst die Übersicht.</p> <p>Let's Encrypt folgt unserem Rewrite, Zertifikatsanfragen funktionieren problemlos.</p> <p>Achten Sie auf die hervorgehobenen Zeilen.</p> <pre><code>server {\n  listen 80 default_server;\n  listen [::]:80 default_server;\n  server_name ZU MAILCOW HOSTNAMEN ÄNDERN autodiscover.* autoconfig.*;\n  return 301 https://$host$request_uri;\n}\nserver {\n  listen 443 ssl http2;\n  listen [::]:443 ssl http2;\n  server_name ZU MAILCOW HOSTNAMEN ÄNDERN autodiscover.* autoconfig.*;\n\n  ssl_certificate MAILCOW_PATH/data/assets/ssl/cert.pem;\n  ssl_certificate_key MAILCOW_PATH/data/assets/ssl/key.pem;\n  ssl_session_timeout 1d;\n  ssl_session_cache shared:SSL:50m;\n  ssl_session_tickets off;\n\n  # Siehe https://ssl-config.mozilla.org/#server=nginx für die neuesten Empfehlungen zu ssl-Einstellungen\n  # Ein Beispiel für eine Konfiguration ist unten angegeben\n  ssl_protocols TLSv1.2;\n  ssl_ciphers HIGH:!aNULL:!MD5:!SHA1:!kRSA;\n  ssl_prefer_server_ciphers off;\n\n  location /Microsoft-Server-ActiveSync {\n    proxy_pass http://127.0.0.1:8080/Microsoft-Server-ActiveSync;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_connect_timeout 75;\n    proxy_send_timeout 3650;\n    proxy_read_timeout 3650;\n    proxy_buffers 64 512k; # Seit dem 2022-04 Update nötig für SOGo\n    client_body_buffer_size 512k;\n    client_max_body_size 0;\n  }\n\n  location / {\n    proxy_pass http://127.0.0.1:8080/;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    client_max_body_size 0;\n  # Die folgenden Proxy-Buffer müssen gesetzt werden, wenn Sie SOGo nach dem Update 2022-04 (April 2022) verwenden wollen\n  # Andernfalls wird ein Login wie folgt fehlschlagen: https://github.com/mailcow/mailcow-dockerized/issues/4537\n    proxy_buffer_size 128k;\n    proxy_buffers 64 512k;\n    proxy_busy_buffers_size 512k;\n  }\n}\n</code></pre>","path":["R p nginx.de"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p-nginx.en/","level":1,"title":"R p nginx.en","text":"<p>Important</p> <p>First read the overview.</p> <p>Let's Encrypt will follow our rewrite, certificate requests will work fine.</p> <p>Take care of highlighted lines.</p> <pre><code>server {\n  listen 80 default_server;\n  listen [::]:80 default_server;\n  server_name CHANGE_TO_MAILCOW_HOSTNAME autodiscover.* autoconfig.*;\n  return 301 https://$host$request_uri;\n}\nserver {\n  listen 443 ssl http2;\n  listen [::]:443 ssl http2;\n  server_name CHANGE_TO_MAILCOW_HOSTNAME autodiscover.* autoconfig.*;\n\n  ssl_certificate MAILCOW_PATH/data/assets/ssl/cert.pem;\n  ssl_certificate_key MAILCOW_PATH/data/assets/ssl/key.pem;\n  ssl_session_timeout 1d;\n  ssl_session_cache shared:SSL:50m;\n  ssl_session_tickets off;\n\n  # See https://ssl-config.mozilla.org/#server=nginx for the latest ssl settings recommendations\n  # An example config is given below\n  ssl_protocols TLSv1.2;\n  ssl_ciphers HIGH:!aNULL:!MD5:!SHA1:!kRSA;\n  ssl_prefer_server_ciphers off;\n\n  location /Microsoft-Server-ActiveSync {\n    proxy_pass http://127.0.0.1:8080/Microsoft-Server-ActiveSync;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_connect_timeout 75;\n    proxy_send_timeout 3650;\n    proxy_read_timeout 3650;\n    proxy_buffers 64 512k; # Needed since the 2022-04 Update for SOGo\n    client_body_buffer_size 512k;\n    client_max_body_size 0;\n  }\n\n  location / {\n    proxy_pass http://127.0.0.1:8080/;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    client_max_body_size 0;\n  # The following Proxy Buffers has to be set if you want to use SOGo after the 2022-04 (April 2022) Update\n  # Otherwise a Login will fail like this: https://github.com/mailcow/mailcow-dockerized/issues/4537\n    proxy_buffer_size 128k;\n    proxy_buffers 64 512k;\n    proxy_busy_buffers_size 512k;\n  }\n}\n</code></pre>","path":["R p nginx.en"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p-traefik2.de/","level":1,"title":"R p traefik2.de","text":"<p>Wichtig</p> <p>Lesen Sie zuerst die Übersicht.</p> <p>Warnung</p> <p>Dies ist ein nicht unterstützter Community Beitrag. Korrekturen sind immer erwünscht!</p> <p>Wichtig: Diese Konfiguration deckt nur das \"Reverseproxing\" des Webpanels (nginx-mailcow) unter Verwendung von Traefik v2 ab. Wenn Sie auch die Mail-Dienste wie dovecot, postfix... reproxen wollen, müssen Sie die folgende Konfiguration an jeden Container anpassen und einen EntryPoint in Ihrer <code>traefik.toml</code> oder <code>traefik.yml</code> (je nachdem, welche Konfiguration Sie verwenden) für jeden Port erstellen. </p> <p>In diesem Abschnitt gehen wir davon aus, dass Sie Ihren Traefik 2 <code>[certificatesresolvers]</code> in Ihrer Traefik-Konfigurationsdatei richtig konfiguriert haben und auch acme verwenden. Das folgende Beispiel verwendet Lets Encrypt, aber Sie können es gerne auf Ihren eigenen Zertifikatsresolver ändern. Eine grundlegende Traefik 2 toml-Konfigurationsdatei mit allen oben genannten Elementen, die für dieses Beispiel verwendet werden kann, finden Sie hier traefik.toml, falls Sie eine solche Datei benötigen oder einen Hinweis, wie Sie Ihre Konfiguration anpassen können.</p> <p>Zuallererst werden wir den acme-mailcow-Container deaktivieren, da wir die von traefik bereitgestellten Zertifikate verwenden werden. Dazu müssen wir <code>SKIP_LETS_ENCRYPT=y</code> in unserer <code>mailcow.conf</code> setzen und den folgenden Befehl ausführen, um die Änderungen zu übernehmen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Dann erstellen wir eine <code>docker-compose.override.yml</code> Datei, um die Hauptdatei <code>docker-compose.yml</code> zu überschreiben, die sich im mailcow-Stammverzeichnis befindet. </p> <pre><code>services:\n    nginx-mailcow:\n      networks:\n        # Traefiks Netzwerk hinzufügen\n        web:\n      labels:\n        - traefik.enable=true\n        # Erstellt einen Router namens \"moo\" für den Container und richtet eine Regel ein, um den Container mit einer bestimmten Regel zu verknüpfen,\n        # in diesem Fall eine Host-Regel mit unserer MAILCOW_HOSTNAME-Variable.\n        - traefik.http.routers.moo.rule=Host(`${MAILCOW_HOSTNAME}`)\n        # Aktiviert tls über den zuvor erstellten Router.\n        - traefik.http.routers.moo.tls=true\n        # Gibt an, welche Art von Cert-Resolver wir verwenden werden, in diesem Fall le (Lets Encrypt).\n        - traefik.http.routers.moo.tls.certresolver=le\n        # Erzeugt einen Dienst namens \"moo\" für den Container und gibt an, welchen internen Port des Containers\n        # Traefik die eingehenden Daten weiterleiten soll.\n        - traefik.http.services.moo.loadbalancer.server.port=${HTTP_PORT}\n        # Gibt an, welchen Eingangspunkt (externer Port) traefik für diesen Container abhören soll.\n        # Websecure ist Port 443, siehe die Datei traefik.toml wie oben.\n        - traefik.http.routers.moo.entrypoints=websecure\n        # Stellen Sie sicher, dass traefik das Web-Netzwerk verwendet, nicht das mailcowdockerized_mailcow-network\n        - traefik.docker.network=traefik_web\n\n    certdumper:\n        image: ghcr.io/kereis/traefik-certs-dumper\n        command: --restart-containers ${COMPOSE_PROJECT_NAME}-postfix-mailcow-1,${COMPOSE_PROJECT_NAME}-nginx-mailcow-1,${COMPOSE_PROJECT_NAME}-dovecot-mailcow-1\n        network_mode: none\n        volumes:\n          # Binden Sie das Volume, das Traefiks `acme.json' Datei enthält, ein\n          - acme:/traefik:ro\n          # SSL-Ordner von mailcow einhängen\n          - ./data/assets/ssl/:/output:rw\n          # Binden Sie den Docker Socket ein, damit traefik-certs-dumper die Container neu starten kann\n          - /var/run/docker.sock:/var/run/docker.sock:ro\n        restart: always\n        environment:\n          # Ändern Sie dies nur, wenn Sie eine andere Domain für mailcows Web-Frontend verwenden als in der Standard-Konfiguration\n          - DOMAIN=${MAILCOW_HOSTNAME}\n\nnetworks:\n  web:\n    external: true\n    # Name des externen Netzwerks\n    name: traefik_web\n\nvolumes:\n  acme:\n    external: true\n    # Name des externen Docker Volumes, welches Traefiks `acme.json' Datei enthält\n    name: traefik_acme\n</code></pre> <p>Starten Sie die neuen Container mit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Da Traefik 2 ein acme v2 Format verwendet, um ALLE Zertifikaten von allen Domains zu speichern, müssen wir einen Weg finden, die Zertifikate auszulagern. Zum Glück haben wir [diesen kleinen Container] (https://hub.docker.com/r/humenius/traefik-certs-dumper), der die Datei <code>acme.json</code> über ein Volume und eine Variable <code>DOMAIN=example. org</code>, und damit wird der Container die <code>cert.pem</code> und <code>key.pem</code> Dateien ausgeben, dafür lassen wir einfach den <code>traefik-certs-dumper</code> Container laufen, binden das <code>/traefik</code> Volume an den Ordner, in dem unsere <code>acme.json</code> gespeichert ist, binden das <code>/output</code> Volume an unseren mailcow <code>data/assets/ssl/</code> Ordner, und setzen die <code>DOMAIN=example.org</code> Variable auf die Domain, von der wir die Zertifikate ausgeben wollen. </p> <p>Dieser Container überwacht die Datei <code>acme.json</code> auf Änderungen und generiert die Dateien <code>cert.pem</code> und <code>key.pem</code> direkt in <code>data/assets/ssl/</code>, wobei der Pfad mit dem <code>/output</code>-Pfad des Containers verbunden ist.</p> <p>Sie können es über die Kommandozeile ausführen oder das hier gezeigte docker-compose.yml verwenden.</p> <p>Nachdem wir die Zertifikate übertragen haben, müssen wir die Konfigurationen aus unseren Postfix- und Dovecot-Containern neu laden und die Zertifikate überprüfen. Wie das geht, sehen Sie hier.</p> <p>Und das sollte es gewesen sein 😊, Sie können überprüfen, ob der Traefik-Router einwandfrei funktioniert, indem Sie das Dashboard von Traefik / traefik logs / über https auf die eingestellte Domain zugreifen, oder / und HTTPS, SMTP und IMAP mit den Befehlen auf der zuvor verlinkten Seite überprüfen.</p>","path":["R p traefik2.de"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p-traefik2.en/","level":1,"title":"R p traefik2.en","text":"<p>Important</p> <p>First read the overview.</p> <p>Warning</p> <p>This is an unsupported community contribution. Feel free to provide fixes.</p> <p>Important: This config only covers the \"reverseproxing\" of the webpannel (nginx-mailcow) using Traefik v2, if you also want to reverseproxy the mail services such as dovecot, postfix... you'll just need to adapt the following config to each container and create an EntryPoint on your <code>traefik.toml</code> or <code>traefik.yml</code> (depending which config you use) for each port. </p> <p>For this section we'll assume you have your Traefik 2 <code>[certificatesresolvers]</code> properly configured on your traefik configuration file, and also using acme, also, the following example uses Lets Encrypt, but feel free to change it to your own cert resolver. You can find a basic Traefik 2 toml config file with all the above implemented which can be used for this example here traefik.toml if you need one, or a hint on how to adapt your config.</p> <p>So, first of all, we are going to disable the acme-mailcow container since we'll use the certs that traefik will provide us. For this we'll have to set <code>SKIP_LETS_ENCRYPT=y</code> on our <code>mailcow.conf</code>, and run the following command to apply the changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Then we'll create a <code>docker-compose.override.yml</code> file in order to override the main <code>docker-compose.yml</code> found in your mailcow root folder. </p> <pre><code>services:\n    nginx-mailcow:\n      networks:\n        # Add Traefik's network\n        web:\n      labels:\n        - traefik.enable=true\n        # Creates a router called \"moo\" for the container, and sets up a rule to link the container to certain rule,\n        #   in this case, a Host rule with our MAILCOW_HOSTNAME var.\n        - traefik.http.routers.moo.rule=Host(`${MAILCOW_HOSTNAME}`)\n        # Enables tls over the router we created before.\n        - traefik.http.routers.moo.tls=true\n        # Specifies which kind of cert resolver we'll use, in this case le (Lets Encrypt).\n        - traefik.http.routers.moo.tls.certresolver=le\n        # Creates a service called \"moo\" for the container, and specifies which internal port of the container\n        #   should traefik route the incoming data to.\n        - traefik.http.services.moo.loadbalancer.server.port=${HTTP_PORT}\n        # Specifies which entrypoint (external port) should traefik listen to, for this container.\n        #   websecure being port 443, check the traefik.toml file liked above.\n        - traefik.http.routers.moo.entrypoints=websecure\n        # Make sure traefik uses the web network, not the mailcowdockerized_mailcow-network\n        - traefik.docker.network=traefik_web\n\n    certdumper:\n        image: ghcr.io/kereis/traefik-certs-dumper\n        command: --restart-containers ${COMPOSE_PROJECT_NAME}-postfix-mailcow-1,${COMPOSE_PROJECT_NAME}-nginx-mailcow-1,${COMPOSE_PROJECT_NAME}-dovecot-mailcow-1\n        network_mode: none\n        volumes:\n          # Mount the volume which contains Traefik's `acme.json' file\n          #   Configure the external name in the volume definition\n          - acme:/traefik:ro\n          # Mount mailcow's SSL folder\n          - ./data/assets/ssl/:/output:rw\n          # Mount docker socket to restart containers\n          - /var/run/docker.sock:/var/run/docker.sock:ro\n        restart: always\n        environment:\n          # only change this, if you're using another domain for mailcow's web frontend compared to the standard config\n          - DOMAIN=${MAILCOW_HOSTNAME}\n\nnetworks:\n  web:\n    external: true\n    # Name of the external network\n    name: traefik_web\n\nvolumes:\n  acme:\n    external: true\n    # Name of the external docker volume which contains Traefik's `acme.json' file\n    name: traefik_acme\n</code></pre> <p>Start the new containers with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Now, there's only one thing left to do, which is setup the certs so that the mail services can use them as well, since Traefik 2 uses an acme v2 format to save ALL the license from all the domains we have, we'll need to find a way to dump the certs, lucky we have this tiny container which grabs the <code>acme.json</code> file through a volume, and a variable <code>DOMAIN=example.org</code>, and with these, the container will output the <code>cert.pem</code> and <code>key.pem</code> files, for this we'll simply run the <code>traefik-certs-dumper</code> container binding the <code>/traefik</code> volume to the folder where our <code>acme.json</code> is saved, bind the <code>/output</code> volume to our mailcow <code>data/assets/ssl/</code> folder, and set up the <code>DOMAIN=example.org</code> variable to the domain we want the certs dumped from. </p> <p>This container will watch over the <code>acme.json</code> file for any changes, and regenerate the <code>cert.pem</code> and <code>key.pem</code> files directly into <code>data/assets/ssl/</code> being the path binded to the container's <code>/output</code> path.</p> <p>You can use the command line to run it, or use the docker-compose.yml shown here.</p> <p>After we have the certs dumped, we'll have to reload the configs from our postfix and dovecot containers, and check the certs, you can see how here.</p> <p>Aaand that should be it 😊, you can check if the Traefik router works fine through Traefik's dashboard / traefik logs / accessing the setted domain through https, or / and check HTTPS, SMTP and IMAP through the commands shown on the page linked before.</p>","path":["R p traefik2.en"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p.de/","level":1,"title":"R p.de","text":"<p>Sie müssen die Nginx-Seite, die mit mailcow: dockerized geliefert wird, nicht ändern. mailcow: dockerized vertraut auf das Standard-Gateway IP 172.22.1.1 als Proxy.</p> <p>Stellen Sie sicher, dass Sie HTTP_BIND und HTTPS_BIND in <code>mailcow.conf</code> auf eine lokale Adresse ändern und die Ports entsprechend einstellen, zum Beispiel: <pre><code>HTTP_BIND=127.0.0.1\nHTTP_PORT=8080\nHTTPS_BIND=127.0.0.1\nHTTPS_PORT=8443\n</code></pre></p> <p>Dadurch werden auch die Bindungen innerhalb des Nginx-Containers geändert! Dies ist wichtig, wenn Sie sich entscheiden, einen Proxy innerhalb von Docker zu verwenden.</p> <p>WICHTIG: Verwenden Sie nicht Port 8081, 9081 oder 65510!</p> <p>Erzeugen Sie die betroffenen Container neu, indem Sie den folgenden Befehl ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["R p.de"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p.de/#wichtige-informationen-bitte-lesen-sie-diese-sorgfaltig-durch","level":2,"title":"Wichtige Informationen, bitte lesen Sie diese sorgfältig durch!","text":"<p>Info</p> <p>Wenn Sie planen, einen Reverse-Proxy zu verwenden und einen anderen Servernamen als MAILCOW_HOSTNAME verwenden wollen, müssen Sie Zusätzliche Servernamen für mailcow UI hierunter.</p> <p>Warnung</p> <p>Stellen Sie sicher, dass Sie <code>generate_config.sh</code> ausführen, bevor Sie die Konfigurationsbeispiele aktivieren. Das Skript <code>generate_config.sh</code> kopiert die Snake-oil Zertifikate an den richtigen Ort, so dass die Dienste nicht aufgrund fehlender Dateien nicht starten können.</p> <p>Warnung</p> <p>Wenn Sie TLS SNI aktivieren (<code>ENABLE_SSL_SNI</code> in mailcow.conf), müssen die Zertifikatspfade in Ihrem Reverse-Proxy mit den korrekten Pfaden in <code>data/assets/ssl/{hostname}</code> übereinstimmen. Die Zertifikate werden in <code>data/assets/ssl/{hostname1,hostname2,etc}</code> aufgeteilt und werden daher nicht funktionieren, wenn Sie die Beispiele von unten kopieren, die auf <code>data/assets/ssl/cert.pem</code> etc. zeigen.</p> <p>Info</p> <p>Die Verwendung der Konfigurationsbeispiele wird acme-Anfragen an mailcow weiterleiten und es die Zertifikate selbst verwalten lassen. Der Nachteil der Verwendung von mailcow als ACME-Client hinter einem Reverse-Proxy ist, dass Sie Ihren Webserver neu laden müssen, nachdem acme-mailcow das Zertifikat geändert/erneuert/erstellt hat. Sie können entweder Ihren Webserver täglich neu laden oder ein Skript schreiben, um die Datei auf Änderungen zu überwachen. Auf vielen Servern wird logrotate den Webserver sowieso täglich neu laden.</p> <p>Wenn Sie eine lokale Certbot-Installation verwenden möchten, müssen Sie die SSL-Zertifikatsparameter entsprechend ändern. Stellen Sie sicher, dass Sie ein Post-Hook-Skript ausführen, wenn Sie sich entscheiden, externe ACME-Clients zu verwenden. Ein Beispiel finden Sie hierunter.</p> <p>Konfigurieren Sie Ihren lokalen Webserver als Reverse Proxy anhand folgender Konfigurationsbeispiele:</p> <ul> <li>Apache 2.4</li> <li>Nginx</li> <li>HAProxy</li> <li>Traefik v2</li> <li>Caddy v2</li> </ul>","path":["R p.de"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p.de/#optional-post-hook-skript-fur-nicht-mailcow-acme-clients","level":2,"title":"Optional: Post-Hook-Skript für nicht-mailcow ACME-Clients","text":"<p>Die Verwendung eines lokalen Certbots (oder eines anderen ACME-Clients) erfordert den Neustart einiger Container, was Sie mit einem Post-Hook-Skript erledigen können. Stellen Sie sicher, dass Sie die Pfade entsprechend ändern: <pre><code>#!/bin/bash\ncp /etc/letsencrypt/live/my.domain.tld/fullchain.pem /opt/mailcow-dockerized/data/assets/ssl/cert.pem\ncp /etc/letsencrypt/live/my.domain.tld/privkey.pem /opt/mailcow-dockerized/data/assets/ssl/key.pem\npostfix_c=$(docker ps -qaf name=postfix-mailcow)\ndovecot_c=$(docker ps -qaf name=dovecot-mailcow)\nnginx_c=$(docker ps -qaf name=nginx-mailcow)\ndocker restart ${postfix_c} ${dovecot_c} ${nginx_c}\n</code></pre></p>","path":["R p.de"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p.de/#hinzufugen-weiterer-servernamen-fur-mailcow-ui","level":2,"title":"Hinzufügen weiterer Servernamen für mailcow UI","text":"<p>Wenn Sie vorhaben, einen Servernamen zu verwenden, der nicht <code>MAILCOW_HOSTNAME</code> in Ihrem Reverse-Proxy ist, stellen Sie sicher, dass Sie diesen Namen zuerst in mailcow.conf über <code>ADDITIONAL_SERVER_NAMES</code> einpflegen. Die Namen müssen durch Kommas getrennt werden und dürfen keine Leerzeichen enthalten. Wenn Sie diesen Schritt überspringen, kann es sein, dass mailcow auf Ihren Reverse-Proxy mit einer falschen Seite antwortet.</p> <pre><code>ADDITIONAL_SERVER_NAMES=webmail.domain.tld,other.example.tld\n</code></pre> <p>Führen Sie zum Anwenden folgendes aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["R p.de"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p.en/","level":1,"title":"R p.en","text":"<p>You don't need to change the Nginx site that comes with mailcow: dockerized. mailcow: dockerized trusts the default gateway IP 172.22.1.1 as proxy.</p> <p>Make sure you change HTTP_BIND and HTTPS_BIND in <code>mailcow.conf</code> to a local address and set the ports accordingly, for example: <pre><code>HTTP_BIND=127.0.0.1\nHTTP_PORT=8080\nHTTPS_BIND=127.0.0.1\nHTTPS_PORT=8443\n</code></pre></p> <p>This will also change the bindings inside the Nginx container! This is important, if you decide to use a proxy within Docker.</p> <p>IMPORTANT: Do not use port 8081, 9081 or 65510!</p> <p>Recreate affected containers by running the command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["R p.en"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p.en/#important-information-please-read-them-carefully","level":2,"title":"Important information, please read them carefully!","text":"<p>Info</p> <p>If you plan to use a reverse proxy and want to use another server name that is not MAILCOW_HOSTNAME, you need to read Adding additional server names for mailcow UI below.</p> <p>Warning</p> <p>Make sure you run <code>generate_config.sh</code> before you enable any site configuration examples. The script <code>generate_config.sh</code> copies snake-oil certificates to the correct location, so the services will not fail to start due to missing files.</p> <p>Warning</p> <p>If you enable TLS SNI (<code>ENABLE_SSL_SNI</code> in mailcow.conf), the certificate paths in your reverse proxy must match the correct paths in <code>data/assets/ssl/{hostname}</code>. The certificates will be split into <code>data/assets/ssl/{hostname1,hostname2,etc}</code> and therefore will not work when you copy the examples from below pointing to <code>data/assets/ssl/cert.pem</code> etc.</p> <p>Info</p> <p>Using the site configuration examples will forward ACME requests to mailcow and let it handle certificates itself. The downside of using mailcow as ACME client behind a reverse proxy is, that you will need to reload your webserver after acme-mailcow changed/renewed/created the certificate. You can either reload your webserver daily or write a script to watch the file for changes. On many servers logrotate will reload the webserver daily anyway.</p> <p>If you want to use a local certbot installation, you will need to change the SSL certificate parameters accordingly. Make sure you run a post-hook script when you decide to use external ACME clients. You will find an example below.</p> <p>Configure your local webserver as reverse proxy using following configuration examples:</p> <ul> <li>Apache 2.4</li> <li>Nginx</li> <li>HAProxy</li> <li>Traefik v2</li> <li>Caddy v2</li> </ul>","path":["R p.en"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p.en/#optional-post-hook-script-for-non-mailcow-acme-clients","level":2,"title":"Optional: Post-hook script for non-mailcow ACME clients","text":"<p>Using a local certbot (or any other ACME client) requires to restart some containers, you can do this with a post-hook script. Make sure you change the paths accordingly: <pre><code>#!/bin/bash\ncp /etc/letsencrypt/live/my.domain.tld/fullchain.pem /opt/mailcow-dockerized/data/assets/ssl/cert.pem\ncp /etc/letsencrypt/live/my.domain.tld/privkey.pem /opt/mailcow-dockerized/data/assets/ssl/key.pem\npostfix_c=$(docker ps -qaf name=postfix-mailcow)\ndovecot_c=$(docker ps -qaf name=dovecot-mailcow)\nnginx_c=$(docker ps -qaf name=nginx-mailcow)\ndocker restart ${postfix_c} ${dovecot_c} ${nginx_c}\n</code></pre></p>","path":["R p.en"],"tags":[]},{"location":"de/post_installation/reverse-proxy/r_p.en/#adding-additional-server-names-for-mailcow-ui","level":2,"title":"Adding additional server names for mailcow UI","text":"<p>If you plan to use a server name that is not <code>MAILCOW_HOSTNAME</code> in your reverse proxy, make sure to populate that name in mailcow.conf via <code>ADDITIONAL_SERVER_NAMES</code> first. Names must be separated by commas and must not contain spaces. If you skip this step, mailcow may respond to your reverse proxy with an incorrect site.</p> <pre><code>ADDITIONAL_SERVER_NAMES=webmail.domain.tld,other.example.tld\n</code></pre> <p>Run the following command to apply:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["R p.en"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/","level":1,"title":"Borgmatic Backup","text":"","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#einfuhrung","level":2,"title":"Einführung","text":"<p>Borgmatic ist ein großartiger Weg, um Backups auf Ihrem mailcow-Setup durchzuführen, da es Ihre Daten sicher verschlüsselt und extrem einfach einzurichten ist.</p> <p>Aufgrund seiner Deduplizierungsfähigkeiten können Sie eine große Anzahl von Backups speichern, ohne große Mengen an Speicherplatz zu verschwenden. So können Sie Backups in sehr kurzen Abständen durchführen, um einen minimalen Datenverlust zu gewährleisten, wenn die Notwendigkeit besteht, Daten aus einer Sicherung wiederherzustellen.</p> <p>Dieses Dokument führt Sie durch den Prozess zur Aktivierung kontinuierlicher Backups für mailcow mit borgmatic. Die borgmatic Funktionalität wird durch das borgmatic Docker Image bereitgestellt. Schauen Sie sich die <code>README</code> in diesem Repository an, um mehr über die anderen Optionen (wie z.B. Push-Benachrichtigungen) zu erfahren, die verfügbar sind. Diese Anleitung behandelt nur die Grundlagen.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#einrichten-von-borgmatic","level":2,"title":"Einrichten von borgmatic","text":"","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#erstellen-oder-andern-sie-docker-composeoverrideyml","level":3,"title":"Erstellen oder ändern Sie <code>docker-compose.override.yml</code>","text":"<p>Im mailcow-dockerized Stammverzeichnis erstellen oder bearbeiten Sie <code>docker-compose.override.yml</code> und fügen Sie die folgende Konfiguration ein:</p> <pre><code>services:\n  borgmatic-mailcow:\n    image: ghcr.io/borgmatic-collective/borgmatic\n    hostname: mailcow\n    restart: always\n    dns: ${IPV4_NETWORK:-172.22.1}.254\n    volumes:\n      - vmail-vol-1:/mnt/source/vmail:ro\n      - crypt-vol-1:/mnt/source/crypt:ro\n      - redis-vol-1:/mnt/source/redis:ro\n      - rspamd-vol-1:/mnt/source/rspamd:ro\n      - postfix-vol-1:/mnt/source/postfix:ro\n      - mysql-socket-vol-1:/var/run/mysqld/\n      - borg-config-vol-1:/root/.config/borg\n      - borg-cache-vol-1:/root/.cache/borg\n      - ./data/conf/borgmatic/etc:/etc/borgmatic.d:Z\n      - ./data/conf/borgmatic/ssh:/root/.ssh:Z\n    environment:\n      - TZ=${TZ}\n      - BORG_PASSPHRASE=${BORG_PASSPHRASE}\n      - DBNAME=${DBNAME}\n      - DBUSER=${DBUSER}\n      - DBPASS=${DBPASS}\n    networks:\n      mailcow-network:\n        aliases:\n          - borgmatic\n\nvolumes:\n  borg-cache-vol-1:\n  borg-config-vol-1:\n</code></pre> <p>Fügen Sie <code>BORG_PASSPHRASE=YouBetterPutSomethingRealGoodHere</code> zu Ihrer <code>mailcow.conf</code> hinzu und stellen Sie sicher, dass Sie die <code>BORG_PASSPHRASE</code> in eine sichere Passphrase Ihrer Wahl ändern.</p> <p>Aus Sicherheitsgründen mounten wir das maildir als schreibgeschützt. Wenn Sie später Daten wiederherstellen wollen, müssen Sie das <code>ro</code>-Flag entfernen, bevor Sie die Daten wiederherstellen. Dies wird im Abschnitt über die Wiederherstellung von Backups beschrieben.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#erstellen-sie-dataconfborgmaticetcconfigyaml","level":3,"title":"Erstellen Sie <code>data/conf/borgmatic/etc/config.yaml</code>","text":"<p>Als nächstes müssen wir die borgmatic-Konfiguration erzeugen. Borgmatic unterstützt Umgebungsvariableninterpolation, dadurch erhalten wir die korrekten MySQL-Zugangsdaten über Docker bzw. über unsere <code>mailcow.conf</code>, ohne dass diese in der Konfigurationsdatei offengelegt werden.</p> <p>Vergewissern Sie sich, alle folgenden Zeilen zu kopieren!</p> <pre><code>cat &lt;&lt;EOF &gt; data/conf/borgmatic/etc/config.yaml\nsource_directories:\n    - /mnt/source/vmail\n    - /mnt/source/crypt\n    - /mnt/source/redis\n    - /mnt/source/rspamd\n    - /mnt/source/postfix\nrepositories:\n    - path: ssh://user@rsync.net:22/./mailcow\n      label: rsync\nexclude_patterns:\n    - '/mnt/source/postfix/public/'\n    - '/mnt/source/postfix/private/'\n    - '/mnt/source/rspamd/rspamd.sock'\n\nkeep_hourly: 24\nkeep_daily: 7\nkeep_weekly: 4\nkeep_monthly: 6\n\nmariadb_databases:\n    - name: ${DBNAME}\n      username: ${DBUSER}\n      password: ${DBPASS}\n      options: \"--default-character-set=utf8mb4 --skip-ssl\"\n      list_options: \"--skip-ssl\"\n      restore_options: \"--skip-ssl\"\nEOF\n</code></pre> <p>Warning</p> <p>Ab borgmatic 1.8.0 (erschienen am 19. Juli 2023) wurde der Aufbau der Konfigurationsdatei geändert. Sie können die Docker-Logs des Borgmatic-Containers auf Deprecation-Warnmeldungen prüfen, um festzustellen, ob Sie betroffen sind und Ihre Konfigurationsdatei für eine ältere Version von borgmatic erstellt wurde. In diesem Fall sollten Sie eine neue <code>config.yaml</code>-Datei wie oben beschrieben erstellen, um Probleme mit zukünftigen Versionen von borgmatic zu vermeiden.</p> <p>Warning</p> <p>Ab borgmatic 1.9.4 (erschienen am 11. Dezember 2024) versuchen die enthaltenen MariaDB-Tools standardmäßig, verschlüsselte Verbindungen herzustellen. Bearbeiten Sie die <code>config.yaml</code> und fügen Sie <code>--skip-ssl</code> zu <code>options</code>, <code>restore_options</code> und <code>list_options</code> wie oben gezeigt hinzu. Ändern Sie außerdem <code>mysql_databases</code> in <code>mariadb_databases</code>, um Probleme mit zukünftigen Versionen von borgmatic und MariaDB zu vermeiden.</p> <p>Diese Datei ist ein minimales Beispiel für die Verwendung von borgmatic mit einem Konto <code>user</code> beim Cloud-Speicheranbieter <code>rsync.net</code> für ein Repository namens <code>mailcow</code> (siehe Einstellung <code>repositories</code>). Dies muss entsprechend angepasst werden.</p> <p>Es wird sowohl das maildir als auch die MySQL-Datenbank gesichert, was alles ist, was Sie brauchen, um Ihre mailcow nach einem Vorfall wiederherzustellen.</p> <p>Im Backup wird jeweils ein Archiv für jede der letzten 24 Stunden, eines für jeden der letzten 7 Wochentage, eines für jede der letzten 4 Wochen und eines pro Monat des letzten halben Jahrs behalten.</p> <p>Schauen Sie in der borgmatic Dokumentation nach, wie Sie andere Arten von Repositories oder Konfigurationsoptionen nutzen können. Wenn Sie ein lokales Dateisystem als Backup-Ziel verwenden, stellen Sie sicher, dass Sie es in den Container einbinden. Der Container definiert zu diesem Zweck ein Volume namens <code>/mnt/borg-repository</code>.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#erstellen-sie-einen-crontab","level":3,"title":"Erstellen Sie einen crontab","text":"<p>Erstellen Sie eine neue Textdatei in <code>data/conf/borgmatic/etc/crontab.txt</code> mit folgendem Inhalt:</p> <pre><code>14 * * * * PATH=$PATH:/usr/local/bin /usr/local/bin/borgmatic --stats -v 0 2&gt;&amp;1\n</code></pre> <p>Diese Datei erwartet eine crontab-Syntax. Das hier gezeigte Beispiel veranlasst das Backup, jede Stunde um 14 Minuten nach der vollen Stunde auszuführen und am Ende einige nette Statistiken zu protokollieren.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#ssh-schlussel-in-ordner-ablegen","level":3,"title":"SSH-Schlüssel in Ordner ablegen","text":"<p>Legen Sie die SSH-Schlüssel, die Sie für Verbindungen zu entfernten Repositories verwenden wollen, in <code>data/conf/borgmatic/ssh</code> ab. OpenSSH erwartet die übliche <code>id_rsa</code>, <code>id_ed25519</code> oder ähnliches in diesem Verzeichnis zu finden. Stellen Sie sicher, dass die Datei <code>chmod 600</code> und nicht für alle lesbar ist, oder OpenSSH wird sich weigern, den SSH-Schlüssel zu benutzen.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#den-container-hochfahren","level":3,"title":"Den Container hochfahren","text":"<p>Für den nächsten Schritt müssen wir den Container in einem konfigurierten Zustand hochfahren und laufen lassen. Um das zu tun, führen Sie aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#das-backup-repository-initialisieren","level":3,"title":"Das Backup Repository initialisieren","text":"<p>Zwar ist Ihr borgmatic-Container jetzt betriebsbereit, aber die Backups schlagen derzeit fehl, da das Repository nicht initialisiert wurde.</p> <p>Um das Repository zu initialisieren, führen Sie folgenden Befehl aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic init --encryption repokey-blake2\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic init --encryption repokey-blake2\n</code></pre> <p>Sie werden aufgefordert, den SSH-Hostschlüssel Ihres entfernten Repository-Servers zu authentifizieren. Prüfen Sie, ob er übereinstimmt und bestätigen Sie die Aufforderung mit <code>yes</code>. Das Repository wird mit der Passphrase initialisiert, die Sie zuvor in der Umgebungsvariable <code>BORG_PASSPHRASE</code> gesetzt haben.</p> <p>Bei Verwendung einer der <code>repokey</code>-Verschlüsselungsmethoden wird der Verschlüsselungsschlüssel im Repository selbst gespeichert und nicht auf dem Client, so dass in dieser Hinsicht keine weiteren Maßnahmen erforderlich sind. Wenn Sie sich für die Verwendung eines <code>keyfile</code> anstelle von <code>repokey</code> entscheiden, stellen Sie sicher, dass Sie den Schlüssel exportieren und separat sichern. Lesen Sie den Abschnitt Exportieren von Schlüsseln um zu erfahren, wie Sie den Schlüssel abrufen können.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#container-neustarten","level":3,"title":"Container neustarten","text":"<p>Nachdem wir nun die Konfiguration und Initialisierung des Repositorys abgeschlossen haben, starten wir den Container neu, um sicherzustellen, dass er sich in einem definierten Zustand befindet:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart borgmatic-mailcow\n</code></pre> <pre><code>docker-compose restart borgmatic-mailcow\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#wiederherstellung-von-einem-backup","level":2,"title":"Wiederherstellung von einem Backup","text":"<p>Das Wiederherstellen eines Backups setzt voraus, dass Sie mit einer neuen Installation von mailcow beginnen, und dass Sie derzeit keine benutzerdefinierten Daten in ihrem maildir oder ihrer mailcow-Datenbank haben.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#wiederherstellen-von-maildir","level":3,"title":"Wiederherstellen von maildir","text":"<p>Warnung</p> <p>Dies wird Dateien in Ihrem maildir überschreiben! Führen Sie dies nicht aus, es sei denn, Sie beabsichtigen tatsächlich, Mail Dateien von einem Backup wiederherzustellen.</p> <p>Wenn Sie SELinux im Enforcing-Modus verwenden</p> <p>Wenn Sie mailcow auf einem Host mit SELinux im Enforcing-Modus verwenden, müssen Sie ihn während der Extraktion des Archivs vorübergehend deaktivieren, da das mailcow-Setup das vmail-Volume als privat kennzeichnet, das ausschließlich dem Dovecot-Container gehört. SELinux wird (berechtigterweise) jeden anderen Container, wie z.B. den borgmatic Container, daran hindern, auf dieses Volume zu schreiben.</p> <p>Bevor Sie eine Wiederherstellung durchführen, müssen Sie das vmail-Volume in <code>docker-compose.override.yml</code> beschreibbar machen, indem Sie das <code>ro</code>-Flag aus dem Volume entfernen. Dann können Sie den folgenden Befehl verwenden, um das Maildir aus einem Backup wiederherzustellen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic extract --path mnt/source --archive latest\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic extract --path mnt/source --archive latest\n</code></pre> <p>Alternativ können Sie auch einen beliebigen Archivnamen aus der Liste der Archive angeben (siehe Auflistung aller verfügbaren Archive)</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#mysql-wiederherstellen","level":3,"title":"MySQL wiederherstellen","text":"<p>Warnung</p> <p>Die Ausführung dieses Befehls löscht und erstellt die mailcow-Datenbank neu! Führen Sie diesen Befehl nicht aus, es sei denn Sie beabsichtigen, die mailcow-Datenbank von einem Backup wiederherzustellen.</p> <p>Um die MySQL-Datenbank aus dem letzten Archiv wiederherzustellen, verwenden Sie diesen Befehl:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic restore --archive latest\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic restore --archive latest\n</code></pre> <p>Alternativ können Sie auch einen beliebigen Archivnamen aus der Liste der Archive angeben (siehe Auflistung aller verfügbaren Archive)</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#nach-der-wiederherstellung","level":3,"title":"Nach der Wiederherstellung","text":"<p>Nach der Wiederherstellung müssen Sie mailcow neu starten. Wenn Sie den Enforcing-Modus von SELinux deaktiviert haben, wäre jetzt ein guter Zeitpunkt, um ihn wieder zu aktivieren.</p> <p>Um mailcow neu zu starten, verwenden Sie den folgenden Befehl:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down &amp;&amp; docker compose up -d\n</code></pre> <pre><code>docker-compose down &amp;&amp; docker-compose up -d\n</code></pre> <p>Wenn Sie SELinux verwenden, werden dadurch auch alle Dateien in Ihrem vmail-Volume neu benannt. Seien Sie geduldig, denn dies kann eine Weile dauern kann, wenn Sie viele Dateien haben.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#nutzliche-befehle","level":2,"title":"Nützliche Befehle","text":"","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#manueller-archivierungslauf-mit-debugging-ausgabe","level":3,"title":"Manueller Archivierungslauf (mit Debugging-Ausgabe)","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic -v 2\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic -v 2\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#auflistung-aller-verfugbaren-archive","level":3,"title":"Auflistung aller verfügbaren Archive","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic list\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic list\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#sperre-aufheben","level":3,"title":"Sperre aufheben","text":"<p>Wenn borg während eines Archivierungslaufs unterbrochen wird, hinterlässt es eine Sperre, die gelöscht werden muss, bevor neue Operationen durchgeführt werden können:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borg break-lock\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borg break-lock\n</code></pre> <p>Jetzt wäre ein guter Zeitpunkt, einen manuellen Archivierungslauf durchzuführen, um sicherzustellen, dass er erfolgreich durchgeführt werden kann.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.de/#exportieren-von-schlusseln","level":3,"title":"Exportieren von Schlüsseln","text":"<p>Wenn Sie eine der <code>keyfile</code>-Methoden zur Verschlüsselung verwenden, MÜSSEN Sie sich selbst um die Sicherung der Schlüsseldateien kümmern. Die Schlüsseldateien werden erzeugt, wenn Sie das Repository initialisieren. Die <code>repokey</code>-Methoden speichern die Schlüsseldatei innerhalb des Repositories, so dass eine manuelle Sicherung nicht so wichtig ist.</p> <p>Beachten Sie, dass Sie in beiden Fällen auch die Passphrase haben müssen, um die Archive zu entschlüsseln.</p> <p>Um das <code>keyfile</code> zu holen, führen Sie aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borg key export --paper user@rsync.net:mailcow\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borg key export --paper user@rsync.net:mailcow\n</code></pre> <p>Wobei <code>user@rsync.net:mailcow</code> die URI zu Ihrem Repository ist.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/","level":1,"title":"Borgmatic Backup","text":"","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#introduction","level":2,"title":"Introduction","text":"<p>Borgmatic is a great way to run backups on your mailcow setup as it securely encrypts your data and is extremely easy to set up.</p> <p>Due to it's deduplication capabilities you can store a great number of backups without wasting large amounts of disk space. This allows you to run backups in very short intervals to ensure minimal data loss when the need arises to recover data from a backup.</p> <p>This document guides you through the process to enable continuous backups for mailcow with borgmatic. The borgmatic functionality is provided by the borgmatic Docker image. Check out the <code>README</code> in that repository to find out about the other options (such as push notifications) that are available. This guide only covers the basics.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#setting-up-borgmatic","level":2,"title":"Setting up borgmatic","text":"","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#create-or-amend-docker-composeoverrideyml","level":3,"title":"Create or amend <code>docker-compose.override.yml</code>","text":"<p>In the mailcow-dockerized root folder create or edit <code>docker-compose.override.yml</code> and insert the following configuration:</p> <pre><code>services:\n  borgmatic-mailcow:\n    image: ghcr.io/borgmatic-collective/borgmatic\n    hostname: mailcow\n    restart: always\n    dns: ${IPV4_NETWORK:-172.22.1}.254\n    volumes:\n      - vmail-vol-1:/mnt/source/vmail:ro\n      - crypt-vol-1:/mnt/source/crypt:ro\n      - redis-vol-1:/mnt/source/redis:ro\n      - rspamd-vol-1:/mnt/source/rspamd:ro\n      - postfix-vol-1:/mnt/source/postfix:ro\n      - mysql-socket-vol-1:/var/run/mysqld/\n      - borg-config-vol-1:/root/.config/borg\n      - borg-cache-vol-1:/root/.cache/borg\n      - ./data/conf/borgmatic/etc:/etc/borgmatic.d:Z\n      - ./data/conf/borgmatic/ssh:/root/.ssh:Z\n    environment:\n      - TZ=${TZ}\n      - BORG_PASSPHRASE=${BORG_PASSPHRASE}\n      - DBNAME=${DBNAME}\n      - DBUSER=${DBUSER}\n      - DBPASS=${DBPASS}\n    networks:\n      mailcow-network:\n        aliases:\n          - borgmatic\n\nvolumes:\n  borg-cache-vol-1:\n  borg-config-vol-1:\n</code></pre> <p>Append <code>BORG_PASSPHRASE=YouBetterPutSomethingRealGoodHere</code> to your <code>mailcow.conf</code> and ensure that you change the <code>BORG_PASSPHRASE</code> to a secure passphrase of your choosing.</p> <p>For security reasons we mount the maildir as read-only. If you later want to restore data you will need to remove the <code>ro</code> flag prior to restoring the data. This is described in the section on restoring backups.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#create-dataconfborgmaticetcconfigyaml","level":3,"title":"Create <code>data/conf/borgmatic/etc/config.yaml</code>","text":"<p>Next, we need to create the borgmatic configuration. Borgmatic supports environment variable interpolation, this way we can get the correct MySQL credentials from Docker or more specifically from our <code>mailcow.conf</code> without exposing them in our config.</p> <p>Make sure to copy all the following lines!</p> <pre><code>cat &lt;&lt;EOF &gt; data/conf/borgmatic/etc/config.yaml\nsource_directories:\n    - /mnt/source/vmail\n    - /mnt/source/crypt\n    - /mnt/source/redis\n    - /mnt/source/rspamd\n    - /mnt/source/postfix\nrepositories:\n    - path: ssh://user@rsync.net:22/./mailcow\n      label: rsync\nexclude_patterns:\n    - '/mnt/source/postfix/public/'\n    - '/mnt/source/postfix/private/'\n    - '/mnt/source/rspamd/rspamd.sock'\n\nkeep_hourly: 24\nkeep_daily: 7\nkeep_weekly: 4\nkeep_monthly: 6\n\nmariadb_databases:\n    - name: ${DBNAME}\n      username: ${DBUSER}\n      password: ${DBPASS}\n      options: \"--default-character-set=utf8mb4 --skip-ssl\"\n      list_options: \"--skip-ssl\"\n      restore_options: \"--skip-ssl\"\nEOF\n</code></pre> <p>Warning</p> <p>Starting with borgmatic 1.8.0 (released July 19th, 2023), the configuration file syntax was changed. You can check the Docker logs of the borgmatic container for deprecation warnings to see if you are affected, i.e. if your config file was generated for an older borgmatic version. In this case, you should create a new <code>config.yaml</code> file as described above to avoid problems with future borgmatic releases.</p> <p>Warning</p> <p>Starting with borgmatic 1.9.4 (released December 11th, 2024), the included MariaDB tools try to force encrypted connections by default. Edit your <code>config.yaml</code> and add <code>--skip-ssl</code> to <code>options</code>, <code>restore_options</code>, and <code>list_options</code> as shown above. Also make sure to change <code>mysql_databases</code> to <code>mariadb_databases</code> to avoid problems with future borgmatic and MariaDB releases.</p> <p>This file is a minimal example for using borgmatic with an account <code>user</code> on the cloud storage provider <code>rsync.net</code> for a repository called <code>mailcow</code> (see <code>repositories</code> setting). This must be changed accordingly.</p> <p>It will backup both the maildir and MySQL database, which is all you should need to restore your mailcow setup after an incident.</p> <p>The retention settings will keep one archive for each hour of the past 24 hours, one per day of the week, one per week of the month and one per month of the past half year.</p> <p>Check the borgmatic documentation on how to use other types of repositories or configuration options. If you choose to use a local filesystem as a backup destination make sure to mount it into the container. The container defines a volume called <code>/mnt/borg-repository</code> for this purpose.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#create-a-crontab","level":3,"title":"Create a crontab","text":"<p>Create a new text file in <code>data/conf/borgmatic/etc/crontab.txt</code> with the following content:</p> <pre><code>14 * * * * PATH=$PATH:/usr/local/bin /usr/local/bin/borgmatic --stats -v 0 2&gt;&amp;1\n</code></pre> <p>This file expects crontab syntax. The example shown here will trigger the backup to run every hour at 14 minutes past the hour and log some nice stats at the end.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#place-ssh-keys-in-folder","level":3,"title":"Place SSH keys in folder","text":"<p>Place the SSH keys you intend to use for remote repository connections in <code>data/conf/borgmatic/ssh</code>. OpenSSH expects the usual <code>id_rsa</code>, <code>id_ed25519</code> or similar to be in this directory. Ensure the file is <code>chmod 600</code> and not world readable or OpenSSH will refuse to use the SSH key.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#bring-up-the-container","level":3,"title":"Bring up the container","text":"<p>For the next step we need the container to be up and running in a configured state. To do that run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#initialize-the-repository","level":3,"title":"Initialize the repository","text":"<p>By now your borgmatic container is up and running, but the backups will currently fail due to the repository not being initialized.</p> <p>To initialize the repository run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic init --encryption repokey-blake2\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic init --encryption repokey-blake2\n</code></pre> <p>You will be asked you to authenticate the SSH host key of your remote repository server. See if it matches and confirm the prompt by entering <code>yes</code>. The repository will be initialized with the passphrase you set in the <code>BORG_PASSPHRASE</code> environment variable earlier.</p> <p>When using any of the <code>repokey</code> encryption methods the encryption key will be stored in the repository itself and not on the client, so there is no further action required in this regard. If you decide to use a <code>keyfile</code> instead of a <code>repokey</code> make sure you export the key and back it up separately. Check the Exporting Keys section for how to retrieve the key.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#restart-container","level":3,"title":"Restart container","text":"<p>Now that we finished configuring and initializing the repository restart the container to ensure it is in a defined state:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart borgmatic-mailcow\n</code></pre> <pre><code>docker-compose restart borgmatic-mailcow\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#restoring-from-a-backup","level":2,"title":"Restoring from a backup","text":"<p>Restoring a backup assumes you are starting off with a fresh installation of mailcow, and you currently do not have any custom data in your maildir or your mailcow database.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#restore-maildir","level":3,"title":"Restore maildir","text":"<p>Warning</p> <p>Doing this will overwrite files in your maildir! Do not run this unless you actually intend to recover mail files from a backup.</p> <p>If you use SELinux in Enforcing mode</p> <p>If you are using mailcow on a host with SELinux in Enforcing mode you will have to temporarily disable it during extraction of the archive as the mailcow setup labels the vmail volume as private, belonging to the dovecot container exclusively. SELinux will (rightfully) prevent any other container, such as the borgmatic container, from writing to this volume.</p> <p>Before running a restore you must make the vmail volume writeable in <code>docker-compose.override.yml</code> by removing the <code>ro</code> flag from the volume. Then you can use the following command to restore the maildir from a backup:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic extract --path mnt/source --archive latest\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic extract --path mnt/source --archive latest\n</code></pre> <p>Alternatively you can specify any archive name from the list of archives (see Listing all available archives)</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#restore-mysql","level":3,"title":"Restore MySQL","text":"<p>Warning</p> <p>Running this command will delete and recreate the mailcow database! Do not run this unless you actually intend to recover the mailcow database from a backup.</p> <p>To restore the MySQL database from the latest archive use this command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic restore --archive latest\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic restore --archive latest\n</code></pre> <p>Alternatively you can specify any archive name from the list of archives (see Listing all available archives)</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#after-restoring","level":3,"title":"After restoring","text":"<p>After restoring you need to restart mailcow. If you disabled SELinux enforcing mode now would be a good time to re-enable it.</p> <p>To restart mailcow use the follwing command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down &amp;&amp; docker compose up -d\n</code></pre> <pre><code>docker-compose down &amp;&amp; docker-compose up -d\n</code></pre> <p>If you use SELinux this will also trigger the re-labeling of all files in your vmail volume. Be patient, as this may take a while if you have lots of files.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#useful-commands","level":2,"title":"Useful commands","text":"","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#manual-archiving-run-with-debugging-output","level":3,"title":"Manual archiving run (with debugging output)","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic -v 2\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic -v 2\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#listing-all-available-archives","level":3,"title":"Listing all available archives","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic list\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic list\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#break-lock","level":3,"title":"Break lock","text":"<p>When borg is interrupted during an archiving run it will leave behind a stale lock that needs to be cleared before any new operations can be performed:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borg break-lock\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borg break-lock\n</code></pre> <p>Now would be a good time to do a manual archiving run to ensure it can be successfully performed.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/borgmatic/third_party-borgmatic.en/#exporting-keys","level":3,"title":"Exporting keys","text":"<p>When using any of the <code>keyfile</code> methods for encryption you MUST take care of backing up the key files yourself. The key files are generated when you initialize the repository. The <code>repokey</code> methods store the key file within the repository, so a manual backup isn't as essential.</p> <p>Note that in either case you also must have the passphrase to decrypt any archives.</p> <p>To fetch the keyfile run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borg key export --paper user@rsync.net:mailcow\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borg key export --paper user@rsync.net:mailcow\n</code></pre> <p>Where <code>user@rsync.net:mailcow</code> is the URI to your repository.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"de/third_party/checkmk/u_e-checkmk.de/","level":1,"title":"U e checkmk.de","text":"<p>mailcow bietet mittels des eigenen Update-Scripts die Möglichkeit zu prüfen, ob Updates vorhanden sind.</p> <p>Sofern mailcow-Updates mittels checkmk abgefragt werden soll, kann man im <code>local</code>-Verzeichnis des checkmk-Agents (normalerweise <code>/usr/lib/check_mk_agent/local/</code>) eine ausführbare Datei mit dem Namen <code>mailcow_update</code> und nachfolgendem Inhalt erstellen:</p> <pre><code>#!/bin/bash\ncd /opt/mailcow-dockerized/ &amp;&amp; ./update.sh --check-tags &gt;/dev/null\nstatus=$?\nif [ $status -eq 3 ]; then\n  echo \"0 \\\"mailcow_update\\\" mailcow_update=0;1;;0;1 No newer tags available.\"\nelif [ $status -eq 0 ]; then\n  echo \"1 \\\"mailcow_update\\\" mailcow_update=1;1;;0;1 New tag is available.\\nThe changes can be found here: https://github.com/mailcow/mailcow-dockerized/releases/latest\"\nelse\n  echo \"3 \\\"mailcow_update\\\" - Unknown output from update script ...\"\nfi\nexit\n</code></pre> <p>Um jeden neu verfügbaren Code als Update angezeigt zu bekommen, kann die ausführbare Datei mit folgendem Inhalt erstellt werden: <pre><code>#!/bin/bash\ncd /opt/mailcow-dockerized/ &amp;&amp; ./update.sh -c &gt;/dev/null\nstatus=$?\nif [ $status -eq 3 ]; then\n  echo \"0 \\\"mailcow_update\\\" mailcow_update=0;1;;0;1 No updates available.\"\nelif [ $status -eq 0 ]; then\n  echo \"1 \\\"mailcow_update\\\" mailcow_update=1;1;;0;1 Updated code is available.\\nThe changes can be found here: https://github.com/mailcow/mailcow-dockerized/commits/master\"\nelse\n  echo \"3 \\\"mailcow_update\\\" - Unknown output from update script ...\"\nfi\nexit\n</code></pre></p> <p>Sofern das mailcow-Installationsverzeichnis nicht <code>/opt/</code> ist, kann der Pfad in der zweiten Zeile angepasst werden.</p> <p>Danach für den mailcow-Host in checkmk die Services neu inventarisieren und es sollte ein neuer Check mit Namen <code>mailcow_update</code> auswählbar sein.</p> <p>Der Check <code>mailcow_update</code> wird jedes Mal ausgeführt, wenn der checkmk Agent den mailcow Server überprüft. Sie können das Ergebnis zwischenspeichern, indem Sie das Skript in einem Unterordner mit dem Namen der Anzahl von Sekunden ablegen, für die Sie es zwischenspeichern möchten. \\ <code>/usr/lib/check_mk_agent/local/3600/</code> speichert die Antwort für 3600 Sekunden (1 Stunde).</p>","path":["U e checkmk.de"],"tags":[]},{"location":"de/third_party/checkmk/u_e-checkmk.de/#screenshots","level":2,"title":"Screenshots","text":"","path":["U e checkmk.de"],"tags":[]},{"location":"de/third_party/checkmk/u_e-checkmk.de/#keine-updates-verfugbar","level":3,"title":"Keine Updates verfügbar","text":"<p>Sofern keine Updates / keine neuen Tags vorhanden sind, wird <code>OK</code> ausgegeben.</p> <p></p>","path":["U e checkmk.de"],"tags":[]},{"location":"de/third_party/checkmk/u_e-checkmk.de/#neue-updates-verfugbar","level":3,"title":"Neue Updates verfügbar","text":"<p>Sofern Updates / Neue Tags vorhanden sind, wird <code>WARN</code> ausgegeben.</p> <p></p> <p>Sollte stattdessen <code>CRIT</code> gewünscht sein, ist die 7. Zeile durch folgendes zu ersetzen:</p> <pre><code>echo \"2 \\\"mailcow_update\\\" mailcow_update=1;1;;0;1 Updated code is available.\\nThe changes can be found here: https://github.com/mailcow/mailcow-dockerized/commits/master\"\n</code></pre>","path":["U e checkmk.de"],"tags":[]},{"location":"de/third_party/checkmk/u_e-checkmk.de/#detailierter-check-output","level":3,"title":"Detailierter Check-Output","text":"<ul> <li>Hier wird ein Link zu den GitHub Commits / des letzten Release von mailcow ausgegeben, sofern Updates verfügbar sind.</li> <li>Metriken werden ebenfalls ausgegeben (nicht nur bei vorhandenen Updates):</li> <li>0 = Keine Updates verfügbar</li> <li>1 = Neue Updates verfügbar</li> </ul>","path":["U e checkmk.de"],"tags":[]},{"location":"de/third_party/checkmk/u_e-checkmk.en/","level":1,"title":"U e checkmk.en","text":"<p>mailcow provides the ability to check for updates using its own update script.</p> <p>If you want to check for mailcow updates using checkmk, you can create an executable file in the <code>local</code> directory of the checkmk agent (typically <code>/usr/lib/check_mk_agent/local/</code>) with the name <code>mailcow_update</code> and the following content: <pre><code>#!/bin/bash\ncd /opt/mailcow-dockerized/ &amp;&amp; ./update.sh --check-tags &gt;/dev/null\nstatus=$?\nif [ $status -eq 3 ]; then\n  echo \"0 \\\"mailcow_update\\\" mailcow_update=0;1;;0;1 No newer tags available.\"\nelif [ $status -eq 0 ]; then\n  echo \"1 \\\"mailcow_update\\\" mailcow_update=1;1;;0;1 New tag is available.\\nThe changes can be found here: https://github.com/mailcow/mailcow-dockerized/releases/latest\"\nelse\n  echo \"3 \\\"mailcow_update\\\" - Unknown output from update script ...\"\nfi\nexit\n</code></pre></p> <p>To check for every updated code, just create the executable with the following content: <pre><code>#!/bin/bash\ncd /opt/mailcow-dockerized/ &amp;&amp; ./update.sh -c &gt;/dev/null\nstatus=$?\nif [ $status -eq 3 ]; then\n  echo \"0 \\\"mailcow_update\\\" mailcow_update=0;1;;0;1 No updates available.\"\nelif [ $status -eq 0 ]; then\n  echo \"1 \\\"mailcow_update\\\" mailcow_update=1;1;;0;1 Updated code is available.\\nThe changes can be found here: https://github.com/mailcow/mailcow-dockerized/commits/master\"\nelse\n  echo \"3 \\\"mailcow_update\\\" - Unknown output from update script ...\"\nfi\nexit\n</code></pre></p> <p>If the mailcow installation directory is not <code>/opt/</code>, adjust this in the 2nd line.</p> <p>After that re-inventory the services for your mailcow host in checmk and a new check named <code>mailcow_update</code> should be selectable.</p> <p>This will run the <code>mailcow_update</code> everytime checkmk agent is checked, you can cache the result by placing the script in a subfolder named the number of seconds you wish to cache it. \\ <code>/usr/lib/check_mk_agent/local/3600/</code> will cache the response for an 3600 seconds (1 hour).</p>","path":["U e checkmk.en"],"tags":[]},{"location":"de/third_party/checkmk/u_e-checkmk.en/#screenshots","level":2,"title":"Screenshots","text":"","path":["U e checkmk.en"],"tags":[]},{"location":"de/third_party/checkmk/u_e-checkmk.en/#no-updates-available","level":3,"title":"No updates available","text":"<p>If there are no updates / newer tag available, <code>OK</code> is displayed.</p> <p></p>","path":["U e checkmk.en"],"tags":[]},{"location":"de/third_party/checkmk/u_e-checkmk.en/#new-updates-available","level":3,"title":"New updates available","text":"<p>If updates / newer tags are available, <code>WARN</code> is displayed.</p> <p></p> <p>If <code>CRIT</code> is desired instead, replace the 7th line with the following:</p> <pre><code>echo \"2 \\\"mailcow_update\\\" mailcow_update=1;1;;0;1 Updated code is available.\\nThe changes can be found here: https://github.com/mailcow/mailcow-dockerized/commits/master\"\n</code></pre>","path":["U e checkmk.en"],"tags":[]},{"location":"de/third_party/checkmk/u_e-checkmk.en/#detailed-check-output","level":3,"title":"Detailed check output","text":"<ul> <li>This provides a link to mailcow's GitHub commits, if updates are available.</li> <li>Metrics are also displayed ( not only when updates are available):</li> <li>0 = No updates available</li> <li>1 = New updates available</li> </ul>","path":["U e checkmk.en"],"tags":[]},{"location":"de/third_party/exchange_onprem/third_party-exchange_onprem.de/","level":1,"title":"Third party exchange onprem.de","text":"<p>Die Verwendung von Microsoft Exchange in einem hybriden Setup ist mit mailcow möglich. Mit diesem Setup können Sie Postfächer auf Ihrer mailcow hinzufügen und trotzdem Exchange Online Protection nutzen. Alle Postfächer, die in Exchange eingerichtet sind, erhalten ihre Mails wie gewohnt, während mit dem hybriden Ansatz zusätzliche Postfächer in mailcow ohne weitere Konfiguration eingerichtet werden können.</p> <p>Dieses Setup ist sehr praktisch, wenn Sie die Office 365 Sicherheitsvorgaben aktiviert haben und Anwendungen von Drittanbietern sich nicht mehr in Ihre Postfächer mit einer der unterstützten Methoden einloggen können.</p>","path":["Third party exchange onprem.de"],"tags":[]},{"location":"de/third_party/exchange_onprem/third_party-exchange_onprem.de/#voraussetzungen","level":2,"title":"Voraussetzungen","text":"<ul> <li>Der mx Record Ihrer Domain muss auf den Exchange Mail Service zeigen. Melden Sie sich in Ihrem Admin-Center an und suchen Sie in den DNS-Einstellungen Ihrer Domäne nach Ihrer personalisierten Gateway-Domäne. Sie sollte wie folgt aussehen: <code>contoso-com.mail.protection.outlook.com</code>. Wenden Sie sich an Ihren Domainregistrator, um weitere Informationen zur Änderung des mx-Eintrags zu erhalten.</li> <li>Die Domäne, für die Sie zusätzliche Postfächer haben möchten, muss in Exchange als \"Interne Relay-Domäne\" eingerichtet werden.<ol> <li>Melden Sie sich bei Ihrem Exchange Admin Center an.</li> <li>Wählen Sie den Bereich \"Mailflow\" und klicken Sie auf \"Akzeptierte Domänen\".</li> <li>Wählen Sie die Domäne aus und schalten Sie sie von \"autorisiert\" auf \"internes Relais\" um.</li> </ol> </li> </ul>","path":["Third party exchange onprem.de"],"tags":[]},{"location":"de/third_party/exchange_onprem/third_party-exchange_onprem.de/#einrichten-der-mailcow","level":2,"title":"Einrichten der mailcow","text":"<p>Ihre mailcow muss alle Mails an Ihren personalisierten Exchange Host weiterleiten. Es ist die gleiche Host-Adresse, die wir bereits für den mx Record gesucht haben.</p> <ol> <li>Fügen Sie die Domain zu Ihrer mailcow hinzu</li> <li>Fügen Sie Ihre personalisierte Exchange Host Adresse als relayhost hinzu</li> <li>Fügen Sie Ihre personalisierte Exchange Host Adresse als Weiterleitungshost hinzu, um alle weitergeleiteten Mails von Exchange bedingungslos zu akzeptieren. (Admin &gt; Konfiguration &amp; Details &gt; Konfigurations-Dropdown &gt; Weiterleitungshosts)</li> <li>Gehen Sie zu den Domäneneinstellungen und wählen Sie den neu hinzugefügten Host in der Dropdown-Liste \"Absenderabhängige Transporte\" aus. Aktivieren Sie die Weiterleitung, indem Sie die Kontrollkästchen \"Diese Domäne weiterleiten\", \"Alle Empfänger weiterleiten\" und \"Nur nicht vorhandene Postfächer weiterleiten\" aktivieren.</li> </ol> <p>Info</p> <p>Von nun an wird Ihre mailcow alle Mails akzeptieren, die von Exchange weitergeleitet werden. Die Eingangsfilterung und damit das neuronale Lernen Ihrer Kuh wird nicht mehr funktionieren. Da alle Mails über Exchange geroutet werden, wird der Filterungsprozess dort abgewickelt.</p>","path":["Third party exchange onprem.de"],"tags":[]},{"location":"de/third_party/exchange_onprem/third_party-exchange_onprem.de/#connectors-in-exchange-einrichten","level":2,"title":"Connectors in Exchange einrichten","text":"<p>Der gesamte Mailverkehr läuft nun über Exchange. Zu diesem Zeitpunkt filtert der Exchange Online-Schutz bereits alle ein- und ausgehenden Mails. Jetzt müssen wir zwei Konnektoren einrichten, um eingehende Mails von unserem Exchange Service an die mailcow weiterzuleiten und einen weiteren, um Mails zuzulassen, die von der mailcow an unseren Exchange Service weitergeleitet werden. Sie können der [offiziellen Anleitung von Microsoft] folgen (https://docs.microsoft.com/exchange/mail-flow-best-practices/use-connectors-to-configure-mail-flow/set-up-connectors-to-route-mail#2-set-up-a-connector-from-microsoft-365-or-office-365-to-your-email-server).</p> <p>Warnung</p> <p>Für den Connector, der die Mails von Ihrer mailcow zu Exchange weiterleitet, bietet Microsoft zwei Möglichkeiten der Authentifizierung an. Der empfohlene Weg ist die Verwendung eines tls-Zertifikats, das mit einem Subject-Namen konfiguriert ist, der mit einer akzeptierten Domäne in Exchange übereinstimmt. Andernfalls müssen Sie die Authentifizierung mit der statischen IP-Adresse Ihrer mailcow wählen.</p>","path":["Third party exchange onprem.de"],"tags":[]},{"location":"de/third_party/exchange_onprem/third_party-exchange_onprem.de/#validierung","level":2,"title":"Validierung","text":"<p>Der einfachste Weg, die hybride Einrichtung zu überprüfen, ist das Senden einer Mail aus dem Internet an eine Mailbox, die nur auf der mailcow existiert und andersherum.</p>","path":["Third party exchange onprem.de"],"tags":[]},{"location":"de/third_party/exchange_onprem/third_party-exchange_onprem.de/#allgemeine-probleme","level":3,"title":"Allgemeine Probleme","text":"<ul> <li>Die Validierung des Connectors von Exchange zu Ihrer mailcow schlug fehl mit <code>550 5.1.10 RESOLVER.ADR.RecipientNotFound; Recipient test@contoso.com not found by SMTP address lookup</code> Mögliche Lösung: Ihre Domäne ist nicht als \"internes Relay\" eingerichtet. Exchange kann daher den Empfänger nicht finden.</li> <li>Mails, die von der mailcow an eine Mailbox im Internet gesendet werden, können nicht zugestellt werden. Non Delivery Report mit Fehler <code>550 5.7.64 TenantAttribution; Relay Access Denied</code> Mögliche Lösung: Die Authentifizierungsmethode ist fehlgeschlagen. Stellen Sie sicher, dass der Betreff des Zertifikats mit einer akzeptierten Domäne in Exchange übereinstimmt. Versuchen Sie stattdessen die Authentifizierung über eine statische IP.</li> </ul> <p>Microsoft-Anleitung für die Einrichtung des Connectors und zusätzliche Anforderungen: https://docs.microsoft.com/exchange/mail-flow-best-practices/use-connectors-to-configure-mail-flow/set-up-connectors-to-route-mail#prerequisites-for-your-on-premises-email-environment</p>","path":["Third party exchange onprem.de"],"tags":[]},{"location":"de/third_party/exchange_onprem/third_party-exchange_onprem.en/","level":1,"title":"Third party exchange onprem.en","text":"<p>Using Microsoft Exchange in a hybrid setup is possible with mailcow. With this setup you can add mailboxes on your mailcow and still use Exchange Online Protection. All mailboxes setup in Exchange will receive their mails as usual, while with the hybrid approach additional Mailboxes can be setup in mailcow without any further configuration.</p> <p>This setup becomes very handy if you have enabled the Office 365 security defaults and third party applications can no longer login into your mailboxes by any of the supported methods.</p>","path":["Third party exchange onprem.en"],"tags":[]},{"location":"de/third_party/exchange_onprem/third_party-exchange_onprem.en/#requirements","level":2,"title":"Requirements","text":"<ul> <li>The mx Record of your domain needs to point at the Exchange mail service. Log into your Admin center and look out for the dns settings of your domain to find your personalized gateway domain. It should look like this <code>contoso-com.mail.protection.outlook.com</code>. Contact your domain registrant to get further information on how to change mx record.</li> <li>The domain you want to have additional mailboxes for must be setup as <code>internal relay domain</code> in Exchange.<ol> <li>Log in to your Exchange Admin Center</li> <li>Select the <code>mail flow</code> pane and click on <code>accepted domains</code></li> <li>Select the domain and switch it from <code>authorative</code> to <code>internal relay</code></li> </ol> </li> </ul>","path":["Third party exchange onprem.en"],"tags":[]},{"location":"de/third_party/exchange_onprem/third_party-exchange_onprem.en/#set-up-the-mailcow","level":2,"title":"Set up the mailcow","text":"<p>Your mailcow needs to relay all mails to your personalized Exchange Host. It is the same host address we already looked up for the mx Record.</p> <ol> <li>Add the domain to your mailcow</li> <li>Add your personalized Exchange Host address as relayhost</li> <li>Add your personalized Exchange Host address as forwarding host to unconditionally accepted all relayed mails from Exchange. (Admin &gt; Configuration &amp; Details &gt; Configuration Dropdown &gt; Forwarding Hosts)</li> <li>Go to the domain settings and select the newly added host on the <code>Sender-dependent transports</code> dropdown. Enable relaying by ticking the <code>Relay this domain</code>, <code>Relay all recipients</code> and the <code>Relay non-existing mailboxes only.</code> checkboxes</li> </ol> <p>Info</p> <p>From now on your mailcow will accept all mails relayed from Exchange. The inbound filtering and so the neural learning of your cow will no longer work. Because all mails are routed through Exchange the filtering process is handled there.</p>","path":["Third party exchange onprem.en"],"tags":[]},{"location":"de/third_party/exchange_onprem/third_party-exchange_onprem.en/#set-up-connectors-in-exchange","level":2,"title":"Set up Connectors in Exchange","text":"<p>All mail traffic now goes through Exchange. At this point the Exchange Online Protection already filters all incoming and outgoing mails. Now we need to set up two connectors to relay incoming mails from our Exchange Service to the mailcow and another one to allow mails relayed from the mailcow to our exchange service. You can follow the official guide from Microsoft.</p> <p>Warning</p> <p>For the connector that handles mails from your mailcow to Exchange Microsoft offers two ways of authenticating it. The recommended way is to use a tls certificate configured with a subject name that matches an accepted domain in Exchange. Otherwise you need to choose authentication with the static ip address of your mailcow.</p>","path":["Third party exchange onprem.en"],"tags":[]},{"location":"de/third_party/exchange_onprem/third_party-exchange_onprem.en/#validating","level":2,"title":"Validating","text":"<p>The easiest way to validate the hybrid setup is by sending a mail from the internet to a mailbox that only exists on the mailcow and vice versa.</p>","path":["Third party exchange onprem.en"],"tags":[]},{"location":"de/third_party/exchange_onprem/third_party-exchange_onprem.en/#common-issues","level":3,"title":"Common Issues","text":"<ul> <li>The connector validation from Exchange to your mailcow failed with <code>550 5.1.10 RESOLVER.ADR.RecipientNotFound; Recipient test@contoso.com not found by SMTP address lookup</code> Possible Solution: Your domain is not set up as <code>internal relay</code>. Exchange therefore cannot find the recipient</li> <li>Mails sent from the mailcow to a mailbox in the internet cannot be sent. Non Delivery Report with error <code>550 5.7.64 TenantAttribution; Relay Access Denied</code> Possible Solution: The authentication method failed. Make sure the certificate subject matches an accepted domain in Exchange. Try authenticating by static ip instead.</li> </ul> <p>Microsoft Guide for the connector setup and additional requirements: https://docs.microsoft.com/exchange/mail-flow-best-practices/use-connectors-to-configure-mail-flow/set-up-connectors-to-route-mail#prerequisites-for-your-on-premises-email-environment</p>","path":["Third party exchange onprem.en"],"tags":[]},{"location":"de/third_party/gitea/third_party-gitea.de/","level":1,"title":"Third party gitea.de","text":"<p>Mit der Fähigkeit von Gitea, sich über SMTP zu authentifizieren, ist es trivial, es mit mailcow zu integrieren. Es sind nur wenige Änderungen erforderlich:</p> <p>1. Um eine Datenbank für Gitea zu erstellen, verbinden Sie sich mit ihrem Server und führen Sie folgende Befehle aus: <pre><code>source mailcow.conf\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE DATABASE gitea;\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE USER 'gitea'@'%' IDENTIFIED BY 'your_strong_password';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"GRANT ALL PRIVILEGES ON gitea.* TO 'gitea'@'%';\"\n</code></pre></p> <p>2. Öffnen Sie <code>docker-compose.override.yml</code> und fügen Sie Gitea hinzu:</p> <pre><code>services:\n\n        gitea-mailcow:\n            image: gitea/gitea:1\n            volumes:\n                - ./data/gitea:/data\n            networks:\n                mailcow-network:\n                    aliases:\n                        - gitea\n            ports:\n                - \"${GITEA_SSH_PORT:-127.0.0.1:4000}:22\"\n</code></pre> <p>3. Erstellen Sie <code>data/conf/nginx/site.gitea.custom</code>, fügen Sie folgendes hinzu: <pre><code>location /gitea/ {\n        proxy_pass http://gitea:3000/;\n}\n</code></pre></p> <p>4. Öffne <code>mailcow.conf</code> und definiere den Port Bind, den Gitea für SSH verwenden soll. Beispiel:</p> <pre><code>GITEA_SSH_PORT=127.0.0.1:4000\n</code></pre> <p>5. Führen Sie folgenden Befehl aus, um den Gitea-Container hochzufahren und führen Sie anschließend einen Neustart von NGINX mit dem zweiten Befehl durch:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\ndocker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose up -d\ndocker-compose restart nginx-mailcow\n</code></pre> <p>6. Wenn Sie mailcow zu https gezwungen haben, führen Sie Schritt 9 aus und starten Sie gitea mit dem folgenden Befehl neu. </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart gitea-mailcow\n</code></pre> <pre><code>docker-compose restart gitea-mailcow\n</code></pre> <p>Fahren Sie mit Schritt 7 fort (Denken Sie daran, https anstelle von http zu verwenden, <code>https://mx.example.org/gitea/</code>)</p> <p>7. Öffnen Sie <code>http://${MAILCOW_HOSTNAME}/gitea/</code>, zum Beispiel <code>http://mx.example.org/gitea/</code>. Für Datenbank-Details setzen Sie <code>mysql</code> als Datenbank-Host. Verwenden Sie gitea als Datenbankname, gitea als Datenbankbenutzer und your_strong_password als Datenbankpasswort, welches Sie in Schritt 1 definiert haben.</p> <p>8. Sobald die Installation abgeschlossen ist, loggen Sie sich als Administrator ein und setzen Sie \"Einstellungen\" -&gt; \"Autorisierung\" -&gt; \"SMTP aktivieren\". SMTP-Host sollte <code>postfix</code> mit Port <code>587</code> sein, setzen Sie <code>Skip TLS Verify</code>, da wir ein nicht gelistetes SAN verwenden (\"postfix\" ist höchstwahrscheinlich nicht Teil Ihres Zertifikats).</p> <p>9. Erstellen Sie <code>data/gitea/gitea/conf/app.ini</code> und setzen Sie die folgenden Werte. Sie können gitea cheat sheet, leider bisher nur in Englisch verfügbar für deren Bedeutung und andere mögliche Werte konsultieren.</p> <pre><code>[server]\nSSH_LISTEN_PORT = 22\n# Für GITEA_SSH_PORT=127.0.0.1:4000 in mailcow.conf, setzen:\nSSH_DOMAIN = 127.0.0.1\nSSH_PORT = 4000\n# Für MAILCOW_HOSTNAME=mx.example.org in mailcow.conf (und Standard-Ports für HTTPS), setzen:\nROOT_URL = https://mx.example.org/gitea/\n</code></pre> <p>10. Starten Sie gitea neu mit dem kommenden Befehl. Ihre Nutzer sollten in der Lage sein, sich mit von mailcow verwalteten Konten anzumelden.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart gitea-mailcow\n</code></pre> <pre><code>docker-compose restart gitea-mailcow\n</code></pre>","path":["Third party gitea.de"],"tags":[]},{"location":"de/third_party/gitea/third_party-gitea.en/","level":1,"title":"Third party gitea.en","text":"<p>With Gitea' ability to authenticate over SMTP it is trivial to integrate it with mailcow. Few changes are needed:</p> <p>1. In order to create a database for gitea, connect to your shell and execute the following commands: <pre><code>source mailcow.conf\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE DATABASE gitea;\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE USER 'gitea'@'%' IDENTIFIED BY 'your_strong_password';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"GRANT ALL PRIVILEGES ON gitea.* TO 'gitea'@'%';\"\n</code></pre></p> <p>2. Open <code>docker-compose.override.yml</code> and add gitea:</p> <pre><code>services:\n\n        gitea-mailcow:\n            image: gitea/gitea:1\n            volumes:\n                - ./data/gitea:/data\n            networks:\n                mailcow-network:\n                    aliases:\n                        - gitea\n            ports:\n                - \"${GITEA_SSH_PORT:-127.0.0.1:4000}:22\"\n</code></pre> <p>3. Create <code>data/conf/nginx/site.gitea.custom</code>, add: <pre><code>location /gitea/ {\n        proxy_pass http://gitea:3000/;\n}\n</code></pre></p> <p>4. Open <code>mailcow.conf</code> and define the binding you want gitea to use for SSH. Example:</p> <pre><code>GITEA_SSH_PORT=127.0.0.1:4000\n</code></pre> <p>5. Run the commands to bring up the gitea container and restart the nginx-mailcow container afterwards:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\ndocker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose up -d\ndocker-compose restart nginx-mailcow\n</code></pre> <p>6. If you forced mailcow to https, execute step 9 and restart gitea with the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart gitea-mailcow\n</code></pre> <pre><code>docker-compose restart gitea-mailcow\n</code></pre> <p>Go head with step 7 (Remember to use https instead of http, <code>https://mx.example.org/gitea/</code>) </p> <p>7. Open <code>http://${MAILCOW_HOSTNAME}/gitea/</code>, for example <code>http://mx.example.org/gitea/</code>. For database details set <code>mysql</code> as database host. Use gitea as database name, gitea as database user and your_strong_password you previously definied at step 1 as database password.</p> <p>8. Once the installation is complete, login as admin and set \"settings\" -&gt; \"authorization\" -&gt; \"enable SMTP\". SMTP Host should be <code>postfix</code> with port <code>587</code>, set <code>Skip TLS Verify</code> as we are using an unlisted SAN (\"postfix\" is most likely not part of your certificate).</p> <p>9. Create <code>data/gitea/gitea/conf/app.ini</code> and set following values. You can consult gitea cheat sheet for their meaning and other possible values.</p> <pre><code>[server]\nSSH_LISTEN_PORT = 22\n# For GITEA_SSH_PORT=127.0.0.1:4000 in mailcow.conf, set:\nSSH_DOMAIN = 127.0.0.1\nSSH_PORT = 4000\n# For MAILCOW_HOSTNAME=mx.example.org in mailcow.conf (and default ports for HTTPS), set:\nROOT_URL = https://mx.example.org/gitea/\n</code></pre> <p>10. Restart gitea with the following command. Your users should be able to login with mailcow managed accounts.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart gitea-mailcow\n</code></pre> <pre><code>docker-compose restart gitea-mailcow\n</code></pre>","path":["Third party gitea.en"],"tags":[]},{"location":"de/third_party/gogs/third_party-gogs.de/","level":1,"title":"Third party gogs.de","text":"<p>Mit Gogs' Fähigkeit, sich über SMTP zu authentifizieren, ist es einfach, es mit mailcow zu verbinden. Es sind nur wenige Änderungen erforderlich:</p> <p>1. Um eine Datenbank für Gogs zu erstellen, verbinden Sie sich mit ihrem Server und führen Sie folgende Befehle aus: <pre><code>source mailcow.conf\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE DATABASE gogs;\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE USER 'gogs'@'%' IDENTIFIED BY 'your_strong_password';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"GRANT ALL PRIVILEGES ON gogs.* TO 'gogs'@'%';\n</code></pre></p> <p>2. Öffne <code>docker-compose.override.yml</code> und füge Gogs hinzu:</p> <pre><code>services:\n\n    gogs-mailcow:\n      image: gogs/gogs\n      volumes:\n        - ./data/gogs:/data\n      networks:\n        mailcow-network:\n          aliases:\n            - gogs\n      ports:\n        - \"${GOGS_SSH_PORT:-127.0.0.1:4000}:22\"\n</code></pre> <p>3. Erstelle <code>data/conf/nginx/site.gogs.custom</code>, füge hinzu: <pre><code>location /gogs/ {\n    proxy_pass http://gogs:3000/;\n}\n</code></pre></p> <p>4. Öffne <code>mailcow.conf</code> und definiere die Bindung, die Gogs für SSH verwenden soll. Beispiel:</p> <pre><code>GOGS_SSH_PORT=127.0.0.1:4000\n</code></pre> <p>5. Führen Sie folgenden Befehl aus, um den Gogs-Container hochzufahren und führen Sie anschließend einen Neustart von NGINX mit dem zweiten Befehl durch:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\ndocker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose up -d\ndocker-compose restart nginx-mailcow\n</code></pre> <p>6. Öffnen Sie <code>http://${MAILCOW_HOSTNAME}/gogs/</code>, zum Beispiel <code>http://mx.example.org/gogs/</code>. Für Datenbank-Details setzen Sie <code>mysql</code> als Datenbank-Host. Verwenden Sie gogs als Datenbankname, gogs als Datenbankbenutzer und your_strong_password als Datenbankpasswort, welches Sie in Schritt 1 definiert haben.</p> <p>7. Sobald die Installation abgeschlossen ist, loggen Sie sich als Administrator ein und setzen Sie \"Einstellungen\" -&gt; \"Autorisierung\" -&gt; \"SMTP aktivieren\". SMTP-Host sollte <code>postfix</code> mit Port <code>587</code> sein, setzen Sie <code>Skip TLS Verify</code>, da wir ein nicht gelistetes SAN verwenden (\"postfix\" ist höchstwahrscheinlich nicht Teil Ihres Zertifikats).</p> <p>8. Erstellen Sie <code>data/gogs/gogs/conf/app.ini</code> und setzen Sie die folgenden Werte. Sie können Gogs cheat sheet für ihre Bedeutung und andere mögliche Werte konsultieren.</p> <pre><code>[server]\nSSH_LISTEN_PORT = 22\n# Für GOGS_SSH_PORT=127.0.0.1:4000 in mailcow.conf, setzen:\nSSH_DOMAIN = 127.0.0.1\nSSH_PORT = 4000\n# Für MAILCOW_HOSTNAME=mx.example.org in mailcow.conf (und Standard-Ports für HTTPS), setzen:\nROOT_URL = https://mx.example.org/gogs/\n</code></pre> <p>9. Starten Sie Gogs neu mit dem kommenden Befehl. Ihre Nutzer sollten in der Lage sein, sich mit von mailcow verwalteten Konten anzumelden.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart gogs-mailcow\n</code></pre> <pre><code>docker-compose restart gogs-mailcow\n</code></pre>","path":["Third party gogs.de"],"tags":[]},{"location":"de/third_party/gogs/third_party-gogs.en/","level":1,"title":"Third party gogs.en","text":"<p>With Gogs' ability to authenticate over SMTP it is trivial to integrate it with mailcow. Few changes are needed:</p> <p>1. In order to create a database for Gogs, connect to your shell and execute the following commands: <pre><code>source mailcow.conf\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE DATABASE gogs;\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE USER 'gogs'@'%' IDENTIFIED BY 'your_strong_password';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"GRANT ALL PRIVILEGES ON gogs.* TO 'gogs'@'%';\n</code></pre></p> <p>2. Open <code>docker-compose.override.yml</code> and add Gogs:</p> <pre><code>services:\n\n    gogs-mailcow:\n      image: gogs/gogs\n      volumes:\n        - ./data/gogs:/data\n      networks:\n        mailcow-network:\n          aliases:\n            - gogs\n      ports:\n        - \"${GOGS_SSH_PORT:-127.0.0.1:4000}:22\"\n</code></pre> <p>3. Create <code>data/conf/nginx/site.gogs.custom</code>, add: <pre><code>location /gogs/ {\n    proxy_pass http://gogs:3000/;\n}\n</code></pre></p> <p>4. Open <code>mailcow.conf</code> and define the binding you want Gogs to use for SSH. Example:</p> <pre><code>GOGS_SSH_PORT=127.0.0.1:4000\n</code></pre> <p>5. Run the commands to bring up the Gogs container and restart the nginx-mailcow container afterwards:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\ndocker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose up -d\ndocker-compose restart nginx-mailcow\n</code></pre> <p>6. Open <code>http://${MAILCOW_HOSTNAME}/gogs/</code>, for example <code>http://mx.example.org/gogs/</code>. For database details set <code>mysql</code> as database host. Use the value gogs as database name, gogs as database user and your_strong_password you previously definied at step 1 as database password.</p> <p>7. Once the installation is complete, login as admin and set \"settings\" -&gt; \"authorization\" -&gt; \"enable SMTP\". SMTP Host should be <code>postfix</code> with port <code>587</code>, set <code>Skip TLS Verify</code> as we are using an unlisted SAN (\"postfix\" is most likely not part of your certificate).</p> <p>8. Create <code>data/gogs/gogs/conf/app.ini</code> and set following values. You can consult Gogs cheat sheet for their meaning and other possible values.</p> <pre><code>[server]\nSSH_LISTEN_PORT = 22\n# For GOGS_SSH_PORT=127.0.0.1:4000 in mailcow.conf, set:\nSSH_DOMAIN = 127.0.0.1\nSSH_PORT = 4000\n# For MAILCOW_HOSTNAME=mx.example.org in mailcow.conf (and default ports for HTTPS), set:\nROOT_URL = https://mx.example.org/gogs/\n</code></pre> <p>9. Restart Gogs with the following command. Your users should be able to login with mailcow managed accounts.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart gogs-mailcow\n</code></pre> <pre><code>docker-compose restart gogs-mailcow\n</code></pre>","path":["Third party gogs.en"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/","level":1,"title":"Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen","text":"<p>Info</p> <p>Diese Anleitung ist eine Kopie von dockerized-mailcow-mailman. Bitte posten Sie Probleme, Fragen und Verbesserungen in den issue tracker dort.</p> <p>Warnung</p> <p>mailcow ist nicht verantwortlich für Datenverlust, Hardwareschäden oder kaputte Tastaturen. Diese Anleitung kommt ohne jegliche Garantie. Macht Backups bevor ihr anfangt, Kein Backup kein Mitleid!</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#einleitung","level":2,"title":"Einleitung","text":"<p>Diese Anleitung zielt darauf ab, mailcow-dockerized mit [docker-mailman] (https://github.com/maxking/docker-mailman) zu installieren und zu konfigurieren und einige nützliche Skripte bereitzustellen. Eine wesentliche Bedingung ist, dass mailcow und Mailman in ihren eigenen Installationen für unabhängige Updates erhalten bleiben.</p> <p>Es gibt einige Anleitungen und Projekte im Internet, aber sie sind nicht auf dem neuesten Stand und/oder unvollständig in der Dokumentation oder Konfiguration. Diese Anleitung basiert auf der Arbeit von:</p> <ul> <li>mailcow-mailman3-dockerized von Shadowghost</li> <li>mailman-mailcow-integration</li> </ul> <p>Nach Beendigung dieser Anleitung werden mailcow-dockerized und docker-mailman laufen und Apache als Reverse-Proxy wird die Web-Frontends bedienen.</p> <p>Das verwendete Betriebssystem ist ein Ubuntu 20.04 LTS.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#installation","level":2,"title":"Installation","text":"<p>Diese Anleitung basiert auf verschiedenen Schritten:</p> <ol> <li>DNS-Einrichtung</li> <li>Installieren Sie Apache als Reverse Proxy</li> <li>Beziehen Sie SSL-Zertifikate mit Let's Encrypt.</li> <li>Installieren Sie mailcow mit Mailman Integration</li> <li>Installieren Sie Mailman.</li> <li>🏃 Ausführen</li> </ol>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#dns-einrichtung","level":3,"title":"DNS-Einrichtung","text":"<p>Der größte Teil der Konfiguration ist in mailcows DNS Konfiguration enthalten. Nachdem diese Einrichtung abgeschlossen ist, fügen Sie eine weitere Subdomain für Mailman hinzu, z.B. <code>lists.example.org</code>, die auf denselben Server zeigt:</p> <pre><code># Name Typ Wert\nlists IN A 1.2.3.4\nlists IN AAAA dead:beef\n</code></pre>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#installieren-sie-apache-als-reverse-proxy","level":3,"title":"Installieren Sie Apache als Reverse Proxy","text":"<p>Installieren Sie Apache, z.B. mit dieser Anleitung von Digital Ocean: How To Install the Apache Web Server on Ubuntu 20.04 (Englisch).</p> <p>Aktivieren Sie bestimmte Apache Module (als root oder sudo):</p> <pre><code>a2enmod rewrite proxy proxy_http headers ssl wsgi proxy_uwsgi http2\n</code></pre> <p>Möglicherweise müssen Sie weitere Pakete installieren, um diese Module zu erhalten. Dieses PPA von Ondřej Surý könnte Ihnen helfen.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#vhost-konfiguration","level":4,"title":"vHost-Konfiguration","text":"<p>Kopieren Sie die mailcow.conf und die mailman.conf in den Apache conf Ordner <code>sites-available</code> (z.B. unter <code>/etc/apache2/sites-available</code>).</p> <p>Änderung in <code>mailcow.conf</code>: - <code>MAILCOW_HOSTNAME</code> zu Ihrem MAILCOW_HOSTNAME</p> <p>Änderung in <code>mailman.conf</code>: - <code>MAILMAN_DOMAIN</code> in Ihre Mailman-Domain (z.B. <code>Lists.example.org</code>)</p> <p>**Aktivieren Sie die Konfiguration noch nicht, da die ssl-Zertifikate und Verzeichnisse noch fehlen.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#beziehen-sie-ssl-zertifikate-mit-lets-encrypt","level":3,"title":"Beziehen Sie SSL-Zertifikate mit Let's Encrypt.","text":"<p>Prüfen Sie, ob Ihre DNS-Konfiguration über das Internet verfügbar ist und auf die richtigen IP-Adressen zeigt, z.B. mit MXToolBox:</p> <ul> <li>https://mxtoolbox.com/SuperTool.aspx?action=a%3aMAILCOW_HOSTNAME</li> <li>https://mxtoolbox.com/SuperTool.aspx?action=aaaa%3aMAILCOW_HOSTNAME</li> <li>https://mxtoolbox.com/SuperTool.aspx?action=a%3aMAILMAN_DOMAIN</li> <li>https://mxtoolbox.com/SuperTool.aspx?action=aaaa%3aMAILMAN_DOMAIN</li> </ul> <p>Installieren Sie certbot (als root oder sudo):</p> <pre><code>apt install certbot\n</code></pre> <p>Holen Sie sich die gewünschten Zertifikate (als root oder sudo):</p> <pre><code>certbot certonly -d mailcow_HOSTNAME\ncertbot certonly -d MAILMAN_DOMAIN\n</code></pre>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#installieren-sie-mailcow-mit-mailman-integration","level":3,"title":"Installieren Sie mailcow mit Mailman Integration","text":"","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#installieren-sie-mailcow","level":4,"title":"Installieren Sie mailcow","text":"<p>Folgen Sie der mailcow installation. Schritt 5 auslassen und nicht mit starten!</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#mailcow-konfigurieren","level":4,"title":"mailcow konfigurieren","text":"<p>Dies ist auch Schritt 4 in der offiziellen mailcow-Installation (<code>nano mailcow.conf</code>). Passen Sie also Ihre Bedürfnisse an und ändern Sie die folgenden Variablen:</p> <pre><code>HTTP_PORT=18080 # verwenden Sie nicht 8080, da mailman es braucht\nHTTP_BIND=127.0.0.1 #\nHTTPS_PORT=18443 # Sie können 8443 verwenden\nHTTPS_BIND=127.0.0.1 # # HTTPS_BIND=127.0.0.1\n\nSKIP_LETS_ENCRYPT=y # Der Reverse Proxy wird die SSL-Verifizierung durchführen\n\nSNAT_TO_SOURCE=1.2.3.4 # ändern Sie dies in Ihre IPv4\nSNAT6_TO_SOURCE=dead:beef # Ändern Sie dies in Ihre globale IPv6\n</code></pre>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#mailman-integration-hinzufugen","level":4,"title":"Mailman-Integration hinzufügen","text":"<p>Erstelle die Datei <code>/opt/mailcow-dockerized/docker-compose.override.yml</code> (z.B. mit <code>nano</code>) und füge die folgenden Zeilen hinzu:</p> <pre><code>services:\n  postfix-mailcow:\n    volumes:\n      - /opt/mailman:/opt/mailman\n    networks:\n      - docker-mailman_mailman\n\nnetworks:\n  docker-mailman_mailman:\n    external: true\n</code></pre> <p>Das zusätzliche Volume wird von Mailman verwendet, um zusätzliche Konfigurationsdateien für mailcow postfix zu generieren. Das externe Netzwerk wird von Mailman erstellt und verwendet. mailcow benötigt es, um eingehende Listenmails an Mailman zu liefern.</p> <p>Erstellen Sie die Datei <code>/opt/mailcow-dockerized/data/conf/postfix/extra.cf</code> (z.B. mit <code>nano</code>) und fügen Sie die folgenden Zeilen hinzu:</p> <pre><code># mailman\n\nrecipient_delimiter = +\nunknown_local_recipient_reject_code = 550\nowner_request_special = no\n\nlocal_recipient_maps =\n  regexp:/opt/mailman/core/var/data/postfix_lmtp,\n  proxy:unix:passwd.byname,\n  $alias_maps\nvirtual_mailbox_maps =\n  proxy:mysql:/opt/postfix/conf/sql/mysql_virtual_mailbox_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_lmtp\ntransport_maps =\n  pcre:/opt/postfix/conf/custom_transport.pcre,\n  pcre:/opt/postfix/conf/local_transport,\n  proxy:mysql:/opt/postfix/conf/sql/mysql_relay_ne.cf,\n  proxy:mysql:/opt/postfix/conf/sql/mysql_transport_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_lmtp\nrelay_domains =\n  proxy:mysql:/opt/postfix/conf/sql/mysql_virtual_relay_domain_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_domains\nrelay_recipient_maps =\n  proxy:mysql:/opt/postfix/conf/sql/mysql_relay_recipient_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_lmtp\n</code></pre> <p>Da wir hier die mailcow postfix Konfiguration überschreiben, kann dieser Schritt Ihre normalen Mailtransporte unterbrechen. Überprüfen Sie die originalen Konfigurationsdateien, wenn sich etwas geändert hat.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#ssl-zertifikate","level":4,"title":"SSL-Zertifikate","text":"<p>Da wir mailcow als Proxy verwenden, müssen wir die SSL-Zertifikate in die mailcow-Dateistruktur kopieren. Diese Aufgabe wird das Skript renew-ssl.sh für uns erledigen:</p> <ul> <li>Kopieren Sie die Datei nach <code>/opt/mailcow-dockerized</code></li> <li>Ändere mailcow_HOSTNAME in deinen mailcow Hostnamen</li> <li>Machen Sie es ausführbar (<code>chmod a+x renew-ssl.sh</code>)</li> <li>Noch nicht ausführen, da wir zuerst Mailman benötigen</li> </ul> <p>Sie müssen einen cronjob erstellen, so dass neue Zertifikate kopiert werden. Führen Sie ihn als root oder sudo aus:</p> <pre><code>crontab -e\n</code></pre> <p>Um das Skript jeden Tag um 5 Uhr morgens laufen zu lassen, fügen Sie hinzu:</p> <pre><code>0 5 * * * /opt/mailcow-dockerized/renew-ssl.sh\n</code></pre>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#installieren-sie-mailman","level":3,"title":"Installieren Sie Mailman.","text":"<p>Befolgen Sie im Wesentlichen die Anweisungen unter docker-mailman. Da sie sehr umfangreich sind, ist hier in aller Kürze beschrieben, was zu tun ist:</p> <p>Als root oder sudo:</p> <pre><code>cd /opt\nmkdir -p mailman/core\nmkdir -p mailman/web\ngit clone https://github.com/maxking/docker-mailman\ncd docker-mailman\n</code></pre>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#mailman-konfigurieren","level":4,"title":"Mailman konfigurieren","text":"<p>Erstellen Sie einen langen Schlüssel für Hyperkitty, z.B. mit dem Linux-Befehl <code>cat /dev/urandom | tr -dc a-zA-Z0-9 | head -c30; echo</code>. Speichern Sie diesen Schlüssel vorerst als HYPERKITTY_KEY.</p> <p>Erstellen Sie ein langes Passwort für die Datenbank, z. B. mit dem Linux-Befehl <code>cat /dev/urandom | tr -dc a-zA-Z0-9 | head -c30; echo</code>. Speichern Sie dieses Passwort zunächst als DBPASS.</p> <p>Erstellen Sie einen langen Schlüssel für Django, z. B. mit dem Linux-Befehl <code>cat /dev/urandom | tr -dc a-zA-Z0-9 | head -c30; echo</code>. Speichern Sie diesen Schlüssel für einen Moment als DJANGO_KEY.</p> <p>Erstellen Sie die Datei <code>/opt/docker-mailman/docker compose.override.yaml</code> und ersetzen Sie <code>HYPERKITTY_KEY</code>, <code>DBPASS</code> und <code>DJANGO_KEY</code> durch die generierten Werte:</p> <pre><code>services:\n  mailman-core:\n    environment:\n    - DATABASE_URL=postgresql://mailman:DBPASS@database/mailmandb\n    - HYPERKITTY_API_KEY=HYPERKITTY_KEY\n    - TZ=Europe/Berlin\n    - MTA=postfix\n    restart: always\n    networks:\n      - mailman\n\n  mailman-web:\n    environment:\n    - DATABASE_URL=postgresql://mailman:DBPASS@database/mailmandb\n    - HYPERKITTY_API_KEY=HYPERKITTY_KEY\n    - TZ=Europe/Berlin\n    - SECRET_KEY=DJANGO_KEY\n    - SERVE_FROM_DOMAIN=MAILMAN_DOMAIN # e.g. lists.example.org\n    - MAILMAN_ADMIN_USER=admin # the admin user\n    - MAILMAN_ADMIN_EMAIL=admin@example.org # the admin mail address\n    - UWSGI_STATIC_MAP=/static=/opt/mailman-web-data/static\n    restart: always\n\n  database:\n    environment:\n    - POSTGRES_PASSWORD=DBPASS\n    restart: always\n</code></pre> <p>Bei <code>mailman-web</code> geben Sie die korrekten Werte für <code>SERVE_FROM_DOMAIN</code> (z.B. <code>lists.example.org</code>), <code>MAILMAN_ADMIN_USER</code> und <code>MAILMAN_ADMIN_EMAIL</code> ein. Sie benötigen die Admin-Zugangsdaten, um sich in der Web-Oberfläche (Pistorius) anzumelden. Um das Passwort zum ersten Mal zu setzen, verwenden Sie die Funktion Passwort vergessen im Webinterface.</p> <p>Über andere Konfigurationsoptionen lesen Sie die Dokumentationen Mailman-web und Mailman-core.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#konfigurieren-sie-mailman-core-und-mailman-web","level":4,"title":"Konfigurieren Sie Mailman core und Mailman web","text":"<p>Erstellen Sie die Datei <code>/opt/mailman/core/mailman-extra.cfg</code> mit dem folgenden Inhalt. <code>mailman@example.org</code> sollte auf ein gültiges Postfach oder eine Umleitung verweisen.</p> <pre><code>[mailman]\ndefault_language: de\nsite_owner: mailman@example.org\n</code></pre> <p>Erstellen Sie die Datei <code>/opt/mailman/web/settings_local.py</code> mit dem folgenden Inhalt. <code>mailman@example.org</code> sollte auf ein gültiges Postfach oder eine Umleitung verweisen.</p> <p><pre><code># Gebietsschema\nLANGUAGE_CODE = 'de-de'\n\n# soziale Authentifizierung deaktivieren\nMAILMAN_WEB_SOCIAL_AUTH = []\n\n# ändern\nDEFAULT_FROM_EMAIL = 'mailman@example.org'\n\nDEBUG = False\n</code></pre> Sie können <code>LANGUAGE_CODE</code> und <code>SOCIALACCOUNT_PROVIDERS</code> an Ihre Bedürfnisse anpassen.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#ausfuhren","level":3,"title":"🏃 Ausführen","text":"<p>Ausführen (als root oder sudo)</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>a2ensite mailcow.conf\na2ensite mailman.conf\nsystemctl restart apache2\n\ncd /opt/docker-mailman\ndocker compose pull\ndocker compose up -d\n\ncd /opt/mailcow-dockerized/\ndocker compose pull\n./renew-ssl.sh\n</code></pre> <pre><code>a2ensite mailcow.conf\na2ensite mailman.conf\nsystemctl restart apache2\n\ncd /opt/docker-mailman\ndocker-compose pull\ndocker-compose up -d\n\ncd /opt/mailcow-dockerized/\ndocker-compose pull\n./renew-ssl.sh\n</code></pre> <p>Warten Sie ein paar Minuten! Die Container müssen ihre Datenbanken und Konfigurationsdateien erstellen. Dies kann bis zu 1 Minute und mehr dauern.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#bemerkungen","level":2,"title":"Bemerkungen","text":"","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#neue-listen-werden-von-postfix-nicht-sofort-erkannt","level":3,"title":"Neue Listen werden von Postfix nicht sofort erkannt","text":"<p>Wenn man eine neue Liste anlegt und versucht, sofort eine E-Mail zu versenden, antwortet postfix mit <code>Benutzer existiert nicht</code>, weil postfix die Liste noch nicht an Mailman übergeben hat. Die Konfiguration unter <code>/opt/mailman/core/var/data/postfix_lmtp</code> wird nicht sofort aktualisiert. Wenn Sie die Liste sofort benötigen, starten Sie postifx manuell neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ndocker compose restart postfix-mailcow\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ndocker-compose restart postfix-mailcow\n</code></pre>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#update","level":2,"title":"Update","text":"<p>mailcow hat sein eigenes Update-Skript in <code>/opt/mailcow-dockerized/update.sh</code>, siehe die Dokumentation.</p> <p>Für Mailman holen Sie sich einfach die neueste Version aus dem github repository.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#sicherung","level":2,"title":"Sicherung","text":"<p>mailcow hat ein eigenes Backup-Skript. Lies die Docs für weitere Informationen.</p> <p>Mailman gibt keine Backup-Anweisungen in der README.md an. Im gitbucket von pgollor befindet sich ein Skript, das hilfreich sein könnte.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#todo","level":2,"title":"ToDo","text":"","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.de/#skript-installieren","level":3,"title":"Skript installieren","text":"<p>Schreiben Sie ein Skript wie in mailman-mailcow-integration/mailman-install.sh, da viele der Schritte automatisierbar sind.</p> <ol> <li>Fragen Sie alle Konfigurationsvariablen ab und erstellen Sie Passwörter und Schlüssel.</li> <li>Führen Sie eine (halb)automatische Installation durch.</li> <li>Viel Spaß!</li> </ol>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/","level":1,"title":"Installing mailcow and Mailman 3 based on dockerized versions","text":"<p>Info</p> <p>This guide is a copy from dockerized-mailcow-mailman. Please post issues, questions and improvements in the issue tracker there.</p> <p>Warning</p> <p>mailcow is not responsible for any data loss, hardware damage or broken keyboards. This guide comes without any warranty. Make backups before starting, 'coze: No backup no pity!</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#introduction","level":2,"title":"Introduction","text":"<p>This guide aims to install and configure mailcow-dockerized with docker-mailman and to provide some useful scripts. An essential condition is, to preserve mailcow and Mailman in their own installations for independent updates.</p> <p>There are some guides and projects on the internet, but they are not up to date and/or incomplete in documentation or configuration. This guide is based on the work of:</p> <ul> <li>mailcow-mailman3-dockerized by Shadowghost</li> <li>mailman-mailcow-integration</li> </ul> <p>After finishing this guide, mailcow-dockerized and docker-mailman will run and Apache as a reverse proxy will serve the web frontends.</p> <p>The operating system used is an Ubuntu 20.04 LTS.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#installation","level":2,"title":"Installation","text":"<p>This guide is based on different steps:</p> <ol> <li>DNS setup</li> <li>Install Apache as a reverse proxy</li> <li>Obtain SSL certificates with Let's Encrypt</li> <li>Install mailcow with Mailman integration</li> <li>Install Mailman</li> <li>🏃 Run</li> </ol>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#dns-setup","level":3,"title":"DNS setup","text":"<p>Most of the configuration is covered by mailcows DNS setup. After finishing this setup add another subdomain for Mailman, e.g. <code>lists.example.org</code> that points to the same server:</p> <pre><code># Name    Type       Value\nlists     IN A       1.2.3.4\nlists     IN AAAA    dead:beef\n</code></pre>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#install-apache-as-a-reverse-proxy","level":3,"title":"Install Apache as a reverse proxy","text":"<p>Install Apache, e.g. with this guide from Digital Ocean: How To Install the Apache Web Server on Ubuntu 20.04.</p> <p>Activate certain Apache modules (as root or sudo):</p> <pre><code>a2enmod rewrite proxy proxy_http headers ssl wsgi proxy_uwsgi http2\n</code></pre> <p>Maybe you have to install further packages to get these modules. This PPA by Ondřej Surý may help you.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#vhost-configuration","level":4,"title":"vHost configuration","text":"<p>Copy the mailcow.conf and the mailman.conf in the Apache conf folder <code>sites-available</code> (e.g. under <code>/etc/apache2/sites-available</code>).</p> <p>Change in <code>mailcow.conf</code>: - <code>MAILCOW_HOSTNAME</code> to your MAILCOW_HOSTNAME</p> <p>Change in <code>mailman.conf</code>: - <code>MAILMAN_DOMAIN</code> to your Mailman domain (e.g. <code>lists.example.org</code>)</p> <p>Don't activate the configuration, as the ssl certificates and directories are missing yet.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#obtain-ssl-certificates-with-lets-encrypt","level":3,"title":"Obtain SSL certificates with Let's Encrypt","text":"<p>Check if your DNS config is available over the internet and points to the right IP addresses, e.g. with MXToolBox:</p> <ul> <li>https://mxtoolbox.com/SuperTool.aspx?action=a%3aMAILCOW_HOSTNAME</li> <li>https://mxtoolbox.com/SuperTool.aspx?action=aaaa%3aMAILCOW_HOSTNAME</li> <li>https://mxtoolbox.com/SuperTool.aspx?action=a%3aMAILMAN_DOMAIN</li> <li>https://mxtoolbox.com/SuperTool.aspx?action=aaaa%3aMAILMAN_DOMAIN</li> </ul> <p>Install certbot (as root or sudo):</p> <pre><code>apt install certbot\n</code></pre> <p>Get the desired certificates (as root or sudo):</p> <pre><code>certbot certonly -d MAILCOW_HOSTNAME\ncertbot certonly -d MAILMAN_DOMAIN\n</code></pre>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#install-mailcow-with-mailman-integration","level":3,"title":"Install mailcow with Mailman integration","text":"","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#install-mailcow","level":4,"title":"Install mailcow","text":"<p>Follow the mailcow installation. Omit step 5 and do not pull and start!</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#configure-mailcow","level":4,"title":"Configure mailcow","text":"<p>This is also Step 4 in the official mailcow installation (<code>nano mailcow.conf</code>). So change to your needs and alter the following variables:</p> <pre><code>HTTP_PORT=18080            # don't use 8080 as mailman needs it\nHTTP_BIND=127.0.0.1        #\nHTTPS_PORT=18443           # you may use 8443\nHTTPS_BIND=127.0.0.1       #\n\nSKIP_LETS_ENCRYPT=y        # reverse proxy will do the SSL termination\n\nSNAT_TO_SOURCE=1.2.3.4     # change this to your IPv4\nSNAT6_TO_SOURCE=dead:beef  # change this to your global IPv6\n</code></pre>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#add-mailman-integration","level":4,"title":"Add Mailman integration","text":"<p>Create the file <code>/opt/mailcow-dockerized/docker-compose.override.yml</code> (e.g. with <code>nano</code>) and add the following lines:</p> <p><pre><code>services:\n  postfix-mailcow:\n    volumes:\n      - /opt/mailman:/opt/mailman\n    networks:\n      - docker-mailman_mailman\n\nnetworks:\n  docker-mailman_mailman:\n    external: true\n</code></pre> The additional volume is used by Mailman to generate additional config files for mailcow postfix. The external network is build and used by Mailman. mailcow needs it to deliver incoming list mails to Mailman.</p> <p>Create the file <code>/opt/mailcow-dockerized/data/conf/postfix/extra.cf</code> (e.g. with <code>nano</code>) and add the following lines:</p> <p><pre><code># mailman\n\nrecipient_delimiter = +\nunknown_local_recipient_reject_code = 550\nowner_request_special = no\n\nlocal_recipient_maps =\n  regexp:/opt/mailman/core/var/data/postfix_lmtp,\n  proxy:unix:passwd.byname,\n  $alias_maps\nvirtual_mailbox_maps =\n  proxy:mysql:/opt/postfix/conf/sql/mysql_virtual_mailbox_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_lmtp\ntransport_maps =\n  pcre:/opt/postfix/conf/custom_transport.pcre,\n  pcre:/opt/postfix/conf/local_transport,\n  proxy:mysql:/opt/postfix/conf/sql/mysql_relay_ne.cf,\n  proxy:mysql:/opt/postfix/conf/sql/mysql_transport_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_lmtp\nrelay_domains =\n  proxy:mysql:/opt/postfix/conf/sql/mysql_virtual_relay_domain_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_domains\nrelay_recipient_maps =\n  proxy:mysql:/opt/postfix/conf/sql/mysql_relay_recipient_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_lmtp\n</code></pre> As we overwrite mailcow postfix configuration here, this step may break your normal mail transports. Check the original configuration files if anything changed.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#ssl-certificates","level":4,"title":"SSL certificates","text":"<p>As we proxying mailcow, we need to copy the SSL certificates into the mailcow file structure. This task will do the script renew-ssl.sh for us:</p> <ul> <li>Copy the file to <code>/opt/mailcow-dockerized</code></li> <li>Change mailcow_HOSTNAME to your mailcow hostname</li> <li>Make it executable (<code>chmod a+x renew-ssl.sh</code>)</li> <li>Do not run it yet, as we first need Mailman</li> </ul> <p>You have to create a cronjob, so that new certificates will be copied. Execute as root or sudo:</p> <pre><code>crontab -e\n</code></pre> <p>To run the script every day at 5am, add:</p> <pre><code>0   5  *   *   *     /opt/mailcow-dockerized/renew-ssl.sh\n</code></pre>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#install-mailman","level":3,"title":"Install Mailman","text":"<p>Basicly follow the instructions at docker-mailman. As they are a lot, here is in a nuthshell what to do:</p> <p>As root or sudo:</p> <pre><code>cd /opt\nmkdir -p mailman/core\nmkdir -p mailman/web\ngit clone https://github.com/maxking/docker-mailman\ncd docker-mailman\n</code></pre>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#configure-mailman","level":4,"title":"Configure Mailman","text":"<p>Create a long key for Hyperkitty, e.g. with the linux command <code>cat /dev/urandom | tr -dc a-zA-Z0-9 | head -c30; echo</code>. Save this key for a moment as HYPERKITTY_KEY.</p> <p>Create a long password for the database, e.g. with the linux command <code>cat /dev/urandom | tr -dc a-zA-Z0-9 | head -c30; echo</code>. Save this password for a moment as DBPASS.</p> <p>Create a long key for Django, e.g. with the linux command <code>cat /dev/urandom | tr -dc a-zA-Z0-9 | head -c30; echo</code>. Save this key for a moment as DJANGO_KEY.</p> <p>Create the file <code>/opt/docker-mailman/docker compose.override.yaml</code> and replace <code>HYPERKITTY_KEY</code>, <code>DBPASS</code> and <code>DJANGO_KEY</code> with the generated values:</p> <pre><code>services:\n  mailman-core:\n    environment:\n    - DATABASE_URL=postgresql://mailman:DBPASS@database/mailmandb\n    - HYPERKITTY_API_KEY=HYPERKITTY_KEY\n    - TZ=Europe/Berlin\n    - MTA=postfix\n    restart: always\n    networks:\n      - mailman\n\n  mailman-web:\n    environment:\n    - DATABASE_URL=postgresql://mailman:DBPASS@database/mailmandb\n    - HYPERKITTY_API_KEY=HYPERKITTY_KEY\n    - TZ=Europe/Berlin\n    - SECRET_KEY=DJANGO_KEY\n    - SERVE_FROM_DOMAIN=MAILMAN_DOMAIN # e.g. lists.example.org\n    - MAILMAN_ADMIN_USER=admin # the admin user\n    - MAILMAN_ADMIN_EMAIL=admin@example.org # the admin mail address\n    - UWSGI_STATIC_MAP=/static=/opt/mailman-web-data/static\n    restart: always\n\n  database:\n    environment:\n    - POSTGRES_PASSWORD=DBPASS\n    restart: always\n</code></pre> <p>At <code>mailman-web</code> fill in correct values for <code>SERVE_FROM_DOMAIN</code> (e.g. <code>lists.example.org</code>), <code>MAILMAN_ADMIN_USER</code> and <code>MAILMAN_ADMIN_EMAIL</code>. You need the admin credentials to log into the web interface (Postorius). For setting the password for the first time use the Forgot password function in the web interface.</p> <p>About other configuration options read Mailman-web and Mailman-core documentation.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#configure-mailman-core-and-mailman-web","level":4,"title":"Configure Mailman core and Mailman web","text":"<p>Create the file <code>/opt/mailman/core/mailman-extra.cfg</code> with the following content. <code>mailman@example.org</code> should be pointing to a valid mail box or redirection.</p> <pre><code>[mailman]\ndefault_language: de\nsite_owner: mailman@example.org\n</code></pre> <p>Create the file <code>/opt/mailman/web/settings_local.py</code> with the following content. <code>mailman@example.org</code> should be pointing to a valid mail box or redirection.</p> <p><pre><code># locale\nLANGUAGE_CODE = 'de-de'\n\n# disable social authentication\nMAILMAN_WEB_SOCIAL_AUTH = []\n\n# change it\nDEFAULT_FROM_EMAIL = 'mailman@example.org'\n\nDEBUG = False\n</code></pre> You can change <code>LANGUAGE_CODE</code> and <code>SOCIALACCOUNT_PROVIDERS</code> to your needs.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#run","level":3,"title":"🏃 Run","text":"<p>Run (as root or sudo)</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>a2ensite mailcow.conf\na2ensite mailman.conf\nsystemctl restart apache2\n\ncd /opt/docker-mailman\ndocker compose pull\ndocker compose up -d\n\ncd /opt/mailcow-dockerized/\ndocker compose pull\n./renew-ssl.sh\n</code></pre> <pre><code>a2ensite mailcow.conf\na2ensite mailman.conf\nsystemctl restart apache2\n\ncd /opt/docker-mailman\ndocker-compose pull\ndocker-compose up -d\n\ncd /opt/mailcow-dockerized/\ndocker-compose pull\n./renew-ssl.sh\n</code></pre> <p>Wait a few minutes! The containers have to create there databases and config files. This can last up to 1 minute and more.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#remarks","level":2,"title":"Remarks","text":"","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#new-lists-arent-recognized-by-postfix-instantly","level":3,"title":"New lists aren't recognized by postfix instantly","text":"<p>When you create a new list and try to immediately send an e-mail, postfix responses with <code>User doesn't exist</code>, because postfix won't deliver it to Mailman yet. The configuration at <code>/opt/mailman/core/var/data/postfix_lmtp</code> is not instantly updated. If you need the list instantly, restart postifx manually:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ndocker compose restart postfix-mailcow\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ndocker-compose restart postfix-mailcow\n</code></pre>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#update","level":2,"title":"Update","text":"<p>mailcow has it's own update script in <code>/opt/mailcow-dockerized/update.sh</code>, see the docs.</p> <p>For Mailman just fetch the newest version from the github repository.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#backup","level":2,"title":"Backup","text":"<p>mailcow has an own backup script. Read the docs for further informations.</p> <p>Mailman won't state backup instructions in the README.md. In the gitbucket of pgollor is a script that may be helpful.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#todo","level":2,"title":"ToDo","text":"","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailman3/third_party-mailman3.en/#install-script","level":3,"title":"install script","text":"<p>Write a script like in mailman-mailcow-integration/mailman-install.sh as many of the steps are automatable.</p> <ol> <li>Ask for all the configuration variables and create passwords and keys.</li> <li>Do a (semi-)automatic installation.</li> <li>Have fun!</li> </ol>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"de/third_party/mailpiler/third_party-mailpiler_integration.de/","level":1,"title":"Third party mailpiler integration.de","text":"<p>Dies ist eine einfache Integration von mailcow-Aliasen und dem Mailbox-Namen in mailpiler bei Verwendung von IMAP-Authentifizierung.</p> <p>Disclaimer: Dies wird weder offiziell vom mailcow-Projekt noch von seinen Mitwirkenden gepflegt oder unterstützt. Es wird keine Garantie oder Unterstützung angeboten, jedoch steht es Ihnen frei, Themen auf GitHub zu öffnen, um einen Fehler zu melden oder weitere Ideen zu liefern. GitHub Repo kann hier gefunden werden.</p> <p>Info</p> <p>Die Unterstützung für Domain Wildcards wurde in Piler 1.3.10 implementiert, das am 03.01.2021 veröffentlicht wurde. Frühere Versionen funktionieren grundsätzlich, aber nach dem Einloggen sehen Sie keine E-Mails, die von oder an den Domain-Alias gesendet werden. (z.B. wenn @example.com ein Alias für admin@example.com ist)</p>","path":["Third party mailpiler integration.de"],"tags":[]},{"location":"de/third_party/mailpiler/third_party-mailpiler_integration.de/#das-zu-losende-problem","level":2,"title":"Das zu lösende Problem","text":"<p>mailpiler bietet die Authentifizierung auf Basis von IMAP an, zum Beispiel:</p> <pre><code>$config['ENABLE_IMAP_AUTH'] = 1;\n$config['IMAP_HOST'] = 'mail.example.com';\n$config['IMAP_PORT'] = 993;\n$config['IMAP_SSL'] = true;\n</code></pre> <ul> <li>Wenn Sie sich also mit <code>patrik@example.com</code> anmelden, sehen Sie nur zugestellte E-Mails, die von oder an diese spezielle E-Mail-Adresse gesendet wurden.</li> <li>Wenn zusätzliche Aliase in mailcow definiert werden, wie z.B. <code>team@example.com</code>, werden Sie keine Emails sehen, die an oder von dieser Email-Adresse gesendet wurden, auch wenn Sie ein Empfänger von Emails sind, die an diese Alias-Adresse gesendet wurden.</li> </ul> <p>Indem wir uns in den Authentifizierungsprozess von mailpiler einklinken, sind wir in der Lage, die erforderlichen Daten über die mailcow API während des Logins zu erhalten. Dies löst API-Anfragen an die mailcow-API aus (die einen Nur-Lese-API-Zugang erfordern), um die Aliase auszulesen, an denen Ihre E-Mail-Adresse teilnimmt, und auch den \"Namen\" des Postfachs, der angegeben wurde, um ihn nach dem Login oben rechts in mailpiler anzuzeigen.</p> <p>Zugelassene E-Mail-Adressen können in den Mailpiler-Einstellungen oben rechts nach dem Einloggen eingesehen werden.</p> <p>Info</p> <p>Dies wird nur einmal während des Authentifizierungsprozesses abgefragt. Die autorisierten Aliase und der Realname sind für die gesamte Dauer der Benutzersitzung gültig, da mailpiler sie in den Sitzungsdaten setzt. Wird ein Benutzer aus einem bestimmten Alias entfernt, so wird dies erst nach dem nächsten Login wirksam.</p>","path":["Third party mailpiler integration.de"],"tags":[]},{"location":"de/third_party/mailpiler/third_party-mailpiler_integration.de/#die-losung","level":2,"title":"Die Lösung","text":"<p>Hinweis: Die Dateipfade können je nach Einrichtung variieren.</p>","path":["Third party mailpiler integration.de"],"tags":[]},{"location":"de/third_party/mailpiler/third_party-mailpiler_integration.de/#voraussetzungen","level":3,"title":"Voraussetzungen","text":"<ul> <li>Eine funktionierende mailcow-Instanz</li> <li>Eine funktionierende mailpiler Instanz (Sie finden eine Installationsanleitung hier, überprüfen Sie unterstützte Versionen hier)</li> <li>Ein mailcow API-Schlüssel (Nur-Lesen funktioniert): <code>Konfiguration &amp; Details - Zugang - Nur-Lesen-Zugang</code>. Vergessen Sie nicht, den API-Zugang von Ihrer mailpiler IP zu erlauben.</li> </ul> <p>Warnung</p> <p>Da mailpiler sich gegenüber mailcow, unserem IMAP-Server, authentifiziert, können fehlgeschlagene Logins von Nutzern oder Bots eine Sperre für Ihre mailpiler-Instanz auslösen. Daher sollten Sie in Erwägung ziehen, die IP-Adresse der mailpiler-Instanz innerhalb von mailcow auf eine Whitelist zu setzen: <code>Konfiguration &amp; Details - Konfiguration - Fail2ban-Parameter - Whitelisted networks/hosts</code>.</p>","path":["Third party mailpiler integration.de"],"tags":[]},{"location":"de/third_party/mailpiler/third_party-mailpiler_integration.de/#einrichtung","level":3,"title":"Einrichtung","text":"<ol> <li> <p>Setzen Sie die benutzerdefinierte Abfragefunktion von mailpiler und fügen Sie diese an <code>/usr/local/etc/piler/config-site.php</code> an:</p> <pre><code>$config['MAILCOW_API_KEY'] = 'YOUR_READONLY_API_KEY';\n$config['MAILCOW_SET_REALNAME'] = true; // wenn nicht angegeben, dann ist der Standardwert false\n$config['CUSTOM_EMAIL_QUERY_FUNCTION'] = 'query_mailcow_for_email_access';\ninclude('auth-mailcow.php');\n</code></pre> <p>Sie können auch den mailcow-Hostnamen ändern, falls erforderlich: <pre><code>$config['MAILCOW_HOST'] = 'mail.domain.tld'; // standardmäßig $config['IMAP_HOST']\n</code></pre></p> </li> <li> <p>Laden Sie die PHP-Datei mit den Funktionen aus dem GitHub Repo herunter:</p> <pre><code>curl -o /usr/local/etc/piler/auth-mailcow.php https://raw.githubusercontent.com/patschi/mailpiler-mailcow-integration/master/auth-mailcow.php\n</code></pre> </li> <li> <p>Erledigt!</p> </li> </ol> <p>Stellen Sie sicher, dass Sie sich erneut mit Ihren IMAP-Zugangsdaten anmelden, damit die Änderungen wirksam werden.</p> <p>Wenn es nicht funktioniert, ist höchstwahrscheinlich etwas mit der API-Abfrage selbst nicht in Ordnung. Versuchen Sie eine Fehlersuche, indem Sie manuelle API-Anfragen an die API senden. (Tipp: Öffnen Sie <code>https://mail.domain.tld/api</code> auf Ihrer Instanz)</p>","path":["Third party mailpiler integration.de"],"tags":[]},{"location":"de/third_party/mailpiler/third_party-mailpiler_integration.en/","level":1,"title":"Third party mailpiler integration.en","text":"<p>This is a simple integration of mailcow aliases and the mailbox name into mailpiler when using IMAP authentication.</p> <p>Disclaimer: This is not officially maintained nor supported by the mailcow project nor its contributors. No warranty or support is being provided, however you're free to open issues on GitHub for filing a bug or provide further ideas. GitHub repo can be found here.</p> <p>Info</p> <p>Support for domain wildcards were implemented in Piler 1.3.10 which was released on 03.01.2021. Prior versions basically do work, but after logging in you won't see emails sent from or to the domain alias. (e.g. when @example.com is an alias for admin@example.com)</p>","path":["Third party mailpiler integration.en"],"tags":[]},{"location":"de/third_party/mailpiler/third_party-mailpiler_integration.en/#the-problem-to-solve","level":2,"title":"The problem to solve","text":"<p>mailpiler offers the authentication based on IMAP, for example:</p> <pre><code>$config['ENABLE_IMAP_AUTH'] = 1;\n$config['IMAP_HOST'] = 'mail.example.com';\n$config['IMAP_PORT'] =  993;\n$config['IMAP_SSL'] = true;\n</code></pre> <ul> <li>So when you log in using <code>patrik@example.com</code>, you will only see delivered emails sent from or to this specific email address.</li> <li>When additional aliases are defined in mailcow, like <code>team@example.com</code>, you won't see emails sent to or from this email address even the fact you're a recipient of mails sent to this alias address.</li> </ul> <p>By hooking into the authentication process of mailpiler, we are able to get required data via the mailcow API during login. This fires API requests to the mailcow API (requiring read-only API access) to read out the aliases your email address participates and also the \"Name\" of the mailbox specified to display it on the top-right of mailpiler after login.</p> <p>Permitted email addresses can be seen in the mailpiler settings top-right after logging in.</p> <p>Info</p> <p>This is only pulled once during the authentication process. The authorized aliases and the realname are valid for the whole duration of the user session as mailpiler sets them in the session data. If user is removed from specific alias, this will only take effect after next login.</p>","path":["Third party mailpiler integration.en"],"tags":[]},{"location":"de/third_party/mailpiler/third_party-mailpiler_integration.en/#the-solution","level":2,"title":"The solution","text":"<p>Note: File paths might vary depending on your setup.</p>","path":["Third party mailpiler integration.en"],"tags":[]},{"location":"de/third_party/mailpiler/third_party-mailpiler_integration.en/#requirements","level":3,"title":"Requirements","text":"<ul> <li>A working mailcow instance</li> <li>A working mailpiler instance (You can find an installation guide here, check supported versions here)</li> <li>An mailcow API key (read-only works just fine): <code>Configuration &amp; Details - Access - Read-Only Access</code>. Don't forget to allow API access from your mailpiler IP.</li> </ul> <p>Warning</p> <p>As mailpiler authenticates against mailcow, our IMAP server, failed logins of users or bots might trigger a block for your mailpiler instance. Therefore you might want to consider whitelisting the IP address of the mailpiler instance within mailcow: <code>Configuration &amp; Details - Configuration - Fail2ban parameters - Whitelisted networks/hosts</code>.</p>","path":["Third party mailpiler integration.en"],"tags":[]},{"location":"de/third_party/mailpiler/third_party-mailpiler_integration.en/#setup","level":3,"title":"Setup","text":"<ol> <li> <p>Set the custom query function of mailpiler and append this to <code>/usr/local/etc/piler/config-site.php</code>:</p> <pre><code>$config['MAILCOW_API_KEY'] = 'YOUR_READONLY_API_KEY';\n$config['MAILCOW_SET_REALNAME'] = true; // when not specified, then default is false\n$config['CUSTOM_EMAIL_QUERY_FUNCTION'] = 'query_mailcow_for_email_access';\ninclude('auth-mailcow.php');\n</code></pre> <p>You can also change the mailcow hostname, if required: <pre><code>$config['MAILCOW_HOST'] = 'mail.domain.tld'; // defaults to $config['IMAP_HOST']\n</code></pre></p> </li> <li> <p>Download the PHP file with the functions from the GitHub repo:</p> <pre><code>curl -o /usr/local/etc/piler/auth-mailcow.php https://raw.githubusercontent.com/patschi/mailpiler-mailcow-integration/master/auth-mailcow.php\n</code></pre> </li> <li> <p>Done!</p> </li> </ol> <p>Make sure to re-login with your IMAP credentials for changes to take effect.</p> <p>If it doesn't work, most likely something's wrong with the API query itself. Consider debugging by sending manual API requests to the API. (Tip: Open <code>https://mail.domain.tld/api</code> on your instance)</p>","path":["Third party mailpiler integration.en"],"tags":[]},{"location":"de/third_party/nextcloud/third_party-nextcloud.de/","level":1,"title":"Third party nextcloud.de","text":"","path":["Third party nextcloud.de"],"tags":[]},{"location":"de/third_party/nextcloud/third_party-nextcloud.de/#nextcloud-mit-dem-helper-skript-verwalten","level":2,"title":"Nextcloud mit dem Helper-Skript verwalten","text":"<p>Deprecation Hinweis</p> <p>Diese Anleitung ist deprecated und betrifft das Nextcloud Helper-Skript, welches innerhalb mailcows gebündelt ist. Ab Dezember 2024 wird diese Installationsart aus mailcow entfernt und kein Support dafür geleistet. Sollten Sie noch besagte Installation nutzen, migrieren Sie ihre Nextcloud Installation in eine eigenständige Nextcloud Instanz (entweder auch per Docker oder Nativ).</p> <p>Die Anleitung für die Nutzung von mailcow als Authentifizierungsquelle innerhalb Nextcloud's wird auch nach der Entfernung des Skriptes im Dezember 2024 erhalten und funktional bleiben.</p> <p>Nextcloud kann mit dem helper script, das in mailcow enthalten ist, eingerichtet (Parameter <code>-i</code>) und entfernt (Parameter <code>-p</code>) werden. Um Nextcloud zu installieren, navigieren Sie einfach zu Ihrem mailcow-dockerized Root-Ordner und führen Sie das Helper-Skript wie folgt aus:</p> <p><code>./helper-scripts/nextcloud.sh -i</code></p> <p>Für den Fall, dass Sie das Passwort (z.B. für admin) vergessen haben und kein neues anfordern können [über den Passwort-Reset-Link auf dem Login-Bildschirm] (https://docs.nextcloud.com/server/20/admin_manual/configuration_user/reset_admin_password.html?highlight=reset), können Sie durch den Aufruf des Helper-Skripts mit <code>-r</code> als Parameter ein neues Passwort setzen. Verwenden Sie diese Option nur, wenn Ihre Nextcloud nicht so konfiguriert ist, dass Sie mailcow zur Authentifizierung verwendet, wie im nächsten Abschnitt beschrieben.</p> <p>Damit mailcow ein Zertifikat für die Nextcloud Domain generieren kann, muss die Domain unter welcher die Nextcloud später erreichbar sein soll als ADDITIONAL_SAN in die mailcow.conf hinzufügt werden und folgender Befehl zur Übernahme ausgeführt werden. </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Für weitere Informationen siehe: Erweitertes SSL.</p>","path":["Third party nextcloud.de"],"tags":[]},{"location":"de/third_party/nextcloud/third_party-nextcloud.de/#hintergrund-aufgaben","level":2,"title":"Hintergrund-Aufgaben","text":"<p>Zur Verwendung der empfohlenen Einstellung (Cron) zur Verarbeitung der Hintergrund-Aufgaben müssen in der <code>docker-compose.override.yml</code> folgende Zeilen  hinzugefügt werden:</p> <pre><code>services:\n  php-fpm-mailcow:\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.nextcloud-cron.schedule: \"@every 5m\"\n      ofelia.job-exec.nextcloud-cron.command: \"su www-data -s /bin/bash -c \\\"/usr/local/bin/php -f /web/nextcloud/cron.php\\\"\"\n</code></pre> <p>Zusätzlich muss eine bestimmte Funktion für den php-fpm Worker aktiviert werden. Tun Sie dies in dem Sie die Datei <code>data/conf/phpfpm/php-fpm.d/pools.conf</code> bearbeiten und <code>shell_exec</code> aus allen Punkten samt dem <code>,</code> entfernen.</p> <p>Nachdem die beiden Schritte erledigt wurden muss der folgende Befehl ausgeführt werden, um das Docker Image mit den entsprechenden Labels zu versehen und den Stack neuzustarten.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Danach muss zudem der docker scheduler neu gestartet werden, um den neuen Job zu registrieren. Dazu wird der folgende Befehl ausgeführt. </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart ofelia-mailcow\n</code></pre> <pre><code>docker-compose restart ofelia-mailcow\n</code></pre> <p>Zur Überprüfung, ob die <code>ofelia</code> Konfiguration korrekt ist geladen wurde, kann mittels dem untenstehenden Befehl nach einer Zeile mit dem Inhalt  <code>New job registered \"nextcloud-cron\" - ...</code> gesucht werden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs ofelia-mailcow\n</code></pre> <pre><code>docker-compose logs ofelia-mailcow\n</code></pre> <p>Hierdurch wird alle 5 Minuten die Hintergrundverarbeitung gestartet. Da die Ausführung selbst keine Ausgabe liefert, kann die korrekte Funktionsweise in den  Grundeinstellungen von Nextcloud überprüft werden. Hier wird automatisch mit der ersten Ausführung die Hintergrund-Aufgaben Verarbeitung auf <code>(X) Cron</code> gesetzt  und der Zeitstempel <code>Letzte Aufgabe ausgeführt</code> aktualisiert.</p>","path":["Third party nextcloud.de"],"tags":[]},{"location":"de/third_party/nextcloud/third_party-nextcloud.de/#konfigurieren-sie-nextcloud-um-mailcow-fur-die-authentifizierung-zu-verwenden","level":2,"title":"Konfigurieren Sie Nextcloud, um mailcow für die Authentifizierung zu verwenden","text":"<p>Im Folgenden wird beschrieben, wie die Authentifizierung über mailcow unter Verwendung des OAuth2-Protokolls eingerichtet wird. Wir nehmen nur an, dass Sie Nextcloud bereits unter cloud.example.com eingerichtet haben und dass Ihre mailcow unter mail.example.com läuft. Es spielt keine Rolle, wenn Ihre Nextcloud auf einem anderen Server läuft, Sie können immer noch mailcow für die Authentifizierung verwenden.</p> <p>1. Melden Sie sich bei mailcow als Administrator an.</p> <p>2. Klicken Sie im Dropdown Menü (oben rechts) auf Konfiguration.</p> <p>3. Wählen Sie dann im Reiter \"Zugang\" den Dropdown Punkt OAuth2 aus.</p> <p>4. Scrollen Sie nach unten und klicken Sie auf die Schaltfläche Füge OAuth2 Client hinzu. Geben Sie die Redirect URI als <code>https://cloud.example.com/index.php/apps/sociallogin/custom_oauth2/mailcow</code> an und klicken Sie auf Hinzufügen. Speichern Sie die Client-ID und das Geheimnis für später.</p> <p>Info</p> <p>Einige Installationen, einschließlich derer, die mit dem Helper-Skript von mailcow eingerichtet wurden, müssen index.php/ aus der URL entfernen, um einen erfolgreichen Redirect zu erhalten: <code>https://cloud.example.com/apps/sociallogin/custom_oauth2/mailcow</code></p> <p>3. Melden Sie sich bei Nextcloud als Administrator an.</p> <p>4. Klicken Sie auf die Schaltfläche in der oberen rechten Ecke und wählen Sie Apps. Klicken Sie auf die Schaltfläche \"Suchen\" in der Symbolleiste, suchen Sie nach dem Plugin Social Login und klicken Sie daneben auf Herunterladen und aktivieren.</p> <p>5. Klicken Sie auf die Schaltfläche in der oberen rechten Ecke und wählen Sie Einstellungen. Scrollen Sie zum Abschnitt Administration auf der linken Seite und klicken Sie auf Social Login.</p> <p>6. Entfernen Sie das Häkchen bei den folgenden Punkten:</p> <ul> <li>\"Automatische Erstellung neuer Benutzer deaktivieren\"</li> <li>\"Benutzern erlauben, soziale Logins mit ihren Konten zu verbinden\".</li> <li>\"Nicht verfügbare Benutzergruppen bei der Anmeldung nicht entfernen\"</li> <li>\"Gruppen automatisch erstellen, wenn sie nicht vorhanden sind\"</li> <li>\"Anmeldung für Benutzer ohne zugeordnete Gruppen einschränken\".</li> </ul> <p>7. Überprüfen Sie die folgenden Punkte:</p> <ul> <li>\"Die Erstellung eines Kontos verhindern, wenn die E-Mail-Adresse in einem anderen Konto existiert\"</li> <li>\"Benutzerprofil bei jeder Anmeldung aktualisieren\"</li> <li>\"Benachrichtigung der Administratoren über neue Benutzer deaktivieren\".</li> </ul> <p>Klicken Sie auf die Schaltfläche Speichern.</p> <p>8. Scrollen Sie nach unten zu Custom OAuth2 und klicken Sie auf die Schaltfläche +. 9. Konfigurieren Sie die Parameter wie folgt:</p> <ul> <li>Interner Name: <code>mailcow</code></li> <li>Titel: <code>mailcow</code></li> <li>API Basis-URL: <code>https://mail.example.com</code></li> <li>Autorisierungs-URL: <code>https://mail.example.com/oauth/authorize</code></li> <li>Token-URL: <code>https://mail.example.com/oauth/token</code></li> <li>Profil-URL: <code>https://mail.example.com/oauth/profile</code></li> <li>Abmelde-URL: (leer lassen)</li> <li>Kunden-ID: (die Sie in Schritt 1 erhalten haben)</li> <li>Client Secret: (was Sie in Schritt 1 erhalten haben)</li> <li>Bereich: <code>Profil</code></li> </ul> <p>Klicken Sie auf die Schaltfläche Speichern ganz unten auf der Seite.</p> <p>Wenn Sie bisher Nextcloud mit mailcow-Authentifizierung über user_external/IMAP verwendet haben, müssen Sie einige zusätzliche Schritte durchführen, um Ihre bestehenden Benutzerkonten mit OAuth2 zu verknüpfen.</p> <p>1. Klicken Sie auf die Schaltfläche in der oberen rechten Ecke und wählen Sie Apps. Scrollen Sie nach unten zur App Externe Benutzerauthentifizierung und klicken Sie daneben auf Entfernen.</p> <p>2. Führen Sie die folgenden Abfragen in Ihrer Nextcloud-Datenbank aus (wenn Sie Nextcloud mit dem Skript von mailcow einrichten, können Sie folgenden Befehl nutzen um in den Container zu gelangen)</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf &amp;&amp; docker compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>source mailcow.conf &amp;&amp; docker-compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>INSERT INTO oc_users (uid, uid_lower) SELECT DISTINCT uid, LOWER(uid) FROM oc_users_external;\nINSERT INTO oc_sociallogin_connect (uid, identifier) SELECT DISTINCT uid, CONCAT(\"mailcow-\", uid) FROM oc_users_external;\n</code></pre> <p>Wenn Sie Nextcloud bisher ohne mailcow-Authentifizierung, aber mit den gleichen Benutzernamen wie mailcow genutzt haben, können Sie Ihre bestehenden Benutzerkonten auch mit OAuth2 verknüpfen.</p> <p>1. Führen Sie die folgenden Abfragen in Ihrer Nextcloud-Datenbank aus (wenn Sie Nextcloud mit dem Skript von mailcow einrichten, können Sie folgenden Befehl nutzen um in den Container zu gelangen):</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf &amp;&amp; docker compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>source mailcow.conf &amp;&amp; docker-compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>INSERT INTO oc_sociallogin_connect (uid, identifier) SELECT DISTINCT uid, CONCAT(\"mailcow-\", uid) FROM oc_users;\n</code></pre>","path":["Third party nextcloud.de"],"tags":[]},{"location":"de/third_party/nextcloud/third_party-nextcloud.de/#aktualisieren","level":2,"title":"Aktualisieren","text":"<p>Die Nextcloud-Instanz kann einfach mit dem Web-Update-Mechanismus aktualisiert werden. Bei größeren Updates können nach dem Update weitere Änderungen vorgenommen werden. Nachdem die Nextcloud-Instanz geprüft wurde, werden Probleme angezeigt. Dies können z.B. fehlende Indizes in der DB oder ähnliches sein. Es wird angezeigt, welche Befehle ausgeführt werden müssen, diese müssen im php-fpm-mailcow Container platziert werden.</p> <p>Führen Sie z.B. folgenden Befehl aus, um die fehlenden Indizes hinzuzufügen:</p> <p><code>docker exec -it -u www-data $(docker ps -f name=php-fpm-mailcow -q) bash -c \"php /web/nextcloud/occ db:add-missing-indices\"</code></p> <p>Das Update kann bei Bedarf auch per CLI durchgeführt werden. Dies ist mit folgedem Befehl im interaktiven Modus möglich:</p> <p><code>docker exec -it -u www-data $(docker ps -f name=php-fpm-mailcow -q) bash -c \"php /web/nextcloud/updater/updater.phar\"</code></p> <p>Um das Update ohne Rückfragen auszuführen, z.B. durch einen CRON Job, kann folgender Befehl verwendet werden: </p> <p>Achtung</p> <p>Wir empfehlen dieses Vorgehen nicht! Es könnte über die Zeit kaputt gehen und irreperable Schäden an der Nextcloud Instanz erzeugen. NUTZUNG AUF EIGENE GEFAHR!!</p> <p><code>docker exec -it -u www-data $(docker ps -f name=php-fpm-mailcow -q) bash -c \"php /web/nextcloud/updater/updater.phar --no-interaction\"</code></p>","path":["Third party nextcloud.de"],"tags":[]},{"location":"de/third_party/nextcloud/third_party-nextcloud.de/#fehlersuche-und-fehlerbehebung","level":2,"title":"Fehlersuche und Fehlerbehebung","text":"<p>Es kann vorkommen, dass Sie die Nextcloud-Instanz von Ihrem Netzwerk aus nicht erreichen können. Dies kann daran liegen, dass der Eintrag Ihres Subnetzes im Array 'trusted_proxies' fehlt. Sie können Änderungen in der Nextcloud config.php in <code>data/web/nextcloud/config/*</code> vornehmen.</p> <pre><code>'trusted_proxies' =&gt;\n  array (\n    0 =&gt; 'fd4d:6169:6c63:6f77::/64',\n    1 =&gt; '172.22.1.0/24',\n    2 =&gt; 'NewSubnet/24',\n  ),\n</code></pre> <p>Nachdem die Änderungen vorgenommen wurden, muss der nginx-Container neu gestartet werden.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose restart nginx-mailcow\n</code></pre>","path":["Third party nextcloud.de"],"tags":[]},{"location":"de/third_party/nextcloud/third_party-nextcloud.en/","level":1,"title":"Third party nextcloud.en","text":"","path":["Third party nextcloud.en"],"tags":[]},{"location":"de/third_party/nextcloud/third_party-nextcloud.en/#manage-nextcloud-using-the-helper-script","level":2,"title":"Manage Nextcloud using the helper script","text":"<p>Deprecation notice</p> <p>This guide about the mailcow Nextcloud helper-script is deprecated. Until December 2024 this installationscript will be removed from mailcow and no further support will be granted. If you are using a Nextcloud installation based on this script you should migrate all your datas to a standalone Nextcloud instance (either inside Docker or natively) in the near future.</p> <p>The Authentication guide (below further) will still be intact after the script removal in December 2024.</p> <p>Nextcloud can be set up (parameter <code>-i</code>) and removed (parameter <code>-p</code>) with the helper script included with mailcow. In order to install Nextcloud simply navigate to your mailcow-dockerized root folder and run the helper script as follows:</p> <p><code>./helper-scripts/nextcloud.sh -i</code></p> <p>In case you have forgotten the password (e.g. for admin) and can't request a new one via the password reset link on the login screen calling the helper script with <code>-r</code> as parameter allows you to set a new password. Only use this option if your Nextcloud isn't configured to use mailcow for authentication as described in the next section.</p> <p>In order for mailcow to generate a a certificate for the nextcloud domain you need to add \"nextcloud.domain.tld\" to ADDITIONAL_SAN in mailcow.conf and runthe following to apply:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>For more informaton refer to: Advanced SSL.</p>","path":["Third party nextcloud.en"],"tags":[]},{"location":"de/third_party/nextcloud/third_party-nextcloud.en/#background-jobs","level":2,"title":"Background jobs","text":"<p>To use the recommended setting (cron) to execute the background jobs following lines need to be added to the <code>docker-compose.override.yml</code>:</p> <pre><code>services:\n  php-fpm-mailcow:\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.nextcloud-cron.schedule: \"@every 5m\"\n      ofelia.job-exec.nextcloud-cron.command: \"su www-data -s /bin/bash -c \\\"/usr/local/bin/php -f /web/nextcloud/cron.php\\\"\"\n</code></pre> <p>In addition, a specific function must be activated for the php-fpm worker. Do this by editing the file <code>data/conf/phpfpm/php-fpm.d/pools.conf</code> and removing <code>shell_exec</code> from all items including the <code>,</code>.</p> <p>After the two steps have been completed, the following command must be executed to provide the Docker image with the corresponding labels and restart the stack.</p> <p>After adding these lines the following command must be executed to update the docker image:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>And also the docker scheduler image must be restarted to pick up the new job definition by executing:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart ofelia-mailcow\n</code></pre> <pre><code>docker-compose restart ofelia-mailcow\n</code></pre> <p>To check if the job was successfully picked up by <code>ofelia</code> the command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs ofelia-mailcow\n</code></pre> <pre><code>docker-compose logs ofelia-mailcow\n</code></pre> <p>It should contain a line similar to <code>New job registered \"nextcloud-cron\" - ...</code>.</p> <p>By adding these lines the background jobs will be executed every 5 minutes. To verify that the execution works correctly, the only way is to see it in the basic  settings when logged in as an admin in Nextcloud. If everything is correct the first scheduled execution will change the background jobs processing setting to  <code>(X) Cron</code> and the timestamp after <code>Last job ran</code> will be updated every 5 minutes.</p>","path":["Third party nextcloud.en"],"tags":[]},{"location":"de/third_party/nextcloud/third_party-nextcloud.en/#configure-nextcloud-to-use-mailcow-for-authentication","level":2,"title":"Configure Nextcloud to use mailcow for authentication","text":"<p>The following describes how set up authentication via mailcow using the OAuth2 protocol. We will only assume that you have already set up Nextcloud at cloud.example.com and that your mailcow is running at mail.example.com. It does not matter if your Nextcloud is running on a different server, you can still use mailcow for authentication.</p> <p>1. Log into mailcow as administrator.</p> <p>2. Click Configuration in the drop-down menu (top right).</p> <p>3. Then, in the \"Access\" tab, select the OAuth2 drop-down item.</p> <p>4. Scroll down and click the Add OAuth2 client button. Specify the redirect URI as <code>https://cloud.example.com/index.php/apps/sociallogin/custom_oauth2/mailcow</code> and click Add. Save the client ID and secret for later.</p> <p>Info</p> <p>Some installations, including those setup using the helper script of mailcow, need to remove index.php/ from the URL to get a successful redirect: <code>https://cloud.example.com/apps/sociallogin/custom_oauth2/mailcow</code></p> <p>5. Log into Nextcloud as administrator.</p> <p>6. Click the button in the top right corner and select Apps. Click the search button in the toolbar, search for the Social Login plugin and click Download and enable next to it.</p> <p>7. Click the button in the top right corner and select Settings. Scroll down to the Administration section on the left and click Social login.</p> <p>8. Uncheck the following items:</p> <ul> <li>\"Disable auto create new users\"</li> <li>\"Allow users to connect social logins with their accounts\"</li> <li>\"Do not prune not available user groups on login\"</li> <li>\"Automatically create groups if they do not exists\"</li> <li>\"Restrict login for users without mapped groups\"</li> </ul> <p>7. Check the following items:</p> <ul> <li>\"Prevent creating an account if the email address exists in another account\"</li> <li>\"Update user profile every login\"</li> <li>\"Disable notify admins about new users\"</li> </ul> <p>Click the Save button.</p> <p>8. Scroll down to Custom OAuth2 and click the + button. 9. Configure the parameters as follows:</p> <ul> <li>Internal name: <code>mailcow</code></li> <li>Title: <code>mailcow</code></li> <li>API Base URL: <code>https://mail.example.com</code></li> <li>Authorize URL: <code>https://mail.example.com/oauth/authorize</code></li> <li>Token URL: <code>https://mail.example.com/oauth/token</code></li> <li>Profile URL: <code>https://mail.example.com/oauth/profile</code></li> <li>Logout URL: (leave blank)</li> <li>Client ID: (what you obtained in step 1)</li> <li>Client Secret: (what you obtained in step 1)</li> <li>Scope: <code>profile</code></li> </ul> <p>Click the Save button at the very bottom of the page.</p> <p>If you have previously used Nextcloud with mailcow authentication via user_external/IMAP, you need to perform some additional steps to link your existing user accounts with OAuth2.</p> <p>1. Click the button in the top right corner and select Apps. Scroll down to the External user authentication app and click Remove next to it. 2. Run the following queries in your Nextcloud database (if you set up Nextcloud with the script from mailcow, you can use the following command to get into the container):</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf &amp;&amp; docker compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>source mailcow.conf &amp;&amp; docker-compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>INSERT INTO oc_users (uid, uid_lower) SELECT DISTINCT uid, LOWER(uid) FROM oc_users_external;\nINSERT INTO oc_sociallogin_connect (uid, identifier) SELECT DISTINCT uid, CONCAT(\"mailcow-\", uid) FROM oc_users_external;\n</code></pre> <p>If you have previously used Nextcloud without mailcow authentication, but with the same usernames as mailcow, you can also link your existing user accounts with OAuth2.</p> <p>1. Run the following queries in your Nextcloud database (if you set up Nextcloud with the script from mailcow, you can use the following command to get into the container):</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf &amp;&amp; docker compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>source mailcow.conf &amp;&amp; docker-compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>INSERT INTO oc_sociallogin_connect (uid, identifier) SELECT DISTINCT uid, CONCAT(\"mailcow-\", uid) FROM oc_users;\n</code></pre>","path":["Third party nextcloud.en"],"tags":[]},{"location":"de/third_party/nextcloud/third_party-nextcloud.en/#update","level":2,"title":"Update","text":"<p>The Nextcloud instance can be updated easily with the web update mechanism. In the case of larger updates, there may be further changes to be made after the update. After the Nextcloud instance has been checked, problems are shown. This can be e.g. missing indices in the DB or similar. It shows which commands have to be executed, these have to be placed in the php-fpm-mailcow container.</p> <p>As an an example run the following command to add the missing indices. <code>docker exec -it -u www-data $(docker ps -f name=php-fpm-mailcow -q) bash -c \"php /web/nextcloud/occ db:add-missing-indices\"</code></p> <p>The update can also been done by CLI with the following command: </p> <p><code>docker exec -it -u www-data $(docker ps -f name=php-fpm-mailcow -q) bash -c \"php /web/nextcloud/updater/updater.phar\"</code></p> <p>This can also been done in an non interactive way (e.g. CRON) with this command: </p> <p>Danger</p> <p>We do not recommend this! Serios damage can be caused or the update process brakes over time. USE AT OWN RISK!!</p> <p><code>docker exec -it -u www-data $(docker ps -f name=php-fpm-mailcow -q) bash -c \"php /web/nextcloud/updater/updater.phar --no-interaction\"</code></p>","path":["Third party nextcloud.en"],"tags":[]},{"location":"de/third_party/nextcloud/third_party-nextcloud.en/#debugging-troubleshooting","level":2,"title":"Debugging &amp; Troubleshooting","text":"<p>It may happen that you cannot reach the Nextcloud instance from your network. This may be due to the fact that the entry of your subnet in the array 'trusted_proxies' is missing. You can make changes in the Nextcloud config.php in <code>data/web/nextcloud/config/*</code>.</p> <pre><code>'trusted_proxies' =&gt;\n  array (\n    0 =&gt; 'fd4d:6169:6c63:6f77::/64',\n    1 =&gt; '172.22.1.0/24',\n    2 =&gt; 'NewSubnet/24',\n  ),\n</code></pre> <p>After the changes have been made, the nginx container must be restarted.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose restart nginx-mailcow\n</code></pre>","path":["Third party nextcloud.en"],"tags":[]},{"location":"de/third_party/portainer/third_party-portainer.de/","level":1,"title":"Third party portainer.de","text":"<p>Um Portainer zu aktivieren, müssen die docker-compose.yml und site.conf für Nginx geändert werden.</p> <p>1. Erstellen Sie eine neue Datei <code>docker-compose.override.yml</code> im mailcow-dockerized Stammverzeichnis und fügen Sie die folgende Konfiguration ein <pre><code>services:\n    portainer-mailcow:\n      image: portainer/portainer-ce\n      volumes:\n        - /var/run/docker.sock:/var/run/docker.sock\n        - ./data/conf/portainer:/data\n      restart: always\n      dns:\n        - 172.22.1.254\n      dns_search: mailcow-network\n      networks:\n        mailcow-network:\n          aliases:\n            - portainer\n</code></pre> 2a. Erstelle <code>data/conf/nginx/portainer.conf</code>: <pre><code>upstream portainer {\n  server portainer-mailcow:9000;\n}\n\nmap $http_upgrade $connection_upgrade {\n  default upgrade;\n  '' close;\n}\n</code></pre></p> <p>2b. Fügen Sie einen neuen Standort für die Standard-mailcow-Site ein, indem Sie die Datei <code>data/conf/nginx/site.portainer.custom</code> erstellen: <pre><code>  location /portainer/ {\n    proxy_http_version 1.1;\n    proxy_set_header Host              $http_host;   # required for docker client's sake\n    proxy_set_header X-Real-IP         $remote_addr; # pass on real client's IP\n    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_read_timeout                 900;\n\n    proxy_set_header Connection \"\";\n    proxy_buffers 32 4k;\n    proxy_pass http://portainer/;\n  }\n\n  location /portainer/api/websocket/ {\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection $connection_upgrade;\n    proxy_pass http://portainer/api/websocket/;\n  }\n</code></pre></p> <p>3. Übernehmen Sie Ihre Änderungen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d &amp;&amp; docker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose up -d &amp;&amp; docker-compose restart nginx-mailcow\n</code></pre> <p>Nun können Sie einfach zu https://${MAILCOW_HOSTNAME}/portainer/ navigieren, um Ihre Portainer-Container-Überwachungsseite anzuzeigen. Sie werden dann aufgefordert, ein neues Passwort für den admin Account anzugeben. Nachdem Sie Ihr Passwort eingegeben haben, können Sie sich mit der Portainer UI verbinden.</p>","path":["Third party portainer.de"],"tags":[]},{"location":"de/third_party/portainer/third_party-portainer.de/#reverse-proxy","level":2,"title":"Reverse Proxy","text":"<p>Wenn Sie einen Reverse-Proxy verwenden, muss dieser noch konfiguriert werden die Websocket Requests richtig weiterzuleiten.</p> <p>Dies wird für die Docker Konsole und andere Komponenten benötigt.</p> <p>Hier ist ein Bespiel für Apache:</p> <pre><code>&lt;Location /portainer/api/websocket/&gt;\n  RewriteEngine on\n  RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]\n  RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]\n  RewriteRule /portainer/api/websocket/(.*) ws://127.0.0.1:8080/portainer/api/websocket/$1 [P]\n&lt;/Location&gt;\n</code></pre>","path":["Third party portainer.de"],"tags":[]},{"location":"de/third_party/portainer/third_party-portainer.en/","level":1,"title":"Third party portainer.en","text":"<p>In order to enable Portainer, the docker-compose.yml and site.conf for Nginx must be modified.</p> <p>1. Create a new file <code>docker-compose.override.yml</code> in the mailcow-dockerized root folder and insert the following configuration <pre><code>services:\n    portainer-mailcow:\n      image: portainer/portainer-ce\n      volumes:\n        - /var/run/docker.sock:/var/run/docker.sock\n        - ./data/conf/portainer:/data\n      restart: always\n      dns:\n        - 172.22.1.254\n      dns_search: mailcow-network\n      networks:\n        mailcow-network:\n          aliases:\n            - portainer\n</code></pre> 2a. Create <code>data/conf/nginx/portainer.conf</code>: <pre><code>upstream portainer {\n  server portainer-mailcow:9000;\n}\n\nmap $http_upgrade $connection_upgrade {\n  default upgrade;\n  '' close;\n}\n</code></pre></p> <p>2b. Insert a new location to the default mailcow site by creating the file <code>data/conf/nginx/site.portainer.custom</code>: <pre><code>  location /portainer/ {\n    proxy_http_version 1.1;\n    proxy_set_header Host              $http_host;   # required for docker client's sake\n    proxy_set_header X-Real-IP         $remote_addr; # pass on real client's IP\n    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_read_timeout                 900;\n\n    proxy_set_header Connection \"\";\n    proxy_buffers 32 4k;\n    proxy_pass http://portainer/;\n  }\n\n  location /portainer/api/websocket/ {\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection $connection_upgrade;\n    proxy_pass http://portainer/api/websocket/;\n  }\n</code></pre></p> <p>3. Apply your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d &amp;&amp; docker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose up -d &amp;&amp; docker-compose restart nginx-mailcow\n</code></pre> <p>Now you can simply navigate to https://${MAILCOW_HOSTNAME}/portainer/ to view your Portainer container monitoring page. You’ll then be prompted to specify a new password for the admin account. After specifying your password, you’ll then be able to connect to the Portainer UI.</p>","path":["Third party portainer.en"],"tags":[]},{"location":"de/third_party/portainer/third_party-portainer.en/#reverse-proxy","level":2,"title":"Reverse Proxy","text":"<p>If you are using a reverse proxy you will have to configure it to properly forward websocket requests.</p> <p>This needs to be done for the docker console and other components to work.</p> <p>Here is an example for Apache:</p> <pre><code>&lt;Location /portainer/api/websocket/&gt;\n  RewriteEngine on\n  RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]\n  RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]\n  RewriteRule /portainer/api/websocket/(.*) ws://127.0.0.1:8080/portainer/api/websocket/$1 [P]\n&lt;/Location&gt;\n</code></pre>","path":["Third party portainer.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/","level":1,"title":"Third party roundcube.de","text":"","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#installation-von-roundcube","level":2,"title":"Installation von Roundcube","text":"<p>Beachten Sie</p> <p>Sofern nicht abweichend angegeben wird für alle aufgeführten Kommandos angenommen, dass diese im mailcow Installationsverzeichnis ausgeführt werden, d. h. dem Verzeichnis, welches <code>mailcow.conf</code> usw. enthält. Bitte führen Sie die Kommandos nicht blind aus, sondern verstehen Sie was diese bewirken. Keines der Kommandos sollte einen Fehler ausgeben; sollten Sie dennoch auf einen Fehler stoßen, beheben Sie diesen sofern notwendig bevor Sie mit den nachfolgenden Kommandos fortfahren.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#hinweise-zur-verwendung-von-composer","level":3,"title":"Hinweise zur Verwendung von composer","text":"<p>Diese Anweisungen verwenden das Programm composer zur Aktualisierung der Abhängigkeiten von Roundcube und um Roundcube-Plugins zu installieren bzw. zu aktualisieren.</p> <p>Das roundcube-plugin-installer composer Plugin hat eine Design-Schwäche, die dazu führen kann, dass composer bei Operationen fehlschlägt, im Rahmen derer Pakete aktualisiert oder deinstalliert werden.</p> <p>Die Fehlermeldung in diesem Falle besagt, dass eine <code>require</code>-Anweisung in <code>autoload_real.php</code> fehlgeschlagen ist, weil eine Datei nicht gefunden werden konnte. Beispiel:</p> <pre><code>In autoload_real.php line 43:\n  require(/web/rc/vendor/composer/../guzzlehttp/promises/src/functions_include.php): Failed to open stream: No such file or directory\n</code></pre> <p>Leider treten diese Fehler relativ häufig auf, sie lassen sich jedoch leicht beheben indem der Autoloader aktualisiert wird und das fehlgeschlagene Kommando im Anschluss erneut ausgeführt wird:</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer dump-autoload -o\n# Nun das fehlgeschlagene Kommando erneut ausführen\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#vorbereitung","level":3,"title":"Vorbereitung","text":"<p>Zunächst laden wir <code>mailcow.conf</code> um Zugriff auf die mailcow-Einstellungen innerhalb der nachfolgenden Kommandos zu erhalten.</p> <pre><code>source mailcow.conf\n</code></pre> <p>Laden Sie Roundcube 1.6.x (prüfen Sie das aktuellste Release und passen Sie die URL entsprechend an) in das web Verzeichnis herunter und entpacken Sie es (hier <code>rc/</code>):</p> <pre><code>mkdir -m 755 data/web/rc\nwget -O - https://github.com/roundcube/roundcubemail/releases/download/1.6.10/roundcubemail-1.6.10-complete.tar.gz | tar -xvz --no-same-owner -C data/web/rc --strip-components=1 -f -\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chown www-data:www-data /web/rc/logs /web/rc/temp\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chown root:www-data /web/rc/config\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chmod 750 /web/rc/logs /web/rc/temp /web/rc/config\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#optional-rechtschreibprufung","level":3,"title":"Optional: Rechtschreibprüfung","text":"<p>Wenn Sie eine Rechtschreibprüfung benötigen, erstellen Sie eine Datei <code>data/hooks/phpfpm/aspell.sh</code> mit folgendem Inhalt und geben Sie dann <code>chmod +x data/hooks/phpfpm/aspell.sh</code> ein. Dadurch wird eine lokale Rechtschreibprüfung installiert. Beachten Sie, dass die meisten modernen Webbrowser eine eingebaute Rechtschreibprüfung haben, so dass Sie diese vielleicht nicht benötigen.</p> <pre><code>#!/bin/bash\napk update\napk add aspell-de # oder jede andere Sprache\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#installation-des-mime-typ-verzeichnisses","level":3,"title":"Installation des MIME-Typ-Verzeichnisses","text":"<p>Laden Sie die <code>mime.types</code> Datei herunter, da diese nicht im <code>php-fpm</code>-Container enthalten ist.</p> <pre><code>wget -O data/web/rc/config/mime.types http://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#anlegen-der-roundcube-datenbank","level":3,"title":"Anlegen der Roundcube-Datenbank","text":"<p>Erstellen Sie eine Datenbank für Roundcube im mailcow mysql Container. Dies erstellt einen neuen <code>roundcube</code> Datenbank-Benutzer mit einem Zufallspasswort, welches in die Shell ausgegeben wird und in einer Shell-Variable für die Verwendung durch die nachfolgenden Kommandos gespeichert wird. Beachten Sie, dass Sie die <code>DBROUNDCUBE</code>-Shell-Variable manuell auf das ausgegebene Passwort setzen müssen, falls sie den Installationsprozess unterbrechen und später in einer neuen Shell fortsetzen sollten.</p> <pre><code>DBROUNDCUBE=$(LC_ALL=C &lt;/dev/urandom tr -dc A-Za-z0-9 2&gt; /dev/null | head -c 28)\necho Das Datenbank-Password für den Benutzer roundcube lautet $DBROUNDCUBE\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE DATABASE roundcubemail CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE USER 'roundcube'@'%' IDENTIFIED BY '${DBROUNDCUBE}';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"GRANT ALL PRIVILEGES ON roundcubemail.* TO 'roundcube'@'%';\"\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#roundcube-konfigurationsdatei","level":3,"title":"Roundcube-Konfigurationsdatei","text":"<p>Erstellen Sie eine Datei <code>data/web/rc/config/config.inc.php</code> mit dem folgenden Inhalt.   - Die <code>des_key</code>-Einstellung wird auf einen Zufallswert gesetzt. Sie wird u. a. zur Verschlüsselung vorübergehend     gespeicherter IMAP-Passwörter verwendet.   - Die Liste der Plugins kann nach Belieben angepasst werden. Die folgende Liste enthält eine Liste von     Standard-Plugins, welche ich als allgemein nützlich empfinde und die gut mit mailcow zusammenspielen:     - Das archive-Plugin fügt einen Archiv-Button hinzu, der ausgewählte E-Mails in ein konfigurierbares       Archiv-Verzeichnis verschiebt.     - Das managesieve-Plugin bietet eine benutzerfreundliche Oberfläche zur Verwaltung serverseitiger E-Mail-Filter und       Abwesenheits-Benachrichtigungen.     - Das acl-Plugin ermöglicht die Verwaltung von Zugriffskontroll-Listen auf IMAP-Verzeichnissen, mit der Möglichkeit       IMAP-Verzeichnisse mit anderen Benutzern zu teilen.     - Das markasjunk-Plugin fügt Buttons hinzu, um ausgewählte E-Mails als Spam (oder E-Mails im Junk-Verzeichnis nicht       als Spam) zu markieren und diese in das Junk-Verzeichnis (oder zurück in den Posteingang) zu verschieben. Die in       mailcow enthaltenen Sieve-Filter lösen automatisch die zugehörige Lern-Operation in rspamd aus, so dass keine       weitere Konfiguration des Plugins erforderlich ist.     - Das zipdownload-Plugin erlaubt es, mehrere E-Mail-Anhänge oder E-Mails als ZIP-Archiv herunterzuladen.   - Wenn Sie die Rechtschreibprüfung im obigen Schritt nicht installiert haben, entfernen Sie den Parameter     <code>spellcheck_engine</code>.</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/config/config.inc.php\n&lt;?php\n\\$config['db_dsnw'] = 'mysql://roundcube:${DBROUNDCUBE}@mysql/roundcubemail';\n\\$config['imap_host'] = 'dovecot:143';\n\\$config['smtp_host'] = 'postfix:588';\n\\$config['smtp_user'] = '%u';\n\\$config['smtp_pass'] = '%p';\n\\$config['support_url'] = '';\n\\$config['product_name'] = 'Roundcube Webmail';\n\\$config['cipher_method'] = 'chacha20-poly1305';\n\\$config['des_key'] = '$(LC_ALL=C &lt;/dev/urandom tr -dc \"A-Za-z0-9 !#$%&amp;()*+,-./:;&lt;=&gt;?@[\\\\]^_{|}~\" 2&gt; /dev/null | head -c 32)';\n\\$config['plugins'] = [\n  'archive',\n  'managesieve',\n  'acl',\n  'markasjunk',\n  'zipdownload',\n];\n\\$config['spellcheck_engine'] = 'aspell';\n\\$config['mime_types'] = '/web/rc/config/mime.types';\n\\$config['enable_installer'] = true;\n\n\\$config['managesieve_host'] = 'dovecot:4190';\n// Enables separate management interface for vacation responses (out-of-office)\n// 0 - no separate section (default); 1 - add Vacation section; 2 - add Vacation section, but hide Filters section\n\\$config['managesieve_vacation'] = 1;\nEOCONFIG\n\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chown root:www-data /web/rc/config/config.inc.php\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chmod 640 /web/rc/config/config.inc.php\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#initialisierung-der-datenbank","level":3,"title":"Initialisierung der Datenbank","text":"<p>Richten Sie Ihren Browser auf <code>https://myserver/rc/installer</code>. Prüfen Sie, dass die Webseite in keinem der Schritte \"NOT OK\"-Testergebnisse zeigt. Einige \"NOT AVAILABLE\"-Testergebnisse sind bzgl. der verschiedenen Datenbank-Erweiterungen erwartet, von denen nur MySQL benötigt wird.</p> <p>Initialisieren Sie die Datenbank und verlassen Sie das Installationsprogramm. Es ist nicht notwendig, die Konfigurationsdatei mit der heruntergeladenen Datei zu aktualisieren, sofern Sie keine Änderungen an den Einstellungen innerhalb des Installationsprogramms durchgeführt habe, die Sie übernehmen möchten.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#webserver-konfiguration","level":3,"title":"Webserver-Konfiguration","text":"<p>Das Roundcube-Verzeichnis enthält einige Inhalte, die nicht an Web-Nutzer ausgeliefert werden sollen. Wir erstellen daher eine Konfigurations-Ergänzung für nginx, um nur die öffentlichen Teile von Roundcube im Web zu exponieren:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/conf/nginx/site.roundcube.custom\nlocation /rc/ {\n  alias /web/rc/public_html/;\n}\nEOCONFIG\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#deaktivieren-und-entfernen-des-installationsprogramms","level":3,"title":"Deaktivieren und entfernen des Installationsprogramms","text":"<p>Löschen Sie das Verzeichnis <code>data/web/rc/installer</code> nach einer erfolgreichen Installation, und setzen Sie die <code>enable_installer</code>-Option in <code>data/web/rc/config/config.inc.php</code> auf <code>false</code>:</p> <pre><code>rm -r data/web/rc/installer\nsed -i -e \"s/\\(\\$config\\['enable_installer'\\].* = \\)true/\\1false/\" data/web/rc/config/config.inc.php\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#aktualisierung-der-roundcube-abhangigkeiten","level":3,"title":"Aktualisierung der Roundcube-Abhängigkeiten","text":"<p>Dieser Schritt ist nicht unbedingt notwendig, aber zumindest zum Zeitpunkt der Erstellung dieser Anweisungen enthielten die mit Roundcube ausgelieferten Abhängigkeiten Versionen mit Sicherheitslücken, daher könnte es eine gute Idee sein, die Abhängigkeiten auf die neusten Versionen zu aktualisieren. Aus demselben Grund sollte composer update hin und wieder ausgeführt werden.</p> <pre><code>cp -n data/web/rc/composer.json-dist data/web/rc/composer.json\ndocker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer update --no-dev -o\n</code></pre> <p>Sie können außerdem <code>composer audit</code> verwenden, um bekannte Sicherheitslücken in den installierten composer-Paketen anzuzeigen.</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer audit\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#ermoglichen-der-klartext-authentifizierung-fur-den-php-fpm-container-ohne-die-verwendung-von-tls","level":3,"title":"Ermöglichen der Klartext-Authentifizierung für den php-fpm-Container ohne die Verwendung von TLS","text":"<p>Wir müssen die Verwendung von Klartext-Authentifizierung über nicht verschlüsselte Verbindungen (innerhalb der Container-Netzwerks) in Dovecot zulassen, was in der Standard-Installation von mailcow nur für den SOGo-Container zum gleichen Zweck möglich ist. Danach starten Sie den Dovecot-Container neu, damit die Änderung wirksam wird.</p> <pre><code>cat  &lt;&lt;EOCONFIG &gt;&gt;data/conf/dovecot/extra.conf\nremote ${IPV4_NETWORK}.0/24 {\n  disable_plaintext_auth = no\n}\nremote ${IPV6_NETWORK} {\n  disable_plaintext_auth = no\n}\nEOCONFIG\n\ndocker compose restart dovecot-mailcow\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#ofelia-job-fur-roundcube-aufraumtatigkeiten","level":3,"title":"Ofelia-Job für Roundcube-Aufräumtätigkeiten","text":"<p>Roundcube muss regelmässig die Datenbank von nicht mehr benötigter Information befreien. Wir legen einen Ofelia-Job an, der das Roundcube <code>cleandb.sh</code>-Skript regelmässig ausführt.</p> <p>Um dies zu tun, fügen Sie folgendes zu <code>docker-compose.override.yml</code> hinzu (falls Sie bereits einige Anpassungen für den php-fpm-Container durchgeführt haben, fügen Sie die Label dem bestehenden Abschnitt hinzu):</p> <pre><code>services:\n  php-fpm-mailcow:\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.roundcube_cleandb.schedule: \"@every 168h\"\n      ofelia.job-exec.roundcube_cleandb.user: \"www-data\"\n      ofelia.job-exec.roundcube_cleandb.command: \"/bin/bash -c \\\"[ -f /web/rc/bin/cleandb.sh ] &amp;&amp; /web/rc/bin/cleandb.sh\\\"\"\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#optionale-zusatz-funktionalitaten","level":2,"title":"Optionale Zusatz-Funktionalitäten","text":"","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#aktivieren-der-funktion-passwort-andern-in-roundcube","level":2,"title":"Aktivieren der Funktion \"Passwort ändern\" in Roundcube","text":"<p>Das Ändern des mailcow Passworts aus der Roundcube-Benutzeroberfläche wird durch das password-Plugin ermöglicht. Wir konfigurieren dieses zur Verwendung der mailcow-API zur Passwort-Aktualisierung, was es zunächst erfordert, die API zu aktivieren und den API-Schlüssel zu ermitteln (Lese-/Schreib-Zugriff notwendig). Die API kann in der mailcow-Administrationsoberfläche aktiviert werden, wo Sie auch den API-Schlüssel finden.</p> <p>Öffnen Sie <code>data/web/rc/config/config.inc.php</code> und aktivieren Sie das Passwort-Plugin, indem Sie es dem <code>$config['plugins']</code>-Array hinzufügen, zum Beispiel:</p> <pre><code>$config['plugins'] = array(\n  'archive',\n  'managesieve',\n  'acl',\n  'markasjunk',\n  'zipdownload',\n  'password',\n);\n</code></pre> <p>Konfigurieren Sie das password-Plugin (stellen Sie sicher, **API_KEY** auf Ihren mailcow Lese-/Schreib-API-Schlüssel anzupassen):</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/plugins/password/config.inc.php\n&lt;?php\n\\$config['password_driver'] = 'mailcow';\n\\$config['password_confirm_current'] = true;\n\\$config['password_mailcow_api_host'] = 'http://nginx';\n\\$config['password_mailcow_api_token'] = '**API_KEY**';\nEOCONFIG\n</code></pre> <p>Hinweis: Sollten Sie die mailcow nginx-Konfiguration so angepasst haben, dass http-Anfragen auf https umgeleitet werden (wie z. B. hier beschrieben), dann wird die direkte Verbindung zum nginx-Container via HTTP nicht funktionieren, da nginx kein im Zertifikat enthaltener Hostname ist. In solchen Fällen setzen Sie <code>password_mailcow_api_host</code> stattdessen auf die öffentliche URI:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/plugins/password/config.inc.php\n&lt;?php\n\\$config['password_driver'] = 'mailcow';\n\\$config['password_confirm_current'] = true;\n\\$config['password_mailcow_api_host'] = 'https://${MAILCOW_HOSTNAME}';\n\\$config['password_mailcow_api_token'] = '**API_KEY**';\nEOCONFIG\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#carddav-adressbucher-in-roundcube-einbinden","level":2,"title":"CardDAV-Adressbücher in Roundcube einbinden","text":"<p>Installieren Sie die neuste v5-Version (die untenstehende Konfiguration ist kompatibel zu v5-Releases) mit composer. Antworten Sie <code>Y</code>, wenn Sie gefragt werden, ob Sie das Plugin aktivieren möchten.</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer require --update-no-dev -o \"roundcube/carddav:~5\"\n</code></pre> <p>Editieren Sie die Datei <code>data/web/rc/plugins/carddav/config.inc.php</code> und fügen Sie folgenden Inhalt hinzu:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/plugins/carddav/config.inc.php\n&lt;?php\n\\$prefs['_GLOBAL']['pwstore_scheme'] = 'des_key';\n\n\\$prefs['SOGo'] = [\n    'accountname'    =&gt; 'SOGo',\n    'username'       =&gt; '%u',\n    'password'       =&gt; '%p',\n    'discovery_url'  =&gt; 'http://sogo:20000/SOGo/dav/',\n    'name'           =&gt; '%N',\n    'use_categories' =&gt; true,\n    'fixed'          =&gt; ['username', 'password'],\n];\nEOCONFIG\n</code></pre> <p>RCMCardDAV legt alle Adressbücher des Benutzers beim Login in Roundcube an, einschließlich abonnierten Adressbüchern die mit dem Benutzers von anderen Benutzern geteilt werden.</p> <p>Wenn Sie das Standard-Adressbuch (gespeichert in der Roundcube-Datenbank) entfernen möchten, so dass nur CardDAV-Adressbücher verwendet werden können, fügen Sie der Konfigurationsdatei <code>data/web/rc/config/config.inc.php</code> die Option <code>$config['address_book_type'] = '';</code> hinzu.</p> <p>Hinweis: RCMCardDAV verwendet zusätzliche Datenbank-Tabellen. Nach der Installation (oder Aktualisierung) von RCMCardDAV ist es notwendig, sich in Roundcube neu anzumelden (melden Sie sich vorher ab, wenn Sie bereits eingeloggt sind), da die Erzeugung der Datenbank-Tabellen bzw. Änderungen nur bei der Anmeldung in Roundcube durchgeführt werden.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#ubermittlung-der-client-netzwerkadresse-an-dovecot","level":3,"title":"Übermittlung der Client-Netzwerkadresse an Dovecot","text":"<p>Normalerweise sieht der IMAP-Server Dovecot die Netzwerkadresse des php-fpm-Containers wenn Roundcube zu diesem Verbindungen aufbaut. Durch Verwendung einer IMAP-Erweiterung und dem <code>dovecot_client_ip</code> Roundcube-Plugin ist es möglich, dass Roundcube Dovecot die Client-Netzwerkadresse übermittelt, so dass in den Log-Dateien die Client-Netzwerkadresse erscheint. Dies führt dazu, dass Login-Versuche an Roundcube in den Dovecot-Logs genauso wie direkte Client-Verbindungen zu Dovecot aufgezeichnet werden, und fehlgeschlagene Login-Versuche an Roundcube analog zu fehlgeschlagenen direkten IMAP-Logins durch den netfilter-Container oder andere ggf. verfügbare Mechanismen zur Behandlung von Bruteforce-Attacken auf den IMAP-Server aufgegriffen werden und z. B. zu einer Blockierung des Clients führen.</p> <p>Hierzu muss das Roundcube-Plugin installiert werden:</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer require --update-no-dev -o \"foorschtbar/dovecot_client_ip:~2\"\n</code></pre> <p>Bearbeiten Sie die Datei <code>data/web/rc/config/config.inc.php</code> und fügen Sie den folgenden Inhalt ein:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;&gt;data/web/rc/config/config.inc.php\n\\$config['dovecot_client_ip_trusted_proxies'] = ['${IPV4_NETWORK}.0/24', '${IPV6_NETWORK}'];\nEOCONFIG\n</code></pre> <p>Weiterhin müssen wir Dovecot konfigurieren, so dass der php-fpm-Container als Teil eines vertrauenswürdigen Netzwerks betrachtet wird und somit die Client-Netzwerkadresse innerhalb einer IMAP-Sitzung überschreiben darf. Beachten Sie, dass dies auch die Klartext-Authentifizierung für die aufgeführten Netzwerkbereiche erlaubt, so dass das explizite Überschreiben von <code>disable_plaintext_auth</code> weiter oben in diesem Fall nicht notwendig ist.</p> <pre><code>cat  &lt;&lt;EOCONFIG &gt;&gt;data/conf/dovecot/extra.conf\nlogin_trusted_networks = ${IPV4_NETWORK}.0/24 ${IPV6_NETWORK}\nEOCONFIG\n\ndocker compose restart dovecot-mailcow\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#roundcube-zur-mailcow-apps-liste-hinzufugen","level":3,"title":"Roundcube zur mailcow Apps-Liste hinzufügen","text":"<p>Optional können Sie Roundcubes Link zu der mailcow Apps Liste hinzufügen. Um dies zu tun, öffnen oder erstellen Sie <code>data/web/inc/vars.local.inc.php</code> und stellen Sie sicher, dass es den folgenden Konfigurationsblock beinhaltet:</p> <pre><code>&lt;?php\n\n$MAILCOW_APPS = [\n    [\n        'name' =&gt; 'SOGo',\n        'link' =&gt; '/SOGo/'\n    ],\n    [\n        'name' =&gt; 'Roundcube',\n        'link' =&gt; '/rc/'\n    ]\n];\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#administratoren-ohne-passwort-in-roundcube-einloggen-lassen","level":3,"title":"Administratoren ohne Passwort in Roundcube einloggen lassen","text":"<p>Installieren Sie zunächst das Plugin dovecot_impersonate und fügen Sie Roundcube als App hinzu (siehe oben).</p> <pre><code>docker exec -it -w /web/rc/plugins $(docker ps -f name=php-fpm-mailcow -q) git clone https://github.com/corbosman/dovecot_impersonate.git\n</code></pre> <p>Editieren Sie <code>data/web/rc/config/config.inc.php</code> und aktivieren Sie das dovecot_impersonate Plugin indem Sie es zum Array <code>$config['plugins']</code> hinzufügen, zum Beispiel:</p> <pre><code>$config['plugins'] = array(\n  'archive',\n  'managesieve',\n  'acl',\n  'markasjunk',\n  'zipdownload',\n  'password',\n  'dovecot_impersonate'\n);\n</code></pre> <p>Editieren Sie <code>mailcow.conf</code> und fügen Sie folgendes hinzu:</p> <pre><code># Erlaube Admins, sich in Roundcube als Email-Benutzer einzuloggen (ohne Passwort)\n# Roundcube mit Plugin dovecot_impersonate muss zuerst installiert werden\n\nALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE=y\n</code></pre> <p>Editieren Sie <code>docker-compose.override.yml</code> und verfassen/erweitern Sie den Abschnitt für <code>php-fpm-mailcow</code>:</p> <pre><code>services:\n  php-fpm-mailcow:\n    environment:\n      - ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE=${ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE:-n}\n</code></pre> <p>Bearbeiten Sie <code>data/web/js/site/mailbox.js</code> und den folgenden Code nach <code>if (ALLOW_ADMIN_EMAIL_LOGIN) { ... }</code></p> <pre><code>if (ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE) {\n  item.action += '&lt;a href=\"/rc-auth.php?login=' + encodeURIComponent(item.username) + '\" class=\"login_as btn btn-sm btn-xs-half btn-primary\" target=\"_blank\"&gt;&lt;i class=\"bi bi-envelope-fill\"&gt;&lt;/i&gt; Roundcube&lt;/a&gt;';\n}\n</code></pre> <p>Bearbeiten Sie <code>data/web/mailbox.php</code> und fügen Sie diese Zeile zum Array <code>$template_data</code> hinzu:</p> <pre><code>  'allow_admin_email_login_roundcube' =&gt; (preg_match(\"/^(yes|y)+$/i\", $_ENV[\"ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE\"])) ? 'true' : 'false',\n</code></pre> <p>Bearbeiten Sie <code>data/web/templates/mailbox.twig</code> und fügen Sie diesen Code am Ende des Javascript-Abschnitts ein:</p> <pre><code>  var ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE = {{ allow_admin_email_login_roundcube }};\n</code></pre> <p>Kopieren Sie den Inhalt der folgenden Dateien aus diesem Snippet:</p> <ul> <li><code>data/web/inc/lib/RoundcubeAutoLogin.php</code></li> <li><code>data/web/rc-auth.php</code></li> </ul>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#abschluss-der-installation","level":2,"title":"Abschluss der Installation","text":"<p>Starten Sie schließlich mailcow neu</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#aktualisierung-von-roundcube","level":2,"title":"Aktualisierung von Roundcube","text":"<p>Ein Upgrade von Roundcube ist recht einfach: Gehen Sie auf die GitHub releases Seite für Roundcube und holen Sie sich den Link für die \"complete.tar.gz\" Datei für die gewünschte Version. Dann folgen Sie den untenstehenden Befehlen und ändern Sie die URL und den Namen des Roundcube-Ordners, falls nötig.</p> <pre><code># Starten Sie eine Bash-Sitzung des mailcow PHP-Containers\ndocker exec -it mailcowdockerized-php-fpm-mailcow-1 bash\n\n# Installieren Sie die erforderliche Upgrade-Abhängigkeit, dann aktualisieren Sie Roundcube auf die gewünschte Version\napk add rsync\ncd /tmp\nwget -O - https://github.com/roundcube/roundcubemail/releases/download/1.6.10/roundcubemail-1.6.10-complete.tar.gz | tar xfvz -\ncd roundcubemail-1.6.10\nbin/installto.sh /web/rc\n\n# Geben Sie 'Y' ein und drücken Sie die Eingabetaste, um Ihre Installation von Roundcube zu aktualisieren.\n# Geben Sie 'N' ein, wenn folgender Dialog erscheint: \"Do you want me to fix your local configuration\".\n\n# Sollte im Output eine Notice kommen \"NOTICE: Update dependencies by running php composer.phar update --no-dev\" führen\nSie composer aus:\ncd /web/rc\ncomposer update --no-dev -o\n# Auf die Frage \"Do you trust \"roundcube/plugin-installer\" to execute code and wish to enable it now? (writes \"allow-plugins\" to composer.json) [y,n,d,?] \" bitte mit y antworten.\n\n# Entfernen Sie übrig gebliebene Dateien\nrm -rf /tmp/roundcube*\n\n# Falls Sie von Version 1.5 auf 1.6 updaten, dann führen Sie folgende Befehle aus, um die Konfigurationsdatei anzupassen:`\nsed -i \"s/\\$config\\['default_host'\\].*$/\\$config\\['imap_host'\\]\\ =\\ 'dovecot:143'\\;/\" /web/rc/config/config.inc.php\nsed -i \"/\\$config\\['default_port'\\].*$/d\" /web/rc/config/config.inc.php\nsed -i \"s/\\$config\\['smtp_server'\\].*$/\\$config\\['smtp_host'\\]\\ =\\ 'postfix:588'\\;/\" /web/rc/config/config.inc.php\nsed -i \"/\\$config\\['smtp_port'\\].*$/d\" /web/rc/config/config.inc.php\nsed -i \"s/\\$config\\['managesieve_host'\\].*$/\\$config\\['managesieve_host'\\]\\ =\\ 'dovecot:4190'\\;/\" /web/rc/config/config.inc.php\nsed -i \"/\\$config\\['managesieve_port'\\].*$/d\" /web/rc/config/config.inc.php\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#aktualisierung-von-composer-plugins","level":3,"title":"Aktualisierung von composer-Plugins","text":"<p>Um Roundcube-Plugins und -Abhängigkeiten zu aktualisieren, die mit composer installiert wurden (z. B. RCMCardDAV-Plugin), führen Sie einfach composer im Container aus:</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer update --no-dev -o\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#aktualisierung-des-mime-typ-verzeichnisses","level":3,"title":"Aktualisierung des MIME-Typ-Verzeichnisses","text":"<p>Um das MIME-Typ-Verzeichnis zu aktualisieren, laden Sie dieses erneut mit dem Kommando aus den Installations-Anweisungen herunter.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#deinstallation-von-roundcube","level":2,"title":"Deinstallation von Roundcube","text":"<p>Für die Deinstallation wird ebenfalls angenommen, dass die Kommandos im mailcow-Installationsverzeichnis ausgeführt werden und dass <code>mailcow.conf</code> in die Shell geladen wurde, siehe Abschnitt Vorbereitung oben.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#entfernen-des-web-verzeichnisses","level":3,"title":"Entfernen des Web-Verzeichnisses","text":"<p>Dies entfernt die Roundcube-Installation mit allen Plugins und Abhängigkeiten die Sie ggf. installiert haben, einschließlich solcher, die mit composer installiert wurden.</p> <p>Hinweis: Dies entfernt auch alle angepassten Konfigurationen die Sie ggf. in Roundcube durchgeführt haben. Sollten Sie diese erhalten wollen, verschieben Sie das Verzeichnis an einen anderen Ort statt es zu entfernen.</p> <pre><code>rm -r data/web/rc\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#entfernen-der-datenbank","level":3,"title":"Entfernen der Datenbank","text":"<p>Hinweis: Dies löscht alle Daten, die Roundcube abgespeichert hat. Wenn Sie diese erhalten möchten, können Sie <code>mysqldump</code> ausführen, bevor Sie die Datenbank löschen, oder die Datenbank einfach nicht löschen.</p> <pre><code>docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"DROP USER 'roundcube'@'%';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"DROP DATABASE roundcubemail;\"\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#entfernen-der-konfigurationsanpassungen-fur-mailcow","level":3,"title":"Entfernen der Konfigurationsanpassungen für mailcow","text":"<p>Um die Dateien zu ermitteln, lesen Sie bitte die Installationsanweisungen und machen Sie die Schritte, die Sie dort zuvor durchgeführt haben, rückgängig.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#migration-von-einer-alteren-mailcow-roundcube-installation","level":2,"title":"Migration von einer älteren mailcow-Roundcube-Installation","text":"<p>Ältere Versionen dieser Anleitung verwendeten die mailcow-Datenbank auch für Roundcube, mit einem konfigurierten Präfix <code>mailcow_rc1</code> für alle Roundcube-Tabellen.</p> <p>Zur Migration wird ebenfalls angenommen, dass alle Kommandos im mailcow-Installationsverzeichnis ausgeführt werden und <code>mailcow.conf</code> in die Shell geladen wurde, siehe Vorbereitung oben. Dies Kommandos der verschiedenen Schritte bauen aufeinander auf und müssen innerhalb derselben Shell ausgeführt werden. Insbesondere setzen einige Schritte Shell-Variablen (besonders die <code>DBROUNDCUBE</code>-Variable mit dem Datenbank-Passwort für den roundcube-Datenbankbenutzer), die in späteren Schritten verwendet werden.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#anlegen-eines-neuen-roundcube-datenbankbenutzers-und-der-datenbank","level":3,"title":"Anlegen eines neuen roundcube-Datenbankbenutzers und der Datenbank","text":"<p>Folgen Sie den Anweisungen oben um den roundcube-Datenbankbenutzer und die getrennte Datenbank anzulegen.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#migration-der-roundcube-daten-aus-der-mailcow-datenbank","level":3,"title":"Migration der Roundcube-Daten aus der mailcow-Datenbank","text":"<p>Bevor wir mit der Migration starten, deaktivieren wir Roundcube, um weitere Änderungen an dessen Datenbank-Tabellen zu vermeiden.</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/conf/nginx/site.roundcube.custom\nlocation ^~ /rc/ {\n  return 503;\n}\nEOCONFIG\ndocker compose exec nginx-mailcow nginx -s reload\n</code></pre> <p>Nun kopieren wir die Roundcube-Daten in die neue Datenbank. Wir entfernen das Datenbank-Tabellen-Präfix in diesem Schritt, welches Sie ggf. anpassen müssen, wenn Sie ein anderes Präfix als <code>mailcow_rc1</code> verwendet haben. Es ist auch möglich, das Präfix beizubehalten (in diesem Fall behalten Sie auch die zugehörige Roundcube-Einstellung <code>db_prefix</code> bei). Ändern Sie dann die Datenbank-Fremdschlüssel.</p> <pre><code>RCTABLES=$(docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -sN mailcow -e \"show tables like 'mailcow_rc1%';\" | tr '\\n\\r' ' ')\ndocker exec $(docker ps -f name=mysql-mailcow -q) /bin/bash -c \"mysqldump -uroot -p${DBROOT} mailcow $RCTABLES | sed 's/mailcow_rc1//' | mysql -uroot -p${DBROOT} roundcubemail\"\nFOREIGNKEYS=$(docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -sN mailcow -e \"SELECT CONCAT('ALTER TABLE \\`', TABLE_NAME, '\\` ', 'DROP FOREIGN KEY \\`', CONSTRAINT_NAME, '\\`;', 'ALTER TABLE \\`', TABLE_NAME, '\\` ', 'ADD FOREIGN KEY \\`', CONSTRAINT_NAME, '\\` (', COLUMN_NAME, ') ', 'REFERENCES \\`', REPLACE(REFERENCED_TABLE_NAME, 'mailcow_rc1', ''), '\\` (', REFERENCED_COLUMN_NAME, ');') FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = 'roundcubemail' AND REFERENCED_TABLE_NAME IS NOT NULL;\")\ndocker exec $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} roundcubemail -e \"$FOREIGNKEYS\"\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#aktualisierung-der-roundcube-konfiguration","level":3,"title":"Aktualisierung der Roundcube-Konfiguration","text":"<p>Führen Sie folgende Kommandos aus, um die nicht mehr notwendige <code>db_prefix</code> Option zu entfernen. Wir aktivieren außerdem das Logging in Roundcube, indem wir die Einstellungen <code>log_dir</code> und <code>temp_dir</code> entfernen, welche Teil der alten Anweisungen waren.</p> <pre><code>sed -i \"/\\$config\\['db_prefix'\\].*$/d\" data/web/rc/config/config.inc.php\nsed -i \"/\\$config\\['log_dir'\\].*$/d\" data/web/rc/config/config.inc.php\nsed -i \"/\\$config\\['temp_dir'\\].*$/d\" data/web/rc/config/config.inc.php\n</code></pre> <p>Wir müssen die nginx-Konfiguration anpassen, so dass nicht-öffentliche Verzeichnisse von Roundcube nicht exponiert werden, insbesondere die Verzeichnisse, welche Log-Dateien und temporäre Dateien enthalten:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/conf/nginx/site.roundcube.custom\nlocation /rc/ {\n  alias /web/rc/public_html/;\n}\nEOCONFIG\n</code></pre> <p>Wir können auch die <code>cipher_method</code>-Einstellung auf eine sicherere Einstellung ändern, aber beachten Sie, dass mit der alten Methode verschlüsselte Daten danach nicht mehr entschlüsselt werden können. Dies betrifft insbesondere CardDAV-Passwörter, sofern Sie RCMCardDAV verwenden und Ihre Nutzer benutzerdefinierte Adressbücher hinzugefügt haben (die Admin-Voreinstellungen für die SOGo-Adressbücher werden automatisch beim nächsten Login für den jeweiligen Nutzer korrigiert). Wenn Sie die <code>cipher_method</code> ändern wollen, führen Sie folgendes Kommando aus:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;&gt;data/web/rc/config/config.inc.php\n\\$config['cipher_method'] = 'chacha20-poly1305';\nEOCONFIG\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#umstellung-des-rcmcarddav-plugins-auf-die-installation-mittels-composer","level":3,"title":"Umstellung des RCMCardDAV-Plugins auf die Installation mittels composer","text":"<p>Dieser Schritt ist optional, aber er gleicht Ihre Installation an die aktuelle Fassung der Anweisungen an und ermöglicht die Aktualisierung von RCMCardDAV mittels composer. Dies wird einfach dadurch erreicht, dass das carddav-Plugin aus dem Installationsverzeichnis gelöscht und entsprechend der Anweisungen oben installiert wird, einschließlich der Erstellung einer neuen RCMCardDAV v5-Konfiguration. Falls Sie das RCMCardDAV angepasst haben, sollten Sie dieses sichern, bevor Sie das Plugin löschen, und Ihre Anpassungen später in die neue Konfigurationsdatei übernehmen.</p> <p>Um das carddav-Plugin zu löschen, führen Sie folgendes Kommando aus, danach befolgen Sie zur Neuinstallation die Anweisungen oben:</p> <pre><code>rm -r data/web/rc/plugins/carddav\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#umschalten-von-roundcube-auf-die-neue-datenbank","level":3,"title":"Umschalten von Roundcube auf die neue Datenbank","text":"<p>Zunächst passen wir die Roundcube-Konfiguration an, so dass die neue Datenbank verwendet wird. <pre><code>sed -i \"/\\$config\\['db_dsnw'\\].*$/d\" data/web/rc/config/config.inc.php\ncat &lt;&lt;EOCONFIG &gt;&gt;data/web/rc/config/config.inc.php\n\\$config['db_dsnw'] = 'mysql://roundcube:${DBROUNDCUBE}@mysql/roundcubemail';\nEOCONFIG\n</code></pre></p>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#roundcube-web-zugriff-reaktivieren","level":3,"title":"Roundcube Web-Zugriff reaktivieren","text":"<p>Führen Sie chown und chmod auf den sensitiven Roundcube-Verzeichnissen, welche in Vorbereitung aufgeführt sind aus, um sicherzustellen, dass der nginx-Webserver nicht auf Dateien zugreifen darf, die er nicht ausliefern soll.</p> <p>Dann reaktivieren Sie den Web-Zugriff für Roundcube, indem Sie die temporäre Roundcube-Konfigurations-Erweiterung für nginx durch die oben beschriebene ersetzen, und laden anschließend die nginx-Konfiguration neu:</p> <pre><code>docker compose exec nginx-mailcow nginx -s reload\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#andere-anpassungen","level":3,"title":"Andere Anpassungen","text":"<p>Sie müssen auch die Konfiguration des Roundcube password-Plugins entsprechend dieser Anweisungen anpassen, sofern Sie diese Funktionalität aktiviert haben, da die alten Anweisungen das Passwort direkt in der mailcow-Datenbank änderten, wohingegen diese Fassung der Anweisungen die mailcow-API zur Passwort-Änderung verwendet.</p> <p>Bezüglich weiterer Anpassungen und Neuerungen (z. B. roundcube-dovecot_client_ip Plugin) können Sie die aktuellen Anweisungen durchgehen und Ihre Konfiguration entsprechend anpassen bzw. die genannten Installationsschritte für neue Funktionalitäten ausführen.</p> <p>Insbesondere beachten Sie folgende Abschnitte:</p> <ul> <li>Ofelia-Job für Roundcube-Aufräumtätigkeiten</li> <li>Ermöglichen der Klartext-Authentifizierung für den php-fpm-Container ohne die Verwendung von TLS</li> <li>Übermittlung der Client-Netzwerkadresse an Dovecot</li> </ul>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.de/#entfernen-der-roundcube-tabellen-aus-der-mailcow-datenbank","level":3,"title":"Entfernen der Roundcube-Tabellen aus der mailcow-Datenbank","text":"<p>Nachdem Sie sichergestellt haben, dass die Migration erfolgreich durchgeführt wurde und Roundcube mit der getrennten Datenbank funktioniert, können Sie die Roundcube-Tabellen aus der mailcow-Datenbank mit dem folgenden Kommando entfernen:</p> <pre><code>docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -sN mailcow -e \"SET SESSION foreign_key_checks = 0; DROP TABLE IF EXISTS $(echo $RCTABLES | sed -e 's/ \\+/,/g');\"\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/","level":1,"title":"Third party roundcube.en","text":"","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#installing-roundcube","level":2,"title":"Installing Roundcube","text":"<p>Note</p> <p>Unless otherwise stated, all of the given commands are expected to be executed in the mailcow installation directory, i.e., the directory containing <code>mailcow.conf</code> etc. Please do not blindly execute the commands but understand what they do. None of the commands is supposed to produce an error, so if you encounter an error, fix it if necessary before continuing with the subsequent commands.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#note-on-composer-usage","level":3,"title":"Note on composer usage","text":"<p>This guide uses composer to update roundcube dependencies or install / update roundcube plugins.</p> <p>The roundcube-plugin-installer composer plugin has a design issue that can lead to composer errors when packages are upgraded or uninstalled in the composer execution.</p> <p>The error message will typically tell you that a <code>require</code> in <code>autoload_real.php</code> failed because a file could not be opened. Example:</p> <pre><code>In autoload_real.php line 43:\n  require(/web/rc/vendor/composer/../guzzlehttp/promises/src/functions_include.php): Failed to open stream: No such file or directory\n</code></pre> <p>Unfortunately these occur quite frequently, but they can be worked around by updating the autoloader and re-running the failed command:</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer dump-autoload -o\n# Now execute the command that failed again\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#preparation","level":3,"title":"Preparation","text":"<p>First we load <code>mailcow.conf</code> so we have access to the mailcow configuration settings for the following commands.</p> <pre><code>source mailcow.conf\n</code></pre> <p>Download Roundcube 1.6.x (check for latest release and adapt URL) to the web directory and extract it (here <code>rc/</code>):</p> <pre><code>mkdir -m 755 data/web/rc\nwget -O - https://github.com/roundcube/roundcubemail/releases/download/1.6.10/roundcubemail-1.6.10-complete.tar.gz | tar -xvz --no-same-owner -C data/web/rc --strip-components=1 -f -\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chown www-data:www-data /web/rc/logs /web/rc/temp\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chown root:www-data /web/rc/config\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chmod 750 /web/rc/logs /web/rc/temp /web/rc/config\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#optional-spellchecking","level":3,"title":"Optional: Spellchecking","text":"<p>If you need spell check features, create a file <code>data/hooks/phpfpm/aspell.sh</code> with the following content, then <code>chmod +x data/hooks/phpfpm/aspell.sh</code>. This installs a local spell check engine. Note, most modern web browsers have built in spell check, so you may not want/need this.</p> <pre><code>#!/bin/bash\napk update\napk add aspell-en # or any other language\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#install-mime-type-mappings","level":3,"title":"Install mime type mappings","text":"<p>Download the <code>mime.types</code> file as it is not included in the php-fpm container.</p> <pre><code>wget -O data/web/rc/config/mime.types http://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#create-roundcube-database","level":3,"title":"Create roundcube database","text":"<p>Create a database for roundcube in the mailcow MySQL container. This creates a new <code>roundcube</code> database user with a random password, which will be echoed to the shell and stored in a shell variable for use by later commands. Note that when you interrupt the process and continue in a new shell, you must set the <code>DBROUNDCUBE</code> shell variable manually to the password output by the following commands.</p> <pre><code>DBROUNDCUBE=$(LC_ALL=C &lt;/dev/urandom tr -dc A-Za-z0-9 2&gt; /dev/null | head -c 28)\necho Database password for user roundcube is $DBROUNDCUBE\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE DATABASE roundcubemail CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE USER 'roundcube'@'%' IDENTIFIED BY '${DBROUNDCUBE}';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"GRANT ALL PRIVILEGES ON roundcubemail.* TO 'roundcube'@'%';\"\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#roundcube-configuration","level":3,"title":"Roundcube configuration","text":"<p>Create a file <code>data/web/rc/config/config.inc.php</code> with the following content.   - The <code>des_key</code> option is set to a random value. It is used to temporarily store your IMAP password.   - The plugins list can be adapted to your preference. I added a set of standard plugins that I consider of common     usefulness and which work well together with mailcow:     - The archive plugin adds an archive button that moves selected messages to a user-configurable archive folder.     - The managesieve plugin provides a user-friendly interface to manage server-side mail filtering and vacation / out       of office notification.     - The acl plugin allows to manage access control lists on IMAP folders, including the ability to share IMAP folders       to other users.     - The markasjunk plugin adds buttons to mark selected messages as junk (or messages in the junk folder not as junk)       and moves them to the junk folder or back to the inbox. The sieve filters included with mailcow will take care       that action triggers a learn as spam/ham action in rspamd, so no further configuration of the plugin is needed.     - The zipdownload plugin allows to download multiple message attachments or messages as a zip file.   - If you didn't install spell check in the above step, remove <code>spellcheck_engine</code> parameter.</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/config/config.inc.php\n&lt;?php\n\\$config['db_dsnw'] = 'mysql://roundcube:${DBROUNDCUBE}@mysql/roundcubemail';\n\\$config['imap_host'] = 'dovecot:143';\n\\$config['smtp_host'] = 'postfix:588';\n\\$config['smtp_user'] = '%u';\n\\$config['smtp_pass'] = '%p';\n\\$config['support_url'] = '';\n\\$config['product_name'] = 'Roundcube Webmail';\n\\$config['cipher_method'] = 'chacha20-poly1305';\n\\$config['des_key'] = '$(LC_ALL=C &lt;/dev/urandom tr -dc \"A-Za-z0-9 !#$%&amp;()*+,-./:;&lt;=&gt;?@[\\\\]^_{|}~\" 2&gt; /dev/null | head -c 32)';\n\\$config['plugins'] = [\n  'archive',\n  'managesieve',\n  'acl',\n  'markasjunk',\n  'zipdownload',\n];\n\\$config['spellcheck_engine'] = 'aspell';\n\\$config['mime_types'] = '/web/rc/config/mime.types';\n\\$config['enable_installer'] = true;\n\n\\$config['managesieve_host'] = 'dovecot:4190';\n// Enables separate management interface for vacation responses (out-of-office)\n// 0 - no separate section (default); 1 - add Vacation section; 2 - add Vacation section, but hide Filters section\n\\$config['managesieve_vacation'] = 1;\nEOCONFIG\n\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chown root:www-data /web/rc/config/config.inc.php\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chmod 640 /web/rc/config/config.inc.php\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#initialize-database","level":3,"title":"Initialize database","text":"<p>Point your browser to <code>https://myserver/rc/installer</code>. Check that the website shows no \"NOT OK\" check results on any of the steps, some \"NOT AVAILABLE\" are expected regarding different database extensions of which we only need MySQL. Initialize the database and leave the installer. It is not necessary to update the configuration with the downloaded one, unless you made some settings in the installer you would like to take over.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#webserver-configuration","level":3,"title":"Webserver configuration","text":"<p>The roundcube directory includes some locations that we do not want to serve to web users. We add a configuration extension to nginx to only expose the public directory of roundcube.</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/conf/nginx/site.roundcube.custom\nlocation /rc/ {\n  alias /web/rc/public_html/;\n}\nEOCONFIG\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#disable-and-remove-installer","level":3,"title":"Disable and remove installer","text":"<p>Delete the directory <code>data/web/rc/installer</code> after a successful installation, and set the <code>enable_installer</code> option to false in <code>data/web/rc/config/config.inc.php</code>:</p> <pre><code>rm -r data/web/rc/installer\nsed -i -e \"s/\\(\\$config\\['enable_installer'\\].* = \\)true/\\1false/\" data/web/rc/config/config.inc.php\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#update-roundcube-dependencies","level":3,"title":"Update roundcube dependencies","text":"<p>This step is not strictly necessary, but at least at the time of this writing the dependencies shipped with roundcube included versions with security vulnerabilities, so it may be a good idea to update the dependencies to the latest versions. For the same reason, it may be a good idea to run the composer update once in a while.</p> <pre><code>cp -n data/web/rc/composer.json-dist data/web/rc/composer.json\ndocker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer update --no-dev -o\n</code></pre> <p>You can also use <code>composer audit</code> to check for any reported security issues with the installed set of composer packages:</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer audit\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#allow-plaintext-authentication-for-the-php-fpm-container-without-using-tls","level":3,"title":"Allow plaintext authentication for the php-fpm container without using TLS","text":"<p>We need to allow plaintext authentication in dovecot over unencrypted connection (inside the container network), which is per default mailcow installation only possible for the SOGo container for the very same purpose. Afterwards restart the dovecot container so the change becomes effective.</p> <pre><code>cat  &lt;&lt;EOCONFIG &gt;&gt;data/conf/dovecot/extra.conf\nremote ${IPV4_NETWORK}.0/24 {\n  disable_plaintext_auth = no\n}\nremote ${IPV6_NETWORK} {\n  disable_plaintext_auth = no\n}\nEOCONFIG\n\ndocker compose restart dovecot-mailcow\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#ofelia-job-for-roundcube-housekeeping","level":3,"title":"Ofelia job for roundcube housekeeping","text":"<p>Roundcube needs to clean some stale information from the database every once in a while, for which we will create an ofelia job that runs the roundcube <code>cleandb.sh</code> script.</p> <p>To do this, add the following to <code>docker-compose.override.yml</code> (if you already have some adaptations for the php-fpm container, add the labels to the existing section):</p> <pre><code>services:\n  php-fpm-mailcow:\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.roundcube_cleandb.schedule: \"@every 168h\"\n      ofelia.job-exec.roundcube_cleandb.user: \"www-data\"\n      ofelia.job-exec.roundcube_cleandb.command: \"/bin/bash -c \\\"[ -f /web/rc/bin/cleandb.sh ] &amp;&amp; /web/rc/bin/cleandb.sh\\\"\"\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#optional-extra-functionality","level":2,"title":"Optional extra functionality","text":"","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#enable-change-password-function-in-roundcube","level":3,"title":"Enable change password function in Roundcube","text":"<p>Changing the mailcow password from the roundcube UI is supported via the password plugin. We will configure it to use the mailcow API to update the password, which requires to enable the API first and to get the API key (read/write API access required). The API can be enabled in the mailcow admin interface, where you can also find the API key.</p> <p>Open <code>data/web/rc/config/config.inc.php</code> and enable the password plugin by adding it to the <code>$config['plugins']</code> array, for example:</p> <pre><code>$config['plugins'] = array(\n  'archive',\n  'managesieve',\n  'acl',\n  'markasjunk',\n  'zipdownload',\n  'password',\n);\n</code></pre> <p>Configure the password plugin (be sure to adapt **API_KEY** to you mailcow read/write API key):</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/plugins/password/config.inc.php\n&lt;?php\n\\$config['password_driver'] = 'mailcow';\n\\$config['password_confirm_current'] = true;\n\\$config['password_mailcow_api_host'] = 'http://nginx';\n\\$config['password_mailcow_api_token'] = '**API_KEY**';\nEOCONFIG\n</code></pre> <p>Note: If you have changed the mailcow nginx configuration to redirect http requests to https (e.g., as described here), then directly talking to the nginx container via http will not work because nginx is not a hostname contained in the certificate. In such cases, set <code>password_mailcow_api_host</code> in the above configuration to the public URI instead:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/plugins/password/config.inc.php\n&lt;?php\n\\$config['password_driver'] = 'mailcow';\n\\$config['password_confirm_current'] = true;\n\\$config['password_mailcow_api_host'] = 'https://${MAILCOW_HOSTNAME}';\n\\$config['password_mailcow_api_token'] = '**API_KEY**';\nEOCONFIG\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#integrate-carddav-addressbooks-in-roundcube","level":3,"title":"Integrate CardDAV addressbooks in Roundcube","text":"<p>Install the latest v5 version (the config below is compatible with v5 releases) using composer. Answer <code>Y</code> when asked if you want to activate the plugin.</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer require --update-no-dev -o \"roundcube/carddav:~5\"\n</code></pre> <p>Edit the file <code>data/web/rc/plugins/carddav/config.inc.php</code> and insert the following content:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/plugins/carddav/config.inc.php\n&lt;?php\n\\$prefs['_GLOBAL']['pwstore_scheme'] = 'des_key';\n\n\\$prefs['SOGo'] = [\n    'accountname'    =&gt; 'SOGo',\n    'username'       =&gt; '%u',\n    'password'       =&gt; '%p',\n    'discovery_url'  =&gt; 'http://sogo:20000/SOGo/dav/',\n    'name'           =&gt; '%N',\n    'use_categories' =&gt; true,\n    'fixed'          =&gt; ['username', 'password'],\n];\nEOCONFIG\n</code></pre> <p>RCMCardDAV will add all addressbooks of the user on login, including subscribed addressbooks shared to the user by other users.</p> <p>If you want to remove the default addressbooks (stored in the Roundcube database), so that only the CardDAV addressbooks are accessible, append <code>$config['address_book_type'] = '';</code> to the config file <code>data/web/rc/config/config.inc.php</code>.</p> <p>Note: RCMCardDAV uses additional database tables. After installing (or upgrading) RCMCardDAV, it is required to log in roundcube (log out first if already logged in) because the database table creation / changes are performed only during the login to roundcube.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#forward-the-client-network-address-to-dovecot","level":3,"title":"Forward the client network address to dovecot","text":"<p>Normally, the IMAP server dovecot will see the network address of the php-fpm container when roundcube interacts with the IMAP server. Using an IMAP extension and the <code>dovecot_client_ip</code> roundcube plugin, it is possible for roundcube to tell dovecot the client IP, so it will also show up in the logs as the remote IP. When doing this, login attempts will show in the dovecot logs like any direct client connections to dovecot, and such failed logins into roundcube will be treated in the same manner as failed direct IMAP logins, causing blocking of the client with the netfilter container or other mechanisms that may already be in place to handle bruteforce attacks on the IMAP server.</p> <p>For this, the roundcube plugin must be installed.</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer require --update-no-dev -o \"foorschtbar/dovecot_client_ip:~2\"\n</code></pre> <p>Edit the file <code>data/web/rc/config/config.inc.php</code> and insert the following content:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;&gt;data/web/rc/config/config.inc.php\n\\$config['dovecot_client_ip_trusted_proxies'] = ['${IPV4_NETWORK}.0/24', '${IPV6_NETWORK}'];\nEOCONFIG\n</code></pre> <p>Furthermore, we must configure dovecot to treat the php-fpm container as part of a trusted network so it is allowed to override the client IP in the IMAP session. Note that this also enables plaintext authentication for the listed network ranges, so the explicit overridings of <code>disable_plaintext_auth</code> done above are not necessary when using this.</p> <pre><code>cat  &lt;&lt;EOCONFIG &gt;&gt;data/conf/dovecot/extra.conf\nlogin_trusted_networks = ${IPV4_NETWORK}.0/24 ${IPV6_NETWORK}\nEOCONFIG\n\ndocker compose restart dovecot-mailcow\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#add-roundcube-link-to-mailcow-apps-list","level":3,"title":"Add roundcube link to mailcow Apps list","text":"<p>You can add Roundcube's link to the mailcow Apps list. To do this, open or create <code>data/web/inc/vars.local.inc.php</code> and make sure it includes the following configuration block:</p> <pre><code>&lt;?php\n\n$MAILCOW_APPS = [\n    [\n        'name' =&gt; 'SOGo',\n        'link' =&gt; '/SOGo/'\n    ],\n    [\n        'name' =&gt; 'Roundcube',\n        'link' =&gt; '/rc/'\n    ]\n];\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#let-admins-log-into-roundcube-without-password","level":3,"title":"Let admins log into Roundcube without password","text":"<p>First, install plugin dovecot_impersonate and add Roundcube as an app (see above).</p> <pre><code>docker exec -it -w /web/rc/plugins $(docker ps -f name=php-fpm-mailcow -q) git clone https://github.com/corbosman/dovecot_impersonate.git\n</code></pre> <p>Open <code>data/web/rc/config/config.inc.php</code> and enable the dovecot_impersonate plugin by adding it to the <code>$config['plugins']</code> array, for example:</p> <pre><code>$config['plugins'] = array(\n  'archive',\n  'managesieve',\n  'acl',\n  'markasjunk',\n  'zipdownload',\n  'password',\n  'dovecot_impersonate'\n);\n</code></pre> <p>Edit <code>mailcow.conf</code> and add the following:</p> <pre><code># Allow admins to log into Roundcube as email user (without any password)\n# Roundcube with plugin dovecot_impersonate must be installed first\n\nALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE=y\n</code></pre> <p>Edit <code>docker-compose.override.yml</code> and crate/extend the section for <code>php-fpm-mailcow</code>:</p> <pre><code>services:\n  php-fpm-mailcow:\n    environment:\n      - ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE=${ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE:-n}\n</code></pre> <p>Edit <code>data/web/js/site/mailbox.js</code> and the following code after <code>if (ALLOW_ADMIN_EMAIL_LOGIN) { ... }</code></p> <pre><code>if (ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE) {\n  item.action += '&lt;a href=\"/rc-auth.php?login=' + encodeURIComponent(item.username) + '\" class=\"login_as btn btn-sm btn-xs-half btn-primary\" target=\"_blank\"&gt;&lt;i class=\"bi bi-envelope-fill\"&gt;&lt;/i&gt; Roundcube&lt;/a&gt;';\n}\n</code></pre> <p>Edit <code>data/web/mailbox.php</code> and add this line to array <code>$template_data</code>:</p> <pre><code>  'allow_admin_email_login_roundcube' =&gt; (preg_match(\"/^(yes|y)+$/i\", $_ENV[\"ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE\"])) ? 'true' : 'false',\n</code></pre> <p>Edit <code>data/web/templates/mailbox.twig</code> and add this code to the bottom of the javascript section:</p> <pre><code>  var ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE = {{ allow_admin_email_login_roundcube }};\n</code></pre> <p>Copy the contents of the following files from this Snippet:</p> <ul> <li><code>data/web/inc/lib/RoundcubeAutoLogin.php</code></li> <li><code>data/web/rc-auth.php</code></li> </ul>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#finish-installation","level":2,"title":"Finish installation","text":"<p>Finally, restart mailcow</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#upgrading-roundcube","level":2,"title":"Upgrading Roundcube","text":"<p>Upgrading Roundcube is rather simple, go to the GitHub releases page for Roundcube and get the link for the \"complete.tar.gz\" file for the wanted release. Then follow the below commands and change the URL and Roundcube folder name if needed.</p> <pre><code># Enter a bash session of the mailcow PHP container\ndocker exec -it mailcowdockerized-php-fpm-mailcow-1 bash\n\n# Install required upgrade dependency, then upgrade Roundcube to wanted release\napk add rsync\ncd /tmp\nwget -O - https://github.com/roundcube/roundcubemail/releases/download/1.6.10/roundcubemail-1.6.10-complete.tar.gz | tar xfvz -\ncd roundcubemail-1.6.10\nbin/installto.sh /web/rc\n\n# Type 'Y' and press enter to upgrade your install of Roundcube\n# Type 'N' to \"Do you want me to fix your local configuration\" if prompted\n\n# If you see \"NOTICE: Update dependencies by running php composer.phar update --no-dev\" run composer:\ncd /web/rc\ncomposer update --no-dev -o\n# If asked \"Do you trust \"roundcube/plugin-installer\" to execute code and wish to enable it now? (writes \"allow-plugins\" to composer.json) [y,n,d,?] \" hit y and continue.\n\n# Remove leftover files\nrm -rf /tmp/roundcube*\n\n# If you're going from 1.5 to 1.6 please run the config file changes below\nsed -i \"s/\\$config\\['default_host'\\].*$/\\$config\\['imap_host'\\]\\ =\\ 'dovecot:143'\\;/\" /web/rc/config/config.inc.php\nsed -i \"/\\$config\\['default_port'\\].*$/d\" /web/rc/config/config.inc.php\nsed -i \"s/\\$config\\['smtp_server'\\].*$/\\$config\\['smtp_host'\\]\\ =\\ 'postfix:588'\\;/\" /web/rc/config/config.inc.php\nsed -i \"/\\$config\\['smtp_port'\\].*$/d\" /web/rc/config/config.inc.php\nsed -i \"s/\\$config\\['managesieve_host'\\].*$/\\$config\\['managesieve_host'\\]\\ =\\ 'dovecot:4190'\\;/\" /web/rc/config/config.inc.php\nsed -i \"/\\$config\\['managesieve_port'\\].*$/d\" /web/rc/config/config.inc.php\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#upgrade-composer-plugins","level":3,"title":"Upgrade composer plugins","text":"<p>To upgrade roundcube plugins installed using composer and dependencies (e.g. RCMCardDAV plugin), you can simply run composer in the container:</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer update --no-dev -o\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#upgrade-mime-type-mappings","level":3,"title":"Upgrade mime type mappings","text":"<p>To upgrade the mime type mappings, re-download them using the command in the installation instructions.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#uninstalling-roundcube","level":2,"title":"Uninstalling roundcube","text":"<p>For the uninstallation, it is also assumed that the commands are executed in the mailcow installation directory and that <code>mailcow.conf</code> has been sourced in the shell, see Preparation above.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#remove-the-web-directory","level":3,"title":"Remove the web directory","text":"<p>This deletes the roundcube installation and all plugins and dependencies that you may have installed, including those installed with composer.</p> <p>Note: This deletes also any custom configuration that you may have done in roundcube. If you want to preserve it, move it some place else instead of deleting it.</p> <pre><code>rm -r data/web/rc\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#remove-the-database","level":3,"title":"Remove the database","text":"<p>Note: This clears all data stored for roundcube. If you want to preserve it, you could use <code>mysqldump</code> before deleting the data, or simply keep the database.</p> <pre><code>docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"DROP USER 'roundcube'@'%';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"DROP DATABASE roundcubemail;\"\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#remove-any-custom-configuration-files-we-added-to-mailcow","level":3,"title":"Remove any custom configuration files we added to mailcow","text":"<p>To determine these, please read through the installation steps and revert what you changed there.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#migration-from-older-mailcow-roundcube-setup","level":2,"title":"Migration from older mailcow roundcube setup","text":"<p>Older versions of this instruction used the mailcow database also for roundcube, with a configured name prefix <code>mailcow_rc1</code> on all roundcube tables.</p> <p>For the migration, it is also assumed that the commands are executed in the mailcow installation directory and that <code>mailcow.conf</code> has been sourced in the shell, see Preparation above. The commands of the different steps build on each other and must be executed in the same shell. Particularly, some steps set shell variables (most importantly the <code>DBROUNDCUBE</code> variable with the database password of the roundcube database user) used in later steps.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#create-new-roundcube-database-user-and-database","level":3,"title":"Create new roundcube database user and database","text":"<p>Follow the steps above to create the roundcube database user and the separate database.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#migrate-roundcube-data-from-mailcow-database","level":3,"title":"Migrate roundcube data from mailcow database","text":"<p>Before starting the database migration, we disable roundcube to avoid further changes to the roundcube database tables during the migration.</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/conf/nginx/site.roundcube.custom\nlocation ^~ /rc/ {\n  return 503;\n}\nEOCONFIG\ndocker compose exec nginx-mailcow nginx -s reload\n</code></pre> <p>Now we copy the roundcube data to the new database. We strip the database table prefix in the process, you may need to adjust <code>mailcow_rc1</code> in case you used a different prefix. It is also possible to keep the prefix (then also keep the respective <code>db_prefix</code> roundcube setting). Then amend the foreign keys.</p> <pre><code>RCTABLES=$(docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -sN mailcow -e \"show tables like 'mailcow_rc1%';\" | tr '\\n\\r' ' ')\ndocker exec $(docker ps -f name=mysql-mailcow -q) /bin/bash -c \"mysqldump -uroot -p${DBROOT} mailcow $RCTABLES | sed 's/mailcow_rc1//' | mysql -uroot -p${DBROOT} roundcubemail\"\nFOREIGNKEYS=$(docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -sN mailcow -e \"SELECT CONCAT('ALTER TABLE \\`', TABLE_NAME, '\\` ', 'DROP FOREIGN KEY \\`', CONSTRAINT_NAME, '\\`;', 'ALTER TABLE \\`', TABLE_NAME, '\\` ', 'ADD FOREIGN KEY \\`', CONSTRAINT_NAME, '\\` (', COLUMN_NAME, ') ', 'REFERENCES \\`', REPLACE(REFERENCED_TABLE_NAME, 'mailcow_rc1', ''), '\\` (', REFERENCED_COLUMN_NAME, ');') FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = 'roundcubemail' AND REFERENCED_TABLE_NAME IS NOT NULL;\")\ndocker exec $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} roundcubemail -e \"$FOREIGNKEYS\"\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#update-roundcube-configuration","level":3,"title":"Update roundcube configuration","text":"<p>Run the following to remove the no longer required <code>db_prefix</code> option. We also enable logging of roundcube by removing the settings <code>log_dir</code> and <code>temp_dir</code> that were part of the old setup instructions.</p> <pre><code>sed -i \"/\\$config\\['db_prefix'\\].*$/d\" data/web/rc/config/config.inc.php\nsed -i \"/\\$config\\['log_dir'\\].*$/d\" data/web/rc/config/config.inc.php\nsed -i \"/\\$config\\['temp_dir'\\].*$/d\" data/web/rc/config/config.inc.php\n</code></pre> <p>We need to adapt the nginx configuration for roundcube to not expose the non-public folders of roundcube, specifically those containing temporary files and log files:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/conf/nginx/site.roundcube.custom\nlocation /rc/ {\n  alias /web/rc/public_html/;\n}\nEOCONFIG\n</code></pre> <p>We can also update the <code>cipher_method</code> to a more secure one but mind that data previously encrypted by roundcube cannot be decrypted anymore afterwards. This specifically affects stored CardDAV passwords if you use RCMCardDAV and your users added custom addressbooks (the preset will be fixed automatically upon next login of the user). If you want to change the <code>cipher_method</code>, run:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;&gt;data/web/rc/config/config.inc.php\n\\$config['cipher_method'] = 'chacha20-poly1305';\nEOCONFIG\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#switch-rcmcarddav-plugin-to-composer-installation-method","level":3,"title":"Switch RCMCardDAV plugin to composer installation method","text":"<p>This is optional but will align your installation with these instructions and enable you to upgrade RCMCardDAV using composer. This is simply done by deleting the carddav plugin from the installation and installing it using composer according to the instructions above, which include the creation of a new RCMCardDAV v5 config. In case you modified your RCMCardDAV configuration file, you may want to backup it before deleting the plugin and carry over your changes to the new configuration afterwards as well.</p> <p>To delete the carddav plugin run the following command, then re-install according to the instructions above:</p> <pre><code>rm -r data/web/rc/plugins/carddav\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#switch-roundcube-to-new-database","level":3,"title":"Switch roundcube to new database","text":"<p>First adapt the roundcube configuration to use the new database. <pre><code>sed -i \"/\\$config\\['db_dsnw'\\].*$/d\" data/web/rc/config/config.inc.php\ncat &lt;&lt;EOCONFIG &gt;&gt;data/web/rc/config/config.inc.php\n\\$config['db_dsnw'] = 'mysql://roundcube:${DBROUNDCUBE}@mysql/roundcubemail';\nEOCONFIG\n</code></pre></p>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#re-enable-roundcube-web-access","level":3,"title":"Re-enable roundcube web access","text":"<p>Execute the chown and chmod commands on sensitive roundcube directories listed in Preparation, to make sure the nginx webserver cannot access files it is not supposed to serve.</p> <p>Then re-enable web access to roundcube by replacing our temporary roundcube custom config for the one described above, and reload the nginx configuration:</p> <pre><code>docker compose exec nginx-mailcow nginx -s reload\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#other-changes","level":3,"title":"Other changes","text":"<p>You must also adapt the configuration of the roundcube password plugin according to this instruction, specifically if you use the password changing functionality, since the old instruction directly changed the password in the database, whereas this version of the instruction uses the mailcow API for the password change.</p> <p>Regarding other changes and additions (e.g., dovecot_client_ip plugin), you can go through the current installation instructions and adapt your configuration accordingly or perform the listed installation steps for new additions.</p> <p>Specifically, consider the following sections:   - Ofelia job for roundcube housekeeping   - Allow plaintext authentication in dovecot,     if you adapt the roundcube configuration to contact dovecot via non-encrypted IMAP connection.   - Forward the client network address to dovecot</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/third_party/roundcube/third_party-roundcube.en/#removing-roundcube-tables-from-mailcow-database","level":3,"title":"Removing roundcube tables from mailcow database","text":"<p>After you have verified that the migration was successful and roundcube works using the separate database, you can remove the roundcube tables from the mailcow database using the following command:</p> <pre><code>docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -sN mailcow -e \"SET SESSION foreign_key_checks = 0; DROP TABLE IF EXISTS $(echo $RCTABLES | sed -e 's/ \\+/,/g');\"\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"de/troubleshooting/debug-admin_login_sogo.de/","level":1,"title":"Debug admin login sogo.de","text":"<p>Dies ist eine experimentelle Funktion, die es Admins und Domänenadmins erlaubt, sich direkt als Mailbox-Benutzer bei SOGo anzumelden, ohne das Passwort des Benutzers zu kennen. Dazu wird ein zusätzlicher Link zu SOGo in der Mailbox-Liste (mailcow UI) angezeigt.</p> <p>Auch mehrere gleichzeitige Admin-Logins auf verschiedene Postfächer sind mit dieser Funktion möglich.</p>","path":["Debug admin login sogo.de"],"tags":[]},{"location":"de/troubleshooting/debug-admin_login_sogo.de/#aktivieren-der-funktion","level":2,"title":"Aktivieren der Funktion","text":"<p>Die Funktion ist standardmäßig deaktiviert. Es kann in der <code>mailcow.conf</code> durch Setzen aktiviert werden: <pre><code>ALLOW_ADMIN_EMAIL_LOGIN=y\n</code></pre> und die betroffenen Container neu erstellen mit</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Debug admin login sogo.de"],"tags":[]},{"location":"de/troubleshooting/debug-admin_login_sogo.de/#nachteile-bei-aktivierung","level":2,"title":"Nachteile bei Aktivierung","text":"<ul> <li>Jeder SOGo-Seiten-Load und jede Active-Sync-Anfrage verursacht eine zusätzliche Ausführung eines internen PHP-Skripts. Dies kann die Ladezeiten von SOGo / EAS beeinträchtigen. In den meisten Fällen sollte dies nicht spürbar sein, aber Sie sollten es im Hinterkopf behalten, wenn Sie Performance-Probleme haben.</li> <li>SOGo zeigt keinen Logout-Link für Admin-Logins an, um sich normal anzumelden, muss man sich von der mailcow UI abmelden, so dass die PHP-Sitzung zerstört wird.</li> <li>Das Abonnieren des Kalenders oder Adressbuchs eines anderen Nutzers, während man als Admin eingeloggt ist, funktioniert nicht. Ebenso wenig funktioniert das Einladen anderer Nutzer zu Kalender-Events. Die Seite wird neu geladen, wenn diese Dinge versucht werden.</li> </ul>","path":["Debug admin login sogo.de"],"tags":[]},{"location":"de/troubleshooting/debug-admin_login_sogo.de/#technische-details","level":2,"title":"Technische Details","text":"<p>Die Option SOGoTrustProxyAuthentication ist auf YES gesetzt, so dass SOGo dem x-webobjects-remote-user-Header vertraut.</p> <p>Dovecot erhält ein zufälliges Master-Passwort, das für alle Mailboxen gültig ist, wenn es vom SOGo-Container verwendet wird.</p> <p>Ein Klick auf den SOGo-Button in der Mailbox-Liste öffnet die Datei sogo-auth.php, die Berechtigungen prüft, Session-Variablen setzt und auf die SOGo-Mailbox umleitet.</p> <p>Jede SOGo, CardDAV, CalDAV und EAS http-Anfrage verursacht einen zusätzlichen, nginx-internen auth_request-Aufruf an sogo-auth.php mit folgendem Verhalten:</p> <ul> <li> <p>Wenn ein basic_auth-Header vorhanden ist, wird das Skript die Anmeldedaten anstelle von SOGo validieren und die folgenden Header bereitstellen: <code>x-webobjects-remote-user</code>, <code>Authorization</code> und <code>x-webobjects-auth-type</code>.</p> </li> <li> <p>Wenn kein basic_auth-Header vorhanden ist, wird das Skript nach einer aktiven mailcow-Admin-Sitzung für den angeforderten E-Mail-Benutzer suchen und die gleichen Header bereitstellen, aber mit dem Dovecot-Master-Passwort, das im <code>Authorization</code>-Header verwendet wird.</p> </li> <li> <p>Wenn beides fehlschlägt, werden die Header leer gesetzt, was SOGo dazu bringt, seine Standard-Authentifizierungsmethoden zu verwenden.</p> </li> </ul> <p>Alle diese Optionen/Verhaltensweisen sind deaktiviert, wenn die Option <code>ALLOW_ADMIN_EMAIL_LOGIN</code> in der Konfiguration nicht aktiviert ist.</p>","path":["Debug admin login sogo.de"],"tags":[]},{"location":"de/troubleshooting/debug-admin_login_sogo.en/","level":1,"title":"Debug admin login sogo.en","text":"<p>This is an experimental feature that allows admins and domain admins to directly  log into SOGo as a mailbox user, without knowing the users password.</p> <p>For this, an additional link to SOGo is displayed in the mailbox list (mailcow UI).</p> <p>Multiple concurrent admin-logins to different mailboxes are also possible when using this feature.</p>","path":["Debug admin login sogo.en"],"tags":[]},{"location":"de/troubleshooting/debug-admin_login_sogo.en/#enabling-the-feature","level":2,"title":"Enabling the feature","text":"<p>The feature is disabled by default. It can be enabled in the <code>mailcow.conf</code> by setting: <pre><code>ALLOW_ADMIN_EMAIL_LOGIN=y\n</code></pre> and recreating the affected containers with</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Debug admin login sogo.en"],"tags":[]},{"location":"de/troubleshooting/debug-admin_login_sogo.en/#drawbacks-when-enabled","level":2,"title":"Drawbacks when enabled","text":"<ul> <li>Each SOGo page-load and each Active-Sync request will cause an additional execution of an internal PHP script. This might impact load-times of SOGo / EAS. In most cases, this should not be noticeable but should be kept in mind if you face any performance issues.</li> <li>SOGo will not display a logout link for admin-logins, to login normally one has to logout from the mailcow UI so the PHP session is destroyed.</li> <li>Subscribing to another user's calendar or address book while logged in as admin does not work. Neither does inviting other users to calendar events. The page will reload when these things are attempted.</li> </ul>","path":["Debug admin login sogo.en"],"tags":[]},{"location":"de/troubleshooting/debug-admin_login_sogo.en/#technical-details","level":2,"title":"Technical details","text":"<p>SOGoTrustProxyAuthentication option is set to YES which makes SOGo trust the x-webobjects-remote-user header.</p> <p>Dovecot will receive a random master-password which is valid for all mailboxes when used by the SOGo container.</p> <p>Clicking on the SOGo button in the mailbox list will open sogo-auth.php which checks permissions, sets session variables and redirects to the SOGo mailbox.</p> <p>Each SOGo, CardDAV, CalDAV and EAS http request will cause an additional, nginx internal auth_request call to sogo-auth.php with the following behavior:</p> <ul> <li> <p>If a basic_auth header is present, the script will validate the credentials in place of SOGo and provide the following headers: <code>x-webobjects-remote-user</code>, <code>Authorization</code> and <code>x-webobjects-auth-type</code>.</p> </li> <li> <p>If no basic_auth header is present, the script will check for an active mailcow admin session for the requested email user and provide the same headers but with the dovecot master password used in the <code>Authorization</code> header.</p> </li> <li> <p>If both fails the headers will be set empty, which makes SOGo use its standard authentication methods.</p> </li> </ul> <p>All of these options / behaviors are disabled if the <code>ALLOW_ADMIN_EMAIL_LOGIN</code> is not enabled in the config.</p>","path":["Debug admin login sogo.en"],"tags":[]},{"location":"de/troubleshooting/debug-attach_service.de/","level":1,"title":"Debug attach service.de","text":"","path":["Debug attach service.de"],"tags":[]},{"location":"de/troubleshooting/debug-attach_service.de/#anhangen-eines-containers-an-ihre-shell","level":2,"title":"Anhängen eines Containers an Ihre Shell","text":"<p>Um einen Container an Ihre Shell anzuhängen, können Sie einfach folgendes ausführen</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec $Dienst_Name /bin/bash\n</code></pre> <pre><code>docker-compose exec $Dienst_Name /bin/bash\n</code></pre>","path":["Debug attach service.de"],"tags":[]},{"location":"de/troubleshooting/debug-attach_service.de/#verbindung-zu-diensten-herstellen","level":3,"title":"Verbindung zu Diensten herstellen","text":"<p>Wenn Sie sich direkt mit einem Dienst / einer Anwendung verbinden wollen, ist es immer eine gute Idee, <code>source mailcow.conf</code> zu benutzen, um alle relevanten Variablen in Ihre Umgebung zu bekommen.</p>","path":["Debug attach service.de"],"tags":[]},{"location":"de/troubleshooting/debug-attach_service.de/#mysql","level":4,"title":"MySQL","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf\ndocker compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME}\n</code></pre> <pre><code>source mailcow.conf\ndocker-compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME}\n</code></pre>","path":["Debug attach service.de"],"tags":[]},{"location":"de/troubleshooting/debug-attach_service.de/#redis","level":4,"title":"Redis","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli\n</code></pre>","path":["Debug attach service.de"],"tags":[]},{"location":"de/troubleshooting/debug-attach_service.de/#dienstbeschreibungen","level":2,"title":"Dienstbeschreibungen","text":"<p>Hier ist eine kurze Übersicht, welcher Container / Dienst was macht:</p> Dienstname Dienstbeschreibungen unbound-mailcow Lokaler (DNSSEC) DNS-Auflöser mysql-mailcow Speichert die SOGo's und die meisten Einstellungen von mailcow postfix-mailcow Empfängt und sendet Mails dovecot-mailcow Benutzer-Logins und Siebfilter redis-mailcow Speicher-Backend für DKIM-Schlüssel und Rspamd rspamd-mailcow Mail-Filter-System. Verwendet für Av-Behandlung, DKIM-Signierung, Spam-Behandlung clamd-mailcow Scannt Anhänge auf Viren olefy-mailcow Scannt angehängte Office-Dokumente auf Makro-Viren solr-mailcow Bietet Volltextsuche in Dovecot sogo-mailcow Webmail-Client, der Microsoft ActiveSync und Cal- / CardDav verarbeitet nginx-mailcow Nginx Remote-Proxy, der alle mailcow-bezogenen HTTP / HTTPS-Anfragen bearbeitet acme-mailcow Automatisiert den Einsatz von HTTPS (SSL/TLS) Zertifikaten memcached-mailcow Internes Caching-System für mailcow-Dienste watchdog-mailcow Ermöglicht die Überwachung von Docker-Containern / Diensten php-fpm-mailcow Betreibt die mailcow Web UI netfilter-mailcow Fail2Ban ähnliche Integration","path":["Debug attach service.de"],"tags":[]},{"location":"de/troubleshooting/debug-attach_service.en/","level":1,"title":"Debug attach service.en","text":"","path":["Debug attach service.en"],"tags":[]},{"location":"de/troubleshooting/debug-attach_service.en/#attaching-a-container-to-your-shell","level":2,"title":"Attaching a Container to your Shell","text":"<p>To attach a container to your shell you can simply run</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec $Dienst_Name /bin/bash\n</code></pre> <pre><code>docker-compose exec $Dienst_Name /bin/bash\n</code></pre>","path":["Debug attach service.en"],"tags":[]},{"location":"de/troubleshooting/debug-attach_service.en/#connecting-to-services","level":3,"title":"Connecting to Services","text":"<p>If you want to connect to a service / application directly it is always a good idea to <code>source mailcow.conf</code> to get all relevant variables into your environment.</p>","path":["Debug attach service.en"],"tags":[]},{"location":"de/troubleshooting/debug-attach_service.en/#mysql","level":4,"title":"MySQL","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf\ndocker compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME}\n</code></pre> <pre><code>source mailcow.conf\ndocker-compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME}\n</code></pre>","path":["Debug attach service.en"],"tags":[]},{"location":"de/troubleshooting/debug-attach_service.en/#redis","level":4,"title":"Redis","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli\n</code></pre>","path":["Debug attach service.en"],"tags":[]},{"location":"de/troubleshooting/debug-attach_service.en/#service-descriptions","level":2,"title":"Service Descriptions","text":"<p>Here is a brief overview of what container / service does what:</p> Service Name Service Descriptions unbound-mailcow Local (DNSSEC) DNS Resolver mysql-mailcow Stores SOGo's and most of mailcow's settings postfix-mailcow Receives and sends mails dovecot-mailcow User logins and sieve filter redis-mailcow Storage back-end for DKIM keys and Rspamd rspamd-mailcow Mail filtering system. Used for av handling, dkim signing, spam handling clamd-mailcow Scans attachments for viruses olefy-mailcow Scans attached office documents for macro-viruses solr-mailcow Provides full-text search in Dovecot sogo-mailcow Webmail client that handles Microsoft ActiveSync and Cal- / CardDav nginx-mailcow Nginx remote proxy that handles all mailcow related HTTP / HTTPS requests acme-mailcow Automates HTTPS (SSL/TLS) certificate deployment memcached-mailcow Internal caching system for mailcow services watchdog-mailcow Allows the monitoring of docker containers / services php-fpm-mailcow Powers the mailcow web UI netfilter-mailcow Fail2Ban like integration","path":["Debug attach service.en"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.de/","level":1,"title":"Debug common problems.de","text":"<p>Hier sind häufige Probleme und mögliche Lösungen:</p>","path":["Debug common problems.de"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.de/#mail-kommt-in-einer-schleife-zu-sich-selbst-zuruck","level":2,"title":"Mail kommt in einer Schleife zu sich selbst zurück.","text":"<p>Bitte überprüfen Sie in Ihrer mailcow UI, ob Sie die Domain als Backup MX eingestellt haben: </p>","path":["Debug common problems.de"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.de/#ich-kann-mails-empfangen-aber-nicht-senden","level":2,"title":"Ich kann Mails empfangen, aber nicht senden","text":"<p>Es gibt viele Gründe, die Sie daran hindern können, Mails zu versenden:</p> <ul> <li>Prüfen Sie, ob Ihre IP-Adresse auf einer schwarzen Liste steht. Sie können dnsbl.info oder einen ähnlichen Dienst verwenden, um Ihre IP-Adresse zu überprüfen.</li> <li>Es gibt einige ISP-Router, die Mail-Ports für nicht auf der Blacklist stehende Domains blockieren. Bitte überprüfen Sie, ob Sie Ihren Server über die Ports <code>465</code> oder <code>587</code> erreichen können:</li> </ul> <pre><code># telnet 74.125.133.27 465\nVersucht 74.125.133.27...\nVerbunden mit 74.125.133.27.\nEscape-Zeichen ist '^]'.\n</code></pre>","path":["Debug common problems.de"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.de/#meine-mails-werden-als-spam-identifiziert","level":2,"title":"Meine Mails werden als Spam identifiziert","text":"<p>Bitte lesen Sie unsere DNS-Konfiguration Anleitung.</p>","path":["Debug common problems.de"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.de/#docker-compose-wirft-seltsame-fehler-aus","level":2,"title":"docker compose wirft seltsame Fehler aus.","text":"<p>... wie:</p> <ul> <li><code>ERROR: Ungültiges Interpolationsformat ...</code></li> <li><code>AttributeError: 'NoneType' Objekt hat kein Attribut 'keys'</code>.</li> <li>ERROR: In der Datei './docker-compose.yml' hat der Dienst 'version' keine Konfigurationsoptionen.</li> </ul> <p>Wenn Sie eine oder ähnliche Meldungen erhalten, während Sie versuchen, mailcow: dockerized auszuführen, überprüfen Sie bitte, ob Sie die aktuellste Version von Docker und docker compose haben.</p>","path":["Debug common problems.de"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.de/#container-xy-ist-ungesund","level":2,"title":"Container XY ist ungesund","text":"<p>Dieser Fehler versucht Ihnen mitzuteilen, dass eine der (Gesundheits-)Bedingungen für einen bestimmten Container nicht erfüllt ist. Daher kann er nicht gestartet werden. Dies kann verschiedene Gründe haben, der häufigste ist ein aktualisierter Git-Klon, aber ein altes Docker-Image oder umgekehrt.</p> <p>Auch eine falsch konfigurierte Firewall kann einen solchen Fehler verursachen. Die Container müssen in der Lage sein, über das Netzwerk 172.22.1.1/24 miteinander zu kommunizieren.</p> <p>Es könnte auch eine falsch verknüpfte Datei sein (z. B. ein SSL-Zertifikat), die den Start eines wichtigen Containers (nginx) verhindert. Prüfen Sie daher immer Ihre Protokolle, um herauszufinden, woher das Problem kommt.</p>","path":["Debug common problems.de"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.de/#adresse-bereits-in-gebrauch","level":2,"title":"Adresse bereits in Gebrauch","text":"<p>Wenn Sie eine Fehlermeldung erhalten wie:</p> <pre><code>ERROR: for postfix-mailcow Cannot start service postfix-mailcow: driver failed programming external connectivity on endpoint mailcowdockerized_postfix-mailcow_1: Error starting userland proxy: listen tcp 0.0.0:25: bind: address already in use\n</code></pre> <p>während Sie versuchen, mailcow: dockerized zu starten / zu installieren, stellen Sie sicher, dass Sie unseren Abschnitt über prerequisites befolgt haben.</p>","path":["Debug common problems.de"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.de/#xyz-kann-keine-verbindung-zu","level":2,"title":"XYZ kann keine Verbindung zu ...","text":"<p>Bitte überprüfen Sie Ihre lokale Firewall! Docker und iptables-basierte Firewalls erstellen manchmal widersprüchliche Regeln. Deaktivieren Sie daher die Firewall auf Ihrem Host, um festzustellen, ob Ihre Verbindungsprobleme durch solche Konflikte verursacht werden. Wenn dies der Fall ist, müssen Sie manuell entsprechende Regeln in Ihrer Host-Firewall erstellen, um die erforderlichen Verbindungen zuzulassen.</p> <p>Wenn Sie Verbindungsprobleme von zu Hause aus haben, überprüfen Sie bitte auch die Firewall Ihres ISP-Routers, da einige von ihnen den E-Mail-Verkehr über die Ports SMTP (587) oder SMTPS (465) blockieren. Es könnte auch sein, dass Ihr ISP die Ports für SUBMISSION (25) blockiert.</p> <p>Während Linux-Benutzer aus einer Vielzahl von Tools<sup>1</sup> wählen können, um zu überprüfen, ob ein Port offen ist, steht Windows-Benutzern standardmäßig nur der PowerShell-Befehl <code>Test-NetConnection -ComputerName host -Port port</code> zur Verfügung.</p> <p>Um Telnet auf einem Windows nach Vista zu aktivieren, lesen Sie bitte diese Anleitung oder geben Sie den folgenden Befehl in einem Terminal mit Administratorrechten ein:</p> <pre><code>dism /online /Enable-Feature /FeatureName:TelnetClient\n</code></pre>","path":["Debug common problems.de"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.de/#inotify-instanz-limit-uberschritten-fur-benutzer-5000-uid-vmail-siehe-453","level":2,"title":"Inotify-Instanz-Limit überschritten für Benutzer 5000 (UID vmail) (siehe #453).","text":"<p>Docker-Container verwenden die inotify-Limits von Docker-Hosts. Wenn Sie sie auf Ihrem Docker-Host setzen, werden sie an den Container weitergegeben.</p>","path":["Debug common problems.de"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.de/#dovecot-startet-standig-neu-siehe-2672","level":2,"title":"Dovecot startet ständig neu (siehe #2672).","text":"<p>Stellen Sie sicher, dass Sie mindestens die folgenden Dateien in <code>data/assets/ssl</code> haben:</p> <pre><code>cert.pem\ndhparams.pem\nkey.pem\n</code></pre> <p>Wenn <code>dhparams.pem</code> fehlt, können Sie es mit Bash</p> <pre><code>openssl dhparam -out data/assets/ssl/dhparams.pem 4096\n</code></pre>","path":["Debug common problems.de"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.de/#rspamd-meldet-cannot-open-hyperscan-cache-file-varlibrspamdhs-compiled-for-a-different-platform","level":2,"title":"Rspamd meldet: cannot open hyperscan cache file /var/lib/rspamd/{...}.hs: compiled for a different platform","text":"<p>Bei einer Migration von mailcow auf ein anderes System (meistens mit einer anderen CPU) kann es unter Umständen passieren, dass Rspamd meldet er könne einige (evtl. alle) <code>.hs</code> Dateien nicht laden, da diese für eine andere Plattform (CPU) kompiliert wurden.</p> <p>Dies hängt mit Hyperscan<sup>2</sup> zusammen einer Intel Technik zum vorkompilieren von regex Schemata, welche Rspamd einsetzt.</p> <p>Diese Funktion bringt einen erheblichen Performance Boost mit sich und ist deswegen stark in Rspamd verankert.</p> <p>Um diesen Fehler zu beheben, müssen alle <code>.hs</code> und <code>.hsmp</code> Dateien aus dem Rspamd Verzeichnis gelöscht werden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd MAILCOW_ROOT # Meistens /opt/mailcow-dockerized\ndocker compose exec rspamd-mailcow bash\nrm -rf /var/lib/rspamd/*.hs\nrm -rf /var/lib/rspamd/*.hsmp\n</code></pre> <pre><code>cd MAILCOW_ROOT # Meistens /opt/mailcow-dockerized\ndocker-compose exec rspamd-mailcow bash\nrm -rf /var/lib/rspamd/*.hs\nrm -rf /var/lib/rspamd/*.hsmp\n</code></pre> <p>Anschließend Rspamd neustarten mit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Nun kompiliert Rspamd die besagten Regex Maps wieder neu mit Hyperscan.</p> <ol> <li> <p>netcat, nmap, openssl, telnet, etc. ↩</p> </li> <li> <p>Hyperscan ↩</p> </li> </ol>","path":["Debug common problems.de"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.en/","level":1,"title":"Debug common problems.en","text":"<p>Here we list common problems and possible solutions:</p>","path":["Debug common problems.en"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.en/#mail-loops-back-to-myself","level":2,"title":"Mail loops back to myself","text":"<p>Please check in your mailcow UI if you made the domain a backup MX:</p> <p></p>","path":["Debug common problems.en"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.en/#i-can-receive-but-not-send-mails","level":2,"title":"I can receive but not send mails","text":"<p>There are a lot of things that could prevent you from sending mail:</p> <ul> <li>Check if your IP address is on any blacklists. You could use dnsbl.info or any other similar service to check for your IP address.</li> <li>There are some consumer ISP routers out there, that block mail ports for non whitelisted domains. Please check if you can reach your server on the ports <code>465</code> or <code>587</code>:</li> </ul> <pre><code># telnet 74.125.133.27 465\nTrying 74.125.133.27...\nConnected to 74.125.133.27.\nEscape character is '^]'.\n</code></pre>","path":["Debug common problems.en"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.en/#my-mails-are-identified-as-spam","level":2,"title":"My mails are identified as Spam","text":"<p>Please read our guide on DNS configuration.</p>","path":["Debug common problems.en"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.en/#docker-compose-throws-weird-errors","level":2,"title":"docker compose throws weird errors","text":"<p>... like:</p> <ul> <li><code>ERROR: Invalid interpolation format ...</code></li> <li><code>AttributeError: 'NoneType' object has no attribute 'keys'</code>.</li> <li><code>ERROR: In file './docker-compose.yml' service 'version' doesn't have any configuration options</code>.</li> </ul> <p>When you encounter one or similar messages while trying to run mailcow: dockerized please check if you have the latest version of Docker and docker compose</p>","path":["Debug common problems.en"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.en/#container-xy-is-unhealthy","level":2,"title":"Container XY is unhealthy","text":"<p>This error tries to tell you that one of the (health) conditions for a certain container are not met. Therefore it can't be started. This can have several reasons, the most common one is an updated git clone but old docker image or vice versa.</p> <p>A wrong configured firewall could also cause such a failure. The containers need to be able to talk to each other over the network 172.22.1.1/24.</p> <p>It might also be wrongly linked file (i.e. SSL certificate) that prevents a crucial container (nginx) from starting, so always check your logs to get an idea where your problem is coming from.</p>","path":["Debug common problems.en"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.en/#address-already-in-use","level":2,"title":"Address already in use","text":"<p>If you get an error message like:</p> <pre><code>ERROR: for postfix-mailcow  Cannot start service postfix-mailcow: driver failed programming external     connectivity on endpoint mailcowdockerized_postfix-mailcow_1: Error starting userland proxy: listen tcp 0.0.0.0:25: bind: address already in use\n</code></pre> <p>while trying to start / install mailcow: dockerized, make sure you've followed our section on the prerequisites.</p>","path":["Debug common problems.en"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.en/#xyz-cant-connect-to","level":2,"title":"XYZ can't connect to ...","text":"<p>Please check your local firewall! Docker and iptables-based firewalls sometimes create conflicting rules, so disable the firewall on your host to determine whether your connection issues are caused by such conflicts. If they are, you need to manually create appropriate rules in your host firewall to permit the necessary connections.</p> <p>If you experience connection problems from home, please check your ISP router's firewall too, some of them block mail traffic on the SMTP (587) or SMTPS (465) ports. It could also be, that your ISP is blocking the ports for SUBMISSION (25).</p> <p>While Linux users can chose from a variety of tools<sup>1</sup> to check if a port is open, the Windows user has only the PowerShell command <code>Test-NetConnection -ComputerName host -Port port</code> available by default.</p> <p>To enable telnet on a Windows after Vista please check this guide or enter the following command in an terminal with administrator privileges:</p> <pre><code>dism /online /Enable-Feature /FeatureName:TelnetClient\n</code></pre>","path":["Debug common problems.en"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.en/#inotify-instance-limit-for-user-5000-uid-vmail-exceeded-see-453","level":2,"title":"Inotify instance limit for user 5000 (UID vmail) exceeded (see #453)","text":"<p>Docker containers use the Docker hosts inotify limits. Setting them on your Docker host will pass them to the container.</p>","path":["Debug common problems.en"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.en/#dovecot-keeps-restarting-see-2672","level":2,"title":"Dovecot keeps restarting (see #2672)","text":"<p>Check that you have at least the following files in <code>data/assets/ssl</code>:</p> <pre><code>cert.pem\ndhparams.pem\nkey.pem\n</code></pre> <p>If <code>dhparams.pem</code> is missing, you can generate it with</p> <pre><code>openssl dhparam -out data/assets/ssl/dhparams.pem 4096\n</code></pre>","path":["Debug common problems.en"],"tags":[]},{"location":"de/troubleshooting/debug-common_problems.en/#rspamd-reports-cannot-open-hyperscan-cache-file-varlibrspamdhs-compiled-for-a-different-platform","level":2,"title":"Rspamd reports: cannot open hyperscan cache file /var/lib/rspamd/{...}.hs: compiled for a different platform","text":"<p>When migrating mailcow to another system (usually with a different CPU), Rspamd may report that it cannot load some (possibly all) <code>.hs</code> files because they were compiled for a different platform (CPU).</p> <p>This is related to Hyperscan<sup>2</sup>, an Intel technique for precompiling regex schemas that Rspamd uses.</p> <p>This feature provides a significant performance boost and is therefore heavily embedded in Rspamd.</p> <p>To fix this bug, all <code>.hs</code> and <code>.hsmp</code> files must be deleted from the rspamd directory:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd MAILCOW_ROOT # Usually /opt/mailcow-dockerized\ndocker compose exec rspamd-mailcow bash\nrm -rf /var/lib/rspamd/*.hs\nrm -rf /var/lib/rspamd/*.hsmp\n</code></pre> <pre><code>cd MAILCOW_ROOT # Usually /opt/mailcow-dockerized\ndocker-compose exec rspamd-mailcow bash\nrm -rf /var/lib/rspamd/*.hs\nrm -rf /var/lib/rspamd/*.hsmp\n</code></pre> <p>Restart Rspamd afterwards:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Now Rspamd recompiles the said regex maps again with Hyperscan.</p> <ol> <li> <p>netcat, nmap, openssl, telnet, etc. ↩</p> </li> <li> <p>Hyperscan ↩</p> </li> </ol>","path":["Debug common problems.en"],"tags":[]},{"location":"de/troubleshooting/debug-logs.de/","level":1,"title":"Debug logs.de","text":"<p>Warnung</p> <p>Dieser Abschnitt gilt nur für Docker's Standard-Logging-Treiber (JSON).</p> <p>Um die Logs aller mailcow: dockerized bezogenen Container zu sehen, können Sie den folgenden Befehl innerhalb Ihres mailcow-dockerized Ordners verwenden, der Ihre <code>mailcow.conf</code> enthält:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs\n</code></pre> <pre><code>docker-compose logs\n</code></pre> <p>Dies ist normalerweise ein bisschen viel, aber Sie können die Ausgabe mit <code>--tail=100</code> auf die letzten 100 Zeilen pro Container kürzen, oder ein <code>-f</code> hinzufügen, um die Live-Ausgabe aller Ihrer Dienste zu verfolgen.</p> <p>Um die Logs eines bestimmten Dienstes zu sehen, kann man folgendes verwenden: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs [options] $service_name\n</code></pre> <pre><code>docker-compose logs [options] $service_name\n</code></pre> <p>Info</p> <p>Die verfügbaren Optionen für den Befehl obrigen Befehlsind:</p> <ul> <li>-no-color: Erzeugt eine einfarbige Ausgabe.</li> <li>-f: Der Log-Ausgabe folgen.</li> <li>-t: Zeitstempel anzeigen.</li> <li>--tail=\"all \": Anzahl der Zeilen, die ab dem Ende der Protokolle für jeden Container angezeigt werden sollen.</li> </ul>","path":["Debug logs.de"],"tags":[]},{"location":"de/troubleshooting/debug-logs.en/","level":1,"title":"Debug logs.en","text":"<p>Warning</p> <p>This section only applies for Dockers default logging driver (JSON).</p> <p>To view the logs of all mailcow: dockerized related containers, you can use the following command inside your mailcow-dockerized folder that contains your <code>mailcow.conf</code>. </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs\n</code></pre> <pre><code>docker-compose logs\n</code></pre> <p>This is usually a bit much, but you could trim the output with <code>--tail=100</code> to the last 100 lines per container, or add a <code>-f</code> to follow the live output of all your services.</p> <p>To view the logs of a specific service you can use the following:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs [options] $service_name\n</code></pre> <pre><code>docker-compose logs [options] $service_name\n</code></pre> <p>Info</p> <p>The available options for the previous commands are:</p> <ul> <li>--no-color: Produce monochrome output.</li> <li>-f: Follow the log output.</li> <li>-t: Show timestamps.</li> <li>--tail=\"all\": Number of lines to show from the end of the logs for each container.</li> </ul>","path":["Debug logs.en"],"tags":[]},{"location":"de/troubleshooting/debug-mysql_aria.de/","level":1,"title":"Debug mysql aria.de","text":"","path":["Debug mysql aria.de"],"tags":[]},{"location":"de/troubleshooting/debug-mysql_aria.de/#mariadb-aria-wiederherstellung-nach-absturz","level":2,"title":"MariaDB: Aria-Wiederherstellung nach Absturz","text":"<p>Wenn Ihr Server abgestürzt ist und MariaDB eine Fehlermeldung ähnlich <code>[ERROR] mysqld: Aria recovery failed. Please run aria_chk -r on all Aria tables (*.MAI) and delete all aria_log.######## files</code>, können Sie Folgendes versuchen, um die Datenbank in einen gesunden Zustand zu bringen:</p> <p>Starten Sie den Stack und warten Sie, bis mysql-mailcow beginnt, einen Neustart zu melden. Überprüfen Sie dies, indem Sie den folgenden Befehl ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose ps\n</code></pre> <pre><code>docker-compose ps\n</code></pre> <p>Führen Sie nun die folgenden Befehle aus:</p> <p>Stoppen Sie den Stack, nicht \"down\" ausführen</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose stop\n</code></pre> <pre><code>docker-compose stop\n</code></pre> <p>Führen Sie eine Bash in dem gestoppten Container als Benutzer mysql aus</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose run --rm --entrypoint '/bin/sh -c \"gosu mysql bash\"' mysql-mailcow\n</code></pre> <pre><code>docker-compose run --rm --entrypoint '/bin/sh -c \"gosu mysql bash\"' mysql-mailcow\n</code></pre> <p>cd in das SQL-Datenverzeichnis <pre><code>cd /var/lib/mysql\n</code></pre></p> <p>aria_chk ausführen <pre><code>aria_chk --check --force */*.MAI\n</code></pre> Löschen der aria-Logdateien <pre><code>rm aria_log.*\n</code></pre></p> <p>Führen Sie nun einen kompletten Stack neustart durch:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Debug mysql aria.de"],"tags":[]},{"location":"de/troubleshooting/debug-mysql_aria.en/","level":1,"title":"Debug mysql aria.en","text":"","path":["Debug mysql aria.en"],"tags":[]},{"location":"de/troubleshooting/debug-mysql_aria.en/#mariadb-aria-recovery-after-crash","level":2,"title":"MariaDB: Aria recovery after crash","text":"<p>If your server crashed and MariaDB logs an error similar to <code>[ERROR] mysqld: Aria recovery failed. Please run aria_chk -r on all Aria tables (*.MAI) and delete all aria_log.######## files</code> you may want to try the following to recover the database to a healthy state:</p> <p>Start the stack and wait until mysql-mailcow begins to report a restart. Check this with the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose ps\n</code></pre> <pre><code>docker-compose ps\n</code></pre> <p>Now exec the following commands:</p> <p>Stop the stack, don't run \"down\"</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose stop\n</code></pre> <pre><code>docker-compose stop\n</code></pre> <p>Run a bash in the stopped container as user mysql</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose run --rm --entrypoint '/bin/sh -c \"gosu mysql bash\"' mysql-mailcow\n</code></pre> <pre><code>docker-compose run --rm --entrypoint '/bin/sh -c \"gosu mysql bash\"' mysql-mailcow\n</code></pre> <p>cd to the SQL data directory</p> <pre><code>cd /var/lib/mysql\n</code></pre> <p>Run aria_chk</p> <pre><code>aria_chk --check --force */*.MAI\n</code></pre> <p>Delete aria log files</p> <pre><code>rm aria_log.*\n</code></pre> <p>Execute a complete stack restart using the following commands:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Debug mysql aria.en"],"tags":[]},{"location":"de/troubleshooting/debug-mysql_upgrade.de/","level":1,"title":"Debug mysql upgrade.de","text":"","path":["Debug mysql upgrade.de"],"tags":[]},{"location":"de/troubleshooting/debug-mysql_upgrade.de/#fuhren-sie-ein-manuelles-mysql_upgrade-durch","level":2,"title":"Führen Sie ein manuelles mysql_upgrade durch.","text":"<p>Dieser Schritt ist normalerweise nicht notwendig. </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose stop mysql-mailcow watchdog-mailcow\ndocker compose run --rm --entrypoint '/bin/sh -c \"gosu mysql mysqld --skip-grant-tables &amp; sleep 10 &amp;&amp; bash &amp;&amp; exit 0\"' mysql-mailcow\n</code></pre> <pre><code>docker-compose stop mysql-mailcow watchdog-mailcow\ndocker-compose run --rm --entrypoint '/bin/sh -c \"gosu mysql mysqld --skip-grant-tables &amp; sleep 10 &amp;&amp; bash &amp;&amp; exit 0\"' mysql-mailcow\n</code></pre> <p>Sobald die SQL-Shell gestartet wurde, führen Sie <code>mysql_upgrade</code> aus und verlassen den Container:</p> <pre><code>mysql_upgrade\nexit\n</code></pre>","path":["Debug mysql upgrade.de"],"tags":[]},{"location":"de/troubleshooting/debug-mysql_upgrade.en/","level":1,"title":"Debug mysql upgrade.en","text":"","path":["Debug mysql upgrade.en"],"tags":[]},{"location":"de/troubleshooting/debug-mysql_upgrade.en/#run-a-manual-mysql_upgrade","level":2,"title":"Run a manual mysql_upgrade","text":"<p>This step is usually not necessary. </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose stop mysql-mailcow watchdog-mailcow\ndocker compose run --rm --entrypoint '/bin/sh -c \"gosu mysql mysqld --skip-grant-tables &amp; sleep 10 &amp;&amp; bash &amp;&amp; exit 0\"' mysql-mailcow\n</code></pre> <pre><code>docker-compose stop mysql-mailcow watchdog-mailcow\ndocker-compose run --rm --entrypoint '/bin/sh -c \"gosu mysql mysqld --skip-grant-tables &amp; sleep 10 &amp;&amp; bash &amp;&amp; exit 0\"' mysql-mailcow\n</code></pre> <p>As soon as the SQL shell spawned, run <code>mysql_upgrade</code> and exit the container:</p> <pre><code>mysql_upgrade\nexit\n</code></pre>","path":["Debug mysql upgrade.en"],"tags":[]},{"location":"de/troubleshooting/debug-resend-quarantine-notifications.de/","level":1,"title":"Debug resend quarantine notifications.de","text":"<p>Um eine Quarantäne Benachrichtigung erneut zu versenden geben Sie folgenden Befehl ein:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow bash\nmysql -umailcow -p$DBPASS mailcow -e \"update quarantine set notified = 0;\"\nredis-cli -h redis DEL Q_LAST_NOTIFIED\nquarantine_notify.py\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow bash\nmysql -umailcow -p$DBPASS mailcow -e \"update quarantine set notified = 0;\"\nredis-cli -h redis DEL Q_LAST_NOTIFIED\nquarantine_notify.py\n</code></pre> <p>Info</p> <p>Wir empfehlen die Verwendung dieses Befehles NUR zum debugging Prozess, da die Benachrichtigung im Normalfall automatisiert, anhand der pro Mailbox gesetzten Einstellungen, ausgelöst wird.</p>","path":["Debug resend quarantine notifications.de"],"tags":[]},{"location":"de/troubleshooting/debug-resend-quarantine-notifications.en/","level":1,"title":"Debug resend quarantine notifications.en","text":"<p>To resend a quarantine notification, enter the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow bash\nmysql -umailcow -p$DBPASS mailcow -e \"update quarantine set notified = 0;\"\nredis-cli -h redis DEL Q_LAST_NOTIFIED\nquarantine_notify.py\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow bash\nmysql -umailcow -p$DBPASS mailcow -e \"update quarantine set notified = 0;\"\nredis-cli -h redis DEL Q_LAST_NOTIFIED\nquarantine_notify.py\n</code></pre> <p>Info</p> <p>We recommend to use this command ONLY for debugging process as the notification is normally triggered automatically based on the settings set for each mailbox.</p>","path":["Debug resend quarantine notifications.en"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.de/","level":1,"title":"Debug reset pw.de","text":"","path":["Debug reset pw.de"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.de/#mailcow-admin-konto","level":2,"title":"mailcow Admin-Konto","text":"<p>Setzt den mailcow Admin Account auf ein zufälliges Passwort zurück. Ältere mailcow: dockerisierte Installationen können das <code>mailcow-reset-admin.sh</code> Skript in ihrem mailcow Stammverzeichnis (mailcow_path) finden.</p> <pre><code>cd mailcow_pfad\n./helper-scripts/mailcow-reset-admin.sh\n</code></pre>","path":["Debug reset pw.de"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.de/#mysql-passworter-zurucksetzen","level":2,"title":"MySQL-Passwörter zurücksetzen","text":"<p>Stoppen Sie den Stack, indem Sie den folgenden Befehl ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose stop\n</code></pre> <pre><code>docker-compose stop\n</code></pre> <p>Wenn die Container heruntergefahren sind, führen Sie diesen Befehl aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose run --rm --entrypoint '/bin/sh -c \"gosu mysql mysqld --skip-grant-tables &amp; sleep 10 &amp;&amp; mysql -hlocalhost -uroot &amp;&amp; exit 0\"' mysql-mailcow\n</code></pre> <pre><code>docker-compose run --rm --entrypoint '/bin/sh -c \"gosu mysql mysqld --skip-grant-tables &amp; sleep 10 &amp;&amp; mysql -hlocalhost -uroot &amp;&amp; exit 0\"' mysql-mailcow\n</code></pre>","path":["Debug reset pw.de"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.de/#1-datenbank-name-finden","level":3,"title":"1. Datenbank-Name finden","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code># source mailcow.conf\n# docker compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME}\nMariaDB [(none)]&gt; show databases;\n+--------------------+\n| Database |\n+--------------------+\n| information_schema |\n| mailcow_database | &lt;=====\n| mysql |\n| performance_schema |\n+--------------------+\n4 rows in set (0.00 sec)\n</code></pre> <pre><code># source mailcow.conf\n# docker-compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME}\nMariaDB [(none)]&gt; show databases;\n+--------------------+\n| Database |\n+--------------------+\n| information_schema |\n| mailcow_database | &lt;=====\n| mysql |\n| performance_schema |\n+--------------------+\n4 rows in set (0.00 sec)\n</code></pre>","path":["Debug reset pw.de"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.de/#2-einen-oder-mehrere-benutzer-zurucksetzen","level":3,"title":"2. Einen oder mehrere Benutzer zurücksetzen","text":"","path":["Debug reset pw.de"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.de/#21-maria-db-104-altere-mailcow-installationen","level":4,"title":"2.1 Maria DB &lt; 10.4 (ältere mailcow-Installationen)","text":"<p>Sowohl \"password\" als auch \"authentication_string\" existieren. Derzeit wird \"password\" verwendet, aber besser ist es, beide zu setzen.</p> <pre><code>MariaDB [(none)]&gt; SELECT user FROM mysql.user;\n+--------------+\n| user |\n+--------------+\n| mailcow | &lt;=====\n| root |\n+--------------+\n2 rows in set (0.00 sec)\n\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\nMariaDB [(none)]&gt; UPDATE mysql.user SET authentication_string = PASSWORD('gotr00t'), password = PASSWORD('gotr00t') WHERE User = 'root';\nMariaDB [(none)]&gt; UPDATE mysql.user SET authentication_string = PASSWORD('mookuh'), password = PASSWORD('mookuh') WHERE User = 'mailcow' AND Host = '%';\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\n</code></pre>","path":["Debug reset pw.de"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.de/#22-maria-db-104-aktuelle-mailcows","level":4,"title":"2.2 Maria DB &gt;= 10.4 (aktuelle mailcows)","text":"<pre><code>MariaDB [(none)]&gt; SELECT user FROM mysql.user;\n+--------------+\n| user |\n+--------------+\n| mailcow | &lt;=====\n| root |\n+--------------+\n2 rows in set (0.00 sec)\n\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\nMariaDB [(none)]&gt; ALTER USER 'mailcow'@'%' IDENTIFIED BY 'mookuh';\nMariaDB [(none)]&gt; ALTER USER 'root'@'%' IDENTIFIED BY 'gotr00t'; MariaDB [(none)]&gt; ALTER USER 'root'@'%' IDENTIFIED BY 'gotr00t';\nMariaDB [(none)]&gt; ALTER USER 'root'@'localhost' IDENTIFIED BY 'gotr00t'; MariaDB [(none)]&gt; ALTER USER 'root'@'localhost' IDENTIFIED BY 'gotr00t';\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\n</code></pre>","path":["Debug reset pw.de"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.de/#zwei-faktor-authentifizierung-entfernen","level":2,"title":"Zwei-Faktor-Authentifizierung entfernen","text":"","path":["Debug reset pw.de"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.de/#fur-mailcow-webui","level":3,"title":"Für mailcow WebUI:","text":"<p>Dies funktioniert ähnlich wie das Zurücksetzen eines MySQL-Passworts, jetzt machen wir es vom Host aus, ohne uns mit dem MySQL CLI zu verbinden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf\ndocker compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME} -e \"DELETE FROM tfa WHERE username='YOUR_USERNAME';\"\n</code></pre> <pre><code>source mailcow.conf\ndocker-compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME} -e \"DELETE FROM tfa WHERE username='YOUR_USERNAME';\"\n</code></pre>","path":["Debug reset pw.de"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.de/#fur-sogo","level":3,"title":"Für SOGo:","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec -u sogo sogo-mailcow sogo-tool user-preferences set defaults user@example.com SOGoGoogleAuthenticatorEnabled '{\"SOGoGoogleAuthenticatorEnabled\":0}'\n</code></pre> <pre><code>docker-compose exec -u sogo sogo-mailcow sogo-tool user-preferences set defaults user@example.com SOGoGoogleAuthenticatorEnabled '{\"SOGoGoogleAuthenticatorEnabled\":0}'\n</code></pre>","path":["Debug reset pw.de"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.en/","level":1,"title":"Debug reset pw.en","text":"","path":["Debug reset pw.en"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.en/#mailcow-admin-account","level":2,"title":"mailcow Admin Account","text":"<p>Resets the mailcow admin account to a random password. Older mailcow: dockerized installations may find the <code>mailcow-reset-admin.sh</code> script in their mailcow root directory (mailcow_path).</p> <pre><code>cd mailcow_path\n./helper-scripts/mailcow-reset-admin.sh\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.en/#reset-mysql-passwords","level":2,"title":"Reset MySQL Passwords","text":"<p>Stop the stack by running:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose stop\n</code></pre> <pre><code>docker-compose stop\n</code></pre> <p>When the containers came to a stop, run this command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose run --rm --entrypoint '/bin/sh -c \"gosu mysql mysqld --skip-grant-tables &amp; sleep 10 &amp;&amp; mysql -hlocalhost -uroot &amp;&amp; exit 0\"' mysql-mailcow\n</code></pre> <pre><code>docker-compose run --rm --entrypoint '/bin/sh -c \"gosu mysql mysqld --skip-grant-tables &amp; sleep 10 &amp;&amp; mysql -hlocalhost -uroot &amp;&amp; exit 0\"' mysql-mailcow\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.en/#1-find-database-name","level":3,"title":"1. Find database name","text":"<pre><code># source mailcow.conf\n# docker compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME}\nMariaDB [(none)]&gt; show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mailcow_database   | &lt;=====\n| mysql              |\n| performance_schema |\n+--------------------+\n4 rows in set (0.00 sec)\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.en/#2-reset-one-or-more-users","level":3,"title":"2. Reset one or more users","text":"","path":["Debug reset pw.en"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.en/#21-maria-db-104-older-mailcow-installations","level":4,"title":"2.1 Maria DB &lt; 10.4 (older mailcow installations)","text":"<p>Both \"password\" and \"authentication_string\" exist. Currently \"password\" is used, but better set both.</p> <pre><code>MariaDB [(none)]&gt; SELECT user FROM mysql.user;\n+--------------+\n| user         |\n+--------------+\n| mailcow      | &lt;=====\n| root         |\n+--------------+\n2 rows in set (0.00 sec)\n\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\nMariaDB [(none)]&gt; UPDATE mysql.user SET authentication_string = PASSWORD('gotr00t'), password = PASSWORD('gotr00t') WHERE User = 'root';\nMariaDB [(none)]&gt; UPDATE mysql.user SET authentication_string = PASSWORD('mookuh'), password = PASSWORD('mookuh') WHERE User = 'mailcow' AND Host = '%';\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.en/#22-maria-db-104-current-mailcows","level":4,"title":"2.2 Maria DB &gt;= 10.4 (current mailcows)","text":"<pre><code>MariaDB [(none)]&gt; SELECT user FROM mysql.user;\n+--------------+\n| user         |\n+--------------+\n| mailcow      | &lt;=====\n| root         |\n+--------------+\n2 rows in set (0.00 sec)\n\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\nMariaDB [(none)]&gt; ALTER USER 'mailcow'@'%' IDENTIFIED BY 'mookuh';\nMariaDB [(none)]&gt; ALTER USER 'root'@'%' IDENTIFIED BY 'gotr00t';\nMariaDB [(none)]&gt; ALTER USER 'root'@'localhost' IDENTIFIED BY 'gotr00t';\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.en/#remove-two-factor-authentication","level":2,"title":"Remove Two-Factor Authentication","text":"","path":["Debug reset pw.en"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.en/#for-mailcow-webui","level":3,"title":"For mailcow WebUI:","text":"<p>This works similar to resetting a MySQL password, now we do it from the host without connecting to the MySQL CLI:</p> <pre><code>source mailcow.conf\ndocker compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME} -e \"DELETE FROM tfa WHERE username='YOUR_USERNAME';\"\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"de/troubleshooting/debug-reset_pw.en/#for-sogo","level":3,"title":"For SOGo:","text":"<pre><code>docker compose exec -u sogo sogo-mailcow sogo-tool user-preferences set defaults user@example.com SOGoGoogleAuthenticatorEnabled '{\"SOGoGoogleAuthenticatorEnabled\":0}'\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"de/troubleshooting/debug-reset_tls.de/","level":1,"title":"Debug reset tls.de","text":"<p>Sollten Sie Probleme mit Ihrem Zertifikat, Schlüssel oder Let's Encrypt-Konto haben, versuchen Sie bitte, die TLS-Assets zurückzusetzen:</p> <pre><code>source mailcow.conf\ndocker compose down\nrm -rf data/assets/ssl\nmkdir data/assets/ssl\nopenssl req -x509 -newkey rsa:4096 -keyout data/assets/ssl-example/key.pem -out data/assets/ssl-example/cert.pem -days 365 -subj \"/C=DE/ST=NRW/L=Willich/O=mailcow/OU=mailcow/CN=${MAILCOW_HOSTNAME}\" -sha256 -nodes\ncp -n -d data/assets/ssl-example/*.pem data/assets/ssl/\ndocker compose up -d\n</code></pre> <p>Dies wird mailcow stoppen, die benötigten Variablen beschaffen, ein selbstsigniertes Zertifikat erstellen und mailcow starten.</p> <p>Wenn Sie Let's Encrypt verwenden, sollten Sie vorsichtig sein, da Sie ein neues Konto und einen neuen Satz von Zertifikaten erstellen werden. Sie werden früher oder später auf ein Ratelimit stoßen.</p> <p>Bitte beachten Sie auch, dass frühere TLSA-Datensätze ungültig werden.</p>","path":["Debug reset tls.de"],"tags":[]},{"location":"de/troubleshooting/debug-reset_tls.en/","level":1,"title":"Debug reset tls.en","text":"<p>In case you encounter problems with your certificate, key or Let's Encrypt account, please try to reset the TLS assets:</p> <pre><code>source mailcow.conf\ndocker compose down\nrm -rf data/assets/ssl\nmkdir data/assets/ssl\nopenssl req -x509 -newkey rsa:4096 -keyout data/assets/ssl-example/key.pem -out data/assets/ssl-example/cert.pem -days 365 -subj \"/C=DE/ST=NRW/L=Willich/O=mailcow/OU=mailcow/CN=${MAILCOW_HOSTNAME}\" -sha256 -nodes\ncp -n -d data/assets/ssl-example/*.pem data/assets/ssl/\ndocker compose up -d\n</code></pre> <p>This will stop mailcow, source the variables we need, create a self-signed certificate and start mailcow.</p> <p>If you use Let's Encrypt you should be careful as you will create a new account and a new set of certificates. You will run into a ratelimit sooner or later.</p> <p>Please also note that previous TLSA records will be invalid.</p>","path":["Debug reset tls.en"],"tags":[]},{"location":"de/troubleshooting/debug-rm_volumes.de/","level":1,"title":"Debug rm volumes.de","text":"<p>Es kann sein, dass Sie einen Satz persistenter Daten entfernen wollen, um einen Konflikt zu lösen oder um neu zu beginnen.</p> <p><code>mailcowdockerized</code> kann variieren und hängt von Ihrem Compose-Projektnamen ab (wenn er unverändert ist, ist <code>mailcowdockerized</code> der richtige Wert). Wenn Sie sich unsicher sind, führen Sie <code>docker volume ls</code> aus, um eine vollständige Liste zu erhalten.</p> <p>Löschen Sie ein einzelnes Volume:</p> <pre><code>docker volume rm mailcowdockerized_${VOLUME_NAME}\n</code></pre> <ul> <li>Entfernen Sie Volume <code>mysql-vol-1</code>, um alle MySQL-Daten zu entfernen.</li> <li>Entfernen Sie Volume <code>redis-vol-1</code> um alle Redis Daten zu entfernen.</li> <li>Volume <code>vmail-vol-1</code> entfernen, um alle Inhalte von <code>/var/vmail</code> zu entfernen, die in <code>dovecot-mailcow</code> eingebunden sind.</li> <li>Entfernen Sie das Volume <code>rspamd-vol-1</code>, um alle Rspamd-Daten zu entfernen.</li> <li>Entfernen Sie Volume <code>crypt-vol-1</code>, um alle Crypto-Daten zu entfernen. Dies wird alle Mails unlesbar machen.</li> </ul> <p>Alternativ dazu wird die Ausführung des folgenden Befehles alle mailcow: dockerized volumes zerstören und alle zugehörigen Container und Netzwerke löschen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down -v\n</code></pre> <pre><code>docker-compose down -v\n</code></pre>","path":["Debug rm volumes.de"],"tags":[]},{"location":"de/troubleshooting/debug-rm_volumes.en/","level":1,"title":"Debug rm volumes.en","text":"<p>You may want to remove a set of persistent data to resolve a conflict or to start over.</p> <p><code>mailcowdockerized</code> can vary and depends on your compose project name (if it's unchanged, <code>mailcowdockerized</code> is the correct value). If you are unsure about volume names, run <code>docker volume ls</code> for a full list.</p> <p>Delete a single volume:</p> <pre><code>docker volume rm mailcowdockerized_${VOLUME_NAME}\n</code></pre> <ul> <li>Remove volume <code>mysql-vol-1</code> to remove all MySQL data.</li> <li>Remove volume <code>redis-vol-1</code> to remove all Redis data.</li> <li>Remove volume <code>vmail-vol-1</code> to remove all contents of <code>/var/vmail</code> mounted to <code>dovecot-mailcow</code>.</li> <li>Remove volume <code>rspamd-vol-1</code> to remove all Rspamd data.</li> <li>Remove volume <code>crypt-vol-1</code> to remove all crypto data. This will render all mails unreadable.</li> </ul> <p>Alternatively, running the following command will destroy all mailcow: dockerized volumes and delete any related containers and networks:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down -v\n</code></pre> <pre><code>docker-compose down -v\n</code></pre>","path":["Debug rm volumes.en"],"tags":[]},{"location":"de/troubleshooting/debug-rspamd_memory_leaks.de/","level":1,"title":"Debug rspamd memory leaks.de","text":"<p>Eine kurze Anleitung, um einen schlecht funktionierenden Rspamd tiefgehend zu analysieren.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow bash\n\nif ! grep -qi 'apt-stable-asan' /etc/apt/sources.list.d/rspamd.list; then\n  sed -i 's/apt-stabil/apt-stabil-asan/i' /etc/apt/sources.list.d/rspamd.list\nfi\n\napt-get update ; apt-get upgrade rspamd\n\nnano /docker-entrypoint.sh\n\n# Fügen Sie vor \"exec \"$@\"\" die folgenden Zeilen ein:\n\nexport G_SLICE=always-malloc\nexport ASAN_OPTIONS=new_delete_type_mismatch=0:detect_leaks=1:detect_odr_violation=0:log_path=/tmp/rspamd-asan:quarantine_size_mb=2048:malloc_context_size=8:fast_unwind_on_malloc=0\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow bash\n\nif ! grep -qi 'apt-stable-asan' /etc/apt/sources.list.d/rspamd.list; then\n  sed -i 's/apt-stabil/apt-stabil-asan/i' /etc/apt/sources.list.d/rspamd.list\nfi\n\napt-get update ; apt-get upgrade rspamd\n\nnano /docker-entrypoint.sh\n\n# Fügen Sie vor \"exec \"$@\"\" die folgenden Zeilen ein:\n\nexport G_SLICE=always-malloc\nexport ASAN_OPTIONS=new_delete_type_mismatch=0:detect_leaks=1:detect_odr_violation=0:log_path=/tmp/rspamd-asan:quarantine_size_mb=2048:malloc_context_size=8:fast_unwind_on_malloc=0\n</code></pre> <p>Starten Sie Rspamd neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Ihr Speicherverbrauch wird stark ansteigen, er wird auch stetig wachsen, was nicht mit einem möglichen Memory Leak zusammenhängt, nach dem Sie suchen.</p> <p>Lassen Sie den Container für ein paar Minuten, Stunden oder Tage laufen (es sollte die Zeit sein, die Sie normalerweise warten, bis der Memory Leak \"passiert\") und starten Sie ihn neu: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Betreten Sie nun den Container, indem Sie den folgenden Befehl ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow bash\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow bash\n</code></pre> <p>Wechseln Sie das Verzeichnis zu /tmp und kopieren Sie die asan-Dateien an den gewünschten Ort oder laden Sie sie über termbin.com hoch (<code>cat /tmp/rspamd-asan.* | nc termbin.com 9999</code>).</p>","path":["Debug rspamd memory leaks.de"],"tags":[]},{"location":"de/troubleshooting/debug-rspamd_memory_leaks.en/","level":1,"title":"Debug rspamd memory leaks.en","text":"<p>A quick guide to deeply analyze a malfunctioning Rspamd.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow bash\n\nif ! grep -qi 'apt-stable-asan' /etc/apt/sources.list.d/rspamd.list; then\n  sed -i 's/apt-stabil/apt-stabil-asan/i' /etc/apt/sources.list.d/rspamd.list\nfi\n\napt-get update ; apt-get upgrade rspamd\n\nnano /docker-entrypoint.sh\n\n# Add this in front of \"exec \"$@\"\":\n\nexport G_SLICE=always-malloc\nexport ASAN_OPTIONS=new_delete_type_mismatch=0:detect_leaks=1:detect_odr_violation=0:log_path=/tmp/rspamd-asan:quarantine_size_mb=2048:malloc_context_size=8:fast_unwind_on_malloc=0\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow bash\n\nif ! grep -qi 'apt-stable-asan' /etc/apt/sources.list.d/rspamd.list; then\n  sed -i 's/apt-stabil/apt-stabil-asan/i' /etc/apt/sources.list.d/rspamd.list\nfi\n\napt-get update ; apt-get upgrade rspamd\n\nnano /docker-entrypoint.sh\n\n# Add this in front of \"exec \"$@\"\":\n\nexport G_SLICE=always-malloc\nexport ASAN_OPTIONS=new_delete_type_mismatch=0:detect_leaks=1:detect_odr_violation=0:log_path=/tmp/rspamd-asan:quarantine_size_mb=2048:malloc_context_size=8:fast_unwind_on_malloc=0\n</code></pre> <p>Restart Rspamd:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Your memory consumption will increase by a lot, it will also steadily grow, which is not related to a possible memory leak you are looking for.</p> <p>Leave the container running for a few minutes, hours or days (it should match the time you usually wait for the leak to \"happen\") and restart it:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Now enter the container by running the command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow bash\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow bash\n</code></pre> <p>Change the directory to /tmp and copy the asan Files to your desired location or upload them via termbin.com (<code>cat /tmp/rspamd-asan.* | nc termbin.com 9999</code>).</p>","path":["Debug rspamd memory leaks.en"],"tags":[]},{"location":"de/troubleshooting/debug.de/","level":1,"title":"Debug.de","text":"<p>Wenn ein Problem auftritt, dann immer aus einem bestimmten Grund! Was Sie in einem solchen Fall tun sollten, ist:</p> <ol> <li>Lesen Sie Ihre Logs; verfolgen Sie sie, um herauszufinden, was der Grund für Ihr Problem ist.</li> <li>Folgen Sie den Hinweisen in Ihren Logdateien und beginnen Sie mit der Untersuchung.</li> <li>Starten Sie den gestörten Dienst oder den gesamten Stack neu, um zu sehen, ob das Problem weiterhin besteht.</li> <li>Lesen Sie die Dokumentation des gestörten Dienstes und suchen Sie in dessen Bugtracker nach Ihrem Problem.</li> <li>Durchsuchen Sie unsere Github Issues nach Ihrem Problem.</li> <li>Erstelle einen Github Issue in unserem GitHub Repository, wenn Sie glauben, dass Ihr Problem ein Fehler oder eine fehlende Funktion ist, die Sie dringend benötigen. Bitte stellen Sie aber sicher, dass Sie alle Logs und eine vollständige Beschreibung Ihres Problems mitschicken. Bitte fragen Sie nicht nach Support auf Github.</li> <li>Treten Sie unserer Telegram-Community bei oder finden Sie die offiziellen Support-Pakete bei Servercow. Alternativ fragen Sie Twitter um Rat und taggen uns mit @mailcow_email.</li> </ol>","path":["Debug.de"],"tags":[]},{"location":"de/troubleshooting/debug.en/","level":1,"title":"Debug.en","text":"<p>When a problem occurs, then always for a reason! What you want to do in such a case is:</p> <ol> <li>Read your logs; follow them to see what the reason for your problem is.</li> <li>Follow the leads given to you in your logfiles and start investigating.</li> <li>Restarting the troubled service or the whole stack to see if the problem persists.</li> <li>Read the documentation of the troubled service and search it's bugtracker for your problem.</li> <li>Search our issues for your problem.</li> <li>Create an issue over at our GitHub repository if you think your problem might be a bug or a missing feature you badly need. But please make sure, that you include all the logs and a full description to your problem. Please do not ask for support on Git.</li> <li>Join our Telegram community or find the official support packages at Servercow.Alternatively ask Twitter and tag us with @mailcow_email</li> </ol>","path":["Debug.en"],"tags":[]},{"location":"getstarted/install.de/","level":1,"title":"Install.de","text":"<p>Überall gleich</p> <p>Die Installation ist auf x86 und ARM64 exakt identisch!</p>","path":["Install.de"],"tags":[]},{"location":"getstarted/install.de/#docker-und-docker-compose-installation","level":2,"title":"Docker und Docker Compose Installation","text":"<p>Sie benötigen Docker (eine Version &gt;= <code>24.0.0</code> ist erforderlich) und Docker Compose (eine Version <code>&gt;= 2.0</code> ist erforderlich).</p> <p>Erfahren Sie, wie Sie Docker und Docker Compose installieren.</p> <p>Schnelle Installation für die meisten Betriebssysteme:</p>","path":["Install.de"],"tags":[]},{"location":"getstarted/install.de/#docker","level":3,"title":"Docker","text":"<p><pre><code>curl -sSL https://get.docker.com/ | CHANNEL=stable sh\n# Nachdem der Installationsprozess abgeschlossen ist, müssen Sie eventuell den Dienst aktivieren und sicherstellen, dass er gestartet ist (z. B. CentOS 7)\nsystemctl enable --now docker\n</code></pre> Bitte verwenden Sie die neueste verfügbare Docker-Engine und nicht die Engine, die mit Ihrem Distros-Repository ausgeliefert wird.</p>","path":["Install.de"],"tags":[]},{"location":"getstarted/install.de/#docker-compose","level":3,"title":"docker compose","text":"<p>Achtung</p> <p>mailcow benötigt eine Version von Docker Compose &gt;= v2. Sollte die Installation von Docker über das obenstehende Skript erfolgt sein wird das Docker Compose Plugin bereits automatisch in einer Version &gt;=2.0 installiert.  Ist die mailcow Installation älter oder Docker wurde auf einem anderen Weg installiert, muss das Compose Plugin bzw. die Standalone Version von Docker manuell installiert werden.</p>","path":["Install.de"],"tags":[]},{"location":"getstarted/install.de/#installation-via-paketmanager-plugin","level":4,"title":"Installation via Paketmanager (Plugin)","text":"<p>Hinweis</p> <p>Diese Vorgehensweise mit den Paketquellen ist nur dann möglich, wenn das Docker Repository eingebunden wurde. Dies kann entweder durch die Anleitung oben (siehe Docker) oder durch eine manuelle Einbindung passieren.</p> <p>Auf Debian/Ubuntu Systemen: <pre><code>apt update\napt install docker-compose-plugin\n</code></pre></p> <p>Auf Centos 7 Systemen: <pre><code>yum update\nyum install docker-compose-plugin\n</code></pre></p> <p>Achtung</p> <p>Die Syntax der Docker Compose Befehle lautet <code>docker compose</code> bei der Plugin Variante von Docker Compose!!</p>","path":["Install.de"],"tags":[]},{"location":"getstarted/install.de/#installation-via-script-standalone","level":4,"title":"Installation via Script (Standalone)","text":"<p>Hinweis</p> <p>Diese Installation ist die alt bekannte Weise. Sie installiert Docker Compose als Standalone Programm und ist nicht auf die Art und weise der Docker Installation angewiesen.</p> <pre><code>LATEST=$(curl -Ls -w %{url_effective} -o /dev/null https://github.com/docker/compose/releases/latest) &amp;&amp; LATEST=${LATEST##*/} &amp;&amp; curl -L https://github.com/docker/compose/releases/download/$LATEST/docker-compose-$(uname -s)-$(uname -m) &gt; /usr/local/bin/docker-compose\nchmod +x /usr/local/bin/docker-compose\n</code></pre> <p>Achtung</p> <p>Die Syntax der Docker Compose Befehle lautet <code>docker-compose</code> bei der Standalone Variante von Docker Compose!!</p>","path":["Install.de"],"tags":[]},{"location":"getstarted/install.de/#selinux-besonderheiten-prufen","level":2,"title":"SELinux Besonderheiten prüfen","text":"<p>Auf SELinux-aktivierten Systemen, z.B. CentOS 7:</p> <ul> <li>Prüfen Sie, ob das Paket \"container-selinux\" auf Ihrem System vorhanden ist:</li> </ul> <pre><code>rpm -qa | grep container-selinux\n</code></pre> <p>Wenn der obige Befehl eine leere oder keine Ausgabe liefert, sollten Sie es über Ihren Paketmanager installieren.</p> <ul> <li>Prüfen Sie, ob Docker SELinux-Unterstützung aktiviert hat:</li> </ul> <pre><code>docker info | grep selinux\n</code></pre> <p>Wenn der obige Befehl eine leere oder keine Ausgabe liefert, erstellen oder bearbeiten Sie <code>/etc/docker/daemon.json</code> und fügen Sie <code>\"selinux-enabled\": true</code> hinzu. Beispielhafter Inhalt der Datei:</p> <pre><code>{\n  \"selinux-enabled\": true\n}\n</code></pre> <p>Starten Sie den Docker-Daemon neu und überprüfen Sie, ob SELinux nun aktiviert ist.</p> <p>Dieser Schritt ist erforderlich, um sicherzustellen, dass die mailcows-Volumes richtig gekennzeichnet sind, wie in der Compose-Datei angegeben. Wenn Sie daran interessiert sind, wie das funktioniert, können Sie sich die Readme-Datei von https://github.com/containers/container-selinux ansehen, die auf viele nützliche Informationen zu diesem Thema verweist.</p>","path":["Install.de"],"tags":[]},{"location":"getstarted/install.de/#mailcow-installieren","level":2,"title":"mailcow Installieren","text":"<p>Klonen Sie den Master-Zweig des Repositorys und stellen Sie sicher, dass Ihre umask gleich 0022 ist. Bitte klonen Sie das Repository als root-Benutzer und kontrollieren Sie auch den Stack als root. Wir werden die Attribute - wenn nötig - ändern, während wir die Container automatisch bereitstellen und sicherstellen, dass alles gesichert ist. Das update.sh-Skript muss daher ebenfalls als root ausgeführt werden. Es kann notwendig sein, den Besitzer und andere Attribute von Dateien zu ändern, auf die Sie sonst keinen Zugriff haben. Wir geben die Berechtigungen für jede exponierte Anwendung auf und führen einen exponierten Dienst nicht als root aus! Wenn Sie den Docker-Daemon als Nicht-Root-Benutzer steuern, erhalten Sie keine zusätzliche Sicherheit. Der unprivilegierte Benutzer wird die Container ebenfalls als root spawnen. Das Verhalten des Stacks ist identisch.</p> <pre><code>$ su\n# umask\n0022 # &lt;- Überprüfen, dass es 0022 ist\n# cd /opt\n# git clone https://github.com/mailcow/mailcow-dockerized\n# cd mailcow-dockerized\n</code></pre>","path":["Install.de"],"tags":[]},{"location":"getstarted/install.de/#mailcow-initialisieren","level":2,"title":"mailcow Initialisieren","text":"<p>Erzeugen Sie eine Konfigurationsdatei. Verwenden Sie einen FQDN (<code>host.domain.tld</code>) als Hostname, wenn Sie gefragt werden. <pre><code>./generate_config.sh\n</code></pre></p> <p>Ändern Sie die Konfiguration, wenn Sie wollen oder müssen. <pre><code>nano mailcow.conf\n</code></pre> Wenn Sie planen, einen Reverse Proxy zu verwenden, können Sie zum Beispiel HTTPS an 127.0.0.1 auf Port 8443 und HTTP an 127.0.0.1 auf Port 8080 binden.</p> <p>Möglicherweise müssen Sie einen vorinstallierten MTA stoppen, der Port 25/tcp blockiert. Siehe dieses Kapitel, um zu erfahren, wie man Postfix rekonfiguriert, um nach einer erfolgreichen Installation neben mailcow laufen zu lassen.</p> <p>Einige Updates modifizieren mailcow.conf und fügen neue Parameter hinzu. Es ist schwer, in der Dokumentation den Überblick zu behalten. Bitte überprüfen Sie deren Beschreibung und fragen Sie, wenn Sie unsicher sind, in den bekannten Kanälen nach Rat.</p>","path":["Install.de"],"tags":[]},{"location":"getstarted/install.de/#problembehandlungen","level":2,"title":"Problembehandlungen","text":"","path":["Install.de"],"tags":[]},{"location":"getstarted/install.de/#benutzer-mit-einer-mtu-ungleich-1500-zb-openstack","level":3,"title":"Benutzer mit einer MTU ungleich 1500 (z.B. OpenStack)","text":"<p>Wenn Sie auf Probleme und seltsame Phänomene stoßen, überprüfen Sie bitte Ihre MTU.</p> <p>Bearbeiten Sie <code>docker-compose.yml</code> und ändern Sie die Netzwerkeinstellungen entsprechend Ihrer MTU. Fügen Sie den neuen Parameter driver_opts wie folgt hinzu: <pre><code>networks:\n  mailcow-network:\n    ...\n    driver_opts:\n      com.docker.network.driver.mtu: 1450\n    ...\n</code></pre></p>","path":["Install.de"],"tags":[]},{"location":"getstarted/install.de/#benutzer-ohne-ein-ipv6-aktiviertes-netzwerk-auf-ihrem-hostsystem","level":3,"title":"Benutzer ohne ein IPv6-aktiviertes Netzwerk auf ihrem Hostsystem","text":"<p>Schalten Sie IPv6 bitte nicht ab, auch wenn es Ihnen nicht gefällt. IPv6 ist die Zukunft und sollte nicht ignoriert werden.</p> <p>Sollten Sie jedoch kein IPv6-fähiges Netzwerk auf Ihrem Host haben und Sie sich nicht um ein besseres Internet kümmern wollen (hehe), ist es empfehlenswert, IPv6 für das mailcow-Netzwerk zu deaktivieren, um unvorhergesehene Probleme zu vermeiden.</p>","path":["Install.de"],"tags":[]},{"location":"getstarted/install.de/#mailcow-starten","level":2,"title":"mailcow starten","text":"<p>Laden Sie die Images herunter und führen Sie die Compose-Datei aus. Der Parameter <code>-d</code> wird ihre mailcow dann im Hintergrund starten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose pull\ndocker compose up -d\n</code></pre> <pre><code>docker-compose pull\ndocker-compose up -d\n</code></pre> <p>Geschafft!</p> <p>Sie können nun auf https://${MAILCOW_HOSTNAME} mit den Standard-Zugangsdaten <code>admin</code> + Passwort <code>moohoo</code> zugreifen.</p> <p>Info</p> <p>Wenn Sie mailcow nicht hinter einem Reverse Proxy verwenden, sollten Sie alle HTTP-Anfragen auf HTTPS umleiten.</p> <p>Die Datenbank wird sofort initialisiert, nachdem eine Verbindung zu MySQL hergestellt werden kann.</p> <p>Ihre Daten bleiben in mehreren Docker-Volumes erhalten, die nicht gelöscht werden, wenn Sie Container neu erstellen oder löschen. Führen Sie <code>docker volume ls</code> aus, um eine Liste aller Volumes zu sehen. Sie können <code>docker compose down</code> sicher ausführen, ohne persistente Daten zu entfernen.</p>","path":["Install.de"],"tags":[]},{"location":"getstarted/install.en/","level":1,"title":"Install.en","text":"<p>It's the same</p> <p>The installation is exactly the same on x86 and ARM64 platforms!</p>","path":["Install.en"],"tags":[]},{"location":"getstarted/install.en/#docker-and-docker-compose-installation","level":2,"title":"Docker and Docker Compose Installation","text":"<p>You need Docker (a version &gt;= <code>24.0.0</code> is required) and Docker Compose (a version <code>&gt;= 2.0</code> is required).</p> <p>Learn how to install Docker and Docker Compose.</p> <p>Quick installation for most operation systems:</p>","path":["Install.en"],"tags":[]},{"location":"getstarted/install.en/#docker","level":3,"title":"Docker","text":"<pre><code>curl -sSL https://get.docker.com/ | CHANNEL=stable sh\n# After the installation process is finished, you may need to enable the service and make sure it is started (e.g. CentOS 7)\nsystemctl enable --now docker\n</code></pre>","path":["Install.en"],"tags":[]},{"location":"getstarted/install.en/#docker-compose","level":3,"title":"docker compose","text":"<p>Danger</p> <p>mailcow requires the latest version of docker compose v2. If Docker was installed using the script above, the Docker Compose plugin is already automatically installed in a version &gt;=2.0. Is your mailcow installation older or Docker was installed in a different way, the Compose plugin or the standalone version of Docker must be installed manually.</p>","path":["Install.en"],"tags":[]},{"location":"getstarted/install.en/#installation-via-paketmanager-plugin","level":4,"title":"Installation via Paketmanager (plugin)","text":"<p>Info</p> <p>This approach with the package sources is only possible if the Docker repository has been included. This can happen either through the instructions above (see Docker) or through a manually integration.</p> <p>On Debian/Ubuntu systems: <pre><code>apt update\napt install docker-compose-plugin\n</code></pre></p> <p>On Centos 7 systems: <pre><code>yum update\nyum install docker-compose-plugin\n</code></pre></p> <p>Danger</p> <p>The Docker Compose command syntax is <code>docker compose</code> for the plugin variant of Docker Compose!!!</p>","path":["Install.en"],"tags":[]},{"location":"getstarted/install.en/#installation-via-script-standalone","level":4,"title":"Installation via Script (standalone)","text":"<p>Info</p> <p>This installation is the old familiar way. It installs Docker Compose as a standalone program and does not rely on the Docker installation way.</p> <pre><code>LATEST=$(curl -Ls -w %{url_effective} -o /dev/null https://github.com/docker/compose/releases/latest) &amp;&amp; LATEST=${LATEST##*/} &amp;&amp; curl -L https://github.com/docker/compose/releases/download/$LATEST/docker-compose-$(uname -s)-$(uname -m) &gt; /usr/local/bin/docker-compose\nchmod +x /usr/local/bin/docker-compose\n</code></pre> <p>Danger</p> <p>The Docker Compose command syntax is <code>docker-compose</code> for the standalone variant of Docker Compose!!!   </p> <p>Please use the latest Docker engine available and do not use the engine that ships with your distros repository.</p>","path":["Install.en"],"tags":[]},{"location":"getstarted/install.en/#check-selinux-specifics","level":2,"title":"Check SELinux specifics","text":"<p>On SELinux enabled systems, e.g. CentOS 7:</p> <ul> <li>Check if \"container-selinux\" package is present on your system:</li> </ul> <pre><code>rpm -qa | grep container-selinux\n</code></pre> <p>If the above command returns an empty or no output, you should install it via your package manager.</p> <ul> <li>Check if docker has SELinux support enabled:</li> </ul> <pre><code>docker info | grep selinux\n</code></pre> <p>If the above command returns an empty or no output, create or edit <code>/etc/docker/daemon.json</code> and add <code>\"selinux-enabled\": true</code>. Example file content:</p> <pre><code>{\n  \"selinux-enabled\": true\n}\n</code></pre> <p>Restart the docker daemon and verify SELinux is now enabled.</p> <p>This step is required to make sure mailcows volumes are properly labeled as declared in the compose file. If you are interested in how this works, you can check out the readme of https://github.com/containers/container-selinux which links to a lot of useful information on that topic.</p>","path":["Install.en"],"tags":[]},{"location":"getstarted/install.en/#install-mailcow","level":2,"title":"Install mailcow","text":"<p>Clone the master branch of the repository, make sure your umask equals 0022. Please clone the repository as root user and also control the stack as root. We will modify attributes - if necessary - while bootstrapping the containers automatically and make sure everything is secured. The update.sh script must therefore also be run as root. It might be necessary to change ownership and other attributes of files you will otherwise not have access to. We drop permissions for every exposed application and will not run an exposed service as root! Controlling the Docker daemon as non-root user does not give you additional security. The unprivileged user will spawn the containers as root likewise. The behaviour of the stack is identical.</p> <pre><code>$ su\n# umask\n0022 # &lt;- Verify it is 0022\n# cd /opt\n# git clone https://github.com/mailcow/mailcow-dockerized\n# cd mailcow-dockerized\n</code></pre>","path":["Install.en"],"tags":[]},{"location":"getstarted/install.en/#initialize-mailcow","level":2,"title":"Initialize mailcow","text":"<p>Generate a configuration file. Use a FQDN (<code>host.domain.tld</code>) as hostname when asked. <pre><code>./generate_config.sh\n</code></pre></p> <p>Change configuration if you want or need to. <pre><code>nano mailcow.conf\n</code></pre> If you plan to use a reverse proxy, you can, for example, bind HTTPS to 127.0.0.1 on port 8443 and HTTP to 127.0.0.1 on port 8080.</p> <p>You may need to stop an existing pre-installed MTA which blocks port 25/tcp. See this chapter to learn how to reconfigure Postfix to run besides mailcow after a successful installation.</p> <p>Some updates modify mailcow.conf and add new parameters. It is hard to keep track of them in the documentation. Please check their description and, if unsure, ask at the known channels for advise.</p>","path":["Install.en"],"tags":[]},{"location":"getstarted/install.en/#troubleshooting","level":2,"title":"Troubleshooting","text":"","path":["Install.en"],"tags":[]},{"location":"getstarted/install.en/#users-with-a-mtu-not-equal-to-1500-eg-openstack","level":3,"title":"Users with a MTU not equal to 1500 (e.g. OpenStack)","text":"<p>Whenever you run into trouble and strange phenomena, please check your MTU.</p> <p>Edit <code>docker-compose.yml</code> and change the network settings according to your MTU. Add the new driver_opts parameter like this: <pre><code>networks:\n  mailcow-network:\n    ...\n    driver_opts:\n      com.docker.network.driver.mtu: 1450\n    ...\n</code></pre></p>","path":["Install.en"],"tags":[]},{"location":"getstarted/install.en/#users-without-an-ipv6-enabled-network-on-their-host-system","level":3,"title":"Users without an IPv6 enabled network on their host system","text":"<p>Please don't turn off IPv6, even if you don't like it. IPv6 is the future and should not be ignored.</p> <p>If you do not have an IPv6 enabled network on your host and you don't care for a better internet (thehe), it is recommended to disable IPv6 for the mailcow network to prevent unforeseen issues.</p>","path":["Install.en"],"tags":[]},{"location":"getstarted/install.en/#start-mailcow","level":2,"title":"Start mailcow","text":"<p>Pull the images and run the compose file. The parameter <code>-d</code> will start mailcow: dockerized detached:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose pull\ndocker compose up -d\n</code></pre> <pre><code>docker-compose pull\ndocker-compose up -d\n</code></pre> <p>Done!</p> <p>You can now access https://${MAILCOW_HOSTNAME} with the default credentials <code>admin</code> + password <code>moohoo</code>.</p> <p>Info</p> <p>If you are not using mailcow behind a reverse proxy, you should redirect all HTTP requests to HTTPS.</p> <p>The database will be initialized right after a connection to MySQL can be established.</p> <p>Your data will persist in multiple Docker volumes, that are not deleted when you recreate or delete containers. Run <code>docker volume ls</code> to see a list of all volumes. You can safely run <code>docker compose down</code> without removing persistent data.</p>","path":["Install.en"],"tags":[]},{"location":"getstarted/prerequisite-dns.de/","level":1,"title":"Prerequisite dns.de","text":"<p>Nachstehend finden Sie eine Liste von empfohlenen DNS-Einträgen. Einige sind für einen Mailserver obligatorisch (A, MX), andere werden empfohlen, um eine gute Reputation aufzubauen (TXT/SPF) oder für die automatische Konfiguration von Mailclients verwendet (SRV).</p>","path":["Prerequisite dns.de"],"tags":[]},{"location":"getstarted/prerequisite-dns.de/#referenzen","level":2,"title":"Referenzen","text":"<ul> <li>Ein guter Artikel, der alle relevanten Themen abdeckt:   \"3 DNS Records Every Email Marketer Must Know\"</li> <li>Ein weiterer guter Artikel, aber mit Zimbra als Beispielplattform:   \"Best Practices on Email Protection: SPF, DKIM and DMARC\"</li> <li>Eine ausführliche Diskussion über SPF, DKIM und DMARC:   \"Wie Sie Spam beseitigen und Ihren Namen mit DMARC schützen\"</li> <li>Ein ausführlicher Leitfaden zum Verständnis von DMARC: \"Entmystifizierung von DMARC: Ein Leitfaden zur Verhinderung von E-Mail-Spoofing\"</li> </ul>","path":["Prerequisite dns.de"],"tags":[]},{"location":"getstarted/prerequisite-dns.de/#reverse-dns-ihrer-ip-adresse","level":2,"title":"Reverse DNS Ihrer IP-Adresse","text":"<p>Stellen Sie sicher, dass der PTR-Eintrag Ihrer IP-Adresse mit dem FQDN Ihres mailcow-Hosts übereinstimmt: <code>${MAILCOW_HOSTNAME}</code> <sup>1</sup>. Dieser Eintrag wird normalerweise bei dem Provider gesetzt, von dem Sie die IP-Adresse (Server) gemietet haben. Bitte beachten Sie, dies sowohl für Ihre IPv4 als auch Ihre IPv6 Adressen (falls verwendet) sicherzustellen!</p>","path":["Prerequisite dns.de"],"tags":[]},{"location":"getstarted/prerequisite-dns.de/#die-minimale-dns-konfiguration","level":2,"title":"Die minimale DNS-Konfiguration","text":"<p>Dieses Beispiel zeigt Ihnen eine Reihe von Einträgen für eine von mailcow verwaltete Domain. Jede Domain, die zu mailcow hinzugefügt wird, benötigt mindestens diesen Satz an Einträgen, um korrekt zu funktionieren.</p> <pre><code># Name Typ Wert\nmail IN A 1.2.3.4\nautodiscover IN CNAME mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\nautoconfig IN CNAME mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n@ IN MX 10 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n</code></pre> <p>Hinweis: Der <code>mail</code> DNS-Eintrag, der die Subdomain an die angegebene IP-Adresse bindet, muss nur für die Domain gesetzt werden, auf der mailcow läuft und die für den Zugriff auf das Webinterface verwendet wird. Für jede andere von mailcow verwaltete Domain leitet der <code>MX</code>-Eintrag den Datenverkehr entsprechend weiter.</p>","path":["Prerequisite dns.de"],"tags":[]},{"location":"getstarted/prerequisite-dns.de/#dkim-spf-und-dmarc","level":2,"title":"DKIM, SPF und DMARC","text":"<p>Im folgenden Beispiel für eine DNS-Zonendatei wird ein einfacher SPF TXT-Eintrag verwendet, um nur DIESEM Server (dem MX) zu erlauben, E-Mails für Ihre Domäne zu senden. Jeder andere Server ist nicht zugelassen, kann es aber tun (\"<code>~all</code>\"). Weitere Informationen finden Sie im SPF-Projekt.</p> <pre><code># Name Typ Wert\n@ IN TXT \"v=spf1 mx a -all\"\n</code></pre> <p>Es wird dringend empfohlen, einen DKIM TXT-Eintrag in Ihrer mailcow UI zu erstellen und den entsprechenden TXT-Eintrag in Ihren DNS-Einträgen zu setzen. Bitte lesen Sie OpenDKIM für weitere Informationen.</p> <pre><code># Name Typ Wert\ndkim._domainkey IN TXT \"v=DKIM1; k=rsa; t=s; s=email; p=...\"\n</code></pre> <p>Der letzte Schritt, um sich selbst und andere zu schützen, ist die Implementierung eines DMARC TXT-Datensatzes, zum Beispiel mit Hilfe des DMARC-Assistenten (check).</p> <pre><code># Name Typ Wert\n_dmarc IN TXT \"v=DMARC1; p=reject; rua=mailto:mailauth-reports@example.org\"\n</code></pre>","path":["Prerequisite dns.de"],"tags":[]},{"location":"getstarted/prerequisite-dns.de/#die-erweiterte-dns-konfiguration","level":2,"title":"Die erweiterte DNS-Konfiguration","text":"<p>SRV-Einträge geben den/die Server für ein bestimmtes Protokoll in Ihrer Domäne an. Wenn Sie einen Dienst explizit als nicht bereitgestellt ankündigen wollen, geben Sie \".\" als Zieladresse an (statt \"mail.example.org.\"). Bitte beachten Sie RFC 2782.</p> <pre><code># Name Typ Priorität Gewicht Port Wert\n_autodiscover._tcp IN SRV 0 1 443 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_caldavs._tcp IN SRV 0 1 443 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_caldavs._tcp IN TXT \"path=/SOGo/dav/\"\n_carddavs._tcp IN SRV 0 1 443 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_carddavs._tcp IN TXT \"path=/SOGo/dav/\"\n_imap._tcp IN SRV 0 1 143 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_imaps._tcp IN SRV 0 1 993 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_pop3._tcp IN SRV 0 1 110 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_pop3s._tcp IN SRV 0 1 995 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_sieve._tcp IN SRV 0 1 4190 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_smtps._tcp IN SRV 0 1 465 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_submission._tcp IN SRV 0 1 587 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n_submissions._tcp IN SRV 0 1 465 mail.example.org. (Ihr ${MAILCOW_HOSTNAME})\n</code></pre>","path":["Prerequisite dns.de"],"tags":[]},{"location":"getstarted/prerequisite-dns.de/#testen","level":2,"title":"Testen","text":"<p>Hier finden Sie einige Tools, mit denen Sie Ihre DNS-Konfiguration überprüfen können:</p> <ul> <li>MX Toolbox (DNS, SMTP, RBL)</li> <li>port25.com (DKIM, SPF)</li> <li>Mail-Tester (DKIM, DMARC, SPF)</li> <li>DMARC-Analysator (DMARC, SPF)</li> <li>MultiRBL.valli.org (DNSBL, RBL, FCrDNS)</li> </ul>","path":["Prerequisite dns.de"],"tags":[]},{"location":"getstarted/prerequisite-dns.de/#verschiedenes","level":2,"title":"Verschiedenes","text":"","path":["Prerequisite dns.de"],"tags":[]},{"location":"getstarted/prerequisite-dns.de/#optionale-dmarc-statistiken","level":3,"title":"Optionale DMARC-Statistiken","text":"<p>Wenn Sie an Statistiken interessiert sind, können Sie sich zusätzlich bei einem der vielen unten aufgeführten DMARC-Statistikdienste anmelden - oder Ihre eigene Statistik selbst hosten.</p> <p>Tipp</p> <p>Es ist zu bedenken, dass wenn Sie DMARC-Statistik-Berichte an Ihren mailcow-Server anfordern und Ihr mailcow-Server nicht korrekt für den Empfang dieser Berichte konfiguriert ist, Sie möglicherweise keine genauen und vollständigen Ergebnisse erhalten. Bitte erwägen Sie die Verwendung einer alternativen E-Mail-Domain für den Empfang von DMARC-Berichten.</p> <p>Es ist erwähnenswert, dass die folgenden Vorschläge keine umfassende Liste aller verfügbaren Dienste und Tools sind, sondern nur eine kleine Auswahl der vielen Möglichkeiten.</p> <ul> <li>Postmaster Tool</li> <li>parsedmarc (selbst gehostet)</li> <li>Fraudmarc</li> <li>Postmark</li> <li>Dmarcian</li> </ul> <p>Tipp</p> <p>Diese Dienste stellen Ihnen möglicherweise einen TXT-Eintrag zur Verfügung, den Sie in Ihre DNS-Einträge einfügen müssen, so wie es der Anbieter vorschreibt. Bitte stellen Sie sicher, dass Sie die Dokumentation des Anbieters des von Ihnen gewählten Dienstes lesen, da dieser Prozess variieren kann.</p>","path":["Prerequisite dns.de"],"tags":[]},{"location":"getstarted/prerequisite-dns.de/#e-mail-test-fur-spf-dkim-und-dmarc","level":3,"title":"E-Mail-Test für SPF, DKIM und DMARC:","text":"<p>Um eine rudimentäre E-Mail-Authentifizierungsprüfung durchzuführen, senden Sie eine E-Mail an <code>check-auth at verifier.port25.com</code> und warten Sie auf eine Antwort. Sie werden einen Bericht ähnlich dem folgenden finden:</p> <pre><code>==========================================================\nZusammenfassung der Ergebnisse\n==========================================================\nSPF-Prüfung: bestanden\n\"iprev\"-Prüfung: bestanden\nDKIM-Prüfung: bestanden\nDKIM-Prüfung: bestanden\nSpamAssassin-Prüfung: ham\n\n==========================================================\nEinzelheiten:\n==========================================================\n....\n</code></pre> <p>Der vollständige Bericht enthält weitere technische Details.</p>","path":["Prerequisite dns.de"],"tags":[]},{"location":"getstarted/prerequisite-dns.de/#fully-qualified-domain-name-fqdn","level":3,"title":"Fully Qualified Domain Name (FQDN)","text":"<ol> <li> <p>Ein Fully Qualified Domain Name (FQDN) ist der vollständige (absolute) Domänenname für einen bestimmten Computer oder Host im Internet. Der FQDN besteht aus mindestens drei Teilen, die durch einen Punkt getrennt sind: dem Hostnamen, dem Domänennamen und der Top Level Domain (kurz TLD). Im Beispiel <code>mx.mailcow.email</code> wäre der Hostname <code>mx</code>, der Domainname <code>mailcow</code> und die TLD <code>email</code>. ↩</p> </li> </ol>","path":["Prerequisite dns.de"],"tags":[]},{"location":"getstarted/prerequisite-dns.en/","level":1,"title":"Prerequisite dns.en","text":"<p>Below you can find a list of recommended DNS records. While some are mandatory for a mail server (A, MX), others are recommended to build a good reputation score (TXT/SPF) or used for auto-configuration of mail clients (SRV).</p>","path":["Prerequisite dns.en"],"tags":[]},{"location":"getstarted/prerequisite-dns.en/#references","level":2,"title":"References","text":"<ul> <li>A good article covering all relevant topics:   \"3 DNS Records Every Email Marketer Must Know\"</li> <li>Another great one, but Zimbra as an example platform:   \"Best Practices on Email Protection: SPF, DKIM and DMARC\"</li> <li>An in-depth discussion of SPF, DKIM and DMARC:   \"How to eliminate spam and protect your name with DMARC\"</li> <li>A thorough guide on understanding DMARC: \"Demystifying DMARC: A guide to preventing email spoofing\"</li> </ul>","path":["Prerequisite dns.en"],"tags":[]},{"location":"getstarted/prerequisite-dns.en/#reverse-dns-of-your-ip-address","level":2,"title":"Reverse DNS of your IP address","text":"<p>Make sure that the PTR record of your IP address matches the FQDN of your mailcow host: <code>${MAILCOW_HOSTNAME}</code> <sup>1</sup>. This record is usually set at the provider you leased the IP address (server) from. Please make sure that you create the record for IPv4 and IPv6 address (if you are using IPv6)!</p>","path":["Prerequisite dns.en"],"tags":[]},{"location":"getstarted/prerequisite-dns.en/#the-minimal-dns-configuration","level":2,"title":"The minimal DNS configuration","text":"<p>This example shows you a set of records for one domain managed by mailcow. Each domain that is added to mailcow needs at least this set of records to function correctly.</p> <pre><code># Name              Type       Value\nmail                IN A       1.2.3.4\nautodiscover        IN CNAME   mail.example.org. (your ${MAILCOW_HOSTNAME})\nautoconfig          IN CNAME   mail.example.org. (your ${MAILCOW_HOSTNAME})\n@                   IN MX 10   mail.example.org. (your ${MAILCOW_HOSTNAME})\n</code></pre> <p>Note: The <code>mail</code> DNS record which binds the subdomain to the given ip address must only be set for the domain on which mailcow is running and that is used to access the web interface. For every other mailcow managed domain, the <code>MX</code> record will route the traffic.</p>","path":["Prerequisite dns.en"],"tags":[]},{"location":"getstarted/prerequisite-dns.en/#dkim-spf-and-dmarc","level":2,"title":"DKIM, SPF and DMARC","text":"<p>In the example DNS zone file snippet below, a simple SPF TXT record is used to only allow THIS server (the MX) to send mail for your domain. Every other server is disallowed but able to (\"<code>~all</code>\"). Please refer to SPF Project for further reading.</p> <pre><code># Name              Type       Value\n@                   IN TXT     \"v=spf1 mx a -all\"\n</code></pre> <p>It is highly recommended to create a DKIM TXT record in your mailcow UI and set the corresponding TXT record in your DNS records. Please refer to OpenDKIM for further reading.</p> <pre><code># Name              Type       Value\ndkim._domainkey     IN TXT     \"v=DKIM1; k=rsa; t=s; s=email; p=...\"\n</code></pre> <p>The last step in protecting yourself and others is the implementation of a DMARC TXT record, for example by using the DMARC Assistant (check).</p> <pre><code># Name              Type       Value\n_dmarc              IN TXT     \"v=DMARC1; p=reject; rua=mailto:mailauth-reports@example.org\"\n</code></pre>","path":["Prerequisite dns.en"],"tags":[]},{"location":"getstarted/prerequisite-dns.en/#the-advanced-dns-configuration","level":2,"title":"The advanced DNS configuration","text":"<p>SRV records specify the server(s) for a specific protocol on your domain. If you want to explicitly announce a service as not provided, give \".\" as the target address (instead of \"mail.example.org.\"). Please refer to RFC 2782.</p> <pre><code># Name              Type       Priority Weight Port    Value\n_autodiscover._tcp  IN SRV     0        1      443      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_caldavs._tcp       IN SRV     0        1      443      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_caldavs._tcp       IN TXT                              \"path=/SOGo/dav/\"\n_carddavs._tcp      IN SRV     0        1      443      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_carddavs._tcp      IN TXT                              \"path=/SOGo/dav/\"\n_imap._tcp          IN SRV     0        1      143      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_imaps._tcp         IN SRV     0        1      993      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_pop3._tcp          IN SRV     0        1      110      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_pop3s._tcp         IN SRV     0        1      995      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_sieve._tcp         IN SRV     0        1      4190     mail.example.org. (your ${MAILCOW_HOSTNAME})\n_smtps._tcp         IN SRV     0        1      465      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_submission._tcp    IN SRV     0        1      587      mail.example.org. (your ${MAILCOW_HOSTNAME})\n_submissions._tcp   IN SRV     0        1      465      mail.example.org. (your ${MAILCOW_HOSTNAME})\n</code></pre>","path":["Prerequisite dns.en"],"tags":[]},{"location":"getstarted/prerequisite-dns.en/#testing","level":2,"title":"Testing","text":"<p>Here are some tools you can use to verify your DNS configuration:</p> <ul> <li>MX Toolbox (DNS, SMTP, RBL)</li> <li>port25.com (DKIM, SPF)</li> <li>Mail-tester (DKIM, DMARC, SPF)</li> <li>DMARC Analyzer (DMARC, SPF)</li> <li>MultiRBL.valli.org (DNSBL, RBL, FCrDNS)</li> </ul>","path":["Prerequisite dns.en"],"tags":[]},{"location":"getstarted/prerequisite-dns.en/#misc","level":2,"title":"Misc","text":"","path":["Prerequisite dns.en"],"tags":[]},{"location":"getstarted/prerequisite-dns.en/#optional-dmarc-statistics","level":3,"title":"Optional DMARC Statistics","text":"<p>If you are interested in statistics, you can additionally register with some of the many below DMARC statistic services - or self-host your own.</p> <p>Tip</p> <p>It is worth considering that if you request DMARC statistic reports to your mailcow server and your mailcow server is not configured correctly to receive these reports, you may not get accurate and complete results. Please consider using an alternative email domain for receiving DMARC reports.</p> <p>It is worth mentioning, that the following suggestions are not a comprehensive list of all services and tools available, but only a small few of the many choices.</p> <ul> <li>Postmaster Tool</li> <li>parsedmarc (self-hosted)</li> <li>Fraudmarc</li> <li>Postmark</li> <li>Dmarcian</li> </ul> <p>Tip</p> <p>These services may provide you with a TXT record you need to insert into your DNS records as the provider specifies. Please ensure you read the provider's documentation from the service you choose as this process may vary.</p>","path":["Prerequisite dns.en"],"tags":[]},{"location":"getstarted/prerequisite-dns.en/#email-test-for-spf-dkim-and-dmarc","level":3,"title":"Email test for SPF, DKIM and DMARC:","text":"<p>To run a rudimentary email authentication check, send a mail to <code>check-auth at verifier.port25.com</code> and wait for a reply. You will find a report similar to the following:</p> <pre><code>==========================================================\nSummary of Results\n==========================================================\nSPF check:          pass\n\"iprev\" check:      pass\nDKIM check:         pass\nDKIM check:         pass\nSpamAssassin check: ham\n\n==========================================================\nDetails:\n==========================================================\n....\n</code></pre> <p>The full report will contain more technical details.</p>","path":["Prerequisite dns.en"],"tags":[]},{"location":"getstarted/prerequisite-dns.en/#fully-qualified-domain-name-fqdn","level":3,"title":"Fully Qualified Domain Name (FQDN)","text":"<ol> <li> <p>A Fully Qualified Domain Name (FQDN) is the complete (absolute) domain name for a specific computer or host, on the Internet. The FQDN consists of at least three parts divided by a dot: the hostname, the domain name, and the Top Level Domain (TLD for short). In the example of <code>mx.mailcow.email</code> the hostname would be <code>mx</code>, the domain name <code>mailcow</code> and the TLD <code>email</code>. ↩</p> </li> </ol>","path":["Prerequisite dns.en"],"tags":[]},{"location":"getstarted/prerequisite-system.de/","level":1,"title":"Prerequisite system.de","text":"<p>Bevor Sie mailcow: dockerized ausführen, sollten Sie einige Voraussetzungen überprüfen:</p> <p>Achtung</p> <p>Versuchen Sie nicht, mailcow auf einem Synology/QNAP-Gerät (jedes NAS), OpenVZ, LXC oder anderen Container-Plattformen zu installieren. KVM, ESX, Hyper-V und andere vollständige Virtualisierungsplattformen werden unterstützt.</p> <p>Info</p> <ul> <li>mailcow: dockerized erfordert, dass einige Ports für eingehende Verbindungen offen sind, also stellen Sie sicher, dass Ihre Firewall diese nicht blockiert.</li> <li>Stellen Sie sicher, dass keine andere Anwendung die Konfiguration von mailcow stört, wie z.B. ein anderer Maildienst</li> <li>Ein korrektes DNS-Setup ist entscheidend für jedes gute Mailserver-Setup, also stellen Sie bitte sicher, dass Sie zumindest die basics abgedeckt haben, bevor Sie beginnen!</li> <li>Stellen Sie sicher, dass Ihr System ein korrektes Datum und eine korrekte Zeiteinstellung hat. Dies ist entscheidend für verschiedene Komponenten wie die Zwei-Faktor-TOTP-Authentifizierung.</li> </ul>","path":["Prerequisite system.de"],"tags":[]},{"location":"getstarted/prerequisite-system.de/#minimale-systemressourcen","level":2,"title":"Minimale Systemressourcen","text":"<p>Bitte stellen Sie sicher, dass Ihr System mindestens über die folgenden Ressourcen verfügt, um problemlos zu laufen:</p> Ressource Minimale Anforderung CPU 1 GHz RAM Minimum 6 GiB + 1 GiB Swap (Standardkonfiguration) Festplatte 20 GiB (ohne Emails) Architektur x86_64, ARM64 <p>Nicht unterstützte Plattformen</p> <p>OpenVZ, Virtuozzo und LXC</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"getstarted/prerequisite-system.de/#arbeitsspeicher","level":3,"title":"Arbeitsspeicher","text":"<p>ClamAV und die FTS-Engine (Flatcurve) können viel RAM nutzen, lassen sich aber über die Parameter <code>SKIP_CLAMD=y</code> und <code>SKIP_FTS=y</code> in der mailcow.conf deaktivieren.</p> <p>mailcow ist eine umfassende Groupware mit zahlreichen Features wie Webserver, Webmailer, ActiveSync, Antivirus, Antispam, Indexierung, Dokumentenscanner, Datenbank und Cache, weshalb es mehr Ressourcen benötigt als ein einfacher MTA.</p> <p>Ein einzelner SOGo-Worker kann ~350 MiB RAM belegen, bevor er geleert wird. Je mehr ActiveSync-Verbindungen Sie verwenden möchten, desto mehr RAM wird benötigt. In der Standardkonfiguration werden 20 SOGo-Worker erzeugt.</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"getstarted/prerequisite-system.de/#beispiele-fur-die-ram-planung","level":4,"title":"Beispiele für die RAM Planung","text":"<p>Ein Unternehmen mit 15 Smartphones (EAS aktiviert) und etwa 50 gleichzeitigen IMAP-Verbindungen sollte 16 GiB RAM einplanen.</p> <p>6 GiB RAM + 1 GiB Swap sind für die meisten privaten Installationen ausreichend, während 8 GiB RAM für ~5 bis 10 Benutzer empfohlen werden.</p> <p>Im Rahmen unseres Supports können wir Ihnen bei der korrekten Planung Ihres Setups helfen.</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"getstarted/prerequisite-system.de/#unterstutzte-betriebssysteme","level":3,"title":"Unterstützte Betriebssysteme","text":"<p>Wichtig</p> <p>mailcow nutzt Docker als Grundlage. Aufgrund verschiedener technischer Unterschiede zwischen den einzelnen Systemen werden nicht alle Plattformen unterstützt, auf denen Docker theoretisch lauffähig ist.</p> <p>Die folgende Tabelle enthält alle von uns offiziell unterstützten und getesteten Betriebssysteme (Stand Dezember 2024):</p> Betriebssystem Kompatibilität Alpine 3.16 und älter ⚠️ Debian 11, 12 ✅ Ubuntu 20.04 - 24.04 ✅ Alma Linux 8, 9 ✅ Rocky Linux 9 ✅ <p>Legende</p> <p>✅ = Funktioniert out of the box anhand der Anleitung. ⚠️ = Erfordert einige manuelle Anpassungen, sonst aber nutzbar. ❌ = Generell NICHT Kompatibel. ❔ = Ausstehend.</p> <p>Achtung</p> <p>Andere (nicht genannte Betriebssysteme) können auch funktionieren, sind jedoch nicht offiziell getestet worden und erhalten KEINEN Support, weder Community noch Bezahlt!</p> <p>BENUTZUNG AUF EIGENE GEFAHR!!</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"getstarted/prerequisite-system.de/#firewall-ports","level":2,"title":"Firewall &amp; Ports","text":"<p>Bitte überprüfen Sie, ob alle Standard-Ports von mailcow offen sind und nicht von anderen Anwendungen genutzt werden:</p> <pre><code>ss -tlpn | grep -E -w '25|80|110|143|443|465|587|993|995|4190'\n# oder:\nnetstat -tulpn | grep -E -w '25|80|110|143|443|465|587|993|995|4190'\n</code></pre> <p>Vorsicht</p> <p>Es gibt einige Probleme mit dem Betrieb von mailcow auf einem Firewalld/ufw aktivierten System.  Sie sollten es deaktivieren (wenn möglich) und stattdessen Ihren Regelsatz in die DOCKER-USER-Kette verschieben, die nicht durch einen Neustart des Docker-Dienstes gelöscht wird.  Siehe diese (blog.donnex.net) oder diese (unrouted.io) Anleitung für Informationen darüber, wie man iptables-persistent mit der DOCKER-USER Kette benutzt.  Da mailcow im Docker-Modus läuft, haben INPUT-Regeln keinen Effekt auf die Beschränkung des Zugriffs auf mailcow.  Verwenden Sie stattdessen die FORWARD-Kette.</p> <p>Wenn dieser Befehl irgendwelche Ergebnisse liefert, entfernen oder stoppen Sie bitte die Anwendung, die auf diesem Port läuft. Sie können mailcows Ports auch über die Konfigurationsdatei <code>mailcow.conf</code> anpassen.</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"getstarted/prerequisite-system.de/#eingehende-ports","level":3,"title":"Eingehende Ports","text":"<p>Wenn Sie eine Firewall vor mailcow haben, stellen Sie bitte sicher, dass diese Ports für eingehende Verbindungen offen sind:</p> Dienst Protokoll Port Container Variable Postfix SMTP TCP 25 postfix-mailcow <code>${SMTP_PORT}</code> Postfix SMTPS TCP 465 postfix-mailcow <code>${SMTPS_PORT}</code> Postfix Submission TCP 587 postfix-mailcow <code>${SUBMISSION_PORT}</code> Dovecot IMAP TCP 143 dovecot-mailcow <code>${IMAP_PORT}</code> Dovecot IMAPS TCP 993 dovecot-mailcow <code>${IMAPS_PORT}</code> Dovecot POP3 TCP 110 dovecot-mailcow <code>${POP_PORT}</code> Dovecot POP3S TCP 995 dovecot-mailcow <code>${POPS_PORT}</code> Dovecot ManageSieve TCP 4190 dovecot-mailcow <code>${SIEVE_PORT}</code> HTTP(S) TCP 80/443 nginx-mailcow <code>${HTTP_PORT}</code> / <code>${HTTPS_PORT}</code> <p>Um einen Dienst an eine IP-Adresse zu binden, können Sie die IP-Adresse wie folgt voranstellen: <code>SMTP_PORT=1.2.3.4:25</code></p> <p>Wichtig: Sie können keine IP:PORT-Bindungen in HTTP_PORT und HTTPS_PORT verwenden. Bitte verwenden Sie stattdessen <code>HTTP_PORT=1234</code> und <code>HTTP_BIND=1.2.3.4</code>.</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"getstarted/prerequisite-system.de/#ausgehende-portshosts","level":3,"title":"Ausgehende Ports/Hosts","text":"<p>Für die Nutzung von mailcow werden einige ausgehende Verbindungen benötigt. Stellen Sie sicher, dass mailcow mit folgenden Hosts oder auf folgenden Ports nach außen kommunizieren kann:</p> Dienst Protokoll Port Ziel Grund Clamd TCP 873 rsync.sanesecurity.net Download ClamAV Signaturen (Prebundled in mailcow) Dovecot TCP 443 spamassassin.heinlein-support.de Herunterladen von Spamassasin Regeln, die Rspamd verarbeitet, Download erfolgt über Dovecot mailcow Prozesse TCP 80/443 github.com Download von mailcow Updates (Code Basiert) mailcow Prozesse TCP 443 hub.docker.com Download von Docker Images (direkt von Docker Hub) mailcow Prozesse TCP 443 asn-check.mailcow.email API Abfrage auf Prüfung BAD ASN (für Spamhaus Free Blocklists) mailcow Prozesse TCP 80 ip4.mailcow.email &amp; ip6.mailcow.email Ermittelung der eigenen öffentlichen IP Adresse zur Anzeige in UI (optional) Postfix TCP 25, 465 Beliebig / Any Ausgehende Verbindung MTA Rspamd TCP 80 fuzzy.mailcow.email Download von Bad Subject Regex Maps (Trainiert von Servercow) Rspamd TCP 443 bazaar.abuse.ch Download von Mailware MD5 Prüfsummen zur Erkennung von Rspamd Rspamd TCP 443 urlhaus.abuse.ch Download von Malware Downloads Links zur Erkennung in Rspamd Rspamd UDP 11445 fuzzy.mailcow.email Anbindung an Globalen mailcow Fuzzy (Trainiert von Servercow + Community) Rspamd UDP 11335 fuzzy1.rspamd.com &amp; fuzzy2.rspamd.com Anbindung an Globalen Rspamd Fuzzy (Trainiert vom Rspamd Team) Unbound TCP &amp; UDP 53 Beliebig / Any DNS Auflösung für mailcow Stack (Zur Validierung von DNSSEC und Abruf von Spamlistinformationen) Unbound ICMP (Ping) 1.1.1.1, 8.8.8.8, 9.9.9.9 Simpler Internet Konnektivitätscheck","path":["Prerequisite system.de"],"tags":[]},{"location":"getstarted/prerequisite-system.de/#wichtig-fur-hetzner-firewalls","level":3,"title":"Wichtig für Hetzner Firewalls","text":"<p>Ich zitiere https://github.com/chermsen über https://github.com/mailcow/mailcow-dockerized/issues/497#issuecomment-469847380 (DANKE!):</p> <p>Für alle, die mit der Hetzner-Firewall zu kämpfen haben:</p> <p>Port 53 ist in diesem Fall für die Firewall-Konfiguration unwichtig. Laut Dokumentation verwendet unbound den Portbereich 1024-65535 für ausgehende Anfragen. Da es sich bei der Hetzner Robot Firewall um eine statische Firewall handelt (jedes eingehende Paket wird isoliert geprüft) - müssen die folgenden Regeln angewendet werden:</p> <p>Für TCP <pre><code>SRC-IP: ---\nDST-IP: ---\nSRC-Port: ---\nDST-Port: 1024-65535\nProtokoll: tcp\nTCP-Flags: ack\nAktion:      Akzeptieren\n</code></pre></p> <p>Für UDP <pre><code>SRC-IP: ---\nDST-IP: ---\nSRC-Port: ---\nDST-Port: 1024-65535\nProtokoll: udp\nAktion:      Akzeptieren\n</code></pre></p> <p>Wenn man einen restriktiveren Portbereich anwenden will, muss man zuerst die Konfiguration von unbound ändern (nach der Installation):</p> <p>{mailcow-dockerized}/data/conf/unbound/unbound.conf: <pre><code>outgoing-port-avoid: 0-32767\n</code></pre></p> <p>Nun können die Firewall-Regeln wie folgt angepasst werden:</p> <pre><code>[...]\nDST Port: 32768-65535\n[...]\n</code></pre>","path":["Prerequisite system.de"],"tags":[]},{"location":"getstarted/prerequisite-system.de/#datum-und-uhrzeit","level":2,"title":"Datum und Uhrzeit","text":"<p>Um sicherzustellen, dass Sie das richtige Datum und die richtige Zeit auf Ihrem System eingestellt haben, überprüfen Sie bitte die Ausgabe von <code>timedatectl status</code>:</p> <pre><code>$ timedatectl status\n      Lokale Zeit: Sat 2017-05-06 02:12:33 CEST\n  Weltzeit: Sa 2017-05-06 00:12:33 UTC\n        RTC-Zeit: Sa 2017-05-06 00:12:32\n       Zeitzone: Europa/Berlin (MESZ, +0200)\n     NTP aktiviert: ja\nNTP synchronisiert: ja\n RTC in lokaler TZ: nein\n      Sommerzeit aktiv: ja\n Letzte DST-Änderung: Sommerzeit begann am\n                  Sonne 2017-03-26 01:59:59 MEZ\n                  So 2017-03-26 03:00:00 MESZ\n Nächste Sommerzeitänderung: Die Sommerzeit endet (die Uhr springt eine Stunde rückwärts) am\n                  Sun 2017-10-29 02:59:59 MESZ\n                  Sun 2017-10-29 02:00:00 MEZ\n</code></pre> <p>Die Zeilen <code>NTP aktiviert: ja</code> und <code>NTP synchronisiert: ja</code> zeigen an, ob Sie NTP aktiviert haben und ob es synchronisiert ist.</p> <p>Um NTP zu aktivieren, müssen Sie den Befehl <code>timedatectl set-ntp true</code> ausführen. Sie müssen auch Ihre <code>/etc/systemd/timesyncd.conf</code> bearbeiten:</p> <pre><code># vim /etc/systemd/timesyncd.conf\n[Zeit]\nNTP=0.pool.ntp.org 1.pool.ntp.org 2.pool.ntp.org 3.pool.ntp.org\n</code></pre>","path":["Prerequisite system.de"],"tags":[]},{"location":"getstarted/prerequisite-system.de/#hetzner-cloud-und-wahrscheinlich-andere","level":2,"title":"Hetzner Cloud (und wahrscheinlich andere)","text":"<p>Prüfen Sie <code>/etc/network/interfaces.d/50-cloud-init.cfg</code> und ändern Sie die IPv6-Schnittstelle von eth0:0 auf eth0:</p> <pre><code># Falsch:\nauto eth0:0\niface eth0:0 inet6 static\n# Richtig:\nauto eth0\niface eth0 inet6 static\n</code></pre> <p>Starten Sie die Schnittstelle neu, um die Einstellungen zu übernehmen. Sie können außerdem die cloud-init Netzwerkänderungen deaktivieren.</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"getstarted/prerequisite-system.de/#mtu","level":2,"title":"MTU","text":"<p>Besonders relevant für OpenStack-Benutzer: Überprüfen Sie Ihre MTU und setzen Sie sie entsprechend in docker-compose.yml. Siehe Problebehandlungen in unseren Installationsanleitungen.</p>","path":["Prerequisite system.de"],"tags":[]},{"location":"getstarted/prerequisite-system.en/","level":1,"title":"Prerequisite system.en","text":"<p>Before you run mailcow: dockerized, there are a few requirements that you should check:</p> <p>Warning</p> <p>Do not try to install mailcow on a Synology/QNAP device (any NAS), OpenVZ, LXC or other container platforms. KVM, ESX, Hyper-V and other full virtualization platforms are supported.</p> <p>Info</p> <ul> <li>mailcow: dockerized requires some ports to be open for incoming connections, so make sure that your firewall is not blocking these.</li> <li>Make sure that no other application is interfering with mailcow's configuration, such as another mail service</li> <li>A correct DNS setup is crucial to every good mailserver setup, so please make sure you got at least the basics covered before you begin!</li> <li>Make sure that your system has a correct date and time setup. This is crucial for various components like two factor TOTP authentication.</li> </ul>","path":["Prerequisite system.en"],"tags":[]},{"location":"getstarted/prerequisite-system.en/#minimum-system-resources","level":2,"title":"Minimum System Resources","text":"<p>Please make sure that your system has at least the following resources:</p> Resource Minimal Requirement CPU 1 GHz RAM Minimum 6 GiB + 1 GiB swap (default config) Disk 20 GiB (without emails) Architecture x86_64, ARM64 <p>Not supported</p> <p>OpenVZ, Virtuozzo and LXC</p> <p>ClamAV and Solr can be greedy with RAM. You may disable them in <code>mailcow.conf</code> by settings <code>SKIP_CLAMD=y</code> and <code>SKIP_SOLR=y</code>.</p> <p>Info</p> <p>We are aware that a pure MTA can run on 128 MiB RAM. mailcow is a full-grown and ready-to-use groupware with many extras making life easier. mailcow comes with a webserver, webmailer, ActiveSync (MS), antivirus, antispam, indexing (Solr), document scanner (Oletools), SQL (MariaDB), Cache (Redis), MDA, MTA, various web services etc.</p> <p>A single SOGo worker can acquire ~350 MiB RAM before it gets purged. The more ActiveSync connections you plan to use, the more RAM you will need. A default configuration spawns 20 workers.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"getstarted/prerequisite-system.en/#ram-usage-examples","level":4,"title":"RAM usage examples","text":"<p>A company with 15 phones (EAS enabled) and about 50 concurrent IMAP connections should plan 16 GiB RAM.</p> <p>6 GiB RAM + 1 GiB swap are fine for most private installations while 8 GiB RAM are recommended for ~5 to 10 users.</p> <p>We can help to correctly plan your setup as part of our support.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"getstarted/prerequisite-system.en/#supported-os","level":3,"title":"Supported OS","text":"<p>Important</p> <p>mailcow is using Docker as a base component, due to some technical differences across multiple platforms we do not support all, even if they can run Docker.</p> <p>The following table contains all operating systems officially supported and tested by us (as of December 2024):</p> OS Compatibility Alpine since 3.17 ⚠️ Debian 11, 12 ✅ Ubuntu 20.04 - 24.04 ✅ Alma Linux 8, 9 ✅ Rocky Linux 9 ✅ <p>Legend</p> <p>✅ = Works out of the box using the instructions. ⚠️ = Requires some manual adjustments otherwise usable. ❌ = In general NOT Compatible. ❔ = Pending.</p> <p>Warning</p> <p>Note: All other operating systems (not mentioned) may also work, but have not been officially tested.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"getstarted/prerequisite-system.en/#firewall-ports","level":2,"title":"Firewall &amp; Ports","text":"<p>Please check if any of mailcow's standard ports are open and not in use by other applications:</p> <pre><code>ss -tlpn | grep -E -w '25|80|110|143|443|465|587|993|995|4190'\n# or:\nnetstat -tulpn | grep -E -w '25|80|110|143|443|465|587|993|995|4190'\n</code></pre> <p>Danger</p> <p>There are several problems with running mailcow on a firewalld/ufw enabled system.  You should disable it (if possible) and move your ruleset to the DOCKER-USER chain, which is not cleared by a Docker service restart, instead.  See this (blog.donnex.net) or this (unrouted.io) guide for information about how to use iptables-persistent with the DOCKER-USER chain. As mailcow runs dockerized, INPUT rules have no effect on restricting access to mailcow.  Use the FORWARD chain instead.</p> <p>If this command returns any results please remove or stop the application running on that port. You may also adjust mailcows ports via the <code>mailcow.conf</code> configuration file.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"getstarted/prerequisite-system.en/#incoming-ports","level":3,"title":"Incoming Ports","text":"<p>If you have a firewall in front of mailcow, please ensure that these ports are open for incoming connections:</p> Service Protocol Port Container Variable Postfix SMTP TCP 25 postfix-mailcow <code>${SMTP_PORT}</code> Postfix SMTPS TCP 465 postfix-mailcow <code>${SMTPS_PORT}</code> Postfix Submission TCP 587 postfix-mailcow <code>${SUBMISSION_PORT}</code> Dovecot IMAP TCP 143 dovecot-mailcow <code>${IMAP_PORT}</code> Dovecot IMAPS TCP 993 dovecot-mailcow <code>${IMAPS_PORT}</code> Dovecot POP3 TCP 110 dovecot-mailcow <code>${POP_PORT}</code> Dovecot POP3S TCP 995 dovecot-mailcow <code>${POPS_PORT}</code> Dovecot ManageSieve TCP 4190 dovecot-mailcow <code>${SIEVE_PORT}</code> HTTP(S) TCP 80/443 nginx-mailcow <code>${HTTP_PORT}</code> / <code>${HTTPS_PORT}</code> <p>To bind a service to an IP address, you can prefix the IP address as follows: <code>SMTP_PORT=1.2.3.4:25</code></p> <p>Important: You cannot use IP:PORT bindings for <code>HTTP_PORT</code> and <code>HTTPS_PORT</code>. Please use <code>HTTP_PORT=1234</code> and <code>HTTP_BIND=1.2.3.4</code> instead.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"getstarted/prerequisite-system.en/#outgoing-portshosts","level":3,"title":"Outgoing Ports/Hosts","text":"<p>Some outgoing connections are required to use mailcow. Ensure that mailcow can communicate with the following hosts or ports:</p> Service Protocol Port Target Reason Clamd TCP 873 rsync.sanesecurity.net Download ClamAV signatures (prebundled in mailcow) Dovecot TCP 443 spamassassin.heinlein-support.de Download Spamassassin rules processed by Rspamd, downloaded via Dovecot mailcow Processes TCP 80/443 github.com Download mailcow updates (code-based) mailcow Processes TCP 443 hub.docker.com Download Docker images (directly from Docker Hub) mailcow Processes TCP 443 asn-check.mailcow.email API request for BAD ASN checks (for Spamhaus Free Blocklists) mailcow Processes TCP 80 ip4.mailcow.email &amp; ip6.mailcow.email Retrieve public IP address for display in UI (optional) Postfix TCP 25, 465 Any Outgoing connection for MTA Rspamd TCP 80 fuzzy.mailcow.email Download bad subject regex maps (trained by Servercow) Rspamd TCP 443 bazaar.abuse.ch Download malware MD5 checksums for detection by Rspamd Rspamd TCP 443 urlhaus.abuse.ch Download malware download links for detection in Rspamd Rspamd UDP 11445 fuzzy.mailcow.email Connection to global mailcow fuzzy (trained by Servercow + community) Rspamd UDP 11335 fuzzy1.rspamd.com &amp; fuzzy2.rspamd.com Connection to global Rspamd fuzzy (trained by the Rspamd team) Unbound TCP &amp; UDP 53 Any DNS resolution for the mailcow stack (for DNSSEC validation and retrieval of spam list info) Unbound ICMP (Ping) 1.1.1.1, 8.8.8.8, 9.9.9.9 Basic internet connectivity check","path":["Prerequisite system.en"],"tags":[]},{"location":"getstarted/prerequisite-system.en/#important-for-hetzner-firewalls","level":3,"title":"Important for Hetzner firewalls","text":"<p>Quoting https://github.com/chermsen via https://github.com/mailcow/mailcow-dockerized/issues/497#issuecomment-469847380 (THANK YOU!):</p> <p>For all who are struggling with the Hetzner firewall:</p> <p>Port 53 unimportant for the firewall configuration in this case. According to the documentation unbound uses the port range 1024-65535 for outgoing requests. Since the Hetzner Robot Firewall is a static firewall (each incoming packet is checked isolated) - the following rules must be applied:</p> <p>For TCP <pre><code>SRC-IP:       ---\nDST IP:       ---\nSRC Port:    ---\nDST Port:    1024-65535\nProtocol:    tcp\nTCP flags:   ack\nAction:      Accept\n</code></pre></p> <p>For UDP <pre><code>SRC-IP:       ---\nDST IP:       ---\nSRC Port:    ---\nDST Port:    1024-65535\nProtocol:    udp\nAction:      Accept\n</code></pre></p> <p>If you want to apply a more restrictive port range you have to change the config of unbound first (after installation):</p> <p>{mailcow-dockerized}/data/conf/unbound/unbound.conf: <pre><code>outgoing-port-avoid: 0-32767\n</code></pre></p> <p>Now the firewall rules can be adjusted as follows:</p> <pre><code>[...]\nDST Port:  32768-65535\n[...]\n</code></pre>","path":["Prerequisite system.en"],"tags":[]},{"location":"getstarted/prerequisite-system.en/#date-and-time","level":2,"title":"Date and Time","text":"<p>To ensure that you have the correct date and time setup on your system, please check the output of <code>timedatectl status</code>:</p> <pre><code>$ timedatectl status\n      Local time: Sat 2017-05-06 02:12:33 CEST\n  Universal time: Sat 2017-05-06 00:12:33 UTC\n        RTC time: Sat 2017-05-06 00:12:32\n       Time zone: Europe/Berlin (CEST, +0200)\n     NTP enabled: yes\nNTP synchronized: yes\n RTC in local TZ: no\n      DST active: yes\n Last DST change: DST began at\n                  Sun 2017-03-26 01:59:59 CET\n                  Sun 2017-03-26 03:00:00 CEST\n Next DST change: DST ends (the clock jumps one hour backwards) at\n                  Sun 2017-10-29 02:59:59 CEST\n                  Sun 2017-10-29 02:00:00 CET\n</code></pre> <p>The lines <code>NTP enabled: yes</code> and <code>NTP synchronized: yes</code> indicate whether you have NTP enabled and if it's synchronized.</p> <p>To enable NTP you need to run the command <code>timedatectl set-ntp true</code>. You also need to edit your <code>/etc/systemd/timesyncd.conf</code>:</p> <pre><code># vim /etc/systemd/timesyncd.conf\n[Time]\nNTP=0.pool.ntp.org 1.pool.ntp.org 2.pool.ntp.org 3.pool.ntp.org\n</code></pre>","path":["Prerequisite system.en"],"tags":[]},{"location":"getstarted/prerequisite-system.en/#hetzner-cloud-and-probably-others","level":2,"title":"Hetzner Cloud (and probably others)","text":"<p>Check <code>/etc/network/interfaces.d/50-cloud-init.cfg</code> and change the IPv6 interface from eth0:0 to eth0:</p> <pre><code># Wrong:\nauto eth0:0\niface eth0:0 inet6 static\n# Right:\nauto eth0\niface eth0 inet6 static\n</code></pre> <p>Reboot or restart the interface. You may want to disable cloud-init network changes.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"getstarted/prerequisite-system.en/#mtu","level":2,"title":"MTU","text":"<p>Especially relevant for OpenStack users: Check your MTU and set it accordingly in docker-compose.yml. See Troubleshooting in our Installation guide.</p>","path":["Prerequisite system.en"],"tags":[]},{"location":"maintenance/deinstall.de/","level":1,"title":"Deinstall.de","text":"<p>Um mailcow: dockerized mit all seinen Volumes, Images und Containern zu entfernen, tun Sie dies:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down -v --rmi all --remove-orphans\n</code></pre> <pre><code>docker-compose down -v --rmi all --remove-orphans\n</code></pre> <p>Info</p> <ul> <li>-v Entfernt benannte Volumes, die im Abschnitt <code>volumes</code> der Compose-Datei deklariert sind, und anonyme Volumes, die an Container angehängt sind.</li> <li>--rmi  Images entfernen. Der Typ muss einer der folgenden sein: <code>all</code>: Entfernt alle Images, die von einem beliebigen Dienst verwendet werden. <code>local</code>: Entfernt nur Bilder, die kein benutzerdefiniertes Tag haben, das durch das Feld \"image\" gesetzt wurde. <li>--remove-orphans Entfernt Container für Dienste, die nicht in der Compose-Datei definiert sind.</li> <li>Standardmäßig entfernt <code>docker compose down</code> nur derzeit aktive Container und Netzwerke, die in der Datei <code>docker-compose.yml</code> definiert sind.</li>","path":["Deinstall.de"],"tags":[]},{"location":"maintenance/deinstall.en/","level":1,"title":"Deinstall.en","text":"<p>To remove mailcow: dockerized with all it's volumes, images and containers do:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down -v --rmi all --remove-orphans\n</code></pre> <pre><code>docker-compose down -v --rmi all --remove-orphans\n</code></pre> <p>Info</p> <ul> <li>-v Remove named volumes declared in the <code>volumes</code> section of the Compose file and anonymous volumes attached to containers.</li> <li>--rmi  Remove images. Type must be one of: <code>all</code>: Remove all images used by any service. <code>local</code>: Remove only images that don't have a custom tag set by the <code>image</code> field. <li>--remove-orphans Remove containers for services not defined in the compose file.</li> <li>By default <code>docker compose down</code> only removes currently active containers and networks defined in the <code>docker-compose.yml</code>.</li>","path":["Deinstall.en"],"tags":[]},{"location":"maintenance/migration.de/","level":1,"title":"Migration.de","text":"<p>Warnung</p> <p>Diese Anleitung geht davon aus, dass Sie beabsichtigen, einen bestehenden mailcow-Server (Quelle) auf einen brandneuen, leeren Server (Ziel) zu migrieren. Sie kümmert sich nicht um die Erhaltung bestehender Daten auf dem Zielserver und löscht alles innerhalb von <code>/var/lib/docker/volumes</code> und somit alle Docker-Volumes, die Sie bereits eingerichtet haben.</p> <p>Tip</p> <p>Alternativ können Sie das Skript <code>./helper-scripts/backup_and_restore.sh</code> verwenden, um ein vollständiges Backup auf der Quellmaschine zu erstellen, dann installieren Sie mailcow auf der Zielmaschine wie gewohnt, kopieren Sie Ihre <code>mailcow.conf</code> und verwenden Sie das gleiche Skript, um Ihr Backup auf der Zielmaschine wiederherzustellen.</p> <p>1. Befolgen Sie die Installationsanleitung von Docker und Compose.</p> <p>2. Stoppen Sie Docker und stellen Sie sicher, dass Docker gestoppt wurde: <pre><code>systemctl stop docker.service\nsystemctl status docker.service\n</code></pre></p> <p>3. Führen Sie die folgenden Befehle auf dem Quellcomputer aus (achten Sie darauf, die abschließenden Schrägstriche im ersten Pfadparameter wie unten gezeigt hinzuzufügen!) - WARNUNG: Dieser Befehl löscht alles, was bereits unter <code>/var/lib/docker/volumes</code> auf dem Zielrechner existiert:</p> Innerhalb der selben ArchitekturAuf andere Architektur <pre><code>rsync -aHhP --numeric-ids --delete /opt/mailcow-dockerized/ root@target-machine.example.com:/opt/mailcow-dockerized\nrsync -aHhP --numeric-ids --delete /var/lib/docker/volumes/ root@target-machine.example.com:/var/lib/docker/volumes\n</code></pre> <pre><code>rsync -aHhP --numeric-ids --delete /opt/mailcow-dockerized/ root@target-machine.example.com:/opt/mailcow-dockerized\nrsync -aHhP --numeric-ids --delete --exclude '*rspamd-vol-1' /var/lib/docker/volumes/ root@target-machine.example.com:/var/lib/docker/volumes\n</code></pre> <p>Achtung</p> <p>Bitte befolgen Sie die Anweisungen für den jeweiligen Anwendungsfall, da bei einer Migration auf eine andere Architektur das Volume <code>rspamd-vol-1</code> ausgelassen werden muss, da es inkompatible Hyperscan-Cache-Dateien enthält, die bei einem Plattformwechsel zu Abstürzen mit anschließendem Nichtstart von Rspamd führen.</p> <p>Die Hyperscan-Cache-Dateien werden bei einem Neustart von Rspamd automatisch regeneriert, wenn diese nicht existieren.</p> <p>4. Schalten Sie mailcow ab und stoppen Sie Docker auf dem Quellrechner.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ndocker compose down\nsystemctl stop docker.service\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ndocker-compose down\nsystemctl stop docker.service\n</code></pre> <p>5. Wiederholen Sie Schritt 3 mit denselben Befehlen. Dies wird viel schneller gehen als beim ersten Mal, da nun nur noch die Differenzen übertragen werden.</p> <p>6. Wechseln Sie auf den Zielrechner und starten Sie Docker. <pre><code>systemctl start docker.service\n</code></pre></p> <p>7. Ziehen Sie nun die mailcow Docker-Images auf den Zielrechner.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ndocker compose pull\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ndocker-compose pull\n</code></pre> <p>8. Starten Sie den gesamten mailcow-Stack und alles sollte fertig sein!</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>9. Zum Schluss ändern Sie Ihre DNS-Einstellungen so, dass sie auf den Zielserver zeigen. Prüfen und ändern Sie gegebenenfalls die <code>SNAT_TO_SOURCE</code> Variable in der <code>mailcow.conf</code> im mailcow-dockerized Ordner, da andernfalls SOGo nicht richtig funktioniert, wenn die ausgehende IP eine andere ist.</p>","path":["Migration.de"],"tags":[]},{"location":"maintenance/migration.en/","level":1,"title":"Migration.en","text":"<p>Warning</p> <p>This guide assumes you intend to migrate an existing mailcow server (source) over to a brand new, empty server (target). It takes no care about preserving any existing data on your target server and will erase anything within <code>/var/lib/docker/volumes</code> and thus any Docker volumes you may have already set up.</p> <p>Tip</p> <p>Alternatively, you can use the <code>./helper-scripts/backup_and_restore.sh</code> script to create a full backup on the source machine, then install mailcow on the target machine as usual, copy over your <code>mailcow.conf</code> and use the same script to restore your backup to the target machine.</p> <p>1. Follow the installation guide to install Docker and Compose.</p> <p>2. Stop Docker and assure Docker has stopped: <pre><code>systemctl stop docker.service\nsystemctl status docker.service\n</code></pre></p> <p>3. Run the following commands on the source machine (take care of adding the trailing slashes in the first path parameter as shown below!) - WARNING: This command will erase anything that may already exist under <code>/var/lib/docker/volumes</code> on the target machine:</p> Within the same architectureTo other architecture <pre><code>rsync -aHhP --numeric-ids --delete /opt/mailcow-dockerized/ root@target-machine.example.com:/opt/mailcow-dockerized\nrsync -aHhP --numeric-ids --delete /var/lib/docker/volumes/ root@target-machine.example.com:/var/lib/docker/volumes\n</code></pre> <pre><code>rsync -aHhP --numeric-ids --delete /opt/mailcow-dockerized/ root@target-machine.example.com:/opt/mailcow-dockerized\nrsync -aHhP --numeric-ids --delete --exclude '*rspamd-vol-1' /var/lib/docker/volumes/ root@target-machine.example.com:/var/lib/docker/volumes\n</code></pre> <p>Danger</p> <p>Please follow the instructions for the respective use case, as the volume <code>rspamd-vol-1</code> must be omitted when migrating to a different architecture, as it contains incompatible hyperscan cache files that lead to crashes and subsequent failure to start Rspamd when switching platforms.</p> <p>The hyperscan cache files are automatically regenerated when Rspamd is restarted if they do not exist.</p> <p>4. Shut down mailcow and stop Docker on the source machine.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ndocker compose down\nsystemctl stop docker.service\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ndocker-compose down\nsystemctl stop docker.service\n</code></pre> <p>5. Repeat step 3 with the same commands. This will be much quicker than the first time as it now only syncs the diffs.</p> <p>6. Switch over to the target machine and start Docker. <pre><code>systemctl start docker.service\n</code></pre></p> <p>7. Now pull the mailcow Docker images on the target machine.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ndocker compose pull\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ndocker-compose pull\n</code></pre> <p>8. Start the whole mailcow stack and everything should be done!</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>9. Finally, change your DNS settings to point to the target server. Also check the <code>SNAT_TO_SOURCE</code> variable in your <code>mailcow.conf</code> file if you have changed your public IP address, otherwise SOGo may not work.</p>","path":["Migration.en"],"tags":[]},{"location":"maintenance/update.de/","level":1,"title":"Update.de","text":"","path":["Update.de"],"tags":[]},{"location":"maintenance/update.de/#mailcow-automatisch-updaten","level":2,"title":"mailcow automatisch Updaten","text":"<p>Ein Update-Skript in Ihrem mailcow-dockerized Verzeichnis kümmert sich um Updates.</p> <p>Führen sie das Update-Skript aus: <pre><code>./update.sh\n</code></pre></p> <p>Wenn es nötig ist, wird es Sie fragen, wie Sie fortfahren möchten. Merge-Fehler werden gemeldet. Einige kleinere Konflikte werden automatisch korrigiert (zugunsten des mailcow-dockerized repository code).</p>","path":["Update.de"],"tags":[]},{"location":"maintenance/update.de/#optionen","level":3,"title":"Optionen","text":"<pre><code># Optionen können kombiniert werden\n\n# - Prüft auf Updates und zeigt Änderungen an\n./update.sh --check\n\n# - Starten Sie mailcow nicht, nachdem Sie ein Update durchgeführt haben\n./update.sh --skip-start\n\n# - Überspringt den ICMP Check auf die öffentlichen DNS Resolver (Bitte nur nutzen, wenn keinerlei ICMP Verbindungen von und zur mailcow erlaubt sind)\n./update.sh --skip-ping-check\n\n# - Wechselt die Update Quellen der mailcow auf nightly (unstabile) Inhalte.\nNUR ZUM TESTEN VERWENDEN!! KEIN PRODUKTIV BETRIEB!!!\n./update.sh --nightly\n\n# - Wechselt die Update Quellen der mailcow auf stable (stabile) Inhalte (standard).\n./update.sh --stable\n\n# - Erzwinge Update (unbeaufsichtigt, aber nicht unterstützt, Benutzung auf eigenes Risiko)\n./update.sh --force\n\n# - Garbage Collector ausführen, um alte Image-Tags zu bereinigen und beenden\n./update.sh --gc\n\n# - Update mit der Merge-Strategie-Option \"ours\" statt \"theirs\"\n# Dies wird **Konflikte** beim Zusammenführen zugunsten Ihrer lokalen Änderungen lösen und sollte vermieden werden. Lokale Änderungen werden immer beibehalten, es sei denn, wir haben auch die Datei XY geändert.\n./update.sh --ours\n\n# - Nicht aktualisieren, nur holen von Docker Images\n./update.sh --prefetch\n</code></pre>","path":["Update.de"],"tags":[]},{"location":"maintenance/update.de/#ich-habe-vergessen-was-ich-vor-dem-ausfuhren-von-updatesh-geandert-habe","level":3,"title":"Ich habe vergessen, was ich vor dem Ausführen von update.sh geändert habe.","text":"<p>Siehe <code>git log --pretty=oneline | grep -i \"before update\"</code>, Sie werden eine Ausgabe ähnlich dieser haben:</p> <pre><code>22cd00b5e28893ef9ddef3c2b5436453cc5223ab Before update on 2020-09-28_19_25_45\ndacd4fb9b51e9e1c8a37d84485b92ffaf6c59353 Before update on 2020-08-07_13_31_31\n</code></pre> <p>Führen Sie <code>git diff 22cd00b5e28893ef9ddef3c2b5436453cc5223ab</code> aus, um zu sehen, was sich geändert hat.</p>","path":["Update.de"],"tags":[]},{"location":"maintenance/update.de/#kann-ich-ein-rollback-durchfuhren","level":3,"title":"Kann ich ein Rollback durchführen?","text":"<p>Ja.</p> <p>Siehe das obige Thema, anstelle eines Diffs führen Sie checkout aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\n# Ersetzen Sie die Commit-ID 22cd00b5e28893ef9ddef3c2b5436453cc5223ab durch Ihre ID\ngit checkout 22cd00b5e28893ef9ddef3c2b5436453cc5223ab\ndocker compose pull\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\n# Ersetzen Sie die Commit-ID 22cd00b5e28893ef9ddef3c2b5436453cc5223ab durch Ihre ID\ngit checkout 22cd00b5e28893ef9ddef3c2b5436453cc5223ab\ndocker-compose pull\ndocker-compose up -d\n</code></pre>","path":["Update.de"],"tags":[]},{"location":"maintenance/update.de/#hooks","level":3,"title":"Hooks","text":"<p>Sie können sich in den Update-Mechanismus einklinken, indem Sie Skripte namens <code>pre_commit_hook.sh</code> und <code>post_commit_hook.sh</code> zu Ihrem mailcows-Root-Verzeichnis hinzufügen. Siehe hier für weitere Details.</p>","path":["Update.de"],"tags":[]},{"location":"maintenance/update.de/#update-zyklus","level":2,"title":"Update-Zyklus","text":"<ul> <li>Wir planen in jedem Monat ein neues Hauptupdate zu veröffentlichen.</li> <li>Die Updates sind wie folgt nummeriert: <code>JJJJ-MM</code> (Beispiel: <code>2022-05</code>).</li> <li>Fehlerkorrekturen eines Hauptupdates werden bei uns als \"Revisionen\" wie a,b,c (Beispiele: <code>2022-05a</code>, <code>2022-05b</code> usw.) erscheinen.</li> </ul>","path":["Update.de"],"tags":[]},{"location":"maintenance/update.de/#update-varianten","level":2,"title":"Update-Varianten","text":"<p>stable (stabile Updates): Diese Updates sind für den Produktivbetrieb geeignet. Sie erscheinen in einem Zyklus von mindest 1x im Monat.</p> <p>nightly (instabile Updates): Diese Updates sind NICHT für den Produktivbetrieb geeignet und dienen lediglich dem Testen. Die nightly Updates sind den stabilen Updates vorraus, da in diesen neue und auch umfangreichere Funktionen getestet werden bevor diese für alle User Live gehen.</p>","path":["Update.de"],"tags":[]},{"location":"maintenance/update.de/#nightly-updates-beziehen","level":2,"title":"Nightly Updates beziehen","text":"","path":["Update.de"],"tags":[]},{"location":"maintenance/update.de/#infos-zu-den-nightly-updates","level":3,"title":"Infos zu den Nightly Updates","text":"<p>Seit dem 2022-08 Update gibt es die Möglichkeit die Update quellen zu ändern. Bisher diente der master Branch auf GitHub als einzige (offizieller) Update Quelle. Mit dem August 2022 Update gibt es aber nun noch den Nightly Branch welcher instabile und größere Änderungen zum testen und Feedback geben enthält.</p> <p>Dabei bekommt der Nightly Branch immer dann neue Updates, wenn irgendetwas am mailcow Projekt fertig gemacht wurde was in die neue Hauptversion reinkommt.</p> <p>Neben den offensichtlichen neuerungen welche sowieso im nächsten Major Update enthalten sein werden enthält er ebenfalls erstmal exklusive Features welche eine längere Testzeit brauchen (bspw. das UI Update auf Bootstrap 5).</p>","path":["Update.de"],"tags":[]},{"location":"maintenance/update.de/#wie-bekomme-ich-nightly-updates","level":3,"title":"Wie bekomme ich Nightly Updates?","text":"<p>Der Vorgang ist relativ simpel. Mit dem 2022-08 Update (ein Update auf die Version voraussgesetzt) ist es möglich die <code>update.sh</code> mit dem Parameter <code>--nightly</code> zu starten.</p> <p>Achtung</p> <p>Bitte machen Sie vorher ein Backup oder folgen Sie dem Abschnitt Best Practice Nightly Update bevor Sie auf die Nightly Builds von mailcow wechseln. Wir sind für keinerlei Datenverluste/korruptionen verantwortlich, also arbeiten Sie mit bedacht!</p> <p>Das Skript wird nun den Branch wechseln mit <code>git checkout nightly</code> d.h. es wird auch wieder nach den IPv6 Einstellungen fragen. Das ist aber normal.</p> <p>Sollte alles problemlos geklappt haben (wofür wir ja auch vorsichtshalber ein Backup vorher gemacht haben) sollte nun in der mailcow UI unten rechts die aktuelle Versionsnummer samt Datumsstempel abgebildet sein:  </p>","path":["Update.de"],"tags":[]},{"location":"maintenance/update.de/#best-practice-nightly-update","level":3,"title":"Best Practice Nightly Update","text":"<p>Info</p> <p>Wir empfehlen die Benutzung des Nightly Updates nur dann, wenn Ihr eine weitere Maschine oder VM besitzt und diese NICHT Produktiv nutzt.</p> <ol> <li>Das Cold-Standby Skript nutzen um die Maschine vor dem Schwenk auf die Nightly Builds auf ein anderes System zu kopieren.</li> <li>Das <code>update.sh</code> Skript auf der neuen Maschine mit dem Parameter <code>--nightly</code> ausführen und bestätigen.</li> <li>Die Nightly Updates auf der sekundären Maschine erleben/testen.</li> </ol>","path":["Update.de"],"tags":[]},{"location":"maintenance/update.en/","level":1,"title":"Update.en","text":"","path":["Update.en"],"tags":[]},{"location":"maintenance/update.en/#automatic-update","level":2,"title":"Automatic update","text":"<p>An update script in your mailcow-dockerized directory will take care of updates.</p> <p>Run the update script: <pre><code>./update.sh\n</code></pre></p> <p>If it needs to, it will ask you how you wish to proceed. Merge errors will be reported. Some minor conflicts will be auto-corrected (in favour for the mailcow-dockerized repository code).</p>","path":["Update.en"],"tags":[]},{"location":"maintenance/update.en/#options","level":3,"title":"Options","text":"<pre><code># Options can be combined\n\n# - Check for updates and show changes\n./update.sh --check\n\n# - Do not start mailcow after applying an update\n./update.sh --skip-start\n\n# - Skip ICMP Check to public DNS resolvers (Use it only if you´ve blocked any ICMP Connections to your mailcow machine)\n./update.sh --skip-ping-check\n\n# - Switch your mailcow updates to the unstable (nightly) branch.\nFOR TESTING PURPOSES ONLY!!!! NOT READY FOR PRODUCTION!!!\n./update.sh --nightly\n\n# - Switch your mailcow updates to the stable (master) branch. Default unless you changed it with --nightly.\n./update.sh --stable\n\n# - Force update (unattended, but unsupported, use at own risk)\n./update.sh --force\n\n# - Run garbage collector to cleanup old image tags and exit\n./update.sh --gc\n\n# - Update with merge strategy option \"ours\" instead of \"theirs\"\n#   This will **solve conflicts** when merging in favor for your local changes and should be avoided. Local changes will always be kept, unless we changed file XY, too.\n./update.sh --ours\n\n# - Don't update, but prefetch images and exit\n./update.sh --prefetch\n</code></pre>","path":["Update.en"],"tags":[]},{"location":"maintenance/update.en/#i-forgot-what-i-changed-before-running-updatesh","level":3,"title":"I forgot what I changed before running update.sh","text":"<p>See <code>git log --pretty=oneline | grep -i \"before update\"</code>, you will have an output similar to this:</p> <pre><code>22cd00b5e28893ef9ddef3c2b5436453cc5223ab Before update on 2020-09-28_19_25_45\ndacd4fb9b51e9e1c8a37d84485b92ffaf6c59353 Before update on 2020-08-07_13_31_31\n</code></pre> <p>Run <code>git diff 22cd00b5e28893ef9ddef3c2b5436453cc5223ab</code> to see what changed.</p>","path":["Update.en"],"tags":[]},{"location":"maintenance/update.en/#can-i-roll-back","level":3,"title":"Can I roll back?","text":"<p>Yes.</p> <p>See the topic above, instead of a diff, you run checkout:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\n# Ersetzen Sie die Commit-ID 22cd00b5e28893ef9ddef3c2b5436453cc5223ab durch Ihre ID\ngit checkout 22cd00b5e28893ef9ddef3c2b5436453cc5223ab\ndocker compose pull\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\n# Ersetzen Sie die Commit-ID 22cd00b5e28893ef9ddef3c2b5436453cc5223ab durch Ihre ID\ngit checkout 22cd00b5e28893ef9ddef3c2b5436453cc5223ab\ndocker-compose pull\ndocker-compose up -d\n</code></pre>","path":["Update.en"],"tags":[]},{"location":"maintenance/update.en/#hooks","level":3,"title":"Hooks","text":"<p>You can hook into the update mechanism by adding scripts called <code>pre_commit_hook.sh</code> and <code>post_commit_hook.sh</code> to your mailcows root directory. See this for more details.</p>","path":["Update.en"],"tags":[]},{"location":"maintenance/update.en/#update-cycle","level":2,"title":"Update Cycle","text":"<ul> <li>We schedule a monthly release cycle for a major update.</li> <li>The releases are numbered like this: <code>YYYY-MM</code> (e.g. <code>2022-05</code>)</li> <li>Fixes for a main Update will be stated as \"Revisions\" like a,b,c (e.g. <code>2022-05a</code>, <code>2022-05b</code> etc.)</li> </ul>","path":["Update.en"],"tags":[]},{"location":"maintenance/update.en/#update-variants","level":2,"title":"Update variants","text":"<p>stable (stable updates): These updates are suitable for productive usage. They appear in a cycle of at least 1x per month.</p> <p>nightly (unstable updates): These updates are NOT suitable for production use and are for testing only. The nightly updates are ahead of the stable updates, since in these updates we test newer and more extensive features before they go live for all users.</p>","path":["Update.en"],"tags":[]},{"location":"maintenance/update.en/#get-nightly-updates","level":2,"title":"Get Nightly Updates","text":"","path":["Update.en"],"tags":[]},{"location":"maintenance/update.en/#info-about-the-nightly-updates","level":3,"title":"Info about the Nightly Updates","text":"<p>Since the 2022-08 update there is the possibility to change the update sources. Until now, the master branch on GitHub served as the only (official) update source. With the August 2022 update, however, there is now the Nightly Branch which contains unstable and major changes for testing and feedback.</p> <p>The Nightly Branch always gets new updates when something is finished on the mailcow project that will be included in the new main version.</p> <p>Besides the obvious changes that will be included in the next major update anyway, it also contains exclusive features that need a longer testing time (e.g. the UI update to Bootstrap 5).</p>","path":["Update.en"],"tags":[]},{"location":"maintenance/update.en/#how-do-i-get-nightly-updates","level":3,"title":"How do I get Nightly Updates?","text":"<p>The process is relatively simple. With the 2022-08 update (assuming an update to the version) it is possible to run <code>update.sh</code> with the parameter <code>--nightly</code>.</p> <p>Danger</p> <p>Please make a backup before or follow the Best Practice Nightly Update section before switching to mailcow nightly builds. We are not responsible for any data loss/corruption, so work with caution!</p> <p>The script will now change the branch with <code>git checkout nightly</code>, which means it will ask for the IPv6 settings again. But this is normal.</p> <p>If everything worked fine (for which we made a backup before) the mailcow UI should now show the current version number and date stamp in the lower right corner: </p>","path":["Update.en"],"tags":[]},{"location":"maintenance/update.en/#best-practice-nightly-update","level":3,"title":"Best Practice Nightly Update","text":"<p>Info</p> <p>We recommend using the Nightly Update only if you have another machine or VM and NOT use it productively.</p> <ol> <li>use the cold standby script to copy the machine before the switch to the nightly builds on another system.</li> <li>run the <code>update.sh</code> script on the new machine with the parameter <code>--nightly</code> and confirm.</li> <li>experience/test the nightly updates on the secondary machine.</li> </ol>","path":["Update.en"],"tags":[]},{"location":"manual-guides/u_e-80_to_443.de/","level":1,"title":"U e 80 to 443.de","text":"<p>Wenn Sie einen Reverse Proxy vor mailcow verwenden, lesen Sie bitte unsere Reverse Proxy Anleitung, die eine Umleitung von HTTP auf HTTPS beinhaltet.</p> <p>Öffne <code>mailcow.conf</code> und setze <code>HTTP_BIND=</code> - falls nicht bereits gesetzt.</p>","path":["U e 80 to 443.de"],"tags":[]},{"location":"manual-guides/u_e-80_to_443.de/#version-2025-01a","level":3,"title":"Version &gt;= 2025-01a","text":"<p>Öffne <code>mailcow.conf</code> und setze <code>HTTP_REDIRECT=y</code>. Erstellen Sie den Container neu:  </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e 80 to 443.de"],"tags":[]},{"location":"manual-guides/u_e-80_to_443.de/#version-2025-01","level":3,"title":"Version &lt; 2025-01","text":"<p>Erstellen Sie eine neue Datei <code>data/conf/nginx/redirect.conf</code> und fügen Sie die folgende Serverkonfiguration in die Datei ein:</p> <pre><code>server {\n  root /web;\n  listen 80 default_server;\n  listen [::]:80 default_server;\n  include /etc/nginx/conf.d/server_name.active;\n  if ( $request_uri ~* \"%0A|%0D\" ) { return 403; }\n  location ^~ /.well-known/acme-challenge/ {\n    allow all;\n    default_type \"text/plain\";\n  }\n  location / {\n    return 301 https://$host$uri$is_args$args;\n  }\n}\n</code></pre> <p>Falls Sie den Parameter HTTP_BIND geändert haben, erstellen Sie den Container neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker compose up -d\n</code></pre> <p>Andernfalls starten Sie Nginx neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart\n</code></pre> <pre><code>docker compose restart\n</code></pre>","path":["U e 80 to 443.de"],"tags":[]},{"location":"manual-guides/u_e-80_to_443.en/","level":1,"title":"U e 80 to 443.en","text":"<p>If you are using a reverse proxy in front of mailcow, please see our reverse proxy guide for this, which includes a redirect from HTTP to HTTPS.</p> <p>Open <code>mailcow.conf</code> and set <code>HTTP_BIND=</code> - if not already set.</p>","path":["U e 80 to 443.en"],"tags":[]},{"location":"manual-guides/u_e-80_to_443.en/#version-2025-01a","level":3,"title":"Version &gt;= 2025-01a","text":"<p>Open <code>mailcow.conf</code> and set <code>HTTP_REDIRECT=y</code>. Recreate the container:  </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e 80 to 443.en"],"tags":[]},{"location":"manual-guides/u_e-80_to_443.en/#version-2025-01","level":3,"title":"Version &lt; 2025-01","text":"<p>Since February the 28th 2017 mailcow does come with port 80 and 443 enabled.</p> <p>Create a new file <code>data/conf/nginx/redirect.conf</code> and add the following server config to the file:</p> <pre><code>server {\n  root /web;\n  listen 80 default_server;\n  listen [::]:80 default_server;\n  include /etc/nginx/conf.d/server_name.active;\n  if ( $request_uri ~* \"%0A|%0D\" ) { return 403; }\n  location ^~ /.well-known/acme-challenge/ {\n    allow all;\n    default_type \"text/plain\";\n  }\n  location / {\n    return 301 https://$host$uri$is_args$args;\n  }\n}\n</code></pre> <p>In case you changed the HTTP_BIND parameter, recreate the container:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Otherwise restart Nginx:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart\n</code></pre> <pre><code>docker-compose restart\n</code></pre>","path":["U e 80 to 443.en"],"tags":[]},{"location":"manual-guides/u_e-autodiscover_config.de/","level":1,"title":"U e autodiscover config.de","text":"<p>Sie brauchen diese Datei nicht zu ändern oder zu erstellen, autodiscover funktioniert sofort. Diese Anleitung ist nur für Anpassungen des Autodiscover- oder Autokonfigurationsprozesses gedacht.</p> <p>Neuere Outlook-Clients (insbesondere solche, die mit O365 ausgeliefert werden) führen keine automatische Erkennung von E-Mail-Profilen durch. Denken Sie daran, dass ActiveSync NICHT mit einem Desktop-Client verwendet werden sollte.</p> <p>Öffnen/erstellen Sie <code>data/web/inc/vars.local.inc.php</code> und fügen Sie Ihre Änderungen in das Konfigurationsfeld ein.</p> <p>Die Änderungen werden mit \"$autodiscover_config\" in <code>data/web/inc/vars.inc.php</code> zusammengeführt):</p> <pre><code>&lt;?php\n$autodiscover_config = array(\n  // General autodiscover service type: \"activesync\" or \"imap\"\n  // emClient uses autodiscover, but does not support ActiveSync. mailcow excludes emClient from ActiveSync.\n  'autodiscoverType' =&gt; 'activesync',\n  // If autodiscoverType =&gt; activesync, also use ActiveSync (EAS) for Outlook desktop clients (&gt;= Outlook 2013 on Windows)\n  // Outlook for Mac does not support ActiveSync\n  'useEASforOutlook' =&gt; 'yes',\n  // Please don't use STARTTLS-enabled service ports in the \"port\" variable.\n  // The autodiscover service will always point to SMTPS and IMAPS (TLS-wrapped services).\n  // The autoconfig service will additionally announce the STARTTLS-enabled ports, specified in the \"tlsport\" variable.\n  'imap' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; array_pop(explode(':', getenv('IMAPS_PORT'))),\n    'tlsport' =&gt; array_pop(explode(':', getenv('IMAP_PORT'))),\n  ),\n  'pop3' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; array_pop(explode(':', getenv('POPS_PORT'))),\n    'tlsport' =&gt; array_pop(explode(':', getenv('POP_PORT'))),\n  ),\n  'smtp' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; array_pop(explode(':', getenv('SMTPS_PORT'))),\n    'tlsport' =&gt; array_pop(explode(':', getenv('SUBMISSION_PORT'))),\n  ),\n  'activesync' =&gt; array(\n    'url' =&gt; 'https://'.$mailcow_hostname.($https_port == 443 ? '' : ':'.$https_port).'/Microsoft-Server-ActiveSync',\n  ),\n  'caldav' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; $https_port,\n  ),\n  'carddav' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; $https_port,\n  ),\n);\n</code></pre> <p>Um immer IMAP und SMTP anstelle von EAS zu verwenden, setzen Sie <code>'autodiscoverType' =&gt; 'imap'</code>.</p> <p>Deaktivieren Sie ActiveSync für Outlook-Desktop-Clients, indem Sie \"useEASforOutlook\" auf \"no\" setzen.</p>","path":["U e autodiscover config.de"],"tags":[]},{"location":"manual-guides/u_e-autodiscover_config.en/","level":1,"title":"U e autodiscover config.en","text":"<p>You do not need to change or create this file, autodiscover works out of the box. This guide is only meant for customizations to the autodiscover or autoconfig process.</p> <p>Newer Outlook clients (especially those delivered with O365) will not autodiscover mail profiles. Keep in mind, that ActiveSync should NOT be used with a desktop client.</p> <p>Open/create <code>data/web/inc/vars.local.inc.php</code> and add your changes to the configuration array.</p> <p>Changes will be merged with \"$autodiscover_config\" in <code>data/web/inc/vars.inc.php</code>):</p> <pre><code>&lt;?php\n$autodiscover_config = array(\n  // General autodiscover service type: \"activesync\" or \"imap\"\n  // emClient uses autodiscover, but does not support ActiveSync. mailcow excludes emClient from ActiveSync.\n  'autodiscoverType' =&gt; 'activesync',\n  // If autodiscoverType =&gt; activesync, also use ActiveSync (EAS) for Outlook desktop clients (&gt;= Outlook 2013 on Windows)\n  // Outlook for Mac does not support ActiveSync\n  'useEASforOutlook' =&gt; 'yes',\n  // Please don't use STARTTLS-enabled service ports in the \"port\" variable.\n  // The autodiscover service will always point to SMTPS and IMAPS (TLS-wrapped services).\n  // The autoconfig service will additionally announce the STARTTLS-enabled ports, specified in the \"tlsport\" variable.\n  'imap' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; array_pop(explode(':', getenv('IMAPS_PORT'))),\n    'tlsport' =&gt; array_pop(explode(':', getenv('IMAP_PORT'))),\n  ),\n  'pop3' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; array_pop(explode(':', getenv('POPS_PORT'))),\n    'tlsport' =&gt; array_pop(explode(':', getenv('POP_PORT'))),\n  ),\n  'smtp' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; array_pop(explode(':', getenv('SMTPS_PORT'))),\n    'tlsport' =&gt; array_pop(explode(':', getenv('SUBMISSION_PORT'))),\n  ),\n  'activesync' =&gt; array(\n    'url' =&gt; 'https://'.$mailcow_hostname.($https_port == 443 ? '' : ':'.$https_port).'/Microsoft-Server-ActiveSync',\n  ),\n  'caldav' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; $https_port,\n  ),\n  'carddav' =&gt; array(\n    'server' =&gt; $mailcow_hostname,\n    'port' =&gt; $https_port,\n  ),\n);\n</code></pre> <p>To always use IMAP and SMTP instead of EAS, set <code>'autodiscoverType' =&gt; 'imap'</code>.</p> <p>Disable ActiveSync for Outlook desktop clients by setting \"useEASforOutlook\" to \"no\".</p>","path":["U e autodiscover config.en"],"tags":[]},{"location":"manual-guides/u_e-reeanble-weak-protocols.de/","level":1,"title":"U e reeanble weak protocols.de","text":"<p>Am 12. Februar 2020 haben wir die veralteten Protokolle TLS 1.0 und 1.1 in Dovecot (POP3, POP3S, IMAP, IMAPS) und Postfix (SMTPS, SUBMISSION) deaktiviert.</p> <p>Mit dem Juni 2024 Patch (2024-06) wurde auch TLS 1.0 und TLS 1.1 für unauthentifizierte Mails über SMTP auf Port 25/tcp deaktiviert, da die meisten modernen und gut konfigurierten E-Mail-Server im Internet mittlerweile bessere Verschlüsselungen als TLS 1.0/1.1 nutzen.</p> <p>Wie kann man schwache Protokolle wieder aktivieren, falls erforderlich?</p> <p>Bearbeiten Sie <code>data/conf/postfix/extra.cf</code>:</p> <pre><code># Für SMTPS/Submission\nsubmission_smtpd_tls_mandatory_protocols = !SSLv2, !SSLv3\nsmtps_smtpd_tls_mandatory_protocols = !SSLv2, !SSLv3\n\n# Für SMTP (via STARTTLS)\nsmtp_tls_protocols = !SSLv2, !SSLv3\nsmtpd_tls_protocols = !SSLv2, !SSLv3\n</code></pre> <p>Bearbeiten Sie <code>data/conf/dovecot/extra.conf</code>:</p> <pre><code>ssl_min_protocol = TLSv1\n</code></pre> <p>Starten Sie die betroffenen Dienste neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow dovecot-mailcow\n</code></pre> <p>Tipp: Sie können TLS 1.2 in Windows 7 aktivieren.</p>","path":["U e reeanble weak protocols.de"],"tags":[]},{"location":"manual-guides/u_e-reeanble-weak-protocols.en/","level":1,"title":"U e reeanble weak protocols.en","text":"<p>On February 12th, 2020, we disabled the deprecated protocols TLS 1.0 and 1.1 in Dovecot (POP3, POP3S, IMAP, IMAPS) and Postfix (SMTPS, SUBMISSION).</p> <p>With the June 2024 Patch (2024-06), TLS 1.0 and TLS 1.1 were also disabled for unauthenticated mail via SMTP on port 25/tcp, as most modern and well-configured email servers on the internet now use better encryptions than TLS 1.0/1.1.</p> <p>How to re-enable weak protocols if necessary?</p> <p>Edit <code>data/conf/postfix/extra.cf</code>:</p> <pre><code># For SMTPS/Submission\nsubmission_smtpd_tls_mandatory_protocols = !SSLv2, !SSLv3\nsmtps_smtpd_tls_mandatory_protocols = !SSLv2, !SSLv3\n\n# For SMTP (via STARTTLS)\nsmtp_tls_protocols = !SSLv2, !SSLv3\nsmtpd_tls_protocols = !SSLv2, !SSLv3\n</code></pre> <p>Edit <code>data/conf/dovecot/extra.conf</code>:</p> <pre><code>ssl_min_protocol = TLSv1\n</code></pre> <p>Restart the affected services:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow dovecot-mailcow\n</code></pre> <p>Hint: You can enable TLS 1.2 in Windows 7.</p>","path":["U e reeanble weak protocols.en"],"tags":[]},{"location":"manual-guides/u_e-update-hooks.de/","level":1,"title":"U e update hooks.de","text":"<p>Es ist möglich, Pre- und Post-Update-Hooks zum <code>update.sh</code> Skript hinzuzufügen, das Ihre gesamte mailcow-Installation aktualisiert.</p> <p>Um dies zu tun, fügen Sie einfach das entsprechende Bash-Skript in Ihr mailcow-Root-Verzeichnis ein:  </p> <ul> <li><code>pre_update_hook.sh</code> für Befehle, die vor dem Update laufen sollen</li> <li><code>post_update_hook.sh</code> für Befehle, die nach dem Update ausgeführt werden sollen</li> </ul> <p>Beachten Sie, dass <code>pre_update_hook.sh</code> jedes Mal ausgeführt wird, wenn Sie <code>update.sh</code> aufrufen, und <code>post_update_hook.sh</code> wird nur ausgeführt, wenn die Aktualisierung erfolgreich war und das Skript nicht erneut ausgeführt werden muss.</p> <p>Die Skripte werden von der Bash ausgeführt, ein Interpreter (z.B. <code>#!/bin/bash</code>) sowie ein Execute Permission Flag (\"+x\") sind nicht erforderlich.</p>","path":["U e update hooks.de"],"tags":[]},{"location":"manual-guides/u_e-update-hooks.en/","level":1,"title":"U e update hooks.en","text":"<p>It is possible to add pre- and post-update-hooks to the <code>update.sh</code> script that upgrades your whole mailcow installation.</p> <p>To do so, just add the corresponding bash script into your mailcow root directory:  </p> <ul> <li><code>pre_update_hook.sh</code> for commands that should run before the update</li> <li><code>post_update_hook.sh</code> for commands that should run after the update is completed</li> </ul> <p>Keep in mind that <code>pre_update_hook.sh</code> runs every time you call <code>update.sh</code> and <code>post_update_hook.sh</code> will only run if the update was successful and the script doesn't have to be re-run.</p> <p>The scripts will be run by bash, an interpreter (e.g. <code>#!/bin/bash</code>) as well as an execute permission flag (\"+x\") are not required.</p>","path":["U e update hooks.en"],"tags":[]},{"location":"manual-guides/u_e-why_unbound.de/","level":1,"title":"U e why unbound.de","text":"<p>Für DNS-Blacklist-Lookups und DNSSEC.</p> <p>Die meisten Systeme verwenden entweder einen öffentlichen oder einen lokalen DNS-Auflöser mit Zwischenspeicher. Das ist eine sehr schlechte Idee, wenn es darum geht, Spam mit DNS-basierten Blackhole-Listen (DNSBL) oder ähnlichen Techniken zu filtern. Die meisten, wenn nicht alle Anbieter wenden eine Ratenbegrenzung an, die auf dem DNS-Resolver basiert, der für die Abfrage ihres Dienstes verwendet wird. Wenn Sie einen öffentlichen Resolver wie Google 4x8, OpenDNS oder einen anderen gemeinsam genutzten DNS-Resolver wie den Ihres Internetanbieters verwenden, werden Sie diese Grenze sehr bald erreichen.</p>","path":["U e why unbound.de"],"tags":[]},{"location":"manual-guides/u_e-why_unbound.en/","level":1,"title":"U e why unbound.en","text":"<p>For DNS blacklist lookups and DNSSEC.</p> <p>Most systems use either a public or a local caching DNS resolver. That's a very bad idea when it comes to filter spam using DNS-based black hole lists (DNSBL) or similar technics. Most if not all providers apply a rate limit based on the DNS resolver that is used to query their service. Using a public resolver like Googles 4x8, OpenDNS or any other shared DNS resolver like your ISPs will hit that limit very soon.</p>","path":["U e why unbound.en"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.de/","level":1,"title":"U e clamav additional dbs.de","text":"","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.de/#weitere-datenbanken-fur-clamav","level":2,"title":"Weitere Datenbanken für ClamAV","text":"<p>Die Standard ClamAV Datenbanken haben keine hohe Trefferquote, können aber durch kostenlose und kostenpflichtige Datenbanken erweitert werden.</p>","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.de/#liste-von-bekannten-kostenfreien-datenbanken-stand-april-2022","level":3,"title":"Liste von bekannten (kostenfreien) Datenbanken | Stand April 2022","text":"<ul> <li>SecurityInfo - kostenlose ClamAV DBs für Testzwecke. Registrierung der IP Adresse des Servers erforderlich (dann nutzbar für besagte IP).</li> <li>InterServer - kostenlose ClamAV DBs. Für E-Mail Zwecke eher ungeeignet.</li> </ul>","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.de/#securiteinfo-datenbank-aktivieren","level":3,"title":"SecuriteInfo Datenbank aktivieren","text":"","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.de/#arbeiten-im-clamav","level":4,"title":"Arbeiten im ClamAV","text":"<ol> <li>Kostenfreien Account auf https://www.securiteinfo.com/clients/customers/signup erstellen.</li> <li>Sie erhalten eine E-Mail um Ihren Account zu aktivieren gefolgt von einer E-Mail mit Ihrem Login Namen.</li> <li>Loggen Sie sich ein und navigieren Sie zu Ihrem Account https://www.securiteinfo.com/clients/customers/account</li> <li>Klicken Sie auf den 'Setup' Reiter.</li> <li>Sie brauchen <code>your_id</code> von den Downloadlinks. Diese sind pro User individuell.</li> <li> <p>Fügen Sie diese wie folgt in die <code>data/conf/clamav/freshclam.conf</code> ein und ersetzen Sie den <code>your_id</code> Teil mit Ihrer ID: <pre><code>DatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfo.hdb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfo.ign2\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/javascript.ndb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/spam_marketing.ndb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfohtml.hdb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfoascii.hdb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfopdf.hdb\n</code></pre></p> </li> <li> <p>Bei den kostenlosen SecuriteInfo Datenbanken ist die Download-Geschwindigkeit auf 300 kB/s begrenzt. Ändern Sie in <code>data/conf/clamav/freshclam.conf</code> den Standardwert <code>ReceiveTimeout 20</code> auf <code>ReceiveTimeout 90</code> (Zeitangabe in Sekunden), da ansonsten einige der Datenbank-Downloads aufgrund ihrer Größe abbrechen können.</p> </li> <li> <p>Passen Sie <code>data/conf/clamav/clamd.conf</code> mit den folgenden Einstellungen an: <pre><code>DetectPUA yes\nExcludePUA PUA.Win.Packer\nExcludePUA PUA.Win.Trojan.Packed\nExcludePUA PUA.Win.Trojan.Molebox\nExcludePUA PUA.Win.Packer.Upx\nExcludePUA PUA.Doc.Packed\nMaxScanSize 150M\nMaxFileSize 100M\nMaxRecursion 40\nMaxEmbeddedPE 100M\nMaxHTMLNormalize 50M\nMaxScriptNormalize 50M\nMaxZipTypeRcg 50M\n</code></pre></p> </li> <li>Starten Sie den ClamAV Container neu:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart clamd-mailcow\n</code></pre> <pre><code>docker-compose restart clamd-mailcow\n</code></pre> <p>Bitte beachten Sie:</p> <ul> <li>Sie können <code>ExcludePUA</code> und <code>IncludePUA</code> in der <code>clamd.conf</code> nicht gleichzeitig nutzen! Kommentieren Sie bitte <code>IncludePUA</code> aus, sollte es nicht auskommentiert sein.</li> <li>Die Liste der Datenbanken genutzt in diesem Beispiel sollten für die meisten Fälle passen. SecuriteInfo bietet jedoch noch andere Datenbanken an. Bitte schauen Sie sich das SecuriteInfo FAQ für weitere Informationen an.</li> <li>Mit den neu eingestellten Datenbanken (und den Standard Datenbanken) ClamAV verbraucht ClamAV etwa 1,3 GB RAM des Servers.</li> <li>Sollten Sie <code>message_size_limit</code> in Postfix verändert haben müssen Sie die <code>MaxSize</code> Einstellung in ClamAV auf den selben Wert eintragen.</li> </ul>","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.de/#arbeiten-im-rspamd","level":4,"title":"Arbeiten im Rspamd","text":"<p>Achtung</p> <p>mailcow mit der Version <code>&gt;= 2023-07</code> wird benötigt, damit die folgende Anleitung funktioniert, da sie die vordefinierten Scores für SecuriteInfo-Signaturen enthält!</p> <p>Nun haben Sie zwar die ClamAV-Signaturen hinzugefügt, werden aber feststellen, dass Rspamd diese nicht korrekt verwendet bzw. ALLES gnadenlos als VIRUS abstempelt.</p> <p>Wir können Rspamd aber mit ein wenig Handarbeit zähmen, so dass er nicht völlig aus dem Ruder läuft.</p> <p>Dazu gehen wir wie folgt vor:</p> <ol> <li>Fügen Sie innerhalb des bestehenden <code>clamav { ... }</code> block in <code>data/conf/rspamd/local.d/antivirus.conf</code>:</li> </ol> <pre><code>patterns {\n  # Extra Signatures (Securite) Not shipped with mailcow.\n  CLAM_SECI_SPAM = \"^SecuriteInfo\\.com\\.Spam.*\";\n  CLAM_SECI_JPG = \"^SecuriteInfo\\.com\\.JPG.*\";\n  CLAM_SECI_PDF = \"^SecuriteInfo\\.com\\.PDF.*\";\n  CLAM_SECI_HTML = \"^SecuriteInfo\\.com\\.HTML.*\";\n  CLAM_SECI_JS = \"^SecuriteInfo\\.com\\.JS.*\";\n}\n</code></pre> <ol> <li>Starten Sie den Rspamd neu:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Nun wird Rspamd die von uns angegebene Gewichtung für die einzelnen Signaturen anwenden, anstatt alles mit einem Wert von 2000 als VIRUS zu markieren und damit abzulehnen.</p> <p>Info</p> <p>Sie können die Gewichtungen jederzeit ändern:</p> <p><code>data/conf/rspamd/local.d/composites.conf</code></p> <p>Auch die zu registrierenden Strings des ClamAV können Sie manuell einstellen/anpassen.</p> <p>Nutzen Sie dazu einfach das gerade eben vorgegebene Schema in der <code>antivirus.conf</code> des Rspamd.</p> <p>Achtung</p> <p>Bitte beachten Sie, dass die Dateien <code>antivirus.conf</code> und <code>composites.conf</code> durch ein mailcow-Update überschrieben werden können.</p>","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.de/#interserver-datenbanken-aktivieren","level":3,"title":"InterServer Datenbanken aktivieren","text":"<ol> <li>Fügen Sie folgendes in <code>data/conf/clamav/freshclam.conf</code> ein: <pre><code>DatabaseCustomURL http://sigs.interserver.net/interserver256.hdb\nDatabaseCustomURL http://sigs.interserver.net/interservertopline.db\nDatabaseCustomURL http://sigs.interserver.net/shell.ldb\nDatabaseCustomURL http://sigs.interserver.net/whitelist.fp\n</code></pre></li> <li>Starten Sie den ClamAV Container neu:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart clamd-mailcow\n</code></pre> <pre><code>docker-compose restart clamd-mailcow\n</code></pre>","path":["U e clamav additional dbs.de"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.en/","level":1,"title":"U e clamav additional dbs.en","text":"","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.en/#additional-databases-for-clamav","level":2,"title":"Additional Databases for ClamAV","text":"<p>Default ClamAV databases do not have great detection levels, but it can be enhanced with free or paid signature databases.</p>","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.en/#list-of-known-free-databases-as-of-april-2022","level":3,"title":"List of known free databases | As of April 2022","text":"<ul> <li>SecurityInfo - free ClamAV DBs for testing purposes, required registration after which you can use them from 1 IP</li> <li>InterServer - free to use ClamAV DBs, but they do not fit well for email scanning</li> </ul>","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.en/#enable-securiteinfo-databases","level":3,"title":"Enable SecuriteInfo databases","text":"","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.en/#work-todo-in-clamav","level":4,"title":"Work todo in ClamAV","text":"<ol> <li>Sign up for a free account at https://www.securiteinfo.com/clients/customers/signup</li> <li>You will receive an email to activate your account and then a follow-up email with your login name</li> <li>Login and navigate to your customer account: https://www.securiteinfo.com/clients/customers/account</li> <li>Click on the Setup tab</li> <li>You will need to get <code>your_id</code> from one of the download links, they are individual for every user</li> <li> <p>Add to <code>data/conf/clamav/freshclam.conf</code> with replaced <code>your_id</code> part: <pre><code>DatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfo.hdb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfo.ign2\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/javascript.ndb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/spam_marketing.ndb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfohtml.hdb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfoascii.hdb\nDatabaseCustomURL https://www.securiteinfo.com/get/signatures/your_id/securiteinfopdf.hdb\n</code></pre></p> </li> <li> <p>For free SecuriteInfo databases, download speed is limited to 300 kB/s. In <code>data/conf/clamav/freshclam.conf</code>, increase the default <code>ReceiveTimeout 20</code> value to <code>ReceiveTimeout 90</code> (time in seconds), otherwise some of the database downloads could fail because of their size.</p> </li> <li> <p>Adjust <code>data/conf/clamav/clamd.conf</code> to align with next settings: <pre><code>DetectPUA yes\nExcludePUA PUA.Win.Packer\nExcludePUA PUA.Win.Trojan.Packed\nExcludePUA PUA.Win.Trojan.Molebox\nExcludePUA PUA.Win.Packer.Upx\nExcludePUA PUA.Doc.Packed\nMaxScanSize 150M\nMaxFileSize 100M\nMaxRecursion 40\nMaxEmbeddedPE 100M\nMaxHTMLNormalize 50M\nMaxScriptNormalize 50M\nMaxZipTypeRcg 50M\n</code></pre></p> </li> <li>Restart ClamAV container:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart clamd-mailcow\n</code></pre> <pre><code>docker-compose restart clamd-mailcow\n</code></pre> <p>Please note:</p> <ul> <li>You can't use <code>ExcludePUA</code> and <code>IncludePUA</code> in <code>clamd.conf</code> simultaneously, so please comment any <code>IncludePUA</code> if you uncommented them before.</li> <li>List of databases provided in this example fit most use-cases, but SecuriteInfo also provides other databases. Please check SecuriteInfo FAQ for additional information.</li> <li>With the current DB set (including default DBs) ClamAV will consume about 1.3Gb of RAM on your server.</li> <li>If you modified  <code>message_size_limit</code> in Postfix you need to adapt <code>MaxSize</code> settings in ClamAV as well.</li> </ul>","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.en/#work-todo-in-rspamd","level":4,"title":"Work todo in Rspamd","text":"<p>Danger</p> <p>mailcow with Version <code>&gt;= 2023-07</code> is needed for this following guide to work, as it includes the predefined scores for SecuriteInfo Signatures!</p> <p>Now you have added the ClamAV signatures, but you will notice that Rspamd does not use them correctly or mercilessly labels EVERYTHING as VIRUS.</p> <p>However, we can tame Rspamd with a little bit of manual work so that it doesn't get completely out of hand.</p> <p>For this we proceed as follows:</p> <ol> <li>Add the following inside the existing <code>clamav { ... }</code> block in <code>data/conf/rspamd/local.d/antivirus.conf</code>:</li> </ol> <pre><code>patterns {\n  # Extra Signatures (Securite) Not shipped with mailcow.\n  CLAM_SECI_SPAM = \"^SecuriteInfo\\.com\\.Spam.*\";\n  CLAM_SECI_JPG = \"^SecuriteInfo\\.com\\.JPG.*\";\n  CLAM_SECI_PDF = \"^SecuriteInfo\\.com\\.PDF.*\";\n  CLAM_SECI_HTML = \"^SecuriteInfo\\.com\\.HTML.*\";\n  CLAM_SECI_JS = \"^SecuriteInfo\\.com\\.JS.*\";\n}\n</code></pre> <ol> <li>Restart Rspamd afterwards:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Now Rspamd will apply the weighting we specified to each signature instead of marking everything with a value of 2000 as VIRUS and thus rejecting it.</p> <p>Info</p> <p>You can change the weights at any time:</p> <p><code>data/conf/rspamd/local.d/composites.conf</code>.</p> <p>You can also manually set/adjust the strings of the ClamAV to be registered.</p> <p>Just use the scheme given in the <code>antivirus.conf</code> of Rspamd.</p> <p>Warning</p> <p>Please note that the files <code>antivirus.conf</code> and <code>composites.conf</code> can be overwritten by a mailcow update.</p>","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-additional_dbs.en/#enable-interserver-databases","level":3,"title":"Enable InterServer databases","text":"<ol> <li>Add to <code>data/conf/clamav/freshclam.conf</code>: <pre><code>DatabaseCustomURL http://sigs.interserver.net/interserver256.hdb\nDatabaseCustomURL http://sigs.interserver.net/interservertopline.db\nDatabaseCustomURL http://sigs.interserver.net/shell.ldb\nDatabaseCustomURL http://sigs.interserver.net/whitelist.fp\n</code></pre></li> <li>Restart ClamAV container:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart clamd-mailcow\n</code></pre> <pre><code>docker-compose restart clamd-mailcow\n</code></pre>","path":["U e clamav additional dbs.en"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-whitelist.de/","level":1,"title":"U e clamav whitelist.de","text":"","path":["U e clamav whitelist.de"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-whitelist.de/#whitelist-fur-bestimmte-clamav-signaturen","level":2,"title":"Whitelist für bestimmte ClamAV-Signaturen","text":"<p>Es kann vorkommen, dass legitime (saubere) Mails von ClamAV blockiert werden (Rspamd markiert die Mail mit <code>VIRUS_FOUND</code>). So werden beispielsweise interaktive PDF-Formularanhänge standardmäßig blockiert, da der eingebettete Javascript-Code für schädliche Zwecke verwendet werden könnte. Überprüfen Sie dies anhand der clamd-Protokolle, z.B.:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs clamd-mailcow | grep \"FOUND\"\n</code></pre> <pre><code>docker-compose logs clamd-mailcow | grep \"FOUND\"\n</code></pre> <p>Diese Zeile bestätigt, dass ein solcher identifiziert wurde:</p> <pre><code>clamd-mailcow_1 | Sat Sep 28 07:43:24 2019 -&gt; instream(local): PUA.Pdf.Trojan.EmbeddedJavaScript-1(e887d2ac324ce90750768b86b63d0749:363325) FOUND\n</code></pre> <p>Um diese spezielle Signatur auf die Whitelist zu setzen (und den Versand dieses Dateityps im Anhang zu ermöglichen), fügen Sie sie der ClamAV-Signatur-Whitelist-Datei hinzu:</p> <pre><code>echo 'PUA.Pdf.Trojan.EmbeddedJavaScript-1' &gt;&gt; data/conf/clamav/whitelist.ign2\n</code></pre> <p>Dann starten Sie den clamd-mailcow Service Container in der mailcow UI oder mit docker compose neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart clamd-mailcow\n</code></pre> <pre><code>docker-compose restart clamd-mailcow\n</code></pre> <p>Bereinigen Sie zwischengespeicherte ClamAV-Ergebnisse in Redis:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow /bin/sh\n/data # redis-cli KEYS rs_cl* | xargs redis-cli DEL\n/data # exit\n</code></pre> <pre><code>docker-compose exec redis-mailcow /bin/sh\n/data # redis-cli KEYS rs_cl* | xargs redis-cli DEL\n/data # exit\n</code></pre>","path":["U e clamav whitelist.de"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-whitelist.en/","level":1,"title":"U e clamav whitelist.en","text":"","path":["U e clamav whitelist.en"],"tags":[]},{"location":"manual-guides/ClamAV/u_e-clamav-whitelist.en/#whitelist-specific-clamav-signatures","level":2,"title":"Whitelist specific ClamAV signatures","text":"<p>You may find that legitimate (clean) mail is being blocked by ClamAV (Rspamd will flag the mail with <code>VIRUS_FOUND</code>). For instance, interactive PDF form attachments are blocked by default because the embedded Javascript code may be used for nefarious purposes. Confirm by looking at the clamd logs, e.g.:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs clamd-mailcow | grep \"FOUND\"\n</code></pre> <pre><code>docker-compose logs clamd-mailcow | grep \"FOUND\"\n</code></pre> <p>This line confirms that such was identified:</p> <pre><code>clamd-mailcow_1      | Sat Sep 28 07:43:24 2019 -&gt; instream(local): PUA.Pdf.Trojan.EmbeddedJavaScript-1(e887d2ac324ce90750768b86b63d0749:363325) FOUND\n</code></pre> <p>To whitelist this particular signature (and enable sending this type of file attached), add it to the ClamAV signature whitelist file:</p> <pre><code>echo 'PUA.Pdf.Trojan.EmbeddedJavaScript-1' &gt;&gt; data/conf/clamav/whitelist.ign2\n</code></pre> <p>Then restart the clamd-mailcow service container in the mailcow UI or using docker compose:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart clamd-mailcow\n</code></pre> <pre><code>docker-compose restart clamd-mailcow\n</code></pre> <p>Cleanup cached ClamAV results in Redis:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow /bin/sh\n/data # redis-cli KEYS rs_cl* | xargs redis-cli DEL\n/data # exit\n</code></pre> <pre><code>docker-compose exec redis-mailcow /bin/sh\n/data # redis-cli KEYS rs_cl* | xargs redis-cli DEL\n/data # exit\n</code></pre>","path":["U e clamav whitelist.en"],"tags":[]},{"location":"manual-guides/Docker/u_e-docker-cust_dockerfiles.de/","level":1,"title":"U e docker cust dockerfiles.de","text":"<p>Sie müssen die Override-Datei mit den entsprechenden Build-Tags in den mailcow: dockerized Root-Ordner (d.h. <code>/opt/mailcow-dockerized</code>) kopieren: <pre><code>cp helper-scripts/docker-compose.override.yml.d/BUILD_FLAGS/docker-compose.override.yml docker-compose.override.yml\n</code></pre></p> <p>Nehmen Sie Ihre Änderungen in <code>data/Dockerfiles/$service</code> vor und erstellen Sie das Image lokal: <pre><code>docker build data/Dockerfiles/$service -t mailcow/$service:$tag\n</code></pre> (Ohne persönlichen :$tag wird automatisch :latest verwendet.)</p> <p>Nun muss dieser gerade erstellte Container in docker-compose.override.yml aktiviert werden, z.B.: <pre><code>$service-mailcow:\n    build: ./data/Dockerfiles/$service\n    image: mailcow/$service:$tag\n</code></pre></p> <p>Abschliessend müssen die geänderten Container automatisch neu erstellt werden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e docker cust dockerfiles.de"],"tags":[]},{"location":"manual-guides/Docker/u_e-docker-cust_dockerfiles.en/","level":1,"title":"U e docker cust dockerfiles.en","text":"<p>You need to copy the override file with corresponding build tags to the mailcow: dockerized root folder (i.e. <code>/opt/mailcow-dockerized</code>):</p> <pre><code>cp helper-scripts/docker-compose.override.yml.d/BUILD_FLAGS/docker-compose.override.yml docker-compose.override.yml\n</code></pre> <p>Customize <code>data/Dockerfiles/$service</code> and build the image locally: <pre><code>docker build data/Dockerfiles/$service -t mailcow/$service:$tag\n</code></pre> (without a personalized :$tag docker will use :latest automatically)</p> <p>Now the created image has to be activated in docker-compose.override.yml, e.g.: <pre><code>$service-mailcow:\n    build: ./data/Dockerfiles/$service\n    image: mailcow/$service:$tag\n</code></pre></p> <p>Now auto-recreate modified containers:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e docker cust dockerfiles.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-any_acl.de/","level":1,"title":"U e dovecot any acl.de","text":"<p>Am 17. August haben wir die Möglichkeit, mit \"jedem\" oder \"allen authentifizierten Benutzern\" zu teilen, standardmäßig deaktiviert.</p> <p>Diese Funktion kann wieder aktiviert werden, indem <code>ACL_ANYONE</code> auf <code>allow</code> in mailcow.conf gesetzt wird:</p> <pre><code>ACL_ANYONE=allow\n</code></pre> <p>Wenden Sie die Änderungen an, indem Sie den Docker Stack neustarten mit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e dovecot any acl.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-any_acl.en/","level":1,"title":"U e dovecot any acl.en","text":"<p>On August the 17th, we disabled the possibility to share with \"any\" or \"all authenticated users\" by default.</p> <p>This function can be re-enabled by setting <code>ACL_ANYONE</code> to <code>allow</code> in mailcow.conf:</p> <pre><code>ACL_ANYONE=allow\n</code></pre> <p>Apply the changes by restarting the stack:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e dovecot any acl.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-catchall_vacation.de/","level":1,"title":"U e dovecot catchall vacation.de","text":"<p>Der Dovecot-Parameter <code>sieve_vacation_dont_check_recipient</code> - der in mailcow-Konfigurationen vor dem 21. Juli 2021 standardmäßig auf <code>yes</code> gesetzt war - erlaubt Urlaubsantworten auch dann, wenn eine Mail an nicht existierende Mailboxen wie Catch-All-Adressen gesendet wird.</p> <p>Wir haben uns entschlossen, diesen Parameter wieder auf <code>no</code> zu setzen und dem Benutzer zu erlauben, die Empfängeradresse zu spezifizieren, die eine Urlaubsantwort auslöst. Die auslösenden Empfänger können auch in SOGos Autoresponder-Funktion konfiguriert werden.</p>","path":["U e dovecot catchall vacation.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-catchall_vacation.en/","level":1,"title":"U e dovecot catchall vacation.en","text":"<p>The Dovecot parameter <code>sieve_vacation_dont_check_recipient</code> - which was by default set to <code>yes</code> in mailcow configurations pre 21st July 2021 - allows for vacation replies even when a mail is sent to non-existent mailboxes like a catch-all addresses.</p> <p>We decided to switch this parameter back to <code>no</code> and allow a user to specify which recipient address triggers a vacation reply. The triggering recipients can also be configured in SOGos autoresponder feature.</p>","path":["U e dovecot catchall vacation.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-expunge.de/","level":1,"title":"U e dovecot expunge.de","text":"<p>Wenn Sie alte Mails aus den Ordnern <code>.Junk</code> oder <code>.Trash</code> löschen wollen oder vielleicht alle gelesenen Mails, die älter als eine bestimmte Zeitspanne sind, können Sie das dovecot-Tool doveadm man doveadm-expunge verwenden.</p>","path":["U e dovecot expunge.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-expunge.de/#der-manuelle-weg","level":2,"title":"Der manuelle Weg","text":"<p>Dann wollen wir mal loslegen:</p> <p>Löschen Sie die Mails eines Benutzers im Junk-Ordner, die gelesen und älter als 4 Stunden sind</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'Junk' SEEN not SINCE 4h\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'Junk' SEEN not SINCE 4h\n</code></pre> <p>Lösche alle Mails des Benutzers im Junk-Ordner, die älter als 7 Tage sind</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 7d\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 7d\n</code></pre> <p>Löscht alle Mails (aller Benutzer) in allen Ordnern, die älter als 52 Wochen sind (internes Datum der Mail, nicht das Datum, an dem sie auf dem System gespeichert wurde =&gt; <code>before</code> statt <code>savedbefore</code>). Nützlich zum Löschen sehr alter Mails in allen Benutzern und Ordnern (daher besonders nützlich für GDPR-Compliance).</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -A mailbox % before 52w\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -A mailbox % before 52w\n</code></pre> <p>Löschen von Mails in einem benutzerdefinierten Ordner innerhalb des Posteingangs eines Benutzers, die nicht gekennzeichnet und älter als 2 Wochen sind</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'INBOX/custom-folder' not FLAGGED not SINCE 2w\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'INBOX/custom-folder' not FLAGGED not SINCE 2w\n</code></pre> <p>Info</p> <p>Für mögliche Zeitspannen oder SearchQuery schauen Sie bitte in man doveadm-search-query</p>","path":["U e dovecot expunge.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-expunge.de/#job-scheduler","level":2,"title":"Job-Scheduler","text":"","path":["U e dovecot expunge.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-expunge.de/#uber-das-host-system-cron","level":3,"title":"über das Host-System cron","text":"<p>Wenn Sie eine solche Aufgabe automatisieren wollen, können Sie einen Cron-Job auf Ihrem Rechner erstellen, der ein Skript wie das folgende aufruft:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>#!/bin/bash\n# Pfad zu mailcow-dockerized, z.B. /opt/mailcow-dockerized\ncd /pfad/zu/ihrer/mailcow-dockerized\n\ndocker compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 2w\ndocker compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' SEEN not SINCE 12h\n[...]\n</code></pre> <pre><code>#!/bin/bash\n# Pfad zu mailcow-dockerized, z.B. /opt/mailcow-dockerized\ncd /pfad/zu/ihrer/mailcow-dockerized\n\ndocker-compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 2w\ndocker-compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' SEEN not SINCE 12h\n[...]\n</code></pre> <p>Um einen Cronjob zu erstellen, können Sie <code>crontab -e</code> ausführen und etwas wie das Folgende einfügen, um ein Skript auszuführen:</p> <pre><code># Jeden Tag um 04:00 Uhr morgens ausführen.\n0 4 * * * /pfad/zu/ihr/expunge_mailboxes.sh\n</code></pre>","path":["U e dovecot expunge.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-expunge.de/#uber-docker-job-scheduler","level":3,"title":"über Docker Job Scheduler","text":"<p>Um dies mit einem Docker-Job-Scheduler zu archivieren, verwenden Sie diese docker-compose.override.yml mit Ihrer mailcow: </p> <pre><code>services:\n\n  dovecot-mailcow:\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.dovecot-expunge-trash.schedule: \"0 0 4 * * *\"\n      ofelia.job-exec.dovecot-expunge-trash.command: \"doveadm expunge -A mailbox 'Junk' savedbefore 2w\"\n      ofelia.job-exec.dovecot-expunge-trash.tty: \"false\"\n</code></pre> <p>Wir fügen unserem Dovecot-Container ein paar Labels hinzu, um den Job-Scheduler zu aktivieren und ihm in einem Cron-kompatiblen Scheduling-Format mitzuteilen, wann er laufen soll. Hinweis: Ofelia verwendet das Scheduling-Format der Cron-Implementierung von Go, die mit einem Eintrag für Sekunden statt für Minuten beginnt.</p> <p>Diese docker-compose.override.yml löscht jeden Tag um 4 Uhr morgens alle Mails, die älter als 2 Wochen sind, aus dem Ordner \"Junk\". Um zu sehen, ob alles richtig gelaufen ist, können Sie nicht nur in Ihrer Mailbox nachsehen, sondern auch im Docker-Log von Ofelia, ob es etwa so aussieht:</p> <pre><code>common.go:124 ▶ NOTICE [Job \"dovecot-expunge-trash\" (8759567efa66)] Started - doveadm expunge -A mailbox 'Junk' savedbefore 2w,\ncommon.go:124 ▶ NOTICE [Job \"dovecot-expunge-trash\" (8759567efa66)] Finished in \"285.032291ms\", failed: false, skipped: false, error: none,\n</code></pre> <p>Wenn der Vorgang fehlgeschlagen ist, wird dies angegeben und die Ausgabe von doveadm im Protokoll aufgeführt, um Ihnen die Fehlersuche zu erleichtern.</p> <p>Falls Sie weitere Jobs hinzufügen wollen, stellen Sie sicher, dass Sie den \"dovecot-expunge-trash\"-Teil nach \"ofelia.job-exec.\" in etwas anderes ändern, er definiert den Namen des Jobs. Die Syntax der Labels finden Sie unter mcuadros/ofelia.</p>","path":["U e dovecot expunge.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-expunge.en/","level":1,"title":"U e dovecot expunge.en","text":"<p>If you want to delete old mails out of the <code>.Junk</code> or <code>.Trash</code> folders or maybe delete all read mails that are older than a certain amount of time you may use dovecot's tool doveadm man doveadm-expunge.</p>","path":["U e dovecot expunge.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-expunge.en/#the-manual-way","level":2,"title":"The manual way","text":"<p>That said, let's dive in:</p> <p>Delete a user's mails inside the junk folder that are read and older than 4 hours</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'Junk' SEEN not SINCE 4h\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'Junk' SEEN not SINCE 4h\n</code></pre> <p>Delete all user's mails in the junk folder that are older than 7 days</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 7d\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 7d\n</code></pre> <p>Delete all mails (of all users) in all folders that are older than 52 weeks (internal date of the mail, not the date it was saved on the system =&gt; <code>before</code> instead of <code>savedbefore</code>). Useful for deleting very old mails on all users and folders (thus especially useful for GDPR-compliance).</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -A mailbox % before 52w\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -A mailbox % before 52w\n</code></pre> <p>Delete mails inside a custom folder inside a user's inbox that are not flagged and older than 2 weeks</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'INBOX/custom-folder' not FLAGGED not SINCE 2w\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm expunge -u 'mailbox@example.com' mailbox 'INBOX/custom-folder' not FLAGGED not SINCE 2w\n</code></pre> <p>Info</p> <p>For possible time spans or search keys have a look at man doveadm-search-query</p>","path":["U e dovecot expunge.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-expunge.en/#job-scheduler","level":2,"title":"Job scheduler","text":"","path":["U e dovecot expunge.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-expunge.en/#via-the-host-system-cron","level":3,"title":"via the host system cron","text":"<p>If you want to automate such a task you can create a cron job on your host that calls a script like the one below:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>#!/bin/bash\n# Path to mailcow-dockerized, for example: /opt/mailcow-dockerized\ncd /path/to/your/mailcow-dockerized\n\ndocker compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 2w\ndocker compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' SEEN not SINCE 12h\n[...]\n</code></pre> <pre><code>#!/bin/bash\n# Path to mailcow-dockerized, for example: /opt/mailcow-dockerized\ncd /path/to/your/mailcow-dockerized\n\ndocker-compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' savedbefore 2w\ndocker-compose exec -T dovecot-mailcow doveadm expunge -A mailbox 'Junk' SEEN not SINCE 12h\n[...]\n</code></pre> <p>To create a cron job you may execute <code>crontab -e</code> and insert something like the following to execute a script:</p> <pre><code># Execute everyday at 04:00 A.M.\n0 4 * * * /path/to/your/expunge_mailboxes.sh\n</code></pre>","path":["U e dovecot expunge.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-expunge.en/#via-docker-job-scheduler","level":3,"title":"via Docker job scheduler","text":"<p>To achieve this with a docker job scheduler use this docker-compose.override.yml with your mailcow: </p> <pre><code>services:\n\n  dovecot-mailcow:\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.dovecot-expunge-trash.schedule: \"0 0 4 * * *\"\n      ofelia.job-exec.dovecot-expunge-trash.command: \"doveadm expunge -A mailbox 'Junk' savedbefore 2w\"\n      ofelia.job-exec.dovecot-expunge-trash.tty: \"false\"\n</code></pre> <p>We add a few label to our dovecot-container to activate the job scheduler and tell him in a cron compatible scheduling format when to run. Note: Ofelia uses the scheduling format of the Go cron implementation which starts with a field for seconds instead of minutes.</p> <p>This docker-compose.override.yml deletes all mails older then 2 weeks from the \"Junk\" folder every day at 4 am. To see if things ran proper, you can not only see in your mailbox but also check Ofelia's docker log if it looks something like this:</p> <pre><code>common.go:124 ▶ NOTICE [Job \"dovecot-expunge-trash\" (8759567efa66)] Started - doveadm expunge -A mailbox 'Junk' savedbefore 2w,\ncommon.go:124 ▶ NOTICE [Job \"dovecot-expunge-trash\" (8759567efa66)] Finished in \"285.032291ms\", failed: false, skipped: false, error: none,\n</code></pre> <p>If it failed it will say so and give you the output of the doveadm in the log to make it easy on you to debug.</p> <p>In case you want to add more jobs, ensure you change the \"dovecot-expunge-trash\" part after \"ofelia.job-exec.\" to something else, it defines the name of the job. Syntax of the labels you find at mcuadros/ofelia.</p>","path":["U e dovecot expunge.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-extra_conf.de/","level":1,"title":"U e dovecot extra conf.de","text":"<p>Erstellen Sie eine Datei <code>data/conf/dovecot/extra.conf</code> - falls nicht vorhanden - und fügen Sie Ihren zusätzlichen Inhalt hier ein.</p> <p>Starten Sie <code>dovecot-mailcow</code> neu, um Ihre Änderungen zu übernehmen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart dovecot-mailcow\n</code></pre>","path":["U e dovecot extra conf.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-extra_conf.en/","level":1,"title":"U e dovecot extra conf.en","text":"<p>Create a file <code>data/conf/dovecot/extra.conf</code> - if missing - and add your additional content here.</p> <p>Restart <code>dovecot-mailcow</code> to apply your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart dovecot-mailcow\n</code></pre>","path":["U e dovecot extra conf.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.de/","level":1,"title":"U e dovecot fts.de","text":"<p>Neue Volltextsuche-Engine</p> <p>Mit dem Januar 2025 Update wurde Solr durch Flatcurve ersetzt. Alle bestehenden FTS-Indizes sind daher obsolet und können entfernt werden.</p> <p>mailcow verweist auf das alte solr-vol-1 und fragt bei jedem Update-Vorgang, ob es entfernt werden soll, falls es noch existiert.</p> <p>Flatcurve ist die neue Volltextsuche, die auch auf leistungsschwächeren Systemen besser funktioniert und langfristig auch zum Standard von Dovecot selbst wird.</p> <p>Anders als bei Solr ist für Flatcurve kein weiteres Docker-Volume notwendig. Flatcurve speichert seine FTS-Datenbanken im <code>vmail-index</code>-Volume und erzeugt eine ähnliche Ordnerstruktur wie:</p> <pre><code>/var/vmail_index/tester@develcow.de/.INBOX/\n├── dovecot.index\n├── dovecot.index.cache\n├── dovecot.index.log\n└── fts-flatcurve\n    └── index.814\n        ├── flintlock\n        ├── iamglass\n        ├── postlist.glass\n        └── termlist.glass\n</code></pre> <p>Jeder Unterordner im IMAP-Server erhält entsprechend einen eigenen <code>fts-flatcurve</code>-Ordner mit den jeweiligen Indizes der Mails des Ordners.</p> <p>Wichtig</p> <p>Sollten Sie bisher Solr verwendet haben, ist eine komplette Reindexierung erforderlich, da die beiden FTS-Engines nicht miteinander kompatibel sind.</p> <p>Eine automatische Indexierung des Postfachs wird aktiviert, sobald 20 oder mehr E-Mails eingehen oder eine Volltextsuche durchgeführt wird.</p> <p>Wir empfehlen, eine manuelle Reindexierung nur unter Aufsicht durchzuführen, da trotz niedriger Systemanforderungen eine übermäßige Systemauslastung nicht ausgeschlossen werden kann.</p> <p>Weiter unten erfahren Sie, wie Sie eine Reindexierung anstoßen können.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.de/#fts-bezogene-dovecot-befehle","level":2,"title":"FTS-bezogene Dovecot-Befehle","text":"","path":["U e dovecot fts.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.de/#fts-datenbank-auf-fehler-uberprufen-und-ggf-reparieren","level":3,"title":"FTS-Datenbank auf Fehler überprüfen und ggf. reparieren","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code># Einzelbenutzer\ndocker compose exec dovecot-mailcow doveadm fts rescan -u user@domain\n# Alle Benutzer\ndocker compose exec dovecot-mailcow doveadm fts rescan -A\n</code></pre> <pre><code># Einzelbenutzer\ndocker-compose exec dovecot-mailcow doveadm fts rescan -u user@domain\n# Alle Benutzer\ndocker-compose exec dovecot-mailcow doveadm fts rescan -A\n</code></pre> <p>Dovecot-Wiki: \"Scannt, welche Mails im Volltextsuchindex vorhanden sind, und vergleicht diese mit den tatsächlich in den Postfächern vorhandenen Mails. Dies entfernt Mails aus dem Index, die bereits gelöscht wurden, und stellt sicher, dass der nächste doveadm-Index alle fehlenden Mails (falls vorhanden) indiziert.\"</p> <p>Dies indiziert nicht eine Mailbox neu, sondern repariert lediglich einen vorhandenen Index.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.de/#fts-datenbank-neu-indizieren-reindex","level":3,"title":"FTS-Datenbank neu indizieren (Reindex)","text":"<p>Wenn Sie die Daten sofort neu indizieren möchten, können Sie den folgenden Befehl ausführen, wobei <code>*</code> auch eine Postfachmaske wie 'Sent' sein kann. Diese Befehle sind optional, können jedoch den Prozess beschleunigen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code># Einzelner Benutzer\ndocker compose exec dovecot-mailcow doveadm index -u user@domain '*'\n# Alle Benutzer, langsamer und risikoreicher\ndocker compose exec dovecot-mailcow doveadm index -A '*'\n</code></pre> <pre><code># Einzelner Benutzer\ndocker-compose exec dovecot-mailcow doveadm index -u user@domain '*'\n# Alle Benutzer, langsamer und risikoreicher\ndocker-compose exec dovecot-mailcow doveadm index -A '*'\n</code></pre> <p>Hinweis</p> <p>Die Indizierung wird einige Zeit in Anspruch nehmen.</p> <p>Es besteht die Möglichkeit einer übermäßigen Systemauslastung, bis hin zu Systemabstürzen in seltenen Fällen. Beobachten Sie daher den Indizierungsprozess und Ihre Systemauslastung aufmerksam!</p> <p>Da die Neuindizierung ressourcenintensiv sein kann, wurde sie nicht in die mailcow-UI integriert. </p> <p>Fehler beim Re-Indizieren müssen manuell über die CLI behoben werden.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.de/#fts-datenbank-loschen","level":3,"title":"FTS-Datenbank löschen","text":"<p>mailcow entfernt die Indexdaten eines Benutzers automatisch, wenn das entsprechende Postfach gelöscht wird.</p> <p>Alternativ können Sie den Index für Flatcurve manuell über die CLI entfernen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code># Einzelner Benutzer\ndocker compose exec dovecot-mailcow doveadm fts-flatcurve remove -u user@domain '*'\n# Alle Benutzer\ndocker compose exec dovecot-mailcow doveadm fts-flatcurve remove -A '*'\n</code></pre> <pre><code># Einzelner Benutzer\ndocker-compose exec dovecot-mailcow doveadm fts-flatcurve remove -u user@domain '*'\n# Alle Benutzer\ndocker-compose exec dovecot-mailcow doveadm fts-flatcurve remove -A '*'\n</code></pre>","path":["U e dovecot fts.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.de/#fts-spezifische-optionen-in-mailcowconf","level":2,"title":"FTS-spezifische Optionen in mailcow.conf","text":"<p>mailcow liefert standardmäßig niedrige Parameter für die neue FTS-Engine, um sie auch auf schwächeren Systemen nutzbar zu machen.</p> <p>Für leistungsstärkere Systeme können Sie einige Parameter anpassen, um eine effizientere Indexierung zu ermöglichen.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.de/#skip_fts-volltextsuche-deaktivieren","level":3,"title":"<code>SKIP_FTS</code> (Volltextsuche deaktivieren)","text":"<p>In der mailcow.conf können Sie die Volltextsuche komplett deaktivieren. Dies ist vor allem auf Low-End-Systemen zu empfehlen, welche Probleme haben mailcow sowie die Indexierung flüssig laufen zu lassen.</p> <p>Flatcurve ist ressourcenschonender als Solr, benötigt jedoch mehr Speicherplatz und gegebenenfalls mehr CPU-Leistung (abhängig vom Setup).</p> <p>mailcow-Standard</p> <p>Standardmäßig ist dieser Parameter auf n gesetzt, wodurch die Volltextsuche aktiviert ist.</p> Best Practice <p>Lassen Sie die Indexierung zunächst aktiviert. Sollte die neue FTS-Engine zu viele Ressourcen beanspruchen, können Sie die Einstellung später anpassen.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.de/#fts_procs-anzahl-der-indexierungsprozesse","level":3,"title":"<code>FTS_PROCS</code> (Anzahl der Indexierungsprozesse)","text":"<p>Mit der Variablen <code>FTS_PROCS</code> in der mailcow.conf können Sie die Anzahl der Indexierungsprozesse anpassen, die gleichzeitig arbeiten.</p> <p>mailcow-Standard</p> <p>Standardmäßig ist dieser Wert auf 1 Thread limitiert.</p> <p>ACHTUNG</p> <p>Die Indexierungsprozesse verwenden jeweils einen CPU-Thread vollständig. Systeme mit wenigen Kernen sollten eine niedrige Anzahl einstellen, um die restliche Systemleistung nicht zu beeinträchtigen.</p> Best Practice <p>Planen Sie etwa die Hälfte der CPU-Threads Ihres Systems für die Indexierungsprozesse ein. Bei ungerader Kernzahl verwenden Sie die niedrigere Anzahl an Threads, um genügend Ressourcen für das Hauptsystem zu lassen.</p> <p>Dual-Core- oder Single-Core-Systeme sollten die Volltextsuche deaktivieren.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.de/#fts_heap-max-arbeitsspeicher-pro-indexierungsprozess","level":3,"title":"<code>FTS_HEAP</code> (Max. Arbeitsspeicher pro Indexierungsprozess)","text":"<p>Mit <code>FTS_HEAP</code> in der mailcow.conf legen Sie den Arbeitsspeicher pro Indexierungsprozess fest.</p> <p>mailcow-Standard</p> <p>Standardmäßig ist dieser Wert auf 128 MB pro Prozess limitiert.</p> Best Practice <p>Weisen Sie jedem Prozess idealerweise 512 MB Arbeitsspeicher zu. Systeme mit weniger als 8 GB RAM sollten bei 128 MB bleiben oder höchstens auf 256 MB erhöhen.</p> <p>Bei ausgeschöpftem RAM kann Dovecot zwar weiterarbeiten, wird jedoch langsamer.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.de/#erweiterte-konfigurationsmoglichkeiten","level":2,"title":"Erweiterte Konfigurationsmöglichkeiten","text":"<p>Die Integration von Flatcurve erlaubt es, FTS-Optionen individuell anzupassen.</p> <p>Hinweis</p> <p>Jedes Setup ist anders, daher gibt es kein allgemeingültiges Optimum.</p> <p>Die Erfahrung mit der Engine variiert je nach System.</p> <p>Beispielsweise können Sie eine detailliertere Volltextsuche (Substring Search) aktivieren, die genauere Ergebnisse liefert, aber auch mehr Speicherplatz und Zeit erfordert.</p>","path":["U e dovecot fts.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.de/#substring-search-aktivieren-detailiertere-volltextsuche","level":3,"title":"Substring Search aktivieren (Detailiertere Volltextsuche)","text":"<p>Bearbeiten Sie die Datei <code>data/conf/dovecot/conf.d/fts.conf</code>:</p> <pre><code>plugin {\n    [...]\n\n    fts_flatcurve_substring_search=yes # Kann entweder yes oder no sein\n}\n</code></pre> <p>Ein Neustart von Dovecot aktiviert die Änderungen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart dovecot-mailcow\n</code></pre>","path":["U e dovecot fts.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.de/#weitere-tweaks","level":3,"title":"Weitere Tweaks","text":"<p>Wir nehmen gerne von der Community vorgeschlagene Tweaks auf.</p> <p>In der Zwischenzeit können Sie sich die offiziellen Dokumentationen zu Dovecot und Flatcurve ansehen:</p> <ul> <li>Dovecot FTS Modul Dokumentation</li> <li>Flatcurve FTS Engine Dokumentation</li> </ul>","path":["U e dovecot fts.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.en/","level":1,"title":"U e dovecot fts.en","text":"<p>New Full-Text Search Engine</p> <p>As of January 2025, Solr has been replaced by Flatcurve. All existing FTS indices are therefore obsolete and can be removed.</p> <p>mailcow references the old solr-vol-1 and prompts during every update process to remove it if it still exists.</p> <p>Flatcurve is the new full-text search engine that works better even on less powerful systems. Additionally, it is expected to become the default full-text search engine for Dovecot in the long term.</p> <p>Unlike Solr, Flatcurve does not require an additional Docker volume. Flatcurve stores its FTS databases in the <code>vmail-index</code> volume, resulting in a similar folder structure as:</p> <pre><code>/var/vmail_index/tester@develcow.de/.INBOX/\n├── dovecot.index\n├── dovecot.index.cache\n├── dovecot.index.log\n└── fts-flatcurve\n    └── index.814\n        ├── flintlock\n        ├── iamglass\n        ├── postlist.glass\n        └── termlist.glass\n</code></pre> <p>Each subfolder in the IMAP server thus receives its own <code>fts-flatcurve</code> folder with the respective indices of the folder's emails.</p> <p>Important</p> <p>If you have been using Solr, a complete reindexing is required, as the two FTS engines are not compatible with each other.</p> <p>An automatic indexing of the mailbox is activated as soon as 20 or more emails are received or a full-text search is performed.</p> <p>We recommend performing a manual reindexing only under supervision, as excessive system load cannot be ruled out despite low system requirements.</p> <p>Learn more about how to trigger a reindexing further down.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.en/#fts-related-dovecot-commands","level":2,"title":"FTS-Related Dovecot Commands","text":"","path":["U e dovecot fts.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.en/#check-and-repair-fts-database-for-errors","level":3,"title":"Check and Repair FTS Database for Errors","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code># Single user\ndocker compose exec dovecot-mailcow doveadm fts rescan -u user@domain\n# All users\ndocker compose exec dovecot-mailcow doveadm fts rescan -A\n</code></pre> <pre><code># Single user\ndocker-compose exec dovecot-mailcow doveadm fts rescan -u user@domain\n# All users\ndocker-compose exec dovecot-mailcow doveadm fts rescan -A\n</code></pre> <p>Dovecot Wiki: \"Scans which emails are present in the full-text search index and compares them with the emails actually present in the mailboxes. This removes emails from the index that have already been deleted and ensures that the next doveadm index indexes all missing emails (if any).\"</p> <p>This does not reindex a mailbox but merely repairs an existing index.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.en/#reindex-fts-database","level":3,"title":"Reindex FTS Database","text":"<p>If you want to reindex the data immediately, you can use the following command, where <code>*</code> can also be a mailbox mask such as 'Sent'. These commands are optional but can speed up the process:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code># Single user\ndocker compose exec dovecot-mailcow doveadm index -u user@domain '*'\n# All users, slower and riskier\ndocker compose exec dovecot-mailcow doveadm index -A '*'\n</code></pre> <pre><code># Single user\ndocker-compose exec dovecot-mailcow doveadm index -u user@domain '*'\n# All users, slower and riskier\ndocker-compose exec dovecot-mailcow doveadm index -A '*'\n</code></pre> <p>Note</p> <p>Indexing will take some time.</p> <p>Excessive system load, up to and including system crashes in rare cases, is possible. Monitor the indexing process and your system load closely!</p> <p>Since reindexing can be resource-intensive, it has not been integrated into the mailcow UI.</p> <p>You must manually address any errors during reindexing via the CLI.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.en/#delete-fts-database","level":3,"title":"Delete FTS Database","text":"<p>mailcow automatically deletes a user's index data when the corresponding mailbox is deleted.</p> <p>Alternatively, you can manually remove the index for Flatcurve via CLI:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code># Single user\ndocker compose exec dovecot-mailcow doveadm fts-flatcurve remove -u user@domain '*'\n# All users\ndocker compose exec dovecot-mailcow doveadm fts-flatcurve remove -A '*'\n</code></pre> <pre><code># Single user\ndocker-compose exec dovecot-mailcow doveadm fts-flatcurve remove -u user@domain '*'\n# All users\ndocker-compose exec dovecot-mailcow doveadm fts-flatcurve remove -A '*'\n</code></pre>","path":["U e dovecot fts.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.en/#fts-specific-options-in-mailcowconf","level":2,"title":"FTS-Specific Options in mailcow.conf","text":"<p>mailcow provides low default settings for the new FTS engine to ensure functionality even on less powerful systems.</p> <p>For more powerful systems, you can adjust some parameters to enable more efficient indexing.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.en/#skip_fts-disable-full-text-search","level":3,"title":"<code>SKIP_FTS</code> (Disable Full-Text Search)","text":"<p>In mailcow.conf, you can completely disable full-text search. This is still recommended for low-end systems which are struggeling to run mailcow and the indexing process(es) at the same time.</p> <p>Flatcurve is less resource-intensive than Solr but requires more storage and possibly more CPU power (depending on the setup).</p> <p>mailcow Default</p> <p>By default, this parameter is set to n, meaning full-text search is enabled.</p> Best Practice <p>Initially, leave the indexing enabled. If the new FTS engine uses too many resources, you can change the setting later.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.en/#fts_procs-number-of-indexing-processes","level":3,"title":"<code>FTS_PROCS</code> (Number of Indexing Processes)","text":"<p>With the <code>FTS_PROCS</code> variable in mailcow.conf, you can adjust the number of indexing processes that can run simultaneously.</p> <p>mailcow Default</p> <p>By default, this value is limited to 1 thread.</p> <p>CAUTION</p> <p>Indexing processes are single-threaded applications that fully utilize a CPU thread. Systems with few cores should use a lower number to avoid overloading the system.</p> Best Practice <p>Plan for about half of your system's CPU threads for the indexing processes. For odd numbers of CPU threads, use the lower count to leave sufficient resources for the main system.</p> <p>Dual-core or single-core systems should disable full-text search.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.en/#fts_heap-max-memory-per-indexing-process","level":3,"title":"<code>FTS_HEAP</code> (Max Memory Per Indexing Process)","text":"<p>With <code>FTS_HEAP</code> in mailcow.conf, you can set the memory allocated per indexing process.</p> <p>mailcow Default</p> <p>By default, this value is limited to 128 MB per process.</p> Best Practice <p>Ideally, allocate 512 MB of memory per process. Systems with less than 8 GB RAM should stick to 128 MB or increase to 256 MB, but reduce the number of processes to avoid OOM errors.</p> <p>While Dovecot continues to operate when RAM is exhausted per worker, it may become significantly slower.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.en/#advanced-configuration-options","level":2,"title":"Advanced Configuration Options","text":"<p>Flatcurve integration allows for customizing FTS options as needed.</p> <p>Note</p> <p>Every setup is unique, so there is no universal \"right\" or \"wrong\" configuration.</p> <p>Experience with the engine varies by system.</p> <p>For example, you can enable more detailed full-text search (substring search), which provides more accurate results but requires more storage and longer indexing times.</p>","path":["U e dovecot fts.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.en/#enable-substring-search-more-detailed-full-text-search","level":3,"title":"Enable Substring Search (More Detailed Full-Text Search)","text":"<p>Edit the file <code>data/conf/dovecot/conf.d/fts.conf</code>:</p> <pre><code>plugin {\n    [...]\n\n    fts_flatcurve_substring_search=yes # Can be yes or no\n}\n</code></pre> <p>Restart Dovecot to apply the changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart dovecot-mailcow\n</code></pre>","path":["U e dovecot fts.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-fts.en/#additional-tweaks","level":3,"title":"Additional Tweaks","text":"<p>We welcome community contributions for useful tweaks over time.</p> <p>Meanwhile, you can refer to the official Dovecot and Flatcurve documentation for an overview of available parameters:</p> <ul> <li>Dovecot FTS Module Documentation</li> <li>Flatcurve FTS Engine Documentation</li> </ul>","path":["U e dovecot fts.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-harden_ciphers.de/","level":1,"title":"U e dovecot harden ciphers.de","text":"<p>Wenn Sie die Standard-Cipher und TLS-Versionen, die in Dovecot akzeptiert werden, entsprechend der aktuellen Version auf stärkere Einstellungen ändern möchten, können Sie Folgendes zu Dovecots extra.conf hinzufügen:</p> <pre><code>ssl_min_protocol = TLSv1.2\nssl_cipher_list = ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-CHACHA20-POLY1305\n</code></pre> <p>Falls Sie auch die Cipher für Postfix anpassen wollen finden Sie hier eine entsprechende Anleitung.</p>","path":["U e dovecot harden ciphers.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-harden_ciphers.en/","level":1,"title":"U e dovecot harden ciphers.en","text":"<p>If you want to change the default ciphers and TLS versions accepted in Dovecot as per it's current release to something stronger, you could add following to Dovecot's extra.conf:</p> <pre><code>ssl_min_protocol = TLSv1.2\nssl_cipher_list = ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-CHACHA20-POLY1305\n</code></pre> <p>If you want to adjust the ciphers for Postfix as well you can find the corresponding tutorial here.</p>","path":["U e dovecot harden ciphers.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-idle_interval.de/","level":1,"title":"Ändern des IMAP-IDLE-Intervalls","text":"","path":["Ändern des IMAP-IDLE-Intervalls"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-idle_interval.de/#was-ist-das-idle-intervall","level":2,"title":"Was ist das IDLE-Intervall?","text":"<p>Standardmäßig sendet Dovecot eine \"Ich bin noch da\"-Benachrichtigung an jeden Client, der eine offene Verbindung mit Dovecot hat, um Mails so schnell wie möglich zu erhalten, ohne sie manuell abzufragen (IMAP PUSH). Diese Benachrichtigung wird durch die Einstellung <code>imap_idle_notify_interval</code> gesteuert, die standardmäßig auf 2 Minuten eingestellt ist. </p> <p>Ein kurzes Intervall führt dazu, dass der Client viele Nachrichten für diese Verbindung erhält, was für mobile Geräte schlecht ist, da jedes Mal, wenn das Gerät diese Nachricht erhält, die Mailing-App aufwachen muss. Dies kann zu einer unnötigen Entladung der Batterie führen.</p>","path":["Ändern des IMAP-IDLE-Intervalls"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-idle_interval.de/#bearbeiten-sie-den-wert","level":2,"title":"Bearbeiten Sie den Wert","text":"","path":["Ändern des IMAP-IDLE-Intervalls"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-idle_interval.de/#konfiguration-andern","level":3,"title":"Konfiguration ändern","text":"<p>Erstellen Sie eine neue Datei <code>data/conf/dovecot/extra.conf</code> (oder bearbeiten Sie sie, falls sie bereits existiert). Fügen Sie die Einstellung ein, gefolgt von dem neuen Wert. Um zum Beispiel das Intervall auf 5 Minuten zu setzen, können Sie Folgendes eingeben:</p> <pre><code>imap_idle_notify_interval = 5 mins\n</code></pre> <p>29 Minuten ist der maximale Wert, den der entsprechende RFC erlaubt.</p> <p>Warnung</p> <p>Dies ist keine Standardeinstellung in mailcow, da wir nicht wissen, wie diese Einstellung das Verhalten anderer Clients verändert. Seien Sie vorsichtig, wenn Sie dies ändern und ein anderes Verhalten beobachten.</p>","path":["Ändern des IMAP-IDLE-Intervalls"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-idle_interval.de/#dovecot-neu-laden","level":3,"title":"Dovecot neu laden","text":"<p>Nun laden Sie Dovecot neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow dovecot reload\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow dovecot reload\n</code></pre> <p>Info</p> <p>Sie können den Wert dieser Einstellung überprüfen mit </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow dovecot -a | grep \"imap_idle_notify_interval\"\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow dovecot -a | grep \"imap_idle_notify_interval\"\n</code></pre> <p>Wenn Sie den Wert nicht geändert haben, sollte er auf 2m stehen. Wenn Sie ihn geändert haben, sollten Sie den neuen Wert sehen.</p>","path":["Ändern des IMAP-IDLE-Intervalls"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-idle_interval.en/","level":1,"title":"Changing the IMAP IDLE interval","text":"","path":["Changing the IMAP IDLE interval"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-idle_interval.en/#what-is-the-idle-interval","level":2,"title":"What is the IDLE interval?","text":"<p>Per default, Dovecot sends a \"I'm still here\" notification to every client that has an open connection with Dovecot to get mails as quickly as possible without manually polling it (IMAP PUSH). This notification is controlled by the setting <code>imap_idle_notify_interval</code>, which defaults to 2 minutes. </p> <p>A short interval results in the client getting a lot of messages for this connection, which is bad for mobile devices, because every time the device receives this message, the mailing app has to wake up. This can result in unnecessary battery drain.</p>","path":["Changing the IMAP IDLE interval"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-idle_interval.en/#edit-the-value","level":2,"title":"Edit the value","text":"","path":["Changing the IMAP IDLE interval"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-idle_interval.en/#change-configuration","level":3,"title":"Change configuration","text":"<p>Create a new file <code>data/conf/dovecot/extra.conf</code> (or edit it if it already exists). Insert the setting followed by the new value. For example, to set the interval to 5 minutes you could type:</p> <pre><code>imap_idle_notify_interval = 5 mins\n</code></pre> <p>29 minutes is the maximum value allowed by the corresponding RFC.</p> <p>Warning</p> <p>This isn't a default setting in mailcow because we don't know how this setting changes the behavior of other clients. Be careful if you change this and monitor different behavior.</p>","path":["Changing the IMAP IDLE interval"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-idle_interval.en/#reload-dovecot","level":3,"title":"Reload Dovecot","text":"<p>Now reload Dovecot:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow dovecot reload\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow dovecot reload\n</code></pre> <p>Info</p> <p>You can check the value of this setting with </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow dovecot -a | grep \"imap_idle_notify_interval\"\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow dovecot -a | grep \"imap_idle_notify_interval\"\n</code></pre> <p>If you didn't change it, it should be at 2m. If you did change it, you should see your new value.</p>","path":["Changing the IMAP IDLE interval"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-lazy_expunge.de/","level":1,"title":"U e dovecot lazy expunge.de","text":"<p>Vorsicht</p> <p>Diese Anleitung befindet sich noch in Arbeit, Fehler können passieren! Nutzen Sie diese Funktion mit Bedacht!</p> <p>Hinweis</p> <p>Diese Funktion ist ab mailcow-Versionen 2024-11 kompatibel. Ältere Versionen sind theoretisch ebenfalls in der Lage, die Funktion zu nutzen. Aufgrund interner Änderungen ist die Implementierung jedoch schwieriger und wird hier nicht weiter beschrieben, da nicht unterstüzt.</p>","path":["U e dovecot lazy expunge.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-lazy_expunge.de/#vorwort","level":2,"title":"Vorwort","text":"<p>Dovecot unterstützt seit geraumer Zeit eine Funktion namens Lazy Expunge, welche es dem Serveradministrator ermöglicht, gelöschte E-Mails eines Benutzerkontos nach der eigentlichen Löschung zurückzuhalten.</p> <p>mailcow besitzt eine ähnliche Funktion, die jedoch für Benutzer nicht so leicht zugänglich ist (siehe Versehentlich gelöschte Daten wiederherstellen (Mail)) und eher als Fallback-Methode für Administratoren dient.</p> <p>Mit der Dovecot-Option können Benutzer selbst als gelöscht markierte E-Mails einsehen und wiederherstellen, bevor diese dann automatisch vom Dovecot-Server gelöscht werden.</p>","path":["U e dovecot lazy expunge.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-lazy_expunge.de/#einrichtung","level":2,"title":"Einrichtung","text":"<ol> <li> <p>Bearbeiten Sie die <code>extra.conf</code> im Dovecot-Konfigurationsordner (in der Regel unter <code>MAILCOW_ROOT/data/conf/dovecot</code>) mit folgendem Inhalt:     <pre><code>plugin {\n    # Kopiere alle gelöschten Mails in die .EXPUNGED Mailbox\n    lazy_expunge = .EXPUNGED\n\n    # Als gelöscht markierte Mails von der Quota ausschließen\n    quota_rule = .EXPUNGED:ignore\n}\n\n# Definiert die .EXPUNGED Mailbox\nnamespace inbox {\n    mailbox .EXPUNGED {\n        # Definiert, wie lange Mails in diesem Ordner bleiben sollen, bevor sie gelöscht werden. \n        # Zeit wird definiert nach: https://doc.dovecot.org/2.3/settings/types/#time\n        autoexpunge = 7days\n        # Definiert, wie viele Mails maximal in der EXPUNGED Mailbox gehalten werden sollen, bevor diese geleert wird\n        autoexpunge_max_mails = 100000\n    }\n}\n</code></pre></p> </li> <li> <p>Starten Sie den Dovecot-Container neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart dovecot-mailcow\n</code></pre> </li> <li> <p>Nun sollte, wenn der Papierkorb geleert wird, ein neuer Ordner mit dem Namen <code>.EXPUNGED</code> erscheinen. In diesem Ordner sind die E-Mails enthalten, die gemäß der in Schritt 1 definierten Regeln nach einer gewissen Zeit automatisch vom Server gelöscht werden.</p> </li> </ol>","path":["U e dovecot lazy expunge.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-lazy_expunge.en/","level":1,"title":"U e dovecot lazy expunge.en","text":"<p>Danger</p> <p>This guide is still a work in progress, and errors may occur! Use this feature with caution!</p> <p>Info</p> <p>This feature is compatible with mailcow versions starting from 2024-11. Older versions are theoretically capable of using it as well, but due to internal changes, the implementation is more complicated, so it won't be stated here as unsupported.</p>","path":["U e dovecot lazy expunge.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-lazy_expunge.en/#introduction","level":2,"title":"Introduction","text":"<p>Dovecot has supported a feature called Lazy Expunge for quite some time, which allows server administrators to temporarily retain deleted emails from a user account even after they have been deleted.</p> <p>mailcow also has a similar feature, but it is not easily accessible to users (see Recover accidentally deleted data (Mail)) and serves more as a fallback method for administrators.</p> <p>With the Dovecot option, users can view and restore emails that have been marked as deleted before they are automatically purged by the Dovecot server.</p>","path":["U e dovecot lazy expunge.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-lazy_expunge.en/#setup","level":2,"title":"Setup","text":"<ol> <li> <p>Edit the <code>extra.conf</code> file in the Dovecot configuration folder (usually located at <code>MAILCOW_ROOT/data/conf/dovecot</code>) with the following content:     <pre><code>plugin {\n    # Copy all deleted emails to the .EXPUNGED mailbox\n    lazy_expunge = .EXPUNGED\n\n    # Exclude marked-as-deleted emails from the quota\n    quota_rule = .EXPUNGED:ignore\n}\n\n# Define the .EXPUNGED mailbox\nnamespace inbox {\n    mailbox .EXPUNGED {\n        # Define how long emails will stay in this folder before they are deleted. Time is defined according to: https://doc.dovecot.org/2.3/settings/types/#time\n        autoexpunge = 7days\n        # Define how many emails can be kept in the EXPUNGED folder before it is cleared\n        autoexpunge_max_mails = 100000\n    }\n}\n</code></pre></p> </li> <li> <p>Restart the Dovecot container:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart dovecot-mailcow\n</code></pre> <pre><code>docker-compose restart dovecot-mailcow\n</code></pre> </li> <li> <p>Once the trash is emptied, a new folder named <code>.EXPUNGED</code> should appear. This folder will contain emails that, according to the rules defined in step 1, will be automatically deleted from the server after a certain period.</p> </li> </ol>","path":["U e dovecot lazy expunge.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-mail-crypt.de/","level":1,"title":"U e dovecot mail crypt.de","text":"<p>Achtung</p> <p>Die Mails werden komprimiert (lz4) und verschlüsselt gespeichert. Das Schlüsselpaar ist in crypt-vol-1 zu finden.</p> <p>Wenn Sie vorhandene maildir-Dateien entschlüsseln/verschlüsseln wollen, können Sie das folgende Skript auf eigene Gefahr verwenden:</p> <p>Wechseln Sie in den Dovecot Container, indem Sie folgenden Befehl im mailcow-dockerized Verzeichnis ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow /bin/bash\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow /bin/bash\n</code></pre> <pre><code># Entschlüsseln Sie /var/vmail\nfind /var/vmail/ -type f -regextype egrep -regex '.*S=.*W=.*' | while read -r file; do\nif [[ $(head -c7 \"$file\") == \"CRYPTED\" ]]; then\ndoveadm fs get compress lz4:1:crypt:private_key_path=/mail_crypt/ecprivkey.pem:public_key_path=/mail_crypt/ecpubkey.pem:posix:prefix=/ \\\n  \"$file\" &gt; \"/tmp/$(basename \"$file\")\"\n  if [[ -s \"/tmp/$(basename \"$file\")\" ]]; then\n    chmod 600 \"/tmp/$(basename \"$file\")\"\n    chown 5000:5000 \"/tmp/$(basename \"$file\")\"\n    mv \"/tmp/$(basename \"$file\")\" \"$file\"\n  else\n    rm \"/tmp/$(basename \"$file\")\"\n  fi\nfi\ndone\n\n\n# Verschlüsseln von /var/vmail\nfind /var/vmail/ -type f -regextype egrep -regex '.*S=.*W=.*' | while read -r file; do\nif [[ $(head -c7 \"$file\") != \"CRYPTED\" ]]; then\ndoveadm fs put crypt private_key_path=/mail_crypt/ecprivkey.pem:public_key_path=/mail_crypt/ecpubkey.pem:posix:prefix=/ \\\n  \"$file\" \"$file\"\n  chmod 600 \"$file\"\n  chown 5000:5000 \"$file\"\nfi\ndone\n</code></pre>","path":["U e dovecot mail crypt.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-mail-crypt.en/","level":1,"title":"U e dovecot mail crypt.en","text":"<p>Warning</p> <p>Mails are stored compressed (lz4) and encrypted. The key pair can be found in crypt-vol-1.</p> <p>If you want to decode/encode existing maildir files, you can use the following script at your own risk:</p> <p>Enter Dovecot by running the following command in the mailcow-dockerized location:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow /bin/bash\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow /bin/bash\n</code></pre> <pre><code># Decrypt /var/vmail\nfind /var/vmail/ -type f -regextype egrep -regex '.*S=.*W=.*' | while read -r file; do\nif [[ $(head -c7 \"$file\") == \"CRYPTED\" ]]; then\ndoveadm fs get compress lz4:1:crypt:private_key_path=/mail_crypt/ecprivkey.pem:public_key_path=/mail_crypt/ecpubkey.pem:posix:prefix=/ \\\n  \"$file\" &gt; \"/tmp/$(basename \"$file\")\"\n  if [[ -s \"/tmp/$(basename \"$file\")\" ]]; then\n    chmod 600 \"/tmp/$(basename \"$file\")\"\n    chown 5000:5000 \"/tmp/$(basename \"$file\")\"\n    mv \"/tmp/$(basename \"$file\")\" \"$file\"\n  else\n    rm \"/tmp/$(basename \"$file\")\"\n  fi\nfi\ndone\n\n# Encrypt /var/vmail\nfind /var/vmail/ -type f -regextype egrep -regex '.*S=.*W=.*' | while read -r file; do\nif [[ $(head -c7 \"$file\") != \"CRYPTED\" ]]; then\ndoveadm fs put crypt private_key_path=/mail_crypt/ecprivkey.pem:public_key_path=/mail_crypt/ecpubkey.pem:posix:prefix=/ \\\n  \"$file\" \"$file\"\n  chmod 600 \"$file\"\n  chown 5000:5000 \"$file\"\nfi\ndone\n</code></pre>","path":["U e dovecot mail crypt.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-more.de/","level":1,"title":"U e dovecot more.de","text":"<p>Hier ist nur eine unsortierte Liste von nützlichen <code>doveadm</code>-Befehlen, die nützlich sein könnten.</p>","path":["U e dovecot more.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-more.de/#doveadm-quota","level":2,"title":"doveadm quota","text":"<p>Die Befehle <code>quota get</code> und <code>quota recalc</code><sup>1</sup> werden verwendet, um die Quota-Nutzung des aktuellen Benutzers anzuzeigen oder neu zu berechnen. Die angezeigten Werte sind in Kilobytes.</p> <p>Um den aktuellen Quota-Status für einen Benutzer / eine Mailbox aufzulisten, tun Sie folgendes:</p> <pre><code>doveadm quota get -u 'mailbox@example.org'\n</code></pre> <p>Um den Quota-Speicherwert für alle Benutzer aufzulisten, tun Sie folgendes:</p> <pre><code>doveadm quota get -A |grep \"STORAGE\"\n</code></pre> <p>Berechnen Sie die Quota-Nutzung eines einzelnen Benutzers neu:</p> <pre><code>doveadm quota recalc -u 'mailbox@example.org'\n</code></pre>","path":["U e dovecot more.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-more.de/#doveadm-search","level":2,"title":"doveadm search","text":"<p>Der Befehl <code>doveadm search</code><sup>2</sup> wird verwendet, um Nachrichten zu finden, die Ihrer Anfrage entsprechen. Er kann den Benutzernamen, die Mailbox-GUID / -UID und die Nachrichten-GUIDs / -UIDs zurückgeben.</p> <p>Um die Anzahl der Nachrichten im .Trash Ordner eines Benutzers zu sehen:</p> <pre><code>doveadm search -A mailbox 'Trash' | awk '{print $1}' | sort | uniq -c\n</code></pre> <p>Alle Nachrichten im Postfach eines Benutzers anzeigen, die älter als 90 Tage sind:</p> <pre><code>doveadm search -u 'mailbox@example.org' mailbox 'INBOX' savedbefore 90d\n</code></pre> <p>Zeige alle Nachrichten in beliebigen Ordnern, die älter sind als 30 Tage für <code>mailbox@example.org</code>:</p> <pre><code>doveadm search -u 'mailbox@example.org' mailbox \"*\" savedbefore 30d\n</code></pre> <ol> <li> <p>https://wiki.dovecot.org/Tools/Doveadm/Quota ↩</p> </li> <li> <p>https://wiki.dovecot.org/Tools/Doveadm/Search ↩</p> </li> </ol>","path":["U e dovecot more.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-more.en/","level":1,"title":"U e dovecot more.en","text":"<p>Here is just an unsorted list of useful <code>doveadm</code> commands that could be useful.</p>","path":["U e dovecot more.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-more.en/#doveadm-quota","level":2,"title":"doveadm quota","text":"<p>The <code>quota get</code> and <code>quota recalc</code><sup>1</sup> commands are used to display or recalculate the current user's quota usage. The reported values are in kilobytes.</p> <p>To list the current quota status for a user / mailbox, do:</p> <pre><code>doveadm quota get -u 'mailbox@example.org'\n</code></pre> <p>To list the quota storage value for all users, do:</p> <pre><code>doveadm quota get -A |grep \"STORAGE\"\n</code></pre> <p>Recalculate a single user's quota usage:</p> <pre><code>doveadm quota recalc -u 'mailbox@example.org'\n</code></pre>","path":["U e dovecot more.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-more.en/#doveadm-search","level":2,"title":"doveadm search","text":"<p>The <code>doveadm search</code><sup>2</sup> command is used to find messages matching your query. It can return the username, mailbox-GUID / -UID and message-GUIDs / -UIDs.</p> <p>To view the number of messages, by user, in their .Trash folder:</p> <pre><code>doveadm search -A mailbox 'Trash' | awk '{print $1}' | sort | uniq -c\n</code></pre> <p>Show all messages in a user's inbox older then 90 days:</p> <pre><code>doveadm search -u 'mailbox@example.org' mailbox 'INBOX' savedbefore 90d\n</code></pre> <p>Show all messages in any folder that are older then 30 days for <code>mailbox@example.org</code>:</p> <pre><code>doveadm search -u 'mailbox@example.org' mailbox \"*\" savedbefore 30d\n</code></pre> <ol> <li> <p>https://wiki.dovecot.org/Tools/Doveadm/Quota ↩</p> </li> <li> <p>https://wiki.dovecot.org/Tools/Doveadm/Search ↩</p> </li> </ol>","path":["U e dovecot more.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-performance.de/","level":1,"title":"U e dovecot performance.de","text":"","path":["U e dovecot performance.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-performance.de/#maildir_very_dirty_syncs","level":2,"title":"maildir_very_dirty_syncs","text":"<p>Dovecot's <code>maildir_very_dirty_syncs</code> Option ist seit mailcow Release 2023-05 standardmäßig aktiviert. Diese Option kann die Leistung von Postfächern, die sehr große Ordner (über 100.000 E-Mails) enthalten, erheblich verbessern.</p> <p>Mit dieser Option wird vermieden, dass beim Laden einer E-Mail das gesamte <code>cur</code>-Verzeichnis erneut durchsucht wird. Wenn diese Option deaktiviert ist, geht Dovecot auf Nummer sicher und durchsucht das gesamte <code>cur</code>-Verzeichnis (vergleichbar mit dem Ausführen eines <code>ls</code>), um zu prüfen, ob diese bestimmte E-Mail berührt (umbenannt, etc.) wurde, indem es nach allen Dateien sucht, deren Namen die richtige ID enthalten. Dies ist sehr langsam, wenn das Verzeichnis groß ist, selbst auf Dateisystemen, die für solche Anwendungsfälle optimiert sind (wie ext4 mit aktiviertem <code>dir_index</code>) auf schnellen SSD-Laufwerken.</p> <p>Diese Option ist sicher, solange Sie Dateien unter <code>cur</code> nicht manuell anfassen (da Dovecot die Änderungen dann möglicherweise nicht bemerkt). Auch wenn diese Option aktiviert ist, wird Dovecot Änderungen bemerken, wenn die mtime (last modified time) der Datei geändert wurde, aber ansonsten wird das Verzeichnis nicht gescannt und es wird einfach angenommen, dass der Index aktuell ist. Dies entspricht im Wesentlichen dem, was sdbox/mdbox tun, und mit dieser Option können Sie einen Teil der Leistungssteigerung erhalten, die mit sdbox/mdbox einhergehen würde, während Sie weiterhin maildir verwenden.</p> <p>Diese Option ist bei einer Standard-mailcow-Installation sicher zu verwenden. Wenn Sie jedoch Tools von Drittanbietern verwenden, die manuell Dateien direkt im Maildir modifizieren (anstatt über IMAP), möchten Sie diese Option vielleicht deaktivieren. Um diese Option zu deaktivieren, erstellen Sie eine data/conf/dovecot/extra.conf Datei und fügen Sie diese Einstellung hinzu:</p> <pre><code>maildir_very_dirty_syncs=no\n</code></pre> <p>Achtung</p> <p>Bitte nutzen Sie für eigene Anpassungen IMMER, die oben erwähnte <code>extra.conf</code>, da Änderungen, welche in der normalen <code>dovecot.conf</code> geändert werden möglicherweise nach einem Update vom GitHub Quellcode überschrieben werden.</p>","path":["U e dovecot performance.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-performance.en/","level":1,"title":"U e dovecot performance.en","text":"","path":["U e dovecot performance.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-performance.en/#maildir_very_dirty_syncs","level":2,"title":"maildir_very_dirty_syncs","text":"<p>Dovecot's <code>maildir_very_dirty_syncs</code> option is enabled by default since mailcow Release 2023-05. This option can significantly improve the performance of mailboxes that contain very large folders (over 100,000 emails).</p> <p>What this option does is it avoids rescanning the entire <code>cur</code> directory whenever loading an email. With this option disabled, Dovecot takes it safe and scans the entire <code>cur</code> directory (comparable with running an <code>ls</code>) to check if that particular email was touched (renamed, etc), by looking for all files whose names contain the correct ID. This is very slow if the directory is large, even on filesystems optimized for such use cases (such as ext4 with <code>dir_index</code> enabled) on fast SSD drives.</p> <p>This option is safe to use as long as you do not manually touch files under <code>cur</code> (as then Dovecot may not notice the changes). Even with this option enabled, Dovecot will still notice changes if the file's mtime (last modified time) is changed, but otherwise it will not scan the directory and just assumes the index is up-to-date. This is essentially the same as what sdbox/mdbox do, and with this option you can get some of the performance increase that would come with sdbox/mdbox while still using maildir.</p> <p>This option is safe to use on a standard Mailcow installation. However, if you use any third-party tools that manually modify files directly in the maildir (rather than via IMAP), you may wish to disable it. To disable this option, create a data/conf/dovecot/extra.conf file and add this setting to it:</p> <pre><code>maildir_very_dirty_syncs=no\n</code></pre> <p>Warning</p> <p>Please ALWAYS use the above mentioned <code>extra.conf</code> for your own customizations, as changes made in the normal <code>dovecot.conf</code> might be overwritten after an update from GitHub source code.</p>","path":["U e dovecot performance.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-public_folder.de/","level":1,"title":"U e dovecot public folder.de","text":"<p>Erstellen Sie einen neuen öffentlichen Namespace \"Public\" und eine Mailbox \"Develcow\" innerhalb dieses Namespaces:</p> <p>Bearbeiten oder erstellen Sie <code>data/conf/dovecot/extra.conf</code>, fügen Sie hinzu:</p> <pre><code>namespace {\n  type = public\n  separator = /\n  prefix = Public/\n  location = maildir:/var/vmail/public:INDEXPVT=~/public\n  subscriptions = yes\n  mailbox \"Develcow\" {\n    auto = subscribe\n  }\n}\n</code></pre> <p><code>:INDEXPVT=~/public</code> kann weggelassen werden, wenn die Flags, die pro Benutzer gesehen werden, nicht gewünscht sind.</p> <p>Die neue Mailbox im öffentlichen Namensraum wird von den Benutzern automatisch abonniert.</p> <p>Um allen authentifizierten Benutzern vollen Zugriff auf das neue Postfach (nicht auf den gesamten Namespace) zu gewähren, führen Sie aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm acl set -A \"Public/Develcow\" \"authenticated\" lookup read write write-seen write-deleted insert post delete expunge create\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm acl set -A \"Public/Develcow\" \"authenticated\" lookup read write write-seen write-deleted insert post delete expunge create\n</code></pre> <p>Passen Sie den Befehl an Ihre Bedürfnisse an, wenn Sie detailliertere Rechte pro Benutzer vergeben möchten (verwenden Sie z.B. <code>-u user@domain</code> anstelle von <code>-A</code>).</p>","path":["U e dovecot public folder.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-public_folder.de/#erlaube-authentifizierten-benutzern-den-zugriff-auf-den-gesamten-offentlichen-namespace","level":2,"title":"Erlaube authentifizierten Benutzern den Zugriff auf den gesamten öffentlichen Namespace","text":"<p>Um allen authentifizierten Benutzern vollen Zugriff auf den gesamten öffentlichen Namespace und seine Unterordner zu gewähren, erstellen Sie eine neue Datei <code>dovecot-acl</code> im Namespace-Stammverzeichnis:</p> <p>Öffnen/bearbeiten/erstellen Sie <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/public/dovecot-acl</code> (passen Sie den Pfad entsprechend an), um die globale ACL-Datei mit dem folgenden Inhalt zu erstellen:</p> <pre><code>authenticated kxeilprwts\n</code></pre> <p>kxeilprwts\" ist gleichbedeutend mit \"lookup read write write-seen write-deleted insert post delete expunge create\".</p> <p>Sie können <code>doveadm acl set -u user@domain \"Public/Develcow\" user=user@domain lookup read</code> verwenden, um den Zugriff für einen einzelnen Benutzer zu beschränken. Sie können es auch umdrehen und den Zugriff für alle Benutzer auf \"lr\" beschränken und nur einigen Benutzern vollen Zugriff gewähren.</p> <p>Siehe Dovecot ACL für weitere Informationen über ACL.</p>","path":["U e dovecot public folder.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-public_folder.en/","level":1,"title":"U e dovecot public folder.en","text":"<p>Create a new public namespace \"Public\" and a mailbox \"Develcow\" inside that namespace:</p> <p>Edit or create <code>data/conf/dovecot/extra.conf</code>, add:</p> <pre><code>namespace {\n  type = public\n  separator = /\n  prefix = Public/\n  location = maildir:/var/vmail/public:INDEXPVT=~/public\n  subscriptions = yes\n  mailbox \"Develcow\" {\n    auto = subscribe\n  }\n}\n</code></pre> <p><code>:INDEXPVT=~/public</code> can be omitted if per-user seen flags are not wanted.</p> <p>The new mailbox in the public namespace will be auto-subscribed by users.</p> <p>To allow all authenticated users access full to that new mailbox (not the whole namespace), run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow doveadm acl set -A \"Public/Develcow\" \"authenticated\" lookup read write write-seen write-deleted insert post delete expunge create\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow doveadm acl set -A \"Public/Develcow\" \"authenticated\" lookup read write write-seen write-deleted insert post delete expunge create\n</code></pre> <p>Adjust the command to your needs if you like to assign more granular rights per user (use <code>-u user@domain</code> instead of <code>-A</code> for example).</p>","path":["U e dovecot public folder.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-public_folder.en/#allow-authenticated-users-access-to-the-whole-public-namespace","level":2,"title":"Allow authenticated users access to the whole public namespace","text":"<p>To allow all authenticated users access full access to the whole public namespace and its subfolders, create a new <code>dovecot-acl</code> file in the namespace root directory:</p> <p>Open/edit/create <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data/public/dovecot-acl</code> (adjust the path accordingly) to create the global ACL file with the following content:</p> <pre><code>authenticated kxeilprwts\n</code></pre> <p><code>kxeilprwts</code> equals to <code>lookup read write write-seen write-deleted insert post delete expunge create</code>.</p> <p>You can use <code>doveadm acl set -u user@domain \"Public/Develcow\" user=user@domain lookup read</code> to limit access for a single user. You may also turn it around to limit access for all users to \"lr\" and grant only some users full access.</p> <p>See Dovecot ACL for further information about ACL.</p>","path":["U e dovecot public folder.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-static_master.de/","level":1,"title":"U e dovecot static master.de","text":"<p>Zufällige Master-Benutzernamen und Passwörter werden automatisch bei jedem Neustart von dovecot-mailcow erstellt.</p> <p>Das wird empfohlen und sollte nicht geändert werden.</p> <p>Wenn der Benutzer trotzdem statisch sein soll, geben Sie bitte zwei Variablen in <code>mailcow.conf</code> an.</p> <p>Beide Parameter dürfen nicht leer sein!</p> <pre><code>DOVECOT_MASTER_USER=mymasteruser\nDOVECOT_MASTER_PASS=mysecretpass\n</code></pre> <p>Führen Sie folgenden Befehl aus, um Ihre Änderungen zu übernehmen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Der statische Master-Benutzername wird zu <code>DOVECOT_MASTER_USER@mailcow.local</code> erweitert.</p> <p>Um sich als <code>test@example.org</code> anzumelden, würde dies <code>test@example.org*mymasteruser@mailcow.local</code> mit dem oben angegebenen Passwort entsprechen.</p> <p>Eine Anmeldung bei SOGo ist mit diesem Benutzernamen nicht möglich. Für Admins steht eine Click-to-Login-Funktion für SOGo zur Verfügung, wie [hier] beschrieben (https://docs.mailcow.email/debug-admin_login_sogo/) Es wird kein Hauptbenutzer benötigt.</p>","path":["U e dovecot static master.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-static_master.en/","level":1,"title":"U e dovecot static master.en","text":"<p>Random master usernames and passwords are automatically created on every restart of dovecot-mailcow.</p> <p>That's recommended and should not be changed.</p> <p>If you need the user to be static anyway, please specify two variables in <code>mailcow.conf</code>.</p> <p>Both parameters must not be empty!</p> <pre><code>DOVECOT_MASTER_USER=mymasteruser\nDOVECOT_MASTER_PASS=mysecretpass\n</code></pre> <p>Run the command below to apply your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>The static master username will be expanded to <code>DOVECOT_MASTER_USER@mailcow.local</code>.</p> <p>To login as <code>test@example.org</code> this would equal to <code>test@example.org*mymasteruser@mailcow.local</code> with the specified password above.</p> <p>A login to SOGo is not possible with this username. A click-to-login function for SOGo is available for admins as described here No master user is required.</p>","path":["U e dovecot static master.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-vmail-volume.de/","level":1,"title":"U e dovecot vmail volume.de","text":"","path":["U e dovecot vmail volume.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-vmail-volume.de/#der-neue-weg","level":2,"title":"Der \"neue\" Weg","text":"<p>Warnung</p> <p>Neuere Docker-Versionen scheinen sich über bestehende Volumes zu beschweren. Man kann dies vorübergehend beheben, indem man das bestehende Volume entfernt und mailcow mit der Override-Datei startet. Aber es scheint nach einem Neustart problematisch zu sein (muss bestätigt werden).</p> <p>Ein einfacher, schmutziger, aber stabiler Workaround ist es, mailcow zu stoppen, <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data</code> zu entfernen und einen neuen Link zu Ihrem entfernten Dateisystem zu erstellen, zum Beispiel:</p> <pre><code>mv /var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data /var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data_backup\nln -s /mnt/volume-xy/vmail_data /var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data\n</code></pre> <p>Starten Sie anschließend mailcow.</p>","path":["U e dovecot vmail volume.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-vmail-volume.de/#der-alte-weg","level":2,"title":"Der \"alte\" Weg","text":"<p>Wenn man einen anderen Ordner für das vmail-Volume verwenden möchte, kann man eine <code>docker-compose.override.yml</code> Datei erstellen und den folgenden Inhalt hinzufügen:</p> <pre><code>volumes:\n  vmail-vol-1:\n    driver_opts:\n      type: none\n      device: /data/mailcow/vmail   \n      o: bind\n</code></pre>","path":["U e dovecot vmail volume.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-vmail-volume.de/#verschieben-eines-bestehenden-vmail-ordners","level":3,"title":"Verschieben eines bestehenden vmail-Ordners:","text":"<ul> <li>Finden Sie den aktuellen vmail-Ordner anhand seines \"Mountpoint\"-Attributs: <code>docker volume inspect mailcowdockerized_vmail-vol-1</code></li> </ul> <pre><code>[\n    {\n        \"CreatedAt\": \"2019-06-16T22:08:34+02:00\",\n        \"Driver\": \"local\",\n        \"Labels\": {\n            \"com.docker.compose.project\": \"mailcowdockerized\",\n            \"com.docker.compose.version\": \"1.23.2\",\n            \"com.docker.compose.volume\": \"vmail-vol-1\"\n        },\n        \"Mountpoint\": \"/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data\",\n        \"Name\": \"mailcowdockerized_vmail-vol-1\",\n        \"Options\": null,\n        \"Scope\": \"local\"\n    }\n]\n</code></pre> <ul> <li>Kopieren Sie den Inhalt des <code>Mountpoint</code>-Ordners an den neuen Speicherort (z.B. <code>/data/mailcow/vmail</code>) mit <code>cp -a</code>, <code>rsync -a</code> oder einem ähnlichen, nicht strikten Kopierbefehl</li> <li>Stoppen Sie mailcow durch Ausführen des kommenden Befehls aus Ihrem mailcow-Stammverzeichnis (z.B. <code>/opt/mailcow-dockerized</code>):</li> </ul> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\n</code></pre> <pre><code>docker-compose down    \n</code></pre> <ul> <li>Erstellen Sie die Datei <code>docker-compose.override.yml</code>, bearbeiten Sie den Gerätepfad entsprechend</li> <li>Löschen Sie den aktuellen vmail-Ordner: <code>docker volume rm mailcowdockerized_vmail-vol-1</code></li> <li>Starten Sie mailcow durch Ausführen des folgenden Befehls aus Ihrem mailcow-Stammverzeichnis (z.B. <code>/opt/mailcow-dockerized</code>):</li> </ul> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e dovecot vmail volume.de"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-vmail-volume.en/","level":1,"title":"U e dovecot vmail volume.en","text":"","path":["U e dovecot vmail volume.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-vmail-volume.en/#the-new-way","level":2,"title":"The \"new\" way","text":"<p>Warning</p> <p>Newer Docker versions seem to complain about existing volumes. You can fix this temporarily by removing the existing volume and start mailcow with the override file. But it seems to be problematic after a reboot (needs to be confirmed).</p> <p>An easy, dirty, yet stable workaround is to stop mailcow, remove <code>/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data</code> and create a new link to your remote filesystem location, for example:</p> <pre><code>mv /var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data /var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data_backup\nln -s /mnt/volume-xy/vmail_data /var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data\n</code></pre> <p>Start mailcow afterwards.</p>","path":["U e dovecot vmail volume.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-vmail-volume.en/#the-old-way","level":2,"title":"The \"old\" way","text":"<p>If you want to use another folder for the vmail-volume, you can create a <code>docker-compose.override.yml</code> file and add the following content:</p> <pre><code>volumes:\n  vmail-vol-1:\n    driver_opts:\n      type: none\n      device: /data/mailcow/vmail   \n      o: bind\n</code></pre>","path":["U e dovecot vmail volume.en"],"tags":[]},{"location":"manual-guides/Dovecot/u_e-dovecot-vmail-volume.en/#moving-an-existing-vmail-folder","level":3,"title":"Moving an existing vmail folder:","text":"<ul> <li>Locate the current vmail folder by its \"Mountpoint\" attribute: <code>docker volume inspect mailcowdockerized_vmail-vol-1</code></li> </ul> <pre><code>[\n    {\n        \"CreatedAt\": \"2019-06-16T22:08:34+02:00\",\n        \"Driver\": \"local\",\n        \"Labels\": {\n            \"com.docker.compose.project\": \"mailcowdockerized\",\n            \"com.docker.compose.version\": \"1.23.2\",\n            \"com.docker.compose.volume\": \"vmail-vol-1\"\n        },\n        \"Mountpoint\": \"/var/lib/docker/volumes/mailcowdockerized_vmail-vol-1/_data\",\n        \"Name\": \"mailcowdockerized_vmail-vol-1\",\n        \"Options\": null,\n        \"Scope\": \"local\"\n    }\n]\n</code></pre> <ul> <li>Copy the content of the <code>Mountpoint</code> folder to the new location (e.g. <code>/data/mailcow/vmail</code>) using <code>cp -a</code>, <code>rsync -a</code> or a similar non strcuture breaking copy command</li> <li>Stop mailcow by executing the following command from within your mailcow root folder (e.g. <code>/opt/mailcow-dockerized</code>):</li> </ul> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\n</code></pre> <pre><code>docker-compose down    \n</code></pre> <ul> <li>Create the file <code>docker-compose.override.yml</code>, edit the device path accordingly</li> <li>Delete the current vmail folder: <code>docker volume rm mailcowdockerized_vmail-vol-1</code></li> <li>Start mailcow by executing the following command from within your mailcow root folder (e.g. <code>/opt/mailcow-dockerized</code>):</li> </ul> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e dovecot vmail volume.en"],"tags":[]},{"location":"manual-guides/Nginx/u_e-nginx_custom.de/","level":1,"title":"U e nginx custom.de","text":"","path":["U e nginx custom.de"],"tags":[]},{"location":"manual-guides/Nginx/u_e-nginx_custom.de/#ssl","level":2,"title":"SSL","text":"<p>Bitte lesen Sie Erweitertes SSL und überprüfen Sie explizit <code>ADDITIONAL_SERVER_NAMES</code> für die SSL-Konfiguration.</p> <p>Bitte fügen Sie ADDITIONAL_SERVER_NAMES nicht hinzu, wenn Sie planen, einen anderen Web-Root zu verwenden.</p>","path":["U e nginx custom.de"],"tags":[]},{"location":"manual-guides/Nginx/u_e-nginx_custom.de/#neue-website","level":2,"title":"Neue Website","text":"<p>Um persistente (über Updates) Sites zu erstellen, die von mailcow: dockerized gehostet werden, muss eine neue Site-Konfiguration in <code>data/conf/nginx/</code> platziert werden:</p> <p>Eine gute Vorlage, um damit zu beginnen:</p> <pre><code>nano data/conf/nginx/my_custom_site.conf\n</code></pre> <pre><code>server {\n  ssl_certificate /etc/ssl/mail/cert.pem;\n  ssl_certificate_key /etc/ssl/mail/key.pem;\n  ssl_protocols TLSv1.2 TLSv1.3;\n  ssl_prefer_server_ciphers on;\n  ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305;\n  ssl_ecdh_curve X25519:X448:secp384r1:secp256k1;\n  ssl_session_cache shared:SSL:50m;\n  ssl_session_timeout 1d;\n  ssl_session_tickets off;\n  index index.php index.html;\n  client_max_body_size 0;\n  # Location: data/web\n  root /web;\n  # Location: data/web/mysite.com\n  #root /web/mysite.com\n  include /etc/nginx/conf.d/listen_plain.active;\n  include /etc/nginx/conf.d/listen_ssl.active;\n  server_name mysite.example.org;\n  server_tokens off;\n\n  # This allows acme to be validated even with a different web root\n  location ^~ /.well-known/acme-challenge/ {\n    default_type \"text/plain\";\n    rewrite /.well-known/acme-challenge/(.*) /$1 break;\n    root /web/.well-known/acme-challenge/;\n  }\n\n  if ($scheme = http) {\n    return 301 https://$server_name$request_uri;\n  }\n}\n</code></pre>","path":["U e nginx custom.de"],"tags":[]},{"location":"manual-guides/Nginx/u_e-nginx_custom.de/#neue-website-mit-proxy-zu-einem-entfernten-location","level":2,"title":"Neue Website mit Proxy zu einem entfernten Location","text":"<p>Ein weiteres Beispiel mit einer Reverse-Proxy-Konfiguration:</p> <pre><code>nano data/conf/nginx/my_custom_site.conf\n</code></pre> <pre><code>server {\n  ssl_certificate /etc/ssl/mail/cert.pem;\n  ssl_certificate_key /etc/ssl/mail/key.pem;\n  ssl_protocols TLSv1.2 TLSv1.3;\n  ssl_prefer_server_ciphers on;\n  ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305;\n  ssl_ecdh_curve X25519:X448:secp384r1:secp256k1;\n  ssl_session_cache shared:SSL:50m;\n  ssl_session_timeout 1d;\n  ssl_session_tickets off;\n  index index.php index.html;\n  client_max_body_size 0;\n  root /web;\n  include /etc/nginx/conf.d/listen_plain.active;\n  include /etc/nginx/conf.d/listen_ssl.active;\n  server_name example.domain.tld;\n  server_tokens off;\n\n  location ^~ /.well-known/acme-challenge/ {\n    allow all;\n    default_type \"text/plain\";\n  }\n\n  if ($scheme = http) {\n    return 301 https://$host$request_uri;\n  }\n\n  location / {\n    proxy_pass http://service:3000/;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    client_max_body_size 0;\n  }\n}\n</code></pre>","path":["U e nginx custom.de"],"tags":[]},{"location":"manual-guides/Nginx/u_e-nginx_custom.de/#konfig-erweiterung-in-mailcows-nginx","level":2,"title":"Konfig-Erweiterung in mailcows Nginx","text":"<p>Der Dateiname, der für eine neue Site verwendet wird, ist nicht wichtig, solange der Dateiname eine .conf-Erweiterung trägt.</p> <p>Es ist auch möglich, die Konfiguration der Standarddatei <code>site.conf</code> Datei zu erweitern:</p> <pre><code>nano data/conf/nginx/site.my_content.custom\n</code></pre> <p>Dieser Dateiname muss keine \".conf\"-Erweiterung haben, sondern folgt dem Muster <code>site.*.custom</code>, wobei <code>*</code> ein eigener Name ist.</p> <p>Wenn PHP in eine benutzerdefinierte Site eingebunden werden soll, verwenden Sie bitte den PHP-FPM-Listener auf phpfpm:9002 oder erstellen Sie einen neuen Listener in <code>data/conf/phpfpm/php-fpm.d/pools.conf</code>.</p> <p>Starten Sie Nginx neu (und PHP-FPM, falls ein neuer Listener erstellt wurde):</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart nginx-mailcow\ndocker compose restart php-fpm-mailcow\n</code></pre> <pre><code>docker-compose restart nginx-mailcow\ndocker-compose restart php-fpm-mailcow\n</code></pre>","path":["U e nginx custom.de"],"tags":[]},{"location":"manual-guides/Nginx/u_e-nginx_custom.en/","level":1,"title":"U e nginx custom.en","text":"","path":["U e nginx custom.en"],"tags":[]},{"location":"manual-guides/Nginx/u_e-nginx_custom.en/#ssl","level":2,"title":"SSL","text":"<p>Please see Advanced SSL and explicitly check <code>ADDITIONAL_SERVER_NAMES</code> for SSL configuration.</p> <p>Please do not add ADDITIONAL_SERVER_NAMES when you plan to use a different web root.</p>","path":["U e nginx custom.en"],"tags":[]},{"location":"manual-guides/Nginx/u_e-nginx_custom.en/#new-site","level":2,"title":"New site","text":"<p>To create persistent (over updates) sites hosted by mailcow: dockerized, a new site configuration must be placed inside <code>data/conf/nginx/</code>:</p> <p>A good template to begin with:</p> <pre><code>nano data/conf/nginx/my_custom_site.conf\n</code></pre> <pre><code>server {\n  ssl_certificate /etc/ssl/mail/cert.pem;\n  ssl_certificate_key /etc/ssl/mail/key.pem;\n  ssl_protocols TLSv1.2 TLSv1.3;\n  ssl_prefer_server_ciphers on;\n  ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305;\n  ssl_ecdh_curve X25519:X448:secp384r1:secp256k1;\n  ssl_session_cache shared:SSL:50m;\n  ssl_session_timeout 1d;\n  ssl_session_tickets off;\n  index index.php index.html;\n  client_max_body_size 0;\n  # Location: data/web\n  root /web;\n  # Location: data/web/mysite.com\n  #root /web/mysite.com\n  include /etc/nginx/conf.d/listen_plain.active;\n  include /etc/nginx/conf.d/listen_ssl.active;\n  server_name mysite.example.org;\n  server_tokens off;\n\n  # This allows acme to be validated even with a different web root\n  location ^~ /.well-known/acme-challenge/ {\n    default_type \"text/plain\";\n    rewrite /.well-known/acme-challenge/(.*) /$1 break;\n    root /web/.well-known/acme-challenge/;\n  }\n\n  if ($scheme = http) {\n    return 301 https://$server_name$request_uri;\n  }\n}\n</code></pre>","path":["U e nginx custom.en"],"tags":[]},{"location":"manual-guides/Nginx/u_e-nginx_custom.en/#new-site-with-proxy-to-a-remote-location","level":2,"title":"New site with proxy to a remote location","text":"<p>Another example with a reverse proxy configuration:</p> <pre><code>nano data/conf/nginx/my_custom_site.conf\n</code></pre> <pre><code>server {\n  ssl_certificate /etc/ssl/mail/cert.pem;\n  ssl_certificate_key /etc/ssl/mail/key.pem;\n  ssl_protocols TLSv1.2 TLSv1.3;\n  ssl_prefer_server_ciphers on;\n  ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305;\n  ssl_ecdh_curve X25519:X448:secp384r1:secp256k1;\n  ssl_session_cache shared:SSL:50m;\n  ssl_session_timeout 1d;\n  ssl_session_tickets off;\n  index index.php index.html;\n  client_max_body_size 0;\n  root /web;\n  include /etc/nginx/conf.d/listen_plain.active;\n  include /etc/nginx/conf.d/listen_ssl.active;\n  server_name example.domain.tld;\n  server_tokens off;\n\n  location ^~ /.well-known/acme-challenge/ {\n    allow all;\n    default_type \"text/plain\";\n  }\n\n  if ($scheme = http) {\n    return 301 https://$host$request_uri;\n  }\n\n  location / {\n    proxy_pass http://service:3000/;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    client_max_body_size 0;\n  }\n}\n</code></pre>","path":["U e nginx custom.en"],"tags":[]},{"location":"manual-guides/Nginx/u_e-nginx_custom.en/#config-expansion-in-mailcows-nginx","level":2,"title":"Config expansion in mailcows Nginx","text":"<p>The filename used for a new site is not important, as long as the filename carries a .conf extension.</p> <p>It is also possible to extend the configuration of the default file <code>site.conf</code> file:</p> <pre><code>nano data/conf/nginx/site.my_content.custom\n</code></pre> <p>This filename does not need to have a \".conf\" extension but follows the pattern <code>site.*.custom</code>, where <code>*</code> is a custom name.</p> <p>If PHP is to be included in a custom site, please use the PHP-FPM listener on phpfpm:9002 or create a new listener in <code>data/conf/phpfpm/php-fpm.d/pools.conf</code>.</p> <p>Restart Nginx (and PHP-FPM, if a new listener was created):</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart nginx-mailcow\ndocker compose restart php-fpm-mailcow\n</code></pre> <pre><code>docker-compose restart nginx-mailcow\ndocker-compose restart php-fpm-mailcow\n</code></pre>","path":["U e nginx custom.en"],"tags":[]},{"location":"manual-guides/Nginx/u_e-nginx_webmail-site.de/","level":1,"title":"U e nginx webmail site.de","text":"<p>WICHTIG: Diese Anleitung gilt nur für Konfigurationen, bei denen SNI nicht aktiviert ist. Wenn SNI aktiviert ist, muss der Zertifikatspfad angepasst werden. Etwas wie <code>ssl_certificate,key /etc/ssl/mail/webmail.example.org/cert.pem,key.pem;</code> wird genügen. Aber: Das Zertifikat sollte zuerst bezogen werden und erst wenn das Zertifikat existiert, sollte eine Site Config erstellt werden. Nginx wird nicht starten, wenn es das Zertifikat und den Schlüssel nicht finden kann.</p> <p>Um eine Subdomain <code>webmail.example.org</code> zu erstellen und sie auf SOGo umzuleiten, müssen Sie eine neue Nginx-Site erstellen. Achten Sie dabei auf \"CHANGE_TO_MAILCOW_HOSTNAME\"!</p> <p>nano data/conf/nginx/webmail.conf</p> <pre><code>server {\n  ssl_certificate /etc/ssl/mail/cert.pem;\n  ssl_certificate_key /etc/ssl/mail/key.pem;\n  index index.php index.html;\n  client_max_body_size 0;\n  root /web;\n  include /etc/nginx/conf.d/listen_plain.active;\n  include /etc/nginx/conf.d/listen_ssl.active;\n  server_name webmail.example.org;\n  server_tokens off;\n  location ^~ /.well-known/acme-challenge/ {\n    allow all;\n    default_type \"text/plain\";\n  }\n\n  location / {\n    return 301 https://CHANGE_TO_MAILCOW_HOSTNAME/SOGo;\n  }\n}\n</code></pre> <p>Speichern Sie und starten Sie Nginx neu: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose restart nginx-mailcow\n</code></pre> <p>Öffnen Sie nun <code>mailcow.conf</code> und suchen Sie <code>ADDITIONAL_SAN</code>. Fügen Sie <code>webmail.example.org</code> zu diesem Array hinzu, verwenden Sie keine Anführungszeichen!</p> <pre><code>ADDITIONAL_SAN=webmail.example.org\n</code></pre> <p>Führen Sie den Befehl aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Siehe \"acme-mailcow\" und \"nginx-mailcow\" Logs, wenn etwas fehlschlägt</p>","path":["U e nginx webmail site.de"],"tags":[]},{"location":"manual-guides/Nginx/u_e-nginx_webmail-site.en/","level":1,"title":"U e nginx webmail site.en","text":"<p>IMPORTANT: This guide only applies to non SNI enabled configurations. The certificate path needs to be adjusted if SNI is enabled. Something like <code>ssl_certificate,key /etc/ssl/mail/webmail.example.org/cert.pem,key.pem;</code> will do. But: The certificate should be acquired first and only after the certificate exists a site config should be created. Nginx will fail to start if it cannot find the certificate and key.</p> <p>To create a subdomain <code>webmail.example.org</code> and redirect it to SOGo, you need to create a new Nginx site. Take care of \"CHANGE_TO_MAILCOW_HOSTNAME\"!</p> <p>nano data/conf/nginx/webmail.conf</p> <pre><code>server {\n  ssl_certificate /etc/ssl/mail/cert.pem;\n  ssl_certificate_key /etc/ssl/mail/key.pem;\n  index index.php index.html;\n  client_max_body_size 0;\n  root /web;\n  include /etc/nginx/conf.d/listen_plain.active;\n  include /etc/nginx/conf.d/listen_ssl.active;\n  server_name webmail.example.org;\n  server_tokens off;\n  location ^~ /.well-known/acme-challenge/ {\n    allow all;\n    default_type \"text/plain\";\n  }\n\n  location / {\n    return 301 https://CHANGE_TO_MAILCOW_HOSTNAME/SOGo;\n  }\n}\n</code></pre> <p>Save and restart Nginx: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose restart nginx-mailcow\n</code></pre> <p>Now open <code>mailcow.conf</code> and find <code>ADDITIONAL_SAN</code>. Add <code>webmail.example.org</code> to this array, don't use quotes!</p> <pre><code>ADDITIONAL_SAN=webmail.example.org\n</code></pre> <p>Run the command to apply the changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>See \"acme-mailcow\" and \"nginx-mailcow\" logs if anything fails.</p>","path":["U e nginx webmail site.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-attachment_size.de/","level":1,"title":"U e postfix attachment size.de","text":"<p>Öffnen Sie <code>data/conf/postfix/extra.cf</code> und setzen Sie das <code>message_size_limit</code> entsprechend in Bytes. Siehe <code>main.cf</code> für den Standardwert.</p> <p>Sie müssen auch die Nachrichtengröße in den Konfigurationen von Rspamd und Clamav anpassen:</p> <ul> <li>in <code>data/conf/rspamd/local.d/options.inc</code> fügen Sie den <code>max_message</code> Parameter entsprechend den im Postfix gesetzten Wert hinzu. Ziehen Sie die Rspamd Docs für den Standardwert zu rate.</li> <li>in <code>data/conf/rspamd/local.d/external_services.conf</code> ändern Sie den Wert <code>max_size</code> Parameter für <code>oletools</code></li> <li>in <code>data/conf/rspamd/local.d/antivirus.conf</code> ändern Sie den Wert <code>max_size</code> Parameter für <code>clamav</code></li> <li>in <code>data/conf/clamav/clamd.conf</code> ändern Sie den Wert <code>MaxScanSize</code> und <code>MaxFileSize</code> auf dieselbe Größe wie in der Postfix <code>extra.cf</code></li> </ul> <p>Starten Sie Postfix, Rspamd and Clamav neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow rspamd-mailcow clamd-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow rspamd-mailcow clamd-mailcow\n</code></pre>","path":["U e postfix attachment size.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-attachment_size.en/","level":1,"title":"U e postfix attachment size.en","text":"<p>Open <code>data/conf/postfix/extra.cf</code> and set the <code>message_size_limit</code> accordingly in bytes. See <code>main.cf</code> for the default value.</p> <p>You will also need to adjust message size in Rspamd and Clamav configurations:</p> <ul> <li>in <code>data/conf/rspamd/local.d/options.inc</code> add <code>max_message</code> parameter, check Rspamd Docs for defaults</li> <li>in <code>data/conf/rspamd/local.d/external_services.conf</code> adjust <code>max_size</code> parameter for <code>oletools</code></li> <li>in <code>data/conf/rspamd/local.d/antivirus.conf</code> adjust <code>max_size</code> parameter for <code>clamav</code></li> <li>in <code>data/conf/clamav/clamd.conf</code> adjust <code>MaxScanSize</code> and <code>MaxFileSize</code></li> </ul> <p>Restart Postfix, Rspamd and Clamav:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow rspamd-mailcow clamd-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow rspamd-mailcow clamd-mailcow\n</code></pre>","path":["U e postfix attachment size.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-custom_transport.de/","level":1,"title":"U e postfix custom transport.de","text":"<p>Für Transport maps, die nicht in mailcow UI konfiguriert werden, verwenden Sie bitte <code>data/conf/postfix/custom_transport.pcre</code>, um zu verhindern, dass bestehende Maps oder Einstellungen durch Updates überschrieben werden.</p> <p>In den meisten Fällen ist die Verwendung dieser Datei nicht notwendig. Bitte vergewissern Sie sich, dass mailcow UI nicht in der Lage ist, den gewünschten Datenverkehr richtig zu routen, bevor Sie diese Datei verwenden.</p> <p>Die Datei benötigt gültigen PCRE-Inhalt und kann Postfix zerstören, wenn sie falsch konfiguriert ist.</p>","path":["U e postfix custom transport.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-custom_transport.en/","level":1,"title":"U e postfix custom transport.en","text":"<p>For transport maps other than those to be configured in mailcow UI, please use <code>data/conf/postfix/custom_transport.pcre</code> to prevent existing maps or settings from being overwritten by updates.</p> <p>In most cases using this file is not necessary. Please make sure mailcow UI is not able to route your desired traffic properly before using that file.</p> <p>The file needs valid PCRE content and can break Postfix, if configured incorrectly.</p>","path":["U e postfix custom transport.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-disable_sender_verification.de/","level":1,"title":"U e postfix disable sender verification.de","text":"","path":["U e postfix disable sender verification.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-disable_sender_verification.de/#neue-anleitung","level":2,"title":"Neue Anleitung","text":"<p>Bearbeiten Sie ein Postfach und wählen Sie \"Senden als * zulassen\".</p> <p>Aus historischen Gründen haben wir die alte und veraltete Anleitung unten beibehalten:</p>","path":["U e postfix disable sender verification.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-disable_sender_verification.de/#veraltete-anleitung-nicht-fur-neuere-mailcows-verwenden","level":2,"title":"Veraltete Anleitung (NICHT FÜR NEUERE MAILCOWS VERWENDEN!)","text":"<p>Diese Option ist keine Best-Practice und sollte nur verwendet werden, wenn es keine andere Möglichkeit gibt, das zu erreichen, was Sie erreichen wollen.</p> <p>Erstellen Sie einfach eine Datei <code>data/conf/postfix/check_sasl_access</code> und tragen Sie den folgenden Inhalt ein. Dieser Benutzer muss in Ihrer Installation existieren und muss sich vor dem Versenden von Mails authentifizieren. <pre><code>user-to-allow-everything@example.com OK\n</code></pre></p> <p>Öffnen Sie <code>data/conf/postfix/main.cf</code> und suchen Sie <code>smtpd_sender_restrictions</code>. Fügen Sie <code>check_sasl_access hash:/opt/postfix/conf/check_sasl_access</code> wie folgt ein: <pre><code>smtpd_sender_restrictions = check_sasl_access hash:/opt/postfix/conf/check_sasl_access reject_authenticated_sender_login_mismatch [...]\n</code></pre></p> <p>Postmap auf check_sasl_access ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec postfix-mailcow postmap /opt/postfix/conf/check_sasl_access\n</code></pre> <pre><code>docker-compose exec postfix-mailcow postmap /opt/postfix/conf/check_sasl_access\n</code></pre> <p>Starten Sie den Postfix-Container neu.</p>","path":["U e postfix disable sender verification.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-disable_sender_verification.en/","level":1,"title":"U e postfix disable sender verification.en","text":"","path":["U e postfix disable sender verification.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-disable_sender_verification.en/#new-guide","level":2,"title":"New guide","text":"<p>Edit a mailbox and select \"Allow to send as *\".</p> <p>For historical reasons we kept the old and deprecated guide below:</p>","path":["U e postfix disable sender verification.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-disable_sender_verification.en/#deprecated-guide-do-not-use-on-newer-mailcows","level":2,"title":"Deprecated guide (DO NOT USE ON NEWER MAILCOWS!)","text":"<p>This option is not best-practice and should only be implemented when there is no other option available to achieve whatever you are trying to do.</p> <p>Simply create a file <code>data/conf/postfix/check_sasl_access</code> and enter the following content. This user must exist in your installation and needs to authenticate before sending mail. <pre><code>user-to-allow-everything@example.com OK\n</code></pre></p> <p>Open <code>data/conf/postfix/main.cf</code> and find <code>smtpd_sender_restrictions</code>. Prepend <code>check_sasl_access hash:/opt/postfix/conf/check_sasl_access</code> like this: <pre><code>smtpd_sender_restrictions = check_sasl_access hash:/opt/postfix/conf/check_sasl_access reject_authenticated_sender_login_mismatch [...]\n</code></pre></p> <p>Run postmap on check_sasl_access:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec postfix-mailcow postmap /opt/postfix/conf/check_sasl_access\n</code></pre> <pre><code>docker-compose exec postfix-mailcow postmap /opt/postfix/conf/check_sasl_access\n</code></pre> <p>Restart the Postfix container.</p>","path":["U e postfix disable sender verification.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-extra_cf.de/","level":1,"title":"U e postfix extra cf.de","text":"<p>Bitte erstellen Sie eine neue Datei <code>data/conf/postfix/extra.cf</code> für Überschreibungen oder zusätzliche Inhalte zur <code>main.cf</code>.</p> <p>Postfix wird sich einmal nach dem Start von postfix-mailcow über doppelte Werte beschweren, dies ist beabsichtigt.</p> <p>Syslog-ng wurde so konfiguriert, dass es diese Warnungen ausblendet, während Postfix läuft, um die Log-Dateien nicht jedes Mal mit unnötigen Informationen zu spammen, wenn ein Dienst benutzt wird.</p> <p>Starten Sie <code>postfix-mailcow</code> neu, um Ihre Änderungen zu übernehmen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow\n</code></pre>","path":["U e postfix extra cf.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-extra_cf.en/","level":1,"title":"U e postfix extra cf.en","text":"<p>Please create a new file <code>data/conf/postfix/extra.cf</code> for overrides or additional content to <code>main.cf</code>.</p> <p>Postfix will complain about duplicate values once after starting <code>postfix-mailcow</code>, this is intended.</p> <p>Syslog-ng was configured to hide those warnings while Postfix is running, to not spam the log files with unnecessary information every time a service is used.</p> <p>Restart <code>postfix-mailcow</code> to apply your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow\n</code></pre>","path":["U e postfix extra cf.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-harden_ciphers.de/","level":1,"title":"U e postfix harden ciphers.de","text":"<p>Wenn Sie die Standard-Cipher und TLS-Versionen, die in Postfix akzeptiert werden, entsprechend der aktuellen Version auf stärkere Einstellungen ändern möchten, können Sie Folgendes zu Postfix extra.cf hinzufügen:</p> <pre><code>tls_high_cipherlist = ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256\ntls_preempt_cipherlist = yes\n\nsmtp_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1\nsmtp_tls_ciphers = high\nsmtp_tls_mandatory_ciphers = high\n\nsmtpd_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1\nsmtpd_tls_ciphers = high\nsmtpd_tls_mandatory_ciphers = high\n</code></pre> <p>Eine solche Konfiguration wird die aktuellen (2024-10-21) Konfigurationsprüfungen bei Diensten wie Internet.nl bestehen.</p> <p>Falls Sie auch die Cipher für Dovecot anpassen wollen finden Sie hier eine entsprechende Anleitung.</p>","path":["U e postfix harden ciphers.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-harden_ciphers.en/","level":1,"title":"U e postfix harden ciphers.en","text":"<p>If you want to change the default ciphers and TLS versions accepted in postfix as per it's current release to something stronger, you could add following inside Postfix extra.cf:</p> <pre><code>tls_high_cipherlist = ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256\ntls_preempt_cipherlist = yes\n\nsmtp_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1\nsmtp_tls_ciphers = high\nsmtp_tls_mandatory_ciphers = high\n\nsmtpd_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1\nsmtpd_tls_ciphers = high\nsmtpd_tls_mandatory_ciphers = high\n</code></pre> <p>Such a configuration will pass current (2024-10-21) configuration checks against services like Internet.nl.</p> <p>If you want to adjust the ciphers for Dovecot as well you can find the corresponding tutorial here.</p>","path":["U e postfix harden ciphers.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-pflogsumm.de/","level":1,"title":"U e postfix pflogsumm.de","text":"<p>Um pflogsumm mit dem Standard-Logging-Treiber zu verwenden, müssen wir postfix-mailcow über docker logs abfragen und die Ausgabe zu pflogsumm leiten:</p> <pre><code>docker logs --since 24h $(docker ps -qf name=postfix-mailcow) | pflogsumm\n</code></pre> <p>Die obige Log-Ausgabe ist auf die letzten 24 Stunden beschränkt.</p> <p>Es ist auch möglich, einen täglichen pflogsumm-Bericht über cron zu erstellen. Erstellen Sie die Datei /etc/cron.d/pflogsumm mit dem folgenden Inhalt:</p> <pre><code>SHELL=/bin/bash\n59 23 * * * root docker logs --since 24h $(docker ps -qf name=postfix-mailcow) | /usr/sbin/pflogsumm -d today | mail -s \"Postfix Report of $(date)\" postmaster@example.net\n</code></pre> <p>Um zu funktionieren muss ein lokaler Postfix auf dem Server installiert werden, welcher an den Postfix der mailcow relayed.</p> <p>Frage</p> <p>Genauere Informationen lassen sich unter Sektion Post-Installationsaufgaben -&gt; Lokaler MTA auf Dockerhost finden.</p> <p>Basierend auf den Postfix-Logs der letzten 24 Stunden sendet dieses Beispiel dann jeden Tag um 23:59:00 Uhr einen pflogsumm-Bericht an postmaster@example.net.</p>","path":["U e postfix pflogsumm.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-pflogsumm.en/","level":1,"title":"U e postfix pflogsumm.en","text":"<p>To use pflogsumm with the default logging driver, we need to query postfix-mailcow via docker logs and direct the output to pflogsumm:</p> <pre><code>docker logs --since 24h $(docker ps -qf name=postfix-mailcow) | pflogsumm\n</code></pre> <p>The above log output is limited to the last 24 hours.</p> <p>It is also possible to create a daily pflogsumm report via cron. Create the /etc/cron.d/pflogsumm file with the following content:</p> <pre><code>SHELL=/bin/bash\n59 23 * * * root docker logs --since 24h $(docker ps -qf name=postfix-mailcow) | /usr/sbin/pflogsumm -d today | mail -s \"Postfix Report of $(date)\" postmaster@example.net\n</code></pre> <p>To work, a local postfix must be installed on the server, which relays to the mailcow postfix.</p> <p>Question</p> <p>More detailed information can be found in section Post installation tasks -&gt; Local MTA on Dockerhost.</p> <p>Based on the postfix logs of the last 24 hours, this example then sends a pflogsumm report to postmaster@example.net every day at 23:59:00.</p>","path":["U e postfix pflogsumm.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-postscreen_whitelist.de/","level":1,"title":"U e postfix postscreen whitelist.de","text":"<p>IPs können in der Datei <code>data/conf/postfix/custom_postscreen_whitelist.cidr</code> aus dem Postscreen und damit auch aus den RBL-Prüfungen entfernt werden.</p> <p>Postscreen führt mehrere Prüfungen durch, um bösartige Absender zu identifizieren. In den meisten Fällen möchten Sie eine IP-Adresse auf die Whitelist setzen, um sie von der Suche nach einer Blacklist auszuschließen.</p> <p>Das Format der Datei ist wie folgt</p> <p><code>CIDR ACTION</code></p> <p>Dabei steht CIDR für eine einzelne IP-Adresse oder einen IP-Bereich in CIDR-Notation und action entweder für \"permit\" oder \"reject\".</p> <p>Beispiel:</p> <pre><code># Regeln werden in der angegebenen Reihenfolge ausgewertet.\n# Blacklist 192.168.* außer 192.168.0.1.\n192.168.0.1 permit\n192.168.0.0/16 reject\n</code></pre> <p>Die Datei wird spontan neu geladen, ein Neustart von Postfix ist nicht erforderlich.</p>","path":["U e postfix postscreen whitelist.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-postscreen_whitelist.en/","level":1,"title":"U e postfix postscreen whitelist.en","text":"<p>IPs can be removed from Postscreen and therefore also from RBL checks in <code>data/conf/postfix/custom_postscreen_whitelist.cidr</code>.</p> <p>Postscreen does multiple checks to identify malicious senders. In most cases you want to whitelist an IP to exclude it from blacklist lookups.</p> <p>The format of the file is as follows:</p> <p><code>CIDR   ACTION</code></p> <p>Where CIDR is a single IP address or IP range in CIDR notation, and action is either \"permit\" or \"reject\".</p> <p>Example:</p> <pre><code># Rules are evaluated in the order as specified.\n# Blacklist 192.168.* except 192.168.0.1.\n192.168.0.1          permit\n192.168.0.0/16       reject\n</code></pre> <p>The file is reloaded on the fly, postfix restart is not required.</p>","path":["U e postfix postscreen whitelist.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-relayhost.de/","level":1,"title":"U e postfix relayhost.de","text":"<p>Seit dem 12. September 2018 können Sie Relayhosts als Admin über die mailcow UI einrichten.</p> <p>Dies ist nützlich, wenn Sie ausgehende E-Mails für eine bestimmte Domain an einen Drittanbieter-Spamfilter oder einen Dienst wie Mailgun oder Sendgrid weiterleiten möchten. Dies ist auch bekannt als ein smarthost. Falls nicht, überprüfen Sie den Fehler und beheben Sie ihn.</p>","path":["U e postfix relayhost.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-relayhost.de/#einen-neuen-relayhost-hinzufugen","level":2,"title":"Einen neuen Relayhost hinzufügen","text":"<p>Gehen Sie auf die Registerkarte \"Routing\" im Abschnitt \"Konfiguration und Details\" der mailcow UI. Hier sehen Sie eine Liste der derzeit eingerichteten Relayhosts.</p> <p>Blättern Sie zum Abschnitt \"Absenderabhängigen Transport hinzufügen\".</p> <p>Fügen Sie unter <code>Host</code> den Host hinzu, an den Sie weiterleiten möchten. Beispiel: Wenn Sie Mailgun zum Senden von E-Mails anstelle Ihrer Server-IP verwenden möchten, geben Sie smtp.mailgun.org ein.</p> <p>Wenn der Relay-Host zur Authentifizierung einen Benutzernamen und ein Passwort benötigt, geben Sie diese in die entsprechenden Felder ein. Beachten Sie, dass die Anmeldedaten im Klartext gespeichert werden.</p>","path":["U e postfix relayhost.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-relayhost.de/#testen-sie-einen-relayhost","level":3,"title":"Testen Sie einen Relayhost","text":"<p>Um zu testen, ob die Verbindung zum Host funktioniert, klicken Sie in der Liste der Relayhosts auf <code>Test</code> und geben Sie eine Von:-Adresse ein. Führen Sie dann den Test aus.</p> <p>Sie sehen dann die Ergebnisse der SMTP-Übertragung. Wenn alles klappt, sollten Sie Folgendes sehen: <code>SERVER -&gt; CLIENT: 250 2.0.0 Ok: queued as A093B401D4</code> als eine der letzten Zeilen.</p> <p>Ist dies nicht der Fall, überprüfen Sie den angegebenen Fehler und beheben Sie ihn.</p> <p>Hinweis: Einige Hosts, insbesondere solche, die keine Authentifizierung verlangen, verweigern Verbindungen von Servern, die nicht zuvor in ihr System aufgenommen wurden. Lesen Sie unbedingt die Dokumentation des Relayhosts, um sicherzustellen, dass Sie Ihre Domain und/oder die Server-IP zu ihrem System hinzugefügt haben.</p> <p>Tipp: Sie können die standardmäßige Von:-Adresse, die der Test verwendet, von null@mailcow.email auf eine beliebige E-Mail-Adresse ändern, indem Sie die Variable $RELAY_TO in der Datei vars.inc.php unter /opt/mailcow-dockerized/data/web/inc ändern.  Auf diese Weise können Sie überprüfen, ob das Relay funktioniert hat, indem Sie das Zielpostfach überprüfen.</p>","path":["U e postfix relayhost.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-relayhost.de/#relayhost-fur-eine-domain-festlegen","level":2,"title":"Relayhost für eine Domain festlegen","text":"<p>Wechseln Sie auf die Registerkarte \"Domains\" im Abschnitt \"E-Mail-Setup\" der mailcow UI.</p> <p>Bearbeiten Sie die gewünschte Domain.</p> <p>Wählen Sie den neu hinzugefügten Host in der Dropdown-Liste \"Absenderabhängige Transporte\" aus und speichern Sie die Änderungen.</p> <p>Senden Sie eine E-Mail von einer Mailbox auf dieser Domain und Sie sollten in den Protokollen sehen, dass Postfix die Nachricht an den Relayhost weiterleitet.</p>","path":["U e postfix relayhost.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-relayhost.en/","level":1,"title":"U e postfix relayhost.en","text":"<p>As of September 12, 2018 you can setup relayhosts as admin by using the mailcow UI.</p> <p>This is useful if you want to relay outgoing emails for a specific domain to a third-party spam filter or a service like Mailgun or Sendgrid. This is also known as a smarthost.</p>","path":["U e postfix relayhost.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-relayhost.en/#add-a-new-relayhost","level":2,"title":"Add a new relayhost","text":"<p>Go to the <code>Routing</code> tab of the <code>Configuration and Details</code> section of the admin UI. Here you will see a list of relayhosts currently setup.</p> <p>Scroll to the <code>Add sender-dependent transport</code> section.</p> <p>Under <code>Host</code>, add the host you want to relay to.  Example: if you want to use Mailgun to send emails instead of your server IP, enter smtp.mailgun.org</p> <p>If the relay host requires a username and password to authenticate, enter them in the respective fields.  Keep in mind the credentials will be stored in plain text.</p>","path":["U e postfix relayhost.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-relayhost.en/#test-a-relayhost","level":3,"title":"Test a relayhost","text":"<p>To test that connectivity to the host works, click on <code>Test</code> from the list of relayhosts and enter a From: address. Then, run the test.</p> <p>You will then see the results of the SMTP transmission. If all went well, you should see <code>SERVER -&gt; CLIENT: 250 2.0.0 Ok: queued as A093B401D4</code> as one of the last lines.</p> <p>If not, review the error provided and resolve it.</p> <p>Note: Some hosts, especially those who do not require authentication, will deny connections from servers that have not been added to their system beforehand. Make sure you read the documentation of the relayhost to make sure you've added your domain and/or the server IP to their system.</p> <p>Tip: You can change the default test To: address the test uses from null@mailcow.email to any email address you choose by modifying the $RELAY_TO variable on the vars.inc.php file under /opt/mailcow-dockerized/data/web/inc  This way you can check that the relay worked by checking the destination mailbox.</p>","path":["U e postfix relayhost.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-relayhost.en/#set-the-relayhost-for-a-domain","level":2,"title":"Set the relayhost for a domain","text":"<p>Go to the <code>Domains</code> tab of the <code>Mail setup</code> section of the admin UI.</p> <p>Edit the desired domain.</p> <p>Select the newly added host on the <code>Sender-dependent transports</code> dropdown and save changes.</p> <p>Send an email from a mailbox on that domain and you should see postfix handing the message over to the relayhost in the logs.</p>","path":["U e postfix relayhost.en"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-unauthenticated-relaying.de/","level":1,"title":"U e postfix unauthenticated relaying.de","text":"<p>Standardmäßig betrachtet mailcow's Postfix alle Netzwerke als nicht vertrauenswürdig, ausgenommen seine eigenen IPV4_NETWORK und IPV6_NETWORK Bereiche, die in <code>mailcow.conf</code> festgelegt sind. Obwohl dies in den meisten Fällen vernünftig ist, kann es Umstände geben, unter denen Sie einen Host oder ein Subnetz als unauthentifizierten Relayer hinzufügen möchten.</p> <p>Standardmäßig verwendet mailcow <code>mynetworks_style = subnet</code> um interne Subnetze zu bestimmen und lässt <code>mynetworks</code> unkonfiguriert.</p> <p>Wenn Sie sich entscheiden, <code>mynetworks</code> selbständig in der <code>extra.conf</code> von Postfix zu setzen, ignoriert Postfix die mynetworks_style Einstellung. Das bedeutet, dass Sie die von mailcow intern benutzen IPv4- und IPv6-Adressen (in der <code>mailcow.conf</code> angegeben als IPV4_NETWORK bzw. IPV6_NETWORK), sowie die Loopback-Subnetze manuell hinzufügen müssen!</p> <p>Erläuterung</p> <p>Die Einstellung <code>mynetworks</code> erlaubt es eingetragenen Hosts bzw. Subnets OHNE Authentifizierung E-Mails an den Postfix MTA zu schicken. Insbesondere dann praktisch, wenn bspw. Monitoring E-Mails von Linux Servern im selben Netzwerk ohne extra Authentifizierung verschickt werden sollen.</p> <p>Achtung</p> <p>Eine falsche Einstellung von <code>mynetworks</code> erlaubt es Ihrem Server, als offenes Relay verwendet zu werden. Wenn dies missbraucht wird, beeinträchtigt dies Ihre Fähigkeit, E-Mails zu versenden, und es kann einige Zeit dauern, bis dies abgeklungen ist.</p> <p>Beispiel</p> <p>Als Beispiel nehmen wir das Subnetz <code>192.168.2.0/24</code>, welches wir unauthentifiziert Relayen lassen wollen.</p> <p>Bearbeiten Sie <code>data/conf/postfix/extra.cf</code>:</p> <pre><code>mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 [fe80::]/10 172.22.1.0/24 [fd4d:6169:6c63:6f77::]/64 192.168.2.0/24\n</code></pre> <p>Bearbeiten Sie zusätzlich noch <code>data/conf/rspamd/local.d/options.inc</code>:</p> <pre><code>local_addrs = [127.0.0.0/8, ::ffff:127.0.0.0/104, ::1/128, fe80::/10, 172.22.1.0/24, fd4d:6169:6c63:6f77::/64, 192.168.2.0/24];\n</code></pre> <p>Vorsicht</p> <p>Die Subnetze vor unserem angehangenen Beispiel Subnetz MÜSSEN vor oder nach den eigens eingetragenen Werten stehen, da sonst einige mailcow Komponenten wie bspw. der Watchdog oder einige Sieve Filter (wie bspw. Abwesenheitsagenten) nicht funktionieren und Fehler beim Betriebsablauf entstehen.</p> <p>Führen Sie nach Ihren Änderungen folgenden Befehl aus aus, um Ihre neuen Einstellungen zu übernehmen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow rspamd-mailcow\n</code></pre> <p>Gut zu wissen!</p> <p>IPv6 Adressen MÜSSEN in diesem Fall mit <code>[]</code> (Eckigen Klammern) als <code>mynetworks</code> Parameter eingetragen werden, da diese sonst nicht verarbeitet werden können.</p> <p>Info</p> <p>Weitere Informationen über mynetworks finden Sie in der Postfix-Dokumentation.</p>","path":["U e postfix unauthenticated relaying.de"],"tags":[]},{"location":"manual-guides/Postfix/u_e-postfix-unauthenticated-relaying.en/","level":1,"title":"U e postfix unauthenticated relaying.en","text":"<p>By default, mailcow's postfix considers all networks untrusted except its own IPV4_NETWORK and IPV6_NETWORK ranges, which are specified in <code>mailcow.conf</code>. Although this is reasonable in most cases, there may be circumstances where you want to add a host or subnet as an unauthenticated relayer.</p> <p>By default, mailcow uses <code>mynetworks_style = subnet</code> to specify internal subnets and leaves <code>mynetworks</code> unconfigured.</p> <p>If you decide to set <code>mynetworks</code> independently in Postfix's <code>extra.conf</code>, Postfix will ignore the mynetworks_style setting. This means that you will have to add the IPv4 and IPv6 addresses used internally by mailcow (specified in <code>mailcow.conf</code> as IPV4_NETWORK and IPV6_NETWORK respectively), as well as the loopback subnets manually!</p> <p>Explanation</p> <p>The setting <code>mynetworks</code> allows registered hosts or subnets to send e-mails to the Postfix MTA WITHOUT authentication. This is especially useful if monitoring e-mails are to be sent from Linux servers in the same network without extra authentication.</p> <p>Danger</p> <p>A wrong setting of <code>mynetworks</code> allows your server to be used as an open relay. If this is abused, it will impair your ability to send email and it may take some time for this to subside.</p> <p>Example</p> <p>As an example, let's take the subnet <code>192.168.2.0/24</code>, which we want to relay unauthenticated.</p> <p>Edit <code>data/conf/postfix/extra.cf</code>:</p> <pre><code>mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 [fe80::]/10 172.22.1.0/24 [fd4d:6169:6c63:6f77::]/64 192.168.2.0/24\n</code></pre> <p>Edit <code>data/conf/rspamd/local.d/options.inc</code> aswell:</p> <pre><code>local_addrs = [127.0.0.0/8, ::ffff:127.0.0.0/104, ::1/128, fe80::/10, 172.22.1.0/24, fd4d:6169:6c63:6f77::/64, 192.168.2.0/24];\n</code></pre> <p>Warning</p> <p>The subnets before our attached example subnet MUST exists before or after your entered values. Otherwise some mailcow components such as Watchdog or some Sieve Filters (such as Absence Agents) will not work and errors will occur during operation.</p> <p>Run the following command to apply your new settings:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow rspamd-mailcow\n</code></pre> <p>Good to know!</p> <p>IPv6 addresses MUST be entered with <code>[]</code> (square brackets) as <code>mynetworks</code> parameters in this case. Otherwise they cannot be processed.</p> <p>Info</p> <p>More information about mynetworks can be found in the Postfix documentation.</p>","path":["U e postfix unauthenticated relaying.en"],"tags":[]},{"location":"manual-guides/Redis/u_e-redis.de/","level":1,"title":"U e redis.de","text":"<p>Redis wird als Key-Value-Speicher für die Einstellungen und Daten von rspamd und (einige von) mailcow verwendet. Wenn Sie mit Redis nicht vertraut sind, lesen Sie bitte die Einführung in Redis und besuchen Sie gegebenenfalls diese wunderbare Anleitung, um zu erfahren, wie man Redis benutzt.</p>","path":["U e redis.de"],"tags":[]},{"location":"manual-guides/Redis/u_e-redis.de/#client","level":2,"title":"Client","text":"<p>Um sich mit dem redis cli zu verbinden, führen Sie aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli\n</code></pre>","path":["U e redis.de"],"tags":[]},{"location":"manual-guides/Redis/u_e-redis.de/#fehlersuche","level":3,"title":"Fehlersuche","text":"<p>Hier sind einige nützliche Befehle für den redis-cli zur Fehlersuche:</p>","path":["U e redis.de"],"tags":[]},{"location":"manual-guides/Redis/u_e-redis.de/#monitor","level":5,"title":"MONITOR","text":"<p>Überwacht alle vom Server empfangenen Anfragen in Echtzeit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>#docker compose exec redis-mailcow redis-cli\n127.0.0.1:6379&gt; monitor\nOK\n1494077286.401963 [0 172.22.1.253:41228] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n1494077288.292970 [0 172.22.1.253:41229] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n[...]\n</code></pre> <pre><code>#docker-compose exec redis-mailcow redis-cli\n127.0.0.1:6379&gt; monitor\nOK\n1494077286.401963 [0 172.22.1.253:41228] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n1494077288.292970 [0 172.22.1.253:41229] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n[...]\n</code></pre>","path":["U e redis.de"],"tags":[]},{"location":"manual-guides/Redis/u_e-redis.de/#schlussel-keys","level":5,"title":"SCHLÜSSEL (Keys)","text":"<p>Ermittelt alle Schlüssel, die dem Muster entsprechen:</p> <pre><code>KEYS *\n</code></pre>","path":["U e redis.de"],"tags":[]},{"location":"manual-guides/Redis/u_e-redis.de/#ping","level":5,"title":"PING","text":"<p>Testen Sie eine Verbindung:</p> <pre><code>127.0.0.1:6379&gt; PING\nPONG\n</code></pre> <p>Wenn Sie mehr wissen wollen, hier ist ein Cheat-Sheet.</p>","path":["U e redis.de"],"tags":[]},{"location":"manual-guides/Redis/u_e-redis.en/","level":1,"title":"U e redis.en","text":"<p>Redis is used as a key-value store for rspamd's and (some of) mailcow's settings and data. If you are unfamiliar with redis please read the introduction to redis and maybe visit this wonderful guide on how to use it.</p>","path":["U e redis.en"],"tags":[]},{"location":"manual-guides/Redis/u_e-redis.en/#client","level":2,"title":"Client","text":"<p>To connect to the redis cli execute:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli\n</code></pre>","path":["U e redis.en"],"tags":[]},{"location":"manual-guides/Redis/u_e-redis.en/#debugging","level":3,"title":"Debugging","text":"<p>Here are some useful commands for the redis-cli for debugging:</p>","path":["U e redis.en"],"tags":[]},{"location":"manual-guides/Redis/u_e-redis.en/#monitor","level":5,"title":"MONITOR","text":"<p>Listens for all requests received by the server in real time:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>#docker compose exec redis-mailcow redis-cli\n127.0.0.1:6379&gt; monitor\nOK\n1494077286.401963 [0 172.22.1.253:41228] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n1494077288.292970 [0 172.22.1.253:41229] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n[...]\n</code></pre> <pre><code>#docker-compose exec redis-mailcow redis-cli\n127.0.0.1:6379&gt; monitor\nOK\n1494077286.401963 [0 172.22.1.253:41228] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n1494077288.292970 [0 172.22.1.253:41229] \"SMEMBERS\" \"BAYES_SPAM_keys\"\n[...]\n</code></pre>","path":["U e redis.en"],"tags":[]},{"location":"manual-guides/Redis/u_e-redis.en/#keys","level":5,"title":"KEYS","text":"<p>Get all keys matching your pattern:</p> <pre><code>KEYS *\n</code></pre>","path":["U e redis.en"],"tags":[]},{"location":"manual-guides/Redis/u_e-redis.en/#ping","level":5,"title":"PING","text":"<p>Test a connection:</p> <pre><code>127.0.0.1:6379&gt; PING\nPONG\n</code></pre> <p>If you want to know more, here is a cheat sheet.</p>","path":["U e redis.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-add-additional-modules.de/","level":1,"title":"U e rspamd add additional modules.de","text":"<p>Laden Sie das Modul herunter und speichern Sie es in folgenden Pfad ab: <code>data/conf/rspamd/plugins.d/</code>.</p> <p>Danach müssen Sie die Konfigurationsparameter des Modules in <code>data/conf/rspamd/rspamd.conf.local</code> hinzufügen. Falls das Modul <code>my_plugin.lua</code> heißt, sollte die Datei wie folgt aussehen:</p> <pre><code># rspamd.conf.local\nmy_plugin {\n    some_setting = \"some value\";\n}\n</code></pre> <p>Falls Ihr Modul keine zusätzlichen Konfigurationen benötigt, reicht es aus einen leeren Konfigurationsblock hinzuzufügen. Wie im folgenden Beispiel zu sehen:</p> <pre><code># rspamd.conf.local\nmy_plugin { }\n</code></pre> <p>Falls Sie keinen Konfigurationsblock hinzufügen, dann wird das Modul automatisch deaktiviert und im Logfile des rspamd-mailcow Containers sehen Sie folgende Nachricht:</p> <pre><code>mailcowdockerized-rspamd-mailcow-1  | 2023-05-20 14:01:32 #1(main) &lt;sh6j9z&gt;; cfg; rspamd_config_is_module_enabled: lua module my_plugin is enabled but has not been configured\nmailcowdockerized-rspamd-mailcow-1  | 2023-05-20 14:01:32 #1(main) &lt;sh6j9z&gt;; cfg; rspamd_config_is_module_enabled: my_plugin disabling unconfigured lua module\n</code></pre> <p>Falls Sie das Modul erfolgreich konfiguiert haben, dann sollte das Logfile des rspamd-mailcow Containers wie folgt aussehen:</p> <pre><code>mailcowdockerized-rspamd-mailcow-1  | 2023-05-20 14:04:50 #1(main) &lt;8ayxpf&gt;; cfg; rspamd_init_lua_filters: init lua module my_plugin from /etc/rspamd/plugins.d//my_plugin.lua; digest: 5cb88961e5\n</code></pre>","path":["U e rspamd add additional modules.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-add-additional-modules.en/","level":1,"title":"U e rspamd add additional modules.en","text":"<p>Download the module and save it in the following path: <code>data/conf/rspamd/plugins.d/</code>.</p> <p>Next, add any necessary configuration for your module to <code>data/conf/rspamd/rspamd.conf.local</code>. \\ If you have a module named <code>my_plugin.lua</code>, configuration might look like the following:</p> <pre><code># rspamd.conf.local\nmy_plugin {\n    some_setting = \"some value\";\n}\n</code></pre> <p>If your module does not require any additional configuration, simply add an empty configuration block, for example:</p> <pre><code># rspamd.conf.local\nmy_plugin { }\n</code></pre> <p>If you do not add a configuration block, the module will be automatically disabled, and the rspamd-mailcow container log will contain a message such as:</p> <pre><code>mailcowdockerized-rspamd-mailcow-1  | 2023-05-20 14:01:32 #1(main) &lt;sh6j9z&gt;; cfg; rspamd_config_is_module_enabled: lua module my_plugin is enabled but has not been configured\nmailcowdockerized-rspamd-mailcow-1  | 2023-05-20 14:01:32 #1(main) &lt;sh6j9z&gt;; cfg; rspamd_config_is_module_enabled: my_plugin disabling unconfigured lua module\n</code></pre> <p>If you have successfully configured your module, the rspamd-mailcow container logs should show:</p> <pre><code>mailcowdockerized-rspamd-mailcow-1  | 2023-05-20 14:04:50 #1(main) &lt;8ayxpf&gt;; cfg; rspamd_init_lua_filters: init lua module my_plugin from /etc/rspamd/plugins.d//my_plugin.lua; digest: 5cb88961e5\n</code></pre>","path":["U e rspamd add additional modules.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-tweaks.de/","level":1,"title":"U e rspamd tweaks.de","text":"","path":["U e rspamd tweaks.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-tweaks.de/#spamfilter-schwellenwerte-global","level":2,"title":"Spamfilter-Schwellenwerte (global)","text":"<p>Jeder Benutzer kann seine Spam-Bewertung individuell ändern. </p> <p>Um eine neue serverweite Grenze zu definieren, editieren Sie <code>data/conf/rspamd/local.d/actions.conf</code>:</p> <pre><code>reject = 15;\nadd_header = 8;\ngreylist = 7;\n</code></pre> <p>Speichern Sie die Datei und starten Sie \"rspamd-mailcow\" neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Achtung</p> <p>Bestehende Einstellungen der Benutzer werden nicht überschrieben!</p> <p>Um benutzerdefinierte Schwellenwerte zurückzusetzen, führen Sie aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf\ndocker compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel';\"\n# oder:\ndocker compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel' and object = 'only-this-mailbox@example.org';\"\n</code></pre> <pre><code>source mailcow.conf\ndocker-compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel';\"\n# oder:\ndocker-compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel' and object = 'only-this-mailbox@example.org';\"\n</code></pre>","path":["U e rspamd tweaks.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-tweaks.de/#benutzerdefinierte-ablehnungsnachrichten","level":2,"title":"Benutzerdefinierte Ablehnungsnachrichten","text":"<p>Die Standard-Spam-Reject-Meldung kann durch Hinzufügen einer neuen Datei <code>data/conf/rspamd/override.d/worker-proxy.custom.inc</code> mit dem folgenden Inhalt geändert werden:</p> <pre><code>reject_message = \"Meine eigene Ablehnungsnachricht\";\n</code></pre> <p>Speichern Sie die Datei und starten Sie Rspamd neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Während das oben genannte für abgelehnte Mails mit einem hohen Spam-Score funktioniert, ignorieren Prefilter-Aktionen diese Einstellung. Für diese muss das Multimap-Modul in Rspamd angepasst werden:</p> <ol> <li> <p>Finden Sie das Prefilet-Reject-Symbol, für das Sie die Nachricht ändern wollen, führen Sie dazu aus: <code>grep -R \"SYMBOL_WELCHES_ANGEPASST_WERDEN_SOLL\" /opt/mailcow-dockerized/data/conf/rspamd/</code></p> </li> <li> <p>Fügen Sie Ihre eigene Nachricht als neue Zeile hinzu:</p> <pre><code>GLOBAL_RCPT_BL {\nTyp = \"rcpt\";\nmap = \"${LOCAL_CONFDIR}/custom/global_rcpt_blacklist.map\";\nregexp = true;\nprefilter = true;\naction = \"reject\";\nmessage = \"Der Versand von E-Mails an diesen Empfänger ist durch postmaster@your.domain verboten\";\n}\n</code></pre> </li> <li> <p>Speichern Sie die Datei und starten Sie Rspamd neu:</p> </li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd tweaks.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-tweaks.de/#e-mails-verwerfen-discard-anstatt-zuruckzuweisen-reject","level":2,"title":"E-Mails verwerfen (discard) anstatt zurückzuweisen (reject)","text":"<p>Wenn Sie eine Nachricht stillschweigend verwerfen wollen, erstellen oder bearbeiten Sie die Datei <code>data/conf/rspamd/override.d/worker-proxy.custom.inc</code> und fügen Sie den folgenden Inhalt hinzu:</p> <pre><code>discard_on_reject = true;\n</code></pre> <p>Starten Sie Rspamd neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd tweaks.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-tweaks.en/","level":1,"title":"U e rspamd tweaks.en","text":"","path":["U e rspamd tweaks.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-tweaks.en/#spam-filter-thresholds-global","level":2,"title":"Spam filter thresholds (global)","text":"<p>Each user is able to change their spam rating individually. To define a new server-wide limit, edit <code>data/conf/rspamd/local.d/actions.conf</code>:</p> <pre><code>reject = 15;\nadd_header = 8;\ngreylist = 7;\n</code></pre> <p>Save the file and restart \"rspamd-mailcow\":</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Warning</p> <p>Existing settings of users will not be overwritten!</p> <p>To reset custom defined thresholds, run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf\ndocker compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel';\"\n# or:\ndocker compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel' and object = 'only-this-mailbox@example.org';\"\n</code></pre> <pre><code>source mailcow.conf\ndocker-compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel';\"\n# or:\ndocker-compose exec mysql-mailcow mysql -umailcow -p$DBPASS mailcow -e \"delete from filterconf where option = 'highspamlevel' or option = 'lowspamlevel' and object = 'only-this-mailbox@example.org';\"\n</code></pre>","path":["U e rspamd tweaks.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-tweaks.en/#custom-reject-messages","level":2,"title":"Custom reject messages","text":"<p>The default spam reject message can be changed by adding a new file <code>data/conf/rspamd/override.d/worker-proxy.custom.inc</code> with the following content:</p> <pre><code>reject_message = \"My custom reject message\";\n</code></pre> <p>Save the file and restart Rspamd:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>While the above works for rejected mails with a high spam score, prefilter reject actions will ignore this setting. For these maps, the multimap module in Rspamd needs to be adjusted:</p> <ol> <li> <p>Find prefilet reject symbol for which you want change message, to do it run: <code>grep -R \"SYMBOL_YOU_WANT_TO_ADJUST\" /opt/mailcow-dockerized/data/conf/rspamd/</code></p> </li> <li> <p>Add your custom message as new line:</p> <pre><code>GLOBAL_RCPT_BL {\ntype = \"rcpt\";\nmap = \"${LOCAL_CONFDIR}/custom/global_rcpt_blacklist.map\";\nregexp = true;\nprefilter = true;\naction = \"reject\";\nmessage = \"Sending mail to this recipient is prohibited by postmaster@your.domain\";\n}\n</code></pre> </li> <li> <p>Save the file and restart Rspamd:</p> </li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd tweaks.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-tweaks.en/#discard-instead-of-reject","level":2,"title":"Discard instead of reject","text":"<p>If you want to silently drop a message, create or edit the file <code>data/conf/rspamd/override.d/worker-proxy.custom.inc</code> and add the following content:</p> <pre><code>discard_on_reject = true;\n</code></pre> <p>Restart Rspamd:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd tweaks.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/","level":1,"title":"U e rspamd work with spamdata.de","text":"","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#spam-ham-lernen","level":2,"title":"Spam &amp; Ham lernen","text":"<p>Rspamd lernt, ob es sich um Spam oder Ham handelt, wenn Sie eine Nachricht in oder aus dem Junk-Ordner in ein anderes Postfach als den Papierkorb verschieben. Dies wird durch die Verwendung des Sieve-Plugins \"sieve_imapsieve\" und Parser-Skripte erreicht.</p> <p>Rspamd liest auch automatisch Mails, wenn eine hohe oder niedrige Punktzahl erkannt wird (siehe https://rspamd.com/doc/configuration/statistic.html#autolearning). Wir haben das Plugin so konfiguriert, dass es ein vernünftiges Verhältnis zwischen Spam- und Ham-Learnings beibehält.</p> <p>Die Bayes-Statistiken werden in Redis als Schlüssel <code>BAYES_HAM</code> und <code>BAYES_SPAM</code> gespeichert.</p> <p>Neben Bayes wird ein lokaler Fuzzy-Speicher verwendet, um wiederkehrende Muster in Texten oder Bildern zu lernen, die auf Ham oder Spam hinweisen.</p> <p>Sie können auch die Web-UI von Rspamd verwenden, um Ham und/oder Spam zu lernen oder bestimmte Einstellungen von Rspamd anzupassen.</p>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#spam-oder-ham-aus-bestehendem-verzeichnis-lernen","level":3,"title":"Spam oder Ham aus bestehendem Verzeichnis lernen","text":"<p>Sie können einen Einzeiler verwenden, um Mails im Klartextformat (unkomprimiert) zu lernen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code># Ham\nfor file in /my/folder/cur/*; do docker exec -i $(docker compose ps -q rspamd-mailcow) rspamc learn_ham &lt; $file; done\n# Spam\nfor file in /my/folder/.Junk/cur/*; do docker exec -i $(docker compose ps -q rspamd-mailcow) rspamc learn_spam &lt; $file; done\n</code></pre> <pre><code># Ham\nfor file in /my/folder/cur/*; do docker exec -i $(docker-compose ps -q rspamd-mailcow) rspamc learn_ham &lt; $file; done\n# Spam\nfor file in /my/folder/.Junk/cur/*; do docker exec -i $(docker-compose ps -q rspamd-mailcow) rspamc learn_spam &lt; $file; done\n</code></pre> <p>Erwägen Sie, einen lokalen Ordner als neues Volume an <code>rspamd-mailcow</code> in <code>docker-compose.yml</code> anzuhängen und die gegebenen Dateien innerhalb des Containers zu lernen. Dies kann als Workaround verwendet werden, um komprimierte Daten mit zcat zu parsen. Beispiel:</p> <pre><code>for file in /data/old_mail/.Junk/cur/*; do rspamc learn_spam &lt; zcat $file; done\n</code></pre>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#gelernte-daten-zurucksetzen-bayes-neural","level":2,"title":"Gelernte Daten zurücksetzen (Bayes, Neural)","text":"<p>Sie müssen die Schlüssel in Redis löschen, um die gelernten Daten zurückzusetzen, also erstellen Sie zuerst eine Kopie Ihrer Redis-Datenbank:</p>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#kopie-der-redis-datenbank","level":3,"title":"Kopie der Redis Datenbank","text":"<pre><code># Es ist besser, Redis zu stoppen, bevor Sie die Datei kopieren.\ncp /var/lib/docker/volumes/mailcowdockerized_redis-vol-1/_data/dump.rdb /root/\n</code></pre>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#bayes-daten-zurucksetzen","level":3,"title":"Bayes-Daten zurücksetzen","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow sh -c 'redis-cli --scan --pattern BAYES_* | xargs redis-cli del'\ndocker compose exec redis-mailcow sh -c 'redis-cli --scan --pattern RS* | xargs redis-cli del'\n</code></pre> <pre><code>docker-compose exec redis-mailcow sh -c 'redis-cli --scan --pattern BAYES_* | xargs redis-cli del'\ndocker-compose exec redis-mailcow sh -c 'redis-cli --scan --pattern RS* | xargs redis-cli del'\n</code></pre>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#neurale-daten-zurucksetzen","level":3,"title":"Neurale Daten zurücksetzen","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow sh -c 'redis-cli --scan --pattern rn_* | xargs redis-cli del'\n</code></pre> <pre><code>docker-compose exec redis-mailcow sh -c 'redis-cli --scan --pattern rn_* | xargs redis-cli del'\n</code></pre>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.de/#fuzzy-daten-zurucksetzen","level":3,"title":"Fuzzy-Daten zurücksetzen","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code># Wir müssen zuerst die redis-cli aufrufen:\ndocker compose exec redis-mailcow redis-cli\n# In redis-cli geben wir nun ein:\n127.0.0.1:6379&gt; EVAL \"for i, name in ipairs(redis.call('KEYS', ARGV[1])) do redis.call('DEL', name); end\" 0 fuzzy*\n</code></pre> <pre><code># Wir müssen zuerst die redis-cli aufrufen:\ndocker-compose exec redis-mailcow redis-cli\n# In redis-cli geben wir nun ein:\n127.0.0.1:6379&gt; EVAL \"for i, name in ipairs(redis.call('KEYS', ARGV[1])) do redis.call('DEL', name); end\" 0 fuzzy*\n</code></pre> <p>Info</p> <p>Wenn redis-cli sich darüber beschwert... <pre><code>(error) ERR wrong number of arguments for 'del' command\n</code></pre> ...,dass das Schlüsselmuster nicht gefunden wurde und somit keine Daten zum Löschen vorhanden sind - ist dies in Ordnung.</p>","path":["U e rspamd work with spamdata.de"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/","level":1,"title":"U e rspamd work with spamdata.en","text":"","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#learn-spam-ham","level":2,"title":"Learn Spam &amp; Ham","text":"<p>Rspamd learns mail as spam or ham when you move a message in or out of the junk folder to any mailbox besides trash. This is achieved by using the Sieve plugin \"sieve_imapsieve\" and parser scripts.</p> <p>Rspamd also auto-learns mail when a high or low score is detected (see https://rspamd.com/doc/configuration/statistic.html#autolearning). We configured the plugin to keep a sane ratio between spam and ham learns.</p> <p>The bayes statistics are written to Redis as keys <code>BAYES_HAM</code> and <code>BAYES_SPAM</code>.</p> <p>Besides bayes, a local fuzzy storage is used to learn recurring patterns in text or images that indicate ham or spam.</p> <p>You can also use Rspamd's web UI to learn ham and / or spam or to adjust certain settings of Rspamd.</p>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#learn-spam-or-ham-from-existing-directory","level":3,"title":"Learn Spam or Ham from existing directory","text":"<p>You can use a one-liner to learn mail in plain-text (uncompressed) format:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code># Ham\nfor file in /my/folder/cur/*; do docker exec -i $(docker compose ps -q rspamd-mailcow) rspamc learn_ham &lt; $file; done\n# Spam\nfor file in /my/folder/.Junk/cur/*; do docker exec -i $(docker compose ps -q rspamd-mailcow) rspamc learn_spam &lt; $file; done\n</code></pre> <pre><code># Ham\nfor file in /my/folder/cur/*; do docker exec -i $(docker-compose ps -q rspamd-mailcow) rspamc learn_ham &lt; $file; done\n# Spam\nfor file in /my/folder/.Junk/cur/*; do docker exec -i $(docker-compose ps -q rspamd-mailcow) rspamc learn_spam &lt; $file; done\n</code></pre> <p>Consider attaching a local folder as new volume to <code>rspamd-mailcow</code> in <code>docker-compose.yml</code> and learn given files inside the container. This can be used as workaround to parse compressed data with zcat. Example:</p> <pre><code>for file in /data/old_mail/.Junk/cur/*; do rspamc learn_spam &lt; zcat $file; done\n</code></pre>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#reset-learned-data-bayes-neural","level":2,"title":"Reset learned data (Bayes, Neural)","text":"<p>You need to delete keys in Redis to reset learned data, so create a copy of your Redis database now:</p>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#copy-of-redis-database","level":3,"title":"Copy of Redis database","text":"<pre><code># It is better to stop Redis before you copy the file.\ncp /var/lib/docker/volumes/mailcowdockerized_redis-vol-1/_data/dump.rdb /root/\n</code></pre>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#reset-bayes-data","level":3,"title":"Reset Bayes data","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow sh -c 'redis-cli --scan --pattern BAYES_* | xargs redis-cli del'\ndocker compose exec redis-mailcow sh -c 'redis-cli --scan --pattern RS* | xargs redis-cli del'\n</code></pre> <pre><code>docker-compose exec redis-mailcow sh -c 'redis-cli --scan --pattern BAYES_* | xargs redis-cli del'\ndocker-compose exec redis-mailcow sh -c 'redis-cli --scan --pattern RS* | xargs redis-cli del'\n</code></pre>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#reset-neural-data","level":3,"title":"Reset Neural data","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow sh -c 'redis-cli --scan --pattern rn_* | xargs redis-cli del'\n</code></pre> <pre><code>docker-compose exec redis-mailcow sh -c 'redis-cli --scan --pattern rn_* | xargs redis-cli del'\n</code></pre>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"manual-guides/Rspamd/u-e-rspamd-work-with-spamdata.en/#reset-fuzzy-data","level":3,"title":"Reset Fuzzy data","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code># We need to enter the redis-cli first:\ndocker compose exec redis-mailcow redis-cli\n# In redis-cli:\n127.0.0.1:6379&gt; EVAL \"for i, name in ipairs(redis.call('KEYS', ARGV[1])) do redis.call('DEL', name); end\" 0 fuzzy*\n</code></pre> <pre><code># We need to enter the redis-cli first:\ndocker-compose exec redis-mailcow redis-cli\n# In redis-cli:\n127.0.0.1:6379&gt; EVAL \"for i, name in ipairs(redis.call('KEYS', ARGV[1])) do redis.call('DEL', name); end\" 0 fuzzy*\n</code></pre> <p>Info</p> <p>If redis-cli complains about... <pre><code>(error) ERR wrong number of arguments for 'del' command\n</code></pre> ...the key pattern was not found and thus no data is available to delete - it is fine.</p>","path":["U e rspamd work with spamdata.en"],"tags":[]},{"location":"manual-guides/Rspamd/u_e-rspamd-disable-greylisting.de/","level":1,"title":"U e rspamd disable greylisting.de","text":"<p>Hinweis</p> <p>In dieser Anleitung gehen wir von dem standard mailcow Pfad (<code>/opt/mailcow-dockerized</code>) aus. Der Pfad in Ihrer Installation kann möglicherweise variieren!</p> <p>Nur Nachrichten mit einem höheren Rspamd Score werden Greylisted (soft rejected). </p> <p>Wir selbst empfehlen NICHT das Greylisting zu deaktivieren.</p> <p>Falls Sie einen validen Grund dafür sehen, dass Greylisting zu deaktivieren, können Sie dies serverweit durch das Editieren der <code>greylist.conf</code> deaktivieren:</p> <p><code>/opt/mailcow-dockerized/data/conf/rspamd/local.d/greylist.conf</code></p> <p>Fügen Sie die Zeile hinzu:</p> <pre><code>enabled = false;\n</code></pre> <p>Speichern Sie die Datei und starten Sie \"rspamd-mailcow\" neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Das Greylisting ist nun serverweit deaktiviert!</p>","path":["U e rspamd disable greylisting.de"],"tags":[]},{"location":"manual-guides/Rspamd/u_e-rspamd-disable-greylisting.en/","level":1,"title":"U e rspamd disable greylisting.en","text":"<p>Info</p> <p>In this guide we assume the default mailcow path (<code>/opt/mailcow-dockerized</code>). The path in your installation may vary.</p> <p>Only messages with a higher Rspamd score will be considered to be greylisted (soft rejected).</p> <p>We do NOT recommend deactivating greylisting.</p> <p>However, if you see a valid reason to disable greylisting, you can disable it server-wide by editing the <code>greylist.conf</code>:</p> <p><code>/opt/mailcow-dockerized/data/conf/rspamd/local.d/greylist.conf</code></p> <p>Add the line:</p> <pre><code>enabled = false;\n</code></pre> <p>Save the file and restart \"rspamd-mailcow\":</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Greylisting is now deactivated serverwide!</p>","path":["U e rspamd disable greylisting.en"],"tags":[]},{"location":"manual-guides/Rspamd/u_e-rspamd-general.de/","level":1,"title":"U e rspamd general.de","text":"<p>Rspamd wird für die AV-Verarbeitung, DKIM-Signierung und SPAM-Verarbeitung verwendet. Es ist ein leistungsfähiges und schnelles Filtersystem. Für eine ausführlichere Dokumentation über Rspamd besuchen Sie bitte die [Rspamd Dokumentation] (https://rspamd.com/doc/index.html).</p>","path":["U e rspamd general.de"],"tags":[]},{"location":"manual-guides/Rspamd/u_e-rspamd-general.de/#ui-zugang","level":2,"title":"UI Zugang","text":"<p>Rspamd bietet eine umfangreiche WebUI, welche jeder mailcow: dockerized Installation beiliegt.</p> <p>Diese ist mit einem Login versehen, welcher während der initialen Installation auf ein zufälliges Passwort gesetzt wird um den Zugang dritter zu verweigern.</p> <p>Damit Sie sich in die Rspamd UI einloggen können müssen Sie zunächst ein eigenes Passwort für die Rspamd Oberfläche setzen.</p> <p>Dies tun Sie wie folgt:</p> <ol> <li>Loggen Sie sich als Administrator in ihrer mailcow UI ein.</li> <li>Wechseln Sie auf den Reiter (oben links) <code>System</code> <code>Konfiguration</code> und dort den Unterreiter: <code>Zugang</code> <code>Rspamd UI</code>.</li> <li>Ändern Sie hier das Rspamd UI Passwort, bzw. legen Sie eines fest.</li> <li>Gehen Sie in einem Browser zu https://${MAILCOW_HOSTNAME}/rspamd und melden Sie sich an!</li> </ol> <p>Weitere Konfigurationsoptionen und Dokumentation zur WebUI finden Sie hier: https://rspamd.com/webui/</p>","path":["U e rspamd general.de"],"tags":[]},{"location":"manual-guides/Rspamd/u_e-rspamd-general.de/#cli-werkzeuge","level":2,"title":"CLI-Werkzeuge","text":"<p>Rspamd bietet eine vielzahl von Befehlen, welche via CLI benutzt werden können.</p> <p>Geben Sie folgende Befehle ein, um einen Überblick auf diese zu erhalten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow rspamc --help\ndocker compose exec rspamd-mailcow rspamadm --help\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow rspamc --help\ndocker-compose exec rspamd-mailcow rspamadm --help\n</code></pre>","path":["U e rspamd general.de"],"tags":[]},{"location":"manual-guides/Rspamd/u_e-rspamd-general.de/#speicherung-der-historie-erhohen","level":2,"title":"Speicherung der Historie erhöhen","text":"<p>Standardmäßig speichert Rspamd 1000 Elemente in der Historie.</p> <p>Die Historie wird komprimiert gespeichert.</p> <p>Es wird empfohlen, hier keinen unverhältnismäßig hohen Wert zu verwenden, probieren Sie etwas in der Größenordnung von 5000 oder 10000 und sehen Sie, wie Ihr Server damit umgeht:</p> <p>Bearbeiten Sie <code>data/conf/rspamd/local.d/history_redis.conf</code>:</p> <pre><code>nrows = 1000; # Ändern Sie diesen Wert\n</code></pre> <p>Starten Sie anschließend Rspamd neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd general.de"],"tags":[]},{"location":"manual-guides/Rspamd/u_e-rspamd-general.de/#losche-alle-ratelimit-schlussel","level":2,"title":"Lösche alle Ratelimit-Schlüssel","text":"<p>Wenn Sie die mailcow UI nicht verwenden wollen und stattdessen alle Schlüssel in der Redis-Datenbank löschen wollen, können Sie redis-cli für diese Aufgabe verwenden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow sh\n# Unlink (verfügbar in Redis &gt;=4.) löscht im Hintergrund\nredis-cli --scan --pattern RL* | xargs redis-cli unlink\n</code></pre> <pre><code>docker-compose exec redis-mailcow sh\n# Unlink (verfügbar in Redis &gt;=4.) löscht im Hintergrund\nredis-cli --scan --pattern RL* | xargs redis-cli unlink\n</code></pre> <p>Starten Sie Rspamd neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd general.de"],"tags":[]},{"location":"manual-guides/Rspamd/u_e-rspamd-general.en/","level":1,"title":"U e rspamd general.en","text":"<p>Rspamd is used for AV handling, DKIM signing and SPAM handling. It's a powerful and fast filter system. For a more in-depth documentation on Rspamd please visit its own documentation.</p>","path":["U e rspamd general.en"],"tags":[]},{"location":"manual-guides/Rspamd/u_e-rspamd-general.en/#ui-access","level":2,"title":"UI access","text":"<p>Rspamd offers a comprehensive WebUI, which is included in every mailcow: dockerized installation.</p> <p>The Rspamd UI is provided with a login, which is set to a random password during the initial installation to deny third party access.</p> <p>To be able to log in to the Rspamd UI, you must first set your own password for the Rspamd interface.</p> <p>You do this as follows:</p> <ol> <li>Log in to your mailcow UI as administrator.</li> <li>Switch to the tab (top left) <code>System</code> <code>Configuration</code> and there the sub-tab: <code>Access</code> <code>Rspamd UI</code>.</li> <li>Change the Rspamd UI password here, or set one.</li> <li>Go to https://${MAILCOW_HOSTNAME}/rspamd in a browser and log in!</li> </ol> <p>Further configuration options and documentation for the WebUI can be found here: https://rspamd.com/webui/</p>","path":["U e rspamd general.en"],"tags":[]},{"location":"manual-guides/Rspamd/u_e-rspamd-general.en/#cli-tools","level":2,"title":"CLI tools","text":"<p>Rspamd offers a variety of commands that can be used via CLI.</p> <p>Enter the following commands to get an overview of these:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow rspamc --help\ndocker compose exec rspamd-mailcow rspamadm --help\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow rspamc --help\ndocker-compose exec rspamd-mailcow rspamadm --help\n</code></pre>","path":["U e rspamd general.en"],"tags":[]},{"location":"manual-guides/Rspamd/u_e-rspamd-general.en/#increase-history-retention","level":2,"title":"Increase history retention","text":"<p>By default Rspamd keeps 1000 elements in the history.</p> <p>The history is stored compressed.</p> <p>It is recommended not to use a disproportionate high value here, try something along 5000 or 10000 and see how your server handles it:</p> <p>Edit <code>data/conf/rspamd/local.d/history_redis.conf</code>:</p> <pre><code>nrows = 1000; # change this value\n</code></pre> <p>Restart Rspamd afterwards:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd general.en"],"tags":[]},{"location":"manual-guides/Rspamd/u_e-rspamd-general.en/#wipe-all-ratelimit-keys","level":2,"title":"Wipe all ratelimit keys","text":"<p>If you don't want to use the UI and instead wipe all keys in the Redis database, you can use redis-cli for that task:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow sh\n# Unlink (available in Redis &gt;=4.) will delete in the backgronud\nredis-cli --scan --pattern RL* | xargs redis-cli unlink\n</code></pre> <pre><code>docker-compose exec redis-mailcow sh\n# Unlink (available in Redis &gt;=4.) will delete in the backgronud\nredis-cli --scan --pattern RL* | xargs redis-cli unlink\n</code></pre> <p>Restart Rspamd:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre>","path":["U e rspamd general.en"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.de/","level":1,"title":"U e sogo.de","text":"<p>SOGo wird verwendet, um über einen Webbrowser auf Ihre Mails zuzugreifen und Ihre Kontakte oder Kalender hinzuzufügen und zu teilen. Für eine ausführlichere Dokumentation zu SOGo besuchen Sie bitte die Dokumentation von SOGo.</p>","path":["U e sogo.de"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.de/#benutzerdefiniertes-sogo-thema-css-anwenden","level":2,"title":"Benutzerdefiniertes SOGo-Thema (CSS) anwenden","text":"<p>mailcow-Builds nach dem 28. Januar 2021 können das CSS-Thema von SOGo ändern, indem sie <code>data/conf/sogo/custom-theme.js</code> bearbeiten. Bitte schauen Sie sich die AngularJS Material intro und documentation sowie die material style guideline an, um zu erfahren, wie das funktioniert. </p> <p>Sie können die mitgelieferte <code>custom-theme.js</code> als Beispiel verwenden, indem Sie die Kommentare entfernen. Nachdem Sie <code>data/conf/sogo/custom-theme.js</code> modifiziert und Änderungen an Ihrem neuen SOGo-Theme vorgenommen haben, müssen Sie </p> <p>1. Bearbeiten Sie <code>data/conf/sogo/sogo.conf</code> und fügen Sie <code>SOGoUIxDebugEnabled = YES;</code> ein.</p> <p>2. SOGo und Memcached Container neu starten, indem man folgenden Befehl ausführt:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre> <p>3. SOGo im Browser öffnen</p> <p>4. öffnen Sie die Entwicklerkonsole des Browsers, normalerweise ist die Tastenkombination F12</p> <p>5. nur wenn Sie Firefox benutzen: schreiben Sie mit der Hand in die Entwicklerkonsole <code>allow pasting</code> und drücken Sie Enter</p> <p>6. fügen Sie den Java-Script-Schnipsel in die Entwicklungskonsole ein: <pre><code>copy([].slice.call(document.styleSheets)\n  .map(e =&gt; e.ownerNode)\n  .filter(e =&gt; e.hasAttribute('md-theme-style'))\n  .map(e =&gt; e.textInhalt)\n  .join('\\n')\n)\n</code></pre> 7. Öffnen Sie den Texteditor und fügen Sie die Daten aus der Zwischenablage ein (Strg+V), Sie sollten ein minimiertes CSS erhalten, speichern Sie es</p> <p>8. kopieren Sie die CSS-Datei auf den mailcow-Server <code>data/conf/sogo/custom-theme.css</code></p> <p>9. editiere <code>data/conf/sogo/sogo.conf</code> und setze <code>SOGoUIxDebugEnabled = NO;</code></p> <p>10. Anhängen/Erstellen von <code>docker-compose.override.yml</code> mit: <pre><code>services:\n  sogo-mailcow:\n    volumes:\n      - ./data/conf/sogo/custom-theme.css:/usr/lib/GNUstep/SOGo/WebServerResources/css/theme-default.css:z\n</code></pre> 11. Führen Sie folgenden Befehl aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>12. Neustarten des memcached Containers mit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.de/#zurucksetzen-auf-das-sogo-standardthema","level":2,"title":"Zurücksetzen auf das SOGo Standardthema","text":"<ol> <li>checken Sie <code>data/conf/sogo/custom-theme.js</code> aus, indem Sie <code>git fetch ; git checkout origin/master data/conf/sogo/custom-theme.js data/conf/sogo/custom-theme.js</code> ausführen</li> <li>Suchen Sie in <code>data/conf/sogo/custom-theme.js</code>: <pre><code>// Neue Paletten auf das Standardthema anwenden, einige Farbtöne neu zuordnen\n    $mdThemingProvider.theme('default')\n      .primaryPalette('green-cow', {\n        'default': '400', // Hintergrundfarbe der oberen Symbolleisten\n        hue-1': '400',\n        'hue-2': '600', // Hintergrundfarbe der Seitenleiste\n        'hue-3': 'A700'\n      })\n      .accentPalette('green', {\n        'default': '600', // Hintergrundfarbe der Fab-Schaltflächen und des Anmeldebildschirms\n        hue-1': '300', // Hintergrundfarbe der Symbolleiste der mittleren Liste\n        hue-2': '300', // Hervorhebungsfarbe für ausgewählte Nachrichten und den aktuellen Tageskalender\n        hue-3': 'A700'\n      })\n      .backgroundPalette('frost-grey');\n</code></pre> und ersetzen Sie es durch: <pre><code>    $mdThemingProvider.theme('default');\n</code></pre></li> <li>Entfernen Sie aus <code>docker-compose.override.yml</code> Volume Mount in <code>sogo-mailcow</code>: <pre><code>- ./data/conf/sogo/custom-theme.css:/usr/lib/GNUstep/SOGo/WebServerResources/css/theme-default.css:z\n</code></pre></li> <li>Führen Sie folgenden Befehl aus:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <ol> <li>Starten Sie memcached neu mit:</li> </ol> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.de/#favicon-andern","level":2,"title":"Favicon ändern","text":"<p>mailcow-Builds nach dem 31. Januar 2021 können SOGo's Favicon ändern, indem sie <code>data/conf/sogo/custom-favicon.ico</code> für SOGo und <code>data/web/favicon.png</code> für mailcow UI ersetzen.</p> <p>Anmerkung: Sie können <code>.png</code> Favicons für SOGo verwenden, indem Sie sie in <code>custom-favicon.ico</code> umbenennen. Für beide, SOGo und mailcow UI Favicons, müssen Sie eine der Standardgrößen verwenden: 16x16, 32x32, 64x64, 128x128 und 256x256. Nachdem Sie diese Datei ersetzt haben, müssen Sie SOGo und Memcached Container neu starten, indem Sie folgenden Befehl ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.de/#logo-andern","level":2,"title":"Logo ändern","text":"<p>mailcow-Builds nach dem 21. Dezember 2018 können das SOGo-Logo ändern, indem sie die Datei <code>data/conf/sogo/sogo-full.svg</code> ersetzen oder erstellen (falls sie fehlt). Nachdem Sie diese Datei ersetzt haben, müssen Sie SOGo und Memcached Container neu starten, indem Sie folgendes ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.de/#domains-verbinden-untereinander-sichtbar-machen","level":2,"title":"Domains verbinden (untereinander sichtbar machen)","text":"<p>Domains sind normalerweise voneinander isoliert.</p> <p>Sie können das ändern, indem Sie <code>data/conf/sogo/sogo.conf</code> modifizieren:</p> <p>Suche... <pre><code>   // SOGoDomainsVisibility = (\n    // (domain1.tld, domain5.tld),\n    // (domain3.tld, domain2.tld)\n    // );\n</code></pre> ...und ersetzen Sie diese durch - zum Beispiel:</p> <pre><code>    SOGoDomainsVisibility = (\n      (beispiel.org, beispiel.com, beispiel.net)\n    );\n</code></pre> <p>SOGo neu starten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart sogo-mailcow\n</code></pre> <pre><code>docker-compose restart sogo-mailcow\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.de/#aktivieren-der-passwortanderung-in-sogo","level":2,"title":"Aktivieren der Passwortänderung in SOGo","text":"<p>Die Möglichkeit ihr Passwort in SOGo zu ändern wurde standardmäßig deaktiviert, da:</p> <ul> <li>es nicht die Passwortrichtlinien der mailcow UI beachten kann.</li> <li>es nicht funktioniert, wenn ein User sich direkt in SOGo angemeldet hat (über die mailcow UI) <code>In Webmail einloggen</code> (Auth Proxy)</li> </ul> <p>Sollten Sie diese Funktion dennoch aktiviert haben wollen bearbeiten Sie einfach <code>data/conf/sogo/sogo.conf</code> und ändern <code>SOGoPasswordChangeEnabled</code> zu <code>YES</code>. Bitte hier keine anderen Parameter außer <code>YES</code> oder <code>NO</code> verwenden.</p> <p>Anschließend SOGo neustarten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.de/#totp-zurucksetzen-totp-deaktivieren","level":2,"title":"TOTP zurücksetzen / TOTP deaktivieren","text":"<p>Führen Sie folgenden Befehl aus dem mailcow Verzeichnis aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec -u sogo sogo-mailcow sogo-tool user-preferences set defaults user@example.com SOGoTOTPEnabled '{\"SOGoTOTPEnabled\":0}'\n</code></pre> <pre><code>docker-compose exec -u sogo sogo-mailcow sogo-tool user-preferences set defaults user@example.com SOGoTOTPEnabled '{\"SOGoTOTPEnabled\":0}'\n</code></pre>","path":["U e sogo.de"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.en/","level":1,"title":"U e sogo.en","text":"<p>SOGo is used for accessing your mails via a webbrowser, adding and sharing your contacts or calendars. For a more in-depth documentation on SOGo please visit its own documentation.</p>","path":["U e sogo.en"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.en/#apply-custom-sogo-theme","level":2,"title":"Apply custom SOGo theme","text":"<p>mailcow builds after 28 January 2021 can change SOGo's theme by editing <code>data/conf/sogo/custom-theme.js</code>. Please check the AngularJS Material intro and documentation as well as the material style guideline to learn how this works. </p> <p>You can use the provided <code>custom-theme.js</code> as an example starting point by removing the comments. After you modified <code>data/conf/sogo/custom-theme.js</code> and made changes to your new SOGo theme you need to </p> <p>1. edit <code>data/conf/sogo/sogo.conf</code> and append/set <code>SOGoUIxDebugEnabled = YES;</code></p> <p>2. restart SOGo and Memcached containers by executing the command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre> <p>3. open SOGo in browser</p> <p>4. open browser developer console, usually shortcut is F12</p> <p>5. only if you use Firefox: write by hands in dev console <code>allow pasting</code> and press enter</p> <p>6. paste java script snippet in dev console: <pre><code>copy([].slice.call(document.styleSheets)\n  .map(e =&gt; e.ownerNode)\n  .filter(e =&gt; e.hasAttribute('md-theme-style'))\n  .map(e =&gt; e.textContent)\n  .join('\\n')\n)\n</code></pre></p> <p>7. open text editor and paste data from clipboard (Ctrl+V), you should get minified CSS, save it</p> <p>8. copy CSS file to mailcow server <code>data/conf/sogo/custom-theme.css</code></p> <p>9. edit <code>data/conf/sogo/sogo.conf</code> and set <code>SOGoUIxDebugEnabled = NO;</code></p> <p>10. append/create <code>docker-compose.override.yml</code> with: <pre><code>services:\n  sogo-mailcow:\n    volumes:\n      - ./data/conf/sogo/custom-theme.css:/usr/lib/GNUstep/SOGo/WebServerResources/css/theme-default.css:z\n</code></pre></p> <p>11. Run: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>12. Run: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.en/#reset-to-sogo-default-theme","level":2,"title":"Reset to SOGo default theme","text":"<p>1. checkout <code>data/conf/sogo/custom-theme.js</code> by executing <code>git fetch ; git checkout origin/master data/conf/sogo/custom-theme.js data/conf/sogo/custom-theme.js</code></p> <p>2. find in <code>data/conf/sogo/custom-theme.js</code>: <pre><code>// Apply new palettes to the default theme, remap some of the hues\n    $mdThemingProvider.theme('default')\n      .primaryPalette('green-cow', {\n        'default': '400',  // background color of top toolbars\n        'hue-1': '400',\n        'hue-2': '600',    // background color of sidebar toolbar\n        'hue-3': 'A700'\n      })\n      .accentPalette('green', {\n        'default': '600',  // background color of fab buttons and login screen\n        'hue-1': '300',    // background color of center list toolbar\n        'hue-2': '300',    // highlight color for selected mail and current day calendar\n        'hue-3': 'A700'\n      })\n      .backgroundPalette('frost-grey');\n</code></pre> and replace it with: <pre><code>    $mdThemingProvider.theme('default');\n</code></pre></p> <p>3. remove from <code>docker-compose.override.yml</code> volume mount in <code>sogo-mailcow</code>: <pre><code>- ./data/conf/sogo/custom-theme.css:/usr/lib/GNUstep/SOGo/WebServerResources/css/theme-default.css:z\n</code></pre></p> <p>4. Run: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>5. Run: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.en/#change-favicon","level":2,"title":"Change favicon","text":"<p>mailcow builds after 31 January 2021 can change SOGo's favicon by replacing <code>data/conf/sogo/custom-favicon.ico</code> for SOGo and <code>data/web/favicon.png</code> for mailcow UI. Note: You can use <code>.png</code> favicons for SOGo by renaming them to <code>custom-favicon.ico</code>. For both SOGo and mailcow UI favicons you need use one of the standard dimensions: 16x16, 32x32, 64x64, 128x128 and 256x256. After you replaced said file you need to restart SOGo and Memcached containers by executing:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.en/#change-logo","level":2,"title":"Change logo","text":"<p>mailcow builds after 21 December 2018 can change SOGo's logo by replacing or creating (if missing) <code>data/conf/sogo/sogo-full.svg</code>. After you replaced said file you need to restart SOGo and Memcached containers by executing:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.en/#connect-domains","level":2,"title":"Connect domains","text":"<p>Domains are usually isolated from eachother.</p> <p>You can change that by modifying <code>data/conf/sogo/sogo.conf</code>:</p> <p>Search... <pre><code>   // SOGoDomainsVisibility = (\n    //  (domain1.tld, domain5.tld),\n    //  (domain3.tld, domain2.tld)\n    // );\n</code></pre> ...and replace it by - for example:</p> <pre><code>    SOGoDomainsVisibility = (\n      (example.org, example.com, example.net)\n    );\n</code></pre> <p>Restart SOGo:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart sogo-mailcow\n</code></pre> <pre><code>docker-compose restart sogo-mailcow\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.en/#enable-password-changing","level":2,"title":"Enable password changing","text":"<p>The password change option in SOGo is disabled by default because it:</p> <ul> <li>doesn't take into account the password policy set in the mailcow UI</li> <li>doesn't work when the user is logged in into SOGo using the <code>Login to Webmail</code> function in the mailcow UI (Auth Proxy)</li> </ul> <p>If you still want enable this option edit <code>data/conf/sogo/sogo.conf</code> and change <code>SOGoPasswordChangeEnabled</code> to <code>YES</code>. Please do not add a new parameter.</p> <p>Run this command to activate the changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart memcached-mailcow sogo-mailcow\n</code></pre> <pre><code>docker-compose restart memcached-mailcow sogo-mailcow\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"manual-guides/SOGo/u_e-sogo.en/#reset-totp-disable-totp","level":2,"title":"Reset TOTP / Disable TOTP","text":"<p>Run the following command from within the mailcow directory:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec -u sogo sogo-mailcow sogo-tool user-preferences set defaults user@example.com SOGoTOTPEnabled '{\"SOGoTOTPEnabled\":0}'\n</code></pre> <pre><code>docker-compose exec -u sogo sogo-mailcow sogo-tool user-preferences set defaults user@example.com SOGoTOTPEnabled '{\"SOGoTOTPEnabled\":0}'\n</code></pre>","path":["U e sogo.en"],"tags":[]},{"location":"manual-guides/Unbound/u_e-unbound-fwd.de/","level":1,"title":"U e unbound fwd.de","text":"<p>Wenn Sie einen externen DNS-Dienst verwenden wollen oder müssen, können Sie entweder einen Forwarder in Unbound einstellen oder eine Override-Datei kopieren, um externe DNS-Server zu definieren:</p> <p>Warnung</p> <p>Bitte verwenden Sie keinen öffentlichen Resolver, wie wir es im obigen Beispiel getan haben. Viele - wenn nicht sogar alle - Blacklist-Lookups werden mit öffentlichen Resolvern fehlschlagen, da der Blacklist-Server Grenzen hat, wie viele Anfragen von einer IP gestellt werden können und öffentliche Resolver diese Grenzen normalerweise erreichen.  Wichtig: Nur DNSSEC-validierende DNS-Dienste werden funktionieren.</p>","path":["U e unbound fwd.de"],"tags":[]},{"location":"manual-guides/Unbound/u_e-unbound-fwd.de/#methode-a-unbound","level":2,"title":"Methode A, Unbound","text":"<p>Bearbeiten Sie <code>data/conf/unbound/unbound.conf</code> und fügen Sie die folgenden Parameter hinzu:</p> <pre><code>forward-zone:\n  name: \".\"\n  forward-addr: 8.8.8.8 # VERWENDEN SIE KEINE ÖFFENTLICHEN DNS-SERVER - NUR EIN BEISPIEL\n  forward-addr: 8.8.4.4 # VERWENDET KEINE ÖFFENTLICHEN DNS-SERVER - NUR EIN BEISPIEL\n</code></pre> <p>Unbound neu starten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>  docker compose restart unbound-mailcow\n</code></pre> <pre><code>  docker-compose restart unbound-mailcow\n</code></pre>","path":["U e unbound fwd.de"],"tags":[]},{"location":"manual-guides/Unbound/u_e-unbound-fwd.de/#methode-b-uberschreiben-der-datei","level":2,"title":"Methode B, Überschreiben der Datei","text":"<pre><code>cd /opt/mailcow-dockerized\ncp helper-scripts/docker-compose.override.yml.d/EXTERNAL_DNS/docker-compose.override.yml .\n</code></pre> <p>Bearbeiten Sie <code>docker-compose.override.yml</code> und passen Sie die IP an.</p> <p>Stoppen und starten Sie bitte im Anschluss noch den Docker Stack:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>  docker compose down\n  docker compose up -d\n</code></pre> <pre><code>  docker-compose down\n  docker-compose up -d\n</code></pre>","path":["U e unbound fwd.de"],"tags":[]},{"location":"manual-guides/Unbound/u_e-unbound-fwd.en/","level":1,"title":"U e unbound fwd.en","text":"<p>If you want or have to use an external DNS service, you can either set a forwarder in Unbound or copy an override file to define external DNS servers:</p> <p>Warning</p> <p>Please do not use a public resolver like we did in the example above. Many - if not all - blacklist lookups will fail with public resolvers, because blacklist server has limits on how much requests can be done from one IP and public resolvers usually reach this limits.  Important: Only DNSSEC validating DNS services will work.</p>","path":["U e unbound fwd.en"],"tags":[]},{"location":"manual-guides/Unbound/u_e-unbound-fwd.en/#method-a-unbound","level":2,"title":"Method A, Unbound","text":"<p>Edit <code>data/conf/unbound/unbound.conf</code> and append the following parameters:</p> <pre><code>forward-zone:\n  name: \".\"\n  forward-addr: 8.8.8.8 # DO NOT USE PUBLIC DNS SERVERS - JUST AN EXAMPLE\n  forward-addr: 8.8.4.4 # DO NOT USE PUBLIC DNS SERVERS - JUST AN EXAMPLE\n</code></pre> <p>Restart Unbound:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>  docker compose restart unbound-mailcow\n</code></pre> <pre><code>  docker-compose restart unbound-mailcow\n</code></pre>","path":["U e unbound fwd.en"],"tags":[]},{"location":"manual-guides/Unbound/u_e-unbound-fwd.en/#method-b-override-file","level":2,"title":"Method B, Override file","text":"<pre><code>cd /opt/mailcow-dockerized\ncp helper-scripts/docker-compose.override.yml.d/EXTERNAL_DNS/docker-compose.override.yml .\n</code></pre> <p>Edit <code>docker-compose.override.yml</code> and adjust the IP.</p> <p>Afterwards stop and start the Docker Stack again:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>  docker compose down\n  docker compose up -d\n</code></pre> <pre><code>  docker-compose down\n  docker-compose up -d\n</code></pre>","path":["U e unbound fwd.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/","level":1,"title":"U e watchdog thresholds.de","text":"<p>Watchdog verwendet Standardwerte für alle in <code>docker-compose.yml</code> definierten Thresholde.</p> <p>Die Standardwerte sind für die meisten Konfigurationen geeignet. Beispiel: <pre><code>- NGINX_THRESHOLD=${NGINX_THRESHOLD:-5}\n- UNBOUND_THRESHOLD=${UNBOUND_THRESHOLD:-5}\n- REDIS_THRESHOLD=${REDIS_THRESHOLD:-5}\n- MYSQL_THRESHOLD=${MYSQL_THRESHOLD:-5}\n- MYSQL_REPLICATION_THRESHOLD=${MYSQL_REPLICATION_THRESHOLD:-1}\n- SOGO_THRESHOLD=${SOGO_THRESHOLD:-3}\n- POSTFIX_THRESHOLD=${POSTFIX_THRESHOLD:-8}\n- CLAMD_THRESHOLD=${CLAMD_THRESHOLD:-15}\n- DOVECOT_THRESHOLD=${DOVECOT_THRESHOLD:-12}\n- DOVECOT_REPL_THRESHOLD=${DOVECOT_REPL_THRESHOLD:-20}\n- PHPFPM_THRESHOLD=${PHPFPM_THRESHOLD:-5}\n- RATELIMIT_THRESHOLD=${RATELIMIT_THRESHOLD:-1}\n- FAIL2BAN_THRESHOLD=${FAIL2BAN_THRESHOLD:-1}\n- ACME_THRESHOLD=${ACME_THRESHOLD:-1}\n- RSPAMD_THRESHOLD=${RSPAMD_THRESHOLD:-5}\n- OLEFY_THRESHOLD=${OLEFY_THRESHOLD:-5}\n- MAILQ_THRESHOLD=${MAILQ_THRESHOLD:-20}\n- MAILQ_CRIT=${MAILQ_CRIT:-30}\n</code></pre></p> <p>Um sie anzupassen, fügen Sie einfach die notwendigen Threshold Variablen (z.B. <code>MAILQ_THRESHOLD=10</code>) zu <code>mailcow.conf</code> hinzu und führen Sie den folgenden Befehl aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#threshold-beschreibungen","level":3,"title":"Threshold Beschreibungen","text":"","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#nginx_threshold","level":4,"title":"NGINX_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn Watchdog keine Verbindung zu Nginx auf Port 8081 herstellen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht wurde.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#unbound_threshold","level":4,"title":"UNBOUND_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn Unbound externe Domänen/DNSSEC nicht auflösen/überprüfen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#redis_threshold","level":4,"title":"REDIS_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn der Watchdog keine Verbindung zu Redis auf Port 6379 herstellen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#mysql_threshold","level":4,"title":"MYSQL_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn watchdog keine Verbindung zu MySQL herstellen kann oder eine Tabelle nicht abfragen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht wurde.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#mysql_replication_threshold","level":4,"title":"MYSQL_REPLICATION_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn die MySQL-Replikation fehlschlägt.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#sogo_threshold","level":4,"title":"SOGO_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn der Watchdog keine Verbindung zu SOGo auf Port 20000 herstellen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#postfix_threshold","level":4,"title":"POSTFIX_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn watchdog keine Testmail über Port 589 senden kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#clamd_threshold","level":4,"title":"CLAMD_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn Watchdog keine Verbindung zu Clamd herstellen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht wurde.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#dovecot_threshold","level":4,"title":"DOVECOT_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn watchdog bei verschiedenen Tests mit dem Dovecot-Container fehlschlägt. Der Container wird automatisch neu gestartet, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#dovecot_repl_threshold","level":4,"title":"DOVECOT_REPL_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn die Dovecot-Replikation fehlschlägt.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#phpfpm_threshold","level":4,"title":"PHPFPM_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn Watchdog keine Verbindung zu PHP-FPM auf Port 9001/9002 herstellen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#ratelimit_threshold","level":4,"title":"RATELIMIT_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn ein Ratelimit erreicht wurde.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#fail2ban_threshold","level":4,"title":"FAIL2BAN_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn ein fail2ban eine IP gesperrt hat.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#acme_threshold","level":4,"title":"ACME_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn etwas mit dem acme-mailcow-Container nicht in Ordnung ist. Sie können dessen Logs überprüfen.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#rspamd_threshold","level":4,"title":"RSPAMD_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn Watchdog bei verschiedenen Tests mit dem Rspamd-Container fehlschlägt und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht wurde.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#olefy_threshold","level":4,"title":"OLEFY_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn watchdog keine Verbindung zu olefy auf Port 10005 herstellen kann und startet den Container automatisch neu, wenn Probleme gefunden wurden und der Threshold erreicht ist.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.de/#mailq_crit-und-mailq_threshold","level":4,"title":"MAILQ_CRIT und MAILQ_THRESHOLD","text":"<p>Benachrichtigt Administratoren, wenn die Anzahl der E-Mails in der Postfix-Warteschlange größer ist als <code>MAILQ_CRIT</code> für einen Zeitraum von <code>MAILQ_THRESHOLD * (60±30)</code> Sekunden.</p>","path":["U e watchdog thresholds.de"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/","level":1,"title":"U e watchdog thresholds.en","text":"<p>Watchdog uses default values for all thresholds defined in <code>docker-compose.yml</code>.</p> <p>The default values will work for most setups. Example: <pre><code>- NGINX_THRESHOLD=${NGINX_THRESHOLD:-5}\n- UNBOUND_THRESHOLD=${UNBOUND_THRESHOLD:-5}\n- REDIS_THRESHOLD=${REDIS_THRESHOLD:-5}\n- MYSQL_THRESHOLD=${MYSQL_THRESHOLD:-5}\n- MYSQL_REPLICATION_THRESHOLD=${MYSQL_REPLICATION_THRESHOLD:-1}\n- SOGO_THRESHOLD=${SOGO_THRESHOLD:-3}\n- POSTFIX_THRESHOLD=${POSTFIX_THRESHOLD:-8}\n- CLAMD_THRESHOLD=${CLAMD_THRESHOLD:-15}\n- DOVECOT_THRESHOLD=${DOVECOT_THRESHOLD:-12}\n- DOVECOT_REPL_THRESHOLD=${DOVECOT_REPL_THRESHOLD:-20}\n- PHPFPM_THRESHOLD=${PHPFPM_THRESHOLD:-5}\n- RATELIMIT_THRESHOLD=${RATELIMIT_THRESHOLD:-1}\n- FAIL2BAN_THRESHOLD=${FAIL2BAN_THRESHOLD:-1}\n- ACME_THRESHOLD=${ACME_THRESHOLD:-1}\n- RSPAMD_THRESHOLD=${RSPAMD_THRESHOLD:-5}\n- OLEFY_THRESHOLD=${OLEFY_THRESHOLD:-5}\n- MAILQ_THRESHOLD=${MAILQ_THRESHOLD:-20}\n- MAILQ_CRIT=${MAILQ_CRIT:-30}\n</code></pre></p> <p>To adjust them just add necessary threshold variables (e.g. <code>MAILQ_THRESHOLD=10</code>) to <code>mailcow.conf</code> and run the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#thresholds-descriptions","level":3,"title":"Thresholds descriptions","text":"","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#nginx_threshold","level":4,"title":"NGINX_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to Nginx on port 8081 and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#unbound_threshold","level":4,"title":"UNBOUND_THRESHOLD","text":"<p>Notifies administrators if Unbound can not resolve/valide external domains/DNSSEC and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#redis_threshold","level":4,"title":"REDIS_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to Redis on port 6379 and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#mysql_threshold","level":4,"title":"MYSQL_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to MySQL or can not query a table and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#mysql_replication_threshold","level":4,"title":"MYSQL_REPLICATION_THRESHOLD","text":"<p>Notifies administrators if the MySQL replication fails.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#sogo_threshold","level":4,"title":"SOGO_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to SOGo on port 20000 and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#postfix_threshold","level":4,"title":"POSTFIX_THRESHOLD","text":"<p>Notifies administrators if watchdog can not sent a test mail via port 589 and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#clamd_threshold","level":4,"title":"CLAMD_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to Clamd and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#dovecot_threshold","level":4,"title":"DOVECOT_THRESHOLD","text":"<p>Notifies administrators if watchdog fails with various tests with Dovecot container and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#dovecot_repl_threshold","level":4,"title":"DOVECOT_REPL_THRESHOLD","text":"<p>Notifies administrators if the Dovecot replication fails.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#phpfpm_threshold","level":4,"title":"PHPFPM_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to PHP-FPM on port 9001/9002 and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#ratelimit_threshold","level":4,"title":"RATELIMIT_THRESHOLD","text":"<p>Notifies administrators if a ratelimit got hit.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#fail2ban_threshold","level":4,"title":"FAIL2BAN_THRESHOLD","text":"<p>Notifies administrators if a fail2ban banned an IP.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#acme_threshold","level":4,"title":"ACME_THRESHOLD","text":"<p>Notifies administrators if something is wrong with the acme-mailcow container. You may check its logs.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#rspamd_threshold","level":4,"title":"RSPAMD_THRESHOLD","text":"<p>Notifies administrators if watchdog fails with various tests with Rspamd container and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#olefy_threshold","level":4,"title":"OLEFY_THRESHOLD","text":"<p>Notifies administrators if watchdog can not establish a connection to olefy on port 10005 and it will restart the container automatically when issues were found and the threshold has been reached.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/Watchdog/u_e-watchdog-thresholds.en/#mailq_crit-and-mailq_threshold","level":4,"title":"MAILQ_CRIT and MAILQ_THRESHOLD","text":"<p>Notifies administrators if number of emails in the postfix queue is greater then <code>MAILQ_CRIT</code> for period of <code>MAILQ_THRESHOLD * (60±30)</code> seconds.</p>","path":["U e watchdog thresholds.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-bl_wl.de/","level":1,"title":"U e mailcow ui bl wl.de","text":"<p>Um einen Eintrag zu Ihrer domain-weiten Filtertabelle hinzuzufügen oder zu bearbeiten, loggen Sie sich als (Domain-)Administrator in Ihre mailcow UI ein und wechseln Sie zu:  <code>Konfiguration &gt; E-Mail-Setup &gt; Domains &gt; (Domain) Bearbeiten &gt; Spamfilter</code>.</p> <p></p> <p>Info</p> <p>Seien Sie sich bewusst, dass ein Benutzer diese Einstellung überschreiben kann, indem er seine eigene Black- und Whitelist setzt!</p> <p>Es ist auch eine globale Filtertabelle in <code>Konfiguration &gt; Server-Konfiguration &gt; Globale Filter-Maps</code> verfügbar, um einen server-weiten (also domainübergreifenden) Filter für ein oder mehrere Regex-Maps zu konfigurieren (Todo: Screenshots).</p>","path":["U e mailcow ui bl wl.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-bl_wl.en/","level":1,"title":"U e mailcow ui bl wl.en","text":"<p>To add or edit an entry to your domain-wide filter table, log in to your mailcow UI as (domain) administrator and go to:  <code>Configuration &gt; Email Setup &gt; Domains &gt; Edit Domain &gt; Spam Filter</code>.</p> <p></p> <p>Info</p> <p>Be aware that a user can override this setting by setting their own blacklist and whitelist!</p> <p>There is also a global filter table in <code>Configuration &gt; Configuration &amp; Details &gt; Global filter maps</code> to configure a server wide filter for multiple regex maps (todo: screenshots).</p>","path":["U e mailcow ui bl wl.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-config.de/","level":1,"title":"U e mailcow ui config.de","text":"<p>Mehrere Konfigurationsparameter der mailcow-Benutzeroberfläche können geändert werden, indem eine Datei <code>data/web/inc/vars.local.inc.php</code> erstellt wird, die die Standardeinstellungen in <code>data/web/inc/vars.inc.php</code> überschreibt.</p> <p>Die lokale Konfigurationsdatei ist über Updates von mailcow hinweg beständig. Versuchen Sie nicht, die Werte in <code>data/web/inc/vars.inc.php</code> zu ändern, sondern verwenden Sie diese als Vorlage für die lokale Überschreibung.</p> <p>mailcow UI Konfigurationsparameter können verwendet werden, um...</p> <ul> <li>...die Standardsprache zu ändern<sup>1</sup></li> <li>...das Standard-Bootstrap-Theme zu ändern</li> <li>...eine Passwort-Komplexitäts-Regex zu setzen</li> <li>...die Sichtbarkeit des privaten DKIM-Schlüssels aktivieren</li> <li>...eine Größe für den Paginierungsauslöser festlegen</li> <li>...Standard-Postfach-Attribute festlegen</li> <li>...Sitzungs-Lebensdauern ändern</li> <li>...feste App-Menüs erstellen (die nicht in der mailcow UI geändert werden können)</li> <li>...ein Standard \"To\"-Feld für Relayhost-Tests einstellen</li> <li>...ein Timeout für Docker API Anfragen setzen</li> <li>...IP-Anonymisierung umschalten</li> </ul> <ol> <li> <p>Um SOGos Standardsprache zu ändern, müssen Sie <code>data/conf/sogo/sogo.conf</code> bearbeiten und \"English\" durch Ihre bevorzugte Sprache ersetzen. ↩</p> </li> </ol>","path":["U e mailcow ui config.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-config.en/","level":1,"title":"U e mailcow ui config.en","text":"<p>Several configuration parameters of the mailcow UI can be changed by creating a file <code>data/web/inc/vars.local.inc.php</code> which overrides defaults settings found in <code>data/web/inc/vars.inc.php</code>.</p> <p>The local configuration file is persistent over updates of mailcow. Try not to change values inside <code>data/web/inc/vars.inc.php</code>, but use them as template for the local override.</p> <p>mailcow UI configuration parameters can be used to...</p> <ul> <li>...change the default language<sup>1</sup></li> <li>...change the default bootstrap theme</li> <li>...set a password complexity regex</li> <li>...enable DKIM private key visibility</li> <li>...set a pagination trigger size</li> <li>...set default mailbox attributes</li> <li>...change session lifetimes</li> <li>...create fixed app menus (which cannot be changed in mailcow UI)</li> <li>...set a default \"To\" field for relayhost tests</li> <li>...set a timeout for Docker API requests</li> <li>...toggle IP anonymization</li> </ul> <ol> <li> <p>To change SOGos default language, you will need to edit <code>data/conf/sogo/sogo.conf</code> and replace \"English\" by your preferred language. ↩</p> </li> </ol>","path":["U e mailcow ui config.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-css.de/","level":1,"title":"U e mailcow ui css.de","text":"<p>Für benutzerdefinierte Überschreibungen bestimmter Elemente über CSS, verwenden Sie die <code>data/web/css/build/0081-custom-mailcow.css</code> Datei.</p> <p>Die Datei wird von der Verfolgung (via Git) ausgeschlossen und bleibt bei Aktualisierungen erhalten.</p>","path":["U e mailcow ui css.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-css.en/","level":1,"title":"U e mailcow ui css.en","text":"<p>For custom overrides of specific elements via CSS, use <code>data/web/css/build/0081-custom-mailcow.css</code>.</p> <p>The file is excluded from tracking and persists over updates.</p>","path":["U e mailcow ui css.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-fido.de/","level":1,"title":"U e mailcow ui fido.de","text":"","path":["U e mailcow ui fido.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-fido.de/#wie-wird-uv-in-mailcow-gehandhabt","level":2,"title":"Wie wird UV in mailcow gehandhabt?","text":"<p>Das UV-Flag (wie in \"user verification\") erzwingt, dass WebAuthn den Benutzer verifiziert, bevor es den Zugriff auf den Schlüssel erlaubt (denken Sie an eine PIN). Wir erzwingen keine UV, um Logins über iOS und NFC (YubiKey) zu ermöglichen.</p>","path":["U e mailcow ui fido.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-fido.de/#login-und-schlussel-verarbeitung","level":2,"title":"Login und Schlüssel-Verarbeitung","text":"<p>mailcow verwendet Client-seitige Schlüsselverarbeitung. Wir bitten den Authentifikator (d.h. YubiKey), die Registrierung in seinem Speicher zu speichern.</p> <p>Ein Benutzer muss keinen Benutzernamen eingeben. Die verfügbaren Anmeldedaten - falls vorhanden - werden dem Nutzer angezeigt, wenn er den \"Schlüssel-Login\" über das mailcow UI Login auswählt.</p> <p>Beim Aufruf des Login-Prozesses werden dem Authentifikator keine Credential-IDs übergeben. Dies wird ihn dazu zwingen, die Anmeldeinformationen in seinem eigenen Speicher zu suchen.</p>","path":["U e mailcow ui fido.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-fido.de/#wer-kann-webauthn-benutzen-um-sich-bei-mailcow-anzumelden","level":2,"title":"Wer kann WebAuthn benutzen, um sich bei mailcow anzumelden?","text":"<p>Ab heute sind nur Administratoren und Domain-Administratoren in der Lage, WebAuthn/FIDO2 einzurichten.</p> <p>Sie wollen WebAuthn/Fido als 2FA verwenden? Schauen Sie sich das hier an: Zwei-Faktoren-Authentifizierung</p>","path":["U e mailcow ui fido.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-fido.en/","level":1,"title":"U e mailcow ui fido.en","text":"","path":["U e mailcow ui fido.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-fido.en/#how-is-uv-handled-in-mailcow","level":2,"title":"How is UV handled in mailcow?","text":"<p>The UV flag (as in \"user verification\") enforces WebAuthn to verify the user before it allows access to the key (think of a PIN). We don't enforce UV to allow logins via iOS and NFC (YubiKey).</p>","path":["U e mailcow ui fido.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-fido.en/#login-and-key-processing","level":2,"title":"Login and key processing","text":"<p>mailcow uses client-side key processing. We ask the authenticator (i.e. YubiKey) to save the registration in its memory.</p> <p>A user does not need to enter a username. The available credentials - if any - will be shown to the user when selecting the \"key login\" via mailcow UI login.</p> <p>When calling the login process, the authenticator is not given any credential IDs. This will force it to lookup credentials in its own memory.</p>","path":["U e mailcow ui fido.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-fido.en/#who-can-use-webauthn-to-login-to-mailcow","level":2,"title":"Who can use WebAuthn to login to mailcow?","text":"<p>As of today, only administrators and domain administrators are able to setup WebAuthn/FIDO2.</p> <p>You want to use WebAuthn/Fido as 2FA? Check it out here: Two-Factor Authentication</p>","path":["U e mailcow ui fido.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/","level":1,"title":"U e mailcow ui forgot password.de","text":"<p>Hinweis</p> <p>Für dieses Feature ist eine mailcow Installation ab Version 2024-08 erforderlich!</p> <p>Der aktuell installierte Patchstand kann in mailcow Versionen seit 2022 innerhalb der UI eingesehen werden.</p>","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/#vorwort","level":3,"title":"Vorwort","text":"<p>Danke!</p> <p>Diese Funktionalität wurde von der Jugendstiftung Baden-Württemberg im Rahmen eines Sponsored Developments im August 2024 in mailcow integriert.</p> <p>Vielen Dank für das Sponsoring dieses Features!</p> <p>Mit der Passwort-vergessen-Funktion ist es Mailbox-Nutzern möglich, durch die Angabe einer Backup-E-Mail-Adresse, sich einen Link zur Zurücksetzung ihres Passwortes schicken zu lassen und dieses dann zurückzusetzen.</p>","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/#voraussetzungen","level":3,"title":"Voraussetzungen","text":"<p>Damit dieses Feature für einen Benutzer aktiviert und nutzbar ist, sind folgende Dinge zu beachten:</p> <ol> <li>Der mailcow Administrator muss eine Absender E-Mail und einen Betreff (siehe unten) eingestellt haben. Die Absender E-Mail muss nicht als Mailbox existieren, die Domain allerdings muss auf mailcow komplett eingerichtet sein, so dass mit dieser das Senden und vor allem die Zustellung von E-Mails sichergestellt ist.</li> <li>Der Mailbox-Benutzer muss eine Backup-E-Mail in seinen Optionen hinterlegt haben. Dies kann der User selber tun (wenn die dazugehörige ACL nicht deaktiviert ist) oder der Administrator.</li> <li>Die Backup-E-Mail sollte eine andere E-Mail sein, als die des Mailkontos, für welches das Passwort zurückgesetzt werden soll.</li> <li>Ebenfalls muss diese Backup-E-Mail externe E-Mails empfangen dürfen und sollte (wenn möglich) bei einem anderen Anbieter liegen und nicht direkt auf dem mailcow-Server sein. (Dieser Punkt ist allerdings optional und dient nur als Empfehlung).</li> <li>Der Nutzer muss Zugriff auf das Postfach der Backup-E-Mail haben, da die Links nur eine begrenzte Zeit gültig sind.</li> </ol>","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/#einstellungsmoglichkeiten-in-der-mailcow-ui","level":3,"title":"Einstellungsmöglichkeiten in der mailcow UI","text":"","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/#mailbox-einstellungen","level":4,"title":"Mailbox-Einstellungen","text":"<p>Durch dieses Feature wird ein neues Feld in den Mailbox-Optionen hinzugefügt:</p> <p></p> <p>Achtung</p> <p>Zur Erinnerung: Dieses Feld MUSS ausgefüllt sein, damit der Benutzer sein Passwort zurücksetzen kann! Sollte es nicht gesetzt sein, ist es ihm nicht möglich, sein Passwort zurückzusetzen!</p> <p>Für Administratoren gibt es eine neue ACL, die entweder pro Mailbox im Nachhinein oder auch als Vorlage für Mailboxen gesetzt werden kann: <code>Verwalten der E-Mail zur Passwortwiederherstellung erlauben</code>: </p> <p>Hinweis</p> <p>Wenn ein Benutzer bereits eine Backup-E-Mail gesetzt hat, aber der Admin ihm diese ACL entzieht, so kann er trotzdem sein Passwort zurücksetzen, da die Backup-E-Mail weiterhin im System existiert. Die ACL verbietet dadurch also nicht automatisch die Möglichkeit, das Passwort zurückzusetzen, wenn es eine E-Mail gibt!</p> <p>Um dies zu erreichen, muss zusätzlich noch die Backup-E-Mail für den Benutzer von einem Administrator entfernt werden.</p>","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/#server-einstellungen","level":4,"title":"Server-Einstellungen","text":"<p>Der mailcow-Administrator kann (ähnlich wie die Quota- und Quarantäne-Mails) auch für die Passwort-vergessen-E-Mails das Template bearbeiten, wie die Mails dann verschickt werden sollen. Standardmäßig ist das Template immer auf Englisch.</p> <p>Dieses kann unter dem Reiter: <code>System -&gt; Konfiguration -&gt; Einstellungen -&gt; Passwort-Einstellungen</code> erreicht werden:</p> <p></p>","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.de/#versteckte-einstellungen-nicht-in-der-mailcow-ui","level":3,"title":"Versteckte Einstellungen (nicht in der mailcow UI)","text":"<p>Standardmäßig kann jeder Nutzer maximal 3 Passwort-Reset-Tokens anfordern, die dann standardmäßig 15 Minuten gültig sind.</p> <p>Server-Administratoren können die Ablaufzeit sowie die maximalen Tokens pro Nutzer allerdings konfigurieren.</p> <p>Dafür muss (falls noch nicht vorhanden) eine Datei namens <code>vars.local.inc.php</code> in dem Ordner <code>MAILCOW_ROOT/data/web/inc</code> angelegt werden.</p> <p>Diese muss dann mindestens Folgendes enthalten:</p> <pre><code>&lt;?php\n\n// Maximum number of password reset tokens that can be generated at once per user\n$PW_RESET_TOKEN_LIMIT = 3; // Zahl hier abändern auf einen anderen Wert\n\n// Maximum time in minutes a password reset token is valid\n$PW_RESET_TOKEN_LIFETIME = 15; // Zahl hier abändern auf einen anderen Wert. Wert in Minuten\n</code></pre> <p>Die Datei wird automatisch eingelesen, es ist kein Neustart von mailcow oder einem der Container erforderlich!</p>","path":["U e mailcow ui forgot password.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/","level":1,"title":"U e mailcow ui forgot password.en","text":"<p>Note</p> <p>This feature requires a mailcow installation at 2024-08!</p> <p>The currently installed patch level can be viewed in the mailcow versions since 2022 within the UI.</p>","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/#preface","level":3,"title":"Preface","text":"<p>Thank You!</p> <p>This functionality was integrated into mailcow due to the Youth Foundation Baden-Württemberg (Germany) as part of a sponsored development in August 2024.</p> <p>Thank you for sponsoring this feature!</p> <p>With the \"Forgot Password\" function, mailbox users can request a link to reset their password by providing a backup email address and then reset their password.</p>","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/#requirements","level":3,"title":"Requirements","text":"<p>To activate and use this feature for a user, the following must be noted:</p> <ol> <li>The mailcow administrator must have configured a sender email and a subject (see below). The sender email does not need to exist as a mailbox; however, the domain must be fully set up in mailcow to ensure that sending and especially delivery of emails is guaranteed.</li> <li>The mailbox user must have a backup email address set in their options. This can be done by the user themselves (if the corresponding ACL is not disabled) or by the administrator.</li> <li>The backup email should be different from the email address of the account for which the password is to be reset.</li> <li>The backup email must also be able to receive external emails and should, if possible, be from a different provider and not directly on the mailcow server (this point is optional and serves only as a recommendation).</li> <li>The user must have access to the backup email's mailbox since the links are only valid for a limited time.</li> </ol>","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/#configuration-options-in-the-mailcow-ui","level":3,"title":"Configuration Options in the mailcow UI","text":"","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/#mailbox-settings","level":4,"title":"Mailbox Settings","text":"<p>This feature adds a new field to the mailbox options:</p> <p></p> <p>Attention</p> <p>Reminder: This field MUST be filled in for the user to reset their password! If it is not set, they will not be able to reset their password!</p> <p>For administrators, there is a new ACL that can be set either per mailbox afterwards or as a template for mailboxes: <code>Allow management of the password recovery email</code>: </p> <p>Note</p> <p>If a user has already set a backup email but the admin removes this ACL from them, they can still reset their password since the backup email remains in the system. The ACL does not automatically forbid the possibility of resetting the password if there is an email!</p> <p>To achieve this, the backup email for the user must also be removed by an administrator.</p>","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/#server-settings","level":4,"title":"Server Settings","text":"<p>The mailcow administrator can also edit the template for the \"Forgot Password\" emails, similar to the quota and quarantine emails, to customize how the emails are sent. By default, the template is always in English.</p> <p>This can be accessed under the tab: <code>System -&gt; Configuration -&gt; Options -&gt; Password Settings</code>:</p> <p></p>","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-forgot_password.en/#hidden-settings-not-in-the-mailcow-ui","level":3,"title":"Hidden Settings (not in the mailcow UI)","text":"<p>By default, each user can request a maximum of 3 password reset tokens, which are valid for 15 minutes.</p> <p>Server administrators can configure the expiration time and the maximum tokens per user.</p> <p>For this, a file named <code>vars.local.inc.php</code> must be created in the folder <code>MAILCOW_ROOT/data/web/inc</code> if it does not already exist.</p> <p>This file must contain at least the following:</p> <pre><code>&lt;?php\n\n// Maximum number of password reset tokens that can be generated at once per user\n$PW_RESET_TOKEN_LIMIT = 3; // Change this number to another value\n\n// Maximum time in minutes a password reset token is valid\n$PW_RESET_TOKEN_LIFETIME = 15; // Change this number to another value. Value in minutes\n</code></pre> <p>The file is automatically loaded, no restart of mailcow or any of the containers is required!</p>","path":["U e mailcow ui forgot password.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.de/","level":1,"title":"U e mailcow ui netfilter.de","text":"","path":["U e mailcow ui netfilter.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.de/#netfilter-ban-einstellungen-andern","level":2,"title":"Netfilter Ban-Einstellungen ändern","text":"<p>Um die Netfilter Ban-Einstellungen zu ändern navigieren Sie zu dem Menü Punkt: <code>Konfiguration -&gt; Server-Konfiguration -&gt; Konfiguration -&gt; Fail2ban-Parameter</code>.</p> <p>Sie sollten dann dieses Fenster sehen:</p> <p></p> <p>Hier können Sie verschiedene Optionen für die Banns selbst festlegen.  Zum Beispiel die max. Ban-Zeit oder die max. Versuche bevor ein Ban ausgeführt wird.</p>","path":["U e mailcow ui netfilter.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.de/#netfilter-regex-andern","level":2,"title":"Netfilter Regex ändern","text":"<p>Achtung</p> <p>Folgender Bereich erfordert zumindest grundlegende Regex kenntnisse.  Sollten Sie sich nicht sicher sein, was Sie dort tun, können wir Ihnen nur von der Umkonfiguration abraten.</p> <p>Sie können neben den Sperreinstellungen ebenfalls definieren, was genau aus den Logs der mailcow Container verwendet werden soll um einen möglichen Angreifer zu sperren.</p> <p>Dafür müssen Sie das Regex Feld erst einmal aufklappen, was dann in etwa so aussieht:</p> <p></p> <p>Dort können Sie nun verschiedenste neue Filter-Regeln anlegen.</p> <p>Hinweis</p> <p>Mit weiterschreitenden Updates ist es möglich, dass neue Netfilter Regex Regeln dazu kommen oder entfernt werden.  Sollte das der Fall sein empfiehlt es sich mit einem Klick auf <code>Zurücksetzen auf Standard</code> die Netfilter Regex Regeln neu laden zu lassen.</p>","path":["U e mailcow ui netfilter.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.de/#netfilter-entscheidungen-via-url-als-quelle-fur-firewall-blockregeln-bereitstellen","level":2,"title":"Netfilter Entscheidungen via URL als Quelle für Firewall Blockregeln bereitstellen","text":"<p>Hinweis</p> <p>Die Option ist jedoch standardmäßig deaktiviert und muss erst von Ihnen aktiviert werden.</p> <p>Seit dem 2023-12 Update bietet mailcow die Möglichkeit die Netfilter Entscheidungen als externer Endpoint zu exportieren um die Daten daraus in einem externen Firewall System einbinden zu können, Quasi als Blocklisten Quelle.</p> Was bringt mir diese Funktion? <p>Mit dieser Funktionalität können Sie die von Netfilter als gesperrt Markierten IPs an einen Endpunkt weitergeben, welcher diese IPs dann verarbeiten kann. Bspw. eine OPNsense Firewall kann diese Liste dynamisch reinladen.</p> <p>Schauen wir uns doch mal diese Einstellungen dazu an:</p> <p></p> <p>Um die generelle Funktion zu aktivieren muss der Haken bei <code>Fail2Ban extern verwalten</code> gesetzt werden.</p> <p>Sobald dies getan ist kann die URL (Punkt 2) kopiert werden und in den jeweiligen Endpunkt eingesetzt werden.</p> <p>Wichtig</p> <p>Die URL kann bei bedarf regeneriert werden. Dafür auf das Symbol neben Kopieren <code>Neuladen Symbol</code> klicken.</p>","path":["U e mailcow ui netfilter.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.en/","level":1,"title":"U e mailcow ui netfilter.en","text":"","path":["U e mailcow ui netfilter.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.en/#change-netfilter-ban-settings","level":2,"title":"Change Netfilter Ban Settings","text":"<p>To change the Netfilter settings in general please navigate to: <code>Configuration -&gt; Configuration &amp; Details -&gt; Configuration -&gt; Fail2ban parameters</code>.</p> <p>You should now see a familar interface:</p> <p></p> <p>Here you can set several options regarding the bans itself.  For example the max. Ban time or the max. attempts before a ban is executed.</p>","path":["U e mailcow ui netfilter.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.en/#change-netfilter-regex","level":2,"title":"Change Netfilter Regex","text":"<p>Danger</p> <p>The following area requires at least basic regex knowledge.  If you are not sure what you are doing there, we can only advise you not to attempt a reconfiguration.</p> <p>In addition to the ban settings, you can also define what exactly should be used from the mailcow container logs to ban a possible attacker.</p> <p>To do this, you must first expand the regex field, which will look something like this:</p> <p></p> <p>There you can now create various new filter rules.</p> <p>Info</p> <p>As updates progress, it is possible that new Netfilter regex rules will be added or removed.  If this is the case, it is recommended to reset the Netfilter regex rules by clicking on <code>Reset to default</code>.</p>","path":["U e mailcow ui netfilter.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-netfilter.en/#provide-netfilter-decisions-via-url-as-source-for-firewall-block-rules","level":2,"title":"Provide Netfilter decisions via URL as source for firewall block rules","text":"<p>Info</p> <p>However, the option is deactivated by default and must first be activated by you.</p> <p>Since the 2023-12 update, mailcow offers the possibility to export the netfilter decisions as an external endpoint in order to be able to integrate the data from it into an external firewall system, quasi as a blocklist source.</p> What does this function do for me? <p>With this functionality, you can forward the IPs marked as blocked by Netfilter to an endpoint, which can then process these IPs. For example, an OPNsense firewall can dynamically load this list.</p> <p>Let's take a look at these settings:</p> <p></p> <p>To activate the general function, the checkbox <code>Manage Fail2Ban externally</code> must be checked.</p> <p>As soon as this is done, the URL (point 2) can be copied and pasted into the respective endpoint.</p> <p>Important</p> <p>The URL can be regenerated if required. To do this, click on the symbol next to Copy <code>Reload symbol</code>.</p>","path":["U e mailcow ui netfilter.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-notification-templates.de/","level":1,"title":"U e mailcow ui notification templates.de","text":"<p>mailcow verwendet für die Benachrichtigungs-Mails die Template-Engine Jinja. Durch Platzhalter können mit diesen Templates dynamische Inhalte erzeugt werden, indem bei der Ausführung diese Platzhalter mit übergeben Variablen ersetzt werden. Eine Doku zur Entwicklung von Jinja Templates findet sich hier. </p> <p>Für die Templates der Benachrichtungs-Emails können die folgenden Variablen verwendet werden:</p>","path":["U e mailcow ui notification templates.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-notification-templates.de/#quarantane-template","level":2,"title":"Quarantäne Template","text":"<p>Die bereitgestellten Variablen können auch auf GitHub aus dem Script dovecot/quarantine_notify.py entnommen werden.</p> <p>Info</p> <p>Das Template für die Qarantäne Mails kann man als Administrator in der Benutzeroberfläche in den globalen Quarantäne-Einstellungen bearbeiten und dort ebenso das Standard Template wiederherstellen.  Code Beispiele kann man dem Standard Template entnehmen. Es kann auch auf GitHub eingesehen werden.</p> Name Inhalt username E-Mail Adresse des Mailbox Benutzers counter Anzahl der Nachrichten in der Quarantäne, über die in dieser Mail benachrichtigt wird hostname Name der Mailcow Instanz (Siehe auch die Umgebungsvariable MAILCOW_HOSTNAME) quarantine_acl Einstellung der Quarantäne ACL des Benutzers (Berechtigung zur Bearbeitung von Mails in der Quarantäne) meta Array/Liste aller Nachrichten/Einträge in der Quarantäne, über die benachrichtigt wird meta.qhash Hashwert des Quarantäne Eintrags (Bspw für Direktlink zur Nachricht in der Quarantäne) meta.id ID des Quarantäne Eintrags meta.subject Titel der E-Mail des Quarantäne Eintrags meta.score Spam Score der E-Mail des Quarantäne Eintrags meta.sender Absender Adresse der E-Mail des Quarantäne Eintrags meta.created Datum der Erstellung des Quarantäne Eintrags, bzw Empfang der E-Mail meta.action Aktion des Spamfilters (Verschoben in Spam-Ordner oder in die Quarantäne)","path":["U e mailcow ui notification templates.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-notification-templates.de/#quota-template","level":2,"title":"Quota Template","text":"<p>Die bereitgestellten Variablen können auch auf GitHub aus dem Script dovecot/quota_notify.py entnommen werden.</p> <p>Info</p> <p>Das Template für die Quota Mails kann man als Administrator in der Benutzeroberfläche in den Quota-Einstellungen bearbeiten und dort ebenso das Standard Template wiederherstellen.  Code Beispiele kann man dem Standard Template entnehmen. Es kann auch auf GitHub eingesehen werden.</p> Name Inhalt username E-Mail Adresse des Mailbox Benutzers percent Prozentualer Anteil des belegten Speicherplatzes der Mailbox","path":["U e mailcow ui notification templates.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-notification-templates.en/","level":1,"title":"U e mailcow ui notification templates.en","text":"<p>mailcow uses the template engine Jinja for the notification mails. Placeholders can be used to create dynamic content with these templates by replacing them with passed variables during execution. A documentation about the development of Jinja templates can be found here.</p> <p>The following variables can be used for the notification email templates:</p>","path":["U e mailcow ui notification templates.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-notification-templates.en/#quarantine-template","level":2,"title":"Quarantine template","text":"<p>The provided variables can also be obtained on GitHub from the script dovecot/quarantine_notify.py.</p> <p>Info</p> <p>As an administrator, you can edit the template for the quarantine mails in the mailcow user interface in the global quarantine settings and restore the default template there as well.  Code examples can be found in the default template. It can also be viewed on GitHub.</p> Name Content username E-mail address of the mailbox user counter Number of messages in the quarantine, about which this e-mail informs hostname Name of the mailcow instance (See also the environment variable MAILCOW_HOSTNAME) quarantine_acl Quarantine ACL setting of the mailbox user (Permission to process the mails in the quarantine) meta Array/list of all messages in the quarantine about which this e-mail informs meta.qhash Hash value of the quarantine entry (e.g. for direct link to the message in the quarantine) meta.id ID of the quarantine entry meta.subject Title of the quarantine entry meta.score Spam score of the quarantine entry meta.sender Sender address of the quarantine entry meta.created Creation date of the quarantine entry / receipt of the e-mail meta.action Action of the spam filter (moved to spam folder or quarantine).","path":["U e mailcow ui notification templates.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-notification-templates.en/#quota-template","level":2,"title":"Quota template","text":"<p>The provided variables can also be obtained on GitHub from the script dovecot/quota_notify.py.</p> <p>Info</p> <p>The template for the quota mails can be edited as an administrator in the mailcow user interface in the quota settings and there also restore the default template.  Code examples can be found in the default template. It can also be viewed on GitHub.</p> Name Content username E-mail address of the mailbox user percent Percentage of the occupied space of the mailbox","path":["U e mailcow ui notification templates.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-pushover.de/","level":1,"title":"U e mailcow ui pushover.de","text":"<p>Info</p> <p>Pushover macht es einfach, Echtzeit-Benachrichtigungen auf Ihrem Android, iPhone, iPad und Desktop zu erhalten</p> <p>Sie können Pushover verwenden, um eine Push-Benachrichtigung über jede E-Mail zu erhalten, die Sie für jede Mailbox erhalten, in der Sie diese Funktion aktiviert haben.</p> <p>1. Öffnen Sie als Administrator die Einstellungen Ihres Postfachs und scrollen Sie nach unten zu den Pushover-Einstellungen</p> <p>2. Registrieren Sie sich bei Pushover</p> <p>3. Geben Sie Ihren \"Benutzerschlüssel\" in das Feld \"Benutzer-/Gruppenschlüssel\" in den Einstellungen Ihres Postfachs ein</p> <p>4. Erstellen Sie eine Anwendung, um das API-Token/den API-Schlüssel zu erhalten, das/den Sie ebenfalls in Ihre Postfacheinstellungen eintragen müssen.</p> <p>5. Optional können Sie den Titel/Text der Benachrichtigung bearbeiten und bestimmte Absender-E-Mail-Adressen festlegen, bei denen eine Push-Benachrichtigung ausgelöst wird</p> <p>6. Speichern Sie alles und überprüfen Sie dann Ihre Anmeldedaten.</p> <p>Wenn alles erledigt ist, können Sie testen, ob Sie eine E-Mail senden können, und Sie erhalten eine Push-Nachricht auf Ihrem Telefon</p>","path":["U e mailcow ui pushover.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-pushover.en/","level":1,"title":"U e mailcow ui pushover.en","text":"<p>Info</p> <p>Pushover makes it easy to get real-time notifications on your Android, iPhone, iPad, and Desktop</p> <p>You can use Pushover to get a push notification on every mail you receive for each mailbox where you enabled this feature.</p> <p>1. As admin open your mailbox' settings and scroll down to the Pushover settings</p> <p>2. Register yourself on Pushover</p> <p>3. Put your 'User Key' in the 'User/Group Key' field in your mailbox settings</p> <p>4. Create an Applications to get the API Token/Key which you also need to put in your mailbox settings</p> <p>5. Optional you can edit the notification title/text and define certain sender email addresses where a push notification is triggered</p> <p>6. Save everything and then you can verify your credentials</p> <p>If everything is done you can test sending a mail and you will receive a push message on your phone</p>","path":["U e mailcow ui pushover.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-spamalias.de/","level":1,"title":"U e mailcow ui spamalias.de","text":"<p>Diese temporären E-Mail-Aliasnamen werden meist dort verwendet, wo wir eine E-Mail-Adresse angeben müssen, aber keine weitere E-Mails wünschen. Sie werden auch Spam-Alias genannt.</p> <p>Um ein temporäres E-Mail-Alias zu erstellen, zu löschen oder zu erweitern, müssen Sie sich in mailcow's UI als Mailbox-Nutzer anmelden und zum Reiter Temporäre E-Mail-Aliase navigieren:</p> <p></p>","path":["U e mailcow ui spamalias.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-spamalias.en/","level":1,"title":"U e mailcow ui spamalias.en","text":"<p>These temporary email aliases are mostly used for places where we need to provide an email address but don't want future correspondence with. They are also called spam alias.</p> <p>To create, delete or extend a temporary email aliases you need to login to mailcow's UI as a mailbox user and navigate to the tab Temporary email aliases:</p> <p></p>","path":["U e mailcow ui spamalias.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-spamfilter.de/","level":1,"title":"U e mailcow ui spamfilter.de","text":"<p>Ein Mailbox-Nutzer kann den Spam-Filter und die Black-/Whitelist-Einstellungen für seine Mailbox individuell anpassen, indem er zum Reiter Spam-Filter in der mailcow-Benutzeroberfläche navigiert.</p> <p></p> <p>Info</p> <p>Für globale Einstellungen Ihres Spamfilters lesen Sie bitte unseren Abschnitt über Rspamd. Für eine domainweite Black- und Whitelist lesen Sie bitte unsere Anleitung zu Black / Whitelist</p>","path":["U e mailcow ui spamfilter.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-spamfilter.en/","level":1,"title":"U e mailcow ui spamfilter.en","text":"<p>A mailbox user may adjust the spam filter and black- / whitelist settings for his mailbox individually by navigating to the Spam filter tab in the users mailcow UI.</p> <p></p> <p>Info</p> <p>For global adjustments on your spam filter please check our section on Rspamd. For a domain wide black- and whitelist please check our guide on Black / Whitelist</p>","path":["U e mailcow ui spamfilter.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-sub_addressing.de/","level":1,"title":"U e mailcow ui sub addressing.de","text":"<p>Mailbox-Nutzer können ihre Mailadresse wie in \"me+facebook@example.org\" markieren. Sie können die Tag-Behandlung im mailcow UI Panel (für den Benutzer) unter <code>Mailbox &gt; Einstellungen</code> kontrollieren. </p> <p><code>Sub-Adressierung</code> (RFC 5233) oder <code>Plus-Adressierung</code> auch als Tagging bekannt (nicht zu verwechseln mit Tags)</p>","path":["U e mailcow ui sub addressing.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-sub_addressing.de/#verfugbare-aktionen","level":3,"title":"Verfügbare Aktionen","text":"<p>1. Diese Nachricht in einen Unterordner \"facebook\" verschieben (wird in Kleinbuchstaben erstellt, falls nicht vorhanden)</p> <p>2. Den Tag dem Betreff voranstellen: \"[facebook] Betreff\"</p> <p>Bitte beachten Sie: Großgeschriebene Tags werden in Kleinbuchstaben umgewandelt, mit Ausnahme des ersten Buchstabens. Wenn Sie den Tag so lassen wollen, wie er ist, wenden Sie bitte den folgenden Diff an und starten Sie mailcow neu: <pre><code>diff --git a/data/conf/dovecot/global_sieve_after b/data/conf/dovecot/global_sieve_after\nindex e047136e..933c4137 100644\n--- a/data/conf/dovecot/global_sieve_after\n+++ b/data/conf/dovecot/global_sieve_after\n@@ -15,7 +15,7 @@ if allof (\n   envelope :detail :matches \"to\" \"*\",\n   header :contains \"X-Moo-Tag\" \"YES\"\n   ) {\n-  set :lower :upperfirst \"tag\" \"${1}\";\n+  set \"tag\" \"${1}\";\n   if mailboxexists \"INBOX/${1}\" {\n     fileinto \"INBOX/${1}\";\n   } else {\n</code></pre></p>","path":["U e mailcow ui sub addressing.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-sub_addressing.en/","level":1,"title":"U e mailcow ui sub addressing.en","text":"<p>Mailbox users can tag their mail address like in <code>me+facebook@example.org</code>. They can control the tag handling in the users mailcow UI panel under <code>Mailbox &gt; Settings</code>. </p> <p><code>sub-addressing</code> (RFC 5233) or <code>plus addressing</code> also known as tagging (do not mix with Tags)</p>","path":["U e mailcow ui sub addressing.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-sub_addressing.en/#available-actions","level":3,"title":"Available Actions","text":"<p>1. Move this message to a sub folder \"facebook\" (will be created lower case if not existing)</p> <p>2. Prepend the tag to the subject: \"[facebook] Subject\"</p> <p>Please note: Uppercase tags are converted to lowercase except for the first letter. If you want to keep the tag as it is, please apply the following diff and restart mailcow: <pre><code>diff --git a/data/conf/dovecot/global_sieve_after b/data/conf/dovecot/global_sieve_after\nindex e047136e..933c4137 100644\n--- a/data/conf/dovecot/global_sieve_after\n+++ b/data/conf/dovecot/global_sieve_after\n@@ -15,7 +15,7 @@ if allof (\n   envelope :detail :matches \"to\" \"*\",\n   header :contains \"X-Moo-Tag\" \"YES\"\n   ) {\n-  set :lower :upperfirst \"tag\" \"${1}\";\n+  set \"tag\" \"${1}\";\n   if mailboxexists \"INBOX/${1}\" {\n     fileinto \"INBOX/${1}\";\n   } else {\n</code></pre></p>","path":["U e mailcow ui sub addressing.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tags.de/","level":1,"title":"U e mailcow ui tags.de","text":"<p>Hinweis</p> <p>Um diese Funktion nutzen zu können ist das Update 2022-05 (oder höher) erforderlich! Sollten Sie das Update nicht installiert haben, denken Sie bitte über ein Update nach. Für weitere Informationen bezüglich dem Update Prozess schauen Sie hier.</p>","path":["U e mailcow ui tags.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tags.de/#wofur-wurden-die-tags-implementiert","level":3,"title":"Wofür wurden die Tags implementiert?","text":"<p>Mit den Tags ist es deutlich einfacher gezielt nach Domains bzw. Mailboxen zu suchen (wenn diese einen Tag haben).</p>","path":["U e mailcow ui tags.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tags.de/#wo-lassen-sich-die-tags-finden","level":3,"title":"Wo lassen sich die Tags finden?","text":"<p>Die Tags befinden sich in der Domain/Mailbox Sektion der mailcow UI. Um sie zu sehen, klicken Sie einfach auf das kleine Plus-Symbol auf der linken Seite Ihrer Domain/Mailbox (das folgende Bild zeigt das Domain-Ribbon-Menü): </p>","path":["U e mailcow ui tags.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tags.de/#wie-kann-ich-ein-tag-hinzufugenentfernen","level":3,"title":"Wie kann ich ein Tag hinzufügen/entfernen?","text":"<p>Sie können bei der Erstellung einer neuen Domain/eines neuen Postfachs einfach ein Tag hinzufügen/entfernen. Sie können sie auch hinzufügen/entfernen, wenn Sie Ihre gewünschte Domain/Mailbox bearbeiten.</p> <p>Es sieht ähnlich aus wie hier (das folgende Bild zeigt den Bereich zur Bearbeitung der Domäne):</p> <p></p>","path":["U e mailcow ui tags.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tags.de/#wie-kann-ich-nach-einem-tag-suchen","level":3,"title":"Wie kann ich nach einem Tag suchen?","text":"<p>Geben Sie einfach den Tag-Namen in die Suchleiste im Bereich Domain/Postfach ein und warten Sie, bis der Vorgang abgeschlossen ist.</p> <p>Sie können sogar angeben, ob Sie nur nach Tags suchen möchten.</p>","path":["U e mailcow ui tags.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tags.en/","level":1,"title":"U e mailcow ui tags.en","text":"<p>Info</p> <p>You need the mailcow Version 2022-05 at least for this feature. If you don´t have the Version installed please consider a update. For more informations about a mailcow update please take a look at the Update section here in the docs.</p>","path":["U e mailcow ui tags.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tags.en/#what-are-tags-designed-for","level":3,"title":"What are Tags designed for?","text":"<p>With the Tags you can easily sort your Domains and Mailboxes by the tags instead of their name.</p>","path":["U e mailcow ui tags.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tags.en/#where-are-the-tags-located","level":3,"title":"Where are the Tags located?","text":"<p>The Tags are located in the Domain/Mailbox section of the mailcow UI. To view them simply click on the small plus symbol on the left of your Domain/Mailbox (following picture is showing the domain ribbon menu): </p>","path":["U e mailcow ui tags.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tags.en/#how-can-i-addremove-a-tag","level":3,"title":"How can i add/remove a Tag?","text":"<p>You can simply add/remove a Tag during the creation of a new Domain/Mailbox. You also can add/remove them if you edit your desired Domain/Mailbox.</p> <p>It looks similar to this (following picture showing the domain edit section):</p> <p></p>","path":["U e mailcow ui tags.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tags.en/#how-can-i-search-for-a-tag","level":3,"title":"How can i search for a tag?","text":"<p>Simply type the Tag Name in the search bar in the Domain/Mailbox Section and wait for it to complete.</p> <p>You can even specify if you want to search for tags only.</p>","path":["U e mailcow ui tags.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/","level":1,"title":"U e mailcow ui tfa.de","text":"<p>Bislang sind drei Methoden für die Zwei-Faktor-Authentifizierung implementiert: WebAuthn (ersetzt seit Februar 2022 U2F), Yubi OTP und TOTP</p> <ul> <li>Damit WebAuthn funktioniert, benötigen Sie eine verschlüsselte Verbindung zum Server (HTTPS) sowie einen FIDO-Sicherheitsschlüssel.</li> <li>Sowohl WebAuthn als auch Yubi OTP funktionieren gut mit dem fantastischen Yubikey.</li> <li>Während Yubi OTP eine aktive Internetverbindung und eine API ID + Schlüssel benötigt, funktioniert WebAuthn mit jedem Fido Security Key, kann aber nur verwendet werden, wenn der Zugriff auf mailcow über HTTPS erfolgt.</li> <li>WebAuthn und Yubi OTP unterstützen mehrere Schlüssel pro Nutzer.</li> <li>Als dritte TFA-Methode verwendet mailcow TOTP: zeitbasierte Einmal-Passwörter. Diese Passwörter können mit Apps wie \"Google Authenticator\" generiert werden, nachdem zunächst ein QR-Code gescannt oder das gegebene Geheimnis manuell eingegeben wurde.</li> </ul> <p>Als Administrator können Sie den TFA-Login eines Domain-Administrators vorübergehend deaktivieren, bis dieser sich erfolgreich eingeloggt hat.</p> <p>Der für die Anmeldung verwendete Schlüssel wird in grüner Farbe angezeigt, während andere Schlüssel grau bleiben.</p> <p>Informationen zum Entfernen von 2FA finden Sie hier.</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#yubi-otp","level":2,"title":"Yubi OTP","text":"<p>Die Yubi API ID und der Schlüssel werden mit der Yubico Cloud API abgeglichen. Bei der Einrichtung von TFA werden Sie nach Ihrem persönlichen API-Konto für diesen Schlüssel gefragt. Die API-ID, der API-Schlüssel und die ersten 12 Zeichen (Ihre YubiKeys ID in modhex) werden in der MySQL-Tabelle als Geheimnis gespeichert.</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#beispiel-einrichtung","level":3,"title":"Beispiel-Einrichtung","text":"<p>Als erstes muss der YubiKey für die Verwendung als OTP-Generator konfiguriert werden. Laden Sie dazu den <code>YubiKey Manager</code> von der Yubico Website herunter: hier</p> <p>Im Folgenden konfigurieren Sie den YubiKey für OTP. Über den Menüpunkt <code>Anwendungen</code> -&gt; <code>OTP</code> und einem Klick auf den <code>Konfigurieren</code> Button. Wählen Sie im folgenden Menü <code>Credential Type</code> -&gt; <code>Yubico OTP</code> und klicken Sie auf <code>Next</code>.</p> <p>Setzen Sie ein Häkchen in die Checkbox <code>Use serial</code>, generieren Sie eine <code>Private ID</code> und einen <code>Secret key</code> über die Schaltflächen.  Damit der YubiKey später validiert werden kann, muss auch das Häkchen in der <code>Upload</code> Checkbox gesetzt werden und klicken Sie dann auf <code>Finish</code>.</p> <p>Nun öffnet sich ein neues Browserfenster, in dem Sie unten im Formular ein OTP Ihres YubiKey eingeben müssen (auf das Feld klicken und dann auf Ihren YubiKey tippen). Bestätigen Sie das Captcha und laden Sie die Daten auf den Yubico-Server hoch, indem Sie auf 'Hochladen' klicken. Die Verarbeitung der Daten wird einen Moment dauern.</p> <p>Nachdem die Generierung erfolgreich war, werden Ihnen eine <code>Client ID</code> und ein <code>Secret key</code> angezeigt, notieren Sie sich diese Informationen an einem sicheren Ort.</p> <p>Nun können Sie <code>Yubico OTP-Authentifizierung</code> aus dem Dropdown-Menü in der mailcow UI auf der Startseite unter <code>Zugang</code> -&gt; <code>Zwei-Faktor-Authentifizierung</code> auswählen.  In dem sich nun öffnenden Dialog können Sie einen Namen für diesen YubiKey eingeben und die zuvor notierte <code>Client ID</code> sowie den <code>Secret key</code> in die vorgesehenen Felder eintragen. Geben Sie schließlich Ihr aktuelles Kontopasswort ein und berühren Sie nach Auswahl des Feldes <code>Touch Yubikey</code> die Schaltfläche Ihres YubiKey.</p> <p>Herzlichen Glückwunsch! Sie können sich nun mit Ihrem YubiKey in die mailcow UI einloggen!</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#webauthn-u2f-ersatz","level":2,"title":"WebAuthn (U2F, Ersatz)","text":"<p>Warnung</p> <p>Seit Februar 2022 hat Google Chrome die Unterstützung für U2F aufgegeben und die Verwendung von WebAuthn standardisiert. Die WebAuthn API (der Ersatz für U2F) ist seit dem 21. Januar 2022 Teil von mailcow, wenn Sie also den Key über Februar 2022 hinaus nutzen wollen, sollten Sie ein Update mit der <code>update.sh</code> in Betracht ziehen. </p> <p>Um WebAuthn zu nutzen, muss der Browser diesen Standard unterstützen:</p> <ul> <li>Edge (&gt;=18)</li> <li>Firefox (&gt;=60)</li> <li>Chrome (&gt;=67)</li> <li>Safari (&gt;=13)</li> <li>Opera (&gt;=54)</li> </ul> <p>Die folgenden mobilen Browser unterstützen diesen Authentifizierungstyp:</p> <ul> <li>Safari auf iOS (&gt;=14.5)</li> <li>Android-Browser (&gt;=97)</li> <li>Opera Mobil (&gt;=64)</li> <li>Chrome für Android (&gt;=97)</li> </ul> <p>Quellen: caniuse.com, blog.mozilla.org</p> <p>WebAuthn funktioniert auch ohne Internetverbindung.</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#was-passiert-mit-meinem-registrierten-fido-security-key-nach-dem-update-von-u2f-auf-webauthn","level":3,"title":"Was passiert mit meinem registrierten Fido Security Key nach dem Update von U2F auf WebAuthn?","text":"<p>Warnung</p> <p>Mit dem neuen U2F-Ersatz (WebAuthn) müssen Sie Ihren Fido Security Key neu registrieren, zum Glück ist WebAuthn abwärtskompatibel und unterstützt das U2F-Protokoll.</p> <p>Im Idealfall sollten Sie beim nächsten Einloggen (mit dem Schlüssel) ein Textfeld erhalten, das besagt, dass Ihr Fido Security Key aufgrund des Updates auf WebAuthn entfernt und als 2-Faktor-Authentifikator gelöscht wurde.</p> <p>Aber keine Sorge! Sie können Ihren bestehenden Schlüssel einfach neu registrieren und ihn wie gewohnt verwenden. Sie werden wahrscheinlich nicht einmal einen Unterschied bemerken, außer dass Ihr Browser die U2F-Deaktivierungsmeldung nicht mehr anzeigt.</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#deaktivieren-inoffizieller-unterstutzter-fido-security-keys","level":3,"title":"Deaktivieren inoffizieller unterstützter Fido Security Keys","text":"<p>Mit WebAuthn gibt es die Möglichkeit, nur offizielle Fido Security Keys zu verwenden (von den großen Marken wie: Yubico, Apple, Nitro, Google, Huawei, Microsoft, usw.) zu verwenden.</p> <p>Dies dient in erster Linie der Sicherheit, da es Administratoren ermöglicht, sicherzustellen, dass nur offizielle Hardware in ihrer Umgebung verwendet werden kann.</p> <p>Um diese Funktion zu aktivieren, ändern Sie den Wert <code>WEBAUTHN_ONLY_TRUSTED_VENDORS</code> in mailcow.conf von <code>n</code> auf <code>y</code> und starten Sie die betroffenen Container mit dem folgenden Befehl neu: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Die mailcow wird nun die Vendor-Zertifikate verwenden, die sich in Ihrem mailcow-Verzeichnis unter <code>data/web/inc/lib/WebAuthn/rootCertificates</code> befinden. </p> <p>Beispiel</p> <p>Wenn Sie die offiziellen Hersteller-Geräte nur auf Apple beschränken wollen, brauchen Sie nur das Apple Hersteller-Zertifikat im <code>data/web/inc/lib/WebAuthn/rootCertificates</code>. Nachdem Sie alle anderen Zertifikate gelöscht haben, können Sie WebAuthn 2FA nur noch mit Apple-Geräten aktivieren.</p> <p>Das ist für jeden Hersteller gleich, also wählen Sie aus, was Ihnen gefällt (wenn Sie wollen).</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#eigene-zertifikate-fur-webauthn-verwenden","level":3,"title":"Eigene Zertifikate für WebAuthn verwenden","text":"<p>Wenn Sie ein gültiges Zertifikat vom Hersteller eines Schlüssels haben, können Sie es auch zu ihrer mailcow hinzufügen!</p> <p>Kopieren Sie einfach das Zertifikat in den <code>data/web/inc/lib/WebAuthn/rootCertificates</code> Ordner und starten Sie Ihre mailcow neu.</p> <p>Nun sollten Sie in der Lage sein, auch dieses Gerät zu registrieren, obwohl die Überprüfung für die Herstellerzertifikate aktiviert ist, da Sie das Zertifikat manuell hinzugefügt haben. </p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#ist-es-gefahrlich-den-vendor-check-deaktiviert-zu-lassen","level":3,"title":"Ist es gefährlich, den Vendor Check deaktiviert zu lassen?","text":"<p>Nein, das ist es nicht! Diese Herstellerzertifikate werden nur zur Überprüfung der Originalhardware verwendet, nicht zur Absicherung des Registrierungsprozesses.</p> <p>Wie Sie in diesen Artikeln lesen können, hat die Deaktivierung nichts mit der Software-Sicherheit zu tun:</p> <ul> <li>https://developers.yubico.com/U2F/Attestation_and_Metadata/</li> <li>https://medium.com/webauthnworks/webauthn-fido2-demystifying-attestation-and-mds-efc3b3cb3651</li> <li>https://medium.com/webauthnworks/sorting-fido-ctap-webauthn-terminology-7d32067c0b01</li> </ul> <p>Letztendlich ist es aber natürlich Ihre Entscheidung, ob Sie dieses Häkchen deaktiviert oder aktiviert lassen. </p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.de/#totp","level":2,"title":"TOTP","text":"<p>Die bekannteste TFA-Methode, die meist mit einem Smartphone verwendet wird.</p> <p>Um die TOTP-Methode einzurichten, loggen Sie sich in die Admin UI ein und wählen Sie <code>Time-based OTP (TOTP)</code> aus der Liste.</p> <p>Nun öffnet sich ein Modal, in dem Sie einen Namen für Ihr 2FA-\"Gerät\" (Beispiel: John Deer's Smartphone) und das Passwort des betroffenen Admin-Kontos (mit dem Sie derzeit eingeloggt sind) eingeben müssen.</p> <p>Sie haben zwei verschiedene Methoden, um TOTP für Ihr Konto zu registrieren: 1. Scannen Sie den QR-Code mit Ihrer Authenticator App auf einem Smartphone oder Tablet. 2. Verwenden Sie den TOTP-Code (unter dem QR-Code) in Ihrem TOTP-Programm oder Ihrer App (wenn Sie keinen QR-Code scannen können).</p> <p>Nachdem Sie den QR- oder TOTP-Code in der TOTP-App/dem TOTP-Programm Ihrer Wahl registriert haben, müssen Sie nur noch den nun generierten TOTP-Token (in der App/dem Programm) als Bestätigung in der mailcow UI eingeben, um die TOTP 2FA endgültig zu aktivieren, ansonsten wird sie nicht aktiviert, obwohl der TOTP-Token bereits in Ihrer App/ Ihrem Programm generiert wurde.</p>","path":["U e mailcow ui tfa.de"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/","level":1,"title":"U e mailcow ui tfa.en","text":"<p>So far three methods for Two-Factor Authentication are implemented: WebAuthn (replacing U2F since February 2022), Yubi OTP, and TOTP</p> <ul> <li>For WebAuthn to work, you need an encrypted connection to the server (HTTPS) as well as a FIDO security key.</li> <li>Both WebAuthn and Yubi OTP work well with the fantastic Yubikey.</li> <li>While Yubi OTP needs an active internet connection and an API ID + key, WebAuthn will work with any Fido Security Key out of the box, but can only be used when mailcow is accessed over HTTPS.</li> <li>WebAuthn and Yubi OTP support multiple keys per user.</li> <li>As the third TFA method mailcow uses TOTP: time-based one-time passwords. Those passwords can be generated with apps like \"Google Authenticator\" after initially scanning a QR code or entering the given secret manually.</li> </ul> <p>As administrator you are able to temporary disable a domain administrators TFA login until they successfully logged in.</p> <p>The key used to login will be displayed in green, while other keys remain grey.</p> <p>Information on how to remove 2FA can be found here.</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#yubi-otp","level":2,"title":"Yubi OTP","text":"<p>The Yubi API ID and Key will be checked against the Yubico Cloud API. When setting up TFA you will be asked for your personal API account for this key. The API ID, API key and the first 12 characters (your YubiKeys ID in modhex) are stored in the MySQL table as secret.</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#example-setup","level":3,"title":"Example setup","text":"<p>First of all, the YubiKey must be configured for use as an OTP Generator. To do this, download the <code>YubiKey Manager</code> from the Yubico website: here</p> <p>In the following you configure the YubiKey for OTP. Via the menu item <code>Applications</code> -&gt; <code>OTP</code> and a click on the <code>Configure</code> button. In the following menu select <code>Credential Type</code> -&gt; <code>Yubico OTP</code> and click on <code>Next</code>.</p> <p>Set a checkmark in the <code>Use serial</code> checkbox, generate a <code>Private ID</code> and a <code>Secret key</code> via the buttons.  So that the YubiKey can be validated later, the checkmark in the <code>Upload</code> checkbox must also be set and then click on <code>Finish</code>.</p> <p>Now a new browser window will open in which you have to enter an OTP of your YubiKey at the bottom of the form (click on the field and then tap on your YubiKey). Confirm the captcha and upload the information to the Yubico server by clicking 'Upload'. The processing of the data will take a moment.</p> <p>After the generation was successful, you will be shown a <code>Client ID</code> and a <code>Secret key</code>, make a note of this information in a safe place.</p> <p>Now you can select <code>Yubico OTP authentication</code> from the dropdown menu in the mailcow UI on the start page under <code>Access</code> -&gt; <code>Two-factor authentication</code>.  In the dialog that opened now you can enter a name for this YubiKey and insert the <code>Client ID</code> you noted before as well as the <code>Secret key</code> into the fields provided. Finally, enter your current account password and, after selecting the <code>Touch Yubikey</code> field, touch your YubiKey button.</p> <p>Congratulations! You can now log in to the mailcow UI using your YubiKey!</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#webauthn-u2f-replacement","level":2,"title":"WebAuthn (U2F, replacement)","text":"<p>Warning</p> <p>Since February 2022 Google Chrome has discarded support for U2F and standardized the use of WebAuthn. The WebAuthn (U2F removal) is part of mailcow since 21th January 2022, so if you want to use the Key past February 2022 please consider a update with the <code>update.sh</code> </p> <p>To use WebAuthn, the browser must support this standard.</p> <p>The following desktop browsers support this authentication type:</p> <ul> <li>Edge (&gt;=18)</li> <li>Firefox (&gt;=60)</li> <li>Chrome (&gt;=67)</li> <li>Safari (&gt;=13)</li> <li>Opera (&gt;=54)</li> </ul> <p>The following mobile browsers support this authentication type:</p> <ul> <li>Safari on iOS (&gt;=14.5)</li> <li>Android Browser (&gt;=97)</li> <li>Opera Mobile (&gt;=64)</li> <li>Chrome for Android (&gt;=97)</li> </ul> <p>Sources: caniuse.com, blog.mozilla.org</p> <p>WebAuthn works without an internet connection.</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#what-will-happen-to-my-registered-fido-security-key-after-the-update-from-u2f-to-webauthn","level":3,"title":"What will happen to my registered Fido Security Key after the Update from U2F to WebAuthn?","text":"<p>Warning</p> <p>With this new U2F replacement (WebAuthn) you have to re-register your Fido Security Key, thankfully WebAuthn is backwards compatible and supports the U2F protocol.</p> <p>Ideally, the next time you log in (with the key), you should get a text box saying that your Fido Security Key has been removed due to the update to WebAuthn and deleted as a 2-factor authenticator.</p> <p>But don't worry! You can simply re-register your existing key and use it as usual, you probably won't even notice a difference, except that your browser won't show the U2F deactivation message anymore.</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#disable-unofficial-supported-fido-security-keys","level":3,"title":"Disable unofficial supported Fido Security Keys","text":"<p>With WebAuthn there is the possibility to use only official Fido Security Keys (from the big brands like: Yubico, Apple, Nitro, Google, Huawei, Microsoft, etc.).</p> <p>This is primarily for security purposes, as it allows administrators to ensure that only official hardware can be used in their environment.</p> <p>To enable this feature, change the value <code>WEBAUTHN_ONLY_TRUSTED_VENDORS</code> in mailcow.conf from <code>n</code> to <code>y</code> and restart the affected containers with the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>The mailcow will now use the Vendor Certificates located in your mailcow directory under <code>data/web/inc/lib/WebAuthn/rootCertificates</code>. </p> <p>Example</p> <p>If you want to limit the official Vendor devices to Apple only you only need the Apple Vendor Certificate inside the <code>data/web/inc/lib/WebAuthn/rootCertificates</code>. After you deleted all other certs you now only can activate WebAuthn 2FA with Apple devices.</p> <p>Every vendor (listed there) behaves the same, so choose what you like (if you want to).</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#use-own-certificates-for-webauthn","level":3,"title":"Use own certificates for WebAuthn","text":"<p>If you have a valid certificate from the vendor of your key you can also add it to your mailcow!</p> <p>Just copy the certificate into the <code>data/web/inc/lib/WebAuthn/rootCertificates</code> folder and restart your mailcow.</p> <p>Now you should be able to register this device as well, even though the verification for the vendor certificates is enabled, since you just added the certificate manually. </p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#is-it-dangerous-to-keep-the-vendor-check-disabled","level":3,"title":"Is it dangerous to keep the Vendor Check disabled?","text":"<p>No, it isn´t! These vendor certificates are only used to verify original hardware, not to secure the registration process.</p> <p>As you can read in these articles, the deactivation is not software security related:</p> <ul> <li>https://developers.yubico.com/U2F/Attestation_and_Metadata/</li> <li>https://medium.com/webauthnworks/webauthn-fido2-demystifying-attestation-and-mds-efc3b3cb3651</li> <li>https://medium.com/webauthnworks/sorting-fido-ctap-webauthn-terminology-7d32067c0b01</li> </ul> <p>In the end, however, it is of course your decision to leave this check disabled or enabled. </p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"manual-guides/mailcow-UI/u_e-mailcow_ui-tfa.en/#totp","level":2,"title":"TOTP","text":"<p>The best known TFA method mostly used with a smartphone.</p> <p>To setup the TOTP method login to the Admin UI and select <code>Time-based OTP (TOTP)</code> from the list.</p> <p>Now a modal will open in which you have to type in a name for your 2FA \"device\" (example: John Deer´s Smartphone) and the password of the affected Admin account (you are currently logged in with).</p> <p>You have two seperate methods to register TOTP to your account: 1. Scan the QR-Code with your Authenticator App on a Smartphone or Tablet. 2. Use the TOTP Code (under the QR Code) in your TOTP Program or App (if you can´t scan a QR Code).</p> <p>After you have registered the QR or TOTP code in the TOTP app/program of your choice you only need to enter the now generated TOTP token (in the app/program) as confirmation in the mailcow UI to finally activate the TOTP 2FA, otherwise it will not be activated even though the TOTP token is already generated in your app/program.</p>","path":["U e mailcow ui tfa.en"],"tags":[]},{"location":"models/model-acl.de/","level":1,"title":"Model acl.de","text":"<p>Die Bearbeitung eines Domänenadministrators oder eines Mailboxbenutzers ermöglicht es, Einschränkungen für dieses Konto festzulegen.</p> <p>Wichtig: Bei sich überschneidenden Modulen wie Synchronisierungsaufträgen, auf die sowohl Domänenadministratoren als auch Mailbox-Benutzer Zugriff erhalten können, werden die Rechte des Domänenadministrators geerbt, wenn man sich als Mailbox-Benutzer anmeldet.</p> <p>Einige Beispiele:</p> <p>1.</p> <ul> <li>Ein Domänenadministrator hat keinen Zugriff auf Synchronisierungsaufträge, kann sich aber als Mailbox-Benutzer anmelden</li> <li>Wenn er sich als Mailbox-Benutzer anmeldet, erhält er keinen Zugriff auf Synchronisierungsaufträge, auch wenn der betreffende Mailbox-Benutzer bei der direkten Anmeldung Zugriff hat.</li> </ul> <p>2.</p> <ul> <li>Ein Domänenadministrator hat Zugriff auf Synchronisierungsaufträge und kann sich als Postfachbenutzer anmelden</li> <li>Der Mailbox-Benutzer, als der er sich anzumelden versucht, hat keinen Zugang zu Synchronisierungsaufträgen</li> <li>Der Domänenadministrator, der nun als Mailbox-Benutzer angemeldet ist, erbt die Berechtigung des Mailbox-Benutzers und kann auf Synchronisierungsaufträge zugreifen.</li> </ul> <p>3.</p> <ul> <li>Ein Domänenadministrator meldet sich als Mailbox-Benutzer an</li> <li>Jede Berechtigung, die nicht in der ACL eines Domänenadministrators vorhanden ist, wird automatisch gewährt (Beispiel: zeitlich begrenzter Alias, TLS-Richtlinie usw.)</li> </ul>","path":["Model acl.de"],"tags":[]},{"location":"models/model-acl.en/","level":1,"title":"Model acl.en","text":"<p>Editing a domain administrator or a mailbox user allows to set restrictions to that account.</p> <p>Important: For overlapping modules like sync jobs, which both domain administrators and mailbox users can be granted access to, the domain administrators permissions are inherited, when logging in as mailbox user.</p> <p>Some examples:</p> <p>1.</p> <ul> <li>A domain administror has not access to sync jobs but can login as mailbox user</li> <li>When logging in as mailbox user, he does not gain access to sync jobs, even if the given mailbox user has access when logging in directly</li> </ul> <p>2.</p> <ul> <li>A domain administror has access to sync jobs and can login as mailbox user</li> <li>The mailbox user he tries to login as has not access to sync jobs</li> <li>The domain administrator, now logged in as mailbox user, inherits its permission to the mailbox user and can access sync jobs</li> </ul> <p>3.</p> <ul> <li>A domain administrator logs in as mailbox user</li> <li>Every permission, that does not exist in a domain administrators ACL, is automatically granted (example: time-limited alias, TLS policy etc.)</li> </ul>","path":["Model acl.en"],"tags":[]},{"location":"models/model-passwd.de/","level":1,"title":"Model passwd.de","text":"","path":["Model passwd.de"],"tags":[]},{"location":"models/model-passwd.de/#vollstandig-unterstutzte-hashing-methoden","level":2,"title":"Vollständig unterstützte Hashing-Methoden","text":"<p>Die aktuellste Version von mailcow unterstützt die folgenden Hashing-Methoden vollständig. Die Standard-Hashing-Methode ist fett geschrieben:</p> <ul> <li>BLF-CRYPT</li> <li>SSHA</li> <li>SSHA256</li> <li>SSHA512</li> </ul> <p>Die obigen Methoden können in <code>mailcow.conf</code> als <code>MAILCOW_PASS_SCHEME</code> Wert verwendet werden.</p>","path":["Model passwd.de"],"tags":[]},{"location":"models/model-passwd.de/#nur-lese-hashing-methoden","level":2,"title":"Nur-Lese-Hashing-Methoden","text":"<p>Die folgenden Methoden werden nur lesend unterstützt. Wenn Sie planen, SOGo zu benutzen (wie standardmäßig), benötigen Sie eine SOGo-kompatible Hash-Methode. Bitte beachten Sie den Hinweis am Ende dieser Seite, wie Sie die Ansicht bei Bedarf aktualisieren können. Wenn SOGo deaktiviert ist, können alle unten aufgeführten Hashing-Methoden von mailcow und Dovecot gelesen werden.</p> <ul> <li>ARGON2I (SOGo kompatibel)</li> <li>ARGON2ID (SOGo kompatibel)</li> <li>CLEAR</li> <li>CLEARTEXT</li> <li>CRYPT (SOGo-kompatibel)</li> <li>DES-CRYPT</li> <li>LDAP-MD5 (SOGo-kompatibel)</li> <li>MD5 (SOGo-kompatibel)</li> <li>MD5-CRYPT (SOGo-kompatibel)</li> <li>PBKDF2 (SOGo-kompatibel)</li> <li>PLAIN (SOGo-kompatibel)</li> <li>PLAIN-MD4</li> <li>PLAIN-MD5</li> <li>PLAIN-TRUNC</li> <li>SHA (SOGo-kompatibel)</li> <li>SHA1 (SOGo-kompatibel)</li> <li>SHA256 (SOGo-kompatibel)</li> <li>SHA256-CRYPT (SOGo-kompatibel)</li> <li>SHA512 (SOGo-kompatibel)</li> <li>SHA512-CRYPT (SOGo-kompatibel)</li> <li>SMD5 (SOGo kompatibel)</li> </ul> <p>Das bedeutet, mailcow ist in der Lage, Nutzer mit einem Hash wie <code>{MD5}1a1dc91c907325c69271ddf0c944bc72</code> aus der Datenbank zu verifizieren.</p> <p>Der Wert von <code>MAILCOW_PASS_SCHEME</code> wird immer verwendet, um neue Passwörter zu verschlüsseln.</p> <p>Ich habe die Passwort-Hashes in der SQL-Tabelle \"Mailbox\" geändert und kann mich nicht anmelden.</p> <p>Eine \"Ansicht\" muss aktualisiert werden. Sie können dies durch einen Neustart von sogo-mailcow auslösen: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart sogo-mailcow\n</code></pre> <pre><code>docker-compose restart sogo-mailcow\n</code></pre>","path":["Model passwd.de"],"tags":[]},{"location":"models/model-passwd.en/","level":1,"title":"Model passwd.en","text":"","path":["Model passwd.en"],"tags":[]},{"location":"models/model-passwd.en/#fully-supported-hashing-methods","level":2,"title":"Fully supported hashing methods","text":"<p>The most current mailcow fully supports the following hashing methods. The default hashing method is written in bold:</p> <ul> <li>BLF-CRYPT</li> <li>SSHA</li> <li>SSHA256</li> <li>SSHA512</li> </ul> <p>The methods above can be used in <code>mailcow.conf</code> as <code>MAILCOW_PASS_SCHEME</code> value.</p>","path":["Model passwd.en"],"tags":[]},{"location":"models/model-passwd.en/#read-only-hashing-methods","level":2,"title":"Read-only hashing methods","text":"<p>The following methods are supported read only. If you plan to use SOGo (as per default), you need a SOGo compatible hashing method. Please see the note at the bottom of this page how to update the view if necessary. With SOGo disabled, all hashing methods below will be able to be read by mailcow and Dovecot.</p> <ul> <li>ARGON2I (SOGo compatible)</li> <li>ARGON2ID (SOGo compatible)</li> <li>CLEAR</li> <li>CLEARTEXT</li> <li>CRYPT (SOGo compatible)</li> <li>DES-CRYPT</li> <li>LDAP-MD5 (SOGo compatible)</li> <li>MD5 (SOGo compatible)</li> <li>MD5-CRYPT (SOGo compatible)</li> <li>PBKDF2 (SOGo compatible)</li> <li>PLAIN (SOGo compatible)</li> <li>PLAIN-MD4</li> <li>PLAIN-MD5</li> <li>PLAIN-TRUNC</li> <li>SHA (SOGo compatible)</li> <li>SHA1 (SOGo compatible)</li> <li>SHA256 (SOGo compatible)</li> <li>SHA256-CRYPT (SOGo compatible)</li> <li>SHA512 (SOGo compatible)</li> <li>SHA512-CRYPT (SOGo compatible)</li> <li>SMD5 (SOGo compatible)</li> </ul> <p>That means mailcow is able to verify users with a hash like <code>{MD5}1a1dc91c907325c69271ddf0c944bc72</code> from the database.</p> <p>The value of <code>MAILCOW_PASS_SCHEME</code> will always be used to encrypt new passwords.</p> <p>I changed the password hashes in the \"mailbox\" SQL table and cannot login.</p> <p>A \"view\" needs to be updated. You can trigger this by restarting sogo-mailcow: </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart sogo-mailcow\n</code></pre> <pre><code>docker-compose restart sogo-mailcow\n</code></pre>","path":["Model passwd.en"],"tags":[]},{"location":"models/model-sender_rcv.de/","level":1,"title":"Model sender rcv.de","text":"<p>Wenn eine Mailbox erstellt wird, kann ein Benutzer Mails von seiner eigenen Mailboxadresse senden und empfangen.</p> <pre><code>Die Mailbox me@example.org wird erstellt. example.org ist eine primäre Domäne.\nHinweis: Eine Mailbox kann nicht in einer Alias-Domäne erstellt werden.\n\nme@example.org ist nur als me@example.org bekannt.\nme@example.org darf als me@example.org senden.\n</code></pre> <p>Wir können eine Alias-Domäne für example.org hinzufügen:</p> <pre><code>Die Alias-Domäne alias.com wird hinzugefügt und der primären Domäne example.org zugewiesen.\nme@example.org ist nun als me@example.org und me@alias.com bekannt.\nme@example.org darf nun als me@example.org und me@alias.com senden.\n</code></pre> <p>Wir können Aliase für eine Mailbox hinzufügen, um Mails von dieser neuen Adresse zu empfangen und zu senden.</p> <p>Es ist wichtig zu wissen, dass Sie nicht in der Lage sind, Mails für <code>my-alias@my-alias-domain.tld</code> zu empfangen. Sie müssen diesen speziellen Alias erstellen.</p> <pre><code>me@example.org wird der Alias alias@example.org zugewiesen.\nme@example.org ist jetzt bekannt als me@example.org, me@alias.com, alias@example.org\n\nme@example.org ist NICHT als alias@alias.com bekannt.\n</code></pre> <p>Bitte beachten Sie, dass dies nicht für \"catch-all\"-Aliasnamen gilt:</p> <pre><code>Die Alias-Domäne alias.com wird hinzugefügt und der primären Domäne example.org zugewiesen\nme@example.org wird der Catch-all-Alias @example.org zugewiesen\nme@example.org ist weiterhin nur als me@example.org bekannt, was die einzige verfügbare send-as Option ist.\n\nJede an alias.com gesendete E-Mail wird mit dem Catch-All-Alias für example.org übereinstimmen.\n</code></pre> <p>Administratoren und Domänenadministratoren können Postfächer bearbeiten, um bestimmten Benutzern zu erlauben, als andere Postfachbenutzer zu senden (sie zu \"delegieren\").</p> <p>Sie können zwischen Mailbox-Benutzern wählen oder die Absenderprüfung für Domänen komplett deaktivieren.</p>","path":["Model sender rcv.de"],"tags":[]},{"location":"models/model-sender_rcv.de/#sogo-mail-von-adressen","level":3,"title":"SOGo \"Mail von\"-Adressen","text":"<p>Mailbox-Benutzer können natürlich ihre eigene Mailbox-Adresse auswählen, sowie alle Alias-Adressen und Aliase, die über Alias-Domänen existieren.</p> <p>Wenn Sie einen anderen existierenden Mailbox-Benutzer als Ihre \"Mail von\"-Adresse auswählen wollen, muss dieser Benutzer Ihnen den Zugriff über SOGo delegieren (siehe SOGo-Dokumentation). Außerdem muss ein mailcow (Domain) Administrator Ihnen den Zugang wie oben beschrieben gewähren.</p>","path":["Model sender rcv.de"],"tags":[]},{"location":"models/model-sender_rcv.en/","level":1,"title":"Model sender rcv.en","text":"<p>When a mailbox is created, a user is allowed to send mail from and receive mail for his own mailbox address.</p> <pre><code>Mailbox me@example.org is created. example.org is a primary domain.\nNote: a mailbox cannot be created in an alias domain.\n\nme@example.org is only known as me@example.org.\nme@example.org is allowed to send as me@example.org.\n</code></pre> <p>We can add an alias domain for example.org:</p> <pre><code>Alias domain alias.com is added and assigned to primary domain example.org.\nme@example.org is now known as me@example.org and me@alias.com.\nme@example.org is now allowed to send as me@example.org and me@alias.com.\n</code></pre> <p>We can add aliases for a mailbox to receive mail for and to send from this new address.</p> <p>It is important to know, that you are not able to receive mail for <code>my-alias@my-alias-domain.tld</code>. You would need to create this particular alias.</p> <pre><code>me@example.org is assigned the alias alias@example.org\nme@example.org is now known as me@example.org, me@alias.com, alias@example.org\n\nme@example.org is NOT known as alias@alias.com.\n</code></pre> <p>Please note that this does not apply to catch-all aliases:</p> <pre><code>Alias domain alias.com is added and assigned to primary domain example.org\nme@example.org is assigned the catch-all alias @example.org\nme@example.org is still just known as me@example.org, which is the only available send-as option\n\nAny email send to alias.com will match the catch-all alias for example.org\n</code></pre> <p>Administrators and domain administrators can edit mailboxes to allow specific users to send as other mailbox users (\"delegate\" them).</p> <p>You can choose between mailbox users or completely disable the sender check for domains.</p>","path":["Model sender rcv.en"],"tags":[]},{"location":"models/model-sender_rcv.en/#sogo-mail-from-addresses","level":3,"title":"SOGo \"mail from\" addresses","text":"<p>Mailbox users can, obviously, select their own mailbox address, as well as all alias addresses and aliases that exist through alias domains.</p> <p>If you want to select another existing mailbox user as your \"mail from\" address, this user has to delegate you access through SOGo (see SOGo documentation). Moreover a mailcow (domain) administrator needs to grant you access as described above.</p>","path":["Model sender rcv.en"],"tags":[]},{"location":"post_installation/firststeps-authorize_watchdog_and_bounces.de/","level":1,"title":"Firststeps authorize watchdog and bounces.de","text":"<p>mailcow verwendet <code>MAILCOW_HOSTNAME</code> als Absenderdomain, um Watchdog-Benachrichtigungen zu senden und Bounce-E-Mails zu erstellen.</p> <ol> <li> <p><code>WATCHDOG_NOTIFY_EMAIL</code> sollte auf externe Empfänger verweisen, die von einem anderen Mailserver verwaltet werden. Dies ist sehr wichtig, da der Watchdog über Systemausfälle informiert, und im Falle eines solchen Ausfalls wäre Ihre Instanz möglicherweise nicht in der Lage, diese Benachrichtigung zu empfangen oder anzuzeigen.</p> </li> <li> <p>Da der Watchdog so konzipiert ist, dass er in allen Situationen funktioniert, einschließlich Fällen, in denen Postfix, Rspamd oder Redis nicht funktionieren, senden wir E-Mails direkt über den Watchdog-Container an den Empfänger-MX, ohne DKIM-Signierung.</p> </li> </ol> <p>Um Watchdog-Benachrichtigungen und Bounces ordnungsgemäß an externe Mailserver zu senden, müssen Sie SPF und DMARC für <code>MAILCOW_HOSTNAME</code> konfigurieren (ersetzen Sie <code>mail.example.com</code> und die IPs entsprechend Ihrer Konfiguration):</p> <pre><code>_dmarc.mail.example.com IN TXT \"v=DMARC1; p=reject\"\nmail.example.com IN TXT \"v=spf1 ip4:192.0.2.146/32 ip6:2001:db8::1/128 -all\"\n</code></pre> <p>Hinweis</p> <p>Wenn Sie möchten, können Sie dieses SPF später als Include für andere Domains verwenden, wie zum Beispiel:</p> <pre><code>example.com IN TXT \"v=spf1 include:mail.example.com -all\"\n</code></pre>","path":["Firststeps authorize watchdog and bounces.de"],"tags":[]},{"location":"post_installation/firststeps-authorize_watchdog_and_bounces.en/","level":1,"title":"Firststeps authorize watchdog and bounces.en","text":"<p>mailcow uses <code>MAILCOW_HOSTNAME</code> as the sender domain to send watchdog notifications and compose bounce emails.</p> <ol> <li><code>WATCHDOG_NOTIFY_EMAIL</code> should point to external recipients, managed by another mail server. This is very important because the watchdog notifies you about system outages. If this happens, your instance might not be capable of accepting or displaying this notification.</li> <li>Since the watchdog is designed to work in any situation, including cases when Postfix, Rspamd, or Redis is not functioning, we send emails directly via the watchdog container to the recipient's MX without any DKIM signing.</li> </ol> <p>To properly send watchdog notifications and bounces to external mail servers, you need to configure SPF and DMARC for <code>MAILCOW_HOSTNAME</code> (replace <code>mail.example.com</code> and the IPs to reflect your setup):</p> <pre><code>_dmarc.mail.example.com IN TXT \"v=DMARC1; p=reject\"\nmail.example.com IN TXT \"v=spf1 ip4:192.0.2.146/32 ip6:2001:db8::1/128 -all\"\n</code></pre> <p>Info</p> <p>If you want, later you can use this SPF as an include on other domains as: <pre><code>example.com IN TXT \"v=spf1 include:mail.example.com -all\"\n</code></pre></p>","path":["Firststeps authorize watchdog and bounces.en"],"tags":[]},{"location":"post_installation/firststeps-disable_ipv6.de/","level":1,"title":"Firststeps disable ipv6.de","text":"<p>ACHTUNG</p> <p>Bei Installationen, welche eine Docker Version zwischen 25.0.0 und 25.0.2 (zum überprüfen nutzt <code>docker version</code>) verwenden hat sich das Verhalten der IPv6-Adressen Allokation durch einen Bug verändert. Ein simples <code>enable_ipv6: false</code> reicht damit NICHT mehr aus, um IPv6 komplett im Stack zu deaktivieren. Dies war ein Bug im Docker Daemon, welcher mit Version 25.0.3 gefixt wurde.</p> <p>Dies wird NUR empfohlen, wenn Sie kein IPv6-fähiges Netzwerk auf Ihrem Host haben!</p> <p>Wenn Sie es wirklich brauchen, können Sie die Verwendung von IPv6 in der Compose-Datei deaktivieren. Zusätzlich können Sie auch den Start des Containers \"ipv6nat-mailcow\" deaktivieren, da er nicht benötigt wird, wenn Sie IPv6 nicht verwenden.</p> <p>Anstatt die Datei docker-compose.yml direkt zu bearbeiten, ist es besser, eine Override-Datei zu erstellen zu erstellen und Ihre Änderungen am Dienst dort zu implementieren. Leider scheint dies im Moment nur für Dienste zu funktionieren, nicht für Netzwerkeinstellungen.</p> <p>Um IPv6 im mailcow-Netzwerk zu deaktivieren, öffnen Sie docker-compose.yml mit Ihrem bevorzugten Texteditor und suchen Sie nach dem Netzwerk-Abschnitt (er befindet sich am Ende der Datei).</p> <p>1. Ändern Sie docker-compose.yml</p> <p>Ändern Sie <code>enable_ipv6: true</code> in <code>enable_ipv6: false</code>:</p> <pre><code>networks:\n  mailcow-network:\n    [...]\n    enable_ipv6: true # &lt;&lt;&lt; auf false setzen\n    ipam:\n      driver: default\n      config:\n        - subnet: ${IPV4_NETWORK:-172.22.1}.0/24\n    [...]\n</code></pre> <p>2. ipv6nat-mailcow deaktivieren</p> <p>Um den ipv6nat-mailcow Container ebenfalls zu deaktivieren, gehen Sie in Ihr mailcow Verzeichnis und erstellen Sie eine neue Datei namens \"docker-compose.override.yml\":</p> <p>HINWEIS: Wenn Sie bereits eine Override-Datei haben, erstellen Sie diese natürlich nicht neu, sondern fügen Sie die untenstehenden Zeilen entsprechend in Ihre bestehende Datei ein!</p> <pre><code># cd /opt/mailcow-dockerized\n# touch docker-compose.override.yml\n</code></pre> <p>Öffnen Sie die Datei in Ihrem bevorzugten Texteditor und tragen Sie folgendes ein:</p> <pre><code>services:\n\n    ipv6nat-mailcow:\n      image: bash:latest\n      restart: \"no\"\n      entrypoint: [\"echo\", \"ipv6nat disabled in compose.override.yml\"]\n</code></pre> <p>Damit diese Änderungen wirksam werden, müssen Sie den Stack vollständig stoppen und dann neu starten, damit Container und Netzwerke neu erstellt werden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre> <p>3. Deaktivieren Sie IPv6 in unbound-mailcow</p> <p>Bearbeiten Sie <code>data/conf/unbound/unbound.conf</code> und setzen Sie <code>do-ip6</code> auf \"no\":</p> <pre><code>Server:\n  [...]\n  do-ip6: no\n  [...]\n</code></pre> <p>unbound neu starten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart unbound-mailcow\n</code></pre> <pre><code>docker-compose restart unbound-mailcow\n</code></pre> <p>4. Deaktivieren Sie IPv6 in postfix-mailcow</p> <p>Erstellen Sie <code>data/conf/postfix/extra.cf</code> und setzen Sie <code>smtp_address_preference</code> auf <code>ipv4</code>:</p> <pre><code>smtp_address_preference = ipv4\ninet_protocols = ipv4\n</code></pre> <p>Starten Sie Postfix neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow\n</code></pre> <p>5. Wenn im Docker Daemon IPv6 komplett deaktiviert ist:</p> <p>Folgende Dovecot und Php-fpm Konfigurationsdateien anpassen</p> <pre><code>sed -i 's/,\\[::\\]//g' data/conf/dovecot/dovecot.conf\nsed -i 's/\\[::\\]://g' data/conf/phpfpm/php-fpm.d/pools.conf\n</code></pre> <p>6. IPv6 Listener für NGINX deaktivieren</p> <p>Setze <code>DISABLE_IPv6=y</code> in der Datei <code>mailcow.conf</code>.</p> <p>Damit diese Änderung wirksam wird, muss der Container <code>nginx-mailcow</code> neu erstellt werden.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps disable ipv6.de"],"tags":[]},{"location":"post_installation/firststeps-disable_ipv6.en/","level":1,"title":"Firststeps disable ipv6.en","text":"<p>Danger</p> <p>In installations using a Docker version between 25.0.0 and 25.0.2 (to check, use <code>docker version</code>) the behavior of IPv6 address allocation has changed due to a bug. Simply using <code>enable_ipv6: false</code> is NO LONGER sufficient to completely disable IPv6 in the stack. This was a bug in the Docker Daemon, which has been fixed with version 25.0.3.</p> <p>This is ONLY recommended if you do not have an IPv6 enabled network on your host!</p> <p>If you really need to, you can disable the usage of IPv6 in the compose file. Additionally, you can  also disable the startup of container \"ipv6nat-mailcow\", as it's not needed if you won't use IPv6.</p> <p>Instead of editing docker-compose.yml directly, it is preferable to create an override file for it and implement your changes to the service there. Unfortunately, this right now only seems to work for services, not for network settings.</p> <p>To disable IPv6 on the mailcow network, open docker-compose.yml with your favourite text editor and search for the network section (it's near the bottom of the file).</p> <p>1. Modify docker-compose.yml</p> <p>Change <code>enable_ipv6: true</code> to <code>enable_ipv6: false</code> and comment out the IPv6 subnet:</p> <pre><code>networks:\n  mailcow-network:\n    [...]\n    enable_ipv6: true # &lt;&lt;&lt; set to false\n    ipam:\n      driver: default\n      config:\n        - subnet: ${IPV4_NETWORK:-172.22.1}.0/24\n        - subnet: ${IPV6_NETWORK:-fd4d:6169:6c63:6f77::/64} # &lt;&lt;&lt; comment out with #\n    [...]\n</code></pre> <p>2. Disable ipv6nat-mailcow</p> <p>To disable the ipv6nat-mailcow container as well, go to your mailcow directory and create a new file called \"docker-compose.override.yml\":</p> <p>NOTE: If you already have an override file, of course don't recreate it, but merge the lines below into your existing one accordingly!</p> <pre><code># cd /opt/mailcow-dockerized\n# touch docker-compose.override.yml\n</code></pre> <p>Open the file in your favourite text editor and fill in the following:</p> <pre><code>services:\n\n    ipv6nat-mailcow:\n      image: bash:latest\n      restart: \"no\"\n      entrypoint: [\"echo\", \"ipv6nat disabled in compose.override.yml\"]\n</code></pre> <p>For these changes to be effective, you need to fully stop and then restart the stack, so containers and networks are recreated:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre> <p>3. Disable IPv6 in unbound-mailcow</p> <p>Edit <code>data/conf/unbound/unbound.conf</code> and set <code>do-ip6</code> to \"no\":</p> <pre><code>server:\n  [...]\n  do-ip6: no\n  [...]\n</code></pre> <p>Restart Unbound:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart unbound-mailcow\n</code></pre> <pre><code>docker-compose restart unbound-mailcow\n</code></pre> <p>4. Disable IPv6 in postfix-mailcow</p> <p>Create <code>data/conf/postfix/extra.cf</code> and set <code>smtp_address_preference</code> to <code>ipv4</code>:</p> <pre><code>smtp_address_preference = ipv4\ninet_protocols = ipv4\n</code></pre> <p>Restart Postfix:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart postfix-mailcow\n</code></pre> <pre><code>docker-compose restart postfix-mailcow\n</code></pre> <p>5. If your docker daemon completly disabled IPv6:</p> <p>Fix the following Dovecot and php-fpm config files</p> <pre><code>sed -i 's/,\\[::\\]//g' data/conf/dovecot/dovecot.conf\nsed -i 's/\\[::\\]://g' data/conf/phpfpm/php-fpm.d/pools.conf\n</code></pre> <p>6. Disable IPv6 listeners for NGINX</p> <p>Set <code>DISABLE_IPv6=y</code> in <code>mailcow.conf</code></p> <p>For this change to be effective, you need to recreate the <code>nginx-mailcow</code> Container</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps disable ipv6.en"],"tags":[]},{"location":"post_installation/firststeps-dmarc_reporting.de/","level":1,"title":"Firststeps dmarc reporting.de","text":"<p>Die DMARC-Berichterstattung erfolgt über das Rspamd DMARC-Modul.</p> <p>Die Rspamd-Dokumentation finden Sie hier: https://rspamd.com/doc/modules/dmarc.html</p> <p>Wichtig:</p> <ol> <li> <p>Ändern Sie <code>example.com</code>, <code>mail.example.com</code> und <code>Example</code> so, dass sie Ihrer Einrichtung entsprechen</p> </li> <li> <p>Die DMARC-Berichterstattung erfordert zusätzliche Aufmerksamkeit, insbesondere in den ersten Tagen</p> </li> <li> <p>Alle empfangenden Domains, die auf mailcow gehostet werden, senden von einer Reporting-Domain. Es wird empfohlen, die übergeordnete Domain Ihres <code>MAILCOW_HOSTNAME</code> zu verwenden:</p> <ul> <li>Wenn Ihr <code>MAILCOW_HOSTNAME</code> <code>mail.example.com</code> ist, ändern Sie die folgende Konfiguration in <code>domain = \"example.com\";</code></li> <li>Setzen Sie <code>email</code> gleich, z.B. <code>email = \"noreply-dmarc@example.com\";</code></li> </ul> </li> <li> <p>Es ist optional, aber empfohlen, einen E-Mail-Benutzer <code>noreply-dmarc</code> in mailcow zu erstellen, um Bounces zu behandeln.</p> </li> </ol>","path":["Firststeps dmarc reporting.de"],"tags":[]},{"location":"post_installation/firststeps-dmarc_reporting.de/#aktivieren-sie-dmarc-berichterstattung","level":2,"title":"Aktivieren Sie DMARC-Berichterstattung","text":"<p>Erstellen Sie die Datei <code>data/conf/rspamd/local.d/dmarc.conf</code> und setzen Sie den folgenden Inhalt:</p> <pre><code>reporting {\n    enabled = true;\n    email = 'noreply-dmarc@example.com';\n    domain = 'example.com';\n    org_name = 'Example';\n    helo = 'rspamd';\n    smtp = 'postfix';\n    smtp_port = 25;\n    from_name = 'Example DMARC Report';\n    msgid_from = 'rspamd.mail.example.com';\n    max_entries = 2k;\n    keys_expire = 2d;\n}\n</code></pre> <p>Erstellen oder ändern Sie <code>docker-compose.override.yml</code> im mailcow-dockerized Basisverzeichnis:</p> <pre><code>services:\n  rspamd-mailcow:\n    environment:\n      - MASTER=${MASTER:-y}\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.schedule: \"@every 24h\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.command: \"/bin/bash -c \\\"[[ $${MASTER} == y ]] &amp;&amp; /usr/bin/rspamadm dmarc_report $(date --date yesterday '+%Y%m%d') &gt; /var/lib/rspamd/dmarc_reports_last_log 2&gt;&amp;1 || exit 0\\\"\"\n  ofelia-mailcow:\n    depends_on:\n      - rspamd-mailcow\n</code></pre> <p>Starten Sie den mailcow Stack mit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps dmarc reporting.de"],"tags":[]},{"location":"post_installation/firststeps-dmarc_reporting.de/#senden-sie-eine-kopie-der-berichte-an-sich-selbst","level":2,"title":"Senden Sie eine Kopie der Berichte an sich selbst","text":"<p>Um eine versteckte Kopie der von Rspamd erzeugten Berichte zu erhalten, können Sie eine <code>bcc_addrs</code> Liste im <code>reporting</code> Konfigurationsabschnitt von <code>data/conf/rspamd/local.d/dmarc.conf</code> setzen:</p> <pre><code>reporting {\n    enabled = true;\n    email = 'noreply-dmarc@example.com';\n    bcc_addrs = [\"noreply-dmarc@example.com\", \"parsedmarc@example.com\"];\n[...]\n</code></pre> <p>Rspamd lädt Änderungen in Echtzeit, so dass Sie den Container zu diesem Zeitpunkt nicht neu starten müssen.</p> <p>Dies kann nützlich sein, wenn Sie...</p> <ul> <li>...überprüfen wollen, ob Ihre DMARC-Berichte korrekt und authentifiziert gesendet werden.</li> <li>...Ihre eigenen Berichte analysieren wollen, um Statistiken zu erhalten, z.B. um sie mit ParseDMARC oder anderen Analysesystemen zu verwenden.</li> </ul>","path":["Firststeps dmarc reporting.de"],"tags":[]},{"location":"post_installation/firststeps-dmarc_reporting.de/#fehlersuche","level":2,"title":"Fehlersuche","text":"<p>Prüfen Sie, wann der Berichtsplan zuletzt ausgeführt wurde:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow date -r /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow date -r /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <p>Sehen Sie sich die letzte Berichtsausgabe an:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow cat /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow cat /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <p>Manuelles Auslösen eines DMARC-Berichts:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow rspamadm dmarc_report\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow rspamadm dmarc_report\n</code></pre> <p>Bestätigen Sie, dass Rspamd Daten in Redis aufgezeichnet hat: Ändern Sie <code>20220428</code> in Ihr gewünschtes Datum zum überprüfen.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli SMEMBERS \"dmarc_idx;20220428\"\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli SMEMBERS \"dmarc_idx;20220428\"\n</code></pre> <p>Nehmen Sie eine der Zeilen aus der Ausgabe, die Sie interessiert, und fordern Sie sie an, z. B.:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli ZRANGE \"dmarc_rpt;microsoft.com;mailto:d@rua.agari.com;20220428\" 0 49\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli ZRANGE \"dmarc_rpt;microsoft.com;mailto:d@rua.agari.com;20220428\" 0 49\n</code></pre>","path":["Firststeps dmarc reporting.de"],"tags":[]},{"location":"post_installation/firststeps-dmarc_reporting.de/#andern-sie-die-haufigkeit-der-dmarc-berichte","level":2,"title":"Ändern Sie die Häufigkeit der DMARC-Berichte","text":"<p>Im obigen Beispiel werden die Berichte einmal alle 24 Stunden sowie für den gestrigen Tag versendet. Dies ist für die meisten Konfigurationen ausreichend.</p> <p>Wenn Sie ein großes E-Mail-Aufkommen haben und die DMARC-Berichterstattung mehr als einmal am Tag durchführen wollen, müssen Sie einen zweiten Zeitplan erstellen und ihn mit <code>dmarc_report $(date '+%Y%m%d')</code> ausführen, um den aktuellen Tag zu verarbeiten. Sie müssen sicherstellen, dass der erste Lauf an jedem Tag auch den letzten Bericht vom Vortag verarbeitet, also muss er zweimal gestartet werden, einmal mit <code>$(date --date yesterday '+%Y%m%d')</code> um <code>0 5 0 * * *</code> (00:05 AM) und dann mit <code>$(date '+%Y%m%d')</code> mit dem gewünschten Intervall.</p> <p>Der Ofelia-Zeitplan hat die gleiche Implementierung wie <code>cron</code> in Go, die unterstützte Syntax ist beschrieben in cron Documentation</p> <p>Um den Zeitplan zu ändern:</p> <ol> <li> <p><code>docker-compose.override.yml</code> bearbeiten:     <pre><code>services:\n  rspamd-mailcow:\n    environment:\n      - MASTER=${MASTER:-y}\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.schedule: \"0 5 0 * * *\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.command: \"/bin/bash -c \\\"[[ $${MASTER} == y ]] &amp;&amp; /usr/bin/rspamadm dmarc_report $(date --date yesterday '+%Y%m%d') &gt; /var/lib/rspamd/dmarc_reports_last_log 2&gt;&amp;1 || exit 0\\\"\"\n      ofelia.job-exec.rspamd_dmarc_reporting_today.schedule: \"@every 12h\"\n      ofelia.job-exec.rspamd_dmarc_reporting_today.command: \"/bin/bash -c \\\"[[ $${MASTER} == y ]] &amp;&amp; /usr/bin/rspamadm dmarc_report $(date '+%Y%m%d') &gt; /var/lib/rspamd/dmarc_reports_last_log 2&gt;&amp;1 || exit 0\\\"\"\n  ofelia-mailcow:\n    depends_on:\n      - rspamd-mailcow\n</code></pre></p> </li> <li> <p>Starten Sie die betroffenen Container neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> </li> <li> <p>Führen Sie einen Neustart nur von Ofelia aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart ofelia-mailcow\n</code></pre> <pre><code>docker-compose restart ofelia-mailcow\n</code></pre> </li> </ol>","path":["Firststeps dmarc reporting.de"],"tags":[]},{"location":"post_installation/firststeps-dmarc_reporting.de/#dmarc-berichterstattung-deaktivieren","level":2,"title":"DMARC-Berichterstattung deaktivieren","text":"<p>Zum Deaktivieren der Berichterstattung:</p> <ol> <li> <p>Setzen Sie <code>enabled</code> auf <code>false</code> in <code>data/conf/rspamd/local.d/dmarc.conf</code>.</p> </li> <li> <p>Machen Sie Änderungen in <code>docker-compose.override.yml</code> an <code>rspamd-mailcow</code> und <code>ofelia-mailcow</code> rückgängig</p> </li> <li> <p>Starten Sie die betroffenen Container neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> </li> </ol>","path":["Firststeps dmarc reporting.de"],"tags":[]},{"location":"post_installation/firststeps-dmarc_reporting.en/","level":1,"title":"Firststeps dmarc reporting.en","text":"<p>DMARC Reporting done via Rspamd DMARC Module.</p> <p>Rspamd documentation can be found here: https://rspamd.com/doc/modules/dmarc.html</p> <p>Important:</p> <ol> <li> <p>Change <code>example.com</code>, <code>mail.example.com</code> and <code>Example</code> to reflect your setup</p> </li> <li> <p>DMARC reporting requires additional attention, especially over the first few days</p> </li> <li> <p>All receiving domains hosted on mailcow send from one reporting domain. It is recommended to use the parent domain of your <code>MAILCOW_HOSTNAME</code>:</p> <ul> <li>If your <code>MAILCOW_HOSTNAME</code> is <code>mail.example.com</code> change the following config to <code>domain = \"example.com\";</code></li> <li>Set <code>email</code> equally, e.g. <code>email = \"noreply-dmarc@example.com\";</code></li> </ul> </li> <li> <p>It is optional but recommended to create an email user <code>noreply-dmarc</code> in mailcow to handle bounces.</p> </li> </ol>","path":["Firststeps dmarc reporting.en"],"tags":[]},{"location":"post_installation/firststeps-dmarc_reporting.en/#enable-dmarc-reporting","level":2,"title":"Enable DMARC reporting","text":"<p>Create the file <code>data/conf/rspamd/local.d/dmarc.conf</code> and set the following content:</p> <pre><code>reporting {\n    enabled = true;\n    email = 'noreply-dmarc@example.com';\n    domain = 'example.com';\n    org_name = 'Example';\n    helo = 'rspamd';\n    smtp = 'postfix';\n    smtp_port = 25;\n    from_name = 'Example DMARC Report';\n    msgid_from = 'rspamd.mail.example.com';\n    max_entries = 2k;\n    keys_expire = 2d;\n}\n</code></pre> <p>Create or modify <code>docker-compose.override.yml</code> in the mailcow-dockerized base directory:</p> <pre><code>services:\n  rspamd-mailcow:\n    environment:\n      - MASTER=${MASTER:-y}\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.schedule: \"@every 24h\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.command: \"/bin/bash -c \\\"[[ $${MASTER} == y ]] &amp;&amp; /usr/bin/rspamadm dmarc_report $(date --date yesterday '+%Y%m%d') &gt; /var/lib/rspamd/dmarc_reports_last_log 2&gt;&amp;1 || exit 0\\\"\"\n  ofelia-mailcow:\n    depends_on:\n      - rspamd-mailcow\n</code></pre> <p>Start the mailcow stack with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps dmarc reporting.en"],"tags":[]},{"location":"post_installation/firststeps-dmarc_reporting.en/#send-a-copy-reports-to-yourself","level":2,"title":"Send a copy reports to yourself","text":"<p>To receive a hidden copy of reports generated by Rspamd you can set a <code>bcc_addrs</code> list in the <code>reporting</code> config section of <code>data/conf/rspamd/local.d/dmarc.conf</code>:</p> <pre><code>reporting {\n    enabled = true;\n    email = 'noreply-dmarc@example.com';\n    bcc_addrs = [\"noreply-dmarc@example.com\",\"parsedmarc@example.com\"];\n[...]\n</code></pre> <p>Rspamd will load changes in real time, so you won't need to restart the container at this point.</p> <p>This can be useful if you...</p> <ul> <li>...want to check that your DMARC reports are sent correctly and authenticated.</li> <li>...want to analyze your own reports to get statistics, i.e. to use with ParseDMARC or other analytic systems.</li> </ul>","path":["Firststeps dmarc reporting.en"],"tags":[]},{"location":"post_installation/firststeps-dmarc_reporting.en/#troubleshooting","level":2,"title":"Troubleshooting","text":"<p>Check when the report schedule last ran:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow date -r /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow date -r /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <p>See the latest report output:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow cat /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow cat /var/lib/rspamd/dmarc_reports_last_log\n</code></pre> <p>Manually trigger a DMARC report:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow rspamadm dmarc_report\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow rspamadm dmarc_report\n</code></pre> <p>Validate that Rspamd has recorded data in Redis: Change <code>20220428</code> to date which you interested in.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli SMEMBERS \"dmarc_idx;20220428\"\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli SMEMBERS \"dmarc_idx;20220428\"\n</code></pre> <p>Take one of the lines from output you interested in and request it, f.e.:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli ZRANGE \"dmarc_rpt;microsoft.com;mailto:d@rua.agari.com;20220428\" 0 49\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli ZRANGE \"dmarc_rpt;microsoft.com;mailto:d@rua.agari.com;20220428\" 0 49\n</code></pre>","path":["Firststeps dmarc reporting.en"],"tags":[]},{"location":"post_installation/firststeps-dmarc_reporting.en/#change-dmarc-reporting-frequency","level":2,"title":"Change DMARC reporting frequency","text":"<p>In the example above reports are sent once every 24 hours and send reports for yesterday. This will be okay for most setups.</p> <p>If you have a large mail volume and want to run the DMARC reporting more than once a day you need create second schedule and run it with <code>dmarc_report $(date '+%Y%m%d')</code> to process the current day. You have to make sure that the first run on each day also processes the last report from the day before, so it needs to be started twice, one time with <code>$(date --date yesterday '+%Y%m%d')</code> at <code>0 5 0 * * *</code> (00:05 AM) and then with <code>$(date '+%Y%m%d')</code> with desired interval.</p> <p>The Ofelia schedule has the same implementation as <code>cron</code> in Go, supported syntax described at cron Documentation</p> <p>To change schedule:</p> <ol> <li>Edit <code>docker-compose.override.yml</code>:</li> </ol> <pre><code>services:\n  rspamd-mailcow:\n    environment:\n      - MASTER=${MASTER:-y}\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.schedule: \"0 5 0 * * *\"\n      ofelia.job-exec.rspamd_dmarc_reporting_yesterday.command: \"/bin/bash -c \\\"[[ $${MASTER} == y ]] &amp;&amp; /usr/bin/rspamadm dmarc_report $(date --date yesterday '+%Y%m%d') &gt; /var/lib/rspamd/dmarc_reports_last_log 2&gt;&amp;1 || exit 0\\\"\"\n      ofelia.job-exec.rspamd_dmarc_reporting_today.schedule: \"@every 12h\"\n      ofelia.job-exec.rspamd_dmarc_reporting_today.command: \"/bin/bash -c \\\"[[ $${MASTER} == y ]] &amp;&amp; /usr/bin/rspamadm dmarc_report $(date '+%Y%m%d') &gt; /var/lib/rspamd/dmarc_reports_last_log 2&gt;&amp;1 || exit 0\\\"\"\n  ofelia-mailcow:\n    depends_on:\n      - rspamd-mailcow\n</code></pre> <ol> <li> <p>Restart the desired containers with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> </li> <li> <p>Restart the ofelia container only:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart ofelia-mailcow\n</code></pre> <pre><code>docker-compose restart ofelia-mailcow\n</code></pre> </li> </ol>","path":["Firststeps dmarc reporting.en"],"tags":[]},{"location":"post_installation/firststeps-dmarc_reporting.en/#disable-dmarc-reporting","level":2,"title":"Disable DMARC Reporting","text":"<p>To disable reporting:</p> <ol> <li> <p>Set <code>enabled</code> to <code>false</code> in <code>data/conf/rspamd/local.d/dmarc.conf</code></p> </li> <li> <p>Revert changes done in <code>docker-compose.override.yml</code> to <code>rspamd-mailcow</code> and <code>ofelia-mailcow</code></p> </li> <li> <p>Restart the desired containers with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> </li> </ol>","path":["Firststeps dmarc reporting.en"],"tags":[]},{"location":"post_installation/firststeps-ip_bindings.de/","level":1,"title":"Firststeps ip bindings.de","text":"<p>Warnung</p> <p>Das Ändern der Bindung hat keinen Einfluss auf Source-NAT. Siehe SNAT für die erforderlichen Schritte.</p>","path":["Firststeps ip bindings.de"],"tags":[]},{"location":"post_installation/firststeps-ip_bindings.de/#ipv4-binding","level":2,"title":"IPv4-Binding","text":"<p>Um eine oder mehrere IPv4-Bind(ings) anzupassen, öffne <code>mailcow.conf</code> und editiere eine, mehrere oder alle Variablen nach deinen Bedürfnissen:</p> <pre><code># Aus technischen Gründen unterscheiden sich die http-Bindungen ein wenig von anderen Service-Bindungen.\n# Sie werden die folgenden Variablen finden, getrennt durch eine Bindungsadresse und deren Port:\n# Beispiel: HTTP_BIND=1.2.3.4\n\nHTTP_PORT=80\nHTTP_BIND=\nHTTPS_PORT=443\nHTTPS_BIND=\n\n# Andere Dienste werden nach folgendem Format gebunden:\n# SMTP_PORT=1.2.3.4:25 bindet SMTP an die IP 1.2.3.4 auf Port 25\n# Wichtig! Durch die Angabe einer IPv4-Adresse werden alle IPv6-Bindungen seit Docker 20.x übersprungen.\n# doveadm, SQL sowie Solr sind nur an lokale Ports gebunden, bitte ändern Sie das nicht, es sei denn, Sie wissen, was Sie tun.\n\nSMTP_PORT=25\nSMTPS_PORT=465\nSUBMISSION_PORT=587\nIMAP_PORT=143\nIMAPS_PORT=993\nPOP_PORT=110\nPOPS_PORT=995\nSIEVE_PORT=4190\nDOVEADM_PORT=127.0.0.1:19991\nSQL_PORT=127.0.0.1:13306\nSOLR_PORT=127.0.0.1:18983\n</code></pre> <p>Um Ihre Änderungen zu übernehmen, führen Sie folgende Befehle aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Firststeps ip bindings.de"],"tags":[]},{"location":"post_installation/firststeps-ip_bindings.de/#ipv6-binding","level":2,"title":"IPv6-Binding","text":"<p>Das Ändern von IPv6-Bindings ist anders als bei IPv4. Auch dies hat einen technischen Hintergrund.</p> <p>Eine <code>docker-compose.override.yml</code> Datei wird verwendet, anstatt die <code>docker-compose.yml</code> Datei direkt zu bearbeiten. Dies geschieht, um die Aktualisierbarkeit zu erhalten, da die Datei <code>docker-compose.yml</code> regelmäßig aktualisiert wird und Ihre Änderungen höchstwahrscheinlich überschrieben werden.</p> <p>Bearbeiten Sie die Datei \"docker-compose.override.yml\" und erstellen Sie sie mit dem folgenden Inhalt. Ihr Inhalt wird mit der produktiven Datei \"docker-compose.yml\" zusammengeführt.</p> <p>Es wird eine beispielhafte IPv6 2001:db8:dead:beef::123 in [] angegeben. Das erste Suffix <code>:PORT1</code> definiert den externen Port, während das zweite Suffix <code>:PORT2</code> zu dem entsprechenden Port innerhalb des Containers führt und nicht verändert werden darf.</p> <pre><code>services:\n\n    dovecot-mailcow:\n      ports:\n        - '[2001:db8:dead:beef::123]:143:143'\n        - '[2001:db8:dead:beef::123]:993:993'\n        - '[2001:db8:dead:beef::123]:110:110'\n        - '[2001:db8:dead:beef::123]:995:995'\n        - '[2001:db8:dead:beef::123]:4190:4190'\n\n    postfix-mailcow:\n      ports:\n        - '[2001:db8:dead:beef::123]:25:25'\n        - '[2001:db8:dead:beef::123]:465:465'\n        - '[2001:db8:dead:beef::123]:587:587'\n\n    nginx-mailcow:\n      ports:\n        - '[2001:db8:dead:beef::123]:80:80'\n        - '[2001:db8:dead:beef::123]:443:443'\n</code></pre> <p>Um Ihre Änderungen zu übernehmen, führen Sie folgendes aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Firststeps ip bindings.de"],"tags":[]},{"location":"post_installation/firststeps-ip_bindings.en/","level":1,"title":"Firststeps ip bindings.en","text":"<p>Warning</p> <p>Changing the binding does not affect source NAT. See SNAT for required steps.</p>","path":["Firststeps ip bindings.en"],"tags":[]},{"location":"post_installation/firststeps-ip_bindings.en/#ipv4-binding","level":2,"title":"IPv4 binding","text":"<p>To adjust one or multiple IPv4 bindings, open <code>mailcow.conf</code> and edit one, multiple or all variables as per your needs:</p> <pre><code># For technical reasons, http bindings are a bit different from other service bindings.\n# You will find the following variables, separated by a bind address and its port:\n# Example: HTTP_BIND=1.2.3.4\n\nHTTP_PORT=80\nHTTP_BIND=\nHTTPS_PORT=443\nHTTPS_BIND=\n\n# Other services are bound by using the following format:\n# SMTP_PORT=1.2.3.4:25 will bind SMTP to the IP 1.2.3.4 on port 25\n# Important! Specifying an IPv4 address will skip all IPv6 bindings since Docker 20.x.\n# doveadm, SQL as well as Solr are bound to local ports only, please do not change that, unless you know what you are doing.\n\nSMTP_PORT=25\nSMTPS_PORT=465\nSUBMISSION_PORT=587\nIMAP_PORT=143\nIMAPS_PORT=993\nPOP_PORT=110\nPOPS_PORT=995\nSIEVE_PORT=4190\nDOVEADM_PORT=127.0.0.1:19991\nSQL_PORT=127.0.0.1:13306\nSOLR_PORT=127.0.0.1:18983\n</code></pre> <p>To apply your changes, run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Firststeps ip bindings.en"],"tags":[]},{"location":"post_installation/firststeps-ip_bindings.en/#ipv6-binding","level":2,"title":"IPv6 binding","text":"<p>Changing IPv6 bindings is different from IPv4. Again, this has a technical background.</p> <p>A <code>docker-compose.override.yml</code> file will be used instead of editing the <code>docker-compose.yml</code> file directly. This is to maintain updatability, as the <code>docker-compose.yml</code> file gets updated regularly and your changes will most likely be overwritten.</p> <p>Edit to create a file  <code>docker-compose.override.yml</code> with the following content. Its content will be merged with the productive <code>docker-compose.yml</code> file.</p> <p>An example IPv6 2001:db8:dead:beef::123 is given. The first suffix <code>:PORT1</code> defines the external port, while the second suffix <code>:PORT2</code> routes to the corresponding port inside the container and must not be changed.</p> <pre><code>services:\n\n    dovecot-mailcow:\n      ports:\n        - '[2001:db8:dead:beef::123]:143:143'\n        - '[2001:db8:dead:beef::123]:993:993'\n        - '[2001:db8:dead:beef::123]:110:110'\n        - '[2001:db8:dead:beef::123]:995:995'\n        - '[2001:db8:dead:beef::123]:4190:4190'\n\n    postfix-mailcow:\n      ports:\n        - '[2001:db8:dead:beef::123]:25:25'\n        - '[2001:db8:dead:beef::123]:465:465'\n        - '[2001:db8:dead:beef::123]:587:587'\n\n    nginx-mailcow:\n      ports:\n        - '[2001:db8:dead:beef::123]:80:80'\n        - '[2001:db8:dead:beef::123]:443:443'\n</code></pre> <p>To apply your changes, run the commands below:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Firststeps ip bindings.en"],"tags":[]},{"location":"post_installation/firststeps-local_mta.de/","level":1,"title":"Firststeps local mta.de","text":"<p>Die einfachste Möglichkeit wäre, den Listener an Port 25/tcp zu deaktivieren.</p> <p>Postfix-Benutzer deaktivieren den Listener, indem sie die folgende Zeile (beginnend mit <code>smtp</code> oder <code>25</code>) in <code>/etc/postfix/master.cf</code> auskommentieren: <pre><code>#smtp      inet  n       -       -       -       -       smtpd\n</code></pre></p> <p>Außerdem, um über eine Dockerized mailcow weiterzuleiten, sollten Sie <code>172.22.1.1</code> als Relayhost hinzufügen und das Docker-Interface aus \"inet_interfaces\" entfernen:</p> <pre><code>postconf -e 'relayhost = 172.22.1.1'\npostconf -e \"mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128\"\npostconf -e \"inet_interfaces = loopback-only\"\npostconf -e \"relay_transport = relay\"\npostconf -e \"default_transport = smtp\"\n</code></pre> <p>Jetzt ist es wichtig, dass Sie nicht denselben FQDN in <code>myhostname</code> haben, den Sie für Ihre mailcow verwenden. Prüfen Sie Ihre lokale (nicht-Docker) Postfix' main.cf auf <code>myhostname</code> und setzen Sie ihn auf etwas anderes, zum Beispiel <code>local.my.fqdn.tld</code>.</p> <p>\"172.22.1.1\" ist das von mailcow erstellte Netzwerk-Gateway in Docker. Das Relaying über diese Schnittstelle ist notwendig (anstatt - zum Beispiel - direkt über ${MAILCOW_HOSTNAME}), um über ein bekanntes internes Netzwerk weiterzuleiten.</p> <p>Starten Sie Postfix neu, nachdem Sie Ihre Änderungen vorgenommen haben.</p>","path":["Firststeps local mta.de"],"tags":[]},{"location":"post_installation/firststeps-local_mta.en/","level":1,"title":"Firststeps local mta.en","text":"<p>The easiest option would be to disable the listener on port 25/tcp.</p> <p>Postfix users disable the listener by commenting the following line (starting with <code>smtp</code> or <code>25</code>) in <code>/etc/postfix/master.cf</code>: <pre><code>#smtp      inet  n       -       -       -       -       smtpd\n</code></pre></p> <p>Furthermore, to relay over a dockerized mailcow, you may want to add <code>172.22.1.1</code> as relayhost and remove the Docker interface from \"inet_interfaces\":</p> <pre><code>postconf -e 'relayhost = 172.22.1.1'\npostconf -e \"mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128\"\npostconf -e \"inet_interfaces = loopback-only\"\npostconf -e \"relay_transport = relay\"\npostconf -e \"default_transport = smtp\"\n</code></pre> <p>Now it is important to not have the same FQDN in <code>myhostname</code> as you use for your dockerized mailcow. Check your local (non-Docker) Postfix' main.cf for <code>myhostname</code> and set it to something different, for example <code>local.my.fqdn.tld</code>.</p> <p>\"172.22.1.1\" is the mailcow created network gateway in Docker. Relaying over this interface is necessary (instead of - for example - relaying directly over ${MAILCOW_HOSTNAME}) to relay over a known internal network.</p> <p>Restart Postfix after applying your changes.</p>","path":["Firststeps local mta.en"],"tags":[]},{"location":"post_installation/firststeps-logging.de/","level":1,"title":"Firststeps logging.de","text":"<p>Das Logging in mailcow: dockerized besteht aus mehreren Stufen, ist aber immerhin wesentlich flexibler und einfacher in einen Logging-Daemon zu integrieren als bisher.</p> <p>In Docker schreibt die containerisierte Anwendung (PID 1) ihre Ausgabe auf stdout. Für echte Ein-Anwendungs-Container funktioniert das sehr gut. Führen Sie folgenden Befehl aus, um mehr zu erfahren:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --help\n</code></pre> <pre><code>docker-compose logs --help\n</code></pre> <p>Einige Container protokollieren oder streamen an mehrere Ziele.</p> <p>Kein Container wird persistente Logs in sich behalten. Container sind flüchtige Objekte!</p> <p>Am Ende wird jede Zeile der Logs den Docker-Daemon erreichen - ungefiltert.</p> <p>Der Standard-Logging-Treiber ist \"json \".</p>","path":["Firststeps logging.de"],"tags":[]},{"location":"post_installation/firststeps-logging.de/#gefilterte-logs","level":3,"title":"Gefilterte Logs","text":"<p>Einige Logs werden gefiltert und in Redis-Schlüssel geschrieben, aber auch in einen Redis-Kanal gestreamt.</p> <p>Der Redis-Kanal wird verwendet, um Protokolle mit fehlgeschlagenen Authentifizierungsversuchen zu streamen, die von netfilter-mailcow gelesen werden.</p> <p>Die Redis-Schlüssel sind persistent und halten 10000 Zeilen von Logs für die Web-UI.</p> <p>Dieser Mechanismus macht es möglich, jeden beliebigen Docker-Logging-Treiber zu verwenden, ohne die  ohne die Fähigkeit zu verlieren, Logs von der UI zu lesen oder verdächtige Clients mit netfilter-mailcow zu sperren.</p> <p>Redis-Schlüssel enthalten nur Logs von Anwendungen und filtern Systemmeldungen heraus (man denke an Cron etc.).</p>","path":["Firststeps logging.de"],"tags":[]},{"location":"post_installation/firststeps-logging.de/#logging-treiber","level":3,"title":"Logging-Treiber","text":"","path":["Firststeps logging.de"],"tags":[]},{"location":"post_installation/firststeps-logging.de/#uber-docker-composeoverrideyml","level":4,"title":"Über docker-compose.override.yml","text":"<p>Hier ist die gute Nachricht: Da Docker einige großartige Logging-Treiber hat, können Sie mailcow: dockerized mit Leichtigkeit in Ihre bestehende Logging-Umgebung integrieren.</p> <p>Erstellen Sie eine <code>docker-compose.override.yml</code> und fügen Sie zum Beispiel diesen Block hinzu, um das \"gelf\" Logging-Plugin für <code>postfix-mailcow</code> zu verwenden:</p> <pre><code>services:\n  postfix-mailcow: # oder ein anderer\n    logging:\n      driver: \"gelf\"\n      options:\n        gelf-address: \"udp://graylog:12201\"\n</code></pre> <p>Ein weiteres Beispiel für Syslog:</p> <pre><code>services:\n\n  postfix-mailcow: # oder ein anderer\n    logging:\n      driver: \"syslog\"\n      options:\n        syslog-address: \"udp://127.0.0.1:514\"\n        syslog-facility: \"local3\"\n\n  dovecot-mailcow: # oder ein anderer\n    logging:\n      driver: \"syslog\"\n      options:\n        syslog-address: \"udp://127.0.0.1:514\"\n        syslog-facility: \"local3\"\n\n  rspamd-mailcow: # oder ein anderer\n    logging:\n      driver: \"syslog\"\n      options:\n        syslog-address: \"udp://127.0.0.1:514\"\n        syslog-facility: \"local3\"\n</code></pre>","path":["Firststeps logging.de"],"tags":[]},{"location":"post_installation/firststeps-logging.de/#nur-fur-rsyslog","level":5,"title":"Nur für rsyslog:","text":"<p>Stellen Sie sicher, dass folgende Zeilen in <code>/etc/rsyslog.conf</code> nicht auskommentiert sind:</p> <pre><code># provides UDP syslog reception\nmodule(load=\"imudp\")\ninput(type=\"imudp\" port=\"514\")\n</code></pre> <p>Um Eingänge von <code>local3</code> in <code>/var/log/mailcow.log</code> zu leiten und danach die Verarbeitung zu stoppen, erstellen Sie die Datei <code>/etc/rsyslog.d/docker.conf</code>:</p> <pre><code>local3.*        /var/log/mailcow.log\n&amp; stop\n</code></pre> <p>Starten Sie rsyslog danach neu.</p>","path":["Firststeps logging.de"],"tags":[]},{"location":"post_installation/firststeps-logging.de/#uber-daemonjson-global","level":4,"title":"Über daemon.json (global)","text":"<p>Wenn Sie den Logging-Treiber global ändern wollen, editieren Sie die Konfigurationsdatei des Docker-Daemons <code>/etc/docker/daemon.json</code> und starten Sie den Docker-Dienst neu:</p> <pre><code>{\n[...]\n  \"log-driver\": \"gelf\",\n  \"log-opts\": {\n    \"gelf-address\": \"udp://graylog:12201\"\n  }\n[...]\n}\n</code></pre> <p>Für Syslog:</p> <pre><code>{\n[...]\n  \"log-driver\": \"syslog\",\n  \"log-opts\": {\n    \"syslog-address\": \"udp://1.2.3.4:514\"\n  }\n[...]\n}\n</code></pre> <p>Starten Sie den Docker-Daemon neu und führen Sie die folgenden Befehle aus, um die Container mit dem neuen Protokollierungstreiber neu zu erstellen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Firststeps logging.de"],"tags":[]},{"location":"post_installation/firststeps-logging.de/#log-rotation","level":3,"title":"Log rotation","text":"<p>Da diese Logs sehr groß werden können, ist es eine gute Idee logrotate zu nutzen, um Logs nach einer gewissen Zeit zu komprimieren und zu löschen.</p> <p>Erstellen Sie die Datei <code>/etc/logrotate.d/mailcow</code> mit folgendem Inhalt:</p> <pre><code>/var/log/mailcow.log {\n        rotate 7\n        daily\n        compress\n        delaycompress\n        missingok\n        notifempty\n        create 660 root root\n}\n</code></pre> <p>Mit dieser Konfiguration wird logrotate täglich ausgeführt und es werden maximal 7 Archive gespeichert.</p> <p>Um die Logdatei wöchentlich oder monatlich zu rotieren, muss <code>daily</code> durch <code>weekly</code> oder respektive <code>monthly</code> ersetzt werden.</p> <p>Um mehr Archive zu speichern, muss die Nummer hinter <code>rotate</code> angepasst werden.</p> <p>Danach kann logrotate neu gestartet werden.</p>","path":["Firststeps logging.de"],"tags":[]},{"location":"post_installation/firststeps-logging.en/","level":1,"title":"Firststeps logging.en","text":"<p>Logging in mailcow: dockerized consists of multiple stages, but is, after all, much more flexible and easier to integrate into a logging daemon than before.</p> <p>In Docker the containerized application (PID 1) writes its output to stdout. For real one-application containers this works just fine. Run the command below to learn more:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --help\n</code></pre> <pre><code>docker-compose logs --help\n</code></pre> <p>Some containers log or stream to multiple destinations.</p> <p>No container will keep persistent logs in it. Containers are transient items!</p> <p>In the end, every line of logs will reach the Docker daemon - unfiltered.</p> <p>The default logging driver is \"json\".</p>","path":["Firststeps logging.en"],"tags":[]},{"location":"post_installation/firststeps-logging.en/#filtered-logs","level":3,"title":"Filtered logs","text":"<p>Some logs are filtered and written to Redis keys but also streamed to a Redis channel.</p> <p>The Redis channel is used to stream logs with failed authentication attempts to be read by netfilter-mailcow.</p> <p>The Redis keys are persistent and will keep 10000 lines of logs for the web UI.</p> <p>This mechanism makes it possible to use whatever Docker logging driver you want to, without losing  the ability to read logs from the UI or ban suspicious clients with netfilter-mailcow.</p> <p>Redis keys will only hold logs from applications and filter out system messages (think of cron etc.).</p>","path":["Firststeps logging.en"],"tags":[]},{"location":"post_installation/firststeps-logging.en/#logging-drivers","level":3,"title":"Logging drivers","text":"","path":["Firststeps logging.en"],"tags":[]},{"location":"post_installation/firststeps-logging.en/#via-docker-composeoverrideyml","level":4,"title":"Via docker-compose.override.yml","text":"<p>Here is the good news: Since Docker has some great logging drivers, you can integrate mailcow: dockerized into your existing logging environment with ease.</p> <p>Create a <code>docker-compose.override.yml</code> and add, for example, this block to use the \"gelf\" logging plugin for <code>postfix-mailcow</code>:</p> <pre><code>services:\n  postfix-mailcow: # or any other\n    logging:\n      driver: \"gelf\"\n      options:\n        gelf-address: \"udp://graylog:12201\"\n</code></pre> <p>Another example for Syslog:</p> <pre><code>services:\n\n  postfix-mailcow: # or any other\n    logging:\n      driver: \"syslog\"\n      options:\n        syslog-address: \"udp://127.0.0.1:514\"\n        syslog-facility: \"local3\"\n\n  dovecot-mailcow: # or any other\n    logging:\n      driver: \"syslog\"\n      options:\n        syslog-address: \"udp://127.0.0.1:514\"\n        syslog-facility: \"local3\"\n\n  rspamd-mailcow: # or any other\n    logging:\n      driver: \"syslog\"\n      options:\n        syslog-address: \"udp://127.0.0.1:514\"\n        syslog-facility: \"local3\"\n</code></pre>","path":["Firststeps logging.en"],"tags":[]},{"location":"post_installation/firststeps-logging.en/#for-rsyslog-only","level":5,"title":"For Rsyslog only:","text":"<p>Make sure the following lines aren't commented out in <code>/etc/rsyslog.conf</code>:</p> <pre><code># provides UDP syslog reception\nmodule(load=\"imudp\")\ninput(type=\"imudp\" port=\"514\")\n</code></pre> <p>To move <code>local3</code> input to <code>/var/log/mailcow.log</code> and stop processing, create a file <code>/etc/rsyslog.d/docker.conf</code>:</p> <pre><code>local3.*        /var/log/mailcow.log\n&amp; stop\n</code></pre> <p>Restart rsyslog afterwards.</p>","path":["Firststeps logging.en"],"tags":[]},{"location":"post_installation/firststeps-logging.en/#via-daemonjson-globally","level":4,"title":"via daemon.json (globally)","text":"<p>If you want to change the logging driver globally, edit Dockers daemon configuration file <code>/etc/docker/daemon.json</code> and restart the Docker service:</p> <pre><code>{\n...\n  \"log-driver\": \"gelf\",\n  \"log-opts\": {\n    \"gelf-address\": \"udp://graylog:12201\"\n  }\n...\n}\n</code></pre> <p>For Syslog:</p> <pre><code>{\n...\n  \"log-driver\": \"syslog\",\n  \"log-opts\": {\n    \"syslog-address\": \"udp://1.2.3.4:514\"\n  }\n...\n}\n</code></pre> <p>Restart the Docker daemon and run the commands below to recreate the containers with the new logging driver:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Firststeps logging.en"],"tags":[]},{"location":"post_installation/firststeps-logging.en/#log-rotation","level":3,"title":"Log rotation","text":"<p>As those logs can get quite big, it is a good idea to use logrotate to compress and delete them after a certain time period.</p> <p>Create <code>/etc/logrotate.d/mailcow</code> with the following content:</p> <pre><code>/var/log/mailcow.log {\n        rotate 7\n        daily\n        compress\n        delaycompress\n        missingok\n        notifempty\n        create 660 root root\n}\n</code></pre> <p>With this configuration, logrotate will run daily and keep a maximum of 7 archives.</p> <p>To rotate the logfile weekly or monthly replace <code>daily</code> with <code>weekly</code> or <code>monthly</code> respectively.</p> <p>To keep more archives, set the desired number of <code>rotate</code>.</p> <p>Afterwards, logrotate can be restarted.</p>","path":["Firststeps logging.en"],"tags":[]},{"location":"post_installation/firststeps-snat.de/","level":1,"title":"Firststeps snat.de","text":"<p>SNAT wird verwendet, um die Quelladresse der von mailcow gesendeten Pakete zu ändern. Es kann verwendet werden, um die ausgehende IP-Adresse auf Systemen mit mehreren IP-Adressen zu ändern.</p> <p>Öffnen Sie <code>mailcow.conf</code>, setzen Sie einen oder beide der folgenden Parameter:</p> <pre><code># Benutze diese IPv4 für ausgehende Verbindungen (SNAT)\nSNAT_TO_SOURCE=1.2.3.4\n\n# Benutze dieses IPv6 für ausgehende Verbindungen (SNAT)\nSNAT6_TO_SOURCE=dead:beef\n</code></pre> <p>Führen Sie folgendes aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Die Werte werden von netfilter-mailcow gelesen. netfilter-mailcow stellt sicher, dass die Post-Routing-Regeln auf Position 1 in der Netfilter-Tabelle stehen. Es löscht sie automatisch und legt sie neu an, wenn sie an einer anderen Position als 1 gefunden werden.</p> <p>Überprüfen Sie die Ausgabe mit hilfe des folgendem Befehles um sicherzustellen, dass die SNAT-Einstellungen angewendet wurden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --tail=200 netfilter-mailcow\n</code></pre> <pre><code>docker-compose logs --tail=200 netfilter-mailcow\n</code></pre>","path":["Firststeps snat.de"],"tags":[]},{"location":"post_installation/firststeps-snat.en/","level":1,"title":"Firststeps snat.en","text":"<p>SNAT is used to change the source address of the packets sent by mailcow. It can be used to change the outgoing IP address on systems with multiple IP addresses.</p> <p>Open <code>mailcow.conf</code>, set either or both of the following parameters:</p> <pre><code># Use this IPv4 for outgoing connections (SNAT)\nSNAT_TO_SOURCE=1.2.3.4\n\n# Use this IPv6 for outgoing connections (SNAT)\nSNAT6_TO_SOURCE=dead:beef\n</code></pre> <p>Run the command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>The values are read by netfilter-mailcow. netfilter-mailcow will make sure, the post-routing rules are on position 1 in the netfilter table. It does automatically delete and re-create them if they are found on another position than 1.</p> <p>Check the output with the following command to ensure the SNAT settings have been applied:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --tail=200 netfilter-mailcow\n</code></pre> <pre><code>docker-compose logs --tail=200 netfilter-mailcow\n</code></pre>","path":["Firststeps snat.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/","level":1,"title":"Firststeps ssl.de","text":"","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#lets-encrypt-wird-mitgeliefert","level":2,"title":"Let's Encrypt (wird mitgeliefert)","text":"<p>Der \"acme-mailcow\" Container wird versuchen, ein LE-Zertifikat für <code>${MAILCOW_HOSTNAME}</code>, <code>autodiscover.ADDED_MAIL_DOMAIN</code> und <code>autoconfig.ADDED_MAIL_DOMAIN</code> zu erhalten.</p> <p>Warnung</p> <p>mailcow muss auf Port 80 verfügbar sein, damit der acme-Client funktioniert. Unsere Reverse Proxy Beispielkonfigurationen decken das ab. Sie können auch jeden externen ACME-Client (z.B. certbot) verwenden, um Zertifikate zu erhalten, aber Sie müssen sicherstellen, dass sie an den richtigen Ort kopiert werden und ein Post-Hook die betroffenen Container neu lädt. Weitere Informationen finden Sie in der Reverse Proxy-Dokumentation.</p> <p>Standardmäßig, d.h. 0 Domains sind zu mailcow hinzugefügt, wird es versuchen, ein Zertifikat für <code>${MAILCOW_HOSTNAME}</code> zu erhalten.</p> <p>Für jede hinzugefügte Domain wird versucht, <code>autodiscover.ADDED_MAIL_DOMAIN</code> und <code>autoconfig.ADDED_MAIL_DOMAIN</code> in die IPv6-Adresse oder - falls IPv6 in der Domain nicht konfiguriert ist - in die IPv4-Adresse aufzulösen. Wenn dies gelingt, wird ein Name als SAN zur Zertifikatsanforderung hinzugefügt.</p> <p>Nur Namen, die validiert werden können, werden als SAN hinzugefügt.</p> <p>Für jede Domain, die Sie entfernen, wird das Zertifikat verschoben und ein neues Zertifikat angefordert. Es ist nicht möglich, Domains in einem Zertifikat zu behalten, wenn wir nicht in der Lage sind, die Challenge für diese zu validieren.</p> <p>Wenn Sie den ACME-Client neu starten wollen, verwenden Sie den folgenden Befehl:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart acme-mailcow\n</code></pre> <pre><code>docker-compose restart acme-mailcow\n</code></pre> <p>Überwachen Sie die Logs mit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --tail=200 -f acme-mailcow\n</code></pre> <pre><code>docker-compose logs --tail=200 -f acme-mailcow\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#zusatzliche-domain-namen","level":3,"title":"Zusätzliche Domain-Namen","text":"<p>Bearbeiten Sie \"mailcow.conf\" und fügen Sie einen Parameter <code>ADDITIONAL_SAN</code> wie folgt hinzu:</p> <p>Verwenden Sie keine Anführungszeichen (<code>\"</code>) und keine Leerzeichen zwischen den Namen!</p> <pre><code>ADDITIONAL_SAN=smtp.*,cert1.example.com,cert2.example.org,whatever.*\n</code></pre> <p>Jeder Name wird anhand seiner IPv6-Adresse oder - wenn IPv6 in Ihrer Domäne nicht konfiguriert ist - anhand seiner IPv4-Adresse überprüft.</p> <p>Ein Wildcard-Name wie <code>smtp.*</code> wird versuchen, ein smtp.DOMAIN_NAME SAN für jede zu mailcow hinzugefügte Domain zu erhalten.</p> <p>Führen Sie den folgenden Befehl aus, um betroffene Container automatisch neu zu erstellen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Info</p> <p>Die Verwendung anderer Namen als <code>MAILCOW_HOSTNAME</code> für den Zugriff auf das mailcow UI kann weitere Konfiguration erfordern.</p> <p>Wenn Sie planen, einen anderen Servernamen als <code>MAILCOW_HOSTNAME</code> für den Zugriff auf die mailcow UI zu verwenden (z.B. durch Hinzufügen von <code>mail.*</code> zu <code>ADDITIONAL_SAN</code>), stellen Sie sicher, dass Sie diesen Namen in mailcow.conf über <code>ADDITIONAL_SERVER_NAMES</code> eintragen. Die Namen müssen durch Kommas getrennt sein und dürfen keine Leerzeichen enthalten. Wenn Sie diesen Schritt auslassen, kann mailcow mit einer falschen Seite antworten.</p> <pre><code>ADDITIONAL_SERVER_NAMES=webmail.domain.tld,other.example.tld\n</code></pre> <p>Führen Sie den folgenden Befehl aus, um es anzuwenden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#erneuerung-erzwingen","level":3,"title":"Erneuerung erzwingen","text":"<p>Um eine Erneuerung zu erzwingen, müssen Sie eine Datei namens <code>force_renew</code> erstellen und den <code>acme-mailcow</code> Container neu starten:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ntouch data/assets/ssl/force_renew\ndocker compose restart acme-mailcow\n# Prüfen Sie nun die Logs auf eine Erneuerung\ndocker compose logs --tail=200 -f acme-mailcow\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ntouch data/assets/ssl/force_renew\ndocker-compose restart acme-mailcow\n# Prüfen Sie nun die Logs auf eine Erneuerung\ndocker-compose logs --tail=200 -f acme-mailcow\n</code></pre> <p>Die Datei wird automatisch gelöscht.</p>","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#validierungsfehler-und-wie-man-die-validierung-uberspringt","level":3,"title":"Validierungsfehler und wie man die Validierung überspringt","text":"<p>Sie können die IP-Überprüfung überspringen, indem Sie <code>SKIP_IP_CHECK=y</code> in mailcow.conf setzen (keine Anführungszeichen). Seien Sie gewarnt, dass eine Fehlkonfiguration dazu führt, dass Sie von Let's Encrypt eingeschränkt werden! Dies ist vor allem für Multi-IP-Setups nützlich, bei denen der IP-Check die falsche Quell-IP-Adresse zurückgeben würde. Aufgrund der Verwendung von dynamischen IPs für acme-mailcow ist Source-NAT bei Neustarts nicht konsistent.</p> <p>Wenn Sie Probleme mit der \"HTTP-Validierung\" haben, aber Ihre IP-Adressbestätigung erfolgreich ist, verwenden Sie höchstwahrscheinlich firewalld, ufw oder eine andere Firewall, die Verbindungen von <code>br-mailcow</code> zu Ihrem externen Interface verbietet. Sowohl firewalld als auch ufw lassen dies standardmäßig nicht zu. Es reicht oft nicht aus, diese Firewall-Dienste einfach zu stoppen. Sie müssen mailcow stoppen, den Firewall-Dienst stoppen, die Chains flushen und Docker neu starten.</p> <p>Sie können diese Validierungsmethode auch überspringen, indem Sie <code>SKIP_HTTP_VERIFICATION=y</code> in \"mailcow.conf\" setzen. Seien Sie gewarnt, dass dies nicht zu empfehlen ist. In den meisten Fällen wird die HTTP-Überprüfung übersprungen, um unbekannte NAT-Reflection-Probleme zu umgehen, die durch das Ignorieren dieser spezifischen Netzwerk-Fehlkonfiguration nicht gelöst werden. Wenn Sie Probleme haben, TLSA-Einträge in der DNS-Übersicht innerhalb von mailcow zu generieren, haben Sie höchstwahrscheinlich Probleme mit NAT-Reflexion, die Sie beheben sollten.</p> <p>Wenn Sie einen SKIP_* Parameter geändert haben, führen Sie den folgenden Befehl aus, um die Änderungen zu übernehmen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#deaktivieren-sie-lets-encrypt","level":3,"title":"Deaktivieren Sie Let's Encrypt","text":"","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#deaktivieren-sie-lets-encrypt-vollstandig","level":4,"title":"Deaktivieren Sie Let's Encrypt vollständig","text":"<p>Setzen Sie <code>SKIP_LETS_ENCRYPT=y</code> in \"mailcow.conf\" und erstellen Sie \"acme-mailcow\" neu, mit dem folgenden Befehl:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#alle-namen-auer-mailcow_hostname-uberspringen","level":4,"title":"Alle Namen außer ${MAILCOW_HOSTNAME} überspringen","text":"<p>Fügen Sie <code>ONLY_MAILCOW_HOSTNAME=y</code> zu \"mailcow.conf\" hinzu und erstellen Sie \"acme-mailcow\" neu, mit dem folgenden Befehl:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#das-lets-encrypt-subjectaltname-limit-von-100-domains","level":3,"title":"Das Let's Encrypt subjectAltName-Limit von 100 Domains","text":"<p>Let's Encrypt hat derzeit ein Limit von 100 Domainnamen pro Zertifikat.</p> <p>Standardmäßig erstellt \"acme-mailcow\" ein einzelnes SAN-Zertifikat für alle validierten Domains (siehe den ersten Abschnitt und Zusätzliche Domainnamen). Dies bietet beste Kompatibilität, bedeutet aber, dass das Let's Encrypt-Limit überschritten wird, wenn Sie zu viele Domains zu einer einzelnen mailcow-Installation hinzufügen.</p> <p>Um dies zu lösen, können Sie <code>ENABLE_SSL_SNI</code> so konfigurieren, dass es generiert wird:</p> <ul> <li>Ein Hauptserver-Zertifikat mit <code>MAILCOW_HOSTNAME</code> und allen voll qualifizierten Domainnamen in der <code>ADDITIONAL_SAN</code> Konfiguration</li> <li>Ein zusätzliches Zertifikat für jede in der Datenbank gefundene Domain mit autodiscover., autoconfig. und jeder anderen in diesem Format konfigurierten <code>ADDITIONAL_SAN</code> (subdomain.*).</li> <li>Begrenzungen: Ein Zertifikatsname <code>ADDITIONAL_SAN=test.example.com</code> wird als SAN zum Hauptzertifikat hinzugefügt. Ein separates Zertifikat/Schlüsselpaar wird für dieses Format nicht erzeugt.</li> </ul> <p>Postfix, Dovecot und Nginx werden dann diese Zertifikate mit SNI bedienen.</p> <p>Setzen Sie <code>ENABLE_SSL_SNI=y</code> in \"mailcow.conf\" und erstellen Sie \"acme-mailcow\" mit dem folgenden Befehl neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Warnung</p> <p>Nicht alle Clients unterstützen SNI, siehe Dovecot Dokumentation oder Wikipedia. Sie sollten sicherstellen, dass diese Clients den <code>MAILCOW_HOSTNAME</code> für sichere Verbindungen verwenden, wenn Sie diese Funktion aktivieren.</p> <p>Hier ist ein Beispiel:</p> <ul> <li><code>MAILCOW_HOSTNAME=server.email.tld</code></li> <li><code>ADDITIONAL_SAN=webmail.email.tld,mail.*</code></li> <li>mailcow E-Mail-Domänen: \"domain1.tld\" und \"domain2.tld\"</li> </ul> <p>Die folgenden Zertifikate werden generiert:</p> <ul> <li><code>server.email.tld, webmail.email.tld</code> -&gt; dies ist das Standard-Zertifikat, alle Clients können sich mit diesen Domains verbinden</li> <li><code>mail.domain1.tld, autoconfig.domain1.tld, autodiscover.domain1.tld</code> -&gt; individuelles Zertifikat für domain1.tld, kann von Clients ohne SNI-Unterstützung nicht verwendet werden</li> <li><code>mail.domain2.tld, autoconfig.domain2.tld, autodiscover.domain2.tld</code> -&gt; individuelles Zertifikat für domain2.tld, kann von Clients ohne SNI-Unterstützung nicht verwendet werden</li> </ul>","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#ein-eigenes-zertifikat-verwenden","level":3,"title":"Ein eigenes Zertifikat verwenden","text":"<p>Stellen Sie sicher, dass Sie mailcows internen LE-Client deaktivieren (siehe oben).</p> <p>Um Ihre eigenen Zertifikate zu verwenden, speichern Sie einfach das kombinierte Zertifikat (mit dem Zertifikat und der zwischengeschalteten CA/CA, falls vorhanden) unter <code>data/assets/ssl/cert.pem</code> und den entsprechenden Schlüssel unter <code>data/assets/ssl/key.pem</code>.</p> <p>WICHTIG: Verwenden Sie keine symbolischen Links! Stellen Sie sicher, dass Sie die Zertifikate kopieren und sie nicht mit <code>data/assets/ssl</code> verknüpfen.</p> <p>Starten Sie die betroffenen Dienste anschließend neu:</p> <pre><code>docker restart $(docker ps -qaf name=postfix-mailcow)\ndocker restart $(docker ps -qaf name=nginx-mailcow)\ndocker restart $(docker ps -qaf name=dovecot-mailcow)\n</code></pre> <p>Siehe Post-Hook-Skript für Nicht-mailcow-ACME-Clients für ein vollständiges Beispielskript.</p>","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#test-gegen-das-acme-verzeichnis","level":3,"title":"Test gegen das ACME-Verzeichnis","text":"<p>Bearbeiten Sie <code>mailcow.conf</code> und fügen Sie <code>LE_STAGING=y</code> hinzu.</p> <p>Führen Sie den folgenden Befehl aus, um Ihre Änderungen zu aktivieren:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#benutzerdefinierte-verzeichnis-url","level":3,"title":"Benutzerdefinierte Verzeichnis-URL","text":"<p>Editieren Sie <code>mailcow.conf</code> und fügen Sie die entsprechende Verzeichnis-URL in die neue Variable <code>DIRECTORY_URL</code> ein:</p> <pre><code>DIRECTORY_URL=https://acme-custom-v9000.api.letsencrypt.org/directory\n</code></pre> <p>Sie können <code>LE_STAGING</code> nicht mit <code>DIRECTORY_URL</code> verwenden. Wenn beide gesetzt sind, wird nur <code>LE_STAGING</code> verwendet.</p> <p>Führen Sie den folgenden Befehl aus, um Ihre Änderungen zu aktivieren:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#caa-eintrage-mit-dem-accounturi-parameter","level":3,"title":"CAA-Einträge mit dem <code>accounturi</code>-Parameter","text":"<p>Let's Encrypt ermöglicht es, mithilfe des <code>accounturi</code>-Paramaters in CAA-Einträgen die Zertifikatsausstellung auf spezifische Account-IDs zu beschränken. Sie können das Helper-Skript <code>generate_caa_record.py</code> verwenden, um einen CAA-Eintrag mit <code>accounturi</code> zu erstellen, welchen Sie dann bei Ihrem DNS-Anbieter eintragen können:</p> <pre><code>./helper-scripts/generate_caa_record.py --account-key data/assets/ssl/acme/account.pem --contact mailto:ihre_acme_email@beispiel.de\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.de/#uberprufen-sie-ihre-konfiguration","level":3,"title":"Überprüfen Sie Ihre Konfiguration","text":"<p>Führen Sie den folgenden Befehl aus, um herauszufinden, warum eine Validierung fehlschlägt:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --tail=200 acme-mailcow\n</code></pre> <pre><code>docker-compose logs --tail=200 acme-mailcow\n</code></pre> <p>Um zu überprüfen, ob nginx das richtige Zertifikat verwendet, benutzen Sie einfach einen Browser Ihrer Wahl und überprüfen Sie das angezeigte Zertifikat.</p> <p>Um das von Postfix, Dovecot und Nginx verwendete Zertifikat zu überprüfen, verwenden wir <code>openssl</code>:</p> <pre><code># Verbindung über SMTP STARTTLS (587)\nopenssl s_client -starttls smtp -connect MAILCOW_HOSTNAME:587 | openssl x509 -noout -text\n# Verbindung über SMTP (465)\nopenssl s_client -connect MAILCOW_HOSTNAME:465 | openssl x509 -noout -text\n\n# Verbindung über IMAP STARTTLS (143)\nopenssl s_client -starttls imap -connect MAILCOW_HOSTNAME:143 | openssl x509 -noout -text\n# Verbindung über IMAP (993)\nopenssl s_client -connect MAILCOW_HOSTNAME:993 | openssl x509 -noout -text\n\n# Verbindung über HTTPS (443)\nopenssl s_client -connect MAILCOW_HOSTNAME:443 | openssl x509 -noout -text\n</code></pre> <p>Um die von openssl zurückgegebenen Verfallsdaten gegen MAILCOW_HOSTNAME zu validieren, können Sie unser Hilfsskript verwenden:</p> <pre><code>cd /opt/mailcow-dockerized\nbash helper-scripts/expiry-dates.sh\n</code></pre>","path":["Firststeps ssl.de"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/","level":1,"title":"Firststeps ssl.en","text":"","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#lets-encrypt-out-of-the-box","level":2,"title":"Let's Encrypt (out-of-the-box)","text":"<p>The \"acme-mailcow\" container will try to obtain a LE certificate for <code>${MAILCOW_HOSTNAME}</code>, <code>autodiscover.ADDED_MAIL_DOMAIN</code> and <code>autoconfig.ADDED_MAIL_DOMAIN</code>.</p> <p>Warning</p> <p>mailcow must be available on port 80 for the acme-client to work. Our reverse proxy example configurations do cover that. You can also use any external ACME client (certbot for example) to obtain certificates, but you will need to make sure, that they are copied to the correct location and a post-hook reloads affected containers. See more in the Reverse Proxy documentation.</p> <p>By default, which means 0 domains are added to mailcow, it will try to obtain a certificate for <code>${MAILCOW_HOSTNAME}</code>.</p> <p>For each domain you add, it will try to resolve <code>autodiscover.ADDED_MAIL_DOMAIN</code> and <code>autoconfig.ADDED_MAIL_DOMAIN</code> to its IPv6 address or - if IPv6 is not configured in your domain - IPv4 address. If it succeeds, a name will be added as SAN to the certificate request.</p> <p>Only names that can be validated, will be added as SAN.</p> <p>For every domain you remove, the certificate will be moved and a new certificate will be requested. It is not possible to keep domains in a certificate, when we are not able validate the challenge for those.</p> <p>If you want to re-run the ACME client, use the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart acme-mailcow\n</code></pre> <pre><code>docker-compose restart acme-mailcow\n</code></pre> <p>Monitor its logs with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --tail=200 -f acme-mailcow\n</code></pre> <pre><code>docker-compose logs --tail=200 -f acme-mailcow\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#additional-domain-names","level":3,"title":"Additional domain names","text":"<p>Edit \"mailcow.conf\" and add a parameter <code>ADDITIONAL_SAN</code> like this:</p> <p>Do not use quotes (<code>\"</code>) and do not use spaces between the names!</p> <pre><code>ADDITIONAL_SAN=smtp.*,cert1.example.com,cert2.example.org,whatever.*\n</code></pre> <p>Each name will be validated against its IPv6 address or - if IPv6 is not configured in your domain - IPv4 address.</p> <p>A wildcard name like <code>smtp.*</code> will try to obtain a smtp.DOMAIN_NAME SAN for each domain added to mailcow.</p> <p>Run the following command  to recreate affected containers automatically:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Info</p> <p>Using names other name <code>MAILCOW_HOSTNAME</code> to access the mailcow UI may need further configuration.</p> <p>If you plan to use a server name that is not <code>MAILCOW_HOSTNAME</code> to access the mailcow UI (for example by adding <code>mail.*</code> to <code>ADDITIONAL_SAN</code> make sure to populate that name in mailcow.conf via <code>ADDITIONAL_SERVER_NAMES</code>. Names must be separated by commas and must not contain spaces. If you skip this step, mailcow may respond with an incorrect site.</p> <pre><code>ADDITIONAL_SERVER_NAMES=webmail.domain.tld,other.example.tld\n</code></pre> <p>Run the command below to apply:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#force-renewal","level":3,"title":"Force renewal","text":"<p>To force a renewal, you need to create a file named <code>force_renew</code> and restart the <code>acme-mailcow</code> container:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ntouch data/assets/ssl/force_renew\ndocker compose restart acme-mailcow\n# Now check the logs for a renewal\ndocker compose logs --tail=200 -f acme-mailcow\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ntouch data/assets/ssl/force_renew\ndocker-compose restart acme-mailcow\n# Now check the logs for a renewal\ndocker-compose logs --tail=200 -f acme-mailcow\n</code></pre> <p>The file will be deleted automatically.</p>","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#validation-errors-and-how-to-skip-validation","level":3,"title":"Validation errors and how to skip validation","text":"<p>You can skip the IP verification by setting <code>SKIP_IP_CHECK=y</code> in mailcow.conf (no quotes). Be warned that a misconfiguration will get you ratelimited by Let's Encrypt! This is primarily useful for multi-IP setups where the IP check would return the incorrect source IP address. Due to using dynamic IPs for acme-mailcow, source NAT is not consistent over restarts.</p> <p>If you encounter problems with \"HTTP validation\", but your IP address confirmation succeeds, you are most likely using firewalld, ufw or any other firewall, that disallows connections from <code>br-mailcow</code> to your external interface. Both firewalld and ufw disallow this by default. It is often not enough to just stop these firewall services. You'd need to stop mailcow, stop the firewall service, flush the chains and restart Docker.</p> <p>You can also skip this validation method by setting <code>SKIP_HTTP_VERIFICATION=y</code> in \"mailcow.conf\". Be warned that this is discouraged. In most cases, the HTTP verification is skipped to workaround unknown NAT reflection issues, which are not resolved by ignoring this specific network misconfiguration. If you encounter problems generating TLSA records in the DNS overview within mailcow, you are most likely having issues with NAT reflection you should fix.</p> <p>If you changed a SKIP_* parameter, run the command below to apply your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#disable-lets-encrypt","level":3,"title":"Disable Let's Encrypt","text":"","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#disable-lets-encrypt-completely","level":4,"title":"Disable Let's Encrypt completely","text":"<p>Set <code>SKIP_LETS_ENCRYPT=y</code> in \"mailcow.conf\" and recreate \"acme-mailcow\" with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#skip-all-names-but-mailcow_hostname","level":4,"title":"Skip all names but ${MAILCOW_HOSTNAME}","text":"<p>Add <code>ONLY_MAILCOW_HOSTNAME=y</code> to \"mailcow.conf\" and recreate \"acme-mailcow\" with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#the-lets-encrypt-subjectaltname-limit-of-100-domains","level":3,"title":"The Let's Encrypt subjectAltName limit of 100 domains","text":"<p>Let's Encrypt currently has a limit of 100 Domain Names per Certificate.</p> <p>By default, \"acme-mailcow\" will create a single SAN certificate for all validated domains (see the first section and Additional domain names). This provides best compatibility but means the Let's Encrypt limit exceeds if you add too many domains to a single mailcow installation.</p> <p>To solve this, you can configure <code>ENABLE_SSL_SNI</code> to generate:</p> <ul> <li>A main server certificate with <code>MAILCOW_HOSTNAME</code> and all fully qualified domain names in the <code>ADDITIONAL_SAN</code> config</li> <li>One additional certificate for each domain found in the database with autodiscover., autoconfig. and any other <code>ADDITIONAL_SAN</code> configured in this format (subdomain.*).</li> <li>Limitations: A certificate name <code>ADDITIONAL_SAN=test.example.com</code> will be added as SAN to the main certificate. A separate certificate/key pair will not be generated for this format.</li> </ul> <p>Postfix, Dovecot and Nginx will then serve these certificates with SNI.</p> <p>Set <code>ENABLE_SSL_SNI=y</code> in \"mailcow.conf\" and recreate \"acme-mailcow\" with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Warning</p> <p>Not all clients support SNI, see Dovecot documentation or Wikipedia. You should make sure these clients use the <code>MAILCOW_HOSTNAME</code> for secure connections if you enable this feature.</p> <p>Here is an example:</p> <ul> <li><code>MAILCOW_HOSTNAME=server.email.tld</code></li> <li><code>ADDITIONAL_SAN=webmail.email.tld,mail.*</code></li> <li>mailcow email domains: \"domain1.tld\" and \"domain2.tld\"</li> </ul> <p>The following certificates will be generated:</p> <ul> <li><code>server.email.tld, webmail.email.tld</code> -&gt; this is the default certificate, all clients can connect with these domains</li> <li><code>mail.domain1.tld, autoconfig.domain1.tld, autodiscover.domain1.tld</code> -&gt; individual certificate for domain1.tld, cannot be used by clients without SNI support</li> <li><code>mail.domain2.tld, autoconfig.domain2.tld, autodiscover.domain2.tld</code> -&gt; individual certificate for domain2.tld, cannot be used by clients without SNI support</li> </ul>","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#how-to-use-your-own-certificate","level":3,"title":"How to use your own certificate","text":"<p>Make sure you disable mailcows internal LE client (see above).</p> <p>To use your own certificates, just save the combined certificate (containing the certificate and intermediate CA/CA if any) to <code>data/assets/ssl/cert.pem</code> and the corresponding key to <code>data/assets/ssl/key.pem</code>.</p> <p>IMPORTANT: Do not use symbolic links! Make sure you copy the certificates and do not link them to <code>data/assets/ssl</code>.</p> <p>Restart affected services afterwards:</p> <pre><code>docker restart $(docker ps -qaf name=postfix-mailcow)\ndocker restart $(docker ps -qaf name=nginx-mailcow)\ndocker restart $(docker ps -qaf name=dovecot-mailcow)\n</code></pre> <p>See Post-hook script for non-mailcow ACME clients for a full example script.</p>","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#test-against-staging-acme-directory","level":3,"title":"Test against staging ACME directory","text":"<p>Edit <code>mailcow.conf</code> and add <code>LE_STAGING=y</code>.</p> <p>Run the command below to activate your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#custom-directory-url","level":3,"title":"Custom directory URL","text":"<p>Edit <code>mailcow.conf</code> and add the corresponding directory URL to the new variable <code>DIRECTORY_URL</code>:</p> <pre><code>DIRECTORY_URL=https://acme-custom-v9000.api.letsencrypt.org/directory\n</code></pre> <p>You cannot use <code>LE_STAGING</code> with <code>DIRECTORY_URL</code>. If both are set, only <code>LE_STAGING</code> is used.</p> <p>Run the command below to activate your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#use-caa-records-with-the-accounturi-parameter","level":3,"title":"Use CAA records with the <code>accounturi</code> parameter","text":"<p>Let's Encrypt allows restricting certificate issuance to specific account IDs via the <code>accounturi</code> parameter in CAA records. You can use the <code>generate_caa_record.py</code> helper script to generate a CAA record with <code>accounturi</code>, which you can then enter with your DNS provider:</p> <pre><code>./helper-scripts/generate_caa_record.py --account-key data/assets/ssl/acme/account.pem --contact mailto:your_acme_email@example.com\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-ssl.en/#check-your-configuration","level":3,"title":"Check your configuration","text":"<p>Run the command below to find out why a validation fails:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs --tail=200 acme-mailcow\n</code></pre> <pre><code>docker-compose logs --tail=200 acme-mailcow\n</code></pre> <p>To check if nginx serves the correct certificate, simply use a browser of your choice and check the displayed certificate.</p> <p>To check the certificate served by Postfix, Dovecot and Nginx we will use <code>openssl</code>:</p> <pre><code># Connect via SMTP STARTTLS (587)\nopenssl s_client -starttls smtp -connect MAILCOW_HOSTNAME:587 | openssl x509 -noout -text\n# Connect via SMTP (465)\nopenssl s_client -connect MAILCOW_HOSTNAME:465 | openssl x509 -noout -text\n\n# Connect via IMAP STARTTLS (143)\nopenssl s_client -starttls imap -connect MAILCOW_HOSTNAME:143 | openssl x509 -noout -text\n# Connect via IMAP (993)\nopenssl s_client -connect MAILCOW_HOSTNAME:993 | openssl x509 -noout -text\n\n# Connect via HTTPS (443)\nopenssl s_client -connect MAILCOW_HOSTNAME:443 | openssl x509 -noout -text\n</code></pre> <p>To validate the expiry dates as returned by openssl against MAILCOW_HOSTNAME, you are able to use our helper script:</p> <pre><code>cd /opt/mailcow-dockerized\nbash helper-scripts/expiry-dates.sh\n</code></pre>","path":["Firststeps ssl.en"],"tags":[]},{"location":"post_installation/firststeps-sync_jobs_migration.de/","level":1,"title":"Firststeps sync jobs migration.de","text":"<p>Sync-Aufträge werden verwendet, um bestehende E-Mails von einem externen IMAP-Server oder innerhalb von mailcow's bestehenden Mailboxen zu kopieren oder zu verschieben.</p> <p>Info</p> <p>Abhängig von der ACL Ihrer Mailbox haben Sie möglicherweise nicht die Möglichkeit, einen Sync-Job hinzuzufügen. Bitte kontaktieren Sie in diesem Fall Ihren Domain-Administrator.</p>","path":["Firststeps sync jobs migration.de"],"tags":[]},{"location":"post_installation/firststeps-sync_jobs_migration.de/#einrichten-eines-sync-jobs","level":2,"title":"Einrichten eines Sync-Jobs","text":"<ol> <li> <p>Erstellen Sie unter dem Punkt \"Konfiguration &gt; E-Mail-Setup\" oder \"Benutzereinstellungen\" einen neuen Synchronisierungsauftrag.</p> </li> <li> <p>Wenn Sie ein Administrator sind, wählen Sie den Benutzernamen der nachgelagerten mailcow-Mailbox im Dropdown-Menü \"Benutzername\".</p> </li> <li> <p>Füllen Sie die Felder \"Host\" und \"Port\" mit den entsprechenden korrekten Werten des vorgelagerten IMAP-Servers aus.</p> </li> <li> <p>Geben Sie in den Feldern \"Benutzername\" und \"Passwort\" die korrekten Zugangsdaten des vorgelagerten IMAP-Servers ein.</p> </li> <li> <p>Wählen Sie die \"Verschlüsselungsmethode\". Wenn der vorgelagerte IMAP-Server Port 143 verwendet, ist es wahrscheinlich, dass die Verschlüsselungsmethode TLS und SSL für Port 993 ist. Sie können auch PLAIN-Authentifizierung verwenden, aber davon wird dringend abgeraten.</p> </li> <li> <p>Alle anderen Felder können Sie so lassen, wie sie sind, oder sie nach Belieben ändern.</p> </li> <li> <p>Vergewissern Sie sich, dass Sie \"Aktiv\" ankreuzen und klicken Sie auf \"Hinzufügen\".</p> </li> </ol> <p>Info</p> <p>Sobald Sie fertig sind, melden Sie sich in der Mailbox an und überprüfen Sie, ob alle E-Mails korrekt importiert wurden. Wenn alles gut geht, werden alle Ihre E-Mails in Ihrem neuen Postfach landen. Vergessen Sie nicht, den Synchronisierungsauftrag zu löschen oder zu deaktivieren, nachdem er verwendet wurde.</p>","path":["Firststeps sync jobs migration.de"],"tags":[]},{"location":"post_installation/firststeps-sync_jobs_migration.en/","level":1,"title":"Firststeps sync jobs migration.en","text":"<p>Sync jobs are used to copy or move existing emails from an external IMAP server or within mailcow's existing mailboxes.</p> <p>Info</p> <p>Depending on your mailbox's ACL you may not have the option to add a sync job. Please contact your domain administrator if so.</p>","path":["Firststeps sync jobs migration.en"],"tags":[]},{"location":"post_installation/firststeps-sync_jobs_migration.en/#setup-a-sync-job","level":2,"title":"Setup a Sync Job","text":"<ol> <li> <p>In the \"Configuration &gt; Mail Setup\" or \"User Settings\" interface, create a new sync job.</p> </li> <li> <p>If you are an administrator, select the username of the downstream mailcow mailbox in the \"Username\" dropdown.</p> </li> <li> <p>Fill in the \"Host\" and \"Port\" fields with their respective correct values from the upstream IMAP server.</p> </li> <li> <p>In the \"Username\" and \"Password\" fields, supply the correct access credentials from the upstream IMAP server.</p> </li> <li> <p>Select the \"Encryption Method\". If the upstream IMAP server uses port 143, it is likely that the encryption method is TLS and SSL for port 993. Nevertheless, you can use PLAIN authentication, but it is stongly discouraged.</p> </li> <li> <p>For all ther other fields, you can leave them as is or modify them as desired.</p> </li> <li> <p>Make sure to tick \"Active\" and click \"Add\".</p> </li> </ol> <p>Info</p> <p>Once Completed, log into the mailbox and check if all emails are imported correctly. If all goes well, all your mails shall end up in your new mailbox. And don't forget to delete or deactivate the sync job after it is used.</p>","path":["Firststeps sync jobs migration.en"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p-apache24.de/","level":1,"title":"R p apache24.de","text":"<p>Wichtig</p> <p>Lesen Sie zuerst die Übersicht.</p> <p>Erforderliche Module: <pre><code>a2enmod rewrite proxy proxy_http headers ssl\n</code></pre></p> <p>Let's Encrypt wird unserem Rewrite folgen, Zertifikatsanfragen in mailcow werden problemlos funktionieren.</p> <p>Die hervorgehobenen Zeilen müssen beachtet werden.</p> <pre><code>&lt;VirtualHost *:80&gt;\n  ServerName ZU MAILCOW HOSTNAMEN ÄNDERN\n  ServerAlias autodiscover.*\n  ServerAlias autoconfig.*\n  RewriteEngine on\n\n  RewriteCond %{HTTPS} off\n  RewriteRule ^/?(.*) https://%{HTTP_HOST}/$1 [R=301,L]\n\n  ProxyPass / http://127.0.0.1:8080/\n  ProxyPassReverse / http://127.0.0.1:8080/\n  ProxyPreserveHost On\n  ProxyAddHeaders On\n  RequestHeader set X-Forwarded-Proto \"http\"\n&lt;/VirtualHost&gt;\n&lt;VirtualHost *:443&gt;\n  ServerName ZU MAILCOW HOSTNAMEN ÄNDERN\n  ServerAlias autodiscover.*\n  ServerAlias autoconfig.*\n\n  # You should proxy to a plain HTTP session to offload SSL processing\n  ProxyPass /Microsoft-Server-ActiveSync http://127.0.0.1:8080/Microsoft-Server-ActiveSync connectiontimeout=4000\n  ProxyPassReverse /Microsoft-Server-ActiveSync http://127.0.0.1:8080/Microsoft-Server-ActiveSync\n  ProxyPass / http://127.0.0.1:8080/\n  ProxyPassReverse / http://127.0.0.1:8080/\n  ProxyPreserveHost On\n  ProxyAddHeaders On\n  RequestHeader set X-Forwarded-Proto \"https\"\n\n  SSLCertificateFile MAILCOW_ORDNER/data/assets/ssl/cert.pem\n  SSLCertificateKeyFile MAILCOW_ORDNER/data/assets/ssl/key.pem\n\n  # Wenn Sie einen HTTPS-Host als Proxy verwenden möchten:\n  #SSLProxyEngine On\n\n  # Wenn Sie einen Proxy für einen nicht vertrauenswürdigen HTTPS-Host einrichten wollen:\n  #SSLProxyVerify none\n  #SSLProxyCheckPeerCN off\n  #SSLProxyCheckPeerName off\n  #SSLProxyCheckPeerExpire off\n&lt;/VirtualHost&gt;\n</code></pre>","path":["R p apache24.de"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p-apache24.en/","level":1,"title":"R p apache24.en","text":"<p>Important</p> <p>First read the overview.</p> <p>Required modules: <pre><code>a2enmod rewrite proxy proxy_http headers ssl\n</code></pre></p> <p>Let's Encrypt will follow our rewrite, certificate requests in mailcow will work fine.</p> <p>Take care of highlighted lines.</p> <pre><code>&lt;VirtualHost *:80&gt;\n  ServerName CHANGE_TO_MAILCOW_HOSTNAME\n  ServerAlias autodiscover.*\n  ServerAlias autoconfig.*\n  RewriteEngine on\n\n  RewriteCond %{HTTPS} off\n  RewriteRule ^/?(.*) https://%{HTTP_HOST}/$1 [R=301,L]\n\n  ProxyPass / http://127.0.0.1:8080/\n  ProxyPassReverse / http://127.0.0.1:8080/\n  ProxyPreserveHost On\n  ProxyAddHeaders On\n  RequestHeader set X-Forwarded-Proto \"http\"\n&lt;/VirtualHost&gt;\n&lt;VirtualHost *:443&gt;\n  ServerName CHANGE_TO_MAILCOW_HOSTNAME\n  ServerAlias autodiscover.*\n  ServerAlias autoconfig.*\n\n  # You should proxy to a plain HTTP session to offload SSL processing\n  ProxyPass /Microsoft-Server-ActiveSync http://127.0.0.1:8080/Microsoft-Server-ActiveSync connectiontimeout=4000\n  ProxyPassReverse /Microsoft-Server-ActiveSync http://127.0.0.1:8080/Microsoft-Server-ActiveSync\n  ProxyPass / http://127.0.0.1:8080/\n  ProxyPassReverse / http://127.0.0.1:8080/\n  ProxyPreserveHost On\n  ProxyAddHeaders On\n  RequestHeader set X-Forwarded-Proto \"https\"\n\n  SSLCertificateFile MAILCOW_PATH/data/assets/ssl/cert.pem\n  SSLCertificateKeyFile MAILCOW_PATH/data/assets/ssl/key.pem\n\n  # If you plan to proxy to a HTTPS host:\n  #SSLProxyEngine On\n\n  # If you plan to proxy to an untrusted HTTPS host:\n  #SSLProxyVerify none\n  #SSLProxyCheckPeerCN off\n  #SSLProxyCheckPeerName off\n  #SSLProxyCheckPeerExpire off\n&lt;/VirtualHost&gt;\n</code></pre>","path":["R p apache24.en"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p-caddy2.de/","level":1,"title":"R p caddy2.de","text":"<p>Wichtig</p> <p>Lesen Sie zuerst die Übersicht.</p> <p>Warnung</p> <p>Dies ist ein nicht unterstützter Communitybeitrag. Korrekturen sind immer erwünscht!</p> <p>Die Konfiguration von Caddy mit mailcow ist sehr simpel.</p> <p>In der Caddyfile muss einfach nur ein Bereich für den E-Mailserver angelegt werden.</p> <p>Bspw:</p> <pre><code>MAILCOW_HOSTNAME autodiscover.MAILCOW_HOSTNAME autoconfig.MAILCOW_HOSTNAME {\n        log {\n                output file /var/log/caddy/MAILCOW_HOSTNAME.log {\n                        roll_disabled\n                        roll_size 512M\n                        roll_uncompressed\n                        roll_local_time\n                        roll_keep 3\n                        roll_keep_for 48h\n                }\n        }\n\n        reverse_proxy 127.0.0.1:HTTP_BIND\n}\n</code></pre> <p>Dies erlaubt es Caddy automatisch die Zertifikate zu erstellen und den Traffic für diese erwähnten Domains anzunehmen und an mailcow weiterzuleiten.</p> <p>Wichtig: Der ACME Client der mailcow muss deaktiviert sein, da es sonst zu Fehlern seitens mailcow kommt.</p> <p>Da Caddy sich direkt selbst um die Zertifikate kümmert, können wir mit dem folgenden Skript die Caddy generierten Zertifikate in die mailcow inkludieren:</p> <pre><code>#!/bin/bash\nMAILCOW_HOSTNAME=your.domain.tld\nCADDY_CERTS_DIR=/var/lib/caddy/.local/share/caddy/certificates/acme-v02.api.letsencrypt.org-directory\nMD5SUM_CURRENT_CERT=($(md5sum /opt/mailcow-dockerized/data/assets/ssl/cert.pem))\nMD5SUM_NEW_CERT=($(md5sum $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.crt))\n\nif [ $MD5SUM_CURRENT_CERT != $MD5SUM_NEW_CERT ]; then\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.crt /opt/mailcow-dockerized/data/assets/ssl/cert.pem\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.key /opt/mailcow-dockerized/data/assets/ssl/key.pem\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.crt /opt/mailcow-dockerized/data/assets/ssl/$MAILCOW_HOSTNAME/cert.pem\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.key /opt/mailcow-dockerized/data/assets/ssl/$MAILCOW_HOSTNAME/key.pem\n        postfix_c=$(docker ps -qaf name=postfix-mailcow)\n        dovecot_c=$(docker ps -qaf name=dovecot-mailcow)\n        nginx_c=$(docker ps -qaf name=nginx-mailcow)\n        docker restart ${postfix_c} ${dovecot_c} ${nginx_c}\n\nelse\n        echo \"Certs not copied from Caddy (Not needed)\"\nfi\n</code></pre> <p>Achtung</p> <p>Der Zertifikatspfad von Caddy variiert je nach Installationsart. Bei diesem Installationsbeispiel wurde Caddy mithilfe des Caddy Repos (weitere Informationen hier) installiert.  Um den Caddy Zertifikatspfad auf Ihrem System herauszufinden, genügt ein <code>find / -name \"certificates\"</code>.</p> <p>Dieses Skript könnte dann als Cronjob jede Stunde aufgerufen werden:</p> <pre><code>0 * * * * /bin/bash /path/to/script/deploy-certs.sh  &gt;/dev/null 2&gt;&amp;1\n</code></pre>","path":["R p caddy2.de"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p-caddy2.en/","level":1,"title":"R p caddy2.en","text":"<p>Important</p> <p>First read the overview.</p> <p>Warning</p> <p>This is an unsupported community contribution. Feel free to provide fixes.</p> <p>The configuration of Caddy with mailcow is very simple.</p> <p>In the caddyfile you just have to create a section for the mailserver.</p> <p>For example <pre><code>MAILCOW_HOSTNAME autodiscover.MAILCOW_HOSTNAME autoconfig.MAILCOW_HOSTNAME {\n        log {\n                output file /var/log/caddy/MAILCOW_HOSTNAME.log {\n                        roll_disabled\n                        roll_size 512M\n                        roll_uncompressed\n                        roll_local_time\n                        roll_keep 3\n                        roll_keep_for 48h\n                }\n        }\n\n        reverse_proxy 127.0.0.1:HTTP_BIND\n}\n</code></pre></p> <p>This allows Caddy to automatically create the certificates and accept traffic for these mentioned domains and forward them to mailcow.</p> <p>Important: The ACME client of mailcow must be disabled, otherwise mailcow will fail.</p> <p>Since Caddy takes care of the certificates itself, we can use the following script to include the Caddy generated certificates into mailcow:</p> <pre><code>#!/bin/bash\nMAILCOW_HOSTNAME=your.domain.tld\nCADDY_CERTS_DIR=/var/lib/caddy/.local/share/caddy/certificates/acme-v02.api.letsencrypt.org-directory\nMD5SUM_CURRENT_CERT=($(md5sum /opt/mailcow-dockerized/data/assets/ssl/cert.pem))\nMD5SUM_NEW_CERT=($(md5sum $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.crt))\n\nif [ $MD5SUM_CURRENT_CERT != $MD5SUM_NEW_CERT ]; then\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.crt /opt/mailcow-dockerized/data/assets/ssl/cert.pem\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.key /opt/mailcow-dockerized/data/assets/ssl/key.pem\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.crt /opt/mailcow-dockerized/data/assets/ssl/$MAILCOW_HOSTNAME/cert.pem\n        cp $CADDY_CERTS_DIR/$MAILCOW_HOSTNAME/$MAILCOW_HOSTNAME.key /opt/mailcow-dockerized/data/assets/ssl/$MAILCOW_HOSTNAME/key.pem\n        postfix_c=$(docker ps -qaf name=postfix-mailcow)\n        dovecot_c=$(docker ps -qaf name=dovecot-mailcow)\n        nginx_c=$(docker ps -qaf name=nginx-mailcow)\n        docker restart ${postfix_c} ${dovecot_c} ${nginx_c}\n\nelse\n        echo \"Certs not copied from Caddy (Not needed)\"\nfi\n</code></pre> <p>Attention</p> <p>Caddy's certificate path varies depending on the installation type. In this installation example, Caddy was installed using the Caddy repo (more informations here).  To find out the Caddy certificate path on your system, just run a <code>find / -name \"certificates\"</code>.</p> <p>This script could be called as a cronjob every hour:</p> <pre><code>0 * * * * /bin/bash /path/to/script/deploy-certs.sh  &gt;/dev/null 2&gt;&amp;1\n</code></pre>","path":["R p caddy2.en"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p-haproxy.de/","level":1,"title":"R p haproxy.de","text":"<p>Wichtig</p> <p>Lesen Sie zuerst die Übersicht.</p> <p>Warnung</p> <p>Dies ist ein nicht unterstützter Community Beitrag. Korrekturen sind immer erwünscht!</p> <p>Dieses Beispiel leitet den gesamten HTTP-Verkehr zu HTTPS um, außer für den eingebauten ACME-Client von mailcow. Wenn Sie den eingebauten ACME-Client nicht verwenden möchten, ändern Sie bitte die Konfiguration selbst.</p> <pre><code>frontend https-in\n  bind :::80 v4v6\n  bind :::443 v4v6 ssl crt mailcow.pem\n\n  acl mailcow_acme path -i -m beg /.well-known/\n\n  redirect scheme https unless { ssl_fc || mailcow_acme }\n\n  default_backend mailcow\n\nbackend mailcow\n  option forwardfor\n  http-request set-header X-Forwarded-Proto https if { ssl_fc }\n  http-request set-header X-Forwarded-Proto http if !{ ssl_fc }\n  server mailcow 127.0.0.1:8080 check\n</code></pre>","path":["R p haproxy.de"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p-haproxy.en/","level":1,"title":"R p haproxy.en","text":"<p>Important</p> <p>First read the overview.</p> <p>Warning</p> <p>This is an unsupported community contribution. Feel free to provide fixes.</p> <p>This example redirects all HTTP traffic to HTTPS except for mailcow's built-in ACME client. If you do not want to use the built-in ACME client, please modify the configuration yourself.</p> <pre><code>frontend https-in\n  bind :::80 v4v6\n  bind :::443 v4v6 ssl crt mailcow.pem\n\n  acl mailcow_acme path -i -m beg /.well-known/\n\n  redirect scheme https unless { ssl_fc || mailcow_acme }\n\n  default_backend mailcow\n\nbackend mailcow\n  option forwardfor\n  http-request set-header X-Forwarded-Proto https if { ssl_fc }\n  http-request set-header X-Forwarded-Proto http if !{ ssl_fc }\n  server mailcow 127.0.0.1:8080 check\n</code></pre>","path":["R p haproxy.en"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p-nginx.de/","level":1,"title":"R p nginx.de","text":"<p>Wichtig</p> <p>Lesen Sie zuerst die Übersicht.</p> <p>Let's Encrypt folgt unserem Rewrite, Zertifikatsanfragen funktionieren problemlos.</p> <p>Achten Sie auf die hervorgehobenen Zeilen.</p> <pre><code>server {\n  listen 80 default_server;\n  listen [::]:80 default_server;\n  server_name ZU MAILCOW HOSTNAMEN ÄNDERN autodiscover.* autoconfig.*;\n  return 301 https://$host$request_uri;\n}\nserver {\n  listen 443 ssl http2;\n  listen [::]:443 ssl http2;\n  server_name ZU MAILCOW HOSTNAMEN ÄNDERN autodiscover.* autoconfig.*;\n\n  ssl_certificate MAILCOW_PATH/data/assets/ssl/cert.pem;\n  ssl_certificate_key MAILCOW_PATH/data/assets/ssl/key.pem;\n  ssl_session_timeout 1d;\n  ssl_session_cache shared:SSL:50m;\n  ssl_session_tickets off;\n\n  # Siehe https://ssl-config.mozilla.org/#server=nginx für die neuesten Empfehlungen zu ssl-Einstellungen\n  # Ein Beispiel für eine Konfiguration ist unten angegeben\n  ssl_protocols TLSv1.2;\n  ssl_ciphers HIGH:!aNULL:!MD5:!SHA1:!kRSA;\n  ssl_prefer_server_ciphers off;\n\n  location /Microsoft-Server-ActiveSync {\n    proxy_pass http://127.0.0.1:8080/Microsoft-Server-ActiveSync;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_connect_timeout 75;\n    proxy_send_timeout 3650;\n    proxy_read_timeout 3650;\n    proxy_buffers 64 512k; # Seit dem 2022-04 Update nötig für SOGo\n    client_body_buffer_size 512k;\n    client_max_body_size 0;\n  }\n\n  location / {\n    proxy_pass http://127.0.0.1:8080/;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    client_max_body_size 0;\n  # Die folgenden Proxy-Buffer müssen gesetzt werden, wenn Sie SOGo nach dem Update 2022-04 (April 2022) verwenden wollen\n  # Andernfalls wird ein Login wie folgt fehlschlagen: https://github.com/mailcow/mailcow-dockerized/issues/4537\n    proxy_buffer_size 128k;\n    proxy_buffers 64 512k;\n    proxy_busy_buffers_size 512k;\n  }\n}\n</code></pre>","path":["R p nginx.de"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p-nginx.en/","level":1,"title":"R p nginx.en","text":"<p>Important</p> <p>First read the overview.</p> <p>Let's Encrypt will follow our rewrite, certificate requests will work fine.</p> <p>Take care of highlighted lines.</p> <pre><code>server {\n  listen 80 default_server;\n  listen [::]:80 default_server;\n  server_name CHANGE_TO_MAILCOW_HOSTNAME autodiscover.* autoconfig.*;\n  return 301 https://$host$request_uri;\n}\nserver {\n  listen 443 ssl http2;\n  listen [::]:443 ssl http2;\n  server_name CHANGE_TO_MAILCOW_HOSTNAME autodiscover.* autoconfig.*;\n\n  ssl_certificate MAILCOW_PATH/data/assets/ssl/cert.pem;\n  ssl_certificate_key MAILCOW_PATH/data/assets/ssl/key.pem;\n  ssl_session_timeout 1d;\n  ssl_session_cache shared:SSL:50m;\n  ssl_session_tickets off;\n\n  # See https://ssl-config.mozilla.org/#server=nginx for the latest ssl settings recommendations\n  # An example config is given below\n  ssl_protocols TLSv1.2;\n  ssl_ciphers HIGH:!aNULL:!MD5:!SHA1:!kRSA;\n  ssl_prefer_server_ciphers off;\n\n  location /Microsoft-Server-ActiveSync {\n    proxy_pass http://127.0.0.1:8080/Microsoft-Server-ActiveSync;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_connect_timeout 75;\n    proxy_send_timeout 3650;\n    proxy_read_timeout 3650;\n    proxy_buffers 64 512k; # Needed since the 2022-04 Update for SOGo\n    client_body_buffer_size 512k;\n    client_max_body_size 0;\n  }\n\n  location / {\n    proxy_pass http://127.0.0.1:8080/;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    client_max_body_size 0;\n  # The following Proxy Buffers has to be set if you want to use SOGo after the 2022-04 (April 2022) Update\n  # Otherwise a Login will fail like this: https://github.com/mailcow/mailcow-dockerized/issues/4537\n    proxy_buffer_size 128k;\n    proxy_buffers 64 512k;\n    proxy_busy_buffers_size 512k;\n  }\n}\n</code></pre>","path":["R p nginx.en"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p-traefik2.de/","level":1,"title":"R p traefik2.de","text":"<p>Wichtig</p> <p>Lesen Sie zuerst die Übersicht.</p> <p>Warnung</p> <p>Dies ist ein nicht unterstützter Community Beitrag. Korrekturen sind immer erwünscht!</p> <p>Wichtig: Diese Konfiguration deckt nur das \"Reverseproxing\" des Webpanels (nginx-mailcow) unter Verwendung von Traefik v2 ab. Wenn Sie auch die Mail-Dienste wie dovecot, postfix... reproxen wollen, müssen Sie die folgende Konfiguration an jeden Container anpassen und einen EntryPoint in Ihrer <code>traefik.toml</code> oder <code>traefik.yml</code> (je nachdem, welche Konfiguration Sie verwenden) für jeden Port erstellen. </p> <p>In diesem Abschnitt gehen wir davon aus, dass Sie Ihren Traefik 2 <code>[certificatesresolvers]</code> in Ihrer Traefik-Konfigurationsdatei richtig konfiguriert haben und auch acme verwenden. Das folgende Beispiel verwendet Lets Encrypt, aber Sie können es gerne auf Ihren eigenen Zertifikatsresolver ändern. Eine grundlegende Traefik 2 toml-Konfigurationsdatei mit allen oben genannten Elementen, die für dieses Beispiel verwendet werden kann, finden Sie hier traefik.toml, falls Sie eine solche Datei benötigen oder einen Hinweis, wie Sie Ihre Konfiguration anpassen können.</p> <p>Zuallererst werden wir den acme-mailcow-Container deaktivieren, da wir die von traefik bereitgestellten Zertifikate verwenden werden. Dazu müssen wir <code>SKIP_LETS_ENCRYPT=y</code> in unserer <code>mailcow.conf</code> setzen und den folgenden Befehl ausführen, um die Änderungen zu übernehmen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Dann erstellen wir eine <code>docker-compose.override.yml</code> Datei, um die Hauptdatei <code>docker-compose.yml</code> zu überschreiben, die sich im mailcow-Stammverzeichnis befindet. </p> <pre><code>services:\n    nginx-mailcow:\n      networks:\n        # Traefiks Netzwerk hinzufügen\n        web:\n      labels:\n        - traefik.enable=true\n        # Erstellt einen Router namens \"moo\" für den Container und richtet eine Regel ein, um den Container mit einer bestimmten Regel zu verknüpfen,\n        # in diesem Fall eine Host-Regel mit unserer MAILCOW_HOSTNAME-Variable.\n        - traefik.http.routers.moo.rule=Host(`${MAILCOW_HOSTNAME}`)\n        # Aktiviert tls über den zuvor erstellten Router.\n        - traefik.http.routers.moo.tls=true\n        # Gibt an, welche Art von Cert-Resolver wir verwenden werden, in diesem Fall le (Lets Encrypt).\n        - traefik.http.routers.moo.tls.certresolver=le\n        # Erzeugt einen Dienst namens \"moo\" für den Container und gibt an, welchen internen Port des Containers\n        # Traefik die eingehenden Daten weiterleiten soll.\n        - traefik.http.services.moo.loadbalancer.server.port=${HTTP_PORT}\n        # Gibt an, welchen Eingangspunkt (externer Port) traefik für diesen Container abhören soll.\n        # Websecure ist Port 443, siehe die Datei traefik.toml wie oben.\n        - traefik.http.routers.moo.entrypoints=websecure\n        # Stellen Sie sicher, dass traefik das Web-Netzwerk verwendet, nicht das mailcowdockerized_mailcow-network\n        - traefik.docker.network=traefik_web\n\n    certdumper:\n        image: ghcr.io/kereis/traefik-certs-dumper\n        command: --restart-containers ${COMPOSE_PROJECT_NAME}-postfix-mailcow-1,${COMPOSE_PROJECT_NAME}-nginx-mailcow-1,${COMPOSE_PROJECT_NAME}-dovecot-mailcow-1\n        network_mode: none\n        volumes:\n          # Binden Sie das Volume, das Traefiks `acme.json' Datei enthält, ein\n          - acme:/traefik:ro\n          # SSL-Ordner von mailcow einhängen\n          - ./data/assets/ssl/:/output:rw\n          # Binden Sie den Docker Socket ein, damit traefik-certs-dumper die Container neu starten kann\n          - /var/run/docker.sock:/var/run/docker.sock:ro\n        restart: always\n        environment:\n          # Ändern Sie dies nur, wenn Sie eine andere Domain für mailcows Web-Frontend verwenden als in der Standard-Konfiguration\n          - DOMAIN=${MAILCOW_HOSTNAME}\n\nnetworks:\n  web:\n    external: true\n    # Name des externen Netzwerks\n    name: traefik_web\n\nvolumes:\n  acme:\n    external: true\n    # Name des externen Docker Volumes, welches Traefiks `acme.json' Datei enthält\n    name: traefik_acme\n</code></pre> <p>Starten Sie die neuen Container mit:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Da Traefik 2 ein acme v2 Format verwendet, um ALLE Zertifikaten von allen Domains zu speichern, müssen wir einen Weg finden, die Zertifikate auszulagern. Zum Glück haben wir [diesen kleinen Container] (https://hub.docker.com/r/humenius/traefik-certs-dumper), der die Datei <code>acme.json</code> über ein Volume und eine Variable <code>DOMAIN=example. org</code>, und damit wird der Container die <code>cert.pem</code> und <code>key.pem</code> Dateien ausgeben, dafür lassen wir einfach den <code>traefik-certs-dumper</code> Container laufen, binden das <code>/traefik</code> Volume an den Ordner, in dem unsere <code>acme.json</code> gespeichert ist, binden das <code>/output</code> Volume an unseren mailcow <code>data/assets/ssl/</code> Ordner, und setzen die <code>DOMAIN=example.org</code> Variable auf die Domain, von der wir die Zertifikate ausgeben wollen. </p> <p>Dieser Container überwacht die Datei <code>acme.json</code> auf Änderungen und generiert die Dateien <code>cert.pem</code> und <code>key.pem</code> direkt in <code>data/assets/ssl/</code>, wobei der Pfad mit dem <code>/output</code>-Pfad des Containers verbunden ist.</p> <p>Sie können es über die Kommandozeile ausführen oder das hier gezeigte docker-compose.yml verwenden.</p> <p>Nachdem wir die Zertifikate übertragen haben, müssen wir die Konfigurationen aus unseren Postfix- und Dovecot-Containern neu laden und die Zertifikate überprüfen. Wie das geht, sehen Sie hier.</p> <p>Und das sollte es gewesen sein 😊, Sie können überprüfen, ob der Traefik-Router einwandfrei funktioniert, indem Sie das Dashboard von Traefik / traefik logs / über https auf die eingestellte Domain zugreifen, oder / und HTTPS, SMTP und IMAP mit den Befehlen auf der zuvor verlinkten Seite überprüfen.</p>","path":["R p traefik2.de"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p-traefik2.en/","level":1,"title":"R p traefik2.en","text":"<p>Important</p> <p>First read the overview.</p> <p>Warning</p> <p>This is an unsupported community contribution. Feel free to provide fixes.</p> <p>Important: This config only covers the \"reverseproxing\" of the webpannel (nginx-mailcow) using Traefik v2, if you also want to reverseproxy the mail services such as dovecot, postfix... you'll just need to adapt the following config to each container and create an EntryPoint on your <code>traefik.toml</code> or <code>traefik.yml</code> (depending which config you use) for each port. </p> <p>For this section we'll assume you have your Traefik 2 <code>[certificatesresolvers]</code> properly configured on your traefik configuration file, and also using acme, also, the following example uses Lets Encrypt, but feel free to change it to your own cert resolver. You can find a basic Traefik 2 toml config file with all the above implemented which can be used for this example here traefik.toml if you need one, or a hint on how to adapt your config.</p> <p>So, first of all, we are going to disable the acme-mailcow container since we'll use the certs that traefik will provide us. For this we'll have to set <code>SKIP_LETS_ENCRYPT=y</code> on our <code>mailcow.conf</code>, and run the following command to apply the changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Then we'll create a <code>docker-compose.override.yml</code> file in order to override the main <code>docker-compose.yml</code> found in your mailcow root folder. </p> <pre><code>services:\n    nginx-mailcow:\n      networks:\n        # Add Traefik's network\n        web:\n      labels:\n        - traefik.enable=true\n        # Creates a router called \"moo\" for the container, and sets up a rule to link the container to certain rule,\n        #   in this case, a Host rule with our MAILCOW_HOSTNAME var.\n        - traefik.http.routers.moo.rule=Host(`${MAILCOW_HOSTNAME}`)\n        # Enables tls over the router we created before.\n        - traefik.http.routers.moo.tls=true\n        # Specifies which kind of cert resolver we'll use, in this case le (Lets Encrypt).\n        - traefik.http.routers.moo.tls.certresolver=le\n        # Creates a service called \"moo\" for the container, and specifies which internal port of the container\n        #   should traefik route the incoming data to.\n        - traefik.http.services.moo.loadbalancer.server.port=${HTTP_PORT}\n        # Specifies which entrypoint (external port) should traefik listen to, for this container.\n        #   websecure being port 443, check the traefik.toml file liked above.\n        - traefik.http.routers.moo.entrypoints=websecure\n        # Make sure traefik uses the web network, not the mailcowdockerized_mailcow-network\n        - traefik.docker.network=traefik_web\n\n    certdumper:\n        image: ghcr.io/kereis/traefik-certs-dumper\n        command: --restart-containers ${COMPOSE_PROJECT_NAME}-postfix-mailcow-1,${COMPOSE_PROJECT_NAME}-nginx-mailcow-1,${COMPOSE_PROJECT_NAME}-dovecot-mailcow-1\n        network_mode: none\n        volumes:\n          # Mount the volume which contains Traefik's `acme.json' file\n          #   Configure the external name in the volume definition\n          - acme:/traefik:ro\n          # Mount mailcow's SSL folder\n          - ./data/assets/ssl/:/output:rw\n          # Mount docker socket to restart containers\n          - /var/run/docker.sock:/var/run/docker.sock:ro\n        restart: always\n        environment:\n          # only change this, if you're using another domain for mailcow's web frontend compared to the standard config\n          - DOMAIN=${MAILCOW_HOSTNAME}\n\nnetworks:\n  web:\n    external: true\n    # Name of the external network\n    name: traefik_web\n\nvolumes:\n  acme:\n    external: true\n    # Name of the external docker volume which contains Traefik's `acme.json' file\n    name: traefik_acme\n</code></pre> <p>Start the new containers with:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Now, there's only one thing left to do, which is setup the certs so that the mail services can use them as well, since Traefik 2 uses an acme v2 format to save ALL the license from all the domains we have, we'll need to find a way to dump the certs, lucky we have this tiny container which grabs the <code>acme.json</code> file through a volume, and a variable <code>DOMAIN=example.org</code>, and with these, the container will output the <code>cert.pem</code> and <code>key.pem</code> files, for this we'll simply run the <code>traefik-certs-dumper</code> container binding the <code>/traefik</code> volume to the folder where our <code>acme.json</code> is saved, bind the <code>/output</code> volume to our mailcow <code>data/assets/ssl/</code> folder, and set up the <code>DOMAIN=example.org</code> variable to the domain we want the certs dumped from. </p> <p>This container will watch over the <code>acme.json</code> file for any changes, and regenerate the <code>cert.pem</code> and <code>key.pem</code> files directly into <code>data/assets/ssl/</code> being the path binded to the container's <code>/output</code> path.</p> <p>You can use the command line to run it, or use the docker-compose.yml shown here.</p> <p>After we have the certs dumped, we'll have to reload the configs from our postfix and dovecot containers, and check the certs, you can see how here.</p> <p>Aaand that should be it 😊, you can check if the Traefik router works fine through Traefik's dashboard / traefik logs / accessing the setted domain through https, or / and check HTTPS, SMTP and IMAP through the commands shown on the page linked before.</p>","path":["R p traefik2.en"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p.de/","level":1,"title":"R p.de","text":"<p>Sie müssen die Nginx-Seite, die mit mailcow: dockerized geliefert wird, nicht ändern. mailcow: dockerized vertraut auf das Standard-Gateway IP 172.22.1.1 als Proxy.</p> <p>Stellen Sie sicher, dass Sie HTTP_BIND und HTTPS_BIND in <code>mailcow.conf</code> auf eine lokale Adresse ändern und die Ports entsprechend einstellen, zum Beispiel: <pre><code>HTTP_BIND=127.0.0.1\nHTTP_PORT=8080\nHTTPS_BIND=127.0.0.1\nHTTPS_PORT=8443\n</code></pre></p> <p>Dadurch werden auch die Bindungen innerhalb des Nginx-Containers geändert! Dies ist wichtig, wenn Sie sich entscheiden, einen Proxy innerhalb von Docker zu verwenden.</p> <p>WICHTIG: Verwenden Sie nicht Port 8081, 9081 oder 65510!</p> <p>Erzeugen Sie die betroffenen Container neu, indem Sie den folgenden Befehl ausführen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["R p.de"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p.de/#wichtige-informationen-bitte-lesen-sie-diese-sorgfaltig-durch","level":2,"title":"Wichtige Informationen, bitte lesen Sie diese sorgfältig durch!","text":"<p>Info</p> <p>Wenn Sie planen, einen Reverse-Proxy zu verwenden und einen anderen Servernamen als MAILCOW_HOSTNAME verwenden wollen, müssen Sie Zusätzliche Servernamen für mailcow UI hierunter.</p> <p>Warnung</p> <p>Stellen Sie sicher, dass Sie <code>generate_config.sh</code> ausführen, bevor Sie die Konfigurationsbeispiele aktivieren. Das Skript <code>generate_config.sh</code> kopiert die Snake-oil Zertifikate an den richtigen Ort, so dass die Dienste nicht aufgrund fehlender Dateien nicht starten können.</p> <p>Warnung</p> <p>Wenn Sie TLS SNI aktivieren (<code>ENABLE_SSL_SNI</code> in mailcow.conf), müssen die Zertifikatspfade in Ihrem Reverse-Proxy mit den korrekten Pfaden in <code>data/assets/ssl/{hostname}</code> übereinstimmen. Die Zertifikate werden in <code>data/assets/ssl/{hostname1,hostname2,etc}</code> aufgeteilt und werden daher nicht funktionieren, wenn Sie die Beispiele von unten kopieren, die auf <code>data/assets/ssl/cert.pem</code> etc. zeigen.</p> <p>Info</p> <p>Die Verwendung der Konfigurationsbeispiele wird acme-Anfragen an mailcow weiterleiten und es die Zertifikate selbst verwalten lassen. Der Nachteil der Verwendung von mailcow als ACME-Client hinter einem Reverse-Proxy ist, dass Sie Ihren Webserver neu laden müssen, nachdem acme-mailcow das Zertifikat geändert/erneuert/erstellt hat. Sie können entweder Ihren Webserver täglich neu laden oder ein Skript schreiben, um die Datei auf Änderungen zu überwachen. Auf vielen Servern wird logrotate den Webserver sowieso täglich neu laden.</p> <p>Wenn Sie eine lokale Certbot-Installation verwenden möchten, müssen Sie die SSL-Zertifikatsparameter entsprechend ändern. Stellen Sie sicher, dass Sie ein Post-Hook-Skript ausführen, wenn Sie sich entscheiden, externe ACME-Clients zu verwenden. Ein Beispiel finden Sie hierunter.</p> <p>Konfigurieren Sie Ihren lokalen Webserver als Reverse Proxy anhand folgender Konfigurationsbeispiele:</p> <ul> <li>Apache 2.4</li> <li>Nginx</li> <li>HAProxy</li> <li>Traefik v2</li> <li>Caddy v2</li> </ul>","path":["R p.de"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p.de/#optional-post-hook-skript-fur-nicht-mailcow-acme-clients","level":2,"title":"Optional: Post-Hook-Skript für nicht-mailcow ACME-Clients","text":"<p>Die Verwendung eines lokalen Certbots (oder eines anderen ACME-Clients) erfordert den Neustart einiger Container, was Sie mit einem Post-Hook-Skript erledigen können. Stellen Sie sicher, dass Sie die Pfade entsprechend ändern: <pre><code>#!/bin/bash\ncp /etc/letsencrypt/live/my.domain.tld/fullchain.pem /opt/mailcow-dockerized/data/assets/ssl/cert.pem\ncp /etc/letsencrypt/live/my.domain.tld/privkey.pem /opt/mailcow-dockerized/data/assets/ssl/key.pem\npostfix_c=$(docker ps -qaf name=postfix-mailcow)\ndovecot_c=$(docker ps -qaf name=dovecot-mailcow)\nnginx_c=$(docker ps -qaf name=nginx-mailcow)\ndocker restart ${postfix_c} ${dovecot_c} ${nginx_c}\n</code></pre></p>","path":["R p.de"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p.de/#hinzufugen-weiterer-servernamen-fur-mailcow-ui","level":2,"title":"Hinzufügen weiterer Servernamen für mailcow UI","text":"<p>Wenn Sie vorhaben, einen Servernamen zu verwenden, der nicht <code>MAILCOW_HOSTNAME</code> in Ihrem Reverse-Proxy ist, stellen Sie sicher, dass Sie diesen Namen zuerst in mailcow.conf über <code>ADDITIONAL_SERVER_NAMES</code> einpflegen. Die Namen müssen durch Kommas getrennt werden und dürfen keine Leerzeichen enthalten. Wenn Sie diesen Schritt überspringen, kann es sein, dass mailcow auf Ihren Reverse-Proxy mit einer falschen Seite antwortet.</p> <pre><code>ADDITIONAL_SERVER_NAMES=webmail.domain.tld,other.example.tld\n</code></pre> <p>Führen Sie zum Anwenden folgendes aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["R p.de"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p.en/","level":1,"title":"R p.en","text":"<p>You don't need to change the Nginx site that comes with mailcow: dockerized. mailcow: dockerized trusts the default gateway IP 172.22.1.1 as proxy.</p> <p>Make sure you change HTTP_BIND and HTTPS_BIND in <code>mailcow.conf</code> to a local address and set the ports accordingly, for example: <pre><code>HTTP_BIND=127.0.0.1\nHTTP_PORT=8080\nHTTPS_BIND=127.0.0.1\nHTTPS_PORT=8443\n</code></pre></p> <p>This will also change the bindings inside the Nginx container! This is important, if you decide to use a proxy within Docker.</p> <p>IMPORTANT: Do not use port 8081, 9081 or 65510!</p> <p>Recreate affected containers by running the command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["R p.en"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p.en/#important-information-please-read-them-carefully","level":2,"title":"Important information, please read them carefully!","text":"<p>Info</p> <p>If you plan to use a reverse proxy and want to use another server name that is not MAILCOW_HOSTNAME, you need to read Adding additional server names for mailcow UI below.</p> <p>Warning</p> <p>Make sure you run <code>generate_config.sh</code> before you enable any site configuration examples. The script <code>generate_config.sh</code> copies snake-oil certificates to the correct location, so the services will not fail to start due to missing files.</p> <p>Warning</p> <p>If you enable TLS SNI (<code>ENABLE_SSL_SNI</code> in mailcow.conf), the certificate paths in your reverse proxy must match the correct paths in <code>data/assets/ssl/{hostname}</code>. The certificates will be split into <code>data/assets/ssl/{hostname1,hostname2,etc}</code> and therefore will not work when you copy the examples from below pointing to <code>data/assets/ssl/cert.pem</code> etc.</p> <p>Info</p> <p>Using the site configuration examples will forward ACME requests to mailcow and let it handle certificates itself. The downside of using mailcow as ACME client behind a reverse proxy is, that you will need to reload your webserver after acme-mailcow changed/renewed/created the certificate. You can either reload your webserver daily or write a script to watch the file for changes. On many servers logrotate will reload the webserver daily anyway.</p> <p>If you want to use a local certbot installation, you will need to change the SSL certificate parameters accordingly. Make sure you run a post-hook script when you decide to use external ACME clients. You will find an example below.</p> <p>Configure your local webserver as reverse proxy using following configuration examples:</p> <ul> <li>Apache 2.4</li> <li>Nginx</li> <li>HAProxy</li> <li>Traefik v2</li> <li>Caddy v2</li> </ul>","path":["R p.en"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p.en/#optional-post-hook-script-for-non-mailcow-acme-clients","level":2,"title":"Optional: Post-hook script for non-mailcow ACME clients","text":"<p>Using a local certbot (or any other ACME client) requires to restart some containers, you can do this with a post-hook script. Make sure you change the paths accordingly: <pre><code>#!/bin/bash\ncp /etc/letsencrypt/live/my.domain.tld/fullchain.pem /opt/mailcow-dockerized/data/assets/ssl/cert.pem\ncp /etc/letsencrypt/live/my.domain.tld/privkey.pem /opt/mailcow-dockerized/data/assets/ssl/key.pem\npostfix_c=$(docker ps -qaf name=postfix-mailcow)\ndovecot_c=$(docker ps -qaf name=dovecot-mailcow)\nnginx_c=$(docker ps -qaf name=nginx-mailcow)\ndocker restart ${postfix_c} ${dovecot_c} ${nginx_c}\n</code></pre></p>","path":["R p.en"],"tags":[]},{"location":"post_installation/reverse-proxy/r_p.en/#adding-additional-server-names-for-mailcow-ui","level":2,"title":"Adding additional server names for mailcow UI","text":"<p>If you plan to use a server name that is not <code>MAILCOW_HOSTNAME</code> in your reverse proxy, make sure to populate that name in mailcow.conf via <code>ADDITIONAL_SERVER_NAMES</code> first. Names must be separated by commas and must not contain spaces. If you skip this step, mailcow may respond to your reverse proxy with an incorrect site.</p> <pre><code>ADDITIONAL_SERVER_NAMES=webmail.domain.tld,other.example.tld\n</code></pre> <p>Run the following command to apply:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["R p.en"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/","level":1,"title":"Borgmatic Backup","text":"","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#einfuhrung","level":2,"title":"Einführung","text":"<p>Borgmatic ist ein großartiger Weg, um Backups auf Ihrem mailcow-Setup durchzuführen, da es Ihre Daten sicher verschlüsselt und extrem einfach einzurichten ist.</p> <p>Aufgrund seiner Deduplizierungsfähigkeiten können Sie eine große Anzahl von Backups speichern, ohne große Mengen an Speicherplatz zu verschwenden. So können Sie Backups in sehr kurzen Abständen durchführen, um einen minimalen Datenverlust zu gewährleisten, wenn die Notwendigkeit besteht, Daten aus einer Sicherung wiederherzustellen.</p> <p>Dieses Dokument führt Sie durch den Prozess zur Aktivierung kontinuierlicher Backups für mailcow mit borgmatic. Die borgmatic Funktionalität wird durch das borgmatic Docker Image bereitgestellt. Schauen Sie sich die <code>README</code> in diesem Repository an, um mehr über die anderen Optionen (wie z.B. Push-Benachrichtigungen) zu erfahren, die verfügbar sind. Diese Anleitung behandelt nur die Grundlagen.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#einrichten-von-borgmatic","level":2,"title":"Einrichten von borgmatic","text":"","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#erstellen-oder-andern-sie-docker-composeoverrideyml","level":3,"title":"Erstellen oder ändern Sie <code>docker-compose.override.yml</code>","text":"<p>Im mailcow-dockerized Stammverzeichnis erstellen oder bearbeiten Sie <code>docker-compose.override.yml</code> und fügen Sie die folgende Konfiguration ein:</p> <pre><code>services:\n  borgmatic-mailcow:\n    image: ghcr.io/borgmatic-collective/borgmatic\n    hostname: mailcow\n    restart: always\n    dns: ${IPV4_NETWORK:-172.22.1}.254\n    volumes:\n      - vmail-vol-1:/mnt/source/vmail:ro\n      - crypt-vol-1:/mnt/source/crypt:ro\n      - redis-vol-1:/mnt/source/redis:ro\n      - rspamd-vol-1:/mnt/source/rspamd:ro\n      - postfix-vol-1:/mnt/source/postfix:ro\n      - mysql-socket-vol-1:/var/run/mysqld/\n      - borg-config-vol-1:/root/.config/borg\n      - borg-cache-vol-1:/root/.cache/borg\n      - ./data/conf/borgmatic/etc:/etc/borgmatic.d:Z\n      - ./data/conf/borgmatic/ssh:/root/.ssh:Z\n    environment:\n      - TZ=${TZ}\n      - BORG_PASSPHRASE=${BORG_PASSPHRASE}\n      - DBNAME=${DBNAME}\n      - DBUSER=${DBUSER}\n      - DBPASS=${DBPASS}\n    networks:\n      mailcow-network:\n        aliases:\n          - borgmatic\n\nvolumes:\n  borg-cache-vol-1:\n  borg-config-vol-1:\n</code></pre> <p>Fügen Sie <code>BORG_PASSPHRASE=YouBetterPutSomethingRealGoodHere</code> zu Ihrer <code>mailcow.conf</code> hinzu und stellen Sie sicher, dass Sie die <code>BORG_PASSPHRASE</code> in eine sichere Passphrase Ihrer Wahl ändern.</p> <p>Aus Sicherheitsgründen mounten wir das maildir als schreibgeschützt. Wenn Sie später Daten wiederherstellen wollen, müssen Sie das <code>ro</code>-Flag entfernen, bevor Sie die Daten wiederherstellen. Dies wird im Abschnitt über die Wiederherstellung von Backups beschrieben.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#erstellen-sie-dataconfborgmaticetcconfigyaml","level":3,"title":"Erstellen Sie <code>data/conf/borgmatic/etc/config.yaml</code>","text":"<p>Als nächstes müssen wir die borgmatic-Konfiguration erzeugen. Borgmatic unterstützt Umgebungsvariableninterpolation, dadurch erhalten wir die korrekten MySQL-Zugangsdaten über Docker bzw. über unsere <code>mailcow.conf</code>, ohne dass diese in der Konfigurationsdatei offengelegt werden.</p> <p>Vergewissern Sie sich, alle folgenden Zeilen zu kopieren!</p> <pre><code>cat &lt;&lt;EOF &gt; data/conf/borgmatic/etc/config.yaml\nsource_directories:\n    - /mnt/source/vmail\n    - /mnt/source/crypt\n    - /mnt/source/redis\n    - /mnt/source/rspamd\n    - /mnt/source/postfix\nrepositories:\n    - path: ssh://user@rsync.net:22/./mailcow\n      label: rsync\nexclude_patterns:\n    - '/mnt/source/postfix/public/'\n    - '/mnt/source/postfix/private/'\n    - '/mnt/source/rspamd/rspamd.sock'\n\nkeep_hourly: 24\nkeep_daily: 7\nkeep_weekly: 4\nkeep_monthly: 6\n\nmariadb_databases:\n    - name: ${DBNAME}\n      username: ${DBUSER}\n      password: ${DBPASS}\n      options: \"--default-character-set=utf8mb4 --skip-ssl\"\n      list_options: \"--skip-ssl\"\n      restore_options: \"--skip-ssl\"\nEOF\n</code></pre> <p>Warning</p> <p>Ab borgmatic 1.8.0 (erschienen am 19. Juli 2023) wurde der Aufbau der Konfigurationsdatei geändert. Sie können die Docker-Logs des Borgmatic-Containers auf Deprecation-Warnmeldungen prüfen, um festzustellen, ob Sie betroffen sind und Ihre Konfigurationsdatei für eine ältere Version von borgmatic erstellt wurde. In diesem Fall sollten Sie eine neue <code>config.yaml</code>-Datei wie oben beschrieben erstellen, um Probleme mit zukünftigen Versionen von borgmatic zu vermeiden.</p> <p>Warning</p> <p>Ab borgmatic 1.9.4 (erschienen am 11. Dezember 2024) versuchen die enthaltenen MariaDB-Tools standardmäßig, verschlüsselte Verbindungen herzustellen. Bearbeiten Sie die <code>config.yaml</code> und fügen Sie <code>--skip-ssl</code> zu <code>options</code>, <code>restore_options</code> und <code>list_options</code> wie oben gezeigt hinzu. Ändern Sie außerdem <code>mysql_databases</code> in <code>mariadb_databases</code>, um Probleme mit zukünftigen Versionen von borgmatic und MariaDB zu vermeiden.</p> <p>Diese Datei ist ein minimales Beispiel für die Verwendung von borgmatic mit einem Konto <code>user</code> beim Cloud-Speicheranbieter <code>rsync.net</code> für ein Repository namens <code>mailcow</code> (siehe Einstellung <code>repositories</code>). Dies muss entsprechend angepasst werden.</p> <p>Es wird sowohl das maildir als auch die MySQL-Datenbank gesichert, was alles ist, was Sie brauchen, um Ihre mailcow nach einem Vorfall wiederherzustellen.</p> <p>Im Backup wird jeweils ein Archiv für jede der letzten 24 Stunden, eines für jeden der letzten 7 Wochentage, eines für jede der letzten 4 Wochen und eines pro Monat des letzten halben Jahrs behalten.</p> <p>Schauen Sie in der borgmatic Dokumentation nach, wie Sie andere Arten von Repositories oder Konfigurationsoptionen nutzen können. Wenn Sie ein lokales Dateisystem als Backup-Ziel verwenden, stellen Sie sicher, dass Sie es in den Container einbinden. Der Container definiert zu diesem Zweck ein Volume namens <code>/mnt/borg-repository</code>.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#erstellen-sie-einen-crontab","level":3,"title":"Erstellen Sie einen crontab","text":"<p>Erstellen Sie eine neue Textdatei in <code>data/conf/borgmatic/etc/crontab.txt</code> mit folgendem Inhalt:</p> <pre><code>14 * * * * PATH=$PATH:/usr/local/bin /usr/local/bin/borgmatic --stats -v 0 2&gt;&amp;1\n</code></pre> <p>Diese Datei erwartet eine crontab-Syntax. Das hier gezeigte Beispiel veranlasst das Backup, jede Stunde um 14 Minuten nach der vollen Stunde auszuführen und am Ende einige nette Statistiken zu protokollieren.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#ssh-schlussel-in-ordner-ablegen","level":3,"title":"SSH-Schlüssel in Ordner ablegen","text":"<p>Legen Sie die SSH-Schlüssel, die Sie für Verbindungen zu entfernten Repositories verwenden wollen, in <code>data/conf/borgmatic/ssh</code> ab. OpenSSH erwartet die übliche <code>id_rsa</code>, <code>id_ed25519</code> oder ähnliches in diesem Verzeichnis zu finden. Stellen Sie sicher, dass die Datei <code>chmod 600</code> und nicht für alle lesbar ist, oder OpenSSH wird sich weigern, den SSH-Schlüssel zu benutzen.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#den-container-hochfahren","level":3,"title":"Den Container hochfahren","text":"<p>Für den nächsten Schritt müssen wir den Container in einem konfigurierten Zustand hochfahren und laufen lassen. Um das zu tun, führen Sie aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#das-backup-repository-initialisieren","level":3,"title":"Das Backup Repository initialisieren","text":"<p>Zwar ist Ihr borgmatic-Container jetzt betriebsbereit, aber die Backups schlagen derzeit fehl, da das Repository nicht initialisiert wurde.</p> <p>Um das Repository zu initialisieren, führen Sie folgenden Befehl aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic init --encryption repokey-blake2\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic init --encryption repokey-blake2\n</code></pre> <p>Sie werden aufgefordert, den SSH-Hostschlüssel Ihres entfernten Repository-Servers zu authentifizieren. Prüfen Sie, ob er übereinstimmt und bestätigen Sie die Aufforderung mit <code>yes</code>. Das Repository wird mit der Passphrase initialisiert, die Sie zuvor in der Umgebungsvariable <code>BORG_PASSPHRASE</code> gesetzt haben.</p> <p>Bei Verwendung einer der <code>repokey</code>-Verschlüsselungsmethoden wird der Verschlüsselungsschlüssel im Repository selbst gespeichert und nicht auf dem Client, so dass in dieser Hinsicht keine weiteren Maßnahmen erforderlich sind. Wenn Sie sich für die Verwendung eines <code>keyfile</code> anstelle von <code>repokey</code> entscheiden, stellen Sie sicher, dass Sie den Schlüssel exportieren und separat sichern. Lesen Sie den Abschnitt Exportieren von Schlüsseln um zu erfahren, wie Sie den Schlüssel abrufen können.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#container-neustarten","level":3,"title":"Container neustarten","text":"<p>Nachdem wir nun die Konfiguration und Initialisierung des Repositorys abgeschlossen haben, starten wir den Container neu, um sicherzustellen, dass er sich in einem definierten Zustand befindet:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart borgmatic-mailcow\n</code></pre> <pre><code>docker-compose restart borgmatic-mailcow\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#wiederherstellung-von-einem-backup","level":2,"title":"Wiederherstellung von einem Backup","text":"<p>Das Wiederherstellen eines Backups setzt voraus, dass Sie mit einer neuen Installation von mailcow beginnen, und dass Sie derzeit keine benutzerdefinierten Daten in ihrem maildir oder ihrer mailcow-Datenbank haben.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#wiederherstellen-von-maildir","level":3,"title":"Wiederherstellen von maildir","text":"<p>Warnung</p> <p>Dies wird Dateien in Ihrem maildir überschreiben! Führen Sie dies nicht aus, es sei denn, Sie beabsichtigen tatsächlich, Mail Dateien von einem Backup wiederherzustellen.</p> <p>Wenn Sie SELinux im Enforcing-Modus verwenden</p> <p>Wenn Sie mailcow auf einem Host mit SELinux im Enforcing-Modus verwenden, müssen Sie ihn während der Extraktion des Archivs vorübergehend deaktivieren, da das mailcow-Setup das vmail-Volume als privat kennzeichnet, das ausschließlich dem Dovecot-Container gehört. SELinux wird (berechtigterweise) jeden anderen Container, wie z.B. den borgmatic Container, daran hindern, auf dieses Volume zu schreiben.</p> <p>Bevor Sie eine Wiederherstellung durchführen, müssen Sie das vmail-Volume in <code>docker-compose.override.yml</code> beschreibbar machen, indem Sie das <code>ro</code>-Flag aus dem Volume entfernen. Dann können Sie den folgenden Befehl verwenden, um das Maildir aus einem Backup wiederherzustellen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic extract --path mnt/source --archive latest\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic extract --path mnt/source --archive latest\n</code></pre> <p>Alternativ können Sie auch einen beliebigen Archivnamen aus der Liste der Archive angeben (siehe Auflistung aller verfügbaren Archive)</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#mysql-wiederherstellen","level":3,"title":"MySQL wiederherstellen","text":"<p>Warnung</p> <p>Die Ausführung dieses Befehls löscht und erstellt die mailcow-Datenbank neu! Führen Sie diesen Befehl nicht aus, es sei denn Sie beabsichtigen, die mailcow-Datenbank von einem Backup wiederherzustellen.</p> <p>Um die MySQL-Datenbank aus dem letzten Archiv wiederherzustellen, verwenden Sie diesen Befehl:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic restore --archive latest\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic restore --archive latest\n</code></pre> <p>Alternativ können Sie auch einen beliebigen Archivnamen aus der Liste der Archive angeben (siehe Auflistung aller verfügbaren Archive)</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#nach-der-wiederherstellung","level":3,"title":"Nach der Wiederherstellung","text":"<p>Nach der Wiederherstellung müssen Sie mailcow neu starten. Wenn Sie den Enforcing-Modus von SELinux deaktiviert haben, wäre jetzt ein guter Zeitpunkt, um ihn wieder zu aktivieren.</p> <p>Um mailcow neu zu starten, verwenden Sie den folgenden Befehl:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down &amp;&amp; docker compose up -d\n</code></pre> <pre><code>docker-compose down &amp;&amp; docker-compose up -d\n</code></pre> <p>Wenn Sie SELinux verwenden, werden dadurch auch alle Dateien in Ihrem vmail-Volume neu benannt. Seien Sie geduldig, denn dies kann eine Weile dauern kann, wenn Sie viele Dateien haben.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#nutzliche-befehle","level":2,"title":"Nützliche Befehle","text":"","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#manueller-archivierungslauf-mit-debugging-ausgabe","level":3,"title":"Manueller Archivierungslauf (mit Debugging-Ausgabe)","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic -v 2\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic -v 2\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#auflistung-aller-verfugbaren-archive","level":3,"title":"Auflistung aller verfügbaren Archive","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic list\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic list\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#sperre-aufheben","level":3,"title":"Sperre aufheben","text":"<p>Wenn borg während eines Archivierungslaufs unterbrochen wird, hinterlässt es eine Sperre, die gelöscht werden muss, bevor neue Operationen durchgeführt werden können:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borg break-lock\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borg break-lock\n</code></pre> <p>Jetzt wäre ein guter Zeitpunkt, einen manuellen Archivierungslauf durchzuführen, um sicherzustellen, dass er erfolgreich durchgeführt werden kann.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.de/#exportieren-von-schlusseln","level":3,"title":"Exportieren von Schlüsseln","text":"<p>Wenn Sie eine der <code>keyfile</code>-Methoden zur Verschlüsselung verwenden, MÜSSEN Sie sich selbst um die Sicherung der Schlüsseldateien kümmern. Die Schlüsseldateien werden erzeugt, wenn Sie das Repository initialisieren. Die <code>repokey</code>-Methoden speichern die Schlüsseldatei innerhalb des Repositories, so dass eine manuelle Sicherung nicht so wichtig ist.</p> <p>Beachten Sie, dass Sie in beiden Fällen auch die Passphrase haben müssen, um die Archive zu entschlüsseln.</p> <p>Um das <code>keyfile</code> zu holen, führen Sie aus:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borg key export --paper user@rsync.net:mailcow\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borg key export --paper user@rsync.net:mailcow\n</code></pre> <p>Wobei <code>user@rsync.net:mailcow</code> die URI zu Ihrem Repository ist.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/","level":1,"title":"Borgmatic Backup","text":"","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#introduction","level":2,"title":"Introduction","text":"<p>Borgmatic is a great way to run backups on your mailcow setup as it securely encrypts your data and is extremely easy to set up.</p> <p>Due to it's deduplication capabilities you can store a great number of backups without wasting large amounts of disk space. This allows you to run backups in very short intervals to ensure minimal data loss when the need arises to recover data from a backup.</p> <p>This document guides you through the process to enable continuous backups for mailcow with borgmatic. The borgmatic functionality is provided by the borgmatic Docker image. Check out the <code>README</code> in that repository to find out about the other options (such as push notifications) that are available. This guide only covers the basics.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#setting-up-borgmatic","level":2,"title":"Setting up borgmatic","text":"","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#create-or-amend-docker-composeoverrideyml","level":3,"title":"Create or amend <code>docker-compose.override.yml</code>","text":"<p>In the mailcow-dockerized root folder create or edit <code>docker-compose.override.yml</code> and insert the following configuration:</p> <pre><code>services:\n  borgmatic-mailcow:\n    image: ghcr.io/borgmatic-collective/borgmatic\n    hostname: mailcow\n    restart: always\n    dns: ${IPV4_NETWORK:-172.22.1}.254\n    volumes:\n      - vmail-vol-1:/mnt/source/vmail:ro\n      - crypt-vol-1:/mnt/source/crypt:ro\n      - redis-vol-1:/mnt/source/redis:ro\n      - rspamd-vol-1:/mnt/source/rspamd:ro\n      - postfix-vol-1:/mnt/source/postfix:ro\n      - mysql-socket-vol-1:/var/run/mysqld/\n      - borg-config-vol-1:/root/.config/borg\n      - borg-cache-vol-1:/root/.cache/borg\n      - ./data/conf/borgmatic/etc:/etc/borgmatic.d:Z\n      - ./data/conf/borgmatic/ssh:/root/.ssh:Z\n    environment:\n      - TZ=${TZ}\n      - BORG_PASSPHRASE=${BORG_PASSPHRASE}\n      - DBNAME=${DBNAME}\n      - DBUSER=${DBUSER}\n      - DBPASS=${DBPASS}\n    networks:\n      mailcow-network:\n        aliases:\n          - borgmatic\n\nvolumes:\n  borg-cache-vol-1:\n  borg-config-vol-1:\n</code></pre> <p>Append <code>BORG_PASSPHRASE=YouBetterPutSomethingRealGoodHere</code> to your <code>mailcow.conf</code> and ensure that you change the <code>BORG_PASSPHRASE</code> to a secure passphrase of your choosing.</p> <p>For security reasons we mount the maildir as read-only. If you later want to restore data you will need to remove the <code>ro</code> flag prior to restoring the data. This is described in the section on restoring backups.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#create-dataconfborgmaticetcconfigyaml","level":3,"title":"Create <code>data/conf/borgmatic/etc/config.yaml</code>","text":"<p>Next, we need to create the borgmatic configuration. Borgmatic supports environment variable interpolation, this way we can get the correct MySQL credentials from Docker or more specifically from our <code>mailcow.conf</code> without exposing them in our config.</p> <p>Make sure to copy all the following lines!</p> <pre><code>cat &lt;&lt;EOF &gt; data/conf/borgmatic/etc/config.yaml\nsource_directories:\n    - /mnt/source/vmail\n    - /mnt/source/crypt\n    - /mnt/source/redis\n    - /mnt/source/rspamd\n    - /mnt/source/postfix\nrepositories:\n    - path: ssh://user@rsync.net:22/./mailcow\n      label: rsync\nexclude_patterns:\n    - '/mnt/source/postfix/public/'\n    - '/mnt/source/postfix/private/'\n    - '/mnt/source/rspamd/rspamd.sock'\n\nkeep_hourly: 24\nkeep_daily: 7\nkeep_weekly: 4\nkeep_monthly: 6\n\nmariadb_databases:\n    - name: ${DBNAME}\n      username: ${DBUSER}\n      password: ${DBPASS}\n      options: \"--default-character-set=utf8mb4 --skip-ssl\"\n      list_options: \"--skip-ssl\"\n      restore_options: \"--skip-ssl\"\nEOF\n</code></pre> <p>Warning</p> <p>Starting with borgmatic 1.8.0 (released July 19th, 2023), the configuration file syntax was changed. You can check the Docker logs of the borgmatic container for deprecation warnings to see if you are affected, i.e. if your config file was generated for an older borgmatic version. In this case, you should create a new <code>config.yaml</code> file as described above to avoid problems with future borgmatic releases.</p> <p>Warning</p> <p>Starting with borgmatic 1.9.4 (released December 11th, 2024), the included MariaDB tools try to force encrypted connections by default. Edit your <code>config.yaml</code> and add <code>--skip-ssl</code> to <code>options</code>, <code>restore_options</code>, and <code>list_options</code> as shown above. Also make sure to change <code>mysql_databases</code> to <code>mariadb_databases</code> to avoid problems with future borgmatic and MariaDB releases.</p> <p>This file is a minimal example for using borgmatic with an account <code>user</code> on the cloud storage provider <code>rsync.net</code> for a repository called <code>mailcow</code> (see <code>repositories</code> setting). This must be changed accordingly.</p> <p>It will backup both the maildir and MySQL database, which is all you should need to restore your mailcow setup after an incident.</p> <p>The retention settings will keep one archive for each hour of the past 24 hours, one per day of the week, one per week of the month and one per month of the past half year.</p> <p>Check the borgmatic documentation on how to use other types of repositories or configuration options. If you choose to use a local filesystem as a backup destination make sure to mount it into the container. The container defines a volume called <code>/mnt/borg-repository</code> for this purpose.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#create-a-crontab","level":3,"title":"Create a crontab","text":"<p>Create a new text file in <code>data/conf/borgmatic/etc/crontab.txt</code> with the following content:</p> <pre><code>14 * * * * PATH=$PATH:/usr/local/bin /usr/local/bin/borgmatic --stats -v 0 2&gt;&amp;1\n</code></pre> <p>This file expects crontab syntax. The example shown here will trigger the backup to run every hour at 14 minutes past the hour and log some nice stats at the end.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#place-ssh-keys-in-folder","level":3,"title":"Place SSH keys in folder","text":"<p>Place the SSH keys you intend to use for remote repository connections in <code>data/conf/borgmatic/ssh</code>. OpenSSH expects the usual <code>id_rsa</code>, <code>id_ed25519</code> or similar to be in this directory. Ensure the file is <code>chmod 600</code> and not world readable or OpenSSH will refuse to use the SSH key.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#bring-up-the-container","level":3,"title":"Bring up the container","text":"<p>For the next step we need the container to be up and running in a configured state. To do that run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#initialize-the-repository","level":3,"title":"Initialize the repository","text":"<p>By now your borgmatic container is up and running, but the backups will currently fail due to the repository not being initialized.</p> <p>To initialize the repository run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic init --encryption repokey-blake2\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic init --encryption repokey-blake2\n</code></pre> <p>You will be asked you to authenticate the SSH host key of your remote repository server. See if it matches and confirm the prompt by entering <code>yes</code>. The repository will be initialized with the passphrase you set in the <code>BORG_PASSPHRASE</code> environment variable earlier.</p> <p>When using any of the <code>repokey</code> encryption methods the encryption key will be stored in the repository itself and not on the client, so there is no further action required in this regard. If you decide to use a <code>keyfile</code> instead of a <code>repokey</code> make sure you export the key and back it up separately. Check the Exporting Keys section for how to retrieve the key.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#restart-container","level":3,"title":"Restart container","text":"<p>Now that we finished configuring and initializing the repository restart the container to ensure it is in a defined state:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart borgmatic-mailcow\n</code></pre> <pre><code>docker-compose restart borgmatic-mailcow\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#restoring-from-a-backup","level":2,"title":"Restoring from a backup","text":"<p>Restoring a backup assumes you are starting off with a fresh installation of mailcow, and you currently do not have any custom data in your maildir or your mailcow database.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#restore-maildir","level":3,"title":"Restore maildir","text":"<p>Warning</p> <p>Doing this will overwrite files in your maildir! Do not run this unless you actually intend to recover mail files from a backup.</p> <p>If you use SELinux in Enforcing mode</p> <p>If you are using mailcow on a host with SELinux in Enforcing mode you will have to temporarily disable it during extraction of the archive as the mailcow setup labels the vmail volume as private, belonging to the dovecot container exclusively. SELinux will (rightfully) prevent any other container, such as the borgmatic container, from writing to this volume.</p> <p>Before running a restore you must make the vmail volume writeable in <code>docker-compose.override.yml</code> by removing the <code>ro</code> flag from the volume. Then you can use the following command to restore the maildir from a backup:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic extract --path mnt/source --archive latest\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic extract --path mnt/source --archive latest\n</code></pre> <p>Alternatively you can specify any archive name from the list of archives (see Listing all available archives)</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#restore-mysql","level":3,"title":"Restore MySQL","text":"<p>Warning</p> <p>Running this command will delete and recreate the mailcow database! Do not run this unless you actually intend to recover the mailcow database from a backup.</p> <p>To restore the MySQL database from the latest archive use this command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic restore --archive latest\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic restore --archive latest\n</code></pre> <p>Alternatively you can specify any archive name from the list of archives (see Listing all available archives)</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#after-restoring","level":3,"title":"After restoring","text":"<p>After restoring you need to restart mailcow. If you disabled SELinux enforcing mode now would be a good time to re-enable it.</p> <p>To restart mailcow use the follwing command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down &amp;&amp; docker compose up -d\n</code></pre> <pre><code>docker-compose down &amp;&amp; docker-compose up -d\n</code></pre> <p>If you use SELinux this will also trigger the re-labeling of all files in your vmail volume. Be patient, as this may take a while if you have lots of files.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#useful-commands","level":2,"title":"Useful commands","text":"","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#manual-archiving-run-with-debugging-output","level":3,"title":"Manual archiving run (with debugging output)","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic -v 2\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic -v 2\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#listing-all-available-archives","level":3,"title":"Listing all available archives","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borgmatic list\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borgmatic list\n</code></pre>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#break-lock","level":3,"title":"Break lock","text":"<p>When borg is interrupted during an archiving run it will leave behind a stale lock that needs to be cleared before any new operations can be performed:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borg break-lock\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borg break-lock\n</code></pre> <p>Now would be a good time to do a manual archiving run to ensure it can be successfully performed.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/borgmatic/third_party-borgmatic.en/#exporting-keys","level":3,"title":"Exporting keys","text":"<p>When using any of the <code>keyfile</code> methods for encryption you MUST take care of backing up the key files yourself. The key files are generated when you initialize the repository. The <code>repokey</code> methods store the key file within the repository, so a manual backup isn't as essential.</p> <p>Note that in either case you also must have the passphrase to decrypt any archives.</p> <p>To fetch the keyfile run:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec borgmatic-mailcow borg key export --paper user@rsync.net:mailcow\n</code></pre> <pre><code>docker-compose exec borgmatic-mailcow borg key export --paper user@rsync.net:mailcow\n</code></pre> <p>Where <code>user@rsync.net:mailcow</code> is the URI to your repository.</p>","path":["Borgmatic Backup"],"tags":[]},{"location":"third_party/checkmk/u_e-checkmk.de/","level":1,"title":"U e checkmk.de","text":"<p>mailcow bietet mittels des eigenen Update-Scripts die Möglichkeit zu prüfen, ob Updates vorhanden sind.</p> <p>Sofern mailcow-Updates mittels checkmk abgefragt werden soll, kann man im <code>local</code>-Verzeichnis des checkmk-Agents (normalerweise <code>/usr/lib/check_mk_agent/local/</code>) eine ausführbare Datei mit dem Namen <code>mailcow_update</code> und nachfolgendem Inhalt erstellen:</p> <pre><code>#!/bin/bash\ncd /opt/mailcow-dockerized/ &amp;&amp; ./update.sh --check-tags &gt;/dev/null\nstatus=$?\nif [ $status -eq 3 ]; then\n  echo \"0 \\\"mailcow_update\\\" mailcow_update=0;1;;0;1 No newer tags available.\"\nelif [ $status -eq 0 ]; then\n  echo \"1 \\\"mailcow_update\\\" mailcow_update=1;1;;0;1 New tag is available.\\nThe changes can be found here: https://github.com/mailcow/mailcow-dockerized/releases/latest\"\nelse\n  echo \"3 \\\"mailcow_update\\\" - Unknown output from update script ...\"\nfi\nexit\n</code></pre> <p>Um jeden neu verfügbaren Code als Update angezeigt zu bekommen, kann die ausführbare Datei mit folgendem Inhalt erstellt werden: <pre><code>#!/bin/bash\ncd /opt/mailcow-dockerized/ &amp;&amp; ./update.sh -c &gt;/dev/null\nstatus=$?\nif [ $status -eq 3 ]; then\n  echo \"0 \\\"mailcow_update\\\" mailcow_update=0;1;;0;1 No updates available.\"\nelif [ $status -eq 0 ]; then\n  echo \"1 \\\"mailcow_update\\\" mailcow_update=1;1;;0;1 Updated code is available.\\nThe changes can be found here: https://github.com/mailcow/mailcow-dockerized/commits/master\"\nelse\n  echo \"3 \\\"mailcow_update\\\" - Unknown output from update script ...\"\nfi\nexit\n</code></pre></p> <p>Sofern das mailcow-Installationsverzeichnis nicht <code>/opt/</code> ist, kann der Pfad in der zweiten Zeile angepasst werden.</p> <p>Danach für den mailcow-Host in checkmk die Services neu inventarisieren und es sollte ein neuer Check mit Namen <code>mailcow_update</code> auswählbar sein.</p> <p>Der Check <code>mailcow_update</code> wird jedes Mal ausgeführt, wenn der checkmk Agent den mailcow Server überprüft. Sie können das Ergebnis zwischenspeichern, indem Sie das Skript in einem Unterordner mit dem Namen der Anzahl von Sekunden ablegen, für die Sie es zwischenspeichern möchten. \\ <code>/usr/lib/check_mk_agent/local/3600/</code> speichert die Antwort für 3600 Sekunden (1 Stunde).</p>","path":["U e checkmk.de"],"tags":[]},{"location":"third_party/checkmk/u_e-checkmk.de/#screenshots","level":2,"title":"Screenshots","text":"","path":["U e checkmk.de"],"tags":[]},{"location":"third_party/checkmk/u_e-checkmk.de/#keine-updates-verfugbar","level":3,"title":"Keine Updates verfügbar","text":"<p>Sofern keine Updates / keine neuen Tags vorhanden sind, wird <code>OK</code> ausgegeben.</p> <p></p>","path":["U e checkmk.de"],"tags":[]},{"location":"third_party/checkmk/u_e-checkmk.de/#neue-updates-verfugbar","level":3,"title":"Neue Updates verfügbar","text":"<p>Sofern Updates / Neue Tags vorhanden sind, wird <code>WARN</code> ausgegeben.</p> <p></p> <p>Sollte stattdessen <code>CRIT</code> gewünscht sein, ist die 7. Zeile durch folgendes zu ersetzen:</p> <pre><code>echo \"2 \\\"mailcow_update\\\" mailcow_update=1;1;;0;1 Updated code is available.\\nThe changes can be found here: https://github.com/mailcow/mailcow-dockerized/commits/master\"\n</code></pre>","path":["U e checkmk.de"],"tags":[]},{"location":"third_party/checkmk/u_e-checkmk.de/#detailierter-check-output","level":3,"title":"Detailierter Check-Output","text":"<ul> <li>Hier wird ein Link zu den GitHub Commits / des letzten Release von mailcow ausgegeben, sofern Updates verfügbar sind.</li> <li>Metriken werden ebenfalls ausgegeben (nicht nur bei vorhandenen Updates):</li> <li>0 = Keine Updates verfügbar</li> <li>1 = Neue Updates verfügbar</li> </ul>","path":["U e checkmk.de"],"tags":[]},{"location":"third_party/checkmk/u_e-checkmk.en/","level":1,"title":"U e checkmk.en","text":"<p>mailcow provides the ability to check for updates using its own update script.</p> <p>If you want to check for mailcow updates using checkmk, you can create an executable file in the <code>local</code> directory of the checkmk agent (typically <code>/usr/lib/check_mk_agent/local/</code>) with the name <code>mailcow_update</code> and the following content: <pre><code>#!/bin/bash\ncd /opt/mailcow-dockerized/ &amp;&amp; ./update.sh --check-tags &gt;/dev/null\nstatus=$?\nif [ $status -eq 3 ]; then\n  echo \"0 \\\"mailcow_update\\\" mailcow_update=0;1;;0;1 No newer tags available.\"\nelif [ $status -eq 0 ]; then\n  echo \"1 \\\"mailcow_update\\\" mailcow_update=1;1;;0;1 New tag is available.\\nThe changes can be found here: https://github.com/mailcow/mailcow-dockerized/releases/latest\"\nelse\n  echo \"3 \\\"mailcow_update\\\" - Unknown output from update script ...\"\nfi\nexit\n</code></pre></p> <p>To check for every updated code, just create the executable with the following content: <pre><code>#!/bin/bash\ncd /opt/mailcow-dockerized/ &amp;&amp; ./update.sh -c &gt;/dev/null\nstatus=$?\nif [ $status -eq 3 ]; then\n  echo \"0 \\\"mailcow_update\\\" mailcow_update=0;1;;0;1 No updates available.\"\nelif [ $status -eq 0 ]; then\n  echo \"1 \\\"mailcow_update\\\" mailcow_update=1;1;;0;1 Updated code is available.\\nThe changes can be found here: https://github.com/mailcow/mailcow-dockerized/commits/master\"\nelse\n  echo \"3 \\\"mailcow_update\\\" - Unknown output from update script ...\"\nfi\nexit\n</code></pre></p> <p>If the mailcow installation directory is not <code>/opt/</code>, adjust this in the 2nd line.</p> <p>After that re-inventory the services for your mailcow host in checmk and a new check named <code>mailcow_update</code> should be selectable.</p> <p>This will run the <code>mailcow_update</code> everytime checkmk agent is checked, you can cache the result by placing the script in a subfolder named the number of seconds you wish to cache it. \\ <code>/usr/lib/check_mk_agent/local/3600/</code> will cache the response for an 3600 seconds (1 hour).</p>","path":["U e checkmk.en"],"tags":[]},{"location":"third_party/checkmk/u_e-checkmk.en/#screenshots","level":2,"title":"Screenshots","text":"","path":["U e checkmk.en"],"tags":[]},{"location":"third_party/checkmk/u_e-checkmk.en/#no-updates-available","level":3,"title":"No updates available","text":"<p>If there are no updates / newer tag available, <code>OK</code> is displayed.</p> <p></p>","path":["U e checkmk.en"],"tags":[]},{"location":"third_party/checkmk/u_e-checkmk.en/#new-updates-available","level":3,"title":"New updates available","text":"<p>If updates / newer tags are available, <code>WARN</code> is displayed.</p> <p></p> <p>If <code>CRIT</code> is desired instead, replace the 7th line with the following:</p> <pre><code>echo \"2 \\\"mailcow_update\\\" mailcow_update=1;1;;0;1 Updated code is available.\\nThe changes can be found here: https://github.com/mailcow/mailcow-dockerized/commits/master\"\n</code></pre>","path":["U e checkmk.en"],"tags":[]},{"location":"third_party/checkmk/u_e-checkmk.en/#detailed-check-output","level":3,"title":"Detailed check output","text":"<ul> <li>This provides a link to mailcow's GitHub commits, if updates are available.</li> <li>Metrics are also displayed ( not only when updates are available):</li> <li>0 = No updates available</li> <li>1 = New updates available</li> </ul>","path":["U e checkmk.en"],"tags":[]},{"location":"third_party/exchange_onprem/third_party-exchange_onprem.de/","level":1,"title":"Third party exchange onprem.de","text":"<p>Die Verwendung von Microsoft Exchange in einem hybriden Setup ist mit mailcow möglich. Mit diesem Setup können Sie Postfächer auf Ihrer mailcow hinzufügen und trotzdem Exchange Online Protection nutzen. Alle Postfächer, die in Exchange eingerichtet sind, erhalten ihre Mails wie gewohnt, während mit dem hybriden Ansatz zusätzliche Postfächer in mailcow ohne weitere Konfiguration eingerichtet werden können.</p> <p>Dieses Setup ist sehr praktisch, wenn Sie die Office 365 Sicherheitsvorgaben aktiviert haben und Anwendungen von Drittanbietern sich nicht mehr in Ihre Postfächer mit einer der unterstützten Methoden einloggen können.</p>","path":["Third party exchange onprem.de"],"tags":[]},{"location":"third_party/exchange_onprem/third_party-exchange_onprem.de/#voraussetzungen","level":2,"title":"Voraussetzungen","text":"<ul> <li>Der mx Record Ihrer Domain muss auf den Exchange Mail Service zeigen. Melden Sie sich in Ihrem Admin-Center an und suchen Sie in den DNS-Einstellungen Ihrer Domäne nach Ihrer personalisierten Gateway-Domäne. Sie sollte wie folgt aussehen: <code>contoso-com.mail.protection.outlook.com</code>. Wenden Sie sich an Ihren Domainregistrator, um weitere Informationen zur Änderung des mx-Eintrags zu erhalten.</li> <li>Die Domäne, für die Sie zusätzliche Postfächer haben möchten, muss in Exchange als \"Interne Relay-Domäne\" eingerichtet werden.<ol> <li>Melden Sie sich bei Ihrem Exchange Admin Center an.</li> <li>Wählen Sie den Bereich \"Mailflow\" und klicken Sie auf \"Akzeptierte Domänen\".</li> <li>Wählen Sie die Domäne aus und schalten Sie sie von \"autorisiert\" auf \"internes Relais\" um.</li> </ol> </li> </ul>","path":["Third party exchange onprem.de"],"tags":[]},{"location":"third_party/exchange_onprem/third_party-exchange_onprem.de/#einrichten-der-mailcow","level":2,"title":"Einrichten der mailcow","text":"<p>Ihre mailcow muss alle Mails an Ihren personalisierten Exchange Host weiterleiten. Es ist die gleiche Host-Adresse, die wir bereits für den mx Record gesucht haben.</p> <ol> <li>Fügen Sie die Domain zu Ihrer mailcow hinzu</li> <li>Fügen Sie Ihre personalisierte Exchange Host Adresse als relayhost hinzu</li> <li>Fügen Sie Ihre personalisierte Exchange Host Adresse als Weiterleitungshost hinzu, um alle weitergeleiteten Mails von Exchange bedingungslos zu akzeptieren. (Admin &gt; Konfiguration &amp; Details &gt; Konfigurations-Dropdown &gt; Weiterleitungshosts)</li> <li>Gehen Sie zu den Domäneneinstellungen und wählen Sie den neu hinzugefügten Host in der Dropdown-Liste \"Absenderabhängige Transporte\" aus. Aktivieren Sie die Weiterleitung, indem Sie die Kontrollkästchen \"Diese Domäne weiterleiten\", \"Alle Empfänger weiterleiten\" und \"Nur nicht vorhandene Postfächer weiterleiten\" aktivieren.</li> </ol> <p>Info</p> <p>Von nun an wird Ihre mailcow alle Mails akzeptieren, die von Exchange weitergeleitet werden. Die Eingangsfilterung und damit das neuronale Lernen Ihrer Kuh wird nicht mehr funktionieren. Da alle Mails über Exchange geroutet werden, wird der Filterungsprozess dort abgewickelt.</p>","path":["Third party exchange onprem.de"],"tags":[]},{"location":"third_party/exchange_onprem/third_party-exchange_onprem.de/#connectors-in-exchange-einrichten","level":2,"title":"Connectors in Exchange einrichten","text":"<p>Der gesamte Mailverkehr läuft nun über Exchange. Zu diesem Zeitpunkt filtert der Exchange Online-Schutz bereits alle ein- und ausgehenden Mails. Jetzt müssen wir zwei Konnektoren einrichten, um eingehende Mails von unserem Exchange Service an die mailcow weiterzuleiten und einen weiteren, um Mails zuzulassen, die von der mailcow an unseren Exchange Service weitergeleitet werden. Sie können der [offiziellen Anleitung von Microsoft] folgen (https://docs.microsoft.com/exchange/mail-flow-best-practices/use-connectors-to-configure-mail-flow/set-up-connectors-to-route-mail#2-set-up-a-connector-from-microsoft-365-or-office-365-to-your-email-server).</p> <p>Warnung</p> <p>Für den Connector, der die Mails von Ihrer mailcow zu Exchange weiterleitet, bietet Microsoft zwei Möglichkeiten der Authentifizierung an. Der empfohlene Weg ist die Verwendung eines tls-Zertifikats, das mit einem Subject-Namen konfiguriert ist, der mit einer akzeptierten Domäne in Exchange übereinstimmt. Andernfalls müssen Sie die Authentifizierung mit der statischen IP-Adresse Ihrer mailcow wählen.</p>","path":["Third party exchange onprem.de"],"tags":[]},{"location":"third_party/exchange_onprem/third_party-exchange_onprem.de/#validierung","level":2,"title":"Validierung","text":"<p>Der einfachste Weg, die hybride Einrichtung zu überprüfen, ist das Senden einer Mail aus dem Internet an eine Mailbox, die nur auf der mailcow existiert und andersherum.</p>","path":["Third party exchange onprem.de"],"tags":[]},{"location":"third_party/exchange_onprem/third_party-exchange_onprem.de/#allgemeine-probleme","level":3,"title":"Allgemeine Probleme","text":"<ul> <li>Die Validierung des Connectors von Exchange zu Ihrer mailcow schlug fehl mit <code>550 5.1.10 RESOLVER.ADR.RecipientNotFound; Recipient test@contoso.com not found by SMTP address lookup</code> Mögliche Lösung: Ihre Domäne ist nicht als \"internes Relay\" eingerichtet. Exchange kann daher den Empfänger nicht finden.</li> <li>Mails, die von der mailcow an eine Mailbox im Internet gesendet werden, können nicht zugestellt werden. Non Delivery Report mit Fehler <code>550 5.7.64 TenantAttribution; Relay Access Denied</code> Mögliche Lösung: Die Authentifizierungsmethode ist fehlgeschlagen. Stellen Sie sicher, dass der Betreff des Zertifikats mit einer akzeptierten Domäne in Exchange übereinstimmt. Versuchen Sie stattdessen die Authentifizierung über eine statische IP.</li> </ul> <p>Microsoft-Anleitung für die Einrichtung des Connectors und zusätzliche Anforderungen: https://docs.microsoft.com/exchange/mail-flow-best-practices/use-connectors-to-configure-mail-flow/set-up-connectors-to-route-mail#prerequisites-for-your-on-premises-email-environment</p>","path":["Third party exchange onprem.de"],"tags":[]},{"location":"third_party/exchange_onprem/third_party-exchange_onprem.en/","level":1,"title":"Third party exchange onprem.en","text":"<p>Using Microsoft Exchange in a hybrid setup is possible with mailcow. With this setup you can add mailboxes on your mailcow and still use Exchange Online Protection. All mailboxes setup in Exchange will receive their mails as usual, while with the hybrid approach additional Mailboxes can be setup in mailcow without any further configuration.</p> <p>This setup becomes very handy if you have enabled the Office 365 security defaults and third party applications can no longer login into your mailboxes by any of the supported methods.</p>","path":["Third party exchange onprem.en"],"tags":[]},{"location":"third_party/exchange_onprem/third_party-exchange_onprem.en/#requirements","level":2,"title":"Requirements","text":"<ul> <li>The mx Record of your domain needs to point at the Exchange mail service. Log into your Admin center and look out for the dns settings of your domain to find your personalized gateway domain. It should look like this <code>contoso-com.mail.protection.outlook.com</code>. Contact your domain registrant to get further information on how to change mx record.</li> <li>The domain you want to have additional mailboxes for must be setup as <code>internal relay domain</code> in Exchange.<ol> <li>Log in to your Exchange Admin Center</li> <li>Select the <code>mail flow</code> pane and click on <code>accepted domains</code></li> <li>Select the domain and switch it from <code>authorative</code> to <code>internal relay</code></li> </ol> </li> </ul>","path":["Third party exchange onprem.en"],"tags":[]},{"location":"third_party/exchange_onprem/third_party-exchange_onprem.en/#set-up-the-mailcow","level":2,"title":"Set up the mailcow","text":"<p>Your mailcow needs to relay all mails to your personalized Exchange Host. It is the same host address we already looked up for the mx Record.</p> <ol> <li>Add the domain to your mailcow</li> <li>Add your personalized Exchange Host address as relayhost</li> <li>Add your personalized Exchange Host address as forwarding host to unconditionally accepted all relayed mails from Exchange. (Admin &gt; Configuration &amp; Details &gt; Configuration Dropdown &gt; Forwarding Hosts)</li> <li>Go to the domain settings and select the newly added host on the <code>Sender-dependent transports</code> dropdown. Enable relaying by ticking the <code>Relay this domain</code>, <code>Relay all recipients</code> and the <code>Relay non-existing mailboxes only.</code> checkboxes</li> </ol> <p>Info</p> <p>From now on your mailcow will accept all mails relayed from Exchange. The inbound filtering and so the neural learning of your cow will no longer work. Because all mails are routed through Exchange the filtering process is handled there.</p>","path":["Third party exchange onprem.en"],"tags":[]},{"location":"third_party/exchange_onprem/third_party-exchange_onprem.en/#set-up-connectors-in-exchange","level":2,"title":"Set up Connectors in Exchange","text":"<p>All mail traffic now goes through Exchange. At this point the Exchange Online Protection already filters all incoming and outgoing mails. Now we need to set up two connectors to relay incoming mails from our Exchange Service to the mailcow and another one to allow mails relayed from the mailcow to our exchange service. You can follow the official guide from Microsoft.</p> <p>Warning</p> <p>For the connector that handles mails from your mailcow to Exchange Microsoft offers two ways of authenticating it. The recommended way is to use a tls certificate configured with a subject name that matches an accepted domain in Exchange. Otherwise you need to choose authentication with the static ip address of your mailcow.</p>","path":["Third party exchange onprem.en"],"tags":[]},{"location":"third_party/exchange_onprem/third_party-exchange_onprem.en/#validating","level":2,"title":"Validating","text":"<p>The easiest way to validate the hybrid setup is by sending a mail from the internet to a mailbox that only exists on the mailcow and vice versa.</p>","path":["Third party exchange onprem.en"],"tags":[]},{"location":"third_party/exchange_onprem/third_party-exchange_onprem.en/#common-issues","level":3,"title":"Common Issues","text":"<ul> <li>The connector validation from Exchange to your mailcow failed with <code>550 5.1.10 RESOLVER.ADR.RecipientNotFound; Recipient test@contoso.com not found by SMTP address lookup</code> Possible Solution: Your domain is not set up as <code>internal relay</code>. Exchange therefore cannot find the recipient</li> <li>Mails sent from the mailcow to a mailbox in the internet cannot be sent. Non Delivery Report with error <code>550 5.7.64 TenantAttribution; Relay Access Denied</code> Possible Solution: The authentication method failed. Make sure the certificate subject matches an accepted domain in Exchange. Try authenticating by static ip instead.</li> </ul> <p>Microsoft Guide for the connector setup and additional requirements: https://docs.microsoft.com/exchange/mail-flow-best-practices/use-connectors-to-configure-mail-flow/set-up-connectors-to-route-mail#prerequisites-for-your-on-premises-email-environment</p>","path":["Third party exchange onprem.en"],"tags":[]},{"location":"third_party/gitea/third_party-gitea.de/","level":1,"title":"Third party gitea.de","text":"<p>Mit der Fähigkeit von Gitea, sich über SMTP zu authentifizieren, ist es trivial, es mit mailcow zu integrieren. Es sind nur wenige Änderungen erforderlich:</p> <p>1. Um eine Datenbank für Gitea zu erstellen, verbinden Sie sich mit ihrem Server und führen Sie folgende Befehle aus: <pre><code>source mailcow.conf\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE DATABASE gitea;\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE USER 'gitea'@'%' IDENTIFIED BY 'your_strong_password';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"GRANT ALL PRIVILEGES ON gitea.* TO 'gitea'@'%';\"\n</code></pre></p> <p>2. Öffnen Sie <code>docker-compose.override.yml</code> und fügen Sie Gitea hinzu:</p> <pre><code>services:\n\n        gitea-mailcow:\n            image: gitea/gitea:1\n            volumes:\n                - ./data/gitea:/data\n            networks:\n                mailcow-network:\n                    aliases:\n                        - gitea\n            ports:\n                - \"${GITEA_SSH_PORT:-127.0.0.1:4000}:22\"\n</code></pre> <p>3. Erstellen Sie <code>data/conf/nginx/site.gitea.custom</code>, fügen Sie folgendes hinzu: <pre><code>location /gitea/ {\n        proxy_pass http://gitea:3000/;\n}\n</code></pre></p> <p>4. Öffne <code>mailcow.conf</code> und definiere den Port Bind, den Gitea für SSH verwenden soll. Beispiel:</p> <pre><code>GITEA_SSH_PORT=127.0.0.1:4000\n</code></pre> <p>5. Führen Sie folgenden Befehl aus, um den Gitea-Container hochzufahren und führen Sie anschließend einen Neustart von NGINX mit dem zweiten Befehl durch:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\ndocker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose up -d\ndocker-compose restart nginx-mailcow\n</code></pre> <p>6. Wenn Sie mailcow zu https gezwungen haben, führen Sie Schritt 9 aus und starten Sie gitea mit dem folgenden Befehl neu. </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart gitea-mailcow\n</code></pre> <pre><code>docker-compose restart gitea-mailcow\n</code></pre> <p>Fahren Sie mit Schritt 7 fort (Denken Sie daran, https anstelle von http zu verwenden, <code>https://mx.example.org/gitea/</code>)</p> <p>7. Öffnen Sie <code>http://${MAILCOW_HOSTNAME}/gitea/</code>, zum Beispiel <code>http://mx.example.org/gitea/</code>. Für Datenbank-Details setzen Sie <code>mysql</code> als Datenbank-Host. Verwenden Sie gitea als Datenbankname, gitea als Datenbankbenutzer und your_strong_password als Datenbankpasswort, welches Sie in Schritt 1 definiert haben.</p> <p>8. Sobald die Installation abgeschlossen ist, loggen Sie sich als Administrator ein und setzen Sie \"Einstellungen\" -&gt; \"Autorisierung\" -&gt; \"SMTP aktivieren\". SMTP-Host sollte <code>postfix</code> mit Port <code>587</code> sein, setzen Sie <code>Skip TLS Verify</code>, da wir ein nicht gelistetes SAN verwenden (\"postfix\" ist höchstwahrscheinlich nicht Teil Ihres Zertifikats).</p> <p>9. Erstellen Sie <code>data/gitea/gitea/conf/app.ini</code> und setzen Sie die folgenden Werte. Sie können gitea cheat sheet, leider bisher nur in Englisch verfügbar für deren Bedeutung und andere mögliche Werte konsultieren.</p> <pre><code>[server]\nSSH_LISTEN_PORT = 22\n# Für GITEA_SSH_PORT=127.0.0.1:4000 in mailcow.conf, setzen:\nSSH_DOMAIN = 127.0.0.1\nSSH_PORT = 4000\n# Für MAILCOW_HOSTNAME=mx.example.org in mailcow.conf (und Standard-Ports für HTTPS), setzen:\nROOT_URL = https://mx.example.org/gitea/\n</code></pre> <p>10. Starten Sie gitea neu mit dem kommenden Befehl. Ihre Nutzer sollten in der Lage sein, sich mit von mailcow verwalteten Konten anzumelden.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart gitea-mailcow\n</code></pre> <pre><code>docker-compose restart gitea-mailcow\n</code></pre>","path":["Third party gitea.de"],"tags":[]},{"location":"third_party/gitea/third_party-gitea.en/","level":1,"title":"Third party gitea.en","text":"<p>With Gitea' ability to authenticate over SMTP it is trivial to integrate it with mailcow. Few changes are needed:</p> <p>1. In order to create a database for gitea, connect to your shell and execute the following commands: <pre><code>source mailcow.conf\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE DATABASE gitea;\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE USER 'gitea'@'%' IDENTIFIED BY 'your_strong_password';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"GRANT ALL PRIVILEGES ON gitea.* TO 'gitea'@'%';\"\n</code></pre></p> <p>2. Open <code>docker-compose.override.yml</code> and add gitea:</p> <pre><code>services:\n\n        gitea-mailcow:\n            image: gitea/gitea:1\n            volumes:\n                - ./data/gitea:/data\n            networks:\n                mailcow-network:\n                    aliases:\n                        - gitea\n            ports:\n                - \"${GITEA_SSH_PORT:-127.0.0.1:4000}:22\"\n</code></pre> <p>3. Create <code>data/conf/nginx/site.gitea.custom</code>, add: <pre><code>location /gitea/ {\n        proxy_pass http://gitea:3000/;\n}\n</code></pre></p> <p>4. Open <code>mailcow.conf</code> and define the binding you want gitea to use for SSH. Example:</p> <pre><code>GITEA_SSH_PORT=127.0.0.1:4000\n</code></pre> <p>5. Run the commands to bring up the gitea container and restart the nginx-mailcow container afterwards:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\ndocker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose up -d\ndocker-compose restart nginx-mailcow\n</code></pre> <p>6. If you forced mailcow to https, execute step 9 and restart gitea with the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart gitea-mailcow\n</code></pre> <pre><code>docker-compose restart gitea-mailcow\n</code></pre> <p>Go head with step 7 (Remember to use https instead of http, <code>https://mx.example.org/gitea/</code>) </p> <p>7. Open <code>http://${MAILCOW_HOSTNAME}/gitea/</code>, for example <code>http://mx.example.org/gitea/</code>. For database details set <code>mysql</code> as database host. Use gitea as database name, gitea as database user and your_strong_password you previously definied at step 1 as database password.</p> <p>8. Once the installation is complete, login as admin and set \"settings\" -&gt; \"authorization\" -&gt; \"enable SMTP\". SMTP Host should be <code>postfix</code> with port <code>587</code>, set <code>Skip TLS Verify</code> as we are using an unlisted SAN (\"postfix\" is most likely not part of your certificate).</p> <p>9. Create <code>data/gitea/gitea/conf/app.ini</code> and set following values. You can consult gitea cheat sheet for their meaning and other possible values.</p> <pre><code>[server]\nSSH_LISTEN_PORT = 22\n# For GITEA_SSH_PORT=127.0.0.1:4000 in mailcow.conf, set:\nSSH_DOMAIN = 127.0.0.1\nSSH_PORT = 4000\n# For MAILCOW_HOSTNAME=mx.example.org in mailcow.conf (and default ports for HTTPS), set:\nROOT_URL = https://mx.example.org/gitea/\n</code></pre> <p>10. Restart gitea with the following command. Your users should be able to login with mailcow managed accounts.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart gitea-mailcow\n</code></pre> <pre><code>docker-compose restart gitea-mailcow\n</code></pre>","path":["Third party gitea.en"],"tags":[]},{"location":"third_party/gogs/third_party-gogs.de/","level":1,"title":"Third party gogs.de","text":"<p>Mit Gogs' Fähigkeit, sich über SMTP zu authentifizieren, ist es einfach, es mit mailcow zu verbinden. Es sind nur wenige Änderungen erforderlich:</p> <p>1. Um eine Datenbank für Gogs zu erstellen, verbinden Sie sich mit ihrem Server und führen Sie folgende Befehle aus: <pre><code>source mailcow.conf\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE DATABASE gogs;\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE USER 'gogs'@'%' IDENTIFIED BY 'your_strong_password';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"GRANT ALL PRIVILEGES ON gogs.* TO 'gogs'@'%';\n</code></pre></p> <p>2. Öffne <code>docker-compose.override.yml</code> und füge Gogs hinzu:</p> <pre><code>services:\n\n    gogs-mailcow:\n      image: gogs/gogs\n      volumes:\n        - ./data/gogs:/data\n      networks:\n        mailcow-network:\n          aliases:\n            - gogs\n      ports:\n        - \"${GOGS_SSH_PORT:-127.0.0.1:4000}:22\"\n</code></pre> <p>3. Erstelle <code>data/conf/nginx/site.gogs.custom</code>, füge hinzu: <pre><code>location /gogs/ {\n    proxy_pass http://gogs:3000/;\n}\n</code></pre></p> <p>4. Öffne <code>mailcow.conf</code> und definiere die Bindung, die Gogs für SSH verwenden soll. Beispiel:</p> <pre><code>GOGS_SSH_PORT=127.0.0.1:4000\n</code></pre> <p>5. Führen Sie folgenden Befehl aus, um den Gogs-Container hochzufahren und führen Sie anschließend einen Neustart von NGINX mit dem zweiten Befehl durch:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\ndocker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose up -d\ndocker-compose restart nginx-mailcow\n</code></pre> <p>6. Öffnen Sie <code>http://${MAILCOW_HOSTNAME}/gogs/</code>, zum Beispiel <code>http://mx.example.org/gogs/</code>. Für Datenbank-Details setzen Sie <code>mysql</code> als Datenbank-Host. Verwenden Sie gogs als Datenbankname, gogs als Datenbankbenutzer und your_strong_password als Datenbankpasswort, welches Sie in Schritt 1 definiert haben.</p> <p>7. Sobald die Installation abgeschlossen ist, loggen Sie sich als Administrator ein und setzen Sie \"Einstellungen\" -&gt; \"Autorisierung\" -&gt; \"SMTP aktivieren\". SMTP-Host sollte <code>postfix</code> mit Port <code>587</code> sein, setzen Sie <code>Skip TLS Verify</code>, da wir ein nicht gelistetes SAN verwenden (\"postfix\" ist höchstwahrscheinlich nicht Teil Ihres Zertifikats).</p> <p>8. Erstellen Sie <code>data/gogs/gogs/conf/app.ini</code> und setzen Sie die folgenden Werte. Sie können Gogs cheat sheet für ihre Bedeutung und andere mögliche Werte konsultieren.</p> <pre><code>[server]\nSSH_LISTEN_PORT = 22\n# Für GOGS_SSH_PORT=127.0.0.1:4000 in mailcow.conf, setzen:\nSSH_DOMAIN = 127.0.0.1\nSSH_PORT = 4000\n# Für MAILCOW_HOSTNAME=mx.example.org in mailcow.conf (und Standard-Ports für HTTPS), setzen:\nROOT_URL = https://mx.example.org/gogs/\n</code></pre> <p>9. Starten Sie Gogs neu mit dem kommenden Befehl. Ihre Nutzer sollten in der Lage sein, sich mit von mailcow verwalteten Konten anzumelden.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart gogs-mailcow\n</code></pre> <pre><code>docker-compose restart gogs-mailcow\n</code></pre>","path":["Third party gogs.de"],"tags":[]},{"location":"third_party/gogs/third_party-gogs.en/","level":1,"title":"Third party gogs.en","text":"<p>With Gogs' ability to authenticate over SMTP it is trivial to integrate it with mailcow. Few changes are needed:</p> <p>1. In order to create a database for Gogs, connect to your shell and execute the following commands: <pre><code>source mailcow.conf\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE DATABASE gogs;\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE USER 'gogs'@'%' IDENTIFIED BY 'your_strong_password';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"GRANT ALL PRIVILEGES ON gogs.* TO 'gogs'@'%';\n</code></pre></p> <p>2. Open <code>docker-compose.override.yml</code> and add Gogs:</p> <pre><code>services:\n\n    gogs-mailcow:\n      image: gogs/gogs\n      volumes:\n        - ./data/gogs:/data\n      networks:\n        mailcow-network:\n          aliases:\n            - gogs\n      ports:\n        - \"${GOGS_SSH_PORT:-127.0.0.1:4000}:22\"\n</code></pre> <p>3. Create <code>data/conf/nginx/site.gogs.custom</code>, add: <pre><code>location /gogs/ {\n    proxy_pass http://gogs:3000/;\n}\n</code></pre></p> <p>4. Open <code>mailcow.conf</code> and define the binding you want Gogs to use for SSH. Example:</p> <pre><code>GOGS_SSH_PORT=127.0.0.1:4000\n</code></pre> <p>5. Run the commands to bring up the Gogs container and restart the nginx-mailcow container afterwards:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\ndocker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose up -d\ndocker-compose restart nginx-mailcow\n</code></pre> <p>6. Open <code>http://${MAILCOW_HOSTNAME}/gogs/</code>, for example <code>http://mx.example.org/gogs/</code>. For database details set <code>mysql</code> as database host. Use the value gogs as database name, gogs as database user and your_strong_password you previously definied at step 1 as database password.</p> <p>7. Once the installation is complete, login as admin and set \"settings\" -&gt; \"authorization\" -&gt; \"enable SMTP\". SMTP Host should be <code>postfix</code> with port <code>587</code>, set <code>Skip TLS Verify</code> as we are using an unlisted SAN (\"postfix\" is most likely not part of your certificate).</p> <p>8. Create <code>data/gogs/gogs/conf/app.ini</code> and set following values. You can consult Gogs cheat sheet for their meaning and other possible values.</p> <pre><code>[server]\nSSH_LISTEN_PORT = 22\n# For GOGS_SSH_PORT=127.0.0.1:4000 in mailcow.conf, set:\nSSH_DOMAIN = 127.0.0.1\nSSH_PORT = 4000\n# For MAILCOW_HOSTNAME=mx.example.org in mailcow.conf (and default ports for HTTPS), set:\nROOT_URL = https://mx.example.org/gogs/\n</code></pre> <p>9. Restart Gogs with the following command. Your users should be able to login with mailcow managed accounts.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart gogs-mailcow\n</code></pre> <pre><code>docker-compose restart gogs-mailcow\n</code></pre>","path":["Third party gogs.en"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/","level":1,"title":"Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen","text":"<p>Info</p> <p>Diese Anleitung ist eine Kopie von dockerized-mailcow-mailman. Bitte posten Sie Probleme, Fragen und Verbesserungen in den issue tracker dort.</p> <p>Warnung</p> <p>mailcow ist nicht verantwortlich für Datenverlust, Hardwareschäden oder kaputte Tastaturen. Diese Anleitung kommt ohne jegliche Garantie. Macht Backups bevor ihr anfangt, Kein Backup kein Mitleid!</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#einleitung","level":2,"title":"Einleitung","text":"<p>Diese Anleitung zielt darauf ab, mailcow-dockerized mit [docker-mailman] (https://github.com/maxking/docker-mailman) zu installieren und zu konfigurieren und einige nützliche Skripte bereitzustellen. Eine wesentliche Bedingung ist, dass mailcow und Mailman in ihren eigenen Installationen für unabhängige Updates erhalten bleiben.</p> <p>Es gibt einige Anleitungen und Projekte im Internet, aber sie sind nicht auf dem neuesten Stand und/oder unvollständig in der Dokumentation oder Konfiguration. Diese Anleitung basiert auf der Arbeit von:</p> <ul> <li>mailcow-mailman3-dockerized von Shadowghost</li> <li>mailman-mailcow-integration</li> </ul> <p>Nach Beendigung dieser Anleitung werden mailcow-dockerized und docker-mailman laufen und Apache als Reverse-Proxy wird die Web-Frontends bedienen.</p> <p>Das verwendete Betriebssystem ist ein Ubuntu 20.04 LTS.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#installation","level":2,"title":"Installation","text":"<p>Diese Anleitung basiert auf verschiedenen Schritten:</p> <ol> <li>DNS-Einrichtung</li> <li>Installieren Sie Apache als Reverse Proxy</li> <li>Beziehen Sie SSL-Zertifikate mit Let's Encrypt.</li> <li>Installieren Sie mailcow mit Mailman Integration</li> <li>Installieren Sie Mailman.</li> <li>🏃 Ausführen</li> </ol>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#dns-einrichtung","level":3,"title":"DNS-Einrichtung","text":"<p>Der größte Teil der Konfiguration ist in mailcows DNS Konfiguration enthalten. Nachdem diese Einrichtung abgeschlossen ist, fügen Sie eine weitere Subdomain für Mailman hinzu, z.B. <code>lists.example.org</code>, die auf denselben Server zeigt:</p> <pre><code># Name Typ Wert\nlists IN A 1.2.3.4\nlists IN AAAA dead:beef\n</code></pre>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#installieren-sie-apache-als-reverse-proxy","level":3,"title":"Installieren Sie Apache als Reverse Proxy","text":"<p>Installieren Sie Apache, z.B. mit dieser Anleitung von Digital Ocean: How To Install the Apache Web Server on Ubuntu 20.04 (Englisch).</p> <p>Aktivieren Sie bestimmte Apache Module (als root oder sudo):</p> <pre><code>a2enmod rewrite proxy proxy_http headers ssl wsgi proxy_uwsgi http2\n</code></pre> <p>Möglicherweise müssen Sie weitere Pakete installieren, um diese Module zu erhalten. Dieses PPA von Ondřej Surý könnte Ihnen helfen.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#vhost-konfiguration","level":4,"title":"vHost-Konfiguration","text":"<p>Kopieren Sie die mailcow.conf und die mailman.conf in den Apache conf Ordner <code>sites-available</code> (z.B. unter <code>/etc/apache2/sites-available</code>).</p> <p>Änderung in <code>mailcow.conf</code>: - <code>MAILCOW_HOSTNAME</code> zu Ihrem MAILCOW_HOSTNAME</p> <p>Änderung in <code>mailman.conf</code>: - <code>MAILMAN_DOMAIN</code> in Ihre Mailman-Domain (z.B. <code>Lists.example.org</code>)</p> <p>**Aktivieren Sie die Konfiguration noch nicht, da die ssl-Zertifikate und Verzeichnisse noch fehlen.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#beziehen-sie-ssl-zertifikate-mit-lets-encrypt","level":3,"title":"Beziehen Sie SSL-Zertifikate mit Let's Encrypt.","text":"<p>Prüfen Sie, ob Ihre DNS-Konfiguration über das Internet verfügbar ist und auf die richtigen IP-Adressen zeigt, z.B. mit MXToolBox:</p> <ul> <li>https://mxtoolbox.com/SuperTool.aspx?action=a%3aMAILCOW_HOSTNAME</li> <li>https://mxtoolbox.com/SuperTool.aspx?action=aaaa%3aMAILCOW_HOSTNAME</li> <li>https://mxtoolbox.com/SuperTool.aspx?action=a%3aMAILMAN_DOMAIN</li> <li>https://mxtoolbox.com/SuperTool.aspx?action=aaaa%3aMAILMAN_DOMAIN</li> </ul> <p>Installieren Sie certbot (als root oder sudo):</p> <pre><code>apt install certbot\n</code></pre> <p>Holen Sie sich die gewünschten Zertifikate (als root oder sudo):</p> <pre><code>certbot certonly -d mailcow_HOSTNAME\ncertbot certonly -d MAILMAN_DOMAIN\n</code></pre>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#installieren-sie-mailcow-mit-mailman-integration","level":3,"title":"Installieren Sie mailcow mit Mailman Integration","text":"","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#installieren-sie-mailcow","level":4,"title":"Installieren Sie mailcow","text":"<p>Folgen Sie der mailcow installation. Schritt 5 auslassen und nicht mit starten!</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#mailcow-konfigurieren","level":4,"title":"mailcow konfigurieren","text":"<p>Dies ist auch Schritt 4 in der offiziellen mailcow-Installation (<code>nano mailcow.conf</code>). Passen Sie also Ihre Bedürfnisse an und ändern Sie die folgenden Variablen:</p> <pre><code>HTTP_PORT=18080 # verwenden Sie nicht 8080, da mailman es braucht\nHTTP_BIND=127.0.0.1 #\nHTTPS_PORT=18443 # Sie können 8443 verwenden\nHTTPS_BIND=127.0.0.1 # # HTTPS_BIND=127.0.0.1\n\nSKIP_LETS_ENCRYPT=y # Der Reverse Proxy wird die SSL-Verifizierung durchführen\n\nSNAT_TO_SOURCE=1.2.3.4 # ändern Sie dies in Ihre IPv4\nSNAT6_TO_SOURCE=dead:beef # Ändern Sie dies in Ihre globale IPv6\n</code></pre>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#mailman-integration-hinzufugen","level":4,"title":"Mailman-Integration hinzufügen","text":"<p>Erstelle die Datei <code>/opt/mailcow-dockerized/docker-compose.override.yml</code> (z.B. mit <code>nano</code>) und füge die folgenden Zeilen hinzu:</p> <pre><code>services:\n  postfix-mailcow:\n    volumes:\n      - /opt/mailman:/opt/mailman\n    networks:\n      - docker-mailman_mailman\n\nnetworks:\n  docker-mailman_mailman:\n    external: true\n</code></pre> <p>Das zusätzliche Volume wird von Mailman verwendet, um zusätzliche Konfigurationsdateien für mailcow postfix zu generieren. Das externe Netzwerk wird von Mailman erstellt und verwendet. mailcow benötigt es, um eingehende Listenmails an Mailman zu liefern.</p> <p>Erstellen Sie die Datei <code>/opt/mailcow-dockerized/data/conf/postfix/extra.cf</code> (z.B. mit <code>nano</code>) und fügen Sie die folgenden Zeilen hinzu:</p> <pre><code># mailman\n\nrecipient_delimiter = +\nunknown_local_recipient_reject_code = 550\nowner_request_special = no\n\nlocal_recipient_maps =\n  regexp:/opt/mailman/core/var/data/postfix_lmtp,\n  proxy:unix:passwd.byname,\n  $alias_maps\nvirtual_mailbox_maps =\n  proxy:mysql:/opt/postfix/conf/sql/mysql_virtual_mailbox_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_lmtp\ntransport_maps =\n  pcre:/opt/postfix/conf/custom_transport.pcre,\n  pcre:/opt/postfix/conf/local_transport,\n  proxy:mysql:/opt/postfix/conf/sql/mysql_relay_ne.cf,\n  proxy:mysql:/opt/postfix/conf/sql/mysql_transport_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_lmtp\nrelay_domains =\n  proxy:mysql:/opt/postfix/conf/sql/mysql_virtual_relay_domain_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_domains\nrelay_recipient_maps =\n  proxy:mysql:/opt/postfix/conf/sql/mysql_relay_recipient_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_lmtp\n</code></pre> <p>Da wir hier die mailcow postfix Konfiguration überschreiben, kann dieser Schritt Ihre normalen Mailtransporte unterbrechen. Überprüfen Sie die originalen Konfigurationsdateien, wenn sich etwas geändert hat.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#ssl-zertifikate","level":4,"title":"SSL-Zertifikate","text":"<p>Da wir mailcow als Proxy verwenden, müssen wir die SSL-Zertifikate in die mailcow-Dateistruktur kopieren. Diese Aufgabe wird das Skript renew-ssl.sh für uns erledigen:</p> <ul> <li>Kopieren Sie die Datei nach <code>/opt/mailcow-dockerized</code></li> <li>Ändere mailcow_HOSTNAME in deinen mailcow Hostnamen</li> <li>Machen Sie es ausführbar (<code>chmod a+x renew-ssl.sh</code>)</li> <li>Noch nicht ausführen, da wir zuerst Mailman benötigen</li> </ul> <p>Sie müssen einen cronjob erstellen, so dass neue Zertifikate kopiert werden. Führen Sie ihn als root oder sudo aus:</p> <pre><code>crontab -e\n</code></pre> <p>Um das Skript jeden Tag um 5 Uhr morgens laufen zu lassen, fügen Sie hinzu:</p> <pre><code>0 5 * * * /opt/mailcow-dockerized/renew-ssl.sh\n</code></pre>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#installieren-sie-mailman","level":3,"title":"Installieren Sie Mailman.","text":"<p>Befolgen Sie im Wesentlichen die Anweisungen unter docker-mailman. Da sie sehr umfangreich sind, ist hier in aller Kürze beschrieben, was zu tun ist:</p> <p>Als root oder sudo:</p> <pre><code>cd /opt\nmkdir -p mailman/core\nmkdir -p mailman/web\ngit clone https://github.com/maxking/docker-mailman\ncd docker-mailman\n</code></pre>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#mailman-konfigurieren","level":4,"title":"Mailman konfigurieren","text":"<p>Erstellen Sie einen langen Schlüssel für Hyperkitty, z.B. mit dem Linux-Befehl <code>cat /dev/urandom | tr -dc a-zA-Z0-9 | head -c30; echo</code>. Speichern Sie diesen Schlüssel vorerst als HYPERKITTY_KEY.</p> <p>Erstellen Sie ein langes Passwort für die Datenbank, z. B. mit dem Linux-Befehl <code>cat /dev/urandom | tr -dc a-zA-Z0-9 | head -c30; echo</code>. Speichern Sie dieses Passwort zunächst als DBPASS.</p> <p>Erstellen Sie einen langen Schlüssel für Django, z. B. mit dem Linux-Befehl <code>cat /dev/urandom | tr -dc a-zA-Z0-9 | head -c30; echo</code>. Speichern Sie diesen Schlüssel für einen Moment als DJANGO_KEY.</p> <p>Erstellen Sie die Datei <code>/opt/docker-mailman/docker compose.override.yaml</code> und ersetzen Sie <code>HYPERKITTY_KEY</code>, <code>DBPASS</code> und <code>DJANGO_KEY</code> durch die generierten Werte:</p> <pre><code>services:\n  mailman-core:\n    environment:\n    - DATABASE_URL=postgresql://mailman:DBPASS@database/mailmandb\n    - HYPERKITTY_API_KEY=HYPERKITTY_KEY\n    - TZ=Europe/Berlin\n    - MTA=postfix\n    restart: always\n    networks:\n      - mailman\n\n  mailman-web:\n    environment:\n    - DATABASE_URL=postgresql://mailman:DBPASS@database/mailmandb\n    - HYPERKITTY_API_KEY=HYPERKITTY_KEY\n    - TZ=Europe/Berlin\n    - SECRET_KEY=DJANGO_KEY\n    - SERVE_FROM_DOMAIN=MAILMAN_DOMAIN # e.g. lists.example.org\n    - MAILMAN_ADMIN_USER=admin # the admin user\n    - MAILMAN_ADMIN_EMAIL=admin@example.org # the admin mail address\n    - UWSGI_STATIC_MAP=/static=/opt/mailman-web-data/static\n    restart: always\n\n  database:\n    environment:\n    - POSTGRES_PASSWORD=DBPASS\n    restart: always\n</code></pre> <p>Bei <code>mailman-web</code> geben Sie die korrekten Werte für <code>SERVE_FROM_DOMAIN</code> (z.B. <code>lists.example.org</code>), <code>MAILMAN_ADMIN_USER</code> und <code>MAILMAN_ADMIN_EMAIL</code> ein. Sie benötigen die Admin-Zugangsdaten, um sich in der Web-Oberfläche (Pistorius) anzumelden. Um das Passwort zum ersten Mal zu setzen, verwenden Sie die Funktion Passwort vergessen im Webinterface.</p> <p>Über andere Konfigurationsoptionen lesen Sie die Dokumentationen Mailman-web und Mailman-core.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#konfigurieren-sie-mailman-core-und-mailman-web","level":4,"title":"Konfigurieren Sie Mailman core und Mailman web","text":"<p>Erstellen Sie die Datei <code>/opt/mailman/core/mailman-extra.cfg</code> mit dem folgenden Inhalt. <code>mailman@example.org</code> sollte auf ein gültiges Postfach oder eine Umleitung verweisen.</p> <pre><code>[mailman]\ndefault_language: de\nsite_owner: mailman@example.org\n</code></pre> <p>Erstellen Sie die Datei <code>/opt/mailman/web/settings_local.py</code> mit dem folgenden Inhalt. <code>mailman@example.org</code> sollte auf ein gültiges Postfach oder eine Umleitung verweisen.</p> <p><pre><code># Gebietsschema\nLANGUAGE_CODE = 'de-de'\n\n# soziale Authentifizierung deaktivieren\nMAILMAN_WEB_SOCIAL_AUTH = []\n\n# ändern\nDEFAULT_FROM_EMAIL = 'mailman@example.org'\n\nDEBUG = False\n</code></pre> Sie können <code>LANGUAGE_CODE</code> und <code>SOCIALACCOUNT_PROVIDERS</code> an Ihre Bedürfnisse anpassen.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#ausfuhren","level":3,"title":"🏃 Ausführen","text":"<p>Ausführen (als root oder sudo)</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>a2ensite mailcow.conf\na2ensite mailman.conf\nsystemctl restart apache2\n\ncd /opt/docker-mailman\ndocker compose pull\ndocker compose up -d\n\ncd /opt/mailcow-dockerized/\ndocker compose pull\n./renew-ssl.sh\n</code></pre> <pre><code>a2ensite mailcow.conf\na2ensite mailman.conf\nsystemctl restart apache2\n\ncd /opt/docker-mailman\ndocker-compose pull\ndocker-compose up -d\n\ncd /opt/mailcow-dockerized/\ndocker-compose pull\n./renew-ssl.sh\n</code></pre> <p>Warten Sie ein paar Minuten! Die Container müssen ihre Datenbanken und Konfigurationsdateien erstellen. Dies kann bis zu 1 Minute und mehr dauern.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#bemerkungen","level":2,"title":"Bemerkungen","text":"","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#neue-listen-werden-von-postfix-nicht-sofort-erkannt","level":3,"title":"Neue Listen werden von Postfix nicht sofort erkannt","text":"<p>Wenn man eine neue Liste anlegt und versucht, sofort eine E-Mail zu versenden, antwortet postfix mit <code>Benutzer existiert nicht</code>, weil postfix die Liste noch nicht an Mailman übergeben hat. Die Konfiguration unter <code>/opt/mailman/core/var/data/postfix_lmtp</code> wird nicht sofort aktualisiert. Wenn Sie die Liste sofort benötigen, starten Sie postifx manuell neu:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ndocker compose restart postfix-mailcow\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ndocker-compose restart postfix-mailcow\n</code></pre>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#update","level":2,"title":"Update","text":"<p>mailcow hat sein eigenes Update-Skript in <code>/opt/mailcow-dockerized/update.sh</code>, siehe die Dokumentation.</p> <p>Für Mailman holen Sie sich einfach die neueste Version aus dem github repository.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#sicherung","level":2,"title":"Sicherung","text":"<p>mailcow hat ein eigenes Backup-Skript. Lies die Docs für weitere Informationen.</p> <p>Mailman gibt keine Backup-Anweisungen in der README.md an. Im gitbucket von pgollor befindet sich ein Skript, das hilfreich sein könnte.</p>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#todo","level":2,"title":"ToDo","text":"","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.de/#skript-installieren","level":3,"title":"Skript installieren","text":"<p>Schreiben Sie ein Skript wie in mailman-mailcow-integration/mailman-install.sh, da viele der Schritte automatisierbar sind.</p> <ol> <li>Fragen Sie alle Konfigurationsvariablen ab und erstellen Sie Passwörter und Schlüssel.</li> <li>Führen Sie eine (halb)automatische Installation durch.</li> <li>Viel Spaß!</li> </ol>","path":["Installation von mailcow und Mailman 3 auf der Basis von dockerisierten Versionen"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/","level":1,"title":"Installing mailcow and Mailman 3 based on dockerized versions","text":"<p>Info</p> <p>This guide is a copy from dockerized-mailcow-mailman. Please post issues, questions and improvements in the issue tracker there.</p> <p>Warning</p> <p>mailcow is not responsible for any data loss, hardware damage or broken keyboards. This guide comes without any warranty. Make backups before starting, 'coze: No backup no pity!</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#introduction","level":2,"title":"Introduction","text":"<p>This guide aims to install and configure mailcow-dockerized with docker-mailman and to provide some useful scripts. An essential condition is, to preserve mailcow and Mailman in their own installations for independent updates.</p> <p>There are some guides and projects on the internet, but they are not up to date and/or incomplete in documentation or configuration. This guide is based on the work of:</p> <ul> <li>mailcow-mailman3-dockerized by Shadowghost</li> <li>mailman-mailcow-integration</li> </ul> <p>After finishing this guide, mailcow-dockerized and docker-mailman will run and Apache as a reverse proxy will serve the web frontends.</p> <p>The operating system used is an Ubuntu 20.04 LTS.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#installation","level":2,"title":"Installation","text":"<p>This guide is based on different steps:</p> <ol> <li>DNS setup</li> <li>Install Apache as a reverse proxy</li> <li>Obtain SSL certificates with Let's Encrypt</li> <li>Install mailcow with Mailman integration</li> <li>Install Mailman</li> <li>🏃 Run</li> </ol>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#dns-setup","level":3,"title":"DNS setup","text":"<p>Most of the configuration is covered by mailcows DNS setup. After finishing this setup add another subdomain for Mailman, e.g. <code>lists.example.org</code> that points to the same server:</p> <pre><code># Name    Type       Value\nlists     IN A       1.2.3.4\nlists     IN AAAA    dead:beef\n</code></pre>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#install-apache-as-a-reverse-proxy","level":3,"title":"Install Apache as a reverse proxy","text":"<p>Install Apache, e.g. with this guide from Digital Ocean: How To Install the Apache Web Server on Ubuntu 20.04.</p> <p>Activate certain Apache modules (as root or sudo):</p> <pre><code>a2enmod rewrite proxy proxy_http headers ssl wsgi proxy_uwsgi http2\n</code></pre> <p>Maybe you have to install further packages to get these modules. This PPA by Ondřej Surý may help you.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#vhost-configuration","level":4,"title":"vHost configuration","text":"<p>Copy the mailcow.conf and the mailman.conf in the Apache conf folder <code>sites-available</code> (e.g. under <code>/etc/apache2/sites-available</code>).</p> <p>Change in <code>mailcow.conf</code>: - <code>MAILCOW_HOSTNAME</code> to your MAILCOW_HOSTNAME</p> <p>Change in <code>mailman.conf</code>: - <code>MAILMAN_DOMAIN</code> to your Mailman domain (e.g. <code>lists.example.org</code>)</p> <p>Don't activate the configuration, as the ssl certificates and directories are missing yet.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#obtain-ssl-certificates-with-lets-encrypt","level":3,"title":"Obtain SSL certificates with Let's Encrypt","text":"<p>Check if your DNS config is available over the internet and points to the right IP addresses, e.g. with MXToolBox:</p> <ul> <li>https://mxtoolbox.com/SuperTool.aspx?action=a%3aMAILCOW_HOSTNAME</li> <li>https://mxtoolbox.com/SuperTool.aspx?action=aaaa%3aMAILCOW_HOSTNAME</li> <li>https://mxtoolbox.com/SuperTool.aspx?action=a%3aMAILMAN_DOMAIN</li> <li>https://mxtoolbox.com/SuperTool.aspx?action=aaaa%3aMAILMAN_DOMAIN</li> </ul> <p>Install certbot (as root or sudo):</p> <pre><code>apt install certbot\n</code></pre> <p>Get the desired certificates (as root or sudo):</p> <pre><code>certbot certonly -d MAILCOW_HOSTNAME\ncertbot certonly -d MAILMAN_DOMAIN\n</code></pre>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#install-mailcow-with-mailman-integration","level":3,"title":"Install mailcow with Mailman integration","text":"","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#install-mailcow","level":4,"title":"Install mailcow","text":"<p>Follow the mailcow installation. Omit step 5 and do not pull and start!</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#configure-mailcow","level":4,"title":"Configure mailcow","text":"<p>This is also Step 4 in the official mailcow installation (<code>nano mailcow.conf</code>). So change to your needs and alter the following variables:</p> <pre><code>HTTP_PORT=18080            # don't use 8080 as mailman needs it\nHTTP_BIND=127.0.0.1        #\nHTTPS_PORT=18443           # you may use 8443\nHTTPS_BIND=127.0.0.1       #\n\nSKIP_LETS_ENCRYPT=y        # reverse proxy will do the SSL termination\n\nSNAT_TO_SOURCE=1.2.3.4     # change this to your IPv4\nSNAT6_TO_SOURCE=dead:beef  # change this to your global IPv6\n</code></pre>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#add-mailman-integration","level":4,"title":"Add Mailman integration","text":"<p>Create the file <code>/opt/mailcow-dockerized/docker-compose.override.yml</code> (e.g. with <code>nano</code>) and add the following lines:</p> <p><pre><code>services:\n  postfix-mailcow:\n    volumes:\n      - /opt/mailman:/opt/mailman\n    networks:\n      - docker-mailman_mailman\n\nnetworks:\n  docker-mailman_mailman:\n    external: true\n</code></pre> The additional volume is used by Mailman to generate additional config files for mailcow postfix. The external network is build and used by Mailman. mailcow needs it to deliver incoming list mails to Mailman.</p> <p>Create the file <code>/opt/mailcow-dockerized/data/conf/postfix/extra.cf</code> (e.g. with <code>nano</code>) and add the following lines:</p> <p><pre><code># mailman\n\nrecipient_delimiter = +\nunknown_local_recipient_reject_code = 550\nowner_request_special = no\n\nlocal_recipient_maps =\n  regexp:/opt/mailman/core/var/data/postfix_lmtp,\n  proxy:unix:passwd.byname,\n  $alias_maps\nvirtual_mailbox_maps =\n  proxy:mysql:/opt/postfix/conf/sql/mysql_virtual_mailbox_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_lmtp\ntransport_maps =\n  pcre:/opt/postfix/conf/custom_transport.pcre,\n  pcre:/opt/postfix/conf/local_transport,\n  proxy:mysql:/opt/postfix/conf/sql/mysql_relay_ne.cf,\n  proxy:mysql:/opt/postfix/conf/sql/mysql_transport_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_lmtp\nrelay_domains =\n  proxy:mysql:/opt/postfix/conf/sql/mysql_virtual_relay_domain_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_domains\nrelay_recipient_maps =\n  proxy:mysql:/opt/postfix/conf/sql/mysql_relay_recipient_maps.cf,\n  regexp:/opt/mailman/core/var/data/postfix_lmtp\n</code></pre> As we overwrite mailcow postfix configuration here, this step may break your normal mail transports. Check the original configuration files if anything changed.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#ssl-certificates","level":4,"title":"SSL certificates","text":"<p>As we proxying mailcow, we need to copy the SSL certificates into the mailcow file structure. This task will do the script renew-ssl.sh for us:</p> <ul> <li>Copy the file to <code>/opt/mailcow-dockerized</code></li> <li>Change mailcow_HOSTNAME to your mailcow hostname</li> <li>Make it executable (<code>chmod a+x renew-ssl.sh</code>)</li> <li>Do not run it yet, as we first need Mailman</li> </ul> <p>You have to create a cronjob, so that new certificates will be copied. Execute as root or sudo:</p> <pre><code>crontab -e\n</code></pre> <p>To run the script every day at 5am, add:</p> <pre><code>0   5  *   *   *     /opt/mailcow-dockerized/renew-ssl.sh\n</code></pre>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#install-mailman","level":3,"title":"Install Mailman","text":"<p>Basicly follow the instructions at docker-mailman. As they are a lot, here is in a nuthshell what to do:</p> <p>As root or sudo:</p> <pre><code>cd /opt\nmkdir -p mailman/core\nmkdir -p mailman/web\ngit clone https://github.com/maxking/docker-mailman\ncd docker-mailman\n</code></pre>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#configure-mailman","level":4,"title":"Configure Mailman","text":"<p>Create a long key for Hyperkitty, e.g. with the linux command <code>cat /dev/urandom | tr -dc a-zA-Z0-9 | head -c30; echo</code>. Save this key for a moment as HYPERKITTY_KEY.</p> <p>Create a long password for the database, e.g. with the linux command <code>cat /dev/urandom | tr -dc a-zA-Z0-9 | head -c30; echo</code>. Save this password for a moment as DBPASS.</p> <p>Create a long key for Django, e.g. with the linux command <code>cat /dev/urandom | tr -dc a-zA-Z0-9 | head -c30; echo</code>. Save this key for a moment as DJANGO_KEY.</p> <p>Create the file <code>/opt/docker-mailman/docker compose.override.yaml</code> and replace <code>HYPERKITTY_KEY</code>, <code>DBPASS</code> and <code>DJANGO_KEY</code> with the generated values:</p> <pre><code>services:\n  mailman-core:\n    environment:\n    - DATABASE_URL=postgresql://mailman:DBPASS@database/mailmandb\n    - HYPERKITTY_API_KEY=HYPERKITTY_KEY\n    - TZ=Europe/Berlin\n    - MTA=postfix\n    restart: always\n    networks:\n      - mailman\n\n  mailman-web:\n    environment:\n    - DATABASE_URL=postgresql://mailman:DBPASS@database/mailmandb\n    - HYPERKITTY_API_KEY=HYPERKITTY_KEY\n    - TZ=Europe/Berlin\n    - SECRET_KEY=DJANGO_KEY\n    - SERVE_FROM_DOMAIN=MAILMAN_DOMAIN # e.g. lists.example.org\n    - MAILMAN_ADMIN_USER=admin # the admin user\n    - MAILMAN_ADMIN_EMAIL=admin@example.org # the admin mail address\n    - UWSGI_STATIC_MAP=/static=/opt/mailman-web-data/static\n    restart: always\n\n  database:\n    environment:\n    - POSTGRES_PASSWORD=DBPASS\n    restart: always\n</code></pre> <p>At <code>mailman-web</code> fill in correct values for <code>SERVE_FROM_DOMAIN</code> (e.g. <code>lists.example.org</code>), <code>MAILMAN_ADMIN_USER</code> and <code>MAILMAN_ADMIN_EMAIL</code>. You need the admin credentials to log into the web interface (Postorius). For setting the password for the first time use the Forgot password function in the web interface.</p> <p>About other configuration options read Mailman-web and Mailman-core documentation.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#configure-mailman-core-and-mailman-web","level":4,"title":"Configure Mailman core and Mailman web","text":"<p>Create the file <code>/opt/mailman/core/mailman-extra.cfg</code> with the following content. <code>mailman@example.org</code> should be pointing to a valid mail box or redirection.</p> <pre><code>[mailman]\ndefault_language: de\nsite_owner: mailman@example.org\n</code></pre> <p>Create the file <code>/opt/mailman/web/settings_local.py</code> with the following content. <code>mailman@example.org</code> should be pointing to a valid mail box or redirection.</p> <p><pre><code># locale\nLANGUAGE_CODE = 'de-de'\n\n# disable social authentication\nMAILMAN_WEB_SOCIAL_AUTH = []\n\n# change it\nDEFAULT_FROM_EMAIL = 'mailman@example.org'\n\nDEBUG = False\n</code></pre> You can change <code>LANGUAGE_CODE</code> and <code>SOCIALACCOUNT_PROVIDERS</code> to your needs.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#run","level":3,"title":"🏃 Run","text":"<p>Run (as root or sudo)</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>a2ensite mailcow.conf\na2ensite mailman.conf\nsystemctl restart apache2\n\ncd /opt/docker-mailman\ndocker compose pull\ndocker compose up -d\n\ncd /opt/mailcow-dockerized/\ndocker compose pull\n./renew-ssl.sh\n</code></pre> <pre><code>a2ensite mailcow.conf\na2ensite mailman.conf\nsystemctl restart apache2\n\ncd /opt/docker-mailman\ndocker-compose pull\ndocker-compose up -d\n\ncd /opt/mailcow-dockerized/\ndocker-compose pull\n./renew-ssl.sh\n</code></pre> <p>Wait a few minutes! The containers have to create there databases and config files. This can last up to 1 minute and more.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#remarks","level":2,"title":"Remarks","text":"","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#new-lists-arent-recognized-by-postfix-instantly","level":3,"title":"New lists aren't recognized by postfix instantly","text":"<p>When you create a new list and try to immediately send an e-mail, postfix responses with <code>User doesn't exist</code>, because postfix won't deliver it to Mailman yet. The configuration at <code>/opt/mailman/core/var/data/postfix_lmtp</code> is not instantly updated. If you need the list instantly, restart postifx manually:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd /opt/mailcow-dockerized\ndocker compose restart postfix-mailcow\n</code></pre> <pre><code>cd /opt/mailcow-dockerized\ndocker-compose restart postfix-mailcow\n</code></pre>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#update","level":2,"title":"Update","text":"<p>mailcow has it's own update script in <code>/opt/mailcow-dockerized/update.sh</code>, see the docs.</p> <p>For Mailman just fetch the newest version from the github repository.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#backup","level":2,"title":"Backup","text":"<p>mailcow has an own backup script. Read the docs for further informations.</p> <p>Mailman won't state backup instructions in the README.md. In the gitbucket of pgollor is a script that may be helpful.</p>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#todo","level":2,"title":"ToDo","text":"","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailman3/third_party-mailman3.en/#install-script","level":3,"title":"install script","text":"<p>Write a script like in mailman-mailcow-integration/mailman-install.sh as many of the steps are automatable.</p> <ol> <li>Ask for all the configuration variables and create passwords and keys.</li> <li>Do a (semi-)automatic installation.</li> <li>Have fun!</li> </ol>","path":["Installing mailcow and Mailman 3 based on dockerized versions"],"tags":[]},{"location":"third_party/mailpiler/third_party-mailpiler_integration.de/","level":1,"title":"Third party mailpiler integration.de","text":"<p>Dies ist eine einfache Integration von mailcow-Aliasen und dem Mailbox-Namen in mailpiler bei Verwendung von IMAP-Authentifizierung.</p> <p>Disclaimer: Dies wird weder offiziell vom mailcow-Projekt noch von seinen Mitwirkenden gepflegt oder unterstützt. Es wird keine Garantie oder Unterstützung angeboten, jedoch steht es Ihnen frei, Themen auf GitHub zu öffnen, um einen Fehler zu melden oder weitere Ideen zu liefern. GitHub Repo kann hier gefunden werden.</p> <p>Info</p> <p>Die Unterstützung für Domain Wildcards wurde in Piler 1.3.10 implementiert, das am 03.01.2021 veröffentlicht wurde. Frühere Versionen funktionieren grundsätzlich, aber nach dem Einloggen sehen Sie keine E-Mails, die von oder an den Domain-Alias gesendet werden. (z.B. wenn @example.com ein Alias für admin@example.com ist)</p>","path":["Third party mailpiler integration.de"],"tags":[]},{"location":"third_party/mailpiler/third_party-mailpiler_integration.de/#das-zu-losende-problem","level":2,"title":"Das zu lösende Problem","text":"<p>mailpiler bietet die Authentifizierung auf Basis von IMAP an, zum Beispiel:</p> <pre><code>$config['ENABLE_IMAP_AUTH'] = 1;\n$config['IMAP_HOST'] = 'mail.example.com';\n$config['IMAP_PORT'] = 993;\n$config['IMAP_SSL'] = true;\n</code></pre> <ul> <li>Wenn Sie sich also mit <code>patrik@example.com</code> anmelden, sehen Sie nur zugestellte E-Mails, die von oder an diese spezielle E-Mail-Adresse gesendet wurden.</li> <li>Wenn zusätzliche Aliase in mailcow definiert werden, wie z.B. <code>team@example.com</code>, werden Sie keine Emails sehen, die an oder von dieser Email-Adresse gesendet wurden, auch wenn Sie ein Empfänger von Emails sind, die an diese Alias-Adresse gesendet wurden.</li> </ul> <p>Indem wir uns in den Authentifizierungsprozess von mailpiler einklinken, sind wir in der Lage, die erforderlichen Daten über die mailcow API während des Logins zu erhalten. Dies löst API-Anfragen an die mailcow-API aus (die einen Nur-Lese-API-Zugang erfordern), um die Aliase auszulesen, an denen Ihre E-Mail-Adresse teilnimmt, und auch den \"Namen\" des Postfachs, der angegeben wurde, um ihn nach dem Login oben rechts in mailpiler anzuzeigen.</p> <p>Zugelassene E-Mail-Adressen können in den Mailpiler-Einstellungen oben rechts nach dem Einloggen eingesehen werden.</p> <p>Info</p> <p>Dies wird nur einmal während des Authentifizierungsprozesses abgefragt. Die autorisierten Aliase und der Realname sind für die gesamte Dauer der Benutzersitzung gültig, da mailpiler sie in den Sitzungsdaten setzt. Wird ein Benutzer aus einem bestimmten Alias entfernt, so wird dies erst nach dem nächsten Login wirksam.</p>","path":["Third party mailpiler integration.de"],"tags":[]},{"location":"third_party/mailpiler/third_party-mailpiler_integration.de/#die-losung","level":2,"title":"Die Lösung","text":"<p>Hinweis: Die Dateipfade können je nach Einrichtung variieren.</p>","path":["Third party mailpiler integration.de"],"tags":[]},{"location":"third_party/mailpiler/third_party-mailpiler_integration.de/#voraussetzungen","level":3,"title":"Voraussetzungen","text":"<ul> <li>Eine funktionierende mailcow-Instanz</li> <li>Eine funktionierende mailpiler Instanz (Sie finden eine Installationsanleitung hier, überprüfen Sie unterstützte Versionen hier)</li> <li>Ein mailcow API-Schlüssel (Nur-Lesen funktioniert): <code>Konfiguration &amp; Details - Zugang - Nur-Lesen-Zugang</code>. Vergessen Sie nicht, den API-Zugang von Ihrer mailpiler IP zu erlauben.</li> </ul> <p>Warnung</p> <p>Da mailpiler sich gegenüber mailcow, unserem IMAP-Server, authentifiziert, können fehlgeschlagene Logins von Nutzern oder Bots eine Sperre für Ihre mailpiler-Instanz auslösen. Daher sollten Sie in Erwägung ziehen, die IP-Adresse der mailpiler-Instanz innerhalb von mailcow auf eine Whitelist zu setzen: <code>Konfiguration &amp; Details - Konfiguration - Fail2ban-Parameter - Whitelisted networks/hosts</code>.</p>","path":["Third party mailpiler integration.de"],"tags":[]},{"location":"third_party/mailpiler/third_party-mailpiler_integration.de/#einrichtung","level":3,"title":"Einrichtung","text":"<ol> <li> <p>Setzen Sie die benutzerdefinierte Abfragefunktion von mailpiler und fügen Sie diese an <code>/usr/local/etc/piler/config-site.php</code> an:</p> <pre><code>$config['MAILCOW_API_KEY'] = 'YOUR_READONLY_API_KEY';\n$config['MAILCOW_SET_REALNAME'] = true; // wenn nicht angegeben, dann ist der Standardwert false\n$config['CUSTOM_EMAIL_QUERY_FUNCTION'] = 'query_mailcow_for_email_access';\ninclude('auth-mailcow.php');\n</code></pre> <p>Sie können auch den mailcow-Hostnamen ändern, falls erforderlich: <pre><code>$config['MAILCOW_HOST'] = 'mail.domain.tld'; // standardmäßig $config['IMAP_HOST']\n</code></pre></p> </li> <li> <p>Laden Sie die PHP-Datei mit den Funktionen aus dem GitHub Repo herunter:</p> <pre><code>curl -o /usr/local/etc/piler/auth-mailcow.php https://raw.githubusercontent.com/patschi/mailpiler-mailcow-integration/master/auth-mailcow.php\n</code></pre> </li> <li> <p>Erledigt!</p> </li> </ol> <p>Stellen Sie sicher, dass Sie sich erneut mit Ihren IMAP-Zugangsdaten anmelden, damit die Änderungen wirksam werden.</p> <p>Wenn es nicht funktioniert, ist höchstwahrscheinlich etwas mit der API-Abfrage selbst nicht in Ordnung. Versuchen Sie eine Fehlersuche, indem Sie manuelle API-Anfragen an die API senden. (Tipp: Öffnen Sie <code>https://mail.domain.tld/api</code> auf Ihrer Instanz)</p>","path":["Third party mailpiler integration.de"],"tags":[]},{"location":"third_party/mailpiler/third_party-mailpiler_integration.en/","level":1,"title":"Third party mailpiler integration.en","text":"<p>This is a simple integration of mailcow aliases and the mailbox name into mailpiler when using IMAP authentication.</p> <p>Disclaimer: This is not officially maintained nor supported by the mailcow project nor its contributors. No warranty or support is being provided, however you're free to open issues on GitHub for filing a bug or provide further ideas. GitHub repo can be found here.</p> <p>Info</p> <p>Support for domain wildcards were implemented in Piler 1.3.10 which was released on 03.01.2021. Prior versions basically do work, but after logging in you won't see emails sent from or to the domain alias. (e.g. when @example.com is an alias for admin@example.com)</p>","path":["Third party mailpiler integration.en"],"tags":[]},{"location":"third_party/mailpiler/third_party-mailpiler_integration.en/#the-problem-to-solve","level":2,"title":"The problem to solve","text":"<p>mailpiler offers the authentication based on IMAP, for example:</p> <pre><code>$config['ENABLE_IMAP_AUTH'] = 1;\n$config['IMAP_HOST'] = 'mail.example.com';\n$config['IMAP_PORT'] =  993;\n$config['IMAP_SSL'] = true;\n</code></pre> <ul> <li>So when you log in using <code>patrik@example.com</code>, you will only see delivered emails sent from or to this specific email address.</li> <li>When additional aliases are defined in mailcow, like <code>team@example.com</code>, you won't see emails sent to or from this email address even the fact you're a recipient of mails sent to this alias address.</li> </ul> <p>By hooking into the authentication process of mailpiler, we are able to get required data via the mailcow API during login. This fires API requests to the mailcow API (requiring read-only API access) to read out the aliases your email address participates and also the \"Name\" of the mailbox specified to display it on the top-right of mailpiler after login.</p> <p>Permitted email addresses can be seen in the mailpiler settings top-right after logging in.</p> <p>Info</p> <p>This is only pulled once during the authentication process. The authorized aliases and the realname are valid for the whole duration of the user session as mailpiler sets them in the session data. If user is removed from specific alias, this will only take effect after next login.</p>","path":["Third party mailpiler integration.en"],"tags":[]},{"location":"third_party/mailpiler/third_party-mailpiler_integration.en/#the-solution","level":2,"title":"The solution","text":"<p>Note: File paths might vary depending on your setup.</p>","path":["Third party mailpiler integration.en"],"tags":[]},{"location":"third_party/mailpiler/third_party-mailpiler_integration.en/#requirements","level":3,"title":"Requirements","text":"<ul> <li>A working mailcow instance</li> <li>A working mailpiler instance (You can find an installation guide here, check supported versions here)</li> <li>An mailcow API key (read-only works just fine): <code>Configuration &amp; Details - Access - Read-Only Access</code>. Don't forget to allow API access from your mailpiler IP.</li> </ul> <p>Warning</p> <p>As mailpiler authenticates against mailcow, our IMAP server, failed logins of users or bots might trigger a block for your mailpiler instance. Therefore you might want to consider whitelisting the IP address of the mailpiler instance within mailcow: <code>Configuration &amp; Details - Configuration - Fail2ban parameters - Whitelisted networks/hosts</code>.</p>","path":["Third party mailpiler integration.en"],"tags":[]},{"location":"third_party/mailpiler/third_party-mailpiler_integration.en/#setup","level":3,"title":"Setup","text":"<ol> <li> <p>Set the custom query function of mailpiler and append this to <code>/usr/local/etc/piler/config-site.php</code>:</p> <pre><code>$config['MAILCOW_API_KEY'] = 'YOUR_READONLY_API_KEY';\n$config['MAILCOW_SET_REALNAME'] = true; // when not specified, then default is false\n$config['CUSTOM_EMAIL_QUERY_FUNCTION'] = 'query_mailcow_for_email_access';\ninclude('auth-mailcow.php');\n</code></pre> <p>You can also change the mailcow hostname, if required: <pre><code>$config['MAILCOW_HOST'] = 'mail.domain.tld'; // defaults to $config['IMAP_HOST']\n</code></pre></p> </li> <li> <p>Download the PHP file with the functions from the GitHub repo:</p> <pre><code>curl -o /usr/local/etc/piler/auth-mailcow.php https://raw.githubusercontent.com/patschi/mailpiler-mailcow-integration/master/auth-mailcow.php\n</code></pre> </li> <li> <p>Done!</p> </li> </ol> <p>Make sure to re-login with your IMAP credentials for changes to take effect.</p> <p>If it doesn't work, most likely something's wrong with the API query itself. Consider debugging by sending manual API requests to the API. (Tip: Open <code>https://mail.domain.tld/api</code> on your instance)</p>","path":["Third party mailpiler integration.en"],"tags":[]},{"location":"third_party/nextcloud/third_party-nextcloud.de/","level":1,"title":"Third party nextcloud.de","text":"","path":["Third party nextcloud.de"],"tags":[]},{"location":"third_party/nextcloud/third_party-nextcloud.de/#nextcloud-mit-dem-helper-skript-verwalten","level":2,"title":"Nextcloud mit dem Helper-Skript verwalten","text":"<p>Deprecation Hinweis</p> <p>Diese Anleitung ist deprecated und betrifft das Nextcloud Helper-Skript, welches innerhalb mailcows gebündelt ist. Ab Dezember 2024 wird diese Installationsart aus mailcow entfernt und kein Support dafür geleistet. Sollten Sie noch besagte Installation nutzen, migrieren Sie ihre Nextcloud Installation in eine eigenständige Nextcloud Instanz (entweder auch per Docker oder Nativ).</p> <p>Die Anleitung für die Nutzung von mailcow als Authentifizierungsquelle innerhalb Nextcloud's wird auch nach der Entfernung des Skriptes im Dezember 2024 erhalten und funktional bleiben.</p> <p>Nextcloud kann mit dem helper script, das in mailcow enthalten ist, eingerichtet (Parameter <code>-i</code>) und entfernt (Parameter <code>-p</code>) werden. Um Nextcloud zu installieren, navigieren Sie einfach zu Ihrem mailcow-dockerized Root-Ordner und führen Sie das Helper-Skript wie folgt aus:</p> <p><code>./helper-scripts/nextcloud.sh -i</code></p> <p>Für den Fall, dass Sie das Passwort (z.B. für admin) vergessen haben und kein neues anfordern können [über den Passwort-Reset-Link auf dem Login-Bildschirm] (https://docs.nextcloud.com/server/20/admin_manual/configuration_user/reset_admin_password.html?highlight=reset), können Sie durch den Aufruf des Helper-Skripts mit <code>-r</code> als Parameter ein neues Passwort setzen. Verwenden Sie diese Option nur, wenn Ihre Nextcloud nicht so konfiguriert ist, dass Sie mailcow zur Authentifizierung verwendet, wie im nächsten Abschnitt beschrieben.</p> <p>Damit mailcow ein Zertifikat für die Nextcloud Domain generieren kann, muss die Domain unter welcher die Nextcloud später erreichbar sein soll als ADDITIONAL_SAN in die mailcow.conf hinzufügt werden und folgender Befehl zur Übernahme ausgeführt werden. </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Für weitere Informationen siehe: Erweitertes SSL.</p>","path":["Third party nextcloud.de"],"tags":[]},{"location":"third_party/nextcloud/third_party-nextcloud.de/#hintergrund-aufgaben","level":2,"title":"Hintergrund-Aufgaben","text":"<p>Zur Verwendung der empfohlenen Einstellung (Cron) zur Verarbeitung der Hintergrund-Aufgaben müssen in der <code>docker-compose.override.yml</code> folgende Zeilen  hinzugefügt werden:</p> <pre><code>services:\n  php-fpm-mailcow:\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.nextcloud-cron.schedule: \"@every 5m\"\n      ofelia.job-exec.nextcloud-cron.command: \"su www-data -s /bin/bash -c \\\"/usr/local/bin/php -f /web/nextcloud/cron.php\\\"\"\n</code></pre> <p>Zusätzlich muss eine bestimmte Funktion für den php-fpm Worker aktiviert werden. Tun Sie dies in dem Sie die Datei <code>data/conf/phpfpm/php-fpm.d/pools.conf</code> bearbeiten und <code>shell_exec</code> aus allen Punkten samt dem <code>,</code> entfernen.</p> <p>Nachdem die beiden Schritte erledigt wurden muss der folgende Befehl ausgeführt werden, um das Docker Image mit den entsprechenden Labels zu versehen und den Stack neuzustarten.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>Danach muss zudem der docker scheduler neu gestartet werden, um den neuen Job zu registrieren. Dazu wird der folgende Befehl ausgeführt. </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart ofelia-mailcow\n</code></pre> <pre><code>docker-compose restart ofelia-mailcow\n</code></pre> <p>Zur Überprüfung, ob die <code>ofelia</code> Konfiguration korrekt ist geladen wurde, kann mittels dem untenstehenden Befehl nach einer Zeile mit dem Inhalt  <code>New job registered \"nextcloud-cron\" - ...</code> gesucht werden:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs ofelia-mailcow\n</code></pre> <pre><code>docker-compose logs ofelia-mailcow\n</code></pre> <p>Hierdurch wird alle 5 Minuten die Hintergrundverarbeitung gestartet. Da die Ausführung selbst keine Ausgabe liefert, kann die korrekte Funktionsweise in den  Grundeinstellungen von Nextcloud überprüft werden. Hier wird automatisch mit der ersten Ausführung die Hintergrund-Aufgaben Verarbeitung auf <code>(X) Cron</code> gesetzt  und der Zeitstempel <code>Letzte Aufgabe ausgeführt</code> aktualisiert.</p>","path":["Third party nextcloud.de"],"tags":[]},{"location":"third_party/nextcloud/third_party-nextcloud.de/#konfigurieren-sie-nextcloud-um-mailcow-fur-die-authentifizierung-zu-verwenden","level":2,"title":"Konfigurieren Sie Nextcloud, um mailcow für die Authentifizierung zu verwenden","text":"<p>Im Folgenden wird beschrieben, wie die Authentifizierung über mailcow unter Verwendung des OAuth2-Protokolls eingerichtet wird. Wir nehmen nur an, dass Sie Nextcloud bereits unter cloud.example.com eingerichtet haben und dass Ihre mailcow unter mail.example.com läuft. Es spielt keine Rolle, wenn Ihre Nextcloud auf einem anderen Server läuft, Sie können immer noch mailcow für die Authentifizierung verwenden.</p> <p>1. Melden Sie sich bei mailcow als Administrator an.</p> <p>2. Klicken Sie im Dropdown Menü (oben rechts) auf Konfiguration.</p> <p>3. Wählen Sie dann im Reiter \"Zugang\" den Dropdown Punkt OAuth2 aus.</p> <p>4. Scrollen Sie nach unten und klicken Sie auf die Schaltfläche Füge OAuth2 Client hinzu. Geben Sie die Redirect URI als <code>https://cloud.example.com/index.php/apps/sociallogin/custom_oauth2/mailcow</code> an und klicken Sie auf Hinzufügen. Speichern Sie die Client-ID und das Geheimnis für später.</p> <p>Info</p> <p>Einige Installationen, einschließlich derer, die mit dem Helper-Skript von mailcow eingerichtet wurden, müssen index.php/ aus der URL entfernen, um einen erfolgreichen Redirect zu erhalten: <code>https://cloud.example.com/apps/sociallogin/custom_oauth2/mailcow</code></p> <p>3. Melden Sie sich bei Nextcloud als Administrator an.</p> <p>4. Klicken Sie auf die Schaltfläche in der oberen rechten Ecke und wählen Sie Apps. Klicken Sie auf die Schaltfläche \"Suchen\" in der Symbolleiste, suchen Sie nach dem Plugin Social Login und klicken Sie daneben auf Herunterladen und aktivieren.</p> <p>5. Klicken Sie auf die Schaltfläche in der oberen rechten Ecke und wählen Sie Einstellungen. Scrollen Sie zum Abschnitt Administration auf der linken Seite und klicken Sie auf Social Login.</p> <p>6. Entfernen Sie das Häkchen bei den folgenden Punkten:</p> <ul> <li>\"Automatische Erstellung neuer Benutzer deaktivieren\"</li> <li>\"Benutzern erlauben, soziale Logins mit ihren Konten zu verbinden\".</li> <li>\"Nicht verfügbare Benutzergruppen bei der Anmeldung nicht entfernen\"</li> <li>\"Gruppen automatisch erstellen, wenn sie nicht vorhanden sind\"</li> <li>\"Anmeldung für Benutzer ohne zugeordnete Gruppen einschränken\".</li> </ul> <p>7. Überprüfen Sie die folgenden Punkte:</p> <ul> <li>\"Die Erstellung eines Kontos verhindern, wenn die E-Mail-Adresse in einem anderen Konto existiert\"</li> <li>\"Benutzerprofil bei jeder Anmeldung aktualisieren\"</li> <li>\"Benachrichtigung der Administratoren über neue Benutzer deaktivieren\".</li> </ul> <p>Klicken Sie auf die Schaltfläche Speichern.</p> <p>8. Scrollen Sie nach unten zu Custom OAuth2 und klicken Sie auf die Schaltfläche +. 9. Konfigurieren Sie die Parameter wie folgt:</p> <ul> <li>Interner Name: <code>mailcow</code></li> <li>Titel: <code>mailcow</code></li> <li>API Basis-URL: <code>https://mail.example.com</code></li> <li>Autorisierungs-URL: <code>https://mail.example.com/oauth/authorize</code></li> <li>Token-URL: <code>https://mail.example.com/oauth/token</code></li> <li>Profil-URL: <code>https://mail.example.com/oauth/profile</code></li> <li>Abmelde-URL: (leer lassen)</li> <li>Kunden-ID: (die Sie in Schritt 1 erhalten haben)</li> <li>Client Secret: (was Sie in Schritt 1 erhalten haben)</li> <li>Bereich: <code>Profil</code></li> </ul> <p>Klicken Sie auf die Schaltfläche Speichern ganz unten auf der Seite.</p> <p>Wenn Sie bisher Nextcloud mit mailcow-Authentifizierung über user_external/IMAP verwendet haben, müssen Sie einige zusätzliche Schritte durchführen, um Ihre bestehenden Benutzerkonten mit OAuth2 zu verknüpfen.</p> <p>1. Klicken Sie auf die Schaltfläche in der oberen rechten Ecke und wählen Sie Apps. Scrollen Sie nach unten zur App Externe Benutzerauthentifizierung und klicken Sie daneben auf Entfernen.</p> <p>2. Führen Sie die folgenden Abfragen in Ihrer Nextcloud-Datenbank aus (wenn Sie Nextcloud mit dem Skript von mailcow einrichten, können Sie folgenden Befehl nutzen um in den Container zu gelangen)</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf &amp;&amp; docker compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>source mailcow.conf &amp;&amp; docker-compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>INSERT INTO oc_users (uid, uid_lower) SELECT DISTINCT uid, LOWER(uid) FROM oc_users_external;\nINSERT INTO oc_sociallogin_connect (uid, identifier) SELECT DISTINCT uid, CONCAT(\"mailcow-\", uid) FROM oc_users_external;\n</code></pre> <p>Wenn Sie Nextcloud bisher ohne mailcow-Authentifizierung, aber mit den gleichen Benutzernamen wie mailcow genutzt haben, können Sie Ihre bestehenden Benutzerkonten auch mit OAuth2 verknüpfen.</p> <p>1. Führen Sie die folgenden Abfragen in Ihrer Nextcloud-Datenbank aus (wenn Sie Nextcloud mit dem Skript von mailcow einrichten, können Sie folgenden Befehl nutzen um in den Container zu gelangen):</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf &amp;&amp; docker compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>source mailcow.conf &amp;&amp; docker-compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>INSERT INTO oc_sociallogin_connect (uid, identifier) SELECT DISTINCT uid, CONCAT(\"mailcow-\", uid) FROM oc_users;\n</code></pre>","path":["Third party nextcloud.de"],"tags":[]},{"location":"third_party/nextcloud/third_party-nextcloud.de/#aktualisieren","level":2,"title":"Aktualisieren","text":"<p>Die Nextcloud-Instanz kann einfach mit dem Web-Update-Mechanismus aktualisiert werden. Bei größeren Updates können nach dem Update weitere Änderungen vorgenommen werden. Nachdem die Nextcloud-Instanz geprüft wurde, werden Probleme angezeigt. Dies können z.B. fehlende Indizes in der DB oder ähnliches sein. Es wird angezeigt, welche Befehle ausgeführt werden müssen, diese müssen im php-fpm-mailcow Container platziert werden.</p> <p>Führen Sie z.B. folgenden Befehl aus, um die fehlenden Indizes hinzuzufügen:</p> <p><code>docker exec -it -u www-data $(docker ps -f name=php-fpm-mailcow -q) bash -c \"php /web/nextcloud/occ db:add-missing-indices\"</code></p> <p>Das Update kann bei Bedarf auch per CLI durchgeführt werden. Dies ist mit folgedem Befehl im interaktiven Modus möglich:</p> <p><code>docker exec -it -u www-data $(docker ps -f name=php-fpm-mailcow -q) bash -c \"php /web/nextcloud/updater/updater.phar\"</code></p> <p>Um das Update ohne Rückfragen auszuführen, z.B. durch einen CRON Job, kann folgender Befehl verwendet werden: </p> <p>Achtung</p> <p>Wir empfehlen dieses Vorgehen nicht! Es könnte über die Zeit kaputt gehen und irreperable Schäden an der Nextcloud Instanz erzeugen. NUTZUNG AUF EIGENE GEFAHR!!</p> <p><code>docker exec -it -u www-data $(docker ps -f name=php-fpm-mailcow -q) bash -c \"php /web/nextcloud/updater/updater.phar --no-interaction\"</code></p>","path":["Third party nextcloud.de"],"tags":[]},{"location":"third_party/nextcloud/third_party-nextcloud.de/#fehlersuche-und-fehlerbehebung","level":2,"title":"Fehlersuche und Fehlerbehebung","text":"<p>Es kann vorkommen, dass Sie die Nextcloud-Instanz von Ihrem Netzwerk aus nicht erreichen können. Dies kann daran liegen, dass der Eintrag Ihres Subnetzes im Array 'trusted_proxies' fehlt. Sie können Änderungen in der Nextcloud config.php in <code>data/web/nextcloud/config/*</code> vornehmen.</p> <pre><code>'trusted_proxies' =&gt;\n  array (\n    0 =&gt; 'fd4d:6169:6c63:6f77::/64',\n    1 =&gt; '172.22.1.0/24',\n    2 =&gt; 'NewSubnet/24',\n  ),\n</code></pre> <p>Nachdem die Änderungen vorgenommen wurden, muss der nginx-Container neu gestartet werden.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose restart nginx-mailcow\n</code></pre>","path":["Third party nextcloud.de"],"tags":[]},{"location":"third_party/nextcloud/third_party-nextcloud.en/","level":1,"title":"Third party nextcloud.en","text":"","path":["Third party nextcloud.en"],"tags":[]},{"location":"third_party/nextcloud/third_party-nextcloud.en/#manage-nextcloud-using-the-helper-script","level":2,"title":"Manage Nextcloud using the helper script","text":"<p>Deprecation notice</p> <p>This guide about the mailcow Nextcloud helper-script is deprecated. Until December 2024 this installationscript will be removed from mailcow and no further support will be granted. If you are using a Nextcloud installation based on this script you should migrate all your datas to a standalone Nextcloud instance (either inside Docker or natively) in the near future.</p> <p>The Authentication guide (below further) will still be intact after the script removal in December 2024.</p> <p>Nextcloud can be set up (parameter <code>-i</code>) and removed (parameter <code>-p</code>) with the helper script included with mailcow. In order to install Nextcloud simply navigate to your mailcow-dockerized root folder and run the helper script as follows:</p> <p><code>./helper-scripts/nextcloud.sh -i</code></p> <p>In case you have forgotten the password (e.g. for admin) and can't request a new one via the password reset link on the login screen calling the helper script with <code>-r</code> as parameter allows you to set a new password. Only use this option if your Nextcloud isn't configured to use mailcow for authentication as described in the next section.</p> <p>In order for mailcow to generate a a certificate for the nextcloud domain you need to add \"nextcloud.domain.tld\" to ADDITIONAL_SAN in mailcow.conf and runthe following to apply:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>For more informaton refer to: Advanced SSL.</p>","path":["Third party nextcloud.en"],"tags":[]},{"location":"third_party/nextcloud/third_party-nextcloud.en/#background-jobs","level":2,"title":"Background jobs","text":"<p>To use the recommended setting (cron) to execute the background jobs following lines need to be added to the <code>docker-compose.override.yml</code>:</p> <pre><code>services:\n  php-fpm-mailcow:\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.nextcloud-cron.schedule: \"@every 5m\"\n      ofelia.job-exec.nextcloud-cron.command: \"su www-data -s /bin/bash -c \\\"/usr/local/bin/php -f /web/nextcloud/cron.php\\\"\"\n</code></pre> <p>In addition, a specific function must be activated for the php-fpm worker. Do this by editing the file <code>data/conf/phpfpm/php-fpm.d/pools.conf</code> and removing <code>shell_exec</code> from all items including the <code>,</code>.</p> <p>After the two steps have been completed, the following command must be executed to provide the Docker image with the corresponding labels and restart the stack.</p> <p>After adding these lines the following command must be executed to update the docker image:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre> <p>And also the docker scheduler image must be restarted to pick up the new job definition by executing:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart ofelia-mailcow\n</code></pre> <pre><code>docker-compose restart ofelia-mailcow\n</code></pre> <p>To check if the job was successfully picked up by <code>ofelia</code> the command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs ofelia-mailcow\n</code></pre> <pre><code>docker-compose logs ofelia-mailcow\n</code></pre> <p>It should contain a line similar to <code>New job registered \"nextcloud-cron\" - ...</code>.</p> <p>By adding these lines the background jobs will be executed every 5 minutes. To verify that the execution works correctly, the only way is to see it in the basic  settings when logged in as an admin in Nextcloud. If everything is correct the first scheduled execution will change the background jobs processing setting to  <code>(X) Cron</code> and the timestamp after <code>Last job ran</code> will be updated every 5 minutes.</p>","path":["Third party nextcloud.en"],"tags":[]},{"location":"third_party/nextcloud/third_party-nextcloud.en/#configure-nextcloud-to-use-mailcow-for-authentication","level":2,"title":"Configure Nextcloud to use mailcow for authentication","text":"<p>The following describes how set up authentication via mailcow using the OAuth2 protocol. We will only assume that you have already set up Nextcloud at cloud.example.com and that your mailcow is running at mail.example.com. It does not matter if your Nextcloud is running on a different server, you can still use mailcow for authentication.</p> <p>1. Log into mailcow as administrator.</p> <p>2. Click Configuration in the drop-down menu (top right).</p> <p>3. Then, in the \"Access\" tab, select the OAuth2 drop-down item.</p> <p>4. Scroll down and click the Add OAuth2 client button. Specify the redirect URI as <code>https://cloud.example.com/index.php/apps/sociallogin/custom_oauth2/mailcow</code> and click Add. Save the client ID and secret for later.</p> <p>Info</p> <p>Some installations, including those setup using the helper script of mailcow, need to remove index.php/ from the URL to get a successful redirect: <code>https://cloud.example.com/apps/sociallogin/custom_oauth2/mailcow</code></p> <p>5. Log into Nextcloud as administrator.</p> <p>6. Click the button in the top right corner and select Apps. Click the search button in the toolbar, search for the Social Login plugin and click Download and enable next to it.</p> <p>7. Click the button in the top right corner and select Settings. Scroll down to the Administration section on the left and click Social login.</p> <p>8. Uncheck the following items:</p> <ul> <li>\"Disable auto create new users\"</li> <li>\"Allow users to connect social logins with their accounts\"</li> <li>\"Do not prune not available user groups on login\"</li> <li>\"Automatically create groups if they do not exists\"</li> <li>\"Restrict login for users without mapped groups\"</li> </ul> <p>7. Check the following items:</p> <ul> <li>\"Prevent creating an account if the email address exists in another account\"</li> <li>\"Update user profile every login\"</li> <li>\"Disable notify admins about new users\"</li> </ul> <p>Click the Save button.</p> <p>8. Scroll down to Custom OAuth2 and click the + button. 9. Configure the parameters as follows:</p> <ul> <li>Internal name: <code>mailcow</code></li> <li>Title: <code>mailcow</code></li> <li>API Base URL: <code>https://mail.example.com</code></li> <li>Authorize URL: <code>https://mail.example.com/oauth/authorize</code></li> <li>Token URL: <code>https://mail.example.com/oauth/token</code></li> <li>Profile URL: <code>https://mail.example.com/oauth/profile</code></li> <li>Logout URL: (leave blank)</li> <li>Client ID: (what you obtained in step 1)</li> <li>Client Secret: (what you obtained in step 1)</li> <li>Scope: <code>profile</code></li> </ul> <p>Click the Save button at the very bottom of the page.</p> <p>If you have previously used Nextcloud with mailcow authentication via user_external/IMAP, you need to perform some additional steps to link your existing user accounts with OAuth2.</p> <p>1. Click the button in the top right corner and select Apps. Scroll down to the External user authentication app and click Remove next to it. 2. Run the following queries in your Nextcloud database (if you set up Nextcloud with the script from mailcow, you can use the following command to get into the container):</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf &amp;&amp; docker compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>source mailcow.conf &amp;&amp; docker-compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>INSERT INTO oc_users (uid, uid_lower) SELECT DISTINCT uid, LOWER(uid) FROM oc_users_external;\nINSERT INTO oc_sociallogin_connect (uid, identifier) SELECT DISTINCT uid, CONCAT(\"mailcow-\", uid) FROM oc_users_external;\n</code></pre> <p>If you have previously used Nextcloud without mailcow authentication, but with the same usernames as mailcow, you can also link your existing user accounts with OAuth2.</p> <p>1. Run the following queries in your Nextcloud database (if you set up Nextcloud with the script from mailcow, you can use the following command to get into the container):</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf &amp;&amp; docker compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>source mailcow.conf &amp;&amp; docker-compose exec mysql-mailcow mysql -u$DBUSER -p$DBPASS $DBNAME\n</code></pre> <pre><code>INSERT INTO oc_sociallogin_connect (uid, identifier) SELECT DISTINCT uid, CONCAT(\"mailcow-\", uid) FROM oc_users;\n</code></pre>","path":["Third party nextcloud.en"],"tags":[]},{"location":"third_party/nextcloud/third_party-nextcloud.en/#update","level":2,"title":"Update","text":"<p>The Nextcloud instance can be updated easily with the web update mechanism. In the case of larger updates, there may be further changes to be made after the update. After the Nextcloud instance has been checked, problems are shown. This can be e.g. missing indices in the DB or similar. It shows which commands have to be executed, these have to be placed in the php-fpm-mailcow container.</p> <p>As an an example run the following command to add the missing indices. <code>docker exec -it -u www-data $(docker ps -f name=php-fpm-mailcow -q) bash -c \"php /web/nextcloud/occ db:add-missing-indices\"</code></p> <p>The update can also been done by CLI with the following command: </p> <p><code>docker exec -it -u www-data $(docker ps -f name=php-fpm-mailcow -q) bash -c \"php /web/nextcloud/updater/updater.phar\"</code></p> <p>This can also been done in an non interactive way (e.g. CRON) with this command: </p> <p>Danger</p> <p>We do not recommend this! Serios damage can be caused or the update process brakes over time. USE AT OWN RISK!!</p> <p><code>docker exec -it -u www-data $(docker ps -f name=php-fpm-mailcow -q) bash -c \"php /web/nextcloud/updater/updater.phar --no-interaction\"</code></p>","path":["Third party nextcloud.en"],"tags":[]},{"location":"third_party/nextcloud/third_party-nextcloud.en/#debugging-troubleshooting","level":2,"title":"Debugging &amp; Troubleshooting","text":"<p>It may happen that you cannot reach the Nextcloud instance from your network. This may be due to the fact that the entry of your subnet in the array 'trusted_proxies' is missing. You can make changes in the Nextcloud config.php in <code>data/web/nextcloud/config/*</code>.</p> <pre><code>'trusted_proxies' =&gt;\n  array (\n    0 =&gt; 'fd4d:6169:6c63:6f77::/64',\n    1 =&gt; '172.22.1.0/24',\n    2 =&gt; 'NewSubnet/24',\n  ),\n</code></pre> <p>After the changes have been made, the nginx container must be restarted.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose restart nginx-mailcow\n</code></pre>","path":["Third party nextcloud.en"],"tags":[]},{"location":"third_party/portainer/third_party-portainer.de/","level":1,"title":"Third party portainer.de","text":"<p>Um Portainer zu aktivieren, müssen die docker-compose.yml und site.conf für Nginx geändert werden.</p> <p>1. Erstellen Sie eine neue Datei <code>docker-compose.override.yml</code> im mailcow-dockerized Stammverzeichnis und fügen Sie die folgende Konfiguration ein <pre><code>services:\n    portainer-mailcow:\n      image: portainer/portainer-ce\n      volumes:\n        - /var/run/docker.sock:/var/run/docker.sock\n        - ./data/conf/portainer:/data\n      restart: always\n      dns:\n        - 172.22.1.254\n      dns_search: mailcow-network\n      networks:\n        mailcow-network:\n          aliases:\n            - portainer\n</code></pre> 2a. Erstelle <code>data/conf/nginx/portainer.conf</code>: <pre><code>upstream portainer {\n  server portainer-mailcow:9000;\n}\n\nmap $http_upgrade $connection_upgrade {\n  default upgrade;\n  '' close;\n}\n</code></pre></p> <p>2b. Fügen Sie einen neuen Standort für die Standard-mailcow-Site ein, indem Sie die Datei <code>data/conf/nginx/site.portainer.custom</code> erstellen: <pre><code>  location /portainer/ {\n    proxy_http_version 1.1;\n    proxy_set_header Host              $http_host;   # required for docker client's sake\n    proxy_set_header X-Real-IP         $remote_addr; # pass on real client's IP\n    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_read_timeout                 900;\n\n    proxy_set_header Connection \"\";\n    proxy_buffers 32 4k;\n    proxy_pass http://portainer/;\n  }\n\n  location /portainer/api/websocket/ {\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection $connection_upgrade;\n    proxy_pass http://portainer/api/websocket/;\n  }\n</code></pre></p> <p>3. Übernehmen Sie Ihre Änderungen:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d &amp;&amp; docker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose up -d &amp;&amp; docker-compose restart nginx-mailcow\n</code></pre> <p>Nun können Sie einfach zu https://${MAILCOW_HOSTNAME}/portainer/ navigieren, um Ihre Portainer-Container-Überwachungsseite anzuzeigen. Sie werden dann aufgefordert, ein neues Passwort für den admin Account anzugeben. Nachdem Sie Ihr Passwort eingegeben haben, können Sie sich mit der Portainer UI verbinden.</p>","path":["Third party portainer.de"],"tags":[]},{"location":"third_party/portainer/third_party-portainer.de/#reverse-proxy","level":2,"title":"Reverse Proxy","text":"<p>Wenn Sie einen Reverse-Proxy verwenden, muss dieser noch konfiguriert werden die Websocket Requests richtig weiterzuleiten.</p> <p>Dies wird für die Docker Konsole und andere Komponenten benötigt.</p> <p>Hier ist ein Bespiel für Apache:</p> <pre><code>&lt;Location /portainer/api/websocket/&gt;\n  RewriteEngine on\n  RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]\n  RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]\n  RewriteRule /portainer/api/websocket/(.*) ws://127.0.0.1:8080/portainer/api/websocket/$1 [P]\n&lt;/Location&gt;\n</code></pre>","path":["Third party portainer.de"],"tags":[]},{"location":"third_party/portainer/third_party-portainer.en/","level":1,"title":"Third party portainer.en","text":"<p>In order to enable Portainer, the docker-compose.yml and site.conf for Nginx must be modified.</p> <p>1. Create a new file <code>docker-compose.override.yml</code> in the mailcow-dockerized root folder and insert the following configuration <pre><code>services:\n    portainer-mailcow:\n      image: portainer/portainer-ce\n      volumes:\n        - /var/run/docker.sock:/var/run/docker.sock\n        - ./data/conf/portainer:/data\n      restart: always\n      dns:\n        - 172.22.1.254\n      dns_search: mailcow-network\n      networks:\n        mailcow-network:\n          aliases:\n            - portainer\n</code></pre> 2a. Create <code>data/conf/nginx/portainer.conf</code>: <pre><code>upstream portainer {\n  server portainer-mailcow:9000;\n}\n\nmap $http_upgrade $connection_upgrade {\n  default upgrade;\n  '' close;\n}\n</code></pre></p> <p>2b. Insert a new location to the default mailcow site by creating the file <code>data/conf/nginx/site.portainer.custom</code>: <pre><code>  location /portainer/ {\n    proxy_http_version 1.1;\n    proxy_set_header Host              $http_host;   # required for docker client's sake\n    proxy_set_header X-Real-IP         $remote_addr; # pass on real client's IP\n    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_read_timeout                 900;\n\n    proxy_set_header Connection \"\";\n    proxy_buffers 32 4k;\n    proxy_pass http://portainer/;\n  }\n\n  location /portainer/api/websocket/ {\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection $connection_upgrade;\n    proxy_pass http://portainer/api/websocket/;\n  }\n</code></pre></p> <p>3. Apply your changes:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d &amp;&amp; docker compose restart nginx-mailcow\n</code></pre> <pre><code>docker-compose up -d &amp;&amp; docker-compose restart nginx-mailcow\n</code></pre> <p>Now you can simply navigate to https://${MAILCOW_HOSTNAME}/portainer/ to view your Portainer container monitoring page. You’ll then be prompted to specify a new password for the admin account. After specifying your password, you’ll then be able to connect to the Portainer UI.</p>","path":["Third party portainer.en"],"tags":[]},{"location":"third_party/portainer/third_party-portainer.en/#reverse-proxy","level":2,"title":"Reverse Proxy","text":"<p>If you are using a reverse proxy you will have to configure it to properly forward websocket requests.</p> <p>This needs to be done for the docker console and other components to work.</p> <p>Here is an example for Apache:</p> <pre><code>&lt;Location /portainer/api/websocket/&gt;\n  RewriteEngine on\n  RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]\n  RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]\n  RewriteRule /portainer/api/websocket/(.*) ws://127.0.0.1:8080/portainer/api/websocket/$1 [P]\n&lt;/Location&gt;\n</code></pre>","path":["Third party portainer.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/","level":1,"title":"Third party roundcube.de","text":"","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#installation-von-roundcube","level":2,"title":"Installation von Roundcube","text":"<p>Beachten Sie</p> <p>Sofern nicht abweichend angegeben wird für alle aufgeführten Kommandos angenommen, dass diese im mailcow Installationsverzeichnis ausgeführt werden, d. h. dem Verzeichnis, welches <code>mailcow.conf</code> usw. enthält. Bitte führen Sie die Kommandos nicht blind aus, sondern verstehen Sie was diese bewirken. Keines der Kommandos sollte einen Fehler ausgeben; sollten Sie dennoch auf einen Fehler stoßen, beheben Sie diesen sofern notwendig bevor Sie mit den nachfolgenden Kommandos fortfahren.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#hinweise-zur-verwendung-von-composer","level":3,"title":"Hinweise zur Verwendung von composer","text":"<p>Diese Anweisungen verwenden das Programm composer zur Aktualisierung der Abhängigkeiten von Roundcube und um Roundcube-Plugins zu installieren bzw. zu aktualisieren.</p> <p>Das roundcube-plugin-installer composer Plugin hat eine Design-Schwäche, die dazu führen kann, dass composer bei Operationen fehlschlägt, im Rahmen derer Pakete aktualisiert oder deinstalliert werden.</p> <p>Die Fehlermeldung in diesem Falle besagt, dass eine <code>require</code>-Anweisung in <code>autoload_real.php</code> fehlgeschlagen ist, weil eine Datei nicht gefunden werden konnte. Beispiel:</p> <pre><code>In autoload_real.php line 43:\n  require(/web/rc/vendor/composer/../guzzlehttp/promises/src/functions_include.php): Failed to open stream: No such file or directory\n</code></pre> <p>Leider treten diese Fehler relativ häufig auf, sie lassen sich jedoch leicht beheben indem der Autoloader aktualisiert wird und das fehlgeschlagene Kommando im Anschluss erneut ausgeführt wird:</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer dump-autoload -o\n# Nun das fehlgeschlagene Kommando erneut ausführen\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#vorbereitung","level":3,"title":"Vorbereitung","text":"<p>Zunächst laden wir <code>mailcow.conf</code> um Zugriff auf die mailcow-Einstellungen innerhalb der nachfolgenden Kommandos zu erhalten.</p> <pre><code>source mailcow.conf\n</code></pre> <p>Laden Sie Roundcube 1.6.x (prüfen Sie das aktuellste Release und passen Sie die URL entsprechend an) in das web Verzeichnis herunter und entpacken Sie es (hier <code>rc/</code>):</p> <pre><code>mkdir -m 755 data/web/rc\nwget -O - https://github.com/roundcube/roundcubemail/releases/download/1.6.10/roundcubemail-1.6.10-complete.tar.gz | tar -xvz --no-same-owner -C data/web/rc --strip-components=1 -f -\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chown www-data:www-data /web/rc/logs /web/rc/temp\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chown root:www-data /web/rc/config\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chmod 750 /web/rc/logs /web/rc/temp /web/rc/config\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#optional-rechtschreibprufung","level":3,"title":"Optional: Rechtschreibprüfung","text":"<p>Wenn Sie eine Rechtschreibprüfung benötigen, erstellen Sie eine Datei <code>data/hooks/phpfpm/aspell.sh</code> mit folgendem Inhalt und geben Sie dann <code>chmod +x data/hooks/phpfpm/aspell.sh</code> ein. Dadurch wird eine lokale Rechtschreibprüfung installiert. Beachten Sie, dass die meisten modernen Webbrowser eine eingebaute Rechtschreibprüfung haben, so dass Sie diese vielleicht nicht benötigen.</p> <pre><code>#!/bin/bash\napk update\napk add aspell-de # oder jede andere Sprache\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#installation-des-mime-typ-verzeichnisses","level":3,"title":"Installation des MIME-Typ-Verzeichnisses","text":"<p>Laden Sie die <code>mime.types</code> Datei herunter, da diese nicht im <code>php-fpm</code>-Container enthalten ist.</p> <pre><code>wget -O data/web/rc/config/mime.types http://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#anlegen-der-roundcube-datenbank","level":3,"title":"Anlegen der Roundcube-Datenbank","text":"<p>Erstellen Sie eine Datenbank für Roundcube im mailcow mysql Container. Dies erstellt einen neuen <code>roundcube</code> Datenbank-Benutzer mit einem Zufallspasswort, welches in die Shell ausgegeben wird und in einer Shell-Variable für die Verwendung durch die nachfolgenden Kommandos gespeichert wird. Beachten Sie, dass Sie die <code>DBROUNDCUBE</code>-Shell-Variable manuell auf das ausgegebene Passwort setzen müssen, falls sie den Installationsprozess unterbrechen und später in einer neuen Shell fortsetzen sollten.</p> <pre><code>DBROUNDCUBE=$(LC_ALL=C &lt;/dev/urandom tr -dc A-Za-z0-9 2&gt; /dev/null | head -c 28)\necho Das Datenbank-Password für den Benutzer roundcube lautet $DBROUNDCUBE\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE DATABASE roundcubemail CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE USER 'roundcube'@'%' IDENTIFIED BY '${DBROUNDCUBE}';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"GRANT ALL PRIVILEGES ON roundcubemail.* TO 'roundcube'@'%';\"\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#roundcube-konfigurationsdatei","level":3,"title":"Roundcube-Konfigurationsdatei","text":"<p>Erstellen Sie eine Datei <code>data/web/rc/config/config.inc.php</code> mit dem folgenden Inhalt.   - Die <code>des_key</code>-Einstellung wird auf einen Zufallswert gesetzt. Sie wird u. a. zur Verschlüsselung vorübergehend     gespeicherter IMAP-Passwörter verwendet.   - Die Liste der Plugins kann nach Belieben angepasst werden. Die folgende Liste enthält eine Liste von     Standard-Plugins, welche ich als allgemein nützlich empfinde und die gut mit mailcow zusammenspielen:     - Das archive-Plugin fügt einen Archiv-Button hinzu, der ausgewählte E-Mails in ein konfigurierbares       Archiv-Verzeichnis verschiebt.     - Das managesieve-Plugin bietet eine benutzerfreundliche Oberfläche zur Verwaltung serverseitiger E-Mail-Filter und       Abwesenheits-Benachrichtigungen.     - Das acl-Plugin ermöglicht die Verwaltung von Zugriffskontroll-Listen auf IMAP-Verzeichnissen, mit der Möglichkeit       IMAP-Verzeichnisse mit anderen Benutzern zu teilen.     - Das markasjunk-Plugin fügt Buttons hinzu, um ausgewählte E-Mails als Spam (oder E-Mails im Junk-Verzeichnis nicht       als Spam) zu markieren und diese in das Junk-Verzeichnis (oder zurück in den Posteingang) zu verschieben. Die in       mailcow enthaltenen Sieve-Filter lösen automatisch die zugehörige Lern-Operation in rspamd aus, so dass keine       weitere Konfiguration des Plugins erforderlich ist.     - Das zipdownload-Plugin erlaubt es, mehrere E-Mail-Anhänge oder E-Mails als ZIP-Archiv herunterzuladen.   - Wenn Sie die Rechtschreibprüfung im obigen Schritt nicht installiert haben, entfernen Sie den Parameter     <code>spellcheck_engine</code>.</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/config/config.inc.php\n&lt;?php\n\\$config['db_dsnw'] = 'mysql://roundcube:${DBROUNDCUBE}@mysql/roundcubemail';\n\\$config['imap_host'] = 'dovecot:143';\n\\$config['smtp_host'] = 'postfix:588';\n\\$config['smtp_user'] = '%u';\n\\$config['smtp_pass'] = '%p';\n\\$config['support_url'] = '';\n\\$config['product_name'] = 'Roundcube Webmail';\n\\$config['cipher_method'] = 'chacha20-poly1305';\n\\$config['des_key'] = '$(LC_ALL=C &lt;/dev/urandom tr -dc \"A-Za-z0-9 !#$%&amp;()*+,-./:;&lt;=&gt;?@[\\\\]^_{|}~\" 2&gt; /dev/null | head -c 32)';\n\\$config['plugins'] = [\n  'archive',\n  'managesieve',\n  'acl',\n  'markasjunk',\n  'zipdownload',\n];\n\\$config['spellcheck_engine'] = 'aspell';\n\\$config['mime_types'] = '/web/rc/config/mime.types';\n\\$config['enable_installer'] = true;\n\n\\$config['managesieve_host'] = 'dovecot:4190';\n// Enables separate management interface for vacation responses (out-of-office)\n// 0 - no separate section (default); 1 - add Vacation section; 2 - add Vacation section, but hide Filters section\n\\$config['managesieve_vacation'] = 1;\nEOCONFIG\n\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chown root:www-data /web/rc/config/config.inc.php\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chmod 640 /web/rc/config/config.inc.php\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#initialisierung-der-datenbank","level":3,"title":"Initialisierung der Datenbank","text":"<p>Richten Sie Ihren Browser auf <code>https://myserver/rc/installer</code>. Prüfen Sie, dass die Webseite in keinem der Schritte \"NOT OK\"-Testergebnisse zeigt. Einige \"NOT AVAILABLE\"-Testergebnisse sind bzgl. der verschiedenen Datenbank-Erweiterungen erwartet, von denen nur MySQL benötigt wird.</p> <p>Initialisieren Sie die Datenbank und verlassen Sie das Installationsprogramm. Es ist nicht notwendig, die Konfigurationsdatei mit der heruntergeladenen Datei zu aktualisieren, sofern Sie keine Änderungen an den Einstellungen innerhalb des Installationsprogramms durchgeführt habe, die Sie übernehmen möchten.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#webserver-konfiguration","level":3,"title":"Webserver-Konfiguration","text":"<p>Das Roundcube-Verzeichnis enthält einige Inhalte, die nicht an Web-Nutzer ausgeliefert werden sollen. Wir erstellen daher eine Konfigurations-Ergänzung für nginx, um nur die öffentlichen Teile von Roundcube im Web zu exponieren:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/conf/nginx/site.roundcube.custom\nlocation /rc/ {\n  alias /web/rc/public_html/;\n}\nEOCONFIG\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#deaktivieren-und-entfernen-des-installationsprogramms","level":3,"title":"Deaktivieren und entfernen des Installationsprogramms","text":"<p>Löschen Sie das Verzeichnis <code>data/web/rc/installer</code> nach einer erfolgreichen Installation, und setzen Sie die <code>enable_installer</code>-Option in <code>data/web/rc/config/config.inc.php</code> auf <code>false</code>:</p> <pre><code>rm -r data/web/rc/installer\nsed -i -e \"s/\\(\\$config\\['enable_installer'\\].* = \\)true/\\1false/\" data/web/rc/config/config.inc.php\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#aktualisierung-der-roundcube-abhangigkeiten","level":3,"title":"Aktualisierung der Roundcube-Abhängigkeiten","text":"<p>Dieser Schritt ist nicht unbedingt notwendig, aber zumindest zum Zeitpunkt der Erstellung dieser Anweisungen enthielten die mit Roundcube ausgelieferten Abhängigkeiten Versionen mit Sicherheitslücken, daher könnte es eine gute Idee sein, die Abhängigkeiten auf die neusten Versionen zu aktualisieren. Aus demselben Grund sollte composer update hin und wieder ausgeführt werden.</p> <pre><code>cp -n data/web/rc/composer.json-dist data/web/rc/composer.json\ndocker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer update --no-dev -o\n</code></pre> <p>Sie können außerdem <code>composer audit</code> verwenden, um bekannte Sicherheitslücken in den installierten composer-Paketen anzuzeigen.</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer audit\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#ermoglichen-der-klartext-authentifizierung-fur-den-php-fpm-container-ohne-die-verwendung-von-tls","level":3,"title":"Ermöglichen der Klartext-Authentifizierung für den php-fpm-Container ohne die Verwendung von TLS","text":"<p>Wir müssen die Verwendung von Klartext-Authentifizierung über nicht verschlüsselte Verbindungen (innerhalb der Container-Netzwerks) in Dovecot zulassen, was in der Standard-Installation von mailcow nur für den SOGo-Container zum gleichen Zweck möglich ist. Danach starten Sie den Dovecot-Container neu, damit die Änderung wirksam wird.</p> <pre><code>cat  &lt;&lt;EOCONFIG &gt;&gt;data/conf/dovecot/extra.conf\nremote ${IPV4_NETWORK}.0/24 {\n  disable_plaintext_auth = no\n}\nremote ${IPV6_NETWORK} {\n  disable_plaintext_auth = no\n}\nEOCONFIG\n\ndocker compose restart dovecot-mailcow\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#ofelia-job-fur-roundcube-aufraumtatigkeiten","level":3,"title":"Ofelia-Job für Roundcube-Aufräumtätigkeiten","text":"<p>Roundcube muss regelmässig die Datenbank von nicht mehr benötigter Information befreien. Wir legen einen Ofelia-Job an, der das Roundcube <code>cleandb.sh</code>-Skript regelmässig ausführt.</p> <p>Um dies zu tun, fügen Sie folgendes zu <code>docker-compose.override.yml</code> hinzu (falls Sie bereits einige Anpassungen für den php-fpm-Container durchgeführt haben, fügen Sie die Label dem bestehenden Abschnitt hinzu):</p> <pre><code>services:\n  php-fpm-mailcow:\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.roundcube_cleandb.schedule: \"@every 168h\"\n      ofelia.job-exec.roundcube_cleandb.user: \"www-data\"\n      ofelia.job-exec.roundcube_cleandb.command: \"/bin/bash -c \\\"[ -f /web/rc/bin/cleandb.sh ] &amp;&amp; /web/rc/bin/cleandb.sh\\\"\"\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#optionale-zusatz-funktionalitaten","level":2,"title":"Optionale Zusatz-Funktionalitäten","text":"","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#aktivieren-der-funktion-passwort-andern-in-roundcube","level":2,"title":"Aktivieren der Funktion \"Passwort ändern\" in Roundcube","text":"<p>Das Ändern des mailcow Passworts aus der Roundcube-Benutzeroberfläche wird durch das password-Plugin ermöglicht. Wir konfigurieren dieses zur Verwendung der mailcow-API zur Passwort-Aktualisierung, was es zunächst erfordert, die API zu aktivieren und den API-Schlüssel zu ermitteln (Lese-/Schreib-Zugriff notwendig). Die API kann in der mailcow-Administrationsoberfläche aktiviert werden, wo Sie auch den API-Schlüssel finden.</p> <p>Öffnen Sie <code>data/web/rc/config/config.inc.php</code> und aktivieren Sie das Passwort-Plugin, indem Sie es dem <code>$config['plugins']</code>-Array hinzufügen, zum Beispiel:</p> <pre><code>$config['plugins'] = array(\n  'archive',\n  'managesieve',\n  'acl',\n  'markasjunk',\n  'zipdownload',\n  'password',\n);\n</code></pre> <p>Konfigurieren Sie das password-Plugin (stellen Sie sicher, **API_KEY** auf Ihren mailcow Lese-/Schreib-API-Schlüssel anzupassen):</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/plugins/password/config.inc.php\n&lt;?php\n\\$config['password_driver'] = 'mailcow';\n\\$config['password_confirm_current'] = true;\n\\$config['password_mailcow_api_host'] = 'http://nginx';\n\\$config['password_mailcow_api_token'] = '**API_KEY**';\nEOCONFIG\n</code></pre> <p>Hinweis: Sollten Sie die mailcow nginx-Konfiguration so angepasst haben, dass http-Anfragen auf https umgeleitet werden (wie z. B. hier beschrieben), dann wird die direkte Verbindung zum nginx-Container via HTTP nicht funktionieren, da nginx kein im Zertifikat enthaltener Hostname ist. In solchen Fällen setzen Sie <code>password_mailcow_api_host</code> stattdessen auf die öffentliche URI:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/plugins/password/config.inc.php\n&lt;?php\n\\$config['password_driver'] = 'mailcow';\n\\$config['password_confirm_current'] = true;\n\\$config['password_mailcow_api_host'] = 'https://${MAILCOW_HOSTNAME}';\n\\$config['password_mailcow_api_token'] = '**API_KEY**';\nEOCONFIG\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#carddav-adressbucher-in-roundcube-einbinden","level":2,"title":"CardDAV-Adressbücher in Roundcube einbinden","text":"<p>Installieren Sie die neuste v5-Version (die untenstehende Konfiguration ist kompatibel zu v5-Releases) mit composer. Antworten Sie <code>Y</code>, wenn Sie gefragt werden, ob Sie das Plugin aktivieren möchten.</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer require --update-no-dev -o \"roundcube/carddav:~5\"\n</code></pre> <p>Editieren Sie die Datei <code>data/web/rc/plugins/carddav/config.inc.php</code> und fügen Sie folgenden Inhalt hinzu:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/plugins/carddav/config.inc.php\n&lt;?php\n\\$prefs['_GLOBAL']['pwstore_scheme'] = 'des_key';\n\n\\$prefs['SOGo'] = [\n    'accountname'    =&gt; 'SOGo',\n    'username'       =&gt; '%u',\n    'password'       =&gt; '%p',\n    'discovery_url'  =&gt; 'http://sogo:20000/SOGo/dav/',\n    'name'           =&gt; '%N',\n    'use_categories' =&gt; true,\n    'fixed'          =&gt; ['username', 'password'],\n];\nEOCONFIG\n</code></pre> <p>RCMCardDAV legt alle Adressbücher des Benutzers beim Login in Roundcube an, einschließlich abonnierten Adressbüchern die mit dem Benutzers von anderen Benutzern geteilt werden.</p> <p>Wenn Sie das Standard-Adressbuch (gespeichert in der Roundcube-Datenbank) entfernen möchten, so dass nur CardDAV-Adressbücher verwendet werden können, fügen Sie der Konfigurationsdatei <code>data/web/rc/config/config.inc.php</code> die Option <code>$config['address_book_type'] = '';</code> hinzu.</p> <p>Hinweis: RCMCardDAV verwendet zusätzliche Datenbank-Tabellen. Nach der Installation (oder Aktualisierung) von RCMCardDAV ist es notwendig, sich in Roundcube neu anzumelden (melden Sie sich vorher ab, wenn Sie bereits eingeloggt sind), da die Erzeugung der Datenbank-Tabellen bzw. Änderungen nur bei der Anmeldung in Roundcube durchgeführt werden.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#ubermittlung-der-client-netzwerkadresse-an-dovecot","level":3,"title":"Übermittlung der Client-Netzwerkadresse an Dovecot","text":"<p>Normalerweise sieht der IMAP-Server Dovecot die Netzwerkadresse des php-fpm-Containers wenn Roundcube zu diesem Verbindungen aufbaut. Durch Verwendung einer IMAP-Erweiterung und dem <code>dovecot_client_ip</code> Roundcube-Plugin ist es möglich, dass Roundcube Dovecot die Client-Netzwerkadresse übermittelt, so dass in den Log-Dateien die Client-Netzwerkadresse erscheint. Dies führt dazu, dass Login-Versuche an Roundcube in den Dovecot-Logs genauso wie direkte Client-Verbindungen zu Dovecot aufgezeichnet werden, und fehlgeschlagene Login-Versuche an Roundcube analog zu fehlgeschlagenen direkten IMAP-Logins durch den netfilter-Container oder andere ggf. verfügbare Mechanismen zur Behandlung von Bruteforce-Attacken auf den IMAP-Server aufgegriffen werden und z. B. zu einer Blockierung des Clients führen.</p> <p>Hierzu muss das Roundcube-Plugin installiert werden:</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer require --update-no-dev -o \"foorschtbar/dovecot_client_ip:~2\"\n</code></pre> <p>Bearbeiten Sie die Datei <code>data/web/rc/config/config.inc.php</code> und fügen Sie den folgenden Inhalt ein:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;&gt;data/web/rc/config/config.inc.php\n\\$config['dovecot_client_ip_trusted_proxies'] = ['${IPV4_NETWORK}.0/24', '${IPV6_NETWORK}'];\nEOCONFIG\n</code></pre> <p>Weiterhin müssen wir Dovecot konfigurieren, so dass der php-fpm-Container als Teil eines vertrauenswürdigen Netzwerks betrachtet wird und somit die Client-Netzwerkadresse innerhalb einer IMAP-Sitzung überschreiben darf. Beachten Sie, dass dies auch die Klartext-Authentifizierung für die aufgeführten Netzwerkbereiche erlaubt, so dass das explizite Überschreiben von <code>disable_plaintext_auth</code> weiter oben in diesem Fall nicht notwendig ist.</p> <pre><code>cat  &lt;&lt;EOCONFIG &gt;&gt;data/conf/dovecot/extra.conf\nlogin_trusted_networks = ${IPV4_NETWORK}.0/24 ${IPV6_NETWORK}\nEOCONFIG\n\ndocker compose restart dovecot-mailcow\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#roundcube-zur-mailcow-apps-liste-hinzufugen","level":3,"title":"Roundcube zur mailcow Apps-Liste hinzufügen","text":"<p>Optional können Sie Roundcubes Link zu der mailcow Apps Liste hinzufügen. Um dies zu tun, öffnen oder erstellen Sie <code>data/web/inc/vars.local.inc.php</code> und stellen Sie sicher, dass es den folgenden Konfigurationsblock beinhaltet:</p> <pre><code>&lt;?php\n\n$MAILCOW_APPS = [\n    [\n        'name' =&gt; 'SOGo',\n        'link' =&gt; '/SOGo/'\n    ],\n    [\n        'name' =&gt; 'Roundcube',\n        'link' =&gt; '/rc/'\n    ]\n];\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#administratoren-ohne-passwort-in-roundcube-einloggen-lassen","level":3,"title":"Administratoren ohne Passwort in Roundcube einloggen lassen","text":"<p>Installieren Sie zunächst das Plugin dovecot_impersonate und fügen Sie Roundcube als App hinzu (siehe oben).</p> <pre><code>docker exec -it -w /web/rc/plugins $(docker ps -f name=php-fpm-mailcow -q) git clone https://github.com/corbosman/dovecot_impersonate.git\n</code></pre> <p>Editieren Sie <code>data/web/rc/config/config.inc.php</code> und aktivieren Sie das dovecot_impersonate Plugin indem Sie es zum Array <code>$config['plugins']</code> hinzufügen, zum Beispiel:</p> <pre><code>$config['plugins'] = array(\n  'archive',\n  'managesieve',\n  'acl',\n  'markasjunk',\n  'zipdownload',\n  'password',\n  'dovecot_impersonate'\n);\n</code></pre> <p>Editieren Sie <code>mailcow.conf</code> und fügen Sie folgendes hinzu:</p> <pre><code># Erlaube Admins, sich in Roundcube als Email-Benutzer einzuloggen (ohne Passwort)\n# Roundcube mit Plugin dovecot_impersonate muss zuerst installiert werden\n\nALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE=y\n</code></pre> <p>Editieren Sie <code>docker-compose.override.yml</code> und verfassen/erweitern Sie den Abschnitt für <code>php-fpm-mailcow</code>:</p> <pre><code>services:\n  php-fpm-mailcow:\n    environment:\n      - ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE=${ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE:-n}\n</code></pre> <p>Bearbeiten Sie <code>data/web/js/site/mailbox.js</code> und den folgenden Code nach <code>if (ALLOW_ADMIN_EMAIL_LOGIN) { ... }</code></p> <pre><code>if (ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE) {\n  item.action += '&lt;a href=\"/rc-auth.php?login=' + encodeURIComponent(item.username) + '\" class=\"login_as btn btn-sm btn-xs-half btn-primary\" target=\"_blank\"&gt;&lt;i class=\"bi bi-envelope-fill\"&gt;&lt;/i&gt; Roundcube&lt;/a&gt;';\n}\n</code></pre> <p>Bearbeiten Sie <code>data/web/mailbox.php</code> und fügen Sie diese Zeile zum Array <code>$template_data</code> hinzu:</p> <pre><code>  'allow_admin_email_login_roundcube' =&gt; (preg_match(\"/^(yes|y)+$/i\", $_ENV[\"ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE\"])) ? 'true' : 'false',\n</code></pre> <p>Bearbeiten Sie <code>data/web/templates/mailbox.twig</code> und fügen Sie diesen Code am Ende des Javascript-Abschnitts ein:</p> <pre><code>  var ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE = {{ allow_admin_email_login_roundcube }};\n</code></pre> <p>Kopieren Sie den Inhalt der folgenden Dateien aus diesem Snippet:</p> <ul> <li><code>data/web/inc/lib/RoundcubeAutoLogin.php</code></li> <li><code>data/web/rc-auth.php</code></li> </ul>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#abschluss-der-installation","level":2,"title":"Abschluss der Installation","text":"<p>Starten Sie schließlich mailcow neu</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#aktualisierung-von-roundcube","level":2,"title":"Aktualisierung von Roundcube","text":"<p>Ein Upgrade von Roundcube ist recht einfach: Gehen Sie auf die GitHub releases Seite für Roundcube und holen Sie sich den Link für die \"complete.tar.gz\" Datei für die gewünschte Version. Dann folgen Sie den untenstehenden Befehlen und ändern Sie die URL und den Namen des Roundcube-Ordners, falls nötig.</p> <pre><code># Starten Sie eine Bash-Sitzung des mailcow PHP-Containers\ndocker exec -it mailcowdockerized-php-fpm-mailcow-1 bash\n\n# Installieren Sie die erforderliche Upgrade-Abhängigkeit, dann aktualisieren Sie Roundcube auf die gewünschte Version\napk add rsync\ncd /tmp\nwget -O - https://github.com/roundcube/roundcubemail/releases/download/1.6.10/roundcubemail-1.6.10-complete.tar.gz | tar xfvz -\ncd roundcubemail-1.6.10\nbin/installto.sh /web/rc\n\n# Geben Sie 'Y' ein und drücken Sie die Eingabetaste, um Ihre Installation von Roundcube zu aktualisieren.\n# Geben Sie 'N' ein, wenn folgender Dialog erscheint: \"Do you want me to fix your local configuration\".\n\n# Sollte im Output eine Notice kommen \"NOTICE: Update dependencies by running php composer.phar update --no-dev\" führen\nSie composer aus:\ncd /web/rc\ncomposer update --no-dev -o\n# Auf die Frage \"Do you trust \"roundcube/plugin-installer\" to execute code and wish to enable it now? (writes \"allow-plugins\" to composer.json) [y,n,d,?] \" bitte mit y antworten.\n\n# Entfernen Sie übrig gebliebene Dateien\nrm -rf /tmp/roundcube*\n\n# Falls Sie von Version 1.5 auf 1.6 updaten, dann führen Sie folgende Befehle aus, um die Konfigurationsdatei anzupassen:`\nsed -i \"s/\\$config\\['default_host'\\].*$/\\$config\\['imap_host'\\]\\ =\\ 'dovecot:143'\\;/\" /web/rc/config/config.inc.php\nsed -i \"/\\$config\\['default_port'\\].*$/d\" /web/rc/config/config.inc.php\nsed -i \"s/\\$config\\['smtp_server'\\].*$/\\$config\\['smtp_host'\\]\\ =\\ 'postfix:588'\\;/\" /web/rc/config/config.inc.php\nsed -i \"/\\$config\\['smtp_port'\\].*$/d\" /web/rc/config/config.inc.php\nsed -i \"s/\\$config\\['managesieve_host'\\].*$/\\$config\\['managesieve_host'\\]\\ =\\ 'dovecot:4190'\\;/\" /web/rc/config/config.inc.php\nsed -i \"/\\$config\\['managesieve_port'\\].*$/d\" /web/rc/config/config.inc.php\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#aktualisierung-von-composer-plugins","level":3,"title":"Aktualisierung von composer-Plugins","text":"<p>Um Roundcube-Plugins und -Abhängigkeiten zu aktualisieren, die mit composer installiert wurden (z. B. RCMCardDAV-Plugin), führen Sie einfach composer im Container aus:</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer update --no-dev -o\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#aktualisierung-des-mime-typ-verzeichnisses","level":3,"title":"Aktualisierung des MIME-Typ-Verzeichnisses","text":"<p>Um das MIME-Typ-Verzeichnis zu aktualisieren, laden Sie dieses erneut mit dem Kommando aus den Installations-Anweisungen herunter.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#deinstallation-von-roundcube","level":2,"title":"Deinstallation von Roundcube","text":"<p>Für die Deinstallation wird ebenfalls angenommen, dass die Kommandos im mailcow-Installationsverzeichnis ausgeführt werden und dass <code>mailcow.conf</code> in die Shell geladen wurde, siehe Abschnitt Vorbereitung oben.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#entfernen-des-web-verzeichnisses","level":3,"title":"Entfernen des Web-Verzeichnisses","text":"<p>Dies entfernt die Roundcube-Installation mit allen Plugins und Abhängigkeiten die Sie ggf. installiert haben, einschließlich solcher, die mit composer installiert wurden.</p> <p>Hinweis: Dies entfernt auch alle angepassten Konfigurationen die Sie ggf. in Roundcube durchgeführt haben. Sollten Sie diese erhalten wollen, verschieben Sie das Verzeichnis an einen anderen Ort statt es zu entfernen.</p> <pre><code>rm -r data/web/rc\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#entfernen-der-datenbank","level":3,"title":"Entfernen der Datenbank","text":"<p>Hinweis: Dies löscht alle Daten, die Roundcube abgespeichert hat. Wenn Sie diese erhalten möchten, können Sie <code>mysqldump</code> ausführen, bevor Sie die Datenbank löschen, oder die Datenbank einfach nicht löschen.</p> <pre><code>docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"DROP USER 'roundcube'@'%';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"DROP DATABASE roundcubemail;\"\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#entfernen-der-konfigurationsanpassungen-fur-mailcow","level":3,"title":"Entfernen der Konfigurationsanpassungen für mailcow","text":"<p>Um die Dateien zu ermitteln, lesen Sie bitte die Installationsanweisungen und machen Sie die Schritte, die Sie dort zuvor durchgeführt haben, rückgängig.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#migration-von-einer-alteren-mailcow-roundcube-installation","level":2,"title":"Migration von einer älteren mailcow-Roundcube-Installation","text":"<p>Ältere Versionen dieser Anleitung verwendeten die mailcow-Datenbank auch für Roundcube, mit einem konfigurierten Präfix <code>mailcow_rc1</code> für alle Roundcube-Tabellen.</p> <p>Zur Migration wird ebenfalls angenommen, dass alle Kommandos im mailcow-Installationsverzeichnis ausgeführt werden und <code>mailcow.conf</code> in die Shell geladen wurde, siehe Vorbereitung oben. Dies Kommandos der verschiedenen Schritte bauen aufeinander auf und müssen innerhalb derselben Shell ausgeführt werden. Insbesondere setzen einige Schritte Shell-Variablen (besonders die <code>DBROUNDCUBE</code>-Variable mit dem Datenbank-Passwort für den roundcube-Datenbankbenutzer), die in späteren Schritten verwendet werden.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#anlegen-eines-neuen-roundcube-datenbankbenutzers-und-der-datenbank","level":3,"title":"Anlegen eines neuen roundcube-Datenbankbenutzers und der Datenbank","text":"<p>Folgen Sie den Anweisungen oben um den roundcube-Datenbankbenutzer und die getrennte Datenbank anzulegen.</p>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#migration-der-roundcube-daten-aus-der-mailcow-datenbank","level":3,"title":"Migration der Roundcube-Daten aus der mailcow-Datenbank","text":"<p>Bevor wir mit der Migration starten, deaktivieren wir Roundcube, um weitere Änderungen an dessen Datenbank-Tabellen zu vermeiden.</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/conf/nginx/site.roundcube.custom\nlocation ^~ /rc/ {\n  return 503;\n}\nEOCONFIG\ndocker compose exec nginx-mailcow nginx -s reload\n</code></pre> <p>Nun kopieren wir die Roundcube-Daten in die neue Datenbank. Wir entfernen das Datenbank-Tabellen-Präfix in diesem Schritt, welches Sie ggf. anpassen müssen, wenn Sie ein anderes Präfix als <code>mailcow_rc1</code> verwendet haben. Es ist auch möglich, das Präfix beizubehalten (in diesem Fall behalten Sie auch die zugehörige Roundcube-Einstellung <code>db_prefix</code> bei). Ändern Sie dann die Datenbank-Fremdschlüssel.</p> <pre><code>RCTABLES=$(docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -sN mailcow -e \"show tables like 'mailcow_rc1%';\" | tr '\\n\\r' ' ')\ndocker exec $(docker ps -f name=mysql-mailcow -q) /bin/bash -c \"mysqldump -uroot -p${DBROOT} mailcow $RCTABLES | sed 's/mailcow_rc1//' | mysql -uroot -p${DBROOT} roundcubemail\"\nFOREIGNKEYS=$(docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -sN mailcow -e \"SELECT CONCAT('ALTER TABLE \\`', TABLE_NAME, '\\` ', 'DROP FOREIGN KEY \\`', CONSTRAINT_NAME, '\\`;', 'ALTER TABLE \\`', TABLE_NAME, '\\` ', 'ADD FOREIGN KEY \\`', CONSTRAINT_NAME, '\\` (', COLUMN_NAME, ') ', 'REFERENCES \\`', REPLACE(REFERENCED_TABLE_NAME, 'mailcow_rc1', ''), '\\` (', REFERENCED_COLUMN_NAME, ');') FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = 'roundcubemail' AND REFERENCED_TABLE_NAME IS NOT NULL;\")\ndocker exec $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} roundcubemail -e \"$FOREIGNKEYS\"\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#aktualisierung-der-roundcube-konfiguration","level":3,"title":"Aktualisierung der Roundcube-Konfiguration","text":"<p>Führen Sie folgende Kommandos aus, um die nicht mehr notwendige <code>db_prefix</code> Option zu entfernen. Wir aktivieren außerdem das Logging in Roundcube, indem wir die Einstellungen <code>log_dir</code> und <code>temp_dir</code> entfernen, welche Teil der alten Anweisungen waren.</p> <pre><code>sed -i \"/\\$config\\['db_prefix'\\].*$/d\" data/web/rc/config/config.inc.php\nsed -i \"/\\$config\\['log_dir'\\].*$/d\" data/web/rc/config/config.inc.php\nsed -i \"/\\$config\\['temp_dir'\\].*$/d\" data/web/rc/config/config.inc.php\n</code></pre> <p>Wir müssen die nginx-Konfiguration anpassen, so dass nicht-öffentliche Verzeichnisse von Roundcube nicht exponiert werden, insbesondere die Verzeichnisse, welche Log-Dateien und temporäre Dateien enthalten:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/conf/nginx/site.roundcube.custom\nlocation /rc/ {\n  alias /web/rc/public_html/;\n}\nEOCONFIG\n</code></pre> <p>Wir können auch die <code>cipher_method</code>-Einstellung auf eine sicherere Einstellung ändern, aber beachten Sie, dass mit der alten Methode verschlüsselte Daten danach nicht mehr entschlüsselt werden können. Dies betrifft insbesondere CardDAV-Passwörter, sofern Sie RCMCardDAV verwenden und Ihre Nutzer benutzerdefinierte Adressbücher hinzugefügt haben (die Admin-Voreinstellungen für die SOGo-Adressbücher werden automatisch beim nächsten Login für den jeweiligen Nutzer korrigiert). Wenn Sie die <code>cipher_method</code> ändern wollen, führen Sie folgendes Kommando aus:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;&gt;data/web/rc/config/config.inc.php\n\\$config['cipher_method'] = 'chacha20-poly1305';\nEOCONFIG\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#umstellung-des-rcmcarddav-plugins-auf-die-installation-mittels-composer","level":3,"title":"Umstellung des RCMCardDAV-Plugins auf die Installation mittels composer","text":"<p>Dieser Schritt ist optional, aber er gleicht Ihre Installation an die aktuelle Fassung der Anweisungen an und ermöglicht die Aktualisierung von RCMCardDAV mittels composer. Dies wird einfach dadurch erreicht, dass das carddav-Plugin aus dem Installationsverzeichnis gelöscht und entsprechend der Anweisungen oben installiert wird, einschließlich der Erstellung einer neuen RCMCardDAV v5-Konfiguration. Falls Sie das RCMCardDAV angepasst haben, sollten Sie dieses sichern, bevor Sie das Plugin löschen, und Ihre Anpassungen später in die neue Konfigurationsdatei übernehmen.</p> <p>Um das carddav-Plugin zu löschen, führen Sie folgendes Kommando aus, danach befolgen Sie zur Neuinstallation die Anweisungen oben:</p> <pre><code>rm -r data/web/rc/plugins/carddav\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#umschalten-von-roundcube-auf-die-neue-datenbank","level":3,"title":"Umschalten von Roundcube auf die neue Datenbank","text":"<p>Zunächst passen wir die Roundcube-Konfiguration an, so dass die neue Datenbank verwendet wird. <pre><code>sed -i \"/\\$config\\['db_dsnw'\\].*$/d\" data/web/rc/config/config.inc.php\ncat &lt;&lt;EOCONFIG &gt;&gt;data/web/rc/config/config.inc.php\n\\$config['db_dsnw'] = 'mysql://roundcube:${DBROUNDCUBE}@mysql/roundcubemail';\nEOCONFIG\n</code></pre></p>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#roundcube-web-zugriff-reaktivieren","level":3,"title":"Roundcube Web-Zugriff reaktivieren","text":"<p>Führen Sie chown und chmod auf den sensitiven Roundcube-Verzeichnissen, welche in Vorbereitung aufgeführt sind aus, um sicherzustellen, dass der nginx-Webserver nicht auf Dateien zugreifen darf, die er nicht ausliefern soll.</p> <p>Dann reaktivieren Sie den Web-Zugriff für Roundcube, indem Sie die temporäre Roundcube-Konfigurations-Erweiterung für nginx durch die oben beschriebene ersetzen, und laden anschließend die nginx-Konfiguration neu:</p> <pre><code>docker compose exec nginx-mailcow nginx -s reload\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#andere-anpassungen","level":3,"title":"Andere Anpassungen","text":"<p>Sie müssen auch die Konfiguration des Roundcube password-Plugins entsprechend dieser Anweisungen anpassen, sofern Sie diese Funktionalität aktiviert haben, da die alten Anweisungen das Passwort direkt in der mailcow-Datenbank änderten, wohingegen diese Fassung der Anweisungen die mailcow-API zur Passwort-Änderung verwendet.</p> <p>Bezüglich weiterer Anpassungen und Neuerungen (z. B. roundcube-dovecot_client_ip Plugin) können Sie die aktuellen Anweisungen durchgehen und Ihre Konfiguration entsprechend anpassen bzw. die genannten Installationsschritte für neue Funktionalitäten ausführen.</p> <p>Insbesondere beachten Sie folgende Abschnitte:</p> <ul> <li>Ofelia-Job für Roundcube-Aufräumtätigkeiten</li> <li>Ermöglichen der Klartext-Authentifizierung für den php-fpm-Container ohne die Verwendung von TLS</li> <li>Übermittlung der Client-Netzwerkadresse an Dovecot</li> </ul>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.de/#entfernen-der-roundcube-tabellen-aus-der-mailcow-datenbank","level":3,"title":"Entfernen der Roundcube-Tabellen aus der mailcow-Datenbank","text":"<p>Nachdem Sie sichergestellt haben, dass die Migration erfolgreich durchgeführt wurde und Roundcube mit der getrennten Datenbank funktioniert, können Sie die Roundcube-Tabellen aus der mailcow-Datenbank mit dem folgenden Kommando entfernen:</p> <pre><code>docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -sN mailcow -e \"SET SESSION foreign_key_checks = 0; DROP TABLE IF EXISTS $(echo $RCTABLES | sed -e 's/ \\+/,/g');\"\n</code></pre>","path":["Third party roundcube.de"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/","level":1,"title":"Third party roundcube.en","text":"","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#installing-roundcube","level":2,"title":"Installing Roundcube","text":"<p>Note</p> <p>Unless otherwise stated, all of the given commands are expected to be executed in the mailcow installation directory, i.e., the directory containing <code>mailcow.conf</code> etc. Please do not blindly execute the commands but understand what they do. None of the commands is supposed to produce an error, so if you encounter an error, fix it if necessary before continuing with the subsequent commands.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#note-on-composer-usage","level":3,"title":"Note on composer usage","text":"<p>This guide uses composer to update roundcube dependencies or install / update roundcube plugins.</p> <p>The roundcube-plugin-installer composer plugin has a design issue that can lead to composer errors when packages are upgraded or uninstalled in the composer execution.</p> <p>The error message will typically tell you that a <code>require</code> in <code>autoload_real.php</code> failed because a file could not be opened. Example:</p> <pre><code>In autoload_real.php line 43:\n  require(/web/rc/vendor/composer/../guzzlehttp/promises/src/functions_include.php): Failed to open stream: No such file or directory\n</code></pre> <p>Unfortunately these occur quite frequently, but they can be worked around by updating the autoloader and re-running the failed command:</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer dump-autoload -o\n# Now execute the command that failed again\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#preparation","level":3,"title":"Preparation","text":"<p>First we load <code>mailcow.conf</code> so we have access to the mailcow configuration settings for the following commands.</p> <pre><code>source mailcow.conf\n</code></pre> <p>Download Roundcube 1.6.x (check for latest release and adapt URL) to the web directory and extract it (here <code>rc/</code>):</p> <pre><code>mkdir -m 755 data/web/rc\nwget -O - https://github.com/roundcube/roundcubemail/releases/download/1.6.10/roundcubemail-1.6.10-complete.tar.gz | tar -xvz --no-same-owner -C data/web/rc --strip-components=1 -f -\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chown www-data:www-data /web/rc/logs /web/rc/temp\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chown root:www-data /web/rc/config\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chmod 750 /web/rc/logs /web/rc/temp /web/rc/config\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#optional-spellchecking","level":3,"title":"Optional: Spellchecking","text":"<p>If you need spell check features, create a file <code>data/hooks/phpfpm/aspell.sh</code> with the following content, then <code>chmod +x data/hooks/phpfpm/aspell.sh</code>. This installs a local spell check engine. Note, most modern web browsers have built in spell check, so you may not want/need this.</p> <pre><code>#!/bin/bash\napk update\napk add aspell-en # or any other language\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#install-mime-type-mappings","level":3,"title":"Install mime type mappings","text":"<p>Download the <code>mime.types</code> file as it is not included in the php-fpm container.</p> <pre><code>wget -O data/web/rc/config/mime.types http://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#create-roundcube-database","level":3,"title":"Create roundcube database","text":"<p>Create a database for roundcube in the mailcow MySQL container. This creates a new <code>roundcube</code> database user with a random password, which will be echoed to the shell and stored in a shell variable for use by later commands. Note that when you interrupt the process and continue in a new shell, you must set the <code>DBROUNDCUBE</code> shell variable manually to the password output by the following commands.</p> <pre><code>DBROUNDCUBE=$(LC_ALL=C &lt;/dev/urandom tr -dc A-Za-z0-9 2&gt; /dev/null | head -c 28)\necho Database password for user roundcube is $DBROUNDCUBE\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE DATABASE roundcubemail CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"CREATE USER 'roundcube'@'%' IDENTIFIED BY '${DBROUNDCUBE}';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"GRANT ALL PRIVILEGES ON roundcubemail.* TO 'roundcube'@'%';\"\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#roundcube-configuration","level":3,"title":"Roundcube configuration","text":"<p>Create a file <code>data/web/rc/config/config.inc.php</code> with the following content.   - The <code>des_key</code> option is set to a random value. It is used to temporarily store your IMAP password.   - The plugins list can be adapted to your preference. I added a set of standard plugins that I consider of common     usefulness and which work well together with mailcow:     - The archive plugin adds an archive button that moves selected messages to a user-configurable archive folder.     - The managesieve plugin provides a user-friendly interface to manage server-side mail filtering and vacation / out       of office notification.     - The acl plugin allows to manage access control lists on IMAP folders, including the ability to share IMAP folders       to other users.     - The markasjunk plugin adds buttons to mark selected messages as junk (or messages in the junk folder not as junk)       and moves them to the junk folder or back to the inbox. The sieve filters included with mailcow will take care       that action triggers a learn as spam/ham action in rspamd, so no further configuration of the plugin is needed.     - The zipdownload plugin allows to download multiple message attachments or messages as a zip file.   - If you didn't install spell check in the above step, remove <code>spellcheck_engine</code> parameter.</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/config/config.inc.php\n&lt;?php\n\\$config['db_dsnw'] = 'mysql://roundcube:${DBROUNDCUBE}@mysql/roundcubemail';\n\\$config['imap_host'] = 'dovecot:143';\n\\$config['smtp_host'] = 'postfix:588';\n\\$config['smtp_user'] = '%u';\n\\$config['smtp_pass'] = '%p';\n\\$config['support_url'] = '';\n\\$config['product_name'] = 'Roundcube Webmail';\n\\$config['cipher_method'] = 'chacha20-poly1305';\n\\$config['des_key'] = '$(LC_ALL=C &lt;/dev/urandom tr -dc \"A-Za-z0-9 !#$%&amp;()*+,-./:;&lt;=&gt;?@[\\\\]^_{|}~\" 2&gt; /dev/null | head -c 32)';\n\\$config['plugins'] = [\n  'archive',\n  'managesieve',\n  'acl',\n  'markasjunk',\n  'zipdownload',\n];\n\\$config['spellcheck_engine'] = 'aspell';\n\\$config['mime_types'] = '/web/rc/config/mime.types';\n\\$config['enable_installer'] = true;\n\n\\$config['managesieve_host'] = 'dovecot:4190';\n// Enables separate management interface for vacation responses (out-of-office)\n// 0 - no separate section (default); 1 - add Vacation section; 2 - add Vacation section, but hide Filters section\n\\$config['managesieve_vacation'] = 1;\nEOCONFIG\n\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chown root:www-data /web/rc/config/config.inc.php\ndocker exec -it $(docker ps -f name=php-fpm-mailcow -q) chmod 640 /web/rc/config/config.inc.php\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#initialize-database","level":3,"title":"Initialize database","text":"<p>Point your browser to <code>https://myserver/rc/installer</code>. Check that the website shows no \"NOT OK\" check results on any of the steps, some \"NOT AVAILABLE\" are expected regarding different database extensions of which we only need MySQL. Initialize the database and leave the installer. It is not necessary to update the configuration with the downloaded one, unless you made some settings in the installer you would like to take over.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#webserver-configuration","level":3,"title":"Webserver configuration","text":"<p>The roundcube directory includes some locations that we do not want to serve to web users. We add a configuration extension to nginx to only expose the public directory of roundcube.</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/conf/nginx/site.roundcube.custom\nlocation /rc/ {\n  alias /web/rc/public_html/;\n}\nEOCONFIG\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#disable-and-remove-installer","level":3,"title":"Disable and remove installer","text":"<p>Delete the directory <code>data/web/rc/installer</code> after a successful installation, and set the <code>enable_installer</code> option to false in <code>data/web/rc/config/config.inc.php</code>:</p> <pre><code>rm -r data/web/rc/installer\nsed -i -e \"s/\\(\\$config\\['enable_installer'\\].* = \\)true/\\1false/\" data/web/rc/config/config.inc.php\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#update-roundcube-dependencies","level":3,"title":"Update roundcube dependencies","text":"<p>This step is not strictly necessary, but at least at the time of this writing the dependencies shipped with roundcube included versions with security vulnerabilities, so it may be a good idea to update the dependencies to the latest versions. For the same reason, it may be a good idea to run the composer update once in a while.</p> <pre><code>cp -n data/web/rc/composer.json-dist data/web/rc/composer.json\ndocker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer update --no-dev -o\n</code></pre> <p>You can also use <code>composer audit</code> to check for any reported security issues with the installed set of composer packages:</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer audit\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#allow-plaintext-authentication-for-the-php-fpm-container-without-using-tls","level":3,"title":"Allow plaintext authentication for the php-fpm container without using TLS","text":"<p>We need to allow plaintext authentication in dovecot over unencrypted connection (inside the container network), which is per default mailcow installation only possible for the SOGo container for the very same purpose. Afterwards restart the dovecot container so the change becomes effective.</p> <pre><code>cat  &lt;&lt;EOCONFIG &gt;&gt;data/conf/dovecot/extra.conf\nremote ${IPV4_NETWORK}.0/24 {\n  disable_plaintext_auth = no\n}\nremote ${IPV6_NETWORK} {\n  disable_plaintext_auth = no\n}\nEOCONFIG\n\ndocker compose restart dovecot-mailcow\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#ofelia-job-for-roundcube-housekeeping","level":3,"title":"Ofelia job for roundcube housekeeping","text":"<p>Roundcube needs to clean some stale information from the database every once in a while, for which we will create an ofelia job that runs the roundcube <code>cleandb.sh</code> script.</p> <p>To do this, add the following to <code>docker-compose.override.yml</code> (if you already have some adaptations for the php-fpm container, add the labels to the existing section):</p> <pre><code>services:\n  php-fpm-mailcow:\n    labels:\n      ofelia.enabled: \"true\"\n      ofelia.job-exec.roundcube_cleandb.schedule: \"@every 168h\"\n      ofelia.job-exec.roundcube_cleandb.user: \"www-data\"\n      ofelia.job-exec.roundcube_cleandb.command: \"/bin/bash -c \\\"[ -f /web/rc/bin/cleandb.sh ] &amp;&amp; /web/rc/bin/cleandb.sh\\\"\"\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#optional-extra-functionality","level":2,"title":"Optional extra functionality","text":"","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#enable-change-password-function-in-roundcube","level":3,"title":"Enable change password function in Roundcube","text":"<p>Changing the mailcow password from the roundcube UI is supported via the password plugin. We will configure it to use the mailcow API to update the password, which requires to enable the API first and to get the API key (read/write API access required). The API can be enabled in the mailcow admin interface, where you can also find the API key.</p> <p>Open <code>data/web/rc/config/config.inc.php</code> and enable the password plugin by adding it to the <code>$config['plugins']</code> array, for example:</p> <pre><code>$config['plugins'] = array(\n  'archive',\n  'managesieve',\n  'acl',\n  'markasjunk',\n  'zipdownload',\n  'password',\n);\n</code></pre> <p>Configure the password plugin (be sure to adapt **API_KEY** to you mailcow read/write API key):</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/plugins/password/config.inc.php\n&lt;?php\n\\$config['password_driver'] = 'mailcow';\n\\$config['password_confirm_current'] = true;\n\\$config['password_mailcow_api_host'] = 'http://nginx';\n\\$config['password_mailcow_api_token'] = '**API_KEY**';\nEOCONFIG\n</code></pre> <p>Note: If you have changed the mailcow nginx configuration to redirect http requests to https (e.g., as described here), then directly talking to the nginx container via http will not work because nginx is not a hostname contained in the certificate. In such cases, set <code>password_mailcow_api_host</code> in the above configuration to the public URI instead:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/plugins/password/config.inc.php\n&lt;?php\n\\$config['password_driver'] = 'mailcow';\n\\$config['password_confirm_current'] = true;\n\\$config['password_mailcow_api_host'] = 'https://${MAILCOW_HOSTNAME}';\n\\$config['password_mailcow_api_token'] = '**API_KEY**';\nEOCONFIG\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#integrate-carddav-addressbooks-in-roundcube","level":3,"title":"Integrate CardDAV addressbooks in Roundcube","text":"<p>Install the latest v5 version (the config below is compatible with v5 releases) using composer. Answer <code>Y</code> when asked if you want to activate the plugin.</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer require --update-no-dev -o \"roundcube/carddav:~5\"\n</code></pre> <p>Edit the file <code>data/web/rc/plugins/carddav/config.inc.php</code> and insert the following content:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/web/rc/plugins/carddav/config.inc.php\n&lt;?php\n\\$prefs['_GLOBAL']['pwstore_scheme'] = 'des_key';\n\n\\$prefs['SOGo'] = [\n    'accountname'    =&gt; 'SOGo',\n    'username'       =&gt; '%u',\n    'password'       =&gt; '%p',\n    'discovery_url'  =&gt; 'http://sogo:20000/SOGo/dav/',\n    'name'           =&gt; '%N',\n    'use_categories' =&gt; true,\n    'fixed'          =&gt; ['username', 'password'],\n];\nEOCONFIG\n</code></pre> <p>RCMCardDAV will add all addressbooks of the user on login, including subscribed addressbooks shared to the user by other users.</p> <p>If you want to remove the default addressbooks (stored in the Roundcube database), so that only the CardDAV addressbooks are accessible, append <code>$config['address_book_type'] = '';</code> to the config file <code>data/web/rc/config/config.inc.php</code>.</p> <p>Note: RCMCardDAV uses additional database tables. After installing (or upgrading) RCMCardDAV, it is required to log in roundcube (log out first if already logged in) because the database table creation / changes are performed only during the login to roundcube.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#forward-the-client-network-address-to-dovecot","level":3,"title":"Forward the client network address to dovecot","text":"<p>Normally, the IMAP server dovecot will see the network address of the php-fpm container when roundcube interacts with the IMAP server. Using an IMAP extension and the <code>dovecot_client_ip</code> roundcube plugin, it is possible for roundcube to tell dovecot the client IP, so it will also show up in the logs as the remote IP. When doing this, login attempts will show in the dovecot logs like any direct client connections to dovecot, and such failed logins into roundcube will be treated in the same manner as failed direct IMAP logins, causing blocking of the client with the netfilter container or other mechanisms that may already be in place to handle bruteforce attacks on the IMAP server.</p> <p>For this, the roundcube plugin must be installed.</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer require --update-no-dev -o \"foorschtbar/dovecot_client_ip:~2\"\n</code></pre> <p>Edit the file <code>data/web/rc/config/config.inc.php</code> and insert the following content:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;&gt;data/web/rc/config/config.inc.php\n\\$config['dovecot_client_ip_trusted_proxies'] = ['${IPV4_NETWORK}.0/24', '${IPV6_NETWORK}'];\nEOCONFIG\n</code></pre> <p>Furthermore, we must configure dovecot to treat the php-fpm container as part of a trusted network so it is allowed to override the client IP in the IMAP session. Note that this also enables plaintext authentication for the listed network ranges, so the explicit overridings of <code>disable_plaintext_auth</code> done above are not necessary when using this.</p> <pre><code>cat  &lt;&lt;EOCONFIG &gt;&gt;data/conf/dovecot/extra.conf\nlogin_trusted_networks = ${IPV4_NETWORK}.0/24 ${IPV6_NETWORK}\nEOCONFIG\n\ndocker compose restart dovecot-mailcow\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#add-roundcube-link-to-mailcow-apps-list","level":3,"title":"Add roundcube link to mailcow Apps list","text":"<p>You can add Roundcube's link to the mailcow Apps list. To do this, open or create <code>data/web/inc/vars.local.inc.php</code> and make sure it includes the following configuration block:</p> <pre><code>&lt;?php\n\n$MAILCOW_APPS = [\n    [\n        'name' =&gt; 'SOGo',\n        'link' =&gt; '/SOGo/'\n    ],\n    [\n        'name' =&gt; 'Roundcube',\n        'link' =&gt; '/rc/'\n    ]\n];\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#let-admins-log-into-roundcube-without-password","level":3,"title":"Let admins log into Roundcube without password","text":"<p>First, install plugin dovecot_impersonate and add Roundcube as an app (see above).</p> <pre><code>docker exec -it -w /web/rc/plugins $(docker ps -f name=php-fpm-mailcow -q) git clone https://github.com/corbosman/dovecot_impersonate.git\n</code></pre> <p>Open <code>data/web/rc/config/config.inc.php</code> and enable the dovecot_impersonate plugin by adding it to the <code>$config['plugins']</code> array, for example:</p> <pre><code>$config['plugins'] = array(\n  'archive',\n  'managesieve',\n  'acl',\n  'markasjunk',\n  'zipdownload',\n  'password',\n  'dovecot_impersonate'\n);\n</code></pre> <p>Edit <code>mailcow.conf</code> and add the following:</p> <pre><code># Allow admins to log into Roundcube as email user (without any password)\n# Roundcube with plugin dovecot_impersonate must be installed first\n\nALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE=y\n</code></pre> <p>Edit <code>docker-compose.override.yml</code> and crate/extend the section for <code>php-fpm-mailcow</code>:</p> <pre><code>services:\n  php-fpm-mailcow:\n    environment:\n      - ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE=${ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE:-n}\n</code></pre> <p>Edit <code>data/web/js/site/mailbox.js</code> and the following code after <code>if (ALLOW_ADMIN_EMAIL_LOGIN) { ... }</code></p> <pre><code>if (ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE) {\n  item.action += '&lt;a href=\"/rc-auth.php?login=' + encodeURIComponent(item.username) + '\" class=\"login_as btn btn-sm btn-xs-half btn-primary\" target=\"_blank\"&gt;&lt;i class=\"bi bi-envelope-fill\"&gt;&lt;/i&gt; Roundcube&lt;/a&gt;';\n}\n</code></pre> <p>Edit <code>data/web/mailbox.php</code> and add this line to array <code>$template_data</code>:</p> <pre><code>  'allow_admin_email_login_roundcube' =&gt; (preg_match(\"/^(yes|y)+$/i\", $_ENV[\"ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE\"])) ? 'true' : 'false',\n</code></pre> <p>Edit <code>data/web/templates/mailbox.twig</code> and add this code to the bottom of the javascript section:</p> <pre><code>  var ALLOW_ADMIN_EMAIL_LOGIN_ROUNDCUBE = {{ allow_admin_email_login_roundcube }};\n</code></pre> <p>Copy the contents of the following files from this Snippet:</p> <ul> <li><code>data/web/inc/lib/RoundcubeAutoLogin.php</code></li> <li><code>data/web/rc-auth.php</code></li> </ul>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#finish-installation","level":2,"title":"Finish installation","text":"<p>Finally, restart mailcow</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#upgrading-roundcube","level":2,"title":"Upgrading Roundcube","text":"<p>Upgrading Roundcube is rather simple, go to the GitHub releases page for Roundcube and get the link for the \"complete.tar.gz\" file for the wanted release. Then follow the below commands and change the URL and Roundcube folder name if needed.</p> <pre><code># Enter a bash session of the mailcow PHP container\ndocker exec -it mailcowdockerized-php-fpm-mailcow-1 bash\n\n# Install required upgrade dependency, then upgrade Roundcube to wanted release\napk add rsync\ncd /tmp\nwget -O - https://github.com/roundcube/roundcubemail/releases/download/1.6.10/roundcubemail-1.6.10-complete.tar.gz | tar xfvz -\ncd roundcubemail-1.6.10\nbin/installto.sh /web/rc\n\n# Type 'Y' and press enter to upgrade your install of Roundcube\n# Type 'N' to \"Do you want me to fix your local configuration\" if prompted\n\n# If you see \"NOTICE: Update dependencies by running php composer.phar update --no-dev\" run composer:\ncd /web/rc\ncomposer update --no-dev -o\n# If asked \"Do you trust \"roundcube/plugin-installer\" to execute code and wish to enable it now? (writes \"allow-plugins\" to composer.json) [y,n,d,?] \" hit y and continue.\n\n# Remove leftover files\nrm -rf /tmp/roundcube*\n\n# If you're going from 1.5 to 1.6 please run the config file changes below\nsed -i \"s/\\$config\\['default_host'\\].*$/\\$config\\['imap_host'\\]\\ =\\ 'dovecot:143'\\;/\" /web/rc/config/config.inc.php\nsed -i \"/\\$config\\['default_port'\\].*$/d\" /web/rc/config/config.inc.php\nsed -i \"s/\\$config\\['smtp_server'\\].*$/\\$config\\['smtp_host'\\]\\ =\\ 'postfix:588'\\;/\" /web/rc/config/config.inc.php\nsed -i \"/\\$config\\['smtp_port'\\].*$/d\" /web/rc/config/config.inc.php\nsed -i \"s/\\$config\\['managesieve_host'\\].*$/\\$config\\['managesieve_host'\\]\\ =\\ 'dovecot:4190'\\;/\" /web/rc/config/config.inc.php\nsed -i \"/\\$config\\['managesieve_port'\\].*$/d\" /web/rc/config/config.inc.php\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#upgrade-composer-plugins","level":3,"title":"Upgrade composer plugins","text":"<p>To upgrade roundcube plugins installed using composer and dependencies (e.g. RCMCardDAV plugin), you can simply run composer in the container:</p> <pre><code>docker exec -it -w /web/rc $(docker ps -f name=php-fpm-mailcow -q) composer update --no-dev -o\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#upgrade-mime-type-mappings","level":3,"title":"Upgrade mime type mappings","text":"<p>To upgrade the mime type mappings, re-download them using the command in the installation instructions.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#uninstalling-roundcube","level":2,"title":"Uninstalling roundcube","text":"<p>For the uninstallation, it is also assumed that the commands are executed in the mailcow installation directory and that <code>mailcow.conf</code> has been sourced in the shell, see Preparation above.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#remove-the-web-directory","level":3,"title":"Remove the web directory","text":"<p>This deletes the roundcube installation and all plugins and dependencies that you may have installed, including those installed with composer.</p> <p>Note: This deletes also any custom configuration that you may have done in roundcube. If you want to preserve it, move it some place else instead of deleting it.</p> <pre><code>rm -r data/web/rc\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#remove-the-database","level":3,"title":"Remove the database","text":"<p>Note: This clears all data stored for roundcube. If you want to preserve it, you could use <code>mysqldump</code> before deleting the data, or simply keep the database.</p> <pre><code>docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"DROP USER 'roundcube'@'%';\"\ndocker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -e \"DROP DATABASE roundcubemail;\"\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#remove-any-custom-configuration-files-we-added-to-mailcow","level":3,"title":"Remove any custom configuration files we added to mailcow","text":"<p>To determine these, please read through the installation steps and revert what you changed there.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#migration-from-older-mailcow-roundcube-setup","level":2,"title":"Migration from older mailcow roundcube setup","text":"<p>Older versions of this instruction used the mailcow database also for roundcube, with a configured name prefix <code>mailcow_rc1</code> on all roundcube tables.</p> <p>For the migration, it is also assumed that the commands are executed in the mailcow installation directory and that <code>mailcow.conf</code> has been sourced in the shell, see Preparation above. The commands of the different steps build on each other and must be executed in the same shell. Particularly, some steps set shell variables (most importantly the <code>DBROUNDCUBE</code> variable with the database password of the roundcube database user) used in later steps.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#create-new-roundcube-database-user-and-database","level":3,"title":"Create new roundcube database user and database","text":"<p>Follow the steps above to create the roundcube database user and the separate database.</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#migrate-roundcube-data-from-mailcow-database","level":3,"title":"Migrate roundcube data from mailcow database","text":"<p>Before starting the database migration, we disable roundcube to avoid further changes to the roundcube database tables during the migration.</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/conf/nginx/site.roundcube.custom\nlocation ^~ /rc/ {\n  return 503;\n}\nEOCONFIG\ndocker compose exec nginx-mailcow nginx -s reload\n</code></pre> <p>Now we copy the roundcube data to the new database. We strip the database table prefix in the process, you may need to adjust <code>mailcow_rc1</code> in case you used a different prefix. It is also possible to keep the prefix (then also keep the respective <code>db_prefix</code> roundcube setting). Then amend the foreign keys.</p> <pre><code>RCTABLES=$(docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -sN mailcow -e \"show tables like 'mailcow_rc1%';\" | tr '\\n\\r' ' ')\ndocker exec $(docker ps -f name=mysql-mailcow -q) /bin/bash -c \"mysqldump -uroot -p${DBROOT} mailcow $RCTABLES | sed 's/mailcow_rc1//' | mysql -uroot -p${DBROOT} roundcubemail\"\nFOREIGNKEYS=$(docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -sN mailcow -e \"SELECT CONCAT('ALTER TABLE \\`', TABLE_NAME, '\\` ', 'DROP FOREIGN KEY \\`', CONSTRAINT_NAME, '\\`;', 'ALTER TABLE \\`', TABLE_NAME, '\\` ', 'ADD FOREIGN KEY \\`', CONSTRAINT_NAME, '\\` (', COLUMN_NAME, ') ', 'REFERENCES \\`', REPLACE(REFERENCED_TABLE_NAME, 'mailcow_rc1', ''), '\\` (', REFERENCED_COLUMN_NAME, ');') FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = 'roundcubemail' AND REFERENCED_TABLE_NAME IS NOT NULL;\")\ndocker exec $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} roundcubemail -e \"$FOREIGNKEYS\"\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#update-roundcube-configuration","level":3,"title":"Update roundcube configuration","text":"<p>Run the following to remove the no longer required <code>db_prefix</code> option. We also enable logging of roundcube by removing the settings <code>log_dir</code> and <code>temp_dir</code> that were part of the old setup instructions.</p> <pre><code>sed -i \"/\\$config\\['db_prefix'\\].*$/d\" data/web/rc/config/config.inc.php\nsed -i \"/\\$config\\['log_dir'\\].*$/d\" data/web/rc/config/config.inc.php\nsed -i \"/\\$config\\['temp_dir'\\].*$/d\" data/web/rc/config/config.inc.php\n</code></pre> <p>We need to adapt the nginx configuration for roundcube to not expose the non-public folders of roundcube, specifically those containing temporary files and log files:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;data/conf/nginx/site.roundcube.custom\nlocation /rc/ {\n  alias /web/rc/public_html/;\n}\nEOCONFIG\n</code></pre> <p>We can also update the <code>cipher_method</code> to a more secure one but mind that data previously encrypted by roundcube cannot be decrypted anymore afterwards. This specifically affects stored CardDAV passwords if you use RCMCardDAV and your users added custom addressbooks (the preset will be fixed automatically upon next login of the user). If you want to change the <code>cipher_method</code>, run:</p> <pre><code>cat &lt;&lt;EOCONFIG &gt;&gt;data/web/rc/config/config.inc.php\n\\$config['cipher_method'] = 'chacha20-poly1305';\nEOCONFIG\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#switch-rcmcarddav-plugin-to-composer-installation-method","level":3,"title":"Switch RCMCardDAV plugin to composer installation method","text":"<p>This is optional but will align your installation with these instructions and enable you to upgrade RCMCardDAV using composer. This is simply done by deleting the carddav plugin from the installation and installing it using composer according to the instructions above, which include the creation of a new RCMCardDAV v5 config. In case you modified your RCMCardDAV configuration file, you may want to backup it before deleting the plugin and carry over your changes to the new configuration afterwards as well.</p> <p>To delete the carddav plugin run the following command, then re-install according to the instructions above:</p> <pre><code>rm -r data/web/rc/plugins/carddav\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#switch-roundcube-to-new-database","level":3,"title":"Switch roundcube to new database","text":"<p>First adapt the roundcube configuration to use the new database. <pre><code>sed -i \"/\\$config\\['db_dsnw'\\].*$/d\" data/web/rc/config/config.inc.php\ncat &lt;&lt;EOCONFIG &gt;&gt;data/web/rc/config/config.inc.php\n\\$config['db_dsnw'] = 'mysql://roundcube:${DBROUNDCUBE}@mysql/roundcubemail';\nEOCONFIG\n</code></pre></p>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#re-enable-roundcube-web-access","level":3,"title":"Re-enable roundcube web access","text":"<p>Execute the chown and chmod commands on sensitive roundcube directories listed in Preparation, to make sure the nginx webserver cannot access files it is not supposed to serve.</p> <p>Then re-enable web access to roundcube by replacing our temporary roundcube custom config for the one described above, and reload the nginx configuration:</p> <pre><code>docker compose exec nginx-mailcow nginx -s reload\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#other-changes","level":3,"title":"Other changes","text":"<p>You must also adapt the configuration of the roundcube password plugin according to this instruction, specifically if you use the password changing functionality, since the old instruction directly changed the password in the database, whereas this version of the instruction uses the mailcow API for the password change.</p> <p>Regarding other changes and additions (e.g., dovecot_client_ip plugin), you can go through the current installation instructions and adapt your configuration accordingly or perform the listed installation steps for new additions.</p> <p>Specifically, consider the following sections:   - Ofelia job for roundcube housekeeping   - Allow plaintext authentication in dovecot,     if you adapt the roundcube configuration to contact dovecot via non-encrypted IMAP connection.   - Forward the client network address to dovecot</p>","path":["Third party roundcube.en"],"tags":[]},{"location":"third_party/roundcube/third_party-roundcube.en/#removing-roundcube-tables-from-mailcow-database","level":3,"title":"Removing roundcube tables from mailcow database","text":"<p>After you have verified that the migration was successful and roundcube works using the separate database, you can remove the roundcube tables from the mailcow database using the following command:</p> <pre><code>docker exec -it $(docker ps -f name=mysql-mailcow -q) mysql -uroot -p${DBROOT} -sN mailcow -e \"SET SESSION foreign_key_checks = 0; DROP TABLE IF EXISTS $(echo $RCTABLES | sed -e 's/ \\+/,/g');\"\n</code></pre>","path":["Third party roundcube.en"],"tags":[]},{"location":"troubleshooting/debug-admin_login_sogo/","level":1,"title":"Debug admin login sogo","text":"<p>This is an experimental feature that allows admins and domain admins to directly  log into SOGo as a mailbox user, without knowing the users password.</p> <p>For this, an additional link to SOGo is displayed in the mailbox list (mailcow UI).</p> <p>Multiple concurrent admin-logins to different mailboxes are also possible when using this feature.</p>","path":["General Troubleshooting","Debug admin login sogo"],"tags":[]},{"location":"troubleshooting/debug-admin_login_sogo/#enabling-the-feature","level":2,"title":"Enabling the feature","text":"<p>The feature is disabled by default. It can be enabled in the <code>mailcow.conf</code> by setting: <pre><code>ALLOW_ADMIN_EMAIL_LOGIN=y\n</code></pre> and recreating the affected containers with</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose up -d\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>","path":["General Troubleshooting","Debug admin login sogo"],"tags":[]},{"location":"troubleshooting/debug-admin_login_sogo/#drawbacks-when-enabled","level":2,"title":"Drawbacks when enabled","text":"<ul> <li>Each SOGo page-load and each Active-Sync request will cause an additional execution of an internal PHP script. This might impact load-times of SOGo / EAS. In most cases, this should not be noticeable but should be kept in mind if you face any performance issues.</li> <li>SOGo will not display a logout link for admin-logins, to login normally one has to logout from the mailcow UI so the PHP session is destroyed.</li> <li>Subscribing to another user's calendar or address book while logged in as admin does not work. Neither does inviting other users to calendar events. The page will reload when these things are attempted.</li> </ul>","path":["General Troubleshooting","Debug admin login sogo"],"tags":[]},{"location":"troubleshooting/debug-admin_login_sogo/#technical-details","level":2,"title":"Technical details","text":"<p>SOGoTrustProxyAuthentication option is set to YES which makes SOGo trust the x-webobjects-remote-user header.</p> <p>Dovecot will receive a random master-password which is valid for all mailboxes when used by the SOGo container.</p> <p>Clicking on the SOGo button in the mailbox list will open sogo-auth.php which checks permissions, sets session variables and redirects to the SOGo mailbox.</p> <p>Each SOGo, CardDAV, CalDAV and EAS http request will cause an additional, nginx internal auth_request call to sogo-auth.php with the following behavior:</p> <ul> <li> <p>If a basic_auth header is present, the script will validate the credentials in place of SOGo and provide the following headers: <code>x-webobjects-remote-user</code>, <code>Authorization</code> and <code>x-webobjects-auth-type</code>.</p> </li> <li> <p>If no basic_auth header is present, the script will check for an active mailcow admin session for the requested email user and provide the same headers but with the dovecot master password used in the <code>Authorization</code> header.</p> </li> <li> <p>If both fails the headers will be set empty, which makes SOGo use its standard authentication methods.</p> </li> </ul> <p>All of these options / behaviors are disabled if the <code>ALLOW_ADMIN_EMAIL_LOGIN</code> is not enabled in the config.</p>","path":["General Troubleshooting","Debug admin login sogo"],"tags":[]},{"location":"troubleshooting/debug-attach_service.en/","level":1,"title":"Debug attach service.en","text":"","path":["Debug attach service.en"],"tags":[]},{"location":"troubleshooting/debug-attach_service.en/#attaching-a-container-to-your-shell","level":2,"title":"Attaching a Container to your Shell","text":"<p>To attach a container to your shell you can simply run</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec $Dienst_Name /bin/bash\n</code></pre> <pre><code>docker-compose exec $Dienst_Name /bin/bash\n</code></pre>","path":["Debug attach service.en"],"tags":[]},{"location":"troubleshooting/debug-attach_service.en/#connecting-to-services","level":3,"title":"Connecting to Services","text":"<p>If you want to connect to a service / application directly it is always a good idea to <code>source mailcow.conf</code> to get all relevant variables into your environment.</p>","path":["Debug attach service.en"],"tags":[]},{"location":"troubleshooting/debug-attach_service.en/#mysql","level":4,"title":"MySQL","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>source mailcow.conf\ndocker compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME}\n</code></pre> <pre><code>source mailcow.conf\ndocker-compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME}\n</code></pre>","path":["Debug attach service.en"],"tags":[]},{"location":"troubleshooting/debug-attach_service.en/#redis","level":4,"title":"Redis","text":"docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec redis-mailcow redis-cli\n</code></pre> <pre><code>docker-compose exec redis-mailcow redis-cli\n</code></pre>","path":["Debug attach service.en"],"tags":[]},{"location":"troubleshooting/debug-attach_service.en/#service-descriptions","level":2,"title":"Service Descriptions","text":"<p>Here is a brief overview of what container / service does what:</p> Service Name Service Descriptions unbound-mailcow Local (DNSSEC) DNS Resolver mysql-mailcow Stores SOGo's and most of mailcow's settings postfix-mailcow Receives and sends mails dovecot-mailcow User logins and sieve filter redis-mailcow Storage back-end for DKIM keys and Rspamd rspamd-mailcow Mail filtering system. Used for av handling, dkim signing, spam handling clamd-mailcow Scans attachments for viruses olefy-mailcow Scans attached office documents for macro-viruses solr-mailcow Provides full-text search in Dovecot sogo-mailcow Webmail client that handles Microsoft ActiveSync and Cal- / CardDav nginx-mailcow Nginx remote proxy that handles all mailcow related HTTP / HTTPS requests acme-mailcow Automates HTTPS (SSL/TLS) certificate deployment memcached-mailcow Internal caching system for mailcow services watchdog-mailcow Allows the monitoring of docker containers / services php-fpm-mailcow Powers the mailcow web UI netfilter-mailcow Fail2Ban like integration","path":["Debug attach service.en"],"tags":[]},{"location":"troubleshooting/debug-common_problems.en/","level":1,"title":"Debug common problems.en","text":"<p>Here we list common problems and possible solutions:</p>","path":["Debug common problems.en"],"tags":[]},{"location":"troubleshooting/debug-common_problems.en/#mail-loops-back-to-myself","level":2,"title":"Mail loops back to myself","text":"<p>Please check in your mailcow UI if you made the domain a backup MX:</p> <p></p>","path":["Debug common problems.en"],"tags":[]},{"location":"troubleshooting/debug-common_problems.en/#i-can-receive-but-not-send-mails","level":2,"title":"I can receive but not send mails","text":"<p>There are a lot of things that could prevent you from sending mail:</p> <ul> <li>Check if your IP address is on any blacklists. You could use dnsbl.info or any other similar service to check for your IP address.</li> <li>There are some consumer ISP routers out there, that block mail ports for non whitelisted domains. Please check if you can reach your server on the ports <code>465</code> or <code>587</code>:</li> </ul> <pre><code># telnet 74.125.133.27 465\nTrying 74.125.133.27...\nConnected to 74.125.133.27.\nEscape character is '^]'.\n</code></pre>","path":["Debug common problems.en"],"tags":[]},{"location":"troubleshooting/debug-common_problems.en/#my-mails-are-identified-as-spam","level":2,"title":"My mails are identified as Spam","text":"<p>Please read our guide on DNS configuration.</p>","path":["Debug common problems.en"],"tags":[]},{"location":"troubleshooting/debug-common_problems.en/#docker-compose-throws-weird-errors","level":2,"title":"docker compose throws weird errors","text":"<p>... like:</p> <ul> <li><code>ERROR: Invalid interpolation format ...</code></li> <li><code>AttributeError: 'NoneType' object has no attribute 'keys'</code>.</li> <li><code>ERROR: In file './docker-compose.yml' service 'version' doesn't have any configuration options</code>.</li> </ul> <p>When you encounter one or similar messages while trying to run mailcow: dockerized please check if you have the latest version of Docker and docker compose</p>","path":["Debug common problems.en"],"tags":[]},{"location":"troubleshooting/debug-common_problems.en/#container-xy-is-unhealthy","level":2,"title":"Container XY is unhealthy","text":"<p>This error tries to tell you that one of the (health) conditions for a certain container are not met. Therefore it can't be started. This can have several reasons, the most common one is an updated git clone but old docker image or vice versa.</p> <p>A wrong configured firewall could also cause such a failure. The containers need to be able to talk to each other over the network 172.22.1.1/24.</p> <p>It might also be wrongly linked file (i.e. SSL certificate) that prevents a crucial container (nginx) from starting, so always check your logs to get an idea where your problem is coming from.</p>","path":["Debug common problems.en"],"tags":[]},{"location":"troubleshooting/debug-common_problems.en/#address-already-in-use","level":2,"title":"Address already in use","text":"<p>If you get an error message like:</p> <pre><code>ERROR: for postfix-mailcow  Cannot start service postfix-mailcow: driver failed programming external     connectivity on endpoint mailcowdockerized_postfix-mailcow_1: Error starting userland proxy: listen tcp 0.0.0.0:25: bind: address already in use\n</code></pre> <p>while trying to start / install mailcow: dockerized, make sure you've followed our section on the prerequisites.</p>","path":["Debug common problems.en"],"tags":[]},{"location":"troubleshooting/debug-common_problems.en/#xyz-cant-connect-to","level":2,"title":"XYZ can't connect to ...","text":"<p>Please check your local firewall! Docker and iptables-based firewalls sometimes create conflicting rules, so disable the firewall on your host to determine whether your connection issues are caused by such conflicts. If they are, you need to manually create appropriate rules in your host firewall to permit the necessary connections.</p> <p>If you experience connection problems from home, please check your ISP router's firewall too, some of them block mail traffic on the SMTP (587) or SMTPS (465) ports. It could also be, that your ISP is blocking the ports for SUBMISSION (25).</p> <p>While Linux users can chose from a variety of tools<sup>1</sup> to check if a port is open, the Windows user has only the PowerShell command <code>Test-NetConnection -ComputerName host -Port port</code> available by default.</p> <p>To enable telnet on a Windows after Vista please check this guide or enter the following command in an terminal with administrator privileges:</p> <pre><code>dism /online /Enable-Feature /FeatureName:TelnetClient\n</code></pre>","path":["Debug common problems.en"],"tags":[]},{"location":"troubleshooting/debug-common_problems.en/#inotify-instance-limit-for-user-5000-uid-vmail-exceeded-see-453","level":2,"title":"Inotify instance limit for user 5000 (UID vmail) exceeded (see #453)","text":"<p>Docker containers use the Docker hosts inotify limits. Setting them on your Docker host will pass them to the container.</p>","path":["Debug common problems.en"],"tags":[]},{"location":"troubleshooting/debug-common_problems.en/#dovecot-keeps-restarting-see-2672","level":2,"title":"Dovecot keeps restarting (see #2672)","text":"<p>Check that you have at least the following files in <code>data/assets/ssl</code>:</p> <pre><code>cert.pem\ndhparams.pem\nkey.pem\n</code></pre> <p>If <code>dhparams.pem</code> is missing, you can generate it with</p> <pre><code>openssl dhparam -out data/assets/ssl/dhparams.pem 4096\n</code></pre>","path":["Debug common problems.en"],"tags":[]},{"location":"troubleshooting/debug-common_problems.en/#rspamd-reports-cannot-open-hyperscan-cache-file-varlibrspamdhs-compiled-for-a-different-platform","level":2,"title":"Rspamd reports: cannot open hyperscan cache file /var/lib/rspamd/{...}.hs: compiled for a different platform","text":"<p>When migrating mailcow to another system (usually with a different CPU), Rspamd may report that it cannot load some (possibly all) <code>.hs</code> files because they were compiled for a different platform (CPU).</p> <p>This is related to Hyperscan<sup>2</sup>, an Intel technique for precompiling regex schemas that Rspamd uses.</p> <p>This feature provides a significant performance boost and is therefore heavily embedded in Rspamd.</p> <p>To fix this bug, all <code>.hs</code> and <code>.hsmp</code> files must be deleted from the rspamd directory:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>cd MAILCOW_ROOT # Usually /opt/mailcow-dockerized\ndocker compose exec rspamd-mailcow bash\nrm -rf /var/lib/rspamd/*.hs\nrm -rf /var/lib/rspamd/*.hsmp\n</code></pre> <pre><code>cd MAILCOW_ROOT # Usually /opt/mailcow-dockerized\ndocker-compose exec rspamd-mailcow bash\nrm -rf /var/lib/rspamd/*.hs\nrm -rf /var/lib/rspamd/*.hsmp\n</code></pre> <p>Restart Rspamd afterwards:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Now Rspamd recompiles the said regex maps again with Hyperscan.</p> <ol> <li> <p>netcat, nmap, openssl, telnet, etc. ↩</p> </li> <li> <p>Hyperscan ↩</p> </li> </ol>","path":["Debug common problems.en"],"tags":[]},{"location":"troubleshooting/debug-logs.en/","level":1,"title":"Debug logs.en","text":"<p>Warning</p> <p>This section only applies for Dockers default logging driver (JSON).</p> <p>To view the logs of all mailcow: dockerized related containers, you can use the following command inside your mailcow-dockerized folder that contains your <code>mailcow.conf</code>. </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs\n</code></pre> <pre><code>docker-compose logs\n</code></pre> <p>This is usually a bit much, but you could trim the output with <code>--tail=100</code> to the last 100 lines per container, or add a <code>-f</code> to follow the live output of all your services.</p> <p>To view the logs of a specific service you can use the following:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose logs [options] $service_name\n</code></pre> <pre><code>docker-compose logs [options] $service_name\n</code></pre> <p>Info</p> <p>The available options for the previous commands are:</p> <ul> <li>--no-color: Produce monochrome output.</li> <li>-f: Follow the log output.</li> <li>-t: Show timestamps.</li> <li>--tail=\"all\": Number of lines to show from the end of the logs for each container.</li> </ul>","path":["Debug logs.en"],"tags":[]},{"location":"troubleshooting/debug-mysql_aria.en/","level":1,"title":"Debug mysql aria.en","text":"","path":["Debug mysql aria.en"],"tags":[]},{"location":"troubleshooting/debug-mysql_aria.en/#mariadb-aria-recovery-after-crash","level":2,"title":"MariaDB: Aria recovery after crash","text":"<p>If your server crashed and MariaDB logs an error similar to <code>[ERROR] mysqld: Aria recovery failed. Please run aria_chk -r on all Aria tables (*.MAI) and delete all aria_log.######## files</code> you may want to try the following to recover the database to a healthy state:</p> <p>Start the stack and wait until mysql-mailcow begins to report a restart. Check this with the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose ps\n</code></pre> <pre><code>docker-compose ps\n</code></pre> <p>Now exec the following commands:</p> <p>Stop the stack, don't run \"down\"</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose stop\n</code></pre> <pre><code>docker-compose stop\n</code></pre> <p>Run a bash in the stopped container as user mysql</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose run --rm --entrypoint '/bin/sh -c \"gosu mysql bash\"' mysql-mailcow\n</code></pre> <pre><code>docker-compose run --rm --entrypoint '/bin/sh -c \"gosu mysql bash\"' mysql-mailcow\n</code></pre> <p>cd to the SQL data directory</p> <pre><code>cd /var/lib/mysql\n</code></pre> <p>Run aria_chk</p> <pre><code>aria_chk --check --force */*.MAI\n</code></pre> <p>Delete aria log files</p> <pre><code>rm aria_log.*\n</code></pre> <p>Execute a complete stack restart using the following commands:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>docker-compose down\ndocker-compose up -d\n</code></pre>","path":["Debug mysql aria.en"],"tags":[]},{"location":"troubleshooting/debug-mysql_upgrade.en/","level":1,"title":"Debug mysql upgrade.en","text":"","path":["Debug mysql upgrade.en"],"tags":[]},{"location":"troubleshooting/debug-mysql_upgrade.en/#run-a-manual-mysql_upgrade","level":2,"title":"Run a manual mysql_upgrade","text":"<p>This step is usually not necessary. </p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose stop mysql-mailcow watchdog-mailcow\ndocker compose run --rm --entrypoint '/bin/sh -c \"gosu mysql mysqld --skip-grant-tables &amp; sleep 10 &amp;&amp; bash &amp;&amp; exit 0\"' mysql-mailcow\n</code></pre> <pre><code>docker-compose stop mysql-mailcow watchdog-mailcow\ndocker-compose run --rm --entrypoint '/bin/sh -c \"gosu mysql mysqld --skip-grant-tables &amp; sleep 10 &amp;&amp; bash &amp;&amp; exit 0\"' mysql-mailcow\n</code></pre> <p>As soon as the SQL shell spawned, run <code>mysql_upgrade</code> and exit the container:</p> <pre><code>mysql_upgrade\nexit\n</code></pre>","path":["Debug mysql upgrade.en"],"tags":[]},{"location":"troubleshooting/debug-resend-quarantine-notifications.en/","level":1,"title":"Debug resend quarantine notifications.en","text":"<p>To resend a quarantine notification, enter the following command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec dovecot-mailcow bash\nmysql -umailcow -p$DBPASS mailcow -e \"update quarantine set notified = 0;\"\nredis-cli -h redis DEL Q_LAST_NOTIFIED\nquarantine_notify.py\n</code></pre> <pre><code>docker-compose exec dovecot-mailcow bash\nmysql -umailcow -p$DBPASS mailcow -e \"update quarantine set notified = 0;\"\nredis-cli -h redis DEL Q_LAST_NOTIFIED\nquarantine_notify.py\n</code></pre> <p>Info</p> <p>We recommend to use this command ONLY for debugging process as the notification is normally triggered automatically based on the settings set for each mailbox.</p>","path":["Debug resend quarantine notifications.en"],"tags":[]},{"location":"troubleshooting/debug-reset_pw.en/","level":1,"title":"Debug reset pw.en","text":"","path":["Debug reset pw.en"],"tags":[]},{"location":"troubleshooting/debug-reset_pw.en/#mailcow-admin-account","level":2,"title":"mailcow Admin Account","text":"<p>Resets the mailcow admin account to a random password. Older mailcow: dockerized installations may find the <code>mailcow-reset-admin.sh</code> script in their mailcow root directory (mailcow_path).</p> <pre><code>cd mailcow_path\n./helper-scripts/mailcow-reset-admin.sh\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"troubleshooting/debug-reset_pw.en/#reset-mysql-passwords","level":2,"title":"Reset MySQL Passwords","text":"<p>Stop the stack by running:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose stop\n</code></pre> <pre><code>docker-compose stop\n</code></pre> <p>When the containers came to a stop, run this command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose run --rm --entrypoint '/bin/sh -c \"gosu mysql mysqld --skip-grant-tables &amp; sleep 10 &amp;&amp; mysql -hlocalhost -uroot &amp;&amp; exit 0\"' mysql-mailcow\n</code></pre> <pre><code>docker-compose run --rm --entrypoint '/bin/sh -c \"gosu mysql mysqld --skip-grant-tables &amp; sleep 10 &amp;&amp; mysql -hlocalhost -uroot &amp;&amp; exit 0\"' mysql-mailcow\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"troubleshooting/debug-reset_pw.en/#1-find-database-name","level":3,"title":"1. Find database name","text":"<pre><code># source mailcow.conf\n# docker compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME}\nMariaDB [(none)]&gt; show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mailcow_database   | &lt;=====\n| mysql              |\n| performance_schema |\n+--------------------+\n4 rows in set (0.00 sec)\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"troubleshooting/debug-reset_pw.en/#2-reset-one-or-more-users","level":3,"title":"2. Reset one or more users","text":"","path":["Debug reset pw.en"],"tags":[]},{"location":"troubleshooting/debug-reset_pw.en/#21-maria-db-104-older-mailcow-installations","level":4,"title":"2.1 Maria DB &lt; 10.4 (older mailcow installations)","text":"<p>Both \"password\" and \"authentication_string\" exist. Currently \"password\" is used, but better set both.</p> <pre><code>MariaDB [(none)]&gt; SELECT user FROM mysql.user;\n+--------------+\n| user         |\n+--------------+\n| mailcow      | &lt;=====\n| root         |\n+--------------+\n2 rows in set (0.00 sec)\n\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\nMariaDB [(none)]&gt; UPDATE mysql.user SET authentication_string = PASSWORD('gotr00t'), password = PASSWORD('gotr00t') WHERE User = 'root';\nMariaDB [(none)]&gt; UPDATE mysql.user SET authentication_string = PASSWORD('mookuh'), password = PASSWORD('mookuh') WHERE User = 'mailcow' AND Host = '%';\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"troubleshooting/debug-reset_pw.en/#22-maria-db-104-current-mailcows","level":4,"title":"2.2 Maria DB &gt;= 10.4 (current mailcows)","text":"<pre><code>MariaDB [(none)]&gt; SELECT user FROM mysql.user;\n+--------------+\n| user         |\n+--------------+\n| mailcow      | &lt;=====\n| root         |\n+--------------+\n2 rows in set (0.00 sec)\n\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\nMariaDB [(none)]&gt; ALTER USER 'mailcow'@'%' IDENTIFIED BY 'mookuh';\nMariaDB [(none)]&gt; ALTER USER 'root'@'%' IDENTIFIED BY 'gotr00t';\nMariaDB [(none)]&gt; ALTER USER 'root'@'localhost' IDENTIFIED BY 'gotr00t';\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"troubleshooting/debug-reset_pw.en/#remove-two-factor-authentication","level":2,"title":"Remove Two-Factor Authentication","text":"","path":["Debug reset pw.en"],"tags":[]},{"location":"troubleshooting/debug-reset_pw.en/#for-mailcow-webui","level":3,"title":"For mailcow WebUI:","text":"<p>This works similar to resetting a MySQL password, now we do it from the host without connecting to the MySQL CLI:</p> <pre><code>source mailcow.conf\ndocker compose exec mysql-mailcow mysql -u${DBUSER} -p${DBPASS} ${DBNAME} -e \"DELETE FROM tfa WHERE username='YOUR_USERNAME';\"\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"troubleshooting/debug-reset_pw.en/#for-sogo","level":3,"title":"For SOGo:","text":"<pre><code>docker compose exec -u sogo sogo-mailcow sogo-tool user-preferences set defaults user@example.com SOGoGoogleAuthenticatorEnabled '{\"SOGoGoogleAuthenticatorEnabled\":0}'\n</code></pre>","path":["Debug reset pw.en"],"tags":[]},{"location":"troubleshooting/debug-reset_tls.en/","level":1,"title":"Debug reset tls.en","text":"<p>In case you encounter problems with your certificate, key or Let's Encrypt account, please try to reset the TLS assets:</p> <pre><code>source mailcow.conf\ndocker compose down\nrm -rf data/assets/ssl\nmkdir data/assets/ssl\nopenssl req -x509 -newkey rsa:4096 -keyout data/assets/ssl-example/key.pem -out data/assets/ssl-example/cert.pem -days 365 -subj \"/C=DE/ST=NRW/L=Willich/O=mailcow/OU=mailcow/CN=${MAILCOW_HOSTNAME}\" -sha256 -nodes\ncp -n -d data/assets/ssl-example/*.pem data/assets/ssl/\ndocker compose up -d\n</code></pre> <p>This will stop mailcow, source the variables we need, create a self-signed certificate and start mailcow.</p> <p>If you use Let's Encrypt you should be careful as you will create a new account and a new set of certificates. You will run into a ratelimit sooner or later.</p> <p>Please also note that previous TLSA records will be invalid.</p>","path":["Debug reset tls.en"],"tags":[]},{"location":"troubleshooting/debug-rm_volumes.en/","level":1,"title":"Debug rm volumes.en","text":"<p>You may want to remove a set of persistent data to resolve a conflict or to start over.</p> <p><code>mailcowdockerized</code> can vary and depends on your compose project name (if it's unchanged, <code>mailcowdockerized</code> is the correct value). If you are unsure about volume names, run <code>docker volume ls</code> for a full list.</p> <p>Delete a single volume:</p> <pre><code>docker volume rm mailcowdockerized_${VOLUME_NAME}\n</code></pre> <ul> <li>Remove volume <code>mysql-vol-1</code> to remove all MySQL data.</li> <li>Remove volume <code>redis-vol-1</code> to remove all Redis data.</li> <li>Remove volume <code>vmail-vol-1</code> to remove all contents of <code>/var/vmail</code> mounted to <code>dovecot-mailcow</code>.</li> <li>Remove volume <code>rspamd-vol-1</code> to remove all Rspamd data.</li> <li>Remove volume <code>crypt-vol-1</code> to remove all crypto data. This will render all mails unreadable.</li> </ul> <p>Alternatively, running the following command will destroy all mailcow: dockerized volumes and delete any related containers and networks:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose down -v\n</code></pre> <pre><code>docker-compose down -v\n</code></pre>","path":["Debug rm volumes.en"],"tags":[]},{"location":"troubleshooting/debug-rspamd_memory_leaks.en/","level":1,"title":"Debug rspamd memory leaks.en","text":"<p>A quick guide to deeply analyze a malfunctioning Rspamd.</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow bash\n\nif ! grep -qi 'apt-stable-asan' /etc/apt/sources.list.d/rspamd.list; then\n  sed -i 's/apt-stabil/apt-stabil-asan/i' /etc/apt/sources.list.d/rspamd.list\nfi\n\napt-get update ; apt-get upgrade rspamd\n\nnano /docker-entrypoint.sh\n\n# Add this in front of \"exec \"$@\"\":\n\nexport G_SLICE=always-malloc\nexport ASAN_OPTIONS=new_delete_type_mismatch=0:detect_leaks=1:detect_odr_violation=0:log_path=/tmp/rspamd-asan:quarantine_size_mb=2048:malloc_context_size=8:fast_unwind_on_malloc=0\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow bash\n\nif ! grep -qi 'apt-stable-asan' /etc/apt/sources.list.d/rspamd.list; then\n  sed -i 's/apt-stabil/apt-stabil-asan/i' /etc/apt/sources.list.d/rspamd.list\nfi\n\napt-get update ; apt-get upgrade rspamd\n\nnano /docker-entrypoint.sh\n\n# Add this in front of \"exec \"$@\"\":\n\nexport G_SLICE=always-malloc\nexport ASAN_OPTIONS=new_delete_type_mismatch=0:detect_leaks=1:detect_odr_violation=0:log_path=/tmp/rspamd-asan:quarantine_size_mb=2048:malloc_context_size=8:fast_unwind_on_malloc=0\n</code></pre> <p>Restart Rspamd:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Your memory consumption will increase by a lot, it will also steadily grow, which is not related to a possible memory leak you are looking for.</p> <p>Leave the container running for a few minutes, hours or days (it should match the time you usually wait for the leak to \"happen\") and restart it:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose restart rspamd-mailcow\n</code></pre> <pre><code>docker-compose restart rspamd-mailcow\n</code></pre> <p>Now enter the container by running the command:</p> docker compose (Plugin)docker-compose (Standalone) <pre><code>docker compose exec rspamd-mailcow bash\n</code></pre> <pre><code>docker-compose exec rspamd-mailcow bash\n</code></pre> <p>Change the directory to /tmp and copy the asan Files to your desired location or upload them via termbin.com (<code>cat /tmp/rspamd-asan.* | nc termbin.com 9999</code>).</p>","path":["Debug rspamd memory leaks.en"],"tags":[]},{"location":"troubleshooting/debug/","level":1,"title":"Debug","text":"<p>When a problem occurs, then always for a reason! What you want to do in such a case is:</p> <ol> <li>Read your logs; follow them to see what the reason for your problem is.</li> <li>Follow the leads given to you in your logfiles and start investigating.</li> <li>Restarting the troubled service or the whole stack to see if the problem persists.</li> <li>Read the documentation of the troubled service and search it's bugtracker for your problem.</li> <li>Search our issues for your problem.</li> <li>Create an issue over at our GitHub repository if you think your problem might be a bug or a missing feature you badly need. But please make sure, that you include all the logs and a full description to your problem. Please do not ask for support on Git.</li> <li>Join our Telegram community or find the official support packages at Servercow.Alternatively ask Twitter and tag us with @mailcow_email</li> </ol>","path":["General Troubleshooting","Debug"],"tags":[]}]}